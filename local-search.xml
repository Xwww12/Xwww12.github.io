<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>goæ“ä½œredis</title>
    <link href="/2023/11/06/%E5%85%B6%E4%BB%96/go/go%E6%93%8D%E4%BD%9Credis/"/>
    <url>/2023/11/06/%E5%85%B6%E4%BB%96/go/go%E6%93%8D%E4%BD%9Credis/</url>
    
    <content type="html"><![CDATA[<h2 id="goæ“ä½œredis"><a href="#goæ“ä½œredis" class="headerlink" title="goæ“ä½œredis"></a>goæ“ä½œredis</h2><p><a href="https://www.mszlu.com/go/go-redis/01/01.html#_1-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B">å‚è€ƒ</a></p><h2 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">go get github.com/go-redis/redis/v8<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºå®¢æˆ·ç«¯"><a href="#åˆ›å»ºå®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»ºå®¢æˆ·ç«¯"></a>åˆ›å»ºå®¢æˆ·ç«¯</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;github.com/go-redis/redis/v8&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>    rdb *redis.Client          <span class="hljs-comment">// rediså®¢æˆ·ç«¯</span><br>    ctx = context.Background() <span class="hljs-comment">// ä¸Šä¸‹æ–‡</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºrediså®¢æˆ·ç«¯</span><br>    rdb = redis.NewClient(&amp;redis.Options&#123;<br>        Addr:     <span class="hljs-string">&quot;localhost:6379&quot;</span>,<br>        Password: <span class="hljs-string">&quot;&quot;</span>,<br>        DB:       <span class="hljs-number">0</span>,<br>    &#125;)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    result, err := rdb.Ping(ctx).Result()<br>    checkErr(err)<br>    fmt.Println(result)<span class="hljs-comment">// PONG</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkErr</span><span class="hljs-params">(err <span class="hljs-type">error</span>)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><h3 id="è·å–æ‰€æœ‰keykeys"><a href="#è·å–æ‰€æœ‰keykeys" class="headerlink" title="è·å–æ‰€æœ‰keykeys()"></a>è·å–æ‰€æœ‰key<code>keys()</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    keys, err := rdb.Keys(ctx, <span class="hljs-string">&quot;*&quot;</span>).Result()<br>    checkErr(err)<br>    fmt.Println(keys)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è·å–keyå¯¹åº”å€¼çš„ç±»å‹Type"><a href="#è·å–keyå¯¹åº”å€¼çš„ç±»å‹Type" class="headerlink" title="è·å–keyå¯¹åº”å€¼çš„ç±»å‹Type()"></a>è·å–keyå¯¹åº”å€¼çš„ç±»å‹<code>Type()</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    res, err := rdb.Type(ctx, <span class="hljs-string">&quot;aaa&quot;</span>).Result()<br>    checkErr(err)<br>    fmt.Println(res)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¶…æ—¶æ—¶é—´"><a href="#è¶…æ—¶æ—¶é—´" class="headerlink" title="è¶…æ—¶æ—¶é—´"></a>è¶…æ—¶æ—¶é—´</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ—¶é—´</span><br>    res, err := rdb.Expire(ctx, <span class="hljs-string">&quot;aaa&quot;</span>,  time.Hour).Result()<br>    checkErr(err)<br>    fmt.Println(res)<br><br>    <span class="hljs-comment">// è·å–è¶…æ—¶æ—¶é—´</span><br>    res, err := rdb.TTL(ctx, <span class="hljs-string">&quot;aaa&quot;</span>).Result()<br>    checkErr(err)<br>    fmt.Println(res)<span class="hljs-comment">// 57m18s</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®å€¼"><a href="#è®¾ç½®å€¼" class="headerlink" title="è®¾ç½®å€¼"></a>è®¾ç½®å€¼</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// string</span><br>    res, err := rdb.Set(ctx, <span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-string">&quot;bbb&quot;</span>, time.Hour).Result()<br>    checkErr(err)<br>    fmt.Println(res)<span class="hljs-comment">// OK</span><br>    <br>    <span class="hljs-comment">// ä¸å­˜åœ¨æ‰è®¾ç½®å€¼</span><br>    res, err := rdb.SetNX(ctx, <span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-string">&quot;ccc&quot;</span>, time.Hour).Result()<br>checkErr(err)<br>fmt.Println(res) <span class="hljs-comment">// false</span><br>    <br>    <span class="hljs-comment">// é€’å¢é€’å‡</span><br>    rdb.SetNX(ctx, <span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-number">1</span>, time.Hour)<br>    val, err := rdb.Incr(ctx, <span class="hljs-string">&quot;key&quot;</span>).Result()<br>    val, err := rdb.Decr(ctx, <span class="hljs-string">&quot;key&quot;</span>).Result()<br>    <br>    <span class="hljs-comment">// hashåŸºæœ¬ä¸Šåœ¨å‰é¢åŠ ä¸ªH</span><br>    <span class="hljs-comment">// listLPush/RPop...</span><br>    <span class="hljs-comment">// setSAdd/SRem/SisMember...</span><br>    <span class="hljs-comment">// sorted setZAdd/ZRem/ZScore/ZRank...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è·å–å€¼"><a href="#è·å–å€¼" class="headerlink" title="è·å–å€¼"></a>è·å–å€¼</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// string</span><br>    res, err := rdb.Get(ctx, <span class="hljs-string">&quot;aaa&quot;</span>).Result()<br>    checkErr(err)<br>    fmt.Println(res) <span class="hljs-comment">// bbb</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤å€¼"><a href="#åˆ é™¤å€¼" class="headerlink" title="åˆ é™¤å€¼"></a>åˆ é™¤å€¼</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// ä¸€ä¸ªæˆ–å¤šä¸ª</span><br>    res, err := rdb.Del(ctx, <span class="hljs-string">&quot;aaa&quot;</span>).Result()<br>    checkErr(err)<br>    fmt.Println(res) <span class="hljs-comment">// 1</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—"><a href="#Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—"></a>Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—</h2><h3 id="å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—"><a href="#å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—" class="headerlink" title="å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—"></a>å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    rdb.Publish(ctx, <span class="hljs-string">&quot;channel1&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¢é˜…ä¸»é¢˜æ¥æ¥æ”¶æ¶ˆæ¯"><a href="#è®¢é˜…ä¸»é¢˜æ¥æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="è®¢é˜…ä¸»é¢˜æ¥æ¥æ”¶æ¶ˆæ¯"></a>è®¢é˜…ä¸»é¢˜æ¥æ¥æ”¶æ¶ˆæ¯</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// PSubscribe æ”¯æŒæ¨¡å¼åŒ¹é…çš„è®¢é˜…ä¸»é¢˜</span><br>    sub := rdb.Subscribe(ctx, <span class="hljs-string">&quot;channel1&quot;</span>)<br><br>    <span class="hljs-keyword">for</span> msg := <span class="hljs-keyword">range</span> sub.Channel() &#123;<br>        <span class="hljs-comment">// æ‰“å°æ”¶åˆ°çš„æ¶ˆæ¯</span><br>        fmt.Println(msg.Channel, msg.Payload)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="é€šè¿‡pipelineå®ç°"><a href="#é€šè¿‡pipelineå®ç°" class="headerlink" title="é€šè¿‡pipelineå®ç°"></a>é€šè¿‡pipelineå®ç°</h3><blockquote><p>pipelineæ˜¯Redisæä¾›çš„ä¸€ç§æ‰¹é‡æ‰§è¡Œå‘½ä»¤çš„æœºåˆ¶ã€‚å®ƒå¯ä»¥å°†å¤šä¸ªå‘½ä»¤ä¸€æ¬¡æ€§å‘é€ç»™RedisæœåŠ¡å™¨æ‰§è¡Œï¼Œå‡å°‘äº†ç½‘ç»œé€šä¿¡çš„å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½ã€‚</p><p>ä½¿ç”¨Pipelineå¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰¹é‡å‘é€å¤šä¸ªå‘½ä»¤ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ¯ä¸ªå‘½ä»¤çš„å“åº”ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç½‘ç»œå»¶è¿Ÿå’ŒæœåŠ¡å™¨å“åº”æ—¶é—´ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦æ‰§è¡Œå¤§é‡å‘½ä»¤çš„åœºæ™¯ã€‚</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// å¼€å¯ä¸€ä¸ªTxPipelineäº‹åŠ¡</span><br>    pipe := rdb.TxPipeline()<br><br>    <span class="hljs-comment">// æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¯ä»¥é€šè¿‡pipeè¯»å†™redis</span><br>    incr := pipe.Incr(ctx,<span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>)<br>    pipe.Expire(ctx,<span class="hljs-string">&quot;tx_pipeline_counter&quot;</span>, time.Hour)<br><br>    <span class="hljs-comment">// ä¸Šé¢ä»£ç ç­‰åŒäºæ‰§è¡Œä¸‹é¢rediså‘½ä»¤</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">//     MULTI</span><br>    <span class="hljs-comment">//     INCR pipeline_counter</span><br>    <span class="hljs-comment">//     EXPIRE pipeline_counts 3600</span><br>    <span class="hljs-comment">//     EXEC</span><br><br>    <span class="hljs-comment">// é€šè¿‡Execå‡½æ•°æäº¤redisäº‹åŠ¡</span><br>    _, err := pipe.Exec(ctx)<br><br>    <span class="hljs-comment">// æäº¤äº‹åŠ¡åï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢äº‹åŠ¡æ“ä½œçš„ç»“æœ</span><br>    <span class="hljs-comment">// å‰é¢æ‰§è¡ŒIncrå‡½æ•°ï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œexecå‡½æ•°ä¹‹å‰ï¼Œå®é™…ä¸Šè¿˜æ²¡å¼€å§‹è¿è¡Œã€‚</span><br>    fmt.Println(incr.Val(), err)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>goæ“ä½œæ•°æ®åº“</title>
    <link href="/2023/11/01/%E5%85%B6%E4%BB%96/go/go%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2023/11/01/%E5%85%B6%E4%BB%96/go/go%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="goæ“ä½œæ•°æ®åº“"><a href="#goæ“ä½œæ•°æ®åº“" class="headerlink" title="goæ“ä½œæ•°æ®åº“"></a>goæ“ä½œæ•°æ®åº“</h2><blockquote><p>Goå®˜æ–¹æ²¡æœ‰æä¾›æ•°æ®åº“é©±åŠ¨ï¼Œè€Œæ˜¯ä¸ºå¼€å‘æ•°æ®åº“é©±åŠ¨å®šä¹‰äº†ä¸€äº›æ ‡å‡†æ¥å£<code>database/sql</code>ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®å®šä¹‰çš„æ¥å£æ¥å¼€å‘ç›¸åº”çš„æ•°æ®åº“é©±åŠ¨</p></blockquote><table><thead><tr><th>æ¥å£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sql.Register(name string, driver driver.Driver)</td><td>æ³¨å†Œé©±åŠ¨ï¼Œé€šè¿‡mapæ¥ä¿å­˜å¤šä¸ªé©±åŠ¨</td></tr><tr><td>Driver.Open(name string) (Conn, error)</td><td>è¿”å›ä¸€ä¸ªæ•°æ®åº“çš„è¿æ¥ï¼Œåªèƒ½åœ¨ä¸€ä¸ªgoroutineä¸­ä½¿ç”¨</td></tr><tr><td>Conn.Prepare(query string) (Stmt, error)</td><td>è¿”å›ä¸å½“å‰è¿æ¥ç›¸å…³çš„æ‰§è¡ŒSqlè¯­å¥çš„å‡†å¤‡çŠ¶æ€ï¼Œç”¨äºå¢åˆ æ”¹æŸ¥</td></tr><tr><td>Conn.Close() error</td><td>å…³é—­è¿æ¥</td></tr><tr><td>Conn.Begin() (Tx, error)</td><td>è¿”å›äº‹åŠ¡ï¼Œç”¨äºæäº¤ã€å›æ»šäº‹åŠ¡</td></tr><tr><td>Stmt.Exec(args []Value) (Result, error)</td><td>æ‰§è¡Œå¢åˆ æ”¹è¯­å¥</td></tr><tr><td>Stmt.Query(args []Value) (Rows, error)</td><td>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</td></tr></tbody></table><p>ã€‚ã€‚ã€‚</p><h2 id="sqlx"><a href="#sqlx" class="headerlink" title="sqlx"></a>sqlx</h2><h3 id="æ“ä½œMysql"><a href="#æ“ä½œMysql" class="headerlink" title="æ“ä½œMysql"></a>æ“ä½œMysql</h3><ol><li><p>å¯¼åŒ…</p> <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmd">// mysqlé©±åŠ¨<br>go get github.com/go-sql-driver/mysql <br><br>// goæ“ä½œæ•°æ®åº“<br>go get github.com/jmoiron/sqlx<br></code></pre></td></tr></table></figure></li><li><p>æ³¨å†Œé©±åŠ¨</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    _ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br>    <span class="hljs-string">&quot;github.com/jmoiron/sqlx&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// ç”¨æˆ·å:å¯†ç @tcp(ip:port)/æ•°æ®åº“å</span><br>    database, err := sqlx.Open(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;open mysql failed,&quot;</span>, err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    fmt.Println(database)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ’å…¥æ“ä½œ<code>db.Exec</code></p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br>_ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span><br><span class="hljs-string">&quot;github.com/jmoiron/sqlx&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>UserId   <span class="hljs-type">int</span>    <span class="hljs-string">`db:&quot;user_id&quot;`</span><br>Username <span class="hljs-type">string</span> <span class="hljs-string">`db:&quot;username&quot;`</span><br>Sex      <span class="hljs-type">string</span> <span class="hljs-string">`db:&quot;sex&quot;`</span><br>Email    <span class="hljs-type">string</span> <span class="hljs-string">`db:&quot;email&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">var</span> db *sqlx.DB<br><br><span class="hljs-comment">// æ³¨å†Œé©±åŠ¨ï¼Œåˆ›å»ºæ“ä½œå¯¹è±¡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>database, err := sqlx.Open(<span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">&quot;root:123456@tcp(127.0.0.1:3306)/test&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;open mysql failed,&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>db = database<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// sqlè¯­å¥</span><br>sql := <span class="hljs-string">&quot;INSERT INTO test_go_user(`username`, `sex`, `email`) VALUES (?, ?, ?)&quot;</span><br>value := [<span class="hljs-number">3</span>]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;user01&quot;</span>, <span class="hljs-string">&quot;man&quot;</span>, <span class="hljs-string">&quot;user01@qq.com&quot;</span>&#125;<br><br><span class="hljs-comment">// æ‰§è¡Œsql</span><br>res, err := db.Exec(sql, value[<span class="hljs-number">0</span>], value[<span class="hljs-number">1</span>], value[<span class="hljs-number">2</span>])<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;exec failed, &quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// æŸ¥çœ‹æœ€åä¸€ä¸ªåˆå…¥çš„id</span><br>id, err := res.LastInsertId()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;exec failed&quot;</span>, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;insert success&quot;</span>, id)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æ“ä½œ<code>db.Select</code></p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    sql := <span class="hljs-string">&quot;SELECT * FROM test_go_user&quot;</span><br><br>    <span class="hljs-keyword">var</span> users []User<br><br>    err := db.Select(&amp;users, sql)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;select failed, &quot;</span>, err)<br>    &#125;<br>    fmt.Println(users)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ“ä½œ<code>db.Exec</code></p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    sql := <span class="hljs-string">&quot;UPDATE test_go_user SET username=? WHERE user_id = ?&quot;</span><br>    value := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;user02&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>&#125;<br><br>    res, err := db.Exec(sql, value[<span class="hljs-number">0</span>], value[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;exec failed, &quot;</span>, err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    row, err := res.RowsAffected()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;exec failed, &quot;</span>, err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;å½±å“çš„è¡Œæ•°ï¼š&quot;</span>, row)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ“ä½œ</p> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br>    sql := <span class="hljs-string">&quot;delete from test_go_user where user_id=?&quot;</span><br><br>    res, err := db.Exec(sql, <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;exce failed,&quot;</span>, err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    row, err := res.RowsAffected()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;row failed, &quot;</span>, err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;delete succ: &quot;</span>, row)<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ“ä½œMysqläº‹åŠ¡Begin-Rollback-Commit"><a href="#æ“ä½œMysqläº‹åŠ¡Begin-Rollback-Commit" class="headerlink" title="æ“ä½œMysqläº‹åŠ¡Begin()/Rollback()/Commit()"></a>æ“ä½œMysqläº‹åŠ¡<code>Begin()/Rollback()/Commit()</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//å¼€å¯äº‹åŠ¡</span><br>    conn, err := db.Begin()<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;begin failed :&quot;</span>, err)<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">//æ‰§è¡Œæ’å…¥è¯­å¥</span><br>    err = insert(<span class="hljs-string">&quot;user01&quot;</span>, <span class="hljs-string">&quot;man&quot;</span>, <span class="hljs-string">&quot;usre01@163.com&quot;</span>, conn)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;exec failed, &quot;</span>, err)<br>        conn.Rollback() <span class="hljs-comment">//å‡ºç°å¼‚å¸¸ï¼Œè¿›è¡Œå›æ»šæ“ä½œ</span><br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">//æ‰§è¡Œæ’å…¥è¯­å¥</span><br>    err = insert(<span class="hljs-string">&quot;user02&quot;</span>, <span class="hljs-string">&quot;man&quot;</span>, <span class="hljs-string">&quot;user02@163.com&quot;</span>, conn)<br>    err = errors.New(<span class="hljs-string">&quot;æµ‹è¯•å›æ»š&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(<span class="hljs-string">&quot;exec failed, &quot;</span>, err)<br>        conn.Rollback()<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>    <span class="hljs-comment">// æäº¤äº‹åŠ¡</span><br>    conn.Commit()<br>    fmt.Println(<span class="hljs-string">&quot;insert success&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="gorm"><a href="#gorm" class="headerlink" title="gorm"></a>gorm</h2><p><a href="https://www.mszlu.com/go/gorm/01/01.html">å‚è€ƒ</a></p><blockquote><p>Go Object Relational Mapping</p></blockquote><h3 id="å¯¼åŒ…"><a href="#å¯¼åŒ…" class="headerlink" title="å¯¼åŒ…"></a>å¯¼åŒ…</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmd">// å®‰è£…MySQLé©±åŠ¨<br>go get -u gorm.io/driver/mysql<br>// å®‰è£…gormåŒ…<br>go get -u gorm.io/gorm<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºè¿æ¥"><a href="#åˆ›å»ºè¿æ¥" class="headerlink" title="åˆ›å»ºè¿æ¥"></a>åˆ›å»ºè¿æ¥</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> DB *gorm.DB<br><br><span class="hljs-comment">// è¿æ¥æ•°æ®åº“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>    username := <span class="hljs-string">&quot;root&quot;</span><br>    password := <span class="hljs-string">&quot;123456&quot;</span><br>    host := <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    port := <span class="hljs-number">3306</span><br>    dbName := <span class="hljs-string">&quot;test&quot;</span><br><br>    <span class="hljs-comment">// data source name</span><br>    <span class="hljs-comment">// root:123456@tcp(127.0.0.1:3306)/test?charset=utf8&amp;parseTime=True&amp;loc=Local</span><br>    dsn := fmt.Sprintf(<span class="hljs-string">&quot;%s:%s@tcp(%s:%d)/%s?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span>, username, password, host, port, dbName)<br>    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;<br>        Logger: logger.Default.LogMode(logger.Info),<br>    &#125;)<br>    checkErr(err)<br>    DB = db<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h3><p><strong>å®ä½“ç±»</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// é»˜è®¤å­—æ®µæ˜ å°„ä¸ºæ•°æ®åº“ï¼šcreate_time -&gt; å®ä½“ç±»ï¼šcreateTime</span><br><span class="hljs-comment">// å¦‚æœæœ‰CreatedAtå’ŒUpdateAtä¼šè‡ªåŠ¨å¡«å……</span><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>    ID         <span class="hljs-type">int64</span><br>    Username   <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:username&quot;`</span><br>    Password   <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;column:password&quot;`</span><br>    CreateTime <span class="hljs-type">int64</span>  <span class="hljs-string">`gorm:&quot;column:createtime&quot;`</span><br>&#125;<br><br><span class="hljs-comment">// TableName è¿”å›è¡¨å</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> TableName() <span class="hljs-type">string</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test_go_user&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æ–°å¢ä¸€æ¡æ•°æ®</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveUser</span><span class="hljs-params">()</span></span> &#123;<br>    user := &amp;User&#123;<br>        Username:   <span class="hljs-string">&quot;zhangsan&quot;</span>,<br>        Password:   <span class="hljs-string">&quot;123456&quot;</span>,<br>        CreateTime: time.Now().UnixMilli(),<br>    &#125;<br>    res := DB.Create(user)<br>    checkErr(res.Error)<br>&#125;<br><br><span class="hljs-comment">// æŸ¥ä¸€æ¡</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getById</span><span class="hljs-params">()</span></span> &#123;<br>    id := <span class="hljs-number">1</span><br>    user := User&#123;&#125;<br>    <span class="hljs-comment">// Firsté»˜è®¤ä¸»é”®æ’åºåå–ä¸€æ¡ï¼ŒTakeä¸è€ƒè™‘æ’åº</span><br>    res := DB.Where(<span class="hljs-string">&quot;id=?&quot;</span>, id).First(&amp;user)<br>    checkErr(res.Error)<br>    fmt.Println(user)<br>&#125;<br><br><span class="hljs-comment">// æŸ¥æ‰€æœ‰</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAll</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">var</span> users []User<br>    res := DB.Find(&amp;users)<br>    checkErr(res.Error)<br>    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(users); i++ &#123;<br>        fmt.Println(users[i])<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ”¹</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateById</span><span class="hljs-params">()</span></span> &#123;<br>    id := <span class="hljs-number">1</span><br>    res := DB.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, id).Update(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>)<br>    checkErr(res.Error)<br>&#125;<br><br><span class="hljs-comment">// åˆ </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteById</span><span class="hljs-params">()</span></span> &#123;<br>    id := <span class="hljs-number">2</span><br>    res := DB.Where(<span class="hljs-string">&quot;id=?&quot;</span>, id).Delete(&amp;User&#123;&#125;)<br>    checkErr(res.Error)<br>&#125;<br><br><span class="hljs-comment">// åŸç”Ÿsqlæ‰§è¡Œå¢åˆ æ”¹</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sql</span><span class="hljs-params">()</span></span> &#123;<br>    db.Exec(<span class="hljs-string">&quot;insert into users (username,password,createtime) values (?,?,?)&quot;</span>, user.Username, user.Password, user.CreateTime)<br>&#125;<br><br><span class="hljs-comment">// åŸç”Ÿsqlæ‰§è¡ŒæŸ¥</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sql2</span><span class="hljs-params">()</span></span> &#123;<br>    sql := <span class="hljs-string">&quot;SELECT type, count(*) as  total FROM `goods` where create_time &gt; ? GROUP BY type HAVING (total &gt; 0)&quot;</span><br>    db.Raw(sql, <span class="hljs-string">&quot;2022-11-06 00:00:00&quot;</span>).Scan(&amp;results)<br>    fmt.Println(results)<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p><strong>è‡ªåŠ¨äº‹åŠ¡</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">autoTransaction</span><span class="hljs-params">()</span></span> &#123;<br>    id := <span class="hljs-number">1</span><br>    err := DB.Transaction(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *gorm.DB)</span></span> <span class="hljs-type">error</span> &#123;<br>        res := tx.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, id).Update(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>)<br>        <span class="hljs-comment">// è¿”å›errorå°±ä¼šå›æ»š</span><br>        <span class="hljs-keyword">if</span> res.Error != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-keyword">return</span> res.Error<br>        &#125;<br><br>        res = tx.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, id).Update(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>)<br>        res.Error = errors.New(<span class="hljs-string">&quot;æµ‹è¯•å›æ»š&quot;</span>)<br>        <span class="hljs-keyword">if</span> res.Error != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-keyword">return</span> res.Error<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;)<br>    checkErr(err)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰‹åŠ¨æäº¤äº‹åŠ¡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">transaction</span><span class="hljs-params">()</span></span> &#123;<br>    tx := DB.Begin()<br><br>    id := <span class="hljs-number">1</span><br>    res := tx.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;id = ?&quot;</span>, id).Update(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>)<br><br>    res.Error = errors.New(<span class="hljs-string">&quot;æµ‹è¯•å›æ»š&quot;</span>)<br>    <span class="hljs-keyword">if</span> res.Error != <span class="hljs-literal">nil</span> &#123;<br>        fmt.Println(res.Error)<br>        <span class="hljs-comment">// å›æ»š</span><br>        tx.Rollback()<br>    &#125;<br>    <span class="hljs-comment">// æäº¤</span><br>    tx.Commit()<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡ä¿å­˜ç‚¹æ¥å›æ»šéƒ¨åˆ†äº‹åŠ¡</p><p>SavePoint(â€œä¿å­˜ç‚¹åâ€); RollBackTo(â€œä¿å­˜ç‚¹åâ€)</p></blockquote><h3 id="å›è°ƒ"><a href="#å›è°ƒ" class="headerlink" title="å›è°ƒ"></a>å›è°ƒ</h3><p>åœ¨å›è°ƒä¸­å¦‚æœè¿”å›erroråˆ™ä¼šå›æ»šäº‹åŠ¡ï¼Œå¯ä»¥ç”¨æ¥åšå…¥å‚ã€å‡ºå‚æ£€æŸ¥ç­‰æ“ä½œ</p><p>ç»“æ„ä½“å®ç°å¯¹åº”çš„å›è°ƒï¼Œ</p><p>å¢ï¼šBeforeCreateã€AfterCreate</p><p>åˆ ï¼šBeforeDeleteã€AfterDelete</p><p>æ”¹ï¼šBeforeUpdateã€AfterUpdate</p><p>æŸ¥ï¼šAfterFind</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åœ¨æ–°æ’å…¥æ•°æ®å‰ä¼šè°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> BeforeCreate(tx *gorm.DB) <span class="hljs-type">error</span> &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒusernameçš„å›è°ƒ</span><br>    username := u.Username<br><br>    <span class="hljs-keyword">var</span> count <span class="hljs-type">int64</span><br>    DB.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;username = ?&quot;</span>, username).Count(&amp;count)<br>    <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">0</span> &#123;<br>        <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;å­˜åœ¨ç›¸åŒusernameï¼š&quot;</span> + username + <span class="hljs-string">&quot;ï¼Œå›æ»š&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// åœ¨æ–°æ’å…¥æ•°æ®åä¼šè°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> AfterCreate(tx *gorm.DB) <span class="hljs-type">error</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;æ’å…¥æ•°æ®æˆåŠŸ, id: &quot;</span>, u.ID)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹å†™webæ¡†æ¶</title>
    <link href="/2023/10/29/%E5%85%B6%E4%BB%96/go/%E6%89%8B%E5%86%99web%E6%A1%86%E6%9E%B6/"/>
    <url>/2023/10/29/%E5%85%B6%E4%BB%96/go/%E6%89%8B%E5%86%99web%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="æ‰‹å†™webæ¡†æ¶"><a href="#æ‰‹å†™webæ¡†æ¶" class="headerlink" title="æ‰‹å†™webæ¡†æ¶"></a>æ‰‹å†™webæ¡†æ¶</h2><p><a href="https://geektutu.com/post/gee.html">7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶Geeæ•™ç¨‹ | æå®¢å…”å…” (geektutu.com)</a></p><p>â†‘çš„ç¬”è®°</p><h2 id="ğŸ˜€day1-net-x2F-httpåŸºç¡€"><a href="#ğŸ˜€day1-net-x2F-httpåŸºç¡€" class="headerlink" title="ğŸ˜€day1-net&#x2F;httpåŸºç¡€"></a>ğŸ˜€day1-net&#x2F;httpåŸºç¡€</h2><h3 id="httpçš„API"><a href="#httpçš„API" class="headerlink" title="httpçš„API"></a>httpçš„API</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">/*</span><br><span class="hljs-comment">http.HandleFunc(&quot;è¯·æ±‚è·¯å¾„&quot;, å¤„ç†æ–¹æ³•)</span><br><span class="hljs-comment">http.ListenAndServe(&quot;:ç»‘å®šç«¯å£&quot;, å¤„ç†å™¨)</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">// é€šè¿‡HandleFuncå®šä¹‰å¤„ç†æ–¹æ³•</span><br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;<br>    <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> req.Header &#123;<br>fmt.Fprintf(w, <span class="hljs-string">&quot;Header[%q] = %q\n&quot;</span>, k, v)<br>&#125;<br>&#125;)<br>http.ListenAndServe(<span class="hljs-string">&quot;:9999&quot;</span>, <span class="hljs-literal">nil</span>)<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// é€šè¿‡å¤„ç†å™¨å®šä¹‰å¤„ç†æ–¹æ³•</span><br><span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-comment">// å®ç°ServeHTTPæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;<br><span class="hljs-keyword">switch</span> req.URL.Path &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;/&quot;</span>:<br>fmt.Fprintf(w, <span class="hljs-string">&quot;URL.Path = %q\n&quot;</span>, req.URL.Path)<br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;/hello&quot;</span>:<br><span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> req.Header &#123;<br>fmt.Fprintf(w, <span class="hljs-string">&quot;Header[%q] = %q\n&quot;</span>, k, v)<br>&#125;<br><span class="hljs-keyword">default</span>:<br>fmt.Fprintf(w, <span class="hljs-string">&quot;404 NOT FOUND %s\n&quot;</span>, req.URL)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>engine := <span class="hljs-built_in">new</span>(Engine)<br><br>log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;:9999&quot;</span>, engine))<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ğŸ˜€day2-è·¯ç”±å’Œå°è£…ä¸Šä¸‹æ–‡"><a href="#ğŸ˜€day2-è·¯ç”±å’Œå°è£…ä¸Šä¸‹æ–‡" class="headerlink" title="ğŸ˜€day2-è·¯ç”±å’Œå°è£…ä¸Šä¸‹æ–‡"></a>ğŸ˜€day2-è·¯ç”±å’Œå°è£…ä¸Šä¸‹æ–‡</h2><ul><li>Contextï¼šå°è£…æ­¤æ¬¡è¯·æ±‚çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚req, resp, method, pathç­‰</li><li>routerï¼šä¿å­˜è¯·æ±‚è·¯å¾„å¯¹åº”çš„å¤„ç†å‡½æ•°</li><li>Engineï¼šåˆ›å»ºContextå’Œrouterï¼Œè°ƒç”¨routeræ¥å“åº”è¯·æ±‚</li></ul><p>context.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> H <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><br><span class="hljs-comment">// Context ä¸Šä¸‹æ–‡</span><br><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> &#123;<br>    Writer     http.ResponseWriter<br>    Req        *http.Request<br>    Path       <span class="hljs-type">string</span><br>    Method     <span class="hljs-type">string</span><br>    StatusCode <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newContext</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> *Context &#123;<br>    <span class="hljs-keyword">return</span> &amp;Context&#123;<br>        Writer: w,<br>        Req:    req,<br>        Path:   req.URL.Path,<br>        Method: req.Method,<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// PostForm è·å–è¡¨å•å‚æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> PostForm(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>    <span class="hljs-keyword">return</span> c.Req.FormValue(key)<br>&#125;<br><br><span class="hljs-comment">// Query è·å–æŸ¥è¯¢å‚æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Query(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>    <span class="hljs-keyword">return</span> c.Req.URL.Query().Get(key)<br>&#125;<br><br><span class="hljs-comment">// Status è®¾ç½®å“åº”ç </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Status(code <span class="hljs-type">int</span>) &#123;<br>    c.StatusCode = code<br>    c.Writer.WriteHeader(code)<br>&#125;<br><br><span class="hljs-comment">// SetHeader è®¾ç½®å“åº”å¤´</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> SetHeader(key <span class="hljs-type">string</span>, value <span class="hljs-type">string</span>) &#123;<br>    c.Writer.Header().Set(key, value)<br>&#125;<br><br><span class="hljs-comment">// å“åº”String</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> String(code <span class="hljs-type">int</span>, format <span class="hljs-type">string</span>, values ...<span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>    c.SetHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/plain&quot;</span>)<br>    c.Status(code)<br>    c.Writer.Write([]<span class="hljs-type">byte</span>(fmt.Sprintf(format, values...)))<br>&#125;<br><br><span class="hljs-comment">// JSON å“åº”JSONæ•°æ®</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> JSON(code <span class="hljs-type">int</span>, obj <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>    c.SetHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)<br>    c.Status(code)<br>    encoder := json.NewEncoder(c.Writer)<br>    <span class="hljs-keyword">if</span> err := encoder.Encode(obj); err != <span class="hljs-literal">nil</span> &#123;<br>        http.Error(c.Writer, err.Error(), <span class="hljs-number">500</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Data(code <span class="hljs-type">int</span>, data []<span class="hljs-type">byte</span>) &#123;<br>    c.Status(code)<br>    c.Writer.Write(data)<br>&#125;<br><br><span class="hljs-comment">// HTML å“åº”HTMLé¡µé¢</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> HTML(code <span class="hljs-type">int</span>, html <span class="hljs-type">string</span>) &#123;<br>    c.SetHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;text/html&quot;</span>)<br>    c.Status(code)<br>    c.Writer.Write([]<span class="hljs-type">byte</span>(html))<br>&#125;<br></code></pre></td></tr></table></figure><p>router.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx *Context)</span></span><br><br><span class="hljs-keyword">type</span> router <span class="hljs-keyword">struct</span> &#123;<br>    handles <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRouter</span><span class="hljs-params">()</span></span> *router &#123;<br>    <span class="hljs-keyword">return</span> &amp;router&#123;handles: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc)&#125;<br>&#125;<br><br><span class="hljs-comment">// æ·»åŠ è·¯ç”±</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> addRoute(method <span class="hljs-type">string</span>, pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    log.Printf(<span class="hljs-string">&quot;Route %4s - %s&quot;</span>, method)<br>    key := method + <span class="hljs-string">&quot;-&quot;</span> + pattern<br>    r.handles[key] = handler<br>&#125;<br><br><span class="hljs-comment">// æ‰§è¡Œå¤„ç†å™¨</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> handle(c *Context) &#123;<br>    key := c.Method + <span class="hljs-string">&quot;-&quot;</span> + c.Path<br>    <span class="hljs-keyword">if</span> handler, ok := r.handles[key]; ok &#123;<br>        handler(c)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        c.String(http.StatusNotFound, <span class="hljs-string">&quot;404 NOT FOUNT %s&quot;</span>, c.Path)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>gee.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> &#123;<br>    router *router<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span></span> *Engine &#123;<br>    <span class="hljs-keyword">return</span> &amp;Engine&#123;router: newRouter()&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> addRoute(method <span class="hljs-type">string</span>, pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    engine.router.addRoute(method, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> GET(pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    engine.addRoute(<span class="hljs-string">&quot;GET&quot;</span>, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> POST(pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    engine.addRoute(<span class="hljs-string">&quot;POST&quot;</span>, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> RUN(addr <span class="hljs-type">string</span>) (err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">return</span> http.ListenAndServe(addr, engine)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;<br>    c := newContext(w, req)<br>    engine.router.handle(c)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤–éƒ¨è°ƒç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gee.New()<br><br>r.GET(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> &#123;<br>c.HTML(http.StatusOK, <span class="hljs-string">&quot;&lt;h1&gt;Hello Gee&lt;/h1&gt;&quot;</span>)<br>&#125;)<br>r.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> &#123;<br><span class="hljs-comment">// expect /hello?name=aaa</span><br>c.String(http.StatusOK, <span class="hljs-string">&quot;hello %s, you&#x27;re at %s\n&quot;</span>, c.Query(<span class="hljs-string">&quot;name&quot;</span>), c.Path)<br>&#125;)<br><br>r.POST(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> &#123;<br>c.JSON(http.StatusOK, gee.H&#123;<br><span class="hljs-string">&quot;username&quot;</span>: c.PostForm(<span class="hljs-string">&quot;username&quot;</span>),<br><span class="hljs-string">&quot;password&quot;</span>: c.PostForm(<span class="hljs-string">&quot;password&quot;</span>),<br>&#125;)<br>&#125;)<br><br>r.RUN(<span class="hljs-string">&quot;:9999&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ğŸ˜¥day3-é€šè¿‡å‰ç¼€æ ‘æ¥åŠ¨æ€è·¯ç”±"><a href="#ğŸ˜¥day3-é€šè¿‡å‰ç¼€æ ‘æ¥åŠ¨æ€è·¯ç”±" class="headerlink" title="ğŸ˜¥day3-é€šè¿‡å‰ç¼€æ ‘æ¥åŠ¨æ€è·¯ç”±"></a>ğŸ˜¥day3-é€šè¿‡å‰ç¼€æ ‘æ¥åŠ¨æ€è·¯ç”±</h2><p>contextï¼šæ·»åŠ Paramsæ¥ä¿å­˜è¯·æ±‚å‚æ•°ï¼ŒParam(key)æ–¹æ³•æ¥è·å–è¯·æ±‚å‚æ•°</p><p>trieï¼šå­—å…¸æ ‘ï¼Œå®ç°åŠ¨æ€è·¯ç”±ï¼Œä¸»è¦æ˜¯ç”¨æ¥è§£æè·¯å¾„å‚æ•°</p><p>routerï¼šåœ¨ä¹‹å‰æ’å…¥router[string]HandlerFuncçš„åŒæ—¶éœ€è¦æ’å…¥åˆ°å‰ç¼€æ ‘ä¸­</p><p>router</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span><br><br><span class="hljs-keyword">type</span> router <span class="hljs-keyword">struct</span> &#123;<br>roots    <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*node<br>handlers <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRouter</span><span class="hljs-params">()</span></span> *router &#123;<br><span class="hljs-keyword">return</span> &amp;router&#123;<br>roots:    <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*node),<br>handlers: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc),<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// è§£æè¯·æ±‚è·¯å¾„</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parsePattern</span><span class="hljs-params">(pattern <span class="hljs-type">string</span>)</span></span> []<span class="hljs-type">string</span> &#123;<br>vs := strings.Split(pattern, <span class="hljs-string">&quot;/&quot;</span>)<br><br>parts := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> vs &#123;<br><span class="hljs-keyword">if</span> item != <span class="hljs-string">&quot;&quot;</span> &#123;<br>parts = <span class="hljs-built_in">append</span>(parts, item)<br><span class="hljs-keyword">if</span> item[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;*&#x27;</span> &#123;<br><span class="hljs-keyword">break</span><br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> parts<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> addRoute(method <span class="hljs-type">string</span>, pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>parts := parsePattern(pattern)<br><br>key := method + <span class="hljs-string">&quot;-&quot;</span> + pattern<br>_, ok := r.roots[method]<br><span class="hljs-keyword">if</span> !ok &#123;<br>r.roots[method] = &amp;node&#123;&#125;<br>&#125;<br>r.roots[method].insert(pattern, parts, <span class="hljs-number">0</span>)<br>r.handlers[key] = handler<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> getRoute(method <span class="hljs-type">string</span>, path <span class="hljs-type">string</span>) (*node, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>) &#123;<br>searchParts := parsePattern(path)<br><span class="hljs-comment">// å‚æ•°åˆ—è¡¨</span><br>params := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)<br><br>root, ok := r.roots[method]<br><span class="hljs-keyword">if</span> !ok &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span><br>&#125;<br><br>n := root.search(searchParts, <span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">if</span> n != <span class="hljs-literal">nil</span> &#123;<br>parts := parsePattern(n.pattern)<br><span class="hljs-keyword">for</span> index, part := <span class="hljs-keyword">range</span> parts &#123;<br><span class="hljs-comment">// /p/go/docåŒ¹é…åˆ°/p/:lang/docï¼Œè§£æç»“æœä¸ºï¼š&#123;lang: &quot;go&quot;&#125;ï¼Œ</span><br><span class="hljs-keyword">if</span> part[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;:&#x27;</span> &#123;<br>params[part[<span class="hljs-number">1</span>:]] = searchParts[index]<br>&#125;<br><span class="hljs-comment">// /static/css/aaa.cssåŒ¹é…åˆ°/static/*filepathï¼Œ è§£æç»“æœä¸º&#123;filepath: &quot;css/aaa.css&quot;&#125;ã€‚</span><br><span class="hljs-keyword">if</span> part[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;*&#x27;</span> &amp;&amp; <span class="hljs-built_in">len</span>(part) &gt; <span class="hljs-number">1</span> &#123;<br>params[part[<span class="hljs-number">1</span>:]] = strings.Join(searchParts[index:], <span class="hljs-string">&quot;/&quot;</span>)<br><span class="hljs-keyword">break</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> n, params<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> handle(c *Context) &#123;<br>n, params := r.getRoute(c.Method, c.Path)<br><span class="hljs-keyword">if</span> n != <span class="hljs-literal">nil</span> &#123;<br>c.Params = params<br>key := c.Method + <span class="hljs-string">&quot;-&quot;</span> + n.pattern<br>r.handlers[key](c)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>c.String(http.StatusNotFound, <span class="hljs-string">&quot;404 NOT FOUND: %s\n&quot;</span>, c.Path)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>context</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> H <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;<br><br><span class="hljs-comment">// Context ä¸Šä¸‹æ–‡</span><br><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> &#123;<br><span class="hljs-comment">// origin objects</span><br>Writer http.ResponseWriter<br>Req    *http.Request<br><span class="hljs-comment">// request info</span><br>Path   <span class="hljs-type">string</span><br>Method <span class="hljs-type">string</span><br>Params <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span><br><span class="hljs-comment">// response info</span><br>StatusCode <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newContext</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> *Context &#123;<br><span class="hljs-keyword">return</span> &amp;Context&#123;<br>Writer: w,<br>Req:    req,<br>Path:   req.URL.Path,<br>Method: req.Method,<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// æ·»åŠ è¿™ä¸ªæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Param(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>value, _ := c.Params[key]<br><span class="hljs-keyword">return</span> value<br>&#125;<br><br></code></pre></td></tr></table></figure><p>trie</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å­—å…¸æ ‘</span><br><span class="hljs-keyword">type</span> node <span class="hljs-keyword">struct</span> &#123;<br>pattern  <span class="hljs-type">string</span>  <span class="hljs-comment">// å¾…åŒ¹é…è·¯ç”±</span><br>part     <span class="hljs-type">string</span>  <span class="hljs-comment">// è·¯ç”±ä¸­çš„ä¸€éƒ¨åˆ†</span><br>children []*node <span class="hljs-comment">// å­èŠ‚ç‚¹</span><br>isWild   <span class="hljs-type">bool</span>    <span class="hljs-comment">// æ˜¯å¦ç²¾ç¡®åŒ¹é…</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *node)</span></span> matchChild(part <span class="hljs-type">string</span>) *node &#123;<br><span class="hljs-keyword">for</span> _, child := <span class="hljs-keyword">range</span> n.children &#123;<br><span class="hljs-keyword">if</span> child.part == part || child.isWild &#123;<br><span class="hljs-keyword">return</span> child<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *node)</span></span> matchChildren(part <span class="hljs-type">string</span>) []*node &#123;<br>nodes := <span class="hljs-built_in">make</span>([]*node, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> _, child := <span class="hljs-keyword">range</span> n.children &#123;<br><span class="hljs-keyword">if</span> child.part == part || child.isWild &#123;<br>nodes = <span class="hljs-built_in">append</span>(nodes, child)<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> nodes<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *node)</span></span> insert(pattern <span class="hljs-type">string</span>, parts []<span class="hljs-type">string</span>, height <span class="hljs-type">int</span>) &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) == height &#123;<br>n.pattern = pattern<br><span class="hljs-keyword">return</span><br>&#125;<br><br>part := parts[height]<br>child := n.matchChild(part)<br><span class="hljs-keyword">if</span> child == <span class="hljs-literal">nil</span> &#123;<br>child = &amp;node&#123;part: part, isWild: part[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;:&#x27;</span> || part[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;*&#x27;</span>&#125;<br>n.children = <span class="hljs-built_in">append</span>(n.children, child)<br>&#125;<br>child.insert(pattern, parts, height+<span class="hljs-number">1</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(n *node)</span></span> search(parts []<span class="hljs-type">string</span>, height <span class="hljs-type">int</span>) *node &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) == height || strings.HasPrefix(n.part, <span class="hljs-string">&quot;*&quot;</span>) &#123;<br><span class="hljs-keyword">if</span> n.pattern == <span class="hljs-string">&quot;&quot;</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><span class="hljs-keyword">return</span> n<br>&#125;<br><br>part := parts[height]<br>children := n.matchChildren(part)<br><br><span class="hljs-keyword">for</span> _, child := <span class="hljs-keyword">range</span> children &#123;<br>res := child.search(parts, height+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> res != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> res<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ğŸ˜day4-è·¯ç”±ç»„"><a href="#ğŸ˜day4-è·¯ç”±ç»„" class="headerlink" title="ğŸ˜day4-è·¯ç”±ç»„"></a>ğŸ˜day4-è·¯ç”±ç»„</h2><p>RouterGroupï¼šä¿å­˜å½“å‰è·¯ç”±çš„ä¸­é—´ä»¶å’Œè·¯ç”±è·¯å¾„ï¼Œä¸­é—´ä»¶ä¼šä½œç”¨äºå½“å‰è·¯ç”±åŠå­è·¯ç”±</p><p>gee</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// RouterGroup è·¯ç”±ç»„</span><br><span class="hljs-keyword">type</span> RouterGroup <span class="hljs-keyword">struct</span> &#123;<br>    prefix      <span class="hljs-type">string</span><br>    middlewares []HandlerFunc <span class="hljs-comment">// ä¸­é—´ä»¶æ€»ç”¨äºå½“å‰ç»„åŠå­ç»„</span><br>    engine      *Engine<br>&#125;<br><br><span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> &#123;<br>    *RouterGroup<br>    router *router<br>    groups []*RouterGroup<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span></span> *Engine &#123;<br>    engine := &amp;Engine&#123;router: newRouter()&#125;<br>    engine.RouterGroup = &amp;RouterGroup&#123;engine: engine&#125;<br>    engine.groups = []*RouterGroup&#123;engine.RouterGroup&#125;<br>    <span class="hljs-keyword">return</span> engine<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> Group(prefix <span class="hljs-type">string</span>) *RouterGroup &#123;<br>    engine := group.engine<br>    newGroup := &amp;RouterGroup&#123;<br>        prefix: group.prefix + prefix,<br>        engine: engine,<br>    &#125;<br>    engine.groups = <span class="hljs-built_in">append</span>(engine.groups, newGroup)<br>    <span class="hljs-keyword">return</span> newGroup<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> addRoute(method <span class="hljs-type">string</span>, comp <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    pattern := group.prefix + comp<br>    log.Printf(<span class="hljs-string">&quot;Route %4s - %s&quot;</span>, method, pattern)<br>    group.engine.router.addRoute(method, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> GET(pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    group.addRoute(<span class="hljs-string">&quot;GET&quot;</span>, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> POST(pattern <span class="hljs-type">string</span>, handler HandlerFunc) &#123;<br>    group.addRoute(<span class="hljs-string">&quot;POST&quot;</span>, pattern, handler)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> RUN(addr <span class="hljs-type">string</span>) (err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">return</span> http.ListenAndServe(addr, engine)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;<br>    c := newContext(w, req)<br>    engine.router.handle(c)<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="day5-ä¸­é—´ä»¶"><a href="#day5-ä¸­é—´ä»¶" class="headerlink" title="day5-ä¸­é—´ä»¶"></a>day5-ä¸­é—´ä»¶</h2><p>ä¸­é—´ä»¶ï¼šéä¸šåŠ¡çš„æŠ€æœ¯ç±»ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ç»„ä»¶ç­‰ï¼Œå¯ä»¥åœ¨Contextåˆå§‹åŒ–å®Œåæˆ–Handleræ‰§è¡Œå®Œåè¢«è°ƒç”¨ï¼Œæ¥æ‰§è¡Œä¸€äº›æ“ä½œ</p><p>æŠŠä¸­é—´ä»¶ä¿å­˜åœ¨Contextçš„[]handlersä¸­ï¼Œå‡è®¾å¤„ç†è¯·æ±‚æ–¹æ³•ä¸ºhandlerï¼Œä¸­é—´ä»¶æœ‰midAã€midBï¼Œå­˜å‚¨é¡ºåºä¸º[midAã€handlerã€midB]ï¼Œåˆ™å¯å®ç°ä¸­é—´ä»¶æ“ä½œ</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gin</title>
    <link href="/2023/10/22/%E5%85%B6%E4%BB%96/go/Gin/"/>
    <url>/2023/10/22/%E5%85%B6%E4%BB%96/go/Gin/</url>
    
    <content type="html"><![CDATA[<h2 id="Gin"><a href="#Gin" class="headerlink" title="Gin"></a>Gin</h2><blockquote><p>Webæ¡†æ¶ï¼Œå°è£…æ¯”è¾ƒä¼˜é›…ï¼ŒAPIå‹å¥½ã€‚å…·æœ‰å¿«é€Ÿçµæ´»ï¼Œå®¹é”™æ–¹ä¾¿ç­‰ç‰¹ç‚¹</p></blockquote><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">go get -u github.com/gin-gonic/gin<br></code></pre></td></tr></table></figure><p><strong>hello world</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åˆ›å»ºè·¯ç”±</span><br>ginServer := gin.Default()<br><br><span class="hljs-comment">// è®¿é—®åœ°å€</span><br>    <span class="hljs-comment">// gin.Contextï¼Œå°è£…äº†requestå’Œresponse</span><br>ginServer.GET(<span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(context *gin.Context)</span></span> &#123;<br>context.JSON(<span class="hljs-number">200</span>, gin.H&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;hello&quot;</span>&#125;)<br>&#125;)<br><br><span class="hljs-comment">// å¯åŠ¨æœåŠ¡</span><br>err := ginServer.Run(<span class="hljs-string">&quot;:8082&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å“åº”é¡µé¢"><a href="#å“åº”é¡µé¢" class="headerlink" title="å“åº”é¡µé¢"></a>å“åº”é¡µé¢</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºè·¯ç”±</span><br>    ginServer := gin.Default()<br><br>    <span class="hljs-comment">// åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹templatesåŠé¡µé¢index.html</span><br>    <span class="hljs-comment">// åŠ è½½é™æ€é¡µé¢</span><br>    ginServer.LoadHTMLGlob(<span class="hljs-string">&quot;templates/*&quot;</span>)<br><br>    <span class="hljs-comment">// è®¿é—®åœ°å€</span><br>    ginServer.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(context *gin.Context)</span></span> &#123;<br>        context.HTML(http.StatusOK, <span class="hljs-string">&quot;index.html&quot;</span>, gin.H&#123;<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½&quot;</span>&#125;)<br>    &#125;)<br><br>    <span class="hljs-comment">// å¯åŠ¨æœåŠ¡</span><br>    err := ginServer.Run(<span class="hljs-string">&quot;:8082&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è·å–è¯·æ±‚å‚æ•°"><a href="#è·å–è¯·æ±‚å‚æ•°" class="headerlink" title="è·å–è¯·æ±‚å‚æ•°"></a>è·å–è¯·æ±‚å‚æ•°</h3><p>è·¯å¾„å‚æ•°<code>c.Param()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user/:name/*action&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>    name := c.Param(<span class="hljs-string">&quot;name&quot;</span>)<br>    action := c.Param(<span class="hljs-string">&quot;action&quot;</span>)<br>    <span class="hljs-comment">//æˆªå–/</span><br>    action = strings.Trim(action, <span class="hljs-string">&quot;/&quot;</span>)<br>    c.String(http.StatusOK, name+<span class="hljs-string">&quot; is &quot;</span>+action)<br>&#125;)<br></code></pre></td></tr></table></figure><p>URLå‚æ•°<code>c.Query()/DefaultQuery()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">r.GET(<span class="hljs-string">&quot;/user&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>    <span class="hljs-comment">//DefaultQueryæŒ‡å®šé»˜è®¤å€¼</span><br>    <span class="hljs-comment">//http://localhost:8080/user æ‰ä¼šæ‰“å°å‡ºæ¥é»˜è®¤çš„å€¼</span><br>    name := c.DefaultQuery(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;æ¯è—¤&quot;</span>)<br>    c.String(http.StatusOK, fmt.Sprintf(<span class="hljs-string">&quot;hello %s&quot;</span>, name))<br>&#125;)<br></code></pre></td></tr></table></figure><p>è¡¨å•å‚æ•°<code>c.PostForm()/DefaultPostForm()</code></p><p>è¡¨å•æ ¼å¼å¸¸è§æœ‰ï¼š</p><ul><li>application&#x2F;json jsonæ ¼å¼</li><li>application&#x2F;x-www-form-urlencoded             è¡¨å•</li><li>application&#x2F;xml                     xml</li><li>multipart&#x2F;form-data               æ–‡ä»¶</li></ul><p>æ–‡ä»¶<code>c.FormFile()</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//é™åˆ¶ä¸Šä¼ æœ€å¤§å°ºå¯¸</span><br>r.MaxMultipartMemory = <span class="hljs-number">8</span> &lt;&lt; <span class="hljs-number">20</span><br>r.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>    file, err := c.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        c.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;ä¸Šä¼ å›¾ç‰‡å‡ºé”™&quot;</span>)<br>    &#125;<br>    <span class="hljs-comment">// c.JSON(200, gin.H&#123;&quot;message&quot;: file.Header.Context&#125;)</span><br>    c.SaveUploadedFile(file, file.Filename)<br>    c.String(http.StatusOK, file.Filename)<br>&#125;)<br></code></pre></td></tr></table></figure><p>æå–è¯·æ±‚è·¯å¾„çš„å…¬å…±å¤´éƒ¨åˆ†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">v1 := r.Group(<span class="hljs-string">&quot;/v1&quot;</span>)<br><span class="hljs-comment">// &#123;&#125; æ˜¯ä¹¦å†™è§„èŒƒ</span><br>&#123;<br>    v1.GET(<span class="hljs-string">&quot;/login&quot;</span>, login)<br>    v1.GET(<span class="hljs-string">&quot;submit&quot;</span>, submit)<br>&#125;<br><br><span class="hljs-comment">// è¯·æ±‚è·¯å¾„/v1/login</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç½‘</title>
    <link href="/2023/10/09/%E5%85%B6%E4%BB%96/%E8%AE%A1%E7%BD%91/"/>
    <url>/2023/10/09/%E5%85%B6%E4%BB%96/%E8%AE%A1%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç½‘"><a href="#è®¡ç½‘" class="headerlink" title="è®¡ç½‘"></a>è®¡ç½‘</h1><h2 id="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</h2><p>å»ºç«‹TCPè¿æ¥æ—¶ä¸‰æ¬¡æŒ¥æ‰‹ï¼š</p><ol><li>å®¢æˆ·ç«¯                     SYNâ€”&gt;                        æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯                     &lt;â€”SYN-ACK                æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯                     ACKâ€”&gt;                        æœåŠ¡å™¨</li></ol><p>ç»ˆæ­¢TCPè¿æ¥æ—¶å››æ¬¡æŒ¥æ‰‹ï¼š</p><ol><li>å®¢æˆ·ç«¯                     FINâ€”&gt;                        æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯                     &lt;â€”ACK                       æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯                     &lt;â€”FIN                        æœåŠ¡å™¨</li><li>å®¢æˆ·ç«¯                     ACKâ€”&gt;                       æœåŠ¡å™¨</li></ol><ul><li>SYN(Synchronize)ï¼šè¯·æ±‚æŠ¥æ–‡</li><li>SYN-ACK(Synchronize-Acknowledge)ï¼šç¡®è®¤æŠ¥æ–‡</li><li>FIN(Finish)ï¼šé‡Šæ”¾è¯·æ±‚æŠ¥æ–‡</li></ul><p><strong>ä¸ºä»€ä¹ˆä¸‰æ¬¡æŒ¥æ‰‹ï¼Ÿ</strong></p><p>ä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç¡®è®¤è‡ªå·±è¿”é€å’Œæ¥æ”¶éƒ½æ­£å¸¸</p><p>å¦‚æœæœ‰æ»ç•™çš„SYNè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç¬¬äºŒæ¬¡æ¡æ‰‹æ—¶ä¸ä¼šæ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°æœåŠ¡å™¨ç©ºç­‰å®¢æˆ·ç«¯çš„æƒ…å†µ</p><p><strong>ä¸ºä»€ä¹ˆå››æ¬¡æŒ¥æ‰‹ï¼Ÿ</strong></p><p>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹è¡¨ç¤ºå®¢æˆ·ç«¯ä¸å†å‘é€æ¶ˆæ¯</p><p>ç¬¬äºŒæ¬¡æŒ¥æ‰‹è¡¨ç¤ºæœåŠ¡å™¨åŒæ„å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼ŒæœåŠ¡å™¨è¿˜èƒ½æŠŠæ²¡å‘å®Œçš„æ•°æ®ç»§ç»­å‘ç»™å®¢æˆ·ç«¯</p><p>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹è¡¨ç¤ºæœåŠ¡å™¨å‘é€å®Œæ•°æ®è¦å…³é—­è¿æ¥äº†</p><p>ç¬¬å››æ¬¡æŒ¥æ‰‹è¡¨ç¤ºå®¢æˆ·ç«¯ç¡®è®¤å…³é—­</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaä»£ç†</title>
    <link href="/2023/10/08/java/java%E4%BB%A3%E7%90%86/"/>
    <url>/2023/10/08/java/java%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="javaä»£ç†"><a href="#javaä»£ç†" class="headerlink" title="javaä»£ç†"></a>javaä»£ç†</h2><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><p>ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶çœŸå®å¯¹è±¡çš„è®¿é—®</p><p>ä»£ç†æ¨¡å¼ä¸­çš„è§’è‰²ï¼š</p><ul><li>Subjectï¼šæ¥å£ï¼Œå®šä¹‰äº†è¢«ä»£ç†çš„æ–¹æ³•</li><li>RealSubjectï¼šè¢«ä»£ç†å¯¹è±¡</li><li>Proxyï¼šä»£ç†å¯¹è±¡</li></ul><h3 id="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†"><a href="#é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†"></a>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</h3><h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h4><ul><li>é™æ€ä»£ç†åœ¨ä»£ç è¿è¡Œå‰å·²ç»ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå³è¿è¡Œå‰å·²ç»ç¡®è®¤ä»£ç†å’Œè¢«ä»£ç†å¯¹è±¡é—´çš„å…³ç³»ï¼›</li><li>åŠ¨æ€ä»£ç†åœ¨ä»£ç è¿è¡Œåé€šè¿‡åå°„åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶</li></ul><h4 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h4><p>ä»£ç†å¯¹è±¡å°†è¢«ä»£ç†å¯¹è±¡ä½œä¸ºæˆå‘˜å¯¹è±¡æ¥è¿›è¡Œä»£ç†</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä»£ç ä¸ä¾µå…¥ä»£ç†å¯¹è±¡</li><li>ç®€å•</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªä»£ç†ç±»ä»£ç†å¤šä¸ªç›®æ ‡ï¼Œä»£ç†ç±»çš„ä»£ç ä¼šå˜å¾—éå¸¸å¤æ‚</li><li>å¦‚æœä¸€ä¸ªä»£ç†ç±»ä»£ç†ä¸€ä¸ªç›®æ ‡ï¼Œä¼šåˆ›å»ºè¿‡å¤šä»£ç†ç±»</li><li>ä¿®æ”¹è¢«ä»£ç†ç±»çš„æ–¹æ³•æ—¶è¦åŒæ—¶ä¿®æ”¹ä»£ç†ç±»</li></ul><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>åŠ¨æ€ä»£ç†å°±æ˜¯æ ¹æ®æ¥å£æˆ–ç›®æ ‡å¯¹è±¡ï¼Œè®¡ç®—å‡ºä»£ç†ç±»çš„å­—èŠ‚ç ï¼Œç„¶åå†åŠ è½½åˆ°JVMä¸­ä½¿ç”¨</p><p>å¸¸è§åŠ¨æ€ä»£ç†å®ç°æ–¹å¼ï¼š</p><ul><li>JDKåŠ¨æ€ä»£ç†</li><li>CGLIBåŠ¨æ€ä»£ç†</li></ul><p><strong>JDKåŠ¨æ€ä»£ç†</strong></p><p>æ ¹æ®æ¥å£åˆ›å»ºä»£ç†ç±»</p><p>ç”¨<code>java.lang.reflect.InvocationHandler</code>å®šä¹‰ä»£ç†ç±»è¦æ‰§è¡Œçš„æ“ä½œ</p><p>ç”¨<code>java.lang.reflect.Proxy</code>åˆ›å»ºä»£ç†å¯¹è±¡</p><p>ä»£ç†å¯¹è±¡é€šè¿‡åå°„è·å–æ–¹æ³•ï¼Œç„¶åäº¤ç»™<code>InvocationHandler</code>æ¥æ‰§è¡Œå…·ä½“çš„ä»£ç†é€»è¾‘</p><p><strong>CGLIBåŠ¨æ€ä»£ç†</strong></p><p>é€šè¿‡ç»§æ‰¿åˆ›å»ºä»£ç†ç±»</p><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦é¢å¤–å¼•å…¥CGLIBåŒ…</li><li>åªèƒ½ä»£ç†éfinalçš„publicæ–¹æ³•</li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>goå¤šçº¿ç¨‹</title>
    <link href="/2023/09/24/%E5%85%B6%E4%BB%96/go/go%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <url>/2023/09/24/%E5%85%B6%E4%BB%96/go/go%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="goå¤šçº¿ç¨‹"><a href="#goå¤šçº¿ç¨‹" class="headerlink" title="goå¤šçº¿ç¨‹"></a>goå¤šçº¿ç¨‹</h2><p>goè¯­è¨€ä¸­ä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜é€šä¿¡ï¼Œè€Œæ˜¯<strong>é€šè¿‡é€šä¿¡å…±äº«å†…å­˜</strong></p><h3 id="åç¨‹goroutine"><a href="#åç¨‹goroutine" class="headerlink" title="åç¨‹goroutine"></a>åç¨‹goroutine</h3><p>goroutineï¼Œå³è½»é‡çº§çº¿ç¨‹ï¼Œåˆ›å»ºGoroutineçš„æˆæœ¬å¾ˆå°ï¼Œå®ƒå°±æ˜¯ä¸€æ®µä»£ç ï¼Œä¸€ä¸ªå‡½æ•°å…¥å£ã€‚ä»¥åŠåœ¨å †ä¸Šä¸ºå…¶åˆ†é…çš„ä¸€ä¸ªå †æ ˆï¼ˆåˆå§‹å¤§å°ä¸º4Kï¼Œä¼šéšç€ç¨‹åºçš„æ‰§è¡Œè‡ªåŠ¨å¢é•¿åˆ é™¤ï¼‰ã€‚å› æ­¤å®ƒéå¸¸å»‰ä»·ï¼ŒGoåº”ç”¨ç¨‹åºå¯ä»¥å¹¶å‘è¿è¡Œæ•°åƒä¸ªGoroutinesã€‚</p><p>æ¡ˆä¾‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// é€šè¿‡åç¨‹åŒæ—¶æ‰§è¡Œå¤šä¸ªæ–¹æ³•</span><br>start := time.Now()<br><br>apis := []<span class="hljs-type">string</span>&#123;<br><span class="hljs-string">&quot;https://management.azure.com&quot;</span>,<br><span class="hljs-string">&quot;https://dev.azure.com&quot;</span>,<br><span class="hljs-string">&quot;https://api.github.com&quot;</span>,<br><span class="hljs-string">&quot;https://outlook.office.com/&quot;</span>,<br><span class="hljs-string">&quot;https://api.somewhereintheinternet.com/&quot;</span>,<br><span class="hljs-string">&quot;https://graph.microsoft.com&quot;</span>,<br>&#125;<br><span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis &#123;<br><span class="hljs-keyword">go</span> checkAPI(api) <span class="hljs-comment">// æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªåç¨‹</span><br>&#125;<br>time.Sleep(<span class="hljs-number">3</span> * time.Second) <br><br>elapsed := time.Since(start)<br>fmt.Printf(<span class="hljs-string">&quot;Done! It took %v seconds!\n&quot;</span>, elapsed.Seconds())<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkAPI</span><span class="hljs-params">(api <span class="hljs-type">string</span>)</span></span> &#123;<br>_, err := http.Get(api)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;ERROR: %s is down!\n&quot;</span>, api)<br><span class="hljs-keyword">return</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;SUCCESS: %s is up and running!\n&quot;</span>, api)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åç¨‹é€šä¿¡channel"><a href="#åç¨‹é€šä¿¡channel" class="headerlink" title="åç¨‹é€šä¿¡channel"></a>åç¨‹é€šä¿¡channel</h3><p>ä½¿ç”¨ç®¡é“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ›å»ºäº†å¯ä»¥ä¼ é€’intç±»å‹æ•°æ®çš„ç®¡é“</span><br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br><br>ch &lt;- x<span class="hljs-comment">// å‘é€æ•°æ®åˆ°ç®¡é“</span><br>x = &lt;-ch<span class="hljs-comment">// ä»ç®¡é“æ¥æ”¶æ•°æ®</span><br>&lt;-ch<span class="hljs-comment">// è¯»å–ä½†ä¸æ¥æ”¶æ•°æ®</span><br><br><span class="hljs-comment">// å…³é—­ç®¡é“</span><br><span class="hljs-built_in">close</span>(ch)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">send</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">string</span>)</span></span>&#123;&#125;<span class="hljs-comment">// åªå†™ç®¡é“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">read</span><span class="hljs-params">(ch &lt;-<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)</span></span>&#123;&#125;<span class="hljs-comment">// åªè¯»ç®¡é“</span><br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹1ï¼šæ— ç¼“å†²channel</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>start := time.Now()<br><br>apis := []<span class="hljs-type">string</span>&#123;<br><span class="hljs-string">&quot;https://management.azure.com&quot;</span>,<br><span class="hljs-string">&quot;https://dev.azure.com&quot;</span>,<br><span class="hljs-string">&quot;https://api.github.com&quot;</span>,<br><span class="hljs-string">&quot;https://outlook.office.com/&quot;</span>,<br><span class="hljs-string">&quot;https://api.somewhereintheinternet.com/&quot;</span>,<br><span class="hljs-string">&quot;https://graph.microsoft.com&quot;</span>,<br>&#125;<br><br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<span class="hljs-comment">// åˆ›å»ºç®¡é“</span><br><span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis &#123;<br><span class="hljs-keyword">go</span> checkAPI(api, ch) <span class="hljs-comment">// æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªåç¨‹</span><br>&#125;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(apis); i++ &#123;<br>fmt.Print(&lt;-ch) <span class="hljs-comment">// ä¼šé˜»å¡ç­‰å¾…</span><br>&#125;<br><br>elapsed := time.Since(start)<br>fmt.Printf(<span class="hljs-string">&quot;Done! It took %v seconds!\n&quot;</span>, elapsed.Seconds())<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">checkAPI</span><span class="hljs-params">(api <span class="hljs-type">string</span>, ch <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)</span></span> &#123;<br>_, err := http.Get(api)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>ch &lt;- fmt.Sprintf(<span class="hljs-string">&quot;ERROR: %s is down!\n&quot;</span>, api)<br><span class="hljs-keyword">return</span><br>&#125;<br>ch &lt;- fmt.Sprintf(<span class="hljs-string">&quot;SUCCESS: %s is up and running!\n&quot;</span>, api)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹2ï¼šæœ‰ç¼“å†²channel</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å¯ä»¥å­˜10æ¡æ•°æ®çš„ç®¡é“</span><br><span class="hljs-comment">// å¾€æ»¡äº†çš„ç®¡é“é‡Œå‘é€æ•°æ®ä¼šé˜»å¡</span><br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>, <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p><strong>åŒºåˆ«</strong></p><p>æ— ç¼“å†²çš„channelåœ¨å‘é€æ•°æ®æ—¶ï¼Œå‘é€è€…ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰æ¥æ”¶è€…æ¥æ”¶æ•°æ®ã€‚</p><p>æœ‰ç¼“å†²çš„channelåˆ™å½“ç¼“å†²åŒºæœªæ»¡çš„æ—¶å€™ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ</p><h3 id="å¤šè·¯å¤ç”¨select"><a href="#å¤šè·¯å¤ç”¨select" class="headerlink" title="å¤šè·¯å¤ç”¨select"></a>å¤šè·¯å¤ç”¨select</h3><p>è¯­æ³•å’Œswitchç±»ä¼¼ï¼Œä½œç”¨æ˜¯å½“caseåé¢çš„å¯¹ç®¡é“çš„æ“ä½œæ‰§è¡ŒæˆåŠŸåï¼Œä¼šæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">process</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)</span></span> &#123;<br>    time.Sleep(<span class="hljs-number">3</span> * time.Second)<br>    ch &lt;- <span class="hljs-string">&quot;Done processing!&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">replicate</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)</span></span> &#123;<br>    time.Sleep(<span class="hljs-number">1</span> * time.Second)<br>    ch &lt;- <span class="hljs-string">&quot;Done replicating!&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<br>    ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<br>    <span class="hljs-keyword">go</span> process(ch1)<br>    <span class="hljs-keyword">go</span> replicate(ch2)<br><br>    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++ &#123;<br>        <span class="hljs-keyword">select</span> &#123;<br>        <span class="hljs-keyword">case</span> process := &lt;-ch1:<br>            fmt.Println(process)<br>        <span class="hljs-keyword">case</span> replicate := &lt;-ch2:<br>            fmt.Println(replicate)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>go</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaæ–‡ä»¶IO</title>
    <link href="/2023/08/31/java/Java%E6%96%87%E4%BB%B6IO/"/>
    <url>/2023/08/31/java/Java%E6%96%87%E4%BB%B6IO/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaæ–‡ä»¶IO"><a href="#Javaæ–‡ä»¶IO" class="headerlink" title="Javaæ–‡ä»¶IO"></a>Javaæ–‡ä»¶IO</h1><h2 id="æŒ‰å­—ç¬¦è¯»å†™Readerã€Writer"><a href="#æŒ‰å­—ç¬¦è¯»å†™Readerã€Writer" class="headerlink" title="æŒ‰å­—ç¬¦è¯»å†™Readerã€Writer"></a>æŒ‰å­—ç¬¦è¯»å†™Readerã€Writer</h2><p>FileWriteã€FileReader</p><p><code>FileWriter writer = new FileWriter(file, true)</code>ä¸ºè¿½åŠ å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\aaa.txt&quot;</span>;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir);<br>    <span class="hljs-comment">//å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (!file.exists())<br>        file.createNewFile();<br>    <span class="hljs-comment">//åˆ›å»ºFileWriterå¯¹è±¡</span><br>    <span class="hljs-type">FileWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(file);<br>    <span class="hljs-comment">//å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹</span><br>    writer.write(<span class="hljs-string">&quot;aaa&quot;</span>);<br>    writer.flush();<br>    writer.close();<br><br>    <span class="hljs-comment">//åˆ›å»ºFileReaderå¯¹è±¡ï¼Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹</span><br>    <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(file);<br>    <span class="hljs-type">char</span>[] ch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">100</span>];<br>    reader.read(ch);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : ch) &#123;<br>        System.out.print(c);<br>    &#125;<br>    System.out.println();<br>    reader.close();<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å¥—ä¸€å±‚BufferedWriteã€BufferedReaderï¼Œå¯ä»¥ä¸€è¡Œè¡Œæ¥è¯»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\aaa.txt&quot;</span>;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir);<br>    <span class="hljs-comment">//å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (!file.exists())<br>        file.createNewFile();<br>    <span class="hljs-comment">//åˆ›å»ºBufferedWriterå¯¹è±¡</span><br>    <span class="hljs-type">BufferedWriter</span> <span class="hljs-variable">bw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(file));<br>    <span class="hljs-comment">//å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹</span><br>    bw.write(<span class="hljs-string">&quot;aaa&quot;</span>);<br>    bw.flush();<br>    bw.close();<br><br>    <span class="hljs-comment">//åˆ›å»ºBufferedReaderå¯¹è±¡ï¼Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹</span><br>    <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(file));<br>    String line;<br>    <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>        System.out.println(line);<br>    &#125;<br>    System.out.println();<br>    br.close();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æŒ‰å­—èŠ‚è¯»å†™InputStreamã€OutputStream"><a href="#æŒ‰å­—èŠ‚è¯»å†™InputStreamã€OutputStream" class="headerlink" title="æŒ‰å­—èŠ‚è¯»å†™InputStreamã€OutputStream"></a>æŒ‰å­—èŠ‚è¯»å†™InputStreamã€OutputStream</h2><p>FileOutputStreamã€FileInputStream</p><p><code>FileOutputStream fos = new FileOutputStream(file, true)</code>ä¸ºè¿½åŠ å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\aaa.txt&quot;</span>;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(dir);<br>    <span class="hljs-comment">//å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–‡ä»¶</span><br>    <span class="hljs-keyword">if</span> (!file.exists())<br>        file.createNewFile();<br>    <span class="hljs-comment">//åˆ›å»ºFileOutputStreamå¯¹è±¡ï¼Œå†™å…¥å†…å®¹</span><br>    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);<br>    <span class="hljs-comment">//å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹</span><br>    fos.write(<span class="hljs-string">&quot;aaa&quot;</span>.getBytes());<br>    fos.close();<br><br>    <span class="hljs-comment">//åˆ›å»ºFileInputStreamå¯¹è±¡ï¼Œè¯»å–æ–‡ä»¶å†…å®¹</span><br>    <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);<br>    <span class="hljs-type">byte</span>[] bys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">100</span>];<br>    <span class="hljs-keyword">while</span> (fis.read(bys, <span class="hljs-number">0</span>, bys.length) != -<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">//å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>        System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bys));<br>    &#125;<br>    fis.close();<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>javaé›†åˆæ¡†æ¶</title>
    <link href="/2023/08/24/java/java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/"/>
    <url>/2023/08/24/java/java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="javaé›†åˆæ¡†æ¶"><a href="#javaé›†åˆæ¡†æ¶" class="headerlink" title="javaé›†åˆæ¡†æ¶"></a>javaé›†åˆæ¡†æ¶</h2><p><img src="/img/java_img/java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6.png" alt="æ•´ä½“çš„ç»§æ‰¿å…³ç³»"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é»‘é©¬å¤´æ¡ç¬”è®°</title>
    <link href="/2023/08/07/%E5%85%B6%E4%BB%96/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/"/>
    <url>/2023/08/07/%E5%85%B6%E4%BB%96/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Appç«¯"><a href="#Appç«¯" class="headerlink" title="Appç«¯"></a>Appç«¯</h1><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>ç”¨æˆ·å¯ä»¥é€‰æ‹©ç™»å½•å’Œä¸ç™»å½•</p><ul><li>ç™»å½•åæœ‰æŸ¥çœ‹å’Œæ“ä½œçš„æƒé™</li><li>ä¸ç™»å½•åªæœ‰æŸ¥çœ‹çš„æƒé™</li></ul><h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="ç”¨æˆ·å¯†ç åŠ å¯†"><a href="#ç”¨æˆ·å¯†ç åŠ å¯†" class="headerlink" title="ç”¨æˆ·å¯†ç åŠ å¯†"></a>ç”¨æˆ·å¯†ç åŠ å¯†</h4><p>æ³¨å†Œæ—¶</p><ol><li>ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œç”Ÿæˆéšæœºçš„ç›å€¼ï¼ŒæŠŠå¯†ç å’Œç›å€¼æ‹¼æ¥åï¼Œç»è¿‡MD5ç”Ÿæˆç§˜é’¥å¹¶ä¿å­˜</li><li>ç›å€¼ä¹Ÿéœ€è¦ä¸€åŒä¿å­˜åˆ°æ•°æ®åº“</li></ol><p>ç™»å½•æ—¶</p><ol><li>æŠŠç”¨æˆ·è¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­ä¿å­˜çš„ç›å€¼è¿›è¡ŒMD5åŠ å¯†ï¼Œç”Ÿæˆçš„ç§˜é’¥å’Œæ•°æ®åº“ä¸­çš„ç§˜é’¥è¿›è¡Œæ¯”å¯¹</li></ol><blockquote><p>MD5ç”Ÿæˆçš„ç§˜é’¥æ˜¯ä¸å¯é€†çš„</p></blockquote><h4 id="æ¥å£æ–‡æ¡£"><a href="#æ¥å£æ–‡æ¡£" class="headerlink" title="æ¥å£æ–‡æ¡£"></a>æ¥å£æ–‡æ¡£</h4><p><strong>swagger</strong></p><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.common.swagger;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfiguration</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">buildDocket</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(buildApiInfo())<br>                .select()<br>                <span class="hljs-comment">// è¦æ‰«æçš„API(Controller)åŸºç¡€åŒ…</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.heima&quot;</span>))<br>                .paths(PathSelectors.any())<br>                .build();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">buildApiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Contact</span> <span class="hljs-variable">contact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;é»‘é©¬å¤´æ¡-å¹³å°ç®¡ç†APIæ–‡æ¡£&quot;</span>)<br>                .description(<span class="hljs-string">&quot;é»‘é©¬å¤´æ¡åå°api&quot;</span>)<br>                .contact(contact)<br>                .version(<span class="hljs-string">&quot;1.0.0&quot;</span>).build();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è®¿é—®</p><p><code>localhost:51801/swagger-ui.html</code></p><p><strong>knife4j</strong></p><p>swaggerå¯¹åº”çš„åŒ…ä¹Ÿè¦å¯¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.common.swagger;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-meta">@EnableKnife4j</span><br><span class="hljs-meta">@Import(BeanValidatorPluginsConfiguration.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Swagger2Configuration</span> &#123;<br><br>    <span class="hljs-meta">@Bean(value = &quot;defaultApi2&quot;)</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">defaultApi2</span><span class="hljs-params">()</span> &#123;<br>        Docket docket=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                <span class="hljs-comment">//åˆ†ç»„åç§°</span><br>                .groupName(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .select()<br>                <span class="hljs-comment">//è¿™é‡ŒæŒ‡å®šControlleræ‰«æåŒ…è·¯å¾„</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.heima&quot;</span>))<br>                .paths(PathSelectors.any())<br>                .build();<br>        <span class="hljs-keyword">return</span> docket;<br>    &#125;<br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;é»‘é©¬å¤´æ¡APIæ–‡æ¡£&quot;</span>)<br>                .description(<span class="hljs-string">&quot;é»‘é©¬å¤´æ¡APIæ–‡æ¡£&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®</p><p><code>localhost:51801/doc.html</code></p><h4 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h4><blockquote><p>æˆæƒã€é™æµã€ç™»å½•ã€æ—¥å¿—ã€è·¨åŸŸ</p></blockquote><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ æœ¬åœ°é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">51601</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">leadnews-app-gateway</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><span class="hljs-string">:8848</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yml</span><br></code></pre></td></tr></table></figure><p>nacosæ·»åŠ é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">globalcors:</span><br>        <span class="hljs-attr">add-to-simple-url-handler-mapping:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">corsConfigurations:</span><br>          <span class="hljs-string">&#x27;[/**]&#x27;</span><span class="hljs-string">:</span><br>            <span class="hljs-attr">allowedHeaders:</span> <span class="hljs-string">&quot;*&quot;</span><br>            <span class="hljs-attr">allowedOrigins:</span> <span class="hljs-string">&quot;*&quot;</span><br>            <span class="hljs-attr">allowedMethods:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">GET</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">POST</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">DELETE</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">PUT</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">OPTION</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-comment"># å¹³å°ç®¡ç†</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://leadnews-user</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>ç½‘å…³çš„è¿‡æ»¤å™¨</strong></p><blockquote><p>å®ç°GlobalFilterå’ŒOrderedæ¥å£</p><p>GlobalFilterçš„filteræ–¹æ³•ä¸ºå…·ä½“çš„è¿‡æ»¤é€»è¾‘</p><p>Orderedä¸ºè®¾ç½®è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.app.gateway.filter;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ¤æ–­æ˜¯å¦ç™»å½•çš„è¿‡æ»¤å™¨ï¼Œæ²¡æœ‰éªŒè¯ç”¨æˆ·èº«ä»½</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorizeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ordered</span>, GlobalFilter &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;<br>        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();<br>        <span class="hljs-type">ServerHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> exchange.getResponse();<br>        <span class="hljs-comment">// è®¿é—®ç™»å½•æ¥å£ï¼Œæ”¾è¡Œ</span><br>        <span class="hljs-keyword">if</span> (request.getURI().getPath().contains(<span class="hljs-string">&quot;/login&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> chain.filter(exchange);<br>        &#125;<br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ç™»å½•</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeaders().getFirst(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-keyword">if</span> (StringUtils.isBlank(token)) &#123;<br>            response.setStatusCode(HttpStatus.UNAUTHORIZED);<br>            <span class="hljs-keyword">return</span> response.setComplete();<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> AppJwtUtil.getClaimsBody(token);<br>            <span class="hljs-comment">// åˆ¤æ–­tokenæ˜¯å¦è¿‡æœŸ</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> AppJwtUtil.verifyToken(claims);<br>            <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span> || result == <span class="hljs-number">2</span>) &#123;<br>                response.setStatusCode(HttpStatus.UNAUTHORIZED);<br>                <span class="hljs-keyword">return</span> response.setComplete();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            response.setStatusCode(HttpStatus.UNAUTHORIZED);<br>            <span class="hljs-keyword">return</span> response.setComplete();<br>        &#125;<br>        <span class="hljs-comment">// æ”¾è¡Œ</span><br>        <span class="hljs-keyword">return</span> chain.filter(exchange);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h4><blockquote><p>åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ï¼Œéƒ¨ç½²å‰ç«¯é¡¹ç›®</p></blockquote><ol><li>é…ç½®nginx.confæ–‡ä»¶</li><li>é€šè¿‡<code>nginx</code>å‘½ä»¤å¯åŠ¨nginx</li></ol><p>åœ¨<code>conf</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹æ¥æ”¾è‡ªå·±ç¼–å†™çš„<code>conf</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs conf"># é…ç½®äº†åå‘ä»£ç†<br>upstream  heima-app-gateway&#123;<br>    server localhost:51601;<br>&#125;<br><br>server &#123;<br>listen 8801;<br>location / &#123;<br>root D:/workspace/app-web/;<br>index index.html;<br>&#125;<br><br>location ~/app/(.*) &#123;<br>proxy_pass http://heima-app-gateway/$1;<br>proxy_set_header HOST $host;  # ä¸æ”¹å˜æºè¯·æ±‚å¤´çš„å€¼<br>proxy_pass_request_body on;  #å¼€å¯è·å–è¯·æ±‚ä½“<br>proxy_pass_request_headers on;  #å¼€å¯è·å–è¯·æ±‚å¤´<br>proxy_set_header X-Real-IP $remote_addr;   # è®°å½•çœŸå®å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯IP<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  #è®°å½•ä»£ç†ä¿¡æ¯<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>conf</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>nginx.conf</code>é‡Œå¯¼å…¥è‡ªå·±ç¼–å†™çš„<code>conf</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs conf"><br>#user  nobody;<br>worker_processes  1;<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    sendfile        on;<br>    keepalive_timeout  65;<br># å¼•å…¥è‡ªå®šä¹‰é…ç½®æ–‡ä»¶<br>include leadnews.conf/*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶<code>nginx -s reload</code>å¹¶é‡å¯</p><h2 id="æŸ¥çœ‹æ–‡ç« "><a href="#æŸ¥çœ‹æ–‡ç« " class="headerlink" title="æŸ¥çœ‹æ–‡ç« "></a>æŸ¥çœ‹æ–‡ç« </h2><h3 id="éœ€æ±‚-1"><a href="#éœ€æ±‚-1" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p><strong>åˆ·æ–°</strong></p><p>ä¸Šæ‹‰åˆ·æ–°ï¼šåŠ è½½æœ€æ–°æ–‡ç« </p><p>ä¸‹æ‹‰åˆ·æ–°ï¼šåŠ è½½æ—©å…ˆçš„æ–‡ç« </p><p> <strong>å±•ç¤ºæ–‡ç« è¯¦æƒ…</strong></p><h3 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="æ‹†åˆ†è¡¨"><a href="#æ‹†åˆ†è¡¨" class="headerlink" title="æ‹†åˆ†è¡¨"></a>æ‹†åˆ†è¡¨</h4><p>ap_articleï¼šæ–‡ç« æ¦‚è¿°</p><p>ap_article_configï¼šæ–‡ç« é…ç½®ï¼ˆæ˜¯å¦åˆ é™¤ç­‰ï¼‰</p><p>ap_article_contentï¼šæ–‡ç« è¯¦æƒ…</p><p>å‚ç›´åˆ†è¡¨ï¼šå°†ä¸€ä¸ªè¡¨çš„å­—æ®µåˆ†æ•£åˆ°å¤šä¸ªè¡¨ä¸­</p><p>å¥½å¤„ï¼š</p><ol><li>å‡å°‘é”è¡¨çš„å‡ ç‡ï¼ŒæŸ¥çœ‹æ–‡ç« æ¦‚è¿°å’Œè¯¦æƒ…äº’ä¸å½±å“</li><li>æŸ¥è¯¢æ–‡ç« è¯¦æƒ…æ•°æ®æ•ˆç‡ä½ï¼Œä¸ä¼šå½±å“åˆ°æŸ¥è¯¢æ–‡ç« æ¦‚è¿°</li></ol><p>æ‹†åˆ†è§„åˆ™ï¼š</p><ol><li>ä¸å¸¸ç”¨å­—æ®µå•ç‹¬æ”¾ä¸€å¼ è¡¨</li><li>æŠŠå¤§å­—æ®µæ‹†åˆ†å‡ºæ¥å•ç‹¬ä¸€å¼ è¡¨</li><li>ç»å¸¸ç»„åˆæŸ¥è¯¢çš„å­—æ®µå•ç‹¬ä¸€å¼ è¡¨</li></ol><h4 id="FreeMarkeræ¨¡æ¿å¼•æ“"><a href="#FreeMarkeræ¨¡æ¿å¼•æ“" class="headerlink" title="FreeMarkeræ¨¡æ¿å¼•æ“"></a>FreeMarkeræ¨¡æ¿å¼•æ“</h4><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8881</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">freemarker-demo</span> <span class="hljs-comment">#æŒ‡å®šæœåŠ¡å</span><br>  <span class="hljs-attr">freemarker:</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span><br>    <span class="hljs-attr">settings:</span><br>      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#æ£€æŸ¥æ¨¡æ¿æ›´æ–°å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºç«‹å³æ£€æŸ¥ï¼Œå¦‚æœæ—¶é—´å¤§äº0ä¼šæœ‰ç¼“å­˜ä¸æ–¹ä¾¿è¿›è¡Œæ¨¡æ¿æµ‹è¯•</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.ftl</span>               <span class="hljs-comment">#æŒ‡å®šFreemarkeræ¨¡æ¿æ–‡ä»¶çš„åç¼€å</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ æ¨¡æ¿</p><blockquote><p>åœ¨resources&#x2F;templates&#x2F;ä¸‹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=&quot;utf-8&quot;&gt;<br>    &lt;title&gt;Hello World!&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;b&gt;æ™®é€šæ–‡æœ¬ String å±•ç¤ºï¼š&lt;/b&gt;&lt;br&gt;&lt;br&gt;<br>Hello $&#123;name&#125; &lt;br&gt;<br>&lt;hr&gt;<br>&lt;b&gt;å¯¹è±¡Studentä¸­çš„æ•°æ®å±•ç¤ºï¼š&lt;/b&gt;&lt;br/&gt;<br>å§“åï¼š$&#123;stu.name&#125;&lt;br/&gt;<br>å¹´é¾„ï¼š$&#123;stu.age&#125;<br>&lt;hr&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.freemarker.controller;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">(Model model)</span> &#123;<br>        model.addAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;freemarker&quot;</span>);<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        student.setName(<span class="hljs-string">&quot;zs&quot;</span>);<br>        student.setAge(<span class="hljs-number">18</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;stu&quot;</span>, student);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;01-basic&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="MinIO"><a href="#MinIO" class="headerlink" title="MinIO"></a>MinIO</h4><p>åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨æœåŠ¡</p><p><strong>æ¦‚å¿µ</strong></p><ul><li>bucketï¼šç±»ä¼¼ç›®å½•</li><li>Objectï¼šç±»ä¼¼æ–‡ä»¶</li><li>Keysï¼šç±»ä¼¼æ–‡ä»¶å</li></ul><p><strong>dockerå®‰è£…</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -p <span class="hljs-number">9000</span>:<span class="hljs-number">9000</span> --name minio -d --restart=always -e <span class="hljs-string">&quot;MINIO_ACCESS_KEY=minio&quot;</span> -e <span class="hljs-string">&quot;MINIO_SECRET_KEY=minio123&quot;</span> -v <span class="hljs-regexp">/home/</span>data:<span class="hljs-regexp">/data -v /</span>home<span class="hljs-regexp">/config:/</span>root<span class="hljs-regexp">/.minio minio/mi</span>nio server /data<br></code></pre></td></tr></table></figure><p>è®¿é—®æ§åˆ¶å°<code>192.168.200.130:9000</code></p><p><strong>ä½¿ç”¨javaä¸Šä¼ æ–‡ä»¶</strong></p><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.minio<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>minio<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å‡†å¤‡æ–‡ä»¶</span><br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;d:\\list.html&quot;</span>);<br>            <span class="hljs-comment">// MinIOè¿æ¥ä¿¡æ¯</span><br>            <span class="hljs-type">MinioClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> MinioClient.builder()<br>                .credentials(<span class="hljs-string">&quot;minio&quot;</span>, <span class="hljs-string">&quot;minio123&quot;</span>)<br>                .endpoint(<span class="hljs-string">&quot;http://192.168.200.130:9000&quot;</span>)<br>                .build();<br>            <span class="hljs-comment">// ä¸Šä¼ æ–‡ä»¶</span><br>            <span class="hljs-type">PutObjectArgs</span> <span class="hljs-variable">putObjectArgs</span> <span class="hljs-operator">=</span> PutObjectArgs.builder()<br>                .object(<span class="hljs-string">&quot;list.html&quot;</span>)    <span class="hljs-comment">// æ–‡ä»¶åœ¨MinIOä¸­çš„æ–‡ä»¶å</span><br>                .contentType(<span class="hljs-string">&quot;text/html&quot;</span>)   <span class="hljs-comment">// æ–‡ä»¶ç±»å‹</span><br>                .bucket(<span class="hljs-string">&quot;leadnews&quot;</span>) <span class="hljs-comment">// æ¡¶åç§°</span><br>                .stream(fileInputStream, fileInputStream.available(), -<span class="hljs-number">1</span>)   <span class="hljs-comment">// ä¸Šä¼ çš„æ–‡ä»¶</span><br>                .build();<br>            client.putObject(putObjectArgs);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><p>â€‹é€šè¿‡FreeMarkerå°†æ–‡ç« æ•°æ®å’Œæ¨¡æ¿ç»‘å®šåç”Ÿæˆé™æ€æ–‡ä»¶ï¼ŒæŠŠé™æ€çš„htmlæ–‡ä»¶ä¿å­˜åˆ°MinIOä¸­ï¼Œä¹‹åè®¿é—®å¯¹åº”çš„æ–‡ç« é¡µé¢å°±ç›´æ¥ä»MinIOä¸­è¿”å›ï¼Œä¸ç”¨å†æŸ¥è¯¢æ•°æ®åº“</p><h2 id="ä¿å­˜æ–‡ç« "><a href="#ä¿å­˜æ–‡ç« " class="headerlink" title="ä¿å­˜æ–‡ç« "></a>ä¿å­˜æ–‡ç« </h2><p>è‡ªåª’ä½“ç«¯å‘å¸ƒæ–‡ç« ï¼Œå®¡æ ¸é€šè¿‡åï¼ŒAppç«¯éœ€è¦ä¿å­˜æ–‡ç« ä¿¡æ¯ </p><p>é€šè¿‡<strong>Feign</strong>è¿œç¨‹è®©è‡ªåª’ä½“ç«¯è¿œç¨‹è°ƒç”¨</p><p>æœ‰å¸¦æ–‡ç« idï¼š</p><ul><li>ä¿®æ”¹æ–‡ç« </li><li>æ›´æ–°æ–‡ç« ã€æ–‡ç« å†…å®¹</li></ul><p>æ²¡æœ‰å¸¦æ–‡ç« idï¼š</p><ul><li>æ–°å¢çš„æ–‡ç« </li><li>è¦ä¿å­˜æ–‡ç« ã€æ–‡ç« é…ç½®ã€æ–‡ç« å†…å®¹</li></ul><h2 id="æ–‡ç« æœç´¢"><a href="#æ–‡ç« æœç´¢" class="headerlink" title="æ–‡ç« æœç´¢"></a>æ–‡ç« æœç´¢</h2><h3 id="çŸ¥è¯†ç‚¹-2"><a href="#çŸ¥è¯†ç‚¹-2" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="elasticsearch"><a href="#elasticsearch" class="headerlink" title="elasticsearch"></a>elasticsearch</h4><p><strong>å®‰è£…</strong></p><ol><li><p>æ‹‰å–é•œåƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">docker pull elasticsearch:<span class="hljs-number">7.4</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">docker run -id --name elasticsearch -d --restart=always -p <span class="hljs-number">9200</span>:<span class="hljs-number">9200</span> -p <span class="hljs-number">9300</span>:<span class="hljs-number">9300</span> -v /usr/share/elasticsearch/plugins:/usr/share/elasticsearch/plugins -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> elasticsearch:<span class="hljs-number">7.4</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®ikåˆ†è¯å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">æŠŠikåˆ†è¯å™¨ä¸Šä¼ åˆ°æŒ‚è½½çš„ç›®å½•<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>pluginsä¸­è§£å‹<br>é‡å¯es<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ol><p><strong>æ·»åŠ æ˜ å°„</strong></p><ol><li><p>æ·»åŠ è¯­æ³•ï¼šputè¯·æ±‚å‘é€<code>ip:ç«¯å£/æ˜ å°„å</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span>:<span class="hljs-number">9200</span>/app_info_article<br><br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;id&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;long&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;publishTime&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;date&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;layout&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;integer&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;images&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;keyword&quot;</span>,<br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;,<br>            <span class="hljs-string">&quot;staticUrl&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;keyword&quot;</span>,<br>                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;,<br>            <span class="hljs-string">&quot;authorId&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;long&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;authorName&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;title&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span>,<br>                <span class="hljs-string">&quot;analyzer&quot;</span>:<span class="hljs-string">&quot;ik_smart&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;content&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span>,<br>                <span class="hljs-string">&quot;analyzer&quot;</span>:<span class="hljs-string">&quot;ik_smart&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å…¶ä»–æ“ä½œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">GETè¯·æ±‚æŸ¥è¯¢æ˜ å°„ï¼šhttp:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.130</span>:<span class="hljs-number">9200</span>/app_info_article<br><br>DELETEè¯·æ±‚ï¼Œåˆ é™¤ç´¢å¼•åŠæ˜ å°„ï¼šhttp:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.130</span>:<span class="hljs-number">9200</span>/app_info_article<br><br>GETè¯·æ±‚ï¼ŒæŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ï¼šhttp:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.130</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/app_info_article/</span>_search<br></code></pre></td></tr></table></figure></li></ol><p><strong>åˆå§‹åŒ–ç´¢å¼•åº“</strong></p><ol><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å¼•å…¥ä¾èµ–æ¨¡å— --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.heima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>heima-leadnews-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Spring boot starter --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--elasticsearch--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsoup<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.13.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>esé…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span><br><span class="hljs-meta">@Setter</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;elasticsearch&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticSearchConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String host;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title function_">client</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(RestClient.builder(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<br>                        host,<br>                        port,<br>                        <span class="hljs-string">&quot;http&quot;</span><br>                )<br>        ));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">es-article</span><br><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/leadnews_article?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br><span class="hljs-comment"># è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½®</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath*:mapper/*.xml</span><br>  <span class="hljs-comment"># è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.heima.model.article.pojos</span><br><br><br><span class="hljs-comment">#è‡ªå®šä¹‰elasticsearchè¿æ¥é…ç½®</span><br><span class="hljs-attr">elasticsearch:</span><br>  <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9200</span><br><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®ä½“ã€mapper</p></li><li><p>å¯¼å…¥æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApArticleTest</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> ApArticleMapper apArticleMapper;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestHighLevelClient restHighLevelClient;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå§‹åŒ–esä¸­çš„æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// æŸ¥è¯¢æ–‡ç« </span><br>        List&lt;SearchArticleVo&gt; searchArticleVos = apArticleMapper.loadArticleList();<br><br>        <span class="hljs-comment">// æ‰¹é‡å¯¼å…¥es</span><br>        <span class="hljs-type">BulkRequest</span> <span class="hljs-variable">bulkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BulkRequest</span>(<span class="hljs-string">&quot;app_info_article&quot;</span>);<br>        <span class="hljs-keyword">for</span> (SearchArticleVo searchArticleVo : searchArticleVos) &#123;<br>            <span class="hljs-type">IndexRequest</span> <span class="hljs-variable">indexRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRequest</span>()<br>                .id(searchArticleVo.getId().toString())<br>                .source(JSON.toJSONString(searchArticleVo), XContentType.JSON);<br>            bulkRequest.add(indexRequest);<br>        &#125;<br><br>        restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);<br>        System.out.println(<span class="hljs-string">&quot;æ–‡ç« ä¿¡æ¯å¯¼å…¥eså®Œæˆ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol><h4 id="éœ€æ±‚-2"><a href="#éœ€æ±‚-2" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><p>æœç´¢æ </p><p>åˆ›å»ºæ–‡ç« æ—¶æ·»åŠ æ–‡æ¡£åˆ°ç´¢å¼•</p><h2 id="æœç´¢è®°å½•"><a href="#æœç´¢è®°å½•" class="headerlink" title="æœç´¢è®°å½•"></a>æœç´¢è®°å½•</h2><p>æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦å­˜å‚¨æœæœè®°å½•ï¼Œæ•°æ®é‡è¾ƒå¤§ï¼Œä½¿ç”¨MongoDBæ¥å­˜</p><h3 id="çŸ¥è¯†ç‚¹-3"><a href="#çŸ¥è¯†ç‚¹-3" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><p><strong>MongoDB</strong></p><p>dockerå®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull mongo<br><br>docker run -di --name mongo-service --restart=always -p 27017:27017 -v ~/data/mongodata:/data mongo<br></code></pre></td></tr></table></figure><p>springé›†æˆmongodb</p><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;<br>    &lt;/dependency&gt;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9998</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">mongodb:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">27017</span><br>      <span class="hljs-attr">database:</span> <span class="hljs-string">leadnews-history</span><br></code></pre></td></tr></table></figure></li><li><p>æ˜ å°„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Document(&quot;ap_associate_words&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApAssociateWords</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> String id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è”æƒ³è¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String associateWords;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºæ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date createdTime;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest(classes = MongoApplication.class)</span><br><span class="hljs-meta">@RunWith(SpringRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoTest</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> MongoTemplate mongoTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveTest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ApAssociateWords</span> <span class="hljs-variable">apAssociateWords</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApAssociateWords</span>();<br>        apAssociateWords.setAssociateWords(<span class="hljs-string">&quot;test&quot;</span>);<br>        apAssociateWords.setCreatedTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        mongoTemplate.save(apAssociateWords);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findByIdTest</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ApAssociateWords</span> <span class="hljs-variable">apAssociateWords</span> <span class="hljs-operator">=</span> mongoTemplate.findById(<span class="hljs-string">&quot;64b65971d91a9f14ddf8da6a&quot;</span>, ApAssociateWords.class);<br>        System.out.println(apAssociateWords);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findByWordsTest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> Query.query(Criteria.where(<span class="hljs-string">&quot;associateWords&quot;</span>).is(<span class="hljs-string">&quot;test&quot;</span>))<br>            .with(Sort.by(Sort.Direction.DESC, <span class="hljs-string">&quot;createdTime&quot;</span>));<br>        List&lt;ApAssociateWords&gt; apAssociateWordsList = mongoTemplate.find(query, ApAssociateWords.class);<br>        System.out.println(apAssociateWordsList);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> Query.query(Criteria.where(<span class="hljs-string">&quot;associateWords&quot;</span>).is(<span class="hljs-string">&quot;test&quot;</span>));<br>        mongoTemplate.remove(query, ApAssociateWords.class);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol><h3 id="éœ€æ±‚-3"><a href="#éœ€æ±‚-3" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>ä¿å­˜ç”¨æˆ·çš„æœ€æ–°çš„10æ¡è®°å½•åœ¨mongodbä¸­</p><p>å¦‚æœè®°å½•åœ¨å†å²ä¸­ï¼Œæ›´æ–°æ—¶é—´</p><p>å¦‚æœä¸åœ¨å†å²ä¸­ï¼Œåˆ æ‰æœ€æ—§çš„ä¸€æ¡è®°å½•å†æ·»åŠ </p><h2 id="ç”¨æˆ·è¡Œä¸º"><a href="#ç”¨æˆ·è¡Œä¸º" class="headerlink" title="ç”¨æˆ·è¡Œä¸º"></a>ç”¨æˆ·è¡Œä¸º</h2><h3 id="éœ€æ±‚-4"><a href="#éœ€æ±‚-4" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºä¿¡æ¯éƒ½è¦å­˜åˆ°Redisä¸­</p><h4 id="ç‚¹èµ-x2F-å–æ¶ˆç‚¹èµ"><a href="#ç‚¹èµ-x2F-å–æ¶ˆç‚¹èµ" class="headerlink" title="ç‚¹èµ&#x2F;å–æ¶ˆç‚¹èµ"></a>ç‚¹èµ&#x2F;å–æ¶ˆç‚¹èµ</h4><p>ç”¨æˆ·ç‚¹èµåè®°å½•åˆ°redisä¸­ï¼Œå–æ¶ˆç‚¹èµæ—¶ä»redisä¸­åˆ é™¤</p><h4 id="é˜…è¯»æ•°"><a href="#é˜…è¯»æ•°" class="headerlink" title="é˜…è¯»æ•°"></a>é˜…è¯»æ•°</h4><p>å°†æ–‡ç« é˜…è¯»æ•°ä»¥hashç»“æ„å­˜åˆ°redis</p><p>keyï¼šArticle:viewContï¼›keyï¼šarticleIdï¼›valueï¼šé˜…è¯»æ•°</p><h4 id="å±•ç¤ºç”¨æˆ·è¡Œä¸ºæ•°æ®"><a href="#å±•ç¤ºç”¨æˆ·è¡Œä¸ºæ•°æ®" class="headerlink" title="å±•ç¤ºç”¨æˆ·è¡Œä¸ºæ•°æ®"></a>å±•ç¤ºç”¨æˆ·è¡Œä¸ºæ•°æ®</h4><p>é€šè¿‡ç”¨æˆ·idå’Œæ–‡ç« idæŸ¥æ‰¾redisçš„setä¸­æ˜¯å¦æœ‰å¯¹åº”çš„value</p><h4 id="å…³æ³¨-x2F-å–å…³"><a href="#å…³æ³¨-x2F-å–å…³" class="headerlink" title="å…³æ³¨&#x2F;å–å…³"></a>å…³æ³¨&#x2F;å–å…³</h4><p>CRUDï¼ŒåŒæ—¶æ”¹å…³æ³¨è¡¨å’Œç²‰ä¸è¡¨</p><h4 id="æ”¶è—"><a href="#æ”¶è—" class="headerlink" title="æ”¶è—"></a>æ”¶è—</h4><p>CRUD</p><h2 id="çƒ­é—¨æ–‡ç« "><a href="#çƒ­é—¨æ–‡ç« " class="headerlink" title="çƒ­é—¨æ–‡ç« "></a>çƒ­é—¨æ–‡ç« </h2><h3 id="çŸ¥è¯†ç‚¹-4"><a href="#çŸ¥è¯†ç‚¹-4" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="xxl-job"><a href="#xxl-job" class="headerlink" title="xxl-job"></a>xxl-job</h4><p>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶</p><p>springä¼ ç»Ÿçš„å®šæ—¶ä»»åŠ¡@Scheduledï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨è¿™ä¸€äº›é—®é¢˜ ï¼š</p><ul><li>åšé›†ç¾¤ä»»åŠ¡çš„é‡å¤æ‰§è¡Œé—®é¢˜</li><li>cronè¡¨è¾¾å¼å®šä¹‰åœ¨ä»£ç ä¹‹ä¸­ï¼Œä¿®æ”¹ä¸æ–¹ä¾¿</li><li>å®šæ—¶ä»»åŠ¡å¤±è´¥äº†ï¼Œæ— æ³•é‡è¯•ä¹Ÿæ²¡æœ‰ç»Ÿè®¡</li><li>å¦‚æœä»»åŠ¡é‡è¿‡å¤§ï¼Œä¸èƒ½æœ‰æ•ˆçš„åˆ†ç‰‡æ‰§è¡Œ</li></ul><p><strong>éƒ¨ç½²</strong></p><p>windows</p><ol><li>ä¸‹è½½æºç ï¼š<a href="https://gitee.com/xuxueli0323/xxl-job">https://gitee.com/xuxueli0323/xxl-job</a></li><li>æ‰§è¡Œsql</li><li>ä¿®æ”¹<code>xxl-job-admin</code>ä¸‹çš„æ•°æ®åº“é…ç½®</li><li>å¯åŠ¨<code>XxlJobAdminApplication</code></li><li>è®¿é—®<code>http://localhost:8080/xxl-job-admin/</code>ï¼Œè´¦å·adminï¼Œå¯†ç 123456</li></ol><p>docker</p><ol><li><p>åˆ›å»ºmysqlå®¹å™¨ï¼Œæ‰§è¡Œxxl-jobçš„sqlè„šæœ¬</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -p 3306:3306 --name mysql57 \<br>-v /opt/mysql/conf:/etc/mysql \<br>-v /opt/mysql/logs:/var/log/mysql \<br>-v /opt/mysql/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=root \<br>-d mysql:5.7<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–xxl-jobé•œåƒ</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull xuxueli/xxl-job-admin:2.3.0<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºxxl-jobå®¹å™¨</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -e PARAMS=&quot;--spring.datasource.url=jdbc:mysql://192.168.200.130:3306/xxl_job?Unicode=true&amp;characterEncoding=UTF-8 \<br>--spring.datasource.username=root \<br>--spring.datasource.password=root&quot; \<br>-p 8888:8080 -v /tmp:/data/applogs \<br>--name xxl-job-admin --restart=always  -d xuxueli/xxl-job-admin:2.3.0<br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®æµ‹è¯•</p></li></ol><p><strong>ä½¿ç”¨</strong></p><ol><li><p>å¯¼åŒ…</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®ç±»ï¼Œå¯ä»¥ä»å®˜æ–¹çš„æºç é‡Œæ‰¾åˆ°</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.xxlJob.config;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XxlJobConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(XxlJobConfig.class);<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;xxl.job.admin.addresses&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String adminAddresses;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;xxl.job.executor.appname&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String appname;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;xxl.job.executor.port&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> XxlJobSpringExecutor <span class="hljs-title function_">xxlJobExecutor</span><span class="hljs-params">()</span> &#123;<br>        logger.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&quot;</span>);<br>        <span class="hljs-type">XxlJobSpringExecutor</span> <span class="hljs-variable">xxlJobSpringExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XxlJobSpringExecutor</span>();<br>        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);<br>        xxlJobSpringExecutor.setAppname(appname);<br>        xxlJobSpringExecutor.setPort(port);<br>        <span class="hljs-keyword">return</span> xxlJobSpringExecutor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8881</span><br><br><span class="hljs-attr">xxl:</span><br>  <span class="hljs-attr">job:</span><br>    <span class="hljs-attr">admin:</span><br>      <span class="hljs-attr">addresses:</span> <span class="hljs-string">http://192.168.200.130:8888/xxl-job-admin</span><br>    <span class="hljs-attr">executor:</span><br>      <span class="hljs-attr">appname:</span> <span class="hljs-string">sample</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span>    <span class="hljs-comment"># éšæ„</span><br><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™è¦æ‰§è¡Œçš„æ–¹æ³•</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.xxlJob.jpb;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloJob</span> &#123;<br>    <span class="hljs-meta">@XxlJob(&quot;demoJobHandler&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;job test&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨æ§åˆ¶å°æ·»åŠ æ‰§è¡Œå™¨ç®¡ç†å’Œä»»åŠ¡ç®¡ç†</p></li><li><p>åœ¨ä»»åŠ¡ç®¡ç†é‡Œè¿è¡Œå®šæ—¶ä»»åŠ¡</p></li></ol><p><strong>è·¯ç”±ç­–ç•¥</strong></p><ol><li>è½®è¯¢ï¼šæœåŠ¡å™¨è½®æµæ‰§è¡Œä»»åŠ¡</li><li>åˆ†ç‰‡å¹¿æ’­ï¼šå°†ä»»åŠ¡åºå·å–æ¨¡æ¥åˆ†é…åˆ°æœåŠ¡å™¨ä¸Š</li></ol><h4 id="KafkaStream"><a href="#KafkaStream" class="headerlink" title="KafkaStream"></a>KafkaStream</h4><p>Kafka Streamæ˜¯Apache Kafkaä»0.10ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°Featureã€‚å®ƒæ˜¯æä¾›äº†å¯¹å­˜å‚¨äºKafkaå†…çš„æ•°æ®è¿›è¡Œ<strong>æµå¼å¤„ç†å’Œåˆ†æ</strong>çš„åŠŸèƒ½ã€‚</p><p><strong>æ¦‚å¿µ</strong></p><p>Source Processorï¼šæºå¤„ç†å™¨ï¼Œä»Topicä¸­ç”Ÿæˆè¾“å…¥æµï¼Œè½¬å‘ç»™å…¶ä»–å¤„ç†å™¨è¿›è¡Œå¤„ç†</p><p>Sink Processorï¼šå°†å¤„ç†å™¨å¤„ç†å®Œçš„æ•°æ®è½¬å‘ç»™æŒ‡å®šçš„Topic</p><p><strong>å…¥é—¨æ¡ˆä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * kafka stream æµå¼å¤„ç†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaStreamQuickStart</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// é…ç½®</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">prop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        prop.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="hljs-string">&quot;192.168.200.130:9092&quot;</span>);<br>        prop.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());<br>        prop.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());<br>        prop.put(StreamsConfig.APPLICATION_ID_CONFIG,<span class="hljs-string">&quot;streams-quickstart&quot;</span>);<br>        <span class="hljs-comment">// builder</span><br>        <span class="hljs-type">StreamsBuilder</span> <span class="hljs-variable">streamsBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamsBuilder</span>();<br><br>        <span class="hljs-comment">// æµå¼è®¡ç®—</span><br>        streamProcessor(streamsBuilder);<br><br>        <span class="hljs-comment">// åˆ›å»ºkafkaStream</span><br>        <span class="hljs-type">KafkaStreams</span> <span class="hljs-variable">kafkaStreams</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaStreams</span>(streamsBuilder.build(), prop);<br>        <span class="hljs-comment">// å¼€å¯</span><br>        kafkaStreams.start();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">streamProcessor</span><span class="hljs-params">(StreamsBuilder streamsBuilder)</span> &#123;<br>        <span class="hljs-comment">// æŒ‡å®šä»å“ªä¸ªtopicä¸­è·å–æ¶ˆæ¯</span><br>        KStream&lt;String, String&gt; stream = streamsBuilder.stream(<span class="hljs-string">&quot;itcast_topic_input&quot;</span>);<br><br>        stream.flatMapValues(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueMapper</span>&lt;String, Iterable&lt;String&gt;&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Iterable&lt;String&gt; <span class="hljs-title function_">apply</span><span class="hljs-params">(String s)</span> &#123;<br>                <span class="hljs-keyword">return</span> Arrays.asList(s.split(<span class="hljs-string">&quot; &quot;</span>));<br>            &#125;<br>        &#125;)<br>            <span class="hljs-comment">// æŒ‰ç…§valueè¿›è¡Œèšåˆ</span><br>            .groupBy((key, value) -&gt; value)<br>            <span class="hljs-comment">// è®¡ç®—æ—¶é—´é—´éš”</span><br>            .windowedBy(TimeWindows.of(Duration.ofSeconds(<span class="hljs-number">10</span>)))<br>            <span class="hljs-comment">// ç»Ÿè®¡å•è¯ä¸ªæ•°</span><br>            .count()<br>            .toStream()<br>            .map((key, value) -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;key: &quot;</span> + key + <span class="hljs-string">&quot;, value&quot;</span> + value);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>&lt;&gt;(key.key().toString(), value.toString());<br>            &#125;)<br>            <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>            .to(<span class="hljs-string">&quot;itcast_topic_out&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾€<code>itcast_topic_input</code>å‘é€æ¶ˆæ¯ï¼Œ<code>itcast_topic_out</code>æ¥æ”¶æ¶ˆæ¯</p><p><strong>springbootæ•´åˆkafkaStream</strong></p><ol><li><p>æ·»åŠ é…ç½®</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kafka:</span><br>  <span class="hljs-attr">hosts:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><span class="hljs-string">:9092</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®ç±»</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.kafka.config;<br><br><span class="hljs-meta">@Getter</span><br><span class="hljs-meta">@Setter</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableKafkaStreams</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;kafka&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaStreamConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_MESSAGE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>* <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;<br><br>    <span class="hljs-keyword">private</span> String hosts;<br><br>    <span class="hljs-keyword">private</span> String group;<br><br>    <span class="hljs-meta">@Bean(name = KafkaStreamsDefaultConfiguration.DEFAULT_STREAMS_CONFIG_BEAN_NAME)</span><br>    <span class="hljs-keyword">public</span> KafkaStreamsConfiguration <span class="hljs-title function_">defaultKafkaStreamsConfig</span><span class="hljs-params">()</span> &#123;<br>        Map&lt;String, Object&gt; props = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, hosts);<br>        props.put(StreamsConfig.APPLICATION_ID_CONFIG, <span class="hljs-built_in">this</span>.getGroup()+<span class="hljs-string">&quot;_stream_aid&quot;</span>);<br>        props.put(StreamsConfig.CLIENT_ID_CONFIG, <span class="hljs-built_in">this</span>.getGroup()+<span class="hljs-string">&quot;_stream_cid&quot;</span>);<br>        props.put(StreamsConfig.RETRIES_CONFIG, <span class="hljs-number">10</span>);<br>        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());<br>        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaStreamsConfiguration</span>(props);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ ç›‘å¬å™¨ï¼Œå¤„ç†æµæ•°æ®</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.kafka.listener;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaStreamHelloListener</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> KStream&lt;String,String&gt; <span class="hljs-title function_">kStream</span><span class="hljs-params">(StreamsBuilder streamsBuilder)</span>&#123;<br>        <span class="hljs-comment">//åˆ›å»ºkstreamå¯¹è±¡ï¼ŒåŒæ—¶æŒ‡å®šä»é‚£ä¸ªtopicä¸­æ¥æ”¶æ¶ˆæ¯</span><br>        KStream&lt;String, String&gt; stream = streamsBuilder.stream(<span class="hljs-string">&quot;itcast-topic-input&quot;</span>);<br>        stream.flatMapValues(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueMapper</span>&lt;String, Iterable&lt;String&gt;&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Iterable&lt;String&gt; <span class="hljs-title function_">apply</span><span class="hljs-params">(String value)</span> &#123;<br>                <span class="hljs-keyword">return</span> Arrays.asList(value.split(<span class="hljs-string">&quot; &quot;</span>));<br>            &#125;<br>        &#125;)<br>            <span class="hljs-comment">//æ ¹æ®valueè¿›è¡Œèšåˆåˆ†ç»„</span><br>            .groupBy((key,value)-&gt;value)<br>            <span class="hljs-comment">//èšåˆè®¡ç®—æ—¶é—´é—´éš”</span><br>            .windowedBy(TimeWindows.of(Duration.ofSeconds(<span class="hljs-number">10</span>)))<br>            <span class="hljs-comment">//æ±‚å•è¯çš„ä¸ªæ•°</span><br>            .count()<br>            .toStream()<br>            <span class="hljs-comment">//å¤„ç†åçš„ç»“æœè½¬æ¢ä¸ºstringå­—ç¬¦ä¸²</span><br>            .map((key,value)-&gt;&#123;<br>                System.out.println(<span class="hljs-string">&quot;key:&quot;</span>+key+<span class="hljs-string">&quot;,value:&quot;</span>+value);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValue</span>&lt;&gt;(key.key().toString(),value.toString());<br>            &#125;)<br>            <span class="hljs-comment">//å‘é€æ¶ˆæ¯</span><br>            .to(<span class="hljs-string">&quot;itcast-topic-out&quot;</span>);<br>        <span class="hljs-keyword">return</span> stream;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="éœ€æ±‚-5"><a href="#éœ€æ±‚-5" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>å®šæ—¶è®¡ç®—ï¼š</p><p>â€‹ä¸ºæ¯ä¸ªé¢‘é“ç¼“å­˜çƒ­åº¦æœ€é«˜çš„30æ¡æ–‡ç« ï¼ˆ5å¤©ä¹‹å†…çš„ï¼‰ï¼š</p><p>â€‹æ ¹æ®æ–‡ç« çš„é˜…è¯»ï¼Œç‚¹èµï¼Œè¯„è®ºï¼Œæ”¶è—åŠ æƒï¼ˆ1,3,5,8ï¼‰æ¥åˆ¤æ–­æ–‡ç« çš„çƒ­åº¦</p><p>â€‹feignè°ƒç”¨wemediaï¼Œè·å–æ‰€æœ‰é¢‘é“</p><p>â€‹æ ¹æ®é¢‘é“æ¥åˆ†ç»„æ–‡ç« å¹¶æ’åºï¼Œç¼“å­˜çƒ­åº¦æœ€é«˜çš„30æ¡æ–‡ç« </p><p>å®æ—¶è®¡ç®—ï¼š</p><p>â€‹behaviorå¾®æœåŠ¡ä¸­ï¼Œåœ¨è®°å½•ç”¨æˆ·è¡Œä¸ºåï¼Œå‘é€æ¶ˆæ¯åˆ°kafkaçš„ä¸€ä¸ªtopicä¸­</p><p>â€‹articleå¾®æœåŠ¡ä¸­ï¼Œåˆ›å»ºhandleè·å–kafkaçš„æ¶ˆæ¯ï¼Œè®°å½•ã€è½¬æ¢åå‘é€åˆ°å¦ä¸€ä¸ªtopicä¸­</p><p>â€‹ä¹‹åarticleé‡Œé¢åˆ›å»ºä¸€ä¸ªlisteneræ¥ç›‘å¬è¿™ä¸ªtopicæ¥æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜</p><h1 id="è‡ªåª’ä½“ç«¯"><a href="#è‡ªåª’ä½“ç«¯" class="headerlink" title="è‡ªåª’ä½“ç«¯"></a>è‡ªåª’ä½“ç«¯</h1><h2 id="ç™»å½•-1"><a href="#ç™»å½•-1" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>åŒappç«¯çš„ç™»å½•</p><h2 id="ä¸Šä¼ ç´ æ"><a href="#ä¸Šä¼ ç´ æ" class="headerlink" title="ä¸Šä¼ ç´ æ"></a>ä¸Šä¼ ç´ æ</h2><ol><li><p>è·å–ç™»å½•ç”¨æˆ·id</p><p>1.1 åœ¨wemediaç½‘å…³ä¸­å°†tokenä¸­çš„è½½è·userIdå­˜åˆ°headerä¸­</p><p>1.2 wemediaæœåŠ¡ä¸­é€šè¿‡æ‹¦æˆªå™¨ï¼Œå°†headerä¸­çš„idå­˜åˆ°ThreadLocalä¸­</p></li><li><p>ä¿å­˜ç´ æåˆ°minIO</p><p>2.1 æ ¡éªŒå‚æ•°ï¼ŒUUIDéšæœºç”Ÿæˆç´ æåç§°</p><p>2.2 ä¿å­˜åˆ°minIOåï¼Œå°†è®¿é—®åœ°å€ä¿å­˜åˆ°æ•°æ®åº“ä¸­</p><p>2.3 è¿”å›ç´ ææ•°æ®ä¾›å‰ç«¯å›æ˜¾</p></li></ol><h2 id="å±•ç¤ºç´ æåˆ—è¡¨"><a href="#å±•ç¤ºç´ æåˆ—è¡¨" class="headerlink" title="å±•ç¤ºç´ æåˆ—è¡¨"></a>å±•ç¤ºç´ æåˆ—è¡¨</h2><p>åˆ†é¡µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸ºæ˜¯å…¨éƒ¨è¿˜æ˜¯å·²æ”¶è—çš„ç´ æ</p><p>æ ¹æ®ThreadLocalä¸­çš„userIdæŸ¥æ‰¾ç”¨æˆ·çš„ç´ æ</p><h2 id="å‘å¸ƒæ–‡ç« "><a href="#å‘å¸ƒæ–‡ç« " class="headerlink" title="å‘å¸ƒæ–‡ç« "></a>å‘å¸ƒæ–‡ç« </h2><ul><li>å¦‚æœæ–‡ç« çŠ¶æ€ä¸ºè‰ç¨¿<ul><li>åªä¿å­˜æ–‡ç« ä¿¡æ¯ï¼Œæ–‡ç« å’Œå›¾ç‰‡çš„å¯¹åº”å…³ç³»æš‚ä¸ä¿å­˜</li></ul></li><li>ä¸ä¸ºè‰ç¨¿<ul><li>ä¿å­˜æ–‡ç« ä¿¡æ¯å’Œæ–‡ç« ä¸å›¾ç‰‡çš„å¯¹åº”å…³ç³»</li></ul></li><li>åˆ¤æ–­æ–‡ç« å°é¢å›¾ç‰‡<ul><li>é€‰æ‹©æ— å›¾ã€å•å›¾ã€ä¸‰å›¾ï¼šé€‰æ‹©æ–‡ç« ä¸­çš„å›¾ç‰‡</li><li>é€‰æ‹©è‡ªåŠ¨ï¼šæ ¹æ®æ–‡ç« ä¸­å›¾ç‰‡çš„æ•°é‡æ¥å†³å®š</li></ul></li></ul><h2 id="å±•ç¤ºæ–‡ç« "><a href="#å±•ç¤ºæ–‡ç« " class="headerlink" title="å±•ç¤ºæ–‡ç« "></a>å±•ç¤ºæ–‡ç« </h2><p>åŒå±•ç¤ºç´ æåˆ—è¡¨</p><h2 id="æ–‡ç« å®¡æ ¸"><a href="#æ–‡ç« å®¡æ ¸" class="headerlink" title="æ–‡ç« å®¡æ ¸"></a>æ–‡ç« å®¡æ ¸</h2><p>æ¥å…¥é˜¿é‡Œäº‘çš„å†…å®¹å®‰å…¨æœåŠ¡ï¼Œé€šè¿‡è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£å¯¹æ–‡ç« å†…å®¹è¿›è¡Œå®¡æŸ¥</p><p>éœ€è¦å¼€é€šé˜¿é‡Œäº‘å†…å®¹å®‰å…¨æœåŠ¡ï¼ŒaccessKeyIdï¼Œsecret</p><p><a href="https://help.aliyun.com/document_detail/433565.html?spm=a2c4g.464388.0.0.4b822d46lSWB0h">æ–‡æœ¬å®¡æ ¸å¢å¼ºç‰ˆ (aliyun.com)</a></p><p>å®¡æ ¸å®Œå›¾ç‰‡å’Œæ–‡ç« åï¼Œè°ƒç”¨Appç«¯å¾®æœåŠ¡çš„ä¿å­˜æ–‡ç« <strong>Feign</strong>æ¥å£</p><p><strong>æœåŠ¡é™çº§</strong>ï¼š</p><ol><li>å®ç°feignè¿œç¨‹æ¥å£ï¼Œç¼–å†™é™çº§é€»è¾‘</li><li>åœ¨<code>@FeignClient</code>æ³¨è§£ä¸­æŒ‡å®šé™çº§é€»è¾‘</li><li>åœ¨è‡ªåª’ä½“ç«¯ä¸­æ·»åŠ é…ç½®ç±»æ¥æ‰«ææœåŠ¡é™çº§ç±»æ‰€åœ¨çš„åŒ…</li><li>åœ¨è‡ªåª’ä½“ç«¯çš„è¿œç¨‹é…ç½®ä¸­å¼€å¯æœåŠ¡é™çº§</li></ol><p><strong>å¼‚æ­¥è°ƒç”¨</strong></p><ul><li>è‡ªåª’ä½“ç«¯ä¿å­˜æ–‡ç« æ—¶å¼‚æ­¥è°ƒç”¨æ–‡ç« å®¡æ ¸</li><li>å¼€å¯å¼‚æ­¥è°ƒç”¨@EnableAsync</li><li>åœ¨å®¡æ ¸æ–‡ç« æ–¹æ³•ä¸ŠåŠ @Async</li></ul><h2 id="æ•æ„Ÿè¯è¿‡æ»¤"><a href="#æ•æ„Ÿè¯è¿‡æ»¤" class="headerlink" title="æ•æ„Ÿè¯è¿‡æ»¤"></a>æ•æ„Ÿè¯è¿‡æ»¤</h2><p><strong>æ–‡æœ¬è¿‡æ»¤æ–¹æ¡ˆ</strong></p><table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢</td><td>æ•ˆç‡å¤ªä½</td></tr><tr><td>String.indexOf(â€œâ€)æŸ¥æ‰¾</td><td>æ•°æ®åº“é‡å¤§çš„è¯ä¹Ÿæ˜¯æ¯”è¾ƒæ…¢</td></tr><tr><td>å…¨æ–‡æ£€ç´¢</td><td>åˆ†è¯å†åŒ¹é…</td></tr><tr><td><strong>DFAç®—æ³•</strong></td><td>ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœº(ä¸€ç§æ•°æ®ç»“æ„)</td></tr></tbody></table><p>DFAç®—æ³•ç±»ä¼¼å­—å…¸æ ‘æ¥åŒ¹é…æ•æ„Ÿè¯</p><p><strong>å›¾ç‰‡è¿‡æ»¤æ–¹æ¡ˆ</strong></p><blockquote><p>OCR ï¼ˆOptical Character Recognitionï¼Œå…‰å­¦å­—ç¬¦è¯†åˆ«ï¼‰æ˜¯æŒ‡ç”µå­è®¾å¤‡ï¼ˆä¾‹å¦‚æ‰«æä»ªæˆ–æ•°ç ç›¸æœºï¼‰æ£€æŸ¥çº¸ä¸Šæ‰“å°çš„å­—ç¬¦ï¼Œé€šè¿‡æ£€æµ‹æš—ã€äº®çš„æ¨¡å¼ç¡®å®šå…¶å½¢çŠ¶ï¼Œç„¶åç”¨å­—ç¬¦è¯†åˆ«æ–¹æ³•å°†å½¢çŠ¶ç¿»è¯‘æˆè®¡ç®—æœºæ–‡å­—çš„è¿‡ç¨‹</p></blockquote><table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>ç™¾åº¦OCR</td><td>æ”¶è´¹</td></tr><tr><td>Tesseract-OCR</td><td>Googleç»´æŠ¤çš„å¼€æºOCRå¼•æ“ï¼Œæ”¯æŒJavaï¼ŒPythonç­‰è¯­è¨€è°ƒç”¨</td></tr><tr><td><strong>Tess4J</strong></td><td>å°è£…äº†Tesseract-OCR  ï¼Œæ”¯æŒJavaè°ƒç”¨</td></tr></tbody></table><p><strong>Tess4J</strong>ä½¿ç”¨</p><ol><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.tess4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tess4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æœ¬åœ°å›¾ç‰‡æ–‡ä»¶</span><br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;C:\\Users\\ASUS\\Desktop\\aaa.jpg&quot;</span>);<br>            <span class="hljs-comment">// åˆ›å»ºTesseractå¯¹è±¡</span><br>            <span class="hljs-type">Tesseract</span> <span class="hljs-variable">tesseract</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tesseract</span>();<br>            <span class="hljs-comment">// è®¾ç½®å­—ä½“åº“è·¯å¾„</span><br>            tesseract.setDatapath(<span class="hljs-string">&quot;D:\\download\\&quot;</span>);<br>            <span class="hljs-comment">// è®¾ç½®å…·ä½“å­—ä½“åº“</span><br>            tesseract.setLanguage(<span class="hljs-string">&quot;chi_sim&quot;</span>);<br>            <span class="hljs-comment">// è¯†åˆ«å›¾ç‰‡æ–‡å­—</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> tesseract.doOCR(file);<br>            result = result.replace(<span class="hljs-string">&quot;\\r|\\n&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;è¯†åˆ«ç»“æœï¼š&quot;</span> + result);<br>        &#125; <span class="hljs-keyword">catch</span> (TesseractException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="æ–‡ç« å®šæ—¶å‘å¸ƒ"><a href="#æ–‡ç« å®šæ—¶å‘å¸ƒ" class="headerlink" title="æ–‡ç« å®šæ—¶å‘å¸ƒ"></a>æ–‡ç« å®šæ—¶å‘å¸ƒ</h2><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p><strong>DelayQueue</strong>ï¼š</p><p>JDKè‡ªå¸¦çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å…ƒç´ å®ç°<strong>Delayed</strong>æ¥å£ï¼ˆè·å–å‰©ä½™æ—¶é—´ï¼Œæ’åºï¼‰ï¼Œä¹‹åå°†å…ƒç´ æ·»åŠ åˆ°<code>DelayerQueue</code>ä¸­ï¼Œåªæœ‰è¿‡æœŸçš„å…ƒç´ æ‰èƒ½poll()å‡ºæ¥</p><p>ç¼ºç‚¹ï¼š</p><ol><li>æœåŠ¡å…³é—­å°±ä¸¢å¤±é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</li></ol><p><strong>RabbitMQ</strong>ï¼š</p><p>é€šè¿‡æ­»ä¿¡äº¤æ¢æœºå®ç°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå½“æ¶ˆæ¯è¿‡æœŸåä¼šè¢«å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºä¸­</p><p><strong>Redis</strong>ï¼š</p><p>å…ˆå°†ä»»åŠ¡æ·»åŠ åˆ°æ•°æ®åº“ä¸­å®ç°æŒä¹…åŒ–ï¼Œ</p><p>ç„¶åæŠŠæœªæ¥5åˆ†é’Ÿä¹‹å†…è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°zSetï¼ŒzSetå†æŠŠå½“å‰è¦æ‰§è¡Œçš„ä»»åŠ¡æ”¾åˆ°listä¸­</p><p><strong>Rediså®ç°å®šæ—¶å‘å¸ƒ</strong></p><ol><li><p>æ‹‰å–ã€å¯åŠ¨redis</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull redis<br><br>docker run -d --name redis --restart=always -p 6379:6379 redis --requirepass &quot;leadnews&quot;<br></code></pre></td></tr></table></figure></li><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- redisä¾èµ–commons-pool è¿™ä¸ªä¾èµ–ä¸€å®šè¦æ·»åŠ  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®ï¼Œæµ‹è¯•</p></li></ol><p><strong>ç”Ÿäº§ä»»åŠ¡</strong></p><p>å…ˆå°†ä»»åŠ¡åŠæ—¥å¿—æ·»åŠ åˆ°æ•°æ®åº“ä¸­å®ç°æŒä¹…åŒ–ï¼Œ</p><p>ç„¶åæŠŠæœªæ¥5åˆ†é’Ÿä¹‹å†…è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°zSetï¼ŒzSetå†æŠŠå½“å‰è¦æ‰§è¡Œçš„ä»»åŠ¡æ”¾åˆ°listä¸­</p><p><strong>å–æ¶ˆä»»åŠ¡</strong></p><p>å°†ä»»åŠ¡ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼Œæ›´æ”¹å¯¹åº”æ—¥å¿—çš„çŠ¶æ€ï¼Œ</p><p>ç„¶ååˆ é™¤redisä¸­çš„ä»»åŠ¡</p><p><strong>æ¶ˆè´¹ä»»åŠ¡</strong></p><p>åˆ é™¤redisã€dbä¸­ä»»åŠ¡ï¼Œæ›´æ–°æ—¥å¿—ï¼Œè¿”å›ä»»åŠ¡</p><p><strong>ä»zSetä¸­åˆ·æ–°ä»»åŠ¡</strong></p><p>å°†zSetä¸­çš„åˆ°æœŸä»»åŠ¡åˆ·åˆ°å¯¹åº”listä¸­</p><p>ä½¿ç”¨<code>scan</code>æ¥è·å–ä¸€å®šæ•°é‡çš„ä»»åŠ¡ï¼Œ<code>keys *</code>å ç”¨cpuå¤ªå¤šä¸ä½¿ç”¨</p><p>é€šè¿‡å®šæ—¶ä»»åŠ¡å®ç°å®šæ—¶åˆ·æ–°</p><p>é€šè¿‡redisçš„<code>setnx</code>å®ç°åˆ†å¸ƒå¼é”ï¼Œè®©å¤šä¸ªå®šæ—¶ä»»åŠ¡åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œåˆ·æ–°ä»»åŠ¡</p><p><strong>ä»DBä¸­åŒæ­¥ä»»åŠ¡</strong></p><p>å…ˆæ¸…ç©ºredisä¸­çš„ä»»åŠ¡ï¼Œä¿è¯ä»»åŠ¡ä¸ä¼šé‡å¤å­˜åœ¨äºredisä¸­</p><p>ä»DBä¸­å°†5åˆ†é’Ÿä¹‹å†…çš„æ•°æ®åˆ·æ–°åˆ°redisä¸­</p><p><code>heima-leadnews-schedule</code>é€šè¿‡Feignå‘å¤–æä¾›æœåŠ¡</p><h2 id="æ–‡ç« ä¸Šæ¶ä¸‹æ¶"><a href="#æ–‡ç« ä¸Šæ¶ä¸‹æ¶" class="headerlink" title="æ–‡ç« ä¸Šæ¶ä¸‹æ¶"></a>æ–‡ç« ä¸Šæ¶ä¸‹æ¶</h2><h3 id="çŸ¥è¯†ç‚¹-5"><a href="#çŸ¥è¯†ç‚¹-5" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h4><p>mqæ¯”è¾ƒ</p><ul><li>RabbitMQï¼šæ€§èƒ½è¾ƒå¥½ï¼Œæ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§</li><li>RocketMQï¼šå¯é æ€§å¥½</li><li>Kafkaï¼šååé‡é«˜</li></ul><p><strong>æ¦‚å¿µ</strong></p><ul><li>producerï¼šå‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜ç”Ÿäº§è€…ï¼ˆKafka topic producerï¼‰</li><li><strong>topic</strong>ï¼šKafkaå°†æ¶ˆæ¯åˆ†é—¨åˆ«ç±»ï¼Œæ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºä¸€ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œä¸€ä¸ªtopicå¯ä»¥åœ¨é›†ç¾¤ä¸Šçš„ä¸åŒæœºå™¨ä¸Šæœ‰åˆ†åŒº</li><li>consumerï¼šè®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºä¸»é¢˜æ¶ˆè´¹è€…ï¼ˆconsumersï¼‰</li><li>brokerï¼šå·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªä»£ç†ï¼ˆBrokerï¼‰ã€‚ æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ã€‚</li></ul><p><strong>å®‰è£…</strong></p><ol><li><p>å®‰è£…zookeeper</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull zookeeper:3.4.14<br><br>docker run -d --name zookeeper -p 2181:2181 zookeeper:3.4.14<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…kafka</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull wurstmeister/kafka:2.12-2.3.1<br><br>docker run -d --name kafka \<br>--env KAFKA_ADVERTISED_HOST_NAME=192.168.200.130 \<br>--env KAFKA_ZOOKEEPER_CONNECT=192.168.200.130:2181 \<br>--env KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.200.130:9092 \<br>--env KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 \<br>--env KAFKA_HEAP_OPTS=&quot;-Xmx256M -Xms256M&quot; \<br>--net=host wurstmeister/kafka:2.12-2.3.1<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.kafka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>kafka-clients<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.kafka.sample;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerQuickStart</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1.kafkaçš„é…ç½®ä¿¡æ¯</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-comment">//kafkaçš„è¿æ¥åœ°å€</span><br>        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="hljs-string">&quot;192.168.200.130:9092&quot;</span>);<br>        <span class="hljs-comment">//å‘é€å¤±è´¥ï¼Œå¤±è´¥çš„é‡è¯•æ¬¡æ•°</span><br>        properties.put(ProducerConfig.RETRIES_CONFIG,<span class="hljs-number">5</span>);<br>        <span class="hljs-comment">//æ¶ˆæ¯keyçš„åºåˆ—åŒ–å™¨</span><br>        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<span class="hljs-string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);<br>        <span class="hljs-comment">//æ¶ˆæ¯valueçš„åºåˆ—åŒ–å™¨</span><br>        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<span class="hljs-string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);<br><br>        <span class="hljs-comment">// ç”Ÿäº§è€…</span><br>        KafkaProducer&lt;String, String&gt; producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaProducer</span>&lt;&gt;(properties);<br><br>        <span class="hljs-comment">// æ¶ˆæ¯</span><br>        ProducerRecord&lt;String, String&gt; record = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(<span class="hljs-string">&quot;topic001&quot;</span>,<span class="hljs-string">&quot;key001&quot;</span>,<span class="hljs-string">&quot;hello kafka&quot;</span>);<br><br>        <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>        producer.send(record);<br>        System.out.println(<span class="hljs-string">&quot;=======æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);<br><br>        <span class="hljs-comment">// å…³é—­æ¶ˆæ¯é€šé“ï¼Œæ¶ˆæ¯æ‰èƒ½å‘é€å‡ºå»</span><br>        producer.close();<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.kafka.sample;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerQuickStart</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1.æ·»åŠ kafkaçš„é…ç½®ä¿¡æ¯</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-comment">//kafkaçš„è¿æ¥åœ°å€</span><br>        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="hljs-string">&quot;192.168.200.130:9092&quot;</span>);<br>        <span class="hljs-comment">//æ¶ˆè´¹è€…ç»„ï¼ŒåŒä¸€ä¸ªç»„é‡Œçš„åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯</span><br>        properties.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="hljs-string">&quot;group2&quot;</span>);<br>        <span class="hljs-comment">//æ¶ˆæ¯çš„ååºåˆ—åŒ–å™¨</span><br>        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, <span class="hljs-string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);<br>        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, <span class="hljs-string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);<br><br>        <span class="hljs-comment">//2.æ¶ˆè´¹è€…å¯¹è±¡</span><br>        KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;String, String&gt;(properties);<br><br>        <span class="hljs-comment">//3.è®¢é˜…ä¸»é¢˜</span><br>        consumer.subscribe(Collections.singletonList(<span class="hljs-string">&quot;topic001&quot;</span>));<br><br>        <span class="hljs-comment">// æ¥æ”¶æ¶ˆæ¯</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">1000</span>));<br>            <span class="hljs-keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;<br>                System.out.println(record.key());<br>                System.out.println(record.value());<br>            &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p><strong>kafkaé«˜å¯ç”¨</strong></p><ol><li><p>é›†ç¾¤</p><p>é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨ç§°ä¸ºBrokerï¼Œå³ä¸€å°æœåŠ¡å™¨å®•æœºäº†ï¼Œä»»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡</p></li><li><p>å¤‡ä»½</p><p>ä¸»èŠ‚ç‚¹ï¼šLeader Replicaï¼›ä»èŠ‚ç‚¹ï¼šFollower Replica</p><p>ä»èŠ‚ç‚¹åˆåˆ†ä¸ºISRï¼ˆin-sync replicaï¼‰å’Œæ™®é€šèŠ‚ç‚¹ã€‚</p><p>ISRéœ€è¦åŒæ­¥å¤‡ä»½ï¼Œä»èŠ‚ç‚¹å¼‚æ­¥å¤‡ä»½ã€‚</p><p>æ‰€ä»¥å¦‚æœä¸»èŠ‚ç‚¹å®•æœºäº†ï¼Œå¦‚æœè¦æ•°æ®å¯é ï¼Œåˆ™ä»ISRèŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼›å¦‚æœè¦é«˜å¯ç”¨ï¼Œåˆ™ä»ä»»æ„ä¸€ä¸ªæ´»ç€çš„èŠ‚ç‚¹ä¸­é€‰ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹</p></li></ol><p><strong>ç”Ÿäº§è€…</strong></p><ol><li><p>åŒæ­¥å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">RecordMetadata</span> <span class="hljs-variable">recordMetadata</span> <span class="hljs-operator">=</span> producer.send(record).get();<br>System.out.println(<span class="hljs-string">&quot;åç§»é‡ï¼š&quot;</span> + recordMetadata.offset());<br></code></pre></td></tr></table></figure></li><li><p>å¼‚æ­¥å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">producer.send(record, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(RecordMetadata recordMetadata, Exception e)</span> &#123;<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>)<br>            e.printStackTrace();<br>        System.out.println(<span class="hljs-string">&quot;åç§»é‡ï¼š&quot;</span> + recordMetadata.offset());<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p>éƒ¨åˆ†é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‘é€å¤±è´¥ï¼Œå¤±è´¥çš„é‡è¯•æ¬¡æ•°</span><br>properties.put(ProducerConfig.RETRIES_CONFIG,<span class="hljs-number">5</span>);<br><span class="hljs-comment">// åº”ç­”æ–¹å¼ 0ï¼š ä¸éœ€è¦åº”ç­” 1ï¼š ä¸»èŠ‚ç‚¹æ”¶åˆ°ååº”ç­”ï¼ˆé»˜è®¤ï¼‰ 2ï¼š åŒæ­¥ç»™æ‰€æœ‰ä»èŠ‚ç‚¹ååº”ç­”</span><br>properties.put(ProducerConfig.ACKS_CONFIG, <span class="hljs-string">&quot;all&quot;</span>);<br><span class="hljs-comment">// å‹ç¼©æ–¹å¼ snappyï¼Œlz4ï¼Œgzip</span><br>properties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, <span class="hljs-string">&quot;snappy&quot;</span>);<br></code></pre></td></tr></table></figure></li></ol><p><strong>æ¶ˆè´¹è€…</strong></p><ol><li><p>æ¶ˆè´¹è€…ç»„</p><p>ä¸€ä¸ªæ¶ˆæ¯åœ¨æ¶ˆè´¹è€…ç»„ä¸­åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</p><p>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«ä¸åŒç»„çš„æ¶ˆè´¹è€…æ¶ˆè´¹</p></li><li><p>æ¶ˆæ¯æœ‰åºæ€§</p><p>ä¸€ä¸ªTopicçš„åˆ†åŒºé‡Œçš„æ¶ˆæ¯æ˜¯æŒ‰é¡ºåºæ¶ˆè´¹çš„ï¼Œä½†ä¸åŒåˆ†åŒºä¸èƒ½ä¿è¯æœ‰åºæ€§ã€‚</p><p>è¦ä¿è¯æœ‰åºæ€§é‚£å°±åªèƒ½æä¾›ä¸€ä¸ªåˆ†åŒº</p><blockquote><p>åœºæ™¯ï¼šèŠå¤©ï¼Œå¤šæ¬¡è½¬è´¦çš„è¶Šå˜æ›´é€šçŸ¥</p></blockquote></li><li><p>åç§»é‡</p><p>æ¶ˆè´¹è€…æ¯å¤„ç†å®Œä¸€æ‰¹æ¶ˆæ¯ï¼Œå°±ä¼šå¾€â€™_consumer_offsetâ€™è¿™ä¸ªTopicé‡Œæäº¤åç§»é‡ï¼Œåç§»é‡ç”¨äºç¡®å®šæ¶ˆæ¯é˜Ÿåˆ—ä¸­å“ªäº›æ¶ˆæ¯è¢«æ¶ˆè´¹äº†</p><p><strong>è‡ªåŠ¨æäº¤</strong>åç§»é‡å¯èƒ½å¸¦æ¥çš„é—®é¢˜</p><ol><li><p>é‡å¤æ¶ˆè´¹</p><p>å¦‚æœæ¶ˆè´¹è€…å¤„ç†ä¸€æ‰¹æ¶ˆæ¯åˆ°ä¸€åŠå®•æœºäº†ï¼Œä½†è¿˜æ²¡æœ‰æäº¤åç§»é‡ï¼Œå…¶ä»–æ¶ˆè´¹è€…å°±ä¼šæ¥æ¥æ‰‹åˆ†åŒºç»§ç»­å¤„ç†æ¶ˆæ¯ï¼Œæ­¤æ—¶å°±ä¼šé‡å¤æ¶ˆè´¹æ¶ˆæ¯</p></li><li><p>æ¶ˆæ¯ä¸¢å¤±</p><p>å¦‚æœæ­£åœ¨å¤„ç†æ¶ˆæ¯æ—¶å°±æäº¤åç§»é‡ï¼Œæ­¤æ—¶å®•æœºäº†ï¼Œé‚£ä¹ˆæ­£åœ¨å¤„ç†çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</p></li></ol><p><strong>æ‰‹åŠ¨æäº¤</strong>å¯ä»¥è§£å†³è¿™äº›é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å–æ¶ˆè‡ªåŠ¨æäº¤åç§»é‡</span><br>properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-literal">false</span>);<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-comment">// æ¶ˆè´¹æ¶ˆæ¯</span><br>        ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">1000</span>));<br>        <span class="hljs-keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;<br>            System.out.println(record.key());<br>            System.out.println(record.value());<br>        &#125;<br>        consumer.commitAsync(); <span class="hljs-comment">// å¼‚æ­¥æäº¤åç§»é‡ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ä¸ä¼šé‡è¯•</span><br>    &#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>    System.out.println(<span class="hljs-string">&quot;é”™è¯¯ä¿¡æ¯ï¼š&quot;</span> + e);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    consumer.commitSync();      <span class="hljs-comment">// åŒæ­¥æäº¤ï¼Œå¦‚æœä¹‹å‰å¼‚æ­¥æäº¤å¤±è´¥äº†ï¼Œè¿™é‡Œä¼šä¸æ–­é‡è¯•çŸ¥é“å‘é€æˆåŠŸ</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="Springé›†æˆKafka"><a href="#Springé›†æˆKafka" class="headerlink" title="Springé›†æˆKafka"></a>Springé›†æˆKafka</h4><ol><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--springé›†æˆkafka--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.kafka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-kafka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.kafka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>kafka-clients<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--Kafka--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.kafka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>kafka-clients<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9991</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">kafka-demo</span><br>  <span class="hljs-attr">kafka:</span><br>    <span class="hljs-comment"># Kafkaåœ°å€</span><br>    <span class="hljs-attr">bootstrap-servers:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.130</span><span class="hljs-string">:9092</span><br>    <span class="hljs-comment"># ç”Ÿäº§è€…é…ç½®</span><br>    <span class="hljs-attr">producer:</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">key-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span><br>      <span class="hljs-attr">value-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span><br>    <span class="hljs-comment"># æ¶ˆè´¹è€…é…ç½®</span><br>    <span class="hljs-attr">consumer:</span><br>      <span class="hljs-attr">group-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;-test</span><br>      <span class="hljs-attr">key-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span><br>      <span class="hljs-attr">value-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span><br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§æ¶ˆæ¯ï¼Œè¦å‘é€å¯¹è±¡å¯ä»¥è½¬Json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å‘é€æ¶ˆæ¯åˆ°&#x27;test-topic&#x27;</span><br>        kafkaTemplate.send(<span class="hljs-string">&quot;test-topic&quot;</span>, <span class="hljs-string">&quot;message&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç›‘å¬Topic</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloListener</span> &#123;<br><br>    <span class="hljs-comment">// ä»&#x27;test-topic&#x27;ä¸­æ¥æ”¶æ¶ˆæ¯</span><br>    <span class="hljs-meta">@KafkaListener(topics = &#123;&quot;test-topic&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> &#123;<br>        System.out.println(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="éœ€æ±‚-6"><a href="#éœ€æ±‚-6" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>è‡ªåª’ä½“ç«¯è®¾ç½®æ–‡ç« ä¸Šä¸‹æ¶ï¼Œé€šè¿‡kafkaå°†æ–‡ç« é…ç½®åŒæ­¥åˆ°appç«¯</p><h1 id="å¹³å°ç®¡ç†ç«¯"><a href="#å¹³å°ç®¡ç†ç«¯" class="headerlink" title="å¹³å°ç®¡ç†ç«¯"></a>å¹³å°ç®¡ç†ç«¯</h1><h2 id="ç™»å½•-2"><a href="#ç™»å½•-2" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>ç™»å½•æ¥å£ï¼šæ ¹æ®ä¼ æ¥çš„ç”¨æˆ·åå¯†ç ï¼Œå’Œæ•°æ®åº“ä¸­çš„è¿›è¡ŒåŠ ç›æ¯”å¯¹æ¥åˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸ</p><p>ç½‘å…³ï¼šè§£ætokenï¼Œå°†è§£æå‡ºæ¥çš„userIdæ”¾åˆ°è¯·æ±‚å¤´ä¸­</p><p>nginxï¼šå°†è¯·æ±‚åå‘ä»£ç†åˆ°ç½‘å…³ï¼Œç½‘å…³å†è·¯ç”±åˆ°ç™»å½•æ¥å£</p><h2 id="é¢‘é“ç®¡ç†"><a href="#é¢‘é“ç®¡ç†" class="headerlink" title="é¢‘é“ç®¡ç†"></a>é¢‘é“ç®¡ç†</h2><p>CRUD</p><h2 id="æ•æ„Ÿè¯ç®¡ç†"><a href="#æ•æ„Ÿè¯ç®¡ç†" class="headerlink" title="æ•æ„Ÿè¯ç®¡ç†"></a>æ•æ„Ÿè¯ç®¡ç†</h2><p>CRUD</p><h2 id="ç”¨æˆ·è®¤è¯å®¡æ ¸"><a href="#ç”¨æˆ·è®¤è¯å®¡æ ¸" class="headerlink" title="ç”¨æˆ·è®¤è¯å®¡æ ¸"></a>ç”¨æˆ·è®¤è¯å®¡æ ¸</h2><p>CRUD</p><h2 id="æ–‡ç« äººå·¥å®¡æ ¸"><a href="#æ–‡ç« äººå·¥å®¡æ ¸" class="headerlink" title="æ–‡ç« äººå·¥å®¡æ ¸"></a>æ–‡ç« äººå·¥å®¡æ ¸</h2><p>CRUD</p><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><h2 id="æŒç»­é›†æˆ"><a href="#æŒç»­é›†æˆ" class="headerlink" title="æŒç»­é›†æˆ"></a>æŒç»­é›†æˆ</h2><p>æŒç»­é›†æˆï¼ˆ Continuous integration ï¼Œ ç®€ç§° CI ï¼‰æŒ‡çš„æ˜¯ï¼Œé¢‘ç¹åœ°ï¼ˆä¸€å¤©å¤šæ¬¡ï¼‰å°†ä»£ç é›†æˆåˆ°ä¸»å¹²</p><p>ä¸€ä¸ªè‡ªåŠ¨æ„å»ºè¿‡ç¨‹ï¼Œ ä»æ£€å‡ºä»£ç ã€ ç¼–è¯‘æ„å»ºã€ è¿è¡Œæµ‹è¯•ã€ ç»“æœè®°å½•ã€ æµ‹è¯•ç»Ÿè®¡ç­‰éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œ æ— éœ€äººå·¥å¹²é¢„ã€‚</p><h3 id="çŸ¥è¯†ç‚¹-6"><a href="#çŸ¥è¯†ç‚¹-6" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h4><p>Jenkins  æ˜¯ä¸€æ¬¾æµè¡Œçš„å¼€æºæŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰å·¥å…·ï¼Œå¹¿æ³›ç”¨äºé¡¹ç›®å¼€å‘ï¼Œå…·æœ‰è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰åŠŸèƒ½</p><p><a href="http://jenkins-ci.org/">http://jenkins-ci.org/</a></p><p>æµç¨‹ï¼šæäº¤ä»£ç åˆ°git -&gt; jenkinsæ‹‰å–ä»£ç ï¼Œä½¿ç”¨jdkã€mavenç­‰å¯¹ä»£ç è¿›è¡Œç¼–è¯‘ã€æ‰“åŒ…ç­‰æ“ä½œ -&gt; æœ€åæŠŠç”Ÿæˆçš„jaræˆ–waråˆ†å‘åˆ°æœåŠ¡å™¨ä¸Š</p><p><strong>å®‰è£…</strong></p><blockquote><p>centos7</p></blockquote><p>yumå®‰è£…</p><ol><li><p>æ·»åŠ å®‰è£…æº</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo --no-check-certificate<br><br>sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key<br></code></pre></td></tr></table></figure></li><li><p>å‘½ä»¤å®‰è£…</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install jenkins<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/sysconfig/jenkins<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä¸ºå¯¹åº”çš„ç›®æ ‡ç”¨æˆ·ï¼Œ è¿™é‡Œä½¿ç”¨çš„æ˜¯root</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">JENKINS_USER=<span class="hljs-string">&quot;root&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æœåŠ¡ç›‘å¬ç«¯å£</span><br>JENKINS_PORT=&quot;16060&quot;<br></code></pre></td></tr></table></figure> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ç›®å½•æƒé™</span><br><br>chown -R root:root /var/lib/jenkins<br>chown -R root:root /var/cache/jenkins<br>chown -R root:root /var/log/jenkins<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart jenkins<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœæŠ¥é”™</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Starting Jenkins bash: /usr/bin/java: No such file or directory</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">éœ€è¦åˆ›å»ºjavaç¯å¢ƒçš„è½¯é“¾æ¥</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ln</span> -s /usr/local/jdk/bin/java /usr/bin/java</span><br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®æ§åˆ¶å°</p><p> <a href="http://192.168.200.100:16060/">http://192.168.200.100:16060/</a></p><p> è·å–ç®¡ç†å¯†ç </p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /var/lib/jenkins/secrets/initialAdminPassword<br></code></pre></td></tr></table></figure></li></ol><p><strong>å®‰è£…æ’ä»¶</strong></p><p>jenkinsçš„åŠŸèƒ½éœ€è¦å®‰è£…æ’ä»¶æ¥æ·»åŠ </p><p>å®‰è£…æ–¹å¼ï¼š</p><ol><li><p>è¿›å…¥ã€ç³»ç»Ÿç®¡ç†ã€‘-ã€æ’ä»¶ç®¡ç†ã€‘</p></li><li><p>ç‚¹å‡»æ ‡ç­¾é¡µçš„ã€å¯é€‰æ’ä»¶ã€‘</p></li></ol><p><strong>å®‰è£…ç¯å¢ƒ</strong></p><p>åœ¨linuxç³»ç»Ÿä¸­å®‰è£…jdkã€gitã€mavenç­‰åº”ç”¨</p><p>ç„¶ååˆ°æ§åˆ¶å°çš„Manager Jenkinsçš„Global Tools Configurationä¸­æŒ‡å®šæ‰€åœ¨ä½ç½®</p><h4 id="å¤šç¯å¢ƒå¼€å‘"><a href="#å¤šç¯å¢ƒå¼€å‘" class="headerlink" title="å¤šç¯å¢ƒå¼€å‘"></a>å¤šç¯å¢ƒå¼€å‘</h4><ul><li>Development ï¼šå¼€å‘ç¯å¢ƒ</li><li>Production ï¼šç”Ÿäº§ç¯å¢ƒ</li><li>Test ï¼šæµ‹è¯•ç¯å¢ƒ</li></ul><p>æ·»åŠ é…ç½®æŒ‡å®šä½¿ç”¨å“ªä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">profiles:</span><br><span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br></code></pre></td></tr></table></figure><p>åœ¨nacosä¸­æ·»åŠ <code>$&#123;spring.application.name&#125;-ç¯å¢ƒ.yml</code>æ¥è®¾ç½®ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶</p><h4 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><ol><li>ä»£ç æäº¤åˆ°è¿œç¨‹ä»“åº“</li><li>Jenkinsæ‹‰å–ä»£ç ï¼Œç”¨mavenæ‰“åŒ…ï¼Œdockerfileåˆ›å»ºé•œåƒ</li><li>æœåŠ¡å™¨ä¸Šè¿è¡Œå®¹å™¨</li></ol><p>(ç¤ºä¾‹)</p><p>æ·»åŠ mavenæ’ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆé•œåƒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>heima-leadnews-user<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>$&#123;java.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>$&#123;java.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>$&#123;docker.image&#125;/$&#123;project.artifactId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">buildArgs</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">JAR_FILE</span>&gt;</span>target/$&#123;project.build.finalName&#125;.jar<span class="hljs-tag">&lt;/<span class="hljs-name">JAR_FILE</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">buildArgs</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ Dockerfile</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs txt"># è®¾ç½®JAVAç‰ˆæœ¬<br>FROM java:8<br># æŒ‡å®šå­˜å‚¨å·, ä»»ä½•å‘/tmpå†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•åˆ°å®¹å™¨å­˜å‚¨å±‚<br>VOLUME /tmp<br># æ‹·è´è¿è¡ŒJARåŒ…<br>ARG JAR_FILE<br>COPY $&#123;JAR_FILE&#125; app.jar<br># è®¾ç½®JVMè¿è¡Œå‚æ•°ï¼Œ è¿™é‡Œé™å®šä¸‹å†…å­˜å¤§å°ï¼Œå‡å°‘å¼€é”€<br>ENV JAVA_OPTS=&quot;\<br>-server \<br>-Xms256m \<br>-Xmx512m \<br>-XX:MetaspaceSize=256m \<br>-XX:MaxMetaspaceSize=512m&quot;<br>#ç©ºå‚æ•°ï¼Œæ–¹ä¾¿åˆ›å»ºå®¹å™¨æ—¶ä¼ å‚<br>ENV PARAMS=&quot;&quot;<br># å…¥å£ç‚¹ï¼Œ æ‰§è¡ŒJAVAè¿è¡Œå‘½ä»¤<br>ENTRYPOINT [&quot;sh&quot;,&quot;-c&quot;,&quot;java -jar $JAVA_OPTS /app.jar $PARAMS&quot;]<br></code></pre></td></tr></table></figure><p>å°†å·¥ç¨‹ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“</p><p>Jenkinså·¥ä½œå° -&gt; æ–°å»ºItem -&gt; Freestyle project</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beançš„ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="/2023/06/13/spring/bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <url>/2023/06/13/spring/bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="beançš„ç”Ÿå‘½å‘¨æœŸ"></a>beançš„ç”Ÿå‘½å‘¨æœŸ</h1><p>BV1L14y1S7cfçš„ç¬”è®°</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><h3 id="äº”æ­¥éª¤ç‰ˆæœ¬"><a href="#äº”æ­¥éª¤ç‰ˆæœ¬" class="headerlink" title="äº”æ­¥éª¤ç‰ˆæœ¬"></a>äº”æ­¥éª¤ç‰ˆæœ¬</h3><ol><li>å®ä¾‹åŒ–ï¼šåˆ›å»ºå¯¹è±¡</li><li>ä¾èµ–æ³¨å…¥ï¼šç»™æˆå‘˜å˜é‡èµ‹å€¼</li><li>åˆå§‹åŒ–ï¼šæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•</li><li>ä½¿ç”¨</li><li>é”€æ¯</li></ol><p><strong>ä¾‹å­</strong></p><p>Dogç±»ï¼Œæœ‰æˆå‘˜å˜é‡nameï¼Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Dog</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;1. å®ä¾‹åŒ–&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Dog</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;2. ä¾èµ–æ³¨å…¥&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myInit</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;3. åˆå§‹åŒ–&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myDestroy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;5. é”€æ¯bean&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡é…ç½®æ–‡ä»¶å°†Dogç±»äº¤ç»™Springç®¡ç†ï¼Œå¹¶æŒ‡å®šåˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ï¼Œè¿˜æœ‰ç»™æˆå‘˜å˜é‡èµ‹å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.bean.Dog&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;myInit&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;myDestroy&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ—ºè´¢&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;spring.xml&quot;</span>);<br>        <span class="hljs-type">Dog</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> applicationContext.getBean(Dog.class);<br>        System.out.println(<span class="hljs-string">&quot;4.ä½¿ç”¨bean&quot;</span>);<br>        applicationContext.close();<br>    &#125;<br>&#125;<br><span class="hljs-comment">// æ‰“å°</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    1. å®ä¾‹åŒ–</span><br><span class="hljs-comment">    2. ä¾èµ–æ³¨å…¥</span><br><span class="hljs-comment">    3. åˆå§‹åŒ–</span><br><span class="hljs-comment">    4.ä½¿ç”¨bean</span><br><span class="hljs-comment">    5. é”€æ¯bean</span><br><span class="hljs-comment">    æ—ºè´¢</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h3 id="ä¸ƒæ­¥éª¤ç‰ˆæœ¬"><a href="#ä¸ƒæ­¥éª¤ç‰ˆæœ¬" class="headerlink" title="ä¸ƒæ­¥éª¤ç‰ˆæœ¬"></a>ä¸ƒæ­¥éª¤ç‰ˆæœ¬</h3><ol><li><p>å®ä¾‹åŒ–ï¼šåˆ›å»ºå¯¹è±¡</p></li><li><p>ä¾èµ–æ³¨å…¥ï¼šç»™æˆå‘˜å˜é‡èµ‹å€¼</p><p><font color='red'>åˆå§‹åŒ–å‰æ‰§è¡Œ BeanPostProcessor beforeæ–¹æ³•</font></p></li><li><p>åˆå§‹åŒ–ï¼šæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•</p><p><font color='red'>åˆå§‹åŒ–å‰æ‰§è¡Œ BeanPostProcessor afteræ–¹æ³•</font></p></li><li><p>ä½¿ç”¨</p></li><li><p>é”€æ¯</p></li></ol><p><strong>ä¾‹å­</strong></p><p>åˆ›å»ºè‡ªå®šä¹‰çš„Beanåç½®å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> Dog &amp;&amp; <span class="hljs-string">&quot;dog&quot;</span>.equals(beanName))<br>            System.out.println(<span class="hljs-string">&quot;    æ‰§è¡Œåç½®å¤„ç†å™¨çš„beforeæ–¹æ³•&quot;</span>);<br>        <span class="hljs-keyword">return</span> BeanPostProcessor.<span class="hljs-built_in">super</span>.postProcessBeforeInitialization(bean, beanName);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> Dog &amp;&amp; <span class="hljs-string">&quot;dog&quot;</span>.equals(beanName))<br>            System.out.println(<span class="hljs-string">&quot;    æ‰§è¡Œåç½®å¤„ç†å™¨çš„afteræ–¹æ³•&quot;</span>);<br>        <span class="hljs-keyword">return</span> BeanPostProcessor.<span class="hljs-built_in">super</span>.postProcessAfterInitialization(bean, beanName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>äº¤ç»™Springç®¡ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.bean.Dog&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;myInit&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;myDestroy&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ—ºè´¢&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myBeanPostProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.bean.MyBeanPostProcessor&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰“å°</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    1. å®ä¾‹åŒ–</span><br><span class="hljs-comment">    2. ä¾èµ–æ³¨å…¥</span><br><span class="hljs-comment">        æ‰§è¡Œåç½®å¤„ç†å™¨çš„beforeæ–¹æ³•</span><br><span class="hljs-comment">    3. åˆå§‹åŒ–</span><br><span class="hljs-comment">        æ‰§è¡Œåç½®å¤„ç†å™¨çš„afteræ–¹æ³•</span><br><span class="hljs-comment">    4.ä½¿ç”¨bean</span><br><span class="hljs-comment">    5. é”€æ¯bean</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h3 id="åæ­¥éª¤ç‰ˆæœ¬"><a href="#åæ­¥éª¤ç‰ˆæœ¬" class="headerlink" title="åæ­¥éª¤ç‰ˆæœ¬"></a>åæ­¥éª¤ç‰ˆæœ¬</h3><ol><li><p>å®ä¾‹åŒ–ï¼šåˆ›å»ºå¯¹è±¡</p></li><li><p>ä¾èµ–æ³¨å…¥ï¼šç»™æˆå‘˜å˜é‡èµ‹å€¼</p><p><font color='blue'>æ‰§è¡Œå›è°ƒå‡½æ•°â€¦Aware</font></p><p><font color='red'>åˆå§‹åŒ–å‰æ‰§è¡Œ BeanPostProcessor beforeæ–¹æ³•</font></p><p><font color='blue'>æ‰§è¡Œæ­£åœ¨åˆå§‹åŒ–beanå‡½æ•°</font></p></li><li><p>åˆå§‹åŒ–ï¼šæ‰§è¡Œè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•</p><p><font color='red'>åˆå§‹åŒ–å‰æ‰§è¡Œ BeanPostProcessor afteræ–¹æ³•</font></p></li><li><p>ä½¿ç”¨</p><p><font color='blue'>æ‰§è¡Œé”€æ¯beanæ–¹æ³•</font></p></li><li><p>é”€æ¯</p></li></ol><p><strong>ä¾‹å­</strong></p><p>å®ç°BeanNameAware, InitializingBean, DisposableBeanæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanNameAware</span>, InitializingBean, DisposableBean &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Dog</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;1. å®ä¾‹åŒ–&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Dog</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;2. ä¾èµ–æ³¨å…¥&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myInit</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;3. åˆå§‹åŒ–&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myDestroy</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;5. é”€æ¯bean&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;    æ‰§è¡Œå›è°ƒå‡½æ•°&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;    æ‰§è¡Œæ­£åœ¨åˆå§‹åŒ–beanå‡½æ•°&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;    æ‰§è¡Œé”€æ¯beanæ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰“å°</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">1. å®ä¾‹åŒ–</span><br><span class="hljs-comment">2. ä¾èµ–æ³¨å…¥</span><br><span class="hljs-comment">    æ‰§è¡Œå›è°ƒå‡½æ•°</span><br><span class="hljs-comment">    æ‰§è¡Œåç½®å¤„ç†å™¨çš„beforeæ–¹æ³•</span><br><span class="hljs-comment">    æ‰§è¡Œæ­£åœ¨åˆå§‹åŒ–beanå‡½æ•°</span><br><span class="hljs-comment">3. åˆå§‹åŒ–</span><br><span class="hljs-comment">    æ‰§è¡Œåç½®å¤„ç†å™¨çš„afteræ–¹æ³•</span><br><span class="hljs-comment">4.ä½¿ç”¨bean</span><br><span class="hljs-comment">    æ‰§è¡Œé”€æ¯beanæ–¹æ³•</span><br><span class="hljs-comment">5. é”€æ¯bean</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º 0</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="InitializingBeanä½œç”¨"><a href="#InitializingBeanä½œç”¨" class="headerlink" title="InitializingBeanä½œç”¨"></a>InitializingBeanä½œç”¨</h2><p>InitializingBeançš„afterPropertiesSet()æ˜¯åœ¨ä¾èµ–æ³¨å…¥å®Œã€æ‰§è¡Œå®Œå›è°ƒã€æ‰§è¡Œå®Œåå¤„ç†å™¨çš„beforeåè°ƒç”¨çš„ã€‚è¿™ä¸ªæ—¶å€™æˆå‘˜å˜é‡å·²ç»å®ä¾‹åŒ–å®Œï¼Œå¯ä»¥é€šè¿‡afterPropertiesSet()æ–¹æ³•æ¥ç»™å˜é‡è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ</p><p>å¦‚ï¼š</p><ol><li>æ•°æ®åº“è¿æ¥æ± çš„åˆå§‹åŒ–<br>åœ¨è¿æ¥æ± çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£ï¼Œåœ¨Beanåˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨è°ƒç”¨afterPropertiesSet()æ–¹æ³•ï¼Œè¿›è¡Œè¿æ¥æ± çš„åˆå§‹åŒ–å·¥ä½œã€‚</li><li>é…ç½®æ–‡ä»¶åŠ è½½<br>åœ¨Springä¸­ï¼Œå¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£ï¼Œä½¿ç”¨afterPropertiesSet()æ–¹æ³•ï¼Œåœ¨Beanå±æ€§è®¾ç½®å®Œæˆåï¼Œè¿›è¡Œé…ç½®æ–‡ä»¶çš„åŠ è½½å·¥ä½œï¼Œä»è€Œå‡å°‘äº†ä»£ç é‡å’Œé…ç½®æ–‡ä»¶çš„åŠ è½½æ—¶é—´ã€‚</li><li>çº¿ç¨‹æ± åˆå§‹åŒ–<br>åœ¨Javaä¸­åˆ›å»ºçº¿ç¨‹æ± æ—¶ï¼Œå¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£ï¼Œä½¿ç”¨afterPropertiesSet()æ–¹æ³•ï¼Œåœ¨Beanå±æ€§è®¾ç½®å®Œæˆåï¼Œè¿›è¡Œçº¿ç¨‹æ± çš„åˆå§‹åŒ–å·¥ä½œã€‚</li><li>æ•°æ®åˆå§‹åŒ–<br>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦åœ¨Beanåˆå§‹åŒ–å®Œæˆåï¼Œè¿›è¡Œæ•°æ®åˆå§‹åŒ–çš„æ“ä½œã€‚å¯ä»¥é€šè¿‡å®ç°InitializingBeanæ¥å£ï¼Œåœ¨Beanå±æ€§è®¾ç½®å®Œæˆåï¼Œä½¿ç”¨afterPropertiesSet()æ–¹æ³•ï¼Œè¿›è¡Œç›¸å…³æ•°æ®çš„åˆå§‹åŒ–å·¥ä½œã€‚</li></ol><h2 id="BeanPostProcessorä½œç”¨"><a href="#BeanPostProcessorä½œç”¨" class="headerlink" title="BeanPostProcessorä½œç”¨"></a>BeanPostProcessorä½œç”¨</h2><p>BeanPostProcessoræ˜¯Spring IoCå®¹å™¨æä¾›çš„ä¸€ä¸ªæ‰©å±•æ¥å£ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨Spring IoCå®¹å™¨å®ä¾‹åŒ–Beanå¯¹è±¡åï¼Œå¯¹å…¶è¿›è¡ŒåŠ å·¥å’Œè£…é¥°ï¼Œæ·»åŠ åŠŸèƒ½</p><p>å¦‚ï¼š</p><ol><li>AOPä»£ç†<br>é€šè¿‡beforeæˆ–afteræ–¹æ³•ï¼Œåœ¨Beanå¯¹è±¡è£…é…ä¹‹åï¼Œå¯¹Beanå¯¹è±¡è¿›è¡ŒAOPä»£ç†ï¼Œä»è€Œåœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹Beanå¯¹è±¡çš„å¢å¼ºæˆ–åˆ‡é¢æ“ä½œï¼Œå¦‚äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringSecurity</title>
    <link href="/2023/06/06/spring/SpringSecurity/"/>
    <url>/2023/06/06/spring/SpringSecurity/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h2><p>SpringSecurityæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¯é«˜åº¦å®šåˆ¶çš„è®¤è¯å’Œæˆæƒæ¡†æ¶ï¼Œå¯¹äºSpringåº”ç”¨æ¥è¯´å®ƒæ˜¯ä¸€å¥—Webå®‰å…¨æ ‡å‡†</p><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="/img/spring_img/%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.png" alt="è®¤è¯æµç¨‹"> </p><p><img src="/img/spring_img/%E9%89%B4%E6%9D%83%E6%B5%81%E7%A8%8B.png" alt="é‰´æƒæµç¨‹"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å®ä¾‹</p><p>è¯¦ç»†è§ â€“&gt; <a href="https://github.com/Xwww12/mall-learning.git%E7%9A%84%60%E6%95%B4%E5%90%88SpringSecurity%60%E7%9A%84tag">https://github.com/Xwww12/mall-learning.gitçš„`æ•´åˆSpringSecurity`çš„tag</a></p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--SpringSecurity--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--JWT--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™SpringSecurityé…ç½®ç±»</p><blockquote><p>ä¸»è¦é…ç½®ï¼šéœ€è¦é‰´æƒçš„è®¿é—®è·¯å¾„ã€è·å–ç”¨æˆ·ä¿¡æ¯æ–¹å¼ã€å¯†ç è®¤è¯æ–¹å¼ã€è®¤è¯tokenæ–¹å¼ã€è‡ªå®šä¹‰æœªæˆæƒå’Œæœªç™»å½•ç»“æœçš„è¿”å›</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br><br>    <span class="hljs-meta">@Lazy</span>   <span class="hljs-comment">// é˜²æ­¢åµŒå¥—</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IUmsAdminService adminService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestfulAccessDeniedHandler restfulAccessDeniedHandler;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestAuthenticationEntryPoint restAuthenticationEntryPoint;<br><br>    <span class="hljs-comment">// ç”¨äºé…ç½®éœ€è¦æ‹¦æˆªçš„urlè·¯å¾„ã€jwtè¿‡æ»¤å™¨åŠå‡ºå¼‚å¸¸åçš„å¤„ç†å™¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity httpSecurity)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        httpSecurity.csrf()<br>            .disable()<br>            .sessionManagement()<span class="hljs-comment">// åŸºäºtokenï¼Œæ‰€ä»¥ä¸éœ€è¦session</span><br>            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)<br>            .and()<br>            .authorizeRequests()<br>            .antMatchers(HttpMethod.GET, <span class="hljs-comment">// å…è®¸å¯¹äºç½‘ç«™é™æ€èµ„æºçš„æ— æˆæƒè®¿é—®</span><br>                         <span class="hljs-string">&quot;/&quot;</span>,<br>                         <span class="hljs-string">&quot;/*.html&quot;</span>,<br>                         <span class="hljs-string">&quot;/favicon.ico&quot;</span>,<br>                         <span class="hljs-string">&quot;/**/*.html&quot;</span>,<br>                         <span class="hljs-string">&quot;/**/*.css&quot;</span>,<br>                         <span class="hljs-string">&quot;/**/*.js&quot;</span>,<br>                         <span class="hljs-string">&quot;/swagger-resources/**&quot;</span>,<br>                         <span class="hljs-string">&quot;/v2/api-docs/**&quot;</span><br>                        )<br>            .permitAll()<br>            .antMatchers(<span class="hljs-string">&quot;/admin/login&quot;</span>, <span class="hljs-string">&quot;/admin/register&quot;</span>)<span class="hljs-comment">// å¯¹ç™»å½•æ³¨å†Œè¦å…è®¸åŒ¿åè®¿é—®</span><br>            .permitAll()<br>            .antMatchers(HttpMethod.OPTIONS)<span class="hljs-comment">//è·¨åŸŸè¯·æ±‚ä¼šå…ˆè¿›è¡Œä¸€æ¬¡optionsè¯·æ±‚</span><br>            .permitAll()<br>            <span class="hljs-comment">//                .antMatchers(&quot;/**&quot;)//æµ‹è¯•æ—¶å…¨éƒ¨è¿è¡Œè®¿é—®</span><br>            <span class="hljs-comment">//                .permitAll()</span><br>            .anyRequest()<span class="hljs-comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span><br>            .authenticated();<br>        <span class="hljs-comment">// ç¦ç”¨ç¼“å­˜</span><br>        httpSecurity.headers().cacheControl();<br>        <span class="hljs-comment">// æ·»åŠ JWT filter</span><br>        httpSecurity.addFilterBefore(jwtAuthenticationTokenFilter(), UsernamePasswordAuthenticationFilter.class);<br>        <span class="hljs-comment">//æ·»åŠ è‡ªå®šä¹‰æœªæˆæƒå’Œæœªç™»å½•ç»“æœè¿”å›</span><br>        httpSecurity.exceptionHandling()<br>            .accessDeniedHandler(restfulAccessDeniedHandler)<br>            .authenticationEntryPoint(restAuthenticationEntryPoint);<br>    &#125;<br><br>    <span class="hljs-comment">// ç”¨äºé…ç½®UserDetailsServiceåŠPasswordEncoder</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService())<br>            .passwordEncoder(passwordEncoder());<br>    &#125;<br><br>    <span class="hljs-comment">// SpringSecurityå®šä¹‰çš„ç”¨äºå¯¹å¯†ç è¿›è¡Œç¼–ç åŠæ¯”å¯¹çš„æ¥å£</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// ç”¨äºæ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">userDetailsService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> username -&gt; &#123;<br>            <span class="hljs-type">UmsAdmin</span> <span class="hljs-variable">admin</span> <span class="hljs-operator">=</span> adminService.getAdminByUsername(username);<br>            <span class="hljs-keyword">if</span> (admin != <span class="hljs-literal">null</span>) &#123;<br>                List&lt;UmsPermission&gt; permissionList = adminService.getPermissionList(admin.getId());<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdminUserDetails</span>(admin,permissionList);<br>            &#125;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-comment">// åœ¨ç”¨æˆ·åå’Œå¯†ç æ ¡éªŒå‰æ·»åŠ çš„è¿‡æ»¤å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> JwtAuthenticationTokenFilter <span class="hljs-title function_">jwtAuthenticationTokenFilter</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JwtAuthenticationTokenFilter</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> AuthenticationManager <span class="hljs-title function_">authenticationManagerBean</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.authenticationManagerBean();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å½“è®¿é—®æ¥å£æ²¡æœ‰æƒé™æ—¶ï¼Œè‡ªå®šä¹‰çš„è¿”å›ç»“æœ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestfulAccessDeniedHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccessDeniedHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        response.setContentType(<span class="hljs-string">&quot;application/json&quot;</span>);<br>        response.getWriter().println(JSONUtil.parse(CommonResult.forbidden(e.getMessage())));<br>        response.getWriter().flush();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å½“æœªç™»å½•æˆ–è€…tokenå¤±æ•ˆè®¿é—®æ¥å£æ—¶ï¼Œè‡ªå®šä¹‰çš„è¿”å›ç»“æœ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestAuthenticationEntryPoint</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AuthenticationEntryPoint</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commence</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        response.setContentType(<span class="hljs-string">&quot;application/json&quot;</span>);<br>        response.getWriter().println(JSONUtil.parse(CommonResult.unauthorized(authException.getMessage())));<br>        response.getWriter().flush();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>è‡ªå®šä¹‰çš„ç”¨æˆ·ä¿¡æ¯ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminUserDetails</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetails</span> &#123;<br>    <span class="hljs-keyword">private</span> UmsAdmin umsAdmin;<br>    <span class="hljs-keyword">private</span> List&lt;UmsPermission&gt; permissionList;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AdminUserDetails</span><span class="hljs-params">(UmsAdmin umsAdmin, List&lt;UmsPermission&gt; permissionList)</span> &#123;<br>        <span class="hljs-built_in">this</span>.umsAdmin = umsAdmin;<br>        <span class="hljs-built_in">this</span>.permissionList = permissionList;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;<br>        <span class="hljs-comment">// è·å–å½“å‰ç”¨æˆ·æƒé™</span><br>        <span class="hljs-keyword">return</span> permissionList.stream()<br>            .filter(permissionList -&gt; permissionList.getValue() != <span class="hljs-literal">null</span>)<br>            .map(permission -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleGrantedAuthority</span>(permission.getValue()))<br>            .collect(Collectors.toList());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> umsAdmin.getPassword();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> umsAdmin.getUsername();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonLocked</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCredentialsNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEnabled</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> umsAdmin.getStatus().equals(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>éªŒè¯token</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtAuthenticationTokenFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(JwtAuthenticationTokenFilter.class);<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> JwtTokenUtil jwtTokenUtil;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.tokenHeader&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String tokenHeader;<span class="hljs-comment">// Authorization</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.tokenHead&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String tokenHead;<span class="hljs-comment">// Bearer</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request,</span><br><span class="hljs-params">                                    HttpServletResponse response,</span><br><span class="hljs-params">                                    FilterChain chain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">authHeader</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-built_in">this</span>.tokenHeader);<br>        <span class="hljs-keyword">if</span> (authHeader != <span class="hljs-literal">null</span> &amp;&amp; authHeader.startsWith(<span class="hljs-built_in">this</span>.tokenHead)) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">authToken</span> <span class="hljs-operator">=</span> authHeader.substring(<span class="hljs-built_in">this</span>.tokenHead.length());<span class="hljs-comment">// The part after &quot;Bearer &quot;</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> jwtTokenUtil.getUserNameFromToken(authToken);<br>            LOGGER.info(<span class="hljs-string">&quot;checking username:&#123;&#125;&quot;</span>, username);<br>            <span class="hljs-keyword">if</span> (username != <span class="hljs-literal">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.userDetailsService.loadUserByUsername(username);<br>                <span class="hljs-keyword">if</span> (jwtTokenUtil.validateToken(authToken, userDetails)) &#123;<br>                    <span class="hljs-type">UsernamePasswordAuthenticationToken</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(userDetails, <span class="hljs-literal">null</span>, userDetails.getAuthorities());<br>                    authentication.setDetails(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));<br>                    LOGGER.info(<span class="hljs-string">&quot;authenticated user:&#123;&#125;&quot;</span>, username);<br>                    SecurityContextHolder.getContext().setAuthentication(authentication);<br>                &#125;<br>            &#125;<br>        &#125;<br>        chain.doFilter(request, response);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœ¨éœ€è¦é‰´æƒçš„æ–¹æ³•ä¸Šæ·»åŠ </span><br><span class="hljs-meta">@PreAuthorize(&quot;hasAuthority(&#x27;pms:brand:read&#x27;)&quot;)</span><br></code></pre></td></tr></table></figure></li><li><p>æ³¨æ„</p><blockquote><p>å¦‚æœä½¿ç”¨äº†swagger<br>åœ¨é…ç½®Docketæ—¶<br>securitySchemesè¦ä¼ å…¥éœ€è¦ç™»å½•è®¤è¯çš„è·¯å¾„ï¼Œå¦åˆ™ä¸ä¼šä¸»åŠ¨å¸¦ä¸Šå¤´ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;SecurityContext&gt; <span class="hljs-title function_">securityContexts</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//è®¾ç½®éœ€è¦ç™»å½•è®¤è¯çš„è·¯å¾„</span><br>    List&lt;SecurityContext&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    result.add(getContextByPath(<span class="hljs-string">&quot;/brand/.*&quot;</span>));<br>    result.add(getContextByPath(<span class="hljs-string">&quot;/admin/.*&quot;</span>));<br>    result.add(getContextByPath(<span class="hljs-string">&quot;/esProduct/.*&quot;</span>));<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>åœºæ™¯ï¼šå‰ç«¯ä¼ æ¥ç”¨æˆ·åå’Œå¯†ç ï¼Œåå°è®¤è¯åè¿”å›tokenå¹¶æŠŠç”¨æˆ·ä¿¡æ¯å­˜åˆ°redisä¸­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;userName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xw&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1234&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI3YTgzYmM3NGNjOTQ0ZDgxOTExZjQ3YTgxMGYyMTk2MiIsInN1YiI6IjEiLCJpc3MiOiJ4dyIsImlhdCI6MTY3ODk1NDk2NiwiZXhwIjoxNjc5MDQxMzY2fQ.OqHhpCJBQX_L5pMTWexnm23DJ69tIPMyETSNMAji0b8&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;userInfoVo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;avatar&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F3bf9c263bc0f2ac5c3a7feb9e218d07475573ec8.gi&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;23412332@qq.com&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;nickName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xw123&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ“ä½œæˆåŠŸ&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h4><h5 id="æµç¨‹-1"><a href="#æµç¨‹-1" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h5><p><img src="/img/spring_img/%E5%A4%A7%E8%87%B4%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B.png"> </p><h5 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h5><p>Userï¼Œæ˜ å°„æ•°æ®åº“è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@TableName(&quot;sys_user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-comment">//ä¸»é”®</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">//ç”¨æˆ·å</span><br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-comment">//æ˜µç§°</span><br>    <span class="hljs-keyword">private</span> String nickName;<br>    <span class="hljs-comment">//å¯†ç </span><br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-comment">//ç”¨æˆ·ç±»å‹ï¼š0ä»£è¡¨æ™®é€šç”¨æˆ·ï¼Œ1ä»£è¡¨ç®¡ç†å‘˜</span><br>    <span class="hljs-keyword">private</span> String type;<br>    <span class="hljs-comment">//è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰</span><br>    <span class="hljs-keyword">private</span> String status;<br>    <span class="hljs-comment">//é‚®ç®±</span><br>    <span class="hljs-keyword">private</span> String email;<br>    <span class="hljs-comment">//æ‰‹æœºå·</span><br>    <span class="hljs-keyword">private</span> String phonenumber;<br>    <span class="hljs-comment">//ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰</span><br>    <span class="hljs-keyword">private</span> String sex;<br>    <span class="hljs-comment">//å¤´åƒ</span><br>    <span class="hljs-keyword">private</span> String avatar;<br>    <span class="hljs-comment">//åˆ›å»ºäººçš„ç”¨æˆ·id</span><br>    <span class="hljs-keyword">private</span> Long createBy;<br>    <span class="hljs-comment">//åˆ›å»ºæ—¶é—´</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-comment">//æ›´æ–°äºº</span><br>    <span class="hljs-keyword">private</span> Long updateBy;<br>    <span class="hljs-comment">//æ›´æ–°æ—¶é—´</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-comment">//åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰</span><br>    <span class="hljs-keyword">private</span> Integer delFlag;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°UserDetails</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetails</span> &#123;<br><br>    <span class="hljs-keyword">private</span> User user;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> user.getPassword();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> user.getUserName();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonLocked</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCredentialsNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEnabled</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>BlogUserLoginVoï¼Œè¿”å›å‰ç«¯çš„Vo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogUserLoginVo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String token;<br><br>    <span class="hljs-keyword">private</span> UserInfoVo userInfoVo;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Accessors(chain = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfoVo</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸»é”®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜µç§°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String nickName;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤´åƒ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String avatar;<br><br>    <span class="hljs-keyword">private</span> String sex;<br><br>    <span class="hljs-keyword">private</span> String email;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å®ç°UserDetailsService"><a href="#å®ç°UserDetailsService" class="headerlink" title="å®ç°UserDetailsService"></a>å®ç°UserDetailsService</h5><p>ç”¨äºæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›UserDetailsï¼Œè¢«AuthenticationManageræ‰€è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ›¿æ¢é»˜è®¤çš„SpringSecurityçš„è·å–èº«ä»½ä¿¡æ¯æ–¹å¼</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;()<br>                                         .eq(User::getUserName, username));<br>        <span class="hljs-keyword">if</span> (Objects.isNull(user)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// TODO æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯</span><br><br>        <span class="hljs-comment">// è¿”å›ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginUser</span>(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="SpringSecurityé…ç½®ç±»"><a href="#SpringSecurityé…ç½®ç±»" class="headerlink" title="SpringSecurityé…ç½®ç±»"></a>SpringSecurityé…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        http<br>            <span class="hljs-comment">// å…³é—­csrfé˜²èŒƒ</span><br>            .csrf().disable()<br>            <span class="hljs-comment">// ä¸é€šè¿‡Sessionè·å–SecurityContext</span><br>            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)<br>            .and()<br>            .authorizeRequests()<br>            <span class="hljs-comment">// å…è®¸åŒ¿åè®¿é—®çš„æ¥å£</span><br>            .antMatchers(<span class="hljs-string">&quot;/login&quot;</span>).anonymous()<br>            .anyRequest().permitAll();<br>        http.logout().disable();<br>        <span class="hljs-comment">// å…è®¸è·¨åŸŸ</span><br>        http.cors();<br>    &#125;<br><br>    <span class="hljs-comment">// å¯†ç ç¼–ç å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// æ³¨å…¥èº«ä»½è®¤è¯å™¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> AuthenticationManager <span class="hljs-title function_">authenticationManagerBean</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.authenticationManagerBean();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h5><p>é€šè¿‡èº«ä»½è®¤è¯å™¨è¿›è¡Œèº«ä»½éªŒè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogLoginServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlogLoginService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AuthenticationManager authenticationManager;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisCache redisCache;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">login</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºç”¨äºç”¨æˆ·èº«ä»½è®¤è¯çš„token</span><br>        <span class="hljs-type">UsernamePasswordAuthenticationToken</span> <span class="hljs-variable">authenticationToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(), user.getPassword());<br>        <span class="hljs-comment">// è°ƒç”¨Managerçš„èº«ä»½è®¤è¯æ–¹æ³•å®ç°è®¤è¯</span><br>        <span class="hljs-type">Authentication</span> <span class="hljs-variable">authenticate</span> <span class="hljs-operator">=</span> authenticationManager.authenticate(authenticationToken);<br>        <span class="hljs-keyword">if</span> (Objects.isNull(authenticate)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç å¼‚å¸¸&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// é€šè¿‡ç”¨æˆ·idç”Ÿæˆjwt</span><br>        <span class="hljs-type">LoginUser</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> (LoginUser) authenticate.getPrincipal();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> String.valueOf(loginUser.getUser().getId());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JwtUtil.createJWT(id);<br>        <span class="hljs-comment">// å­˜å…¥redis</span><br>        redisCache.setCacheObject(RedisConstants.CACHE_LOGIN_PREFIX + id, loginUser, RedisConstants.CACHE_TTL, TimeUnit.SECONDS);<br><br>        <span class="hljs-comment">// è¿”å›vo</span><br>        <span class="hljs-type">UserInfoVo</span> <span class="hljs-variable">userInfoVo</span> <span class="hljs-operator">=</span> BeanCopyUtils.copyBean(loginUser.getUser(), UserInfoVo.class);<br>        <span class="hljs-type">BlogUserLoginVo</span> <span class="hljs-variable">blogUserLoginVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlogUserLoginVo</span>(jwt, userInfoVo);<br>        <span class="hljs-keyword">return</span> ResponseResult.okResult(blogUserLoginVo);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogLoginController</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> BlogLoginService blogLoginService;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> blogLoginService.login(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h4><p>æ¯æ¬¡å‘é€è¯·æ±‚æ—¶éƒ½ä¼šåœ¨å“åº”å¤´ä¸­å¸¦ä¸Š<code>token</code>ï¼Œé€šè¿‡è§£ætokenæ¥æ¯”å¯¹redisä¸­ç¼“å­˜çš„ç™»å½•ä¿¡æ¯æ¥è®¤è¯</p><h5 id="è®¤è¯è¿‡æ»¤å™¨"><a href="#è®¤è¯è¿‡æ»¤å™¨" class="headerlink" title="è®¤è¯è¿‡æ»¤å™¨"></a>è®¤è¯è¿‡æ»¤å™¨</h5><p>å·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å‘å‰ç«¯è¿”å›jsonæ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response æ¸²æŸ“å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> string   å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸²</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">renderString</span><span class="hljs-params">(HttpServletResponse response, String string)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            response.setStatus(<span class="hljs-number">200</span>);<br>            response.setContentType(<span class="hljs-string">&quot;application/json&quot;</span>);<br>            response.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>            response.getWriter().print(string);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDownLoadHeader</span><span class="hljs-params">(String filename, ServletContext context, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">mimeType</span> <span class="hljs-operator">=</span> context.getMimeType(filename);<span class="hljs-comment">//è·å–æ–‡ä»¶çš„mimeç±»å‹</span><br>        response.setHeader(<span class="hljs-string">&quot;content-type&quot;</span>, mimeType);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">fname</span> <span class="hljs-operator">=</span> URLEncoder.encode(filename, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        response.setHeader(<span class="hljs-string">&quot;Content-disposition&quot;</span>, <span class="hljs-string">&quot;attachment; filename=&quot;</span> + fname);<br><br><span class="hljs-comment">//        response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);</span><br><span class="hljs-comment">//        response.setCharacterEncoding(&quot;utf-8&quot;);</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£ætoken</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¤è¯è¿‡æ»¤å™¨</span><br><span class="hljs-comment"> * å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°SecurityContextHolder</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtAuthenticationTokenFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisCache redisCache;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            userId = getUserIdFromRequest(request, response, filterChain);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// tokenå·²è¿‡æœŸæˆ–éæ³•</span><br>            log.info(e.getMessage());<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (userId != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// æŸ¥è¯¢redisä¸­æ˜¯å¦æœ‰å¯¹åº”ç”¨æˆ·ä¿¡æ¯</span><br>            <span class="hljs-type">LoginUser</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> redisCache.getCacheObject(RedisConstants.CACHE_LOGIN_PREFIX + userId);<br>            <span class="hljs-keyword">if</span> (Objects.isNull(loginUser)) &#123;<br>                <span class="hljs-comment">// redisä¸­è¿‡æœŸ</span><br>                <span class="hljs-type">ResponseResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);<br>                WebUtils.renderString(response, JSON.toJSONString(result));<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-comment">// å­˜å…¥SecurityContextHolder</span><br>            <span class="hljs-type">UsernamePasswordAuthenticationToken</span> <span class="hljs-variable">authenticationToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>            SecurityContextHolder.getContext().setAuthentication(authenticationToken);<br>        &#125;<br>        filterChain.doFilter(request, response);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getUserIdFromRequest</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-comment">// è·å–è¯·æ±‚å¤´ä¸­çš„token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!StringUtils.hasText(token)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// è§£æå‡ºç”¨æˆ·id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> JwtUtil.parseJWT(token);<br>            userId = claims.getSubject();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-type">ResponseResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);<br>            WebUtils.renderString(response, JSON.toJSONString(result));<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;tokenéæ³•æˆ–å·²è¿‡æœŸ&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> userId;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ·»åŠ è¿‡æ»¤å™¨"><a href="#æ·»åŠ è¿‡æ»¤å™¨" class="headerlink" title="æ·»åŠ è¿‡æ»¤å™¨"></a>æ·»åŠ è¿‡æ»¤å™¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// SpringSecurityé…ç½®ç±»ä¸­æ³¨å…¥è¿‡æ»¤å™¨</span><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> JwtAuthenticationTokenFilter authenticationTokenFilter;<br><br><span class="hljs-comment">// configureæ–¹æ³•ä¸­æ·»åŠ è¿‡æ»¤å™¨åˆ°ç”¨æˆ·åå¯†ç è®¤è¯å‰</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    http<br>        <span class="hljs-comment">// å…³é—­csrfé˜²èŒƒ</span><br>        .csrf().disable()<br>        <span class="hljs-comment">// ä¸é€šè¿‡Sessionè·å–SecurityContext</span><br>        .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)<br>        .and()<br>        .authorizeRequests()<br>        <span class="hljs-comment">// å…è®¸åŒ¿åè®¿é—®çš„æ¥å£</span><br>        .antMatchers(<span class="hljs-string">&quot;/login&quot;</span>).anonymous()<br>        .antMatchers(<span class="hljs-string">&quot;/link/getAllLink&quot;</span>).authenticated()<br>        <span class="hljs-comment">// æ¥å£éƒ½æ— éœ€é‰´æƒ</span><br>        .anyRequest().permitAll();<br>    http.logout().disable();<br>    <span class="hljs-comment">// æ·»åŠ å¯¹jwtè§£æçš„è¿‡æ»¤å™¨</span><br>    http.addFilterBefore(authenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);<br>    <span class="hljs-comment">// å…è®¸è·¨åŸŸ</span><br>    http.cors();<br>&#125;<br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰è¿”å›ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰è®¤è¯å¤±è´¥è¿”å›ç»“æœ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationEntryPointImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AuthenticationEntryPoint</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commence</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        log.warn(e.getMessage());<br>        <span class="hljs-type">ResponseResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> BadCredentialsException) &#123;<br>            result = ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_ERROR.getCode(), e.getMessage());<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> InsufficientAuthenticationException) &#123;<br>            result = ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN.getCode(), e.getMessage());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            result = ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(), <span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>);<br>        &#125;<br>        WebUtils.renderString(response, JSON.toJSONString(result));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰é‰´æƒå¤±è´¥è¿”å›ç»“æœ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccessDeniedHandlerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccessDeniedHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        log.warn(e.getMessage());<br>        <span class="hljs-type">ResponseResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NO_OPERATOR_AUTH);<br>        WebUtils.renderString(response, JSON.toJSONString(result));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ·»åŠ åˆ°é…ç½®ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰è®¤è¯å¼‚å¸¸å¤„ç†å™¨</span><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> AuthenticationEntryPointImpl authenticationEntryPoint;<br><br><span class="hljs-comment">// è‡ªå®šä¹‰é‰´æƒå¼‚å¸¸å¤„ç†å™¨</span><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> AccessDeniedHandlerImpl accessDeniedHandler;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    http<br>        <span class="hljs-comment">// å…³é—­csrfé˜²èŒƒ</span><br>        .csrf().disable()<br>        <span class="hljs-comment">// ä¸é€šè¿‡Sessionè·å–SecurityContext</span><br>        .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)<br>        .and()<br>        .authorizeRequests()<br>        <span class="hljs-comment">// å…è®¸åŒ¿åè®¿é—®çš„æ¥å£</span><br>        .antMatchers(<span class="hljs-string">&quot;/login&quot;</span>).anonymous()<br>        .antMatchers(<span class="hljs-string">&quot;/link/getAllLink&quot;</span>).authenticated()<br>        <span class="hljs-comment">// æ¥å£éƒ½æ— éœ€é‰´æƒ</span><br>        .anyRequest().permitAll();<br>    <span class="hljs-comment">//é…ç½®å¼‚å¸¸å¤„ç†å™¨</span><br>    http.exceptionHandling()<br>        .authenticationEntryPoint(authenticationEntryPoint)<br>        .accessDeniedHandler(accessDeniedHandler);<br><br>    http.logout().disable();<br>    <span class="hljs-comment">// æ·»åŠ å¯¹jwtçš„è¿‡æ»¤å™¨</span><br>    http.addFilterBefore(authenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);<br>    <span class="hljs-comment">// å…è®¸è·¨åŸŸ</span><br>    http.cors();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="å…¨å±€å¼‚å¸¸å¤„ç†"></a>å…¨å±€å¼‚å¸¸å¤„ç†</h4><blockquote><p>è¿™é‡Œè·ŸSpringSecurityæ— å…³</p></blockquote><p>è‡ªå®šä¹‰å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰å¼‚å¸¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;<br><br>    <span class="hljs-keyword">private</span> String msg;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMsg</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SystemException</span><span class="hljs-params">(AppHttpCodeEnum httpCodeEnum)</span> &#123;<br>        <span class="hljs-built_in">super</span>(httpCodeEnum.getMsg());<br>        <span class="hljs-built_in">this</span>.code = httpCodeEnum.getCode();<br>        <span class="hljs-built_in">this</span>.msg = httpCodeEnum.getMsg();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</p><p>å¯¹Controllerçš„å¢å¼º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…¨å±€å¼‚å¸¸å¤„ç†å™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalException</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler(SystemException.class)</span><br>    <span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">systemExceptionHandler</span><span class="hljs-params">(SystemException e)</span> &#123;<br>          log.error(<span class="hljs-string">&quot;å‡ºç°äº†å¼‚å¸¸ï¼š&#123;&#125;&quot;</span>, e.getMsg());<br>          <span class="hljs-keyword">return</span> ResponseResult.errorResult(e.getCode(), e.getMsg());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†å…¶ä»–å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(Exception e)</span> &#123;<br>        log.error(<span class="hljs-string">&quot;å‡ºç°äº†å¼‚å¸¸ï¼š&#123;&#125;&quot;</span>, e.getMessage());<br>        <span class="hljs-keyword">return</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç™»å‡º"><a href="#ç™»å‡º" class="headerlink" title="ç™»å‡º"></a>ç™»å‡º</h4><p>æ ¹æ®tokenåˆ é™¤redisä¸­çš„ç™»å½•ä¿¡æ¯</p><h5 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// éœ€è¦é…ç½®logoutæ¥å£éœ€è¦è®¤è¯</span><br>http.antMatchers(<span class="hljs-string">&quot;/logout&quot;</span>).authenticated()<br><span class="hljs-comment">// å…³é—­é»˜è®¤logoutåŠŸèƒ½</span><br>http.logout().disable();<br></code></pre></td></tr></table></figure><h5 id="Serviceå±‚-1"><a href="#Serviceå±‚-1" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();<br>    <span class="hljs-type">LoginUser</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> (LoginUser) authentication.getPrincipal();<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> loginUser.getUser().getId();<br><br>    redisCache.deleteObject(RedisConstants.CACHE_LOGIN_PREFIX + userId);<br>    <span class="hljs-keyword">return</span> ResponseResult.okResult();<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Controllerå±‚-1"><a href="#Controllerå±‚-1" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> blogLoginService.logout();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é‰´æƒ"><a href="#é‰´æƒ" class="headerlink" title="é‰´æƒ"></a>é‰´æƒ</h4><h5 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h5><p>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå¼€å¯å…ˆ&#x2F;åé‰´æƒçš„æ³¨è§£ã€‚å¼€å¯åå¯ä»¥ä½¿ç”¨<code>@PreAuthorize()</code>å’Œ<code>@PostAuthorize()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><br></code></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢æƒé™"><a href="#æŸ¥è¯¢æƒé™" class="headerlink" title="æŸ¥è¯¢æƒé™"></a>æŸ¥è¯¢æƒé™</h5><p>åœ¨è·å–æ—¶å°†ç”¨æˆ·ä¿¡æ¯å’Œæƒé™åŒ…è£…æˆUserDetailä¸€èµ·è¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ›¿æ¢é»˜è®¤çš„SpringSecurityçš„è·å–èº«ä»½ä¿¡æ¯æ–¹å¼</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> MenuService menuService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;()<br>                                         .eq(User::getUserName, username));<br>        <span class="hljs-keyword">if</span> (Objects.isNull(user)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·æƒé™ä¿¡æ¯</span><br>        List&lt;String&gt; permissions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();;<br>        <span class="hljs-keyword">if</span> (user.getType().equals(SystemConstants.ADMIN)) &#123;<br>            <span class="hljs-comment">// åªæœ‰åå°ç®¡ç†å‘˜éœ€è¦é‰´æƒ</span><br>            permissions = menuService.selectPermsByUserId(user.getId());<br>        &#125;<br>        <span class="hljs-comment">// è¿”å›ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginUser</span>(user, permissions);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="é‰´æƒ-1"><a href="#é‰´æƒ-1" class="headerlink" title="é‰´æƒ"></a>é‰´æƒ</h5><p>ç¼–å†™é‰´æƒé€»è¾‘ï¼Œå¹¶ä½œä¸ºServiceæ³¨å…¥Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service(&quot;ps&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰æƒé™</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> permission</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span> &#123;<br>        <span class="hljs-comment">// è¶…çº§ç®¡ç†å‘˜</span><br>        <span class="hljs-keyword">if</span> (SecurityUtils.isAdmin()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        List&lt;String&gt; permissions = SecurityUtils.getLoginUser().getPermissions();<br>        <span class="hljs-keyword">return</span> permissions.contains(permission);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>åœ¨éœ€è¦é‰´æƒçš„æ¥å£ä¸Šæ·»åŠ æ³¨è§£ï¼Œ<code>@ps.hasPermission()</code>ä¸ºè‡ªå®šä¹‰çš„é‰´æƒæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PreAuthorize(&quot;@ps.hasPermission(&#x27;contet:category:export&#x27;)&quot;)</span><br><span class="hljs-meta">@GetMapping(&quot;/export&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">export</span><span class="hljs-params">(HttpServletResponse response)</span> &#123;<br>        ...<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaçº¿ç¨‹</title>
    <link href="/2023/06/05/java/java%E7%BA%BF%E7%A8%8B/"/>
    <url>/2023/06/05/java/java%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="javaçº¿ç¨‹"><a href="#javaçº¿ç¨‹" class="headerlink" title="javaçº¿ç¨‹"></a>javaçº¿ç¨‹</h1><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="/img/java_img/%E7%BA%BF%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png"></p><p>Newï¼šçº¿ç¨‹æ­£åœ¨åˆ›å»º</p><p>Runnableï¼šçº¿ç¨‹å¯ä»¥è¿è¡Œï¼ˆå¯èƒ½åœ¨ç­‰å¾…æ—¶é—´ç‰‡æˆ–æ­£åœ¨è¿è¡Œï¼‰</p><p>Blockingï¼šçº¿ç¨‹ç­‰å¾…è·å–é”</p><p>Waitingï¼šå½“å‰çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å”¤é†’</p><p>Timed Waitingï¼šå½“å‰çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´åä¼šè‡ªåŠ¨é†’æ¥</p><p>Terminatedï¼šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–å‡ºç°å¼‚å¸¸</p><h2 id="çº¿ç¨‹æ¥å£"><a href="#çº¿ç¨‹æ¥å£" class="headerlink" title="çº¿ç¨‹æ¥å£"></a>çº¿ç¨‹æ¥å£</h2><p>javaä¸­æœ‰ä¸‰ç§çº¿ç¨‹çš„æ¥å£&#x2F;ç±»ï¼š</p><ul><li>Threadç±»</li><li>Runnableæ¥å£</li><li>Callableæ¥å£</li></ul><p><strong>ä½¿ç”¨</strong></p><p>Thread</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// ç›´æ¥åˆ›å»ºçº¿ç¨‹</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ&quot;</span>);<br>        &#125;);<br>        thread.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MainApplication</span> <span class="hljs-variable">mainApplication</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>();<br>        mainApplication.start();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// é€šè¿‡ç»§æ‰¿Threadæ¥ä½¿ç”¨</span><br>        System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Runnable</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// å®ç°Runnableæ¥å£</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>());<br>        thread.start();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Callable</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt; &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-comment">// å®ç°Callableæ¥å£ï¼Œè¿™ç§çº¿ç¨‹ä»»åŠ¡å¯ä»¥æœ‰è¿”å›å€¼</span><br>        FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>());<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);<br>        thread.start();<br>        System.out.println(futureTask.get());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>é™æ€æ–¹æ³•</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">Thread.sleep()</td><td align="center">ä¼‘çœ å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹</td></tr><tr><td align="center">Thread.yield()</td><td align="center">å½“å‰çº¿ç¨‹å»ºè®®è®©å‡ºcpuï¼Œç”±è°ƒåº¦å™¨å†³å®šæ˜¯å¦è®©å‡º</td></tr><tr><td align="center"></td><td align="center"></td></tr></tbody></table><p>å®ä¾‹æ–¹æ³•</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">thread.setDaemon()</td><td align="center">trueä¸ºè®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹</td></tr><tr><td align="center">thread.interrupt()</td><td align="center">ä¸­æ–­åœ¨ä¼‘çœ ä¸­çš„çº¿ç¨‹ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼›åœ¨è¿è¡Œçš„çº¿ç¨‹åˆ™ä¼šè®¾ç½®æ ‡è®°ï¼Œç”±çº¿ç¨‹è‡ªå·±å†³å®šæ˜¯å¦ä¸­æ–­</td></tr><tr><td align="center">thread.interrupted()</td><td align="center">è·å–ä¸­æ–­æ ‡è®°</td></tr><tr><td align="center">thread.join()</td><td align="center">è°ƒç”¨çº¿ç¨‹ç­‰å¾…è¢«è°ƒç”¨çº¿ç¨‹æ‰§è¡Œå®Œæ‰ä¼šç»§ç»­æ‰§è¡Œ</td></tr><tr><td align="center">object.wait()</td><td align="center">æŒ‚èµ·çº¿ç¨‹ï¼Œä¼šé‡Šæ”¾é”ï¼Œåªèƒ½åœ¨åŒæ­¥ä»£ç å—é‡Œè°ƒç”¨</td></tr><tr><td align="center">object.notify()</td><td align="center">éšæœºå”¤é†’çº¿ç¨‹ï¼Œåªèƒ½åœ¨åŒæ­¥ä»£ç å—é‡Œè°ƒç”¨</td></tr></tbody></table><p>interrupt</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MainApplication</span> <span class="hljs-variable">mainApplication</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>();<br>        mainApplication.start();<br>        mainApplication.interrupt();<span class="hljs-comment">// ä¸­æ–­çº¿ç¨‹</span><br>        System.out.println(<span class="hljs-string">&quot;Main run&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>            System.out.println(<span class="hljs-string">&quot;Thread run&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// æ§åˆ¶å°æ‰“å°</span><br><span class="hljs-comment">// Main run</span><br></code></pre></td></tr></table></figure><p>interrupted</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">MainApplication</span> <span class="hljs-variable">mainApplication</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>();<br>        mainApplication.start();<br>        mainApplication.interrupt();<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        System.out.println(<span class="hljs-string">&quot;Main run&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (!interrupted()) &#123;<br><br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;Thread run&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ§åˆ¶å°æ‰“å°</span><br><span class="hljs-comment">// Thread run</span><br><span class="hljs-comment">// Main run</span><br></code></pre></td></tr></table></figure><h2 id="çº¿ç¨‹äº’æ–¥-x2F-åä½œ"><a href="#çº¿ç¨‹äº’æ–¥-x2F-åä½œ" class="headerlink" title="çº¿ç¨‹äº’æ–¥&#x2F;åä½œ"></a>çº¿ç¨‹äº’æ–¥&#x2F;åä½œ</h2><p>äº’æ–¥æ–¹å¼</p><ul><li>synchronized</li><li>Lock</li></ul><p>åä½œæ–¹å¼</p><ul><li>join()</li><li>wait()ã€notify() &#x2F; notifyAll()</li><li>await()ã€single() &#x2F; singleAll()ï¼šåœ¨Conditionä¸Šä½¿ç”¨</li></ul><h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><blockquote><p>å¯¹çº¿ç¨‹è¿›è¡Œç»Ÿä¸€åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§</p></blockquote><p><img src="/img/java_img/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png"></p><h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><p>â€‹ä¸€ä¸ªçº¿ç¨‹é›†åˆworkerSetå’Œä¸€ä¸ªé˜»å¡é˜Ÿåˆ—workQueueã€‚å½“ç”¨æˆ·å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡(ä¹Ÿå°±æ˜¯çº¿ç¨‹)æ—¶ï¼Œçº¿ç¨‹æ± ä¼šå…ˆå°†ä»»åŠ¡æ”¾å…¥workQueueä¸­ã€‚workerSetä¸­çš„çº¿ç¨‹ä¼šä¸æ–­çš„ä»workQueueä¸­è·å–çº¿ç¨‹ç„¶åæ‰§è¡Œã€‚å½“workQueueä¸­æ²¡æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œworkerå°±ä¼šé˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡äº†å°±å–å‡ºæ¥ç»§ç»­æ‰§è¡Œã€‚</p><p><img src="/img/java_img/%E7%BA%BF%E7%A8%8B%E6%B1%A0.png"></p><p>è·å–çº¿ç¨‹æ± çŠ¶æ€api</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>threadPoolExecutor.getPoolSize()</td><td>å½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°</td></tr><tr><td>threadPoolExecutor.getCorePoolSize()</td><td>å½“å‰çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡</td></tr><tr><td>threadPoolExecutor.getActiveCount()</td><td>æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°</td></tr><tr><td>threadPoolExecutor.getCompletedTaskCount()</td><td>å·²ç»å®Œæˆçš„ä»»åŠ¡æ•°</td></tr><tr><td>threadPoolExecutor.getTaskCount()</td><td>çº¿ç¨‹æ± ä¸­å·²ç»æäº¤çš„ä»»åŠ¡æ€»æ•°</td></tr><tr><td>threadPoolExecutor.isShutdown()</td><td>çº¿ç¨‹æ˜¯å¦å·²ç»è°ƒç”¨äº†<code>shutdown</code>æ–¹æ³•</td></tr><tr><td>threadPoolExecutor.isTerminated()</td><td>çº¿ç¨‹æ˜¯å¦å·²ç»æ‰§è¡Œå®Œä»»åŠ¡å¹¶å…³é—­</td></tr></tbody></table><p>åˆ›å»ºçº¿ç¨‹æ± çš„å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,// æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="hljs-params">                          <span class="hljs-type">int</span> maximumPoolSize,// å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°=æ ¸å¿ƒ+éæ ¸å¿ƒ</span><br><span class="hljs-params">                          <span class="hljs-type">long</span> keepAliveTime,// éæ ¸å¿ƒå­˜æ´»æ—¶é—´</span><br><span class="hljs-params">                          TimeUnit unit,// å­˜æ´»æ—¶é—´å•ä½</span><br><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,// ä»»åŠ¡é˜»å¡é˜Ÿåˆ—</span><br><span class="hljs-params">                          RejectedExecutionHandler handler// æ‹’ç»ç­–ç•¥</span><br><span class="hljs-params">                         )</span><br></code></pre></td></tr></table></figure><p>ä»»åŠ¡é˜»å¡é˜Ÿåˆ—ç§ç±»ï¼š</p><ul><li><p><code>ArrayBlockingQueue</code>: åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»</p></li><li><p><code>LinkedBlockingQueue</code>: åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueï¼›</p></li><li><p><code>SynchronousQueue</code>: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼›</p></li><li><p><code>PriorityBlockingQueue</code>: å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</p></li></ul><p>æ‹’ç»ç­–ç•¥ç§ç±»ï¼š</p><ul><li><p><code>AbortPolicy</code>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</p></li><li><p><code>CallerRunsPolicy</code>: ç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</p></li><li><p><code>DiscardOldestPolicy</code>: ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</p></li><li><p><code>DiscardPolicy</code>: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡</p></li></ul><p>çº¿ç¨‹æ± çŠ¶æ€</p><p>â€‹çº¿ç¨‹æ± ä¸­é€šè¿‡åŸå­æ•´æ•°<code>ctl</code>çš„å‰3ä½æ¥è®°å½•çº¿ç¨‹æ± çŠ¶æ€ï¼Œå29ä½è®°å½•å½“å‰çº¿ç¨‹æ•°</p><p><img src="/img/java_img/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%8A%B6%E6%80%81.png"></p><h3 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h3><blockquote><p>ExecutorsæŠŠå·¥ä½œå•å…ƒ(Runnable)ä¸æ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€</p></blockquote><p>é€šè¿‡Executorså¯ä»¥åˆ›å»ºé¢„è®¾å¥½å‚æ•°çš„çº¿ç¨‹æ± ï¼Œå¦‚å›ºå®šå¤§å°çº¿ç¨‹æ± ã€åªæœ‰æ•‘æ€¥çº¿ç¨‹çš„çº¿ç¨‹æ± ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            pool.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>());<br>        &#125;<br>        pool.shutdown();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(Thread.currentThread().getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>api</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">pool.shutdown()</td><td align="center">ç­‰æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± </td></tr><tr><td align="center">pool.shutdownNow()</td><td align="center">ç«‹å³å…³é—­çº¿ç¨‹æ± ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰§è¡Œinterrupt()</td></tr><tr><td align="center">pool.submit()</td><td align="center">æ‰§è¡Œæœ‰è¿”å›å€¼çš„ä»»åŠ¡</td></tr><tr><td align="center">pool.execute()</td><td align="center">æ‰§è¡Œæ²¡æœ‰è¿”å›å€¼çš„ä»»åŠ¡</td></tr></tbody></table><p>ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨Executoråˆ›å»ºçº¿ç¨‹ï¼Ÿ</p><p>â€‹ä½¿ç”¨äº†æ— ç•Œé˜Ÿåˆ—ï¼Œä»»åŠ¡å¯ä»¥æ— é™æäº¤ï¼Œä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼›<code>newCachedThreadPool</code>å¦‚æœé¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹ä¼šå¯¼è‡´å¤§é‡çš„ç³»ç»Ÿå¼€é”€å’Œå†…å­˜æº¢å‡º</p><h3 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h3><blockquote><p>ç›¸å½“äºç­‰å¾…é˜Ÿåˆ—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">MainApplication</span> <span class="hljs-variable">mainApplication</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainApplication</span>();<br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>        pool.execute(() -&gt; mainApplication.before());<br>        pool.execute(() -&gt; mainApplication.after());<br>        pool.shutdown();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                condition.await();<span class="hljs-comment">// åœ¨conditionä¸Šç­‰å¾…</span><br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                lock.unlock();<br>            &#125;<br>        System.out.println(<span class="hljs-string">&quot;before&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            condition.signal();<span class="hljs-comment">// å”¤é†’conditionä¸Šç­‰å¾…çš„çº¿ç¨‹</span><br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;after&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ§åˆ¶å°æ‰“å°</span><br><span class="hljs-comment">// after</span><br><span class="hljs-comment">// before</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>javaé”</title>
    <link href="/2023/06/02/java/java%E9%94%81/"/>
    <url>/2023/06/02/java/java%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1 id="javaé”"><a href="#javaé”" class="headerlink" title="javaé”"></a>javaé”</h1><p>æ–‡ç« <a href="https://www.cnblogs.com/lifegoeson/p/13683785.html">javaé‡Œçš„é”æ€»ç»“</a>çš„ç¬”è®°</p><h2 id="é”çš„åˆ†ç±»"><a href="#é”çš„åˆ†ç±»" class="headerlink" title="é”çš„åˆ†ç±»"></a>é”çš„åˆ†ç±»</h2><p>javaä¸­é”åˆ†ä¸ºä¸¤ç§</p><ol><li>ä¸€ç§ä¸º<code>synchronized</code>å…³é”®å­—ï¼Œç”±jvmå®ç°ï¼Œæ˜¯éšæ€§çš„é”</li><li>å¦ä¸€ç§ä¸º<code>Lock</code>æ¥å£åŠå…¶å®ç°ç±»ï¼Œæ˜¯æ˜¾æ€§çš„é”ï¼Œéœ€è¦æ‰‹åŠ¨è·å–é‡Šæ”¾</li></ol><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li>åŠ åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé”çš„æ˜¯æ•´ä¸ªç±»</li><li>åŠ åœ¨æˆå‘˜æ–¹æ³•ä¸Šï¼Œé”çš„æ˜¯<code>this</code></li><li><code>synchronized(å¯¹è±¡)&#123;&#125;</code>ï¼Œé”çš„æ˜¯å¯¹è±¡</li></ol><h3 id="javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€"><a href="#javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€" class="headerlink" title="javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€"></a>javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€</h3><ol><li><strong>å¯¹è±¡å¤´</strong>ï¼šå­˜æ”¾å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶çš„æ•°æ®ã€‚æœ‰Hashç ã€åˆ†ä»£å¹´é¾„ã€é‡é‡çº§é”çš„æŒ‡é’ˆã€é”è®°å½•çš„æŒ‡é’ˆç­‰ï¼Œå¯¹è±¡å¤´ä¹Ÿå«<code>Mark Word</code></li><li><strong>å®ä¾‹æ•°æ®</strong>ï¼šå¯¹è±¡ä¸­å­—æ®µçš„ä¿¡æ¯</li><li><strong>å¯¹é½å¡«å……</strong>ï¼šå¯¹è±¡èµ·å§‹åœ°å€å¾—æ˜¯<code>8å­—èŠ‚çš„æ•´æ•°å€</code>ï¼Œéœ€è¦å¯¹é½å¡«å……</li></ol><p>å…¶ä¸­å¯¹è±¡å¤´é‡Œçš„é‡é‡çº§é”çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ª<strong>Monitor</strong>å¯¹è±¡ï¼ˆç®¡ç¨‹ã€ç›‘è§†å™¨ï¼‰ï¼Œå’Œ<code>synchronized</code>çš„å®ç°æœ‰å…³è”</p><h3 id="å¤§è‡´åŸç†"><a href="#å¤§è‡´åŸç†" class="headerlink" title="å¤§è‡´åŸç†"></a>å¤§è‡´åŸç†</h3><ol><li>å½“<code>synchronized</code>ä¿®é¥°æ–¹æ³•</li></ol><p>è°ƒç”¨æ–¹æ³•æ—¶éœ€è¦çº¿ç¨‹å…ˆæ‹¥æœ‰<strong>Monitor</strong>ç®¡ç¨‹</p><p><strong>Monitor</strong>åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰</p><p>å½“æ–¹æ³•æ‰§è¡Œå®Œåå‡ºç°å¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾<strong>Monitor</strong></p><ol start="2"><li>å½“<code>synchronized</code>ç”¨äºåŒæ­¥ä»£ç å—</li></ol><p>é€šè¿‡<code>synchronizedenter</code>å’Œ<code>synchronizedexit</code>æŒ‡ä»¤æ¥è·å–å’Œé‡Šæ”¾<strong>Monitor</strong></p><h3 id="å­˜åœ¨çš„é—®é¢˜"><a href="#å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å­˜åœ¨çš„é—®é¢˜"></a>å­˜åœ¨çš„é—®é¢˜</h3><p><strong>Monitor</strong>çš„å®ç°éœ€è¦ä¾èµ–æ“ä½œç³»ç»Ÿåº•å±‚ï¼Œæ‰€ä»¥<strong>éœ€è¦è¿›è¡Œç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è½¬æ¢</strong>ï¼Œæ•ˆç‡è¾ƒä½</p><h3 id="è§£å†³é—®é¢˜çš„æ–¹å¼"><a href="#è§£å†³é—®é¢˜çš„æ–¹å¼" class="headerlink" title="è§£å†³é—®é¢˜çš„æ–¹å¼"></a>è§£å†³é—®é¢˜çš„æ–¹å¼</h3><blockquote><p>é€šè¿‡æ·»åŠ å„ç§é”æ¥å®ç°åŒæ­¥ï¼Œè€Œä¸æ˜¯ä¸€ä¸Šæ¥å°±åŠ é‡é‡çº§é”<code>synchronized</code></p></blockquote><p>é”çš„é‡é‡æœ‰ä½åˆ°é«˜</p><p><strong>åå‘é” -&gt; è‡ªæ—‹é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”</strong></p><ul><li>åå‘é”ï¼šå¯¹è±¡å¤´çš„<code>Mark Word</code>ä¸ºåå‘é”ç»“æ„ï¼Œé”ä¼šåå‘äºç¬¬ä¸€æ¬¡è·å–å®ƒçš„çº¿ç¨‹ï¼Œå½“æ¯æ¬¡éƒ½æ˜¯è¿™ä¸ªçº¿ç¨‹æ¥è·å–é”æ—¶ï¼Œä¸éœ€è¦å…¶ä»–æ“ä½œ</li><li>è½»é‡çº§é”ï¼šå½“çº¿ç¨‹é—´å‘ç”Ÿç«äº‰æ—¶ï¼Œ<code>Mark Word</code>ä¼šå˜ä¸ºè½»é‡çº§é”çš„ç»“æ„ï¼Œé€šè¿‡<strong>CAS</strong>(Compare And Swap)æ“ä½œè·å–é”</li><li>é‡é‡çº§é”ï¼šå³<code>synchronized</code>é”</li></ul><p>çº¿ç¨‹é—´ç«äº‰é”çš„æ¿€çƒˆç¨‹åº¦ä¼šå¯¼è‡´é”å‡çº§ï¼Œé”åªèƒ½å‡çº§ä¸èƒ½é™çº§</p><h3 id="æŒ‰é”çš„æ€§è´¨åˆ†ç±»"><a href="#æŒ‰é”çš„æ€§è´¨åˆ†ç±»" class="headerlink" title="æŒ‰é”çš„æ€§è´¨åˆ†ç±»"></a>æŒ‰é”çš„æ€§è´¨åˆ†ç±»</h3><ol><li>æ‚²è§‚é”ï¼šæ¯æ¬¡è¯»å†™æ“ä½œéƒ½åŠ é”</li><li>ä¹è§‚é”ï¼šæ¯æ¬¡å†™æ“ä½œéƒ½é€šè¿‡<code>CAS</code>æ“ä½œæ¥å°è¯•åŠ é”</li><li>å…¬å¹³é”ï¼šæŒ‰ç…§FIFOæ¥è·å–é”</li><li>éå…¬å¹³é”ï¼šæŠ¢å å¼çš„é”ï¼Œ<code>synchronized</code>å±äºéå…¬å¹³é”</li><li>ç‹¬å é”ï¼šé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰</li><li>å…±äº«é”ï¼šé”å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰</li></ol><h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><h3 id="Lockæ¥å£å¸¸è§å®ç°ç±»"><a href="#Lockæ¥å£å¸¸è§å®ç°ç±»" class="headerlink" title="Lockæ¥å£å¸¸è§å®ç°ç±»"></a>Lockæ¥å£å¸¸è§å®ç°ç±»</h3><ul><li>ReentrantLockï¼Œå¯é‡å…¥é”</li><li>ReadLockï¼Œè¯»é”</li><li>WriteLockï¼Œå†™é”</li></ul><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ä»¥ReentrantLockä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>lock.lock();<span class="hljs-comment">// åŠ é”</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ä»£ç ..</span><br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    lock.unlock();<span class="hljs-comment">// é‡Šæ”¾é”</span><br>&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>void lock()</td><td>è·å–é”</td></tr><tr><td>boolean tryLock()</td><td>å°è¯•è·å–é”ï¼Œæ²¡è·å–åˆ°é”ä¸ä¼šé˜»å¡</td></tr><tr><td>void unlock()</td><td>é‡Šæ”¾é”</td></tr><tr><td>Condition newCondition()</td><td>åˆ›å»ºç­‰å¾…é˜Ÿåˆ—ï¼Œè°ƒç”¨wait()æ–¹æ³•å¯ä»¥åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</td></tr></tbody></table><h3 id="AbstractQueuedSynchronizer"><a href="#AbstractQueuedSynchronizer" class="headerlink" title="AbstractQueuedSynchronizer"></a>AbstractQueuedSynchronizer</h3><p>åŒæ­¥å™¨AQSï¼Œæ˜¯å®ç°é”çš„åŸºç¡€ï¼›</p><p><strong>ä¸»è¦æ–¹æ³•</strong></p><p>è·å–&#x2F;è®¾ç½®åŒæ­¥çŠ¶æ€</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">int getState()</td><td align="center">è·å–åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">void setState()</td><td align="center">è®¾ç½®åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">boolean compareAndSetState(int expect, int update)</td><td align="center">CASè®¾ç½®åŒæ­¥çŠ¶æ€</td></tr></tbody></table><p>è·å–ç‹¬å é”&#x2F;å…±äº«é”ï¼Œå¯ä»¥è¦†ç›–é‡å†™</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">boolean tryAcquire(int arg)</td><td align="center">ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">boolean tryRelease(int arg)</td><td align="center">ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">int tryAcquireShared(int arg)</td><td align="center">å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">boolean tryReleaseShared(int arg)</td><td align="center">å…±äº«å¼ç§æˆ¿åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">boolean isHeldExclusively()</td><td align="center">æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è·å–ç‹¬å é”</td></tr></tbody></table><p>æ¨¡æ¿æ–¹æ³•</p><table><thead><tr><th align="center">æ–¹æ³•</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">void acquire(int arg)</td><td align="center">ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•å°†ä¼šè°ƒç”¨ tryAcquire å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚è·å–æˆåŠŸåˆ™è¿”å›ï¼Œè·å–å¤±è´¥ï¼Œçº¿ç¨‹è¿›å…¥åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ã€‚</td></tr><tr><td align="center">void acquireInterruptibly(int arg)</td><td align="center">å“åº”ä¸­æ–­ç‰ˆçš„ acquire</td></tr><tr><td align="center">boolean tryAcquireNanos(int arg,long nanos)</td><td align="center">è¶…æ—¶+å“åº”ä¸­æ–­ç‰ˆçš„ acquire</td></tr><tr><td align="center">void acquireShared(int arg)</td><td align="center">å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼ŒåŒä¸€æ—¶åˆ»å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹è·å¾—åŒæ­¥çŠ¶æ€ã€‚æ¯”å¦‚è¯»å†™é”çš„è¯»é”å°±æ˜¯å°±æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–åŒæ­¥çŠ¶æ€çš„ã€‚</td></tr><tr><td align="center">void acquireSharedInterruptibly(int arg)</td><td align="center">å“åº”ä¸­æ–­ç‰ˆçš„ acquireShared</td></tr><tr><td align="center">boolean tryAcquireSharedNanos(int arg,long nanos)</td><td align="center">è¶…æ—¶+å“åº”ä¸­æ–­ç‰ˆçš„ acquireShared</td></tr><tr><td align="center">boolean release(int arg)</td><td align="center">ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</td></tr><tr><td align="center">boolean releaseShared(int arg)</td><td align="center">å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€</td></tr></tbody></table><p>é€šè¿‡<strong>FIFOé˜Ÿåˆ—</strong>ç»™æ¥è·å–é”çš„çº¿ç¨‹æ’é˜Ÿ</p><p><img src="/img/java_img/AQS%E9%98%9F%E5%88%97.png"></p><p>èŠ‚ç‚¹åˆ†ä¸ºç‹¬å å¼å’Œå…±äº«å¼</p><ul><li>ç‹¬å å¼ï¼š é¦–èŠ‚ç‚¹è·å–åŒæ­¥çŠ¶æ€ï¼Œå½“é‡Šæ”¾åŒæ­¥çŠ¶æ€åï¼Œä¼šå”¤é†’é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li><li>å…±äº«å¼ï¼šé¦–èŠ‚ç‚¹è·å–åŒæ­¥çŠ¶æ€ï¼Œè‹¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å…±äº«èŠ‚ç‚¹ï¼Œåˆ™ä¼šå”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li></ul><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>å¯é‡å…¥é”ï¼Œæ”¯æŒå…¬å¹³éå…¬å¹³ï¼Œé»˜è®¤éå…¬å¹³</p><p>é€šè¿‡<strong>Unsafeç±»</strong>çš„<code>pack()</code>ã€<code>unpack()</code>ã€<code>compareAndSwap..()</code>ã€æ¥å®ç°çº¿ç¨‹çš„é˜»å¡ã€å”¤é†’å’ŒCASæ“ä½œ</p><p>å†…éƒ¨ç±»<strong>sync</strong>å®ç°<strong>AbstractQueuedSynchronizer</strong>æ¥å£ï¼Œé€šè¿‡<strong>sync</strong>å®ç°å…¬å¹³é”ã€éå…¬å¹³é”</p><p>è·å–é”ï¼š</p><ul><li>lock()æ–¹æ³•</li><li>é€šè¿‡CASæ“ä½œå°è¯•åŠ é”<ul><li>æˆåŠŸåˆ™è®¾ç½®è‡ªå·±ä¸ºå½“å‰é”çš„æŒæœ‰è€…</li><li>å¤±è´¥åˆ™è°ƒç”¨<code>acquire()</code>ï¼Œä¼šå†å°è¯•ä¸€æ¬¡ï¼Œå†å¤±è´¥åˆ™ä¼šé˜»å¡ï¼ˆåŠ å…¥åˆ°AQSçš„ç­‰å¾…é˜Ÿåˆ—ï¼‰</li></ul></li></ul><p><img src="/img/java_img/ReentrantLock_lock().png"></p><p>é‡Šæ”¾é”ï¼š</p><ul><li>unlock()æ–¹æ³•</li><li>é‡Šæ”¾é”åé€šè¿‡AQSçš„ç­‰å¾…é˜Ÿåˆ—å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œå”¤é†’çš„çº¿ç¨‹å›å»äº‰æŠ¢é”</li></ul><p><img src="/img/java_img/ReentrantLock_unlock().png"></p><p>å¯é‡å…¥ï¼š</p><ul><li>å½“å‰çº¿ç¨‹æ¯æ¬¡è·å–é”æ—¶state++</li><li>é‡Šæ”¾é”æ—¶åªæœ‰state &#x3D;&#x3D; 0æ‰ä¼šé‡Šæ”¾é”</li></ul><h3 id="ReentrantReadWriteLock"><a href="#ReentrantReadWriteLock" class="headerlink" title="ReentrantReadWriteLock"></a>ReentrantReadWriteLock</h3><p>æ˜¯åŸºäº<code>ReentrantLock</code>å’Œ<code>AbstractQueuedSynchronizer</code>å®ç°çš„</p><p>æœ¬èº«å®ç°äº†<code>ReadWriteLock</code>æ¥å£</p><p><strong>int state</strong>çš„å‰16ä½è¡¨ç¤ºå æœ‰è¯»é”çš„çº¿ç¨‹æ•°ã€å16ä½è¡¨ç¤ºå æœ‰å†™é”çš„çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHARED_SHIFT</span>   <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;<br><br><span class="hljs-comment">// è·å–è¯»é”æ•°é‡</span><br><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sharedCount</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span>    &#123; <span class="hljs-keyword">return</span> c &gt;&gt;&gt; SHARED_SHIFT; &#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXCLUSIVE_MASK</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">16</span>) - <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">// è·å–å†™é”æ•°é‡</span><br><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">exclusiveCount</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span> &#123; <span class="hljs-keyword">return</span> c &amp; EXCLUSIVE_MASK; &#125;<br></code></pre></td></tr></table></figure><p>è¯»è¯»äº’å®¹ï¼Œå†™å†™äº’æ–¥ï¼Œè¯»å†™äº’æ–¥</p><p>è·å–è¯»é”æ—¶ï¼Œä¼šåˆ¤æ–­æ˜¯å¦æœ‰å†™é”ï¼Œç„¶åstateçš„é«˜16ä½+1è¡¨ç¤ºåŠ è¯»é”</p><p>è·å–å†™é”æ—¶ï¼Œä¼šåˆ¤æ–­stateæ˜¯å¦ä¸º0ï¼Œç„¶åstateç½®ä¸º1ï¼Œæ¯æ¬¡é‡å…¥state+1</p><p>é‡Šæ”¾è¯»é”æ—¶ï¼Œ<code>ThreadLocal</code>ä¿å­˜ç€æ¯ä¸ªçº¿ç¨‹çš„é‡å…¥æ¬¡æ•°ï¼Œå¯¹åº”çš„é‡å…¥æ¬¡æ•°å‡ä¸º0æ—¶state-1</p><p>é‡Šæ”¾å†™é”æ—¶ï¼Œstate-1ï¼Œåªæœ‰å½“stateä¸º0æ—¶æ‰ä¼šé‡Šæ”¾</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®æŠ“å–</title>
    <link href="/2023/06/01/%E5%85%B6%E4%BB%96/%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96/"/>
    <url>/2023/06/01/%E5%85%B6%E4%BB%96/%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®æŠ“å–"><a href="#æ•°æ®æŠ“å–" class="headerlink" title="æ•°æ®æŠ“å–"></a>æ•°æ®æŠ“å–</h1><h2 id="æŠ“å–æ–¹å¼"><a href="#æŠ“å–æ–¹å¼" class="headerlink" title="æŠ“å–æ–¹å¼"></a>æŠ“å–æ–¹å¼</h2><ol><li><p>ç›´æ¥é€šè¿‡æ¥å£</p><ul><li><p>å¸¸ç”¨æŠ€æœ¯ï¼šHttpClientã€OKHttpã€RestTemplateã€Hutoolç­‰å‘é€è¯·æ±‚</p></li><li><p>ç¼ºç‚¹ï¼šæ•°æ®å¯èƒ½ç»è¿‡åŠ å¯†ï¼Œéœ€è¦è§£å¯†</p></li></ul></li><li><p>ä»å‰ç«¯é¡µé¢æŠ“å–ã€‚</p><ul><li><p>å¸¸ç”¨æŠ€æœ¯ï¼šJSoup</p></li><li><p>ç¼ºç‚¹ï¼šå¯èƒ½éœ€è¦åŠ¨æ€éªŒè¯</p></li></ul></li></ol><h2 id="æŠ“å–æµç¨‹"><a href="#æŠ“å–æµç¨‹" class="headerlink" title="æŠ“å–æµç¨‹"></a>æŠ“å–æµç¨‹</h2><ol><li>åˆ†ææ•°æ®æº</li><li>å¤„ç†æ•°æ®</li><li>å†™å…¥æ•°æ®åº“</li></ol><h2 id="æŠ“å–æ–¹å¼-1"><a href="#æŠ“å–æ–¹å¼-1" class="headerlink" title="æŠ“å–æ–¹å¼"></a>æŠ“å–æ–¹å¼</h2><ol><li>ç¦»çº¿æŠ“å–ï¼šå°†æ•°æ®å­˜åˆ°æ•°æ®åº“</li><li>å®æ—¶æŠ“å–ï¼šä¸å­˜æ•°æ®åº“ï¼Œå®æ—¶æŠ“å–ï¼Œç›´æ¥å±•ç¤º</li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é›¶ç¢</title>
    <link href="/2023/05/30/%E5%89%8D%E7%AB%AF/vue/%E9%9B%B6%E7%A2%8E/"/>
    <url>/2023/05/30/%E5%89%8D%E7%AB%AF/vue/%E9%9B%B6%E7%A2%8E/</url>
    
    <content type="html"><![CDATA[<h1 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h1><h2 id="ç”¨urlè®°å½•é¡µé¢çŠ¶æ€"><a href="#ç”¨urlè®°å½•é¡µé¢çŠ¶æ€" class="headerlink" title="ç”¨urlè®°å½•é¡µé¢çŠ¶æ€"></a>ç”¨urlè®°å½•é¡µé¢çŠ¶æ€</h2><blockquote><p>å¦‚ä¿å­˜å½“å‰æ‰€åœ¨é¡µã€æœç´¢çš„å†…å®¹ç­‰ï¼Œåˆ·æ–°é¡µé¢åä»ç„¶ä¼šä¿æŒå½“å‰çŠ¶æ€</p></blockquote><p>å®ç°æ–¹å¼ï¼š</p><ol><li><p>ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ç­‰æ–¹å¼å…ˆæ”¹å˜url</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">// ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œæ”¹å˜è·¯ç”±å‚æ•°<br>const searchParams = ref(&#123; text: &#x27;&#x27; &#125;);<br>const onSearch = (value: string) =&gt; &#123;<br>  searchParams.value.text = value<br>  router.push(&#123;<br>    query: &#123;<br>      text: searchParams.value.text<br>    &#125;<br>  &#125;)<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>å†é€šè¿‡ç›‘å¬çš„æ–¹å¼ç›‘å¬urlçš„å˜åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">// éæƒ°æ€§çš„ç›‘å¬ï¼Œå½“urlæ”¹å˜æ—¶ä¹Ÿæ”¹å˜searchParamsçš„å€¼<br>watchEffect(() =&gt; &#123;<br>  searchParams.value.text = route.query.text as string;<br>&#125;)<br></code></pre></td></tr></table></figure></li></ol><h2 id="ts-Vue3ç»™definePropsè®¾ç½®é»˜è®¤å€¼"><a href="#ts-Vue3ç»™definePropsè®¾ç½®é»˜è®¤å€¼" class="headerlink" title="ts+Vue3ç»™definePropsè®¾ç½®é»˜è®¤å€¼"></a>ts+Vue3ç»™definePropsè®¾ç½®é»˜è®¤å€¼</h2><ol><li><p>åˆ›å»ºæ¥å£ï¼Œè®¾ç½®å‚æ•°çš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">interface Props &#123;<br>    userList: any[];<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡<code>withDefaults</code>ç»™<code>props</code>è®¾ç½®é»˜è®¤å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">const props = withDefaults(defineProps&lt;Props&gt;(), &#123;<br>    userList: () =&gt; [],<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>çˆ¶ç»„ä»¶ä¼ å‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;UserList :user-list=&quot;userList&quot;/&gt;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringAOP</title>
    <link href="/2023/05/28/spring/SpringAOP/"/>
    <url>/2023/05/28/spring/SpringAOP/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringAOP"><a href="#SpringAOP" class="headerlink" title="SpringAOP"></a>SpringAOP</h1><blockquote><p>Aspect Orient Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹</p></blockquote><h2 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h2><ol><li>å®šä¹‰ä¸šåŠ¡ç»„ä»¶</li><li>å®šä¹‰åˆ‡ç‚¹</li><li>å®šä¹‰å¢å¼ºé€šçŸ¥</li></ol><p><a href="https://blog.csdn.net/Cr1556648487/article/details/126777903">ä½¿ç”¨æ–¹å¼</a></p><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p>é‡‡ç”¨<strong>JDKåŠ¨æ€ä»£ç†</strong>å’Œ<strong>CGLibåŠ¨æ€ä»£ç†</strong>å®ç°</p><ul><li>å¦‚æœç›®æ ‡å¯¹è±¡æœ‰å®ç°æ¥å£ï¼Œåˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†</li><li>å¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œåˆ™ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†</li></ul><h3 id="JDKåŠ¨æ€ä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†"></a>JDKåŠ¨æ€ä»£ç†</h3><blockquote><p>é€šè¿‡åå°„å®ç°ä»£ç†</p></blockquote><h3 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h3><ol><li>å®šä¹‰å®ç°<strong>InvocationHandler</strong>æ¥å£çš„å¤„ç†å™¨</li><li>é€šè¿‡**Proxy.newInstance(ç±»åŠ è½½å™¨ï¼Œæ‰€æœ‰ä»£ç†ç›®æ ‡å®ç°çš„æ¥å£ï¼Œå¤„ç†å™¨)**æ¥è·å–ä»£ç†å¯¹è±¡</li><li>ä½¿ç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•</li></ol><p>ä¼˜ç‚¹ï¼š</p><ol><li>åŸç”Ÿï¼Œä¸éœ€è¦å…¶ä»–ä¾èµ–</li><li>ç”Ÿæˆä»£ç†ç±»çš„é€Ÿåº¦å¿«</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>é€šè¿‡æ¥å£çš„æ–¹æ³•æ¥ç»‡å…¥å¢å¼ºæ–¹æ³•ï¼Œå› æ­¤ç›®æ ‡å¿…é¡»éœ€è¦å®ç°æ¥å£</li><li>æ‰§è¡Œæ–¹æ³•çš„é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxySubject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br> <br>    <span class="hljs-keyword">private</span> Subject subject;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JdkProxySubject</span><span class="hljs-params">(Subject subject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.subject = subject;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br> <br>        System.out.println(<span class="hljs-string">&quot;before å‰ç½®é€šçŸ¥&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br> <br>        <span class="hljs-keyword">try</span> &#123;<br>            result = method.invoke(subject, args);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            System.out.println(<span class="hljs-string">&quot;ex: &quot;</span> + ex.getMessage());<br>            <span class="hljs-keyword">throw</span> ex;<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;after åç½®é€šçŸ¥&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123; <br>        <span class="hljs-comment">//è·å–InvocationHandlerå¯¹è±¡ åœ¨æ„é€ æ–¹æ³•ä¸­æ³¨å…¥ç›®æ ‡å¯¹è±¡ </span><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkProxySubject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RealSubject</span>()); <br><br>        <span class="hljs-comment">//è·å–ä»£ç†ç±»å¯¹è±¡ </span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">proxySubject</span> <span class="hljs-operator">=</span> (Subject)Proxy.newProxyInstance(Main.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Subject.class&#125;, handler); <br><br>        <span class="hljs-comment">//è°ƒç”¨ç›®æ ‡æ–¹æ³•</span><br>        proxySubject.request();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="CGLibåŠ¨æ€ä»£ç†"><a href="#CGLibåŠ¨æ€ä»£ç†" class="headerlink" title="CGLibåŠ¨æ€ä»£ç†"></a>CGLibåŠ¨æ€ä»£ç†</h3><blockquote><p>é€šè¿‡æ“ä½œå­—èŠ‚ç å®ç°ä»£ç†</p></blockquote><p>Cglibçš„å®ç°æ˜¯åœ¨å­—èŠ‚ç çš„åŸºç¡€ä¸Šçš„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å¼€æºçš„ASMè¯»å–å­—èŠ‚ç ï¼Œå¯¹ç±»å®ç°å¢å¼ºåŠŸèƒ½çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MyBatis</title>
    <link href="/2023/05/24/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis/mybatis/"/>
    <url>/2023/05/24/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis/mybatis/</url>
    
    <content type="html"><![CDATA[<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><blockquote><p>å¯¹äºJDBCçš„å°è£…</p></blockquote><h2 id="JDBCæ‰§è¡Œæ­¥éª¤"><a href="#JDBCæ‰§è¡Œæ­¥éª¤" class="headerlink" title="JDBCæ‰§è¡Œæ­¥éª¤"></a>JDBCæ‰§è¡Œæ­¥éª¤</h2><blockquote><p>JDBCï¼ˆJava Data Base Connectivityï¼‰</p></blockquote><ol><li>æ³¨å†Œé©±åŠ¨</li><li>å»ºç«‹è¿æ¥</li><li>åˆ›å»ºSQL</li><li>æ‰§è¡ŒSQL</li><li>å°è£…ç»“æœé›†</li><li>é‡Šæ”¾èµ„æº</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ³¨å†Œé©±åŠ¨</span><br>Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br><span class="hljs-comment">// å»ºç«‹è¿æ¥</span><br><span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DriverManager.getConnection(æ•°æ®åº“åœ°å€, ç”¨æˆ·å, å¯†ç );<br><span class="hljs-comment">// åˆ›å»ºSQL</span><br><span class="hljs-type">Statement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> connection.createStatement();<br><span class="hljs-comment">// æ‰§è¡ŒSQL</span><br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> statement.executeQueue(sql);<br><span class="hljs-comment">// å¤„ç†ç»“æœé›†</span><br>...<br><span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br>.....close()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringMVC</title>
    <link href="/2023/05/24/spring/SpringMVC/"/>
    <url>/2023/05/24/spring/SpringMVC/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><blockquote><p>MVCï¼ˆModel-View-Controllerï¼‰ï¼Œæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨</p></blockquote><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>SpringMVCåº•å±‚å°±æ˜¯Servletï¼ŒSpringMVCå°±æ˜¯å¯¹Servletè¿›è¡Œæ·±å±‚æ¬¡çš„å°è£…</p><p><strong>MVCæ¨¡å¼</strong>ï¼š</p><ul><li><p>Modelè¡¨ç¤ºæ•°æ®å’Œåº”ç”¨é€»è¾‘ï¼Œå¯èƒ½åŒ…æ‹¬æ•°æ®åº“æ“ä½œç­‰ã€‚Viewæ˜¯ç”¨æˆ·æ‰€çœ‹åˆ°çš„ç•Œé¢ï¼Œå®ƒå±•ç¤ºModelä¸­çš„æ•°æ®å¹¶è®©ç”¨æˆ·ä¸å…¶è¿›è¡Œäº¤äº’ã€‚Controllerè´Ÿè´£å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œä»Viewä¸­æ¥æ”¶è¾“å…¥å¹¶åœ¨Modelé‡Œé¢è¯»å–æˆ–ä¿®æ”¹æ•°æ®,è´Ÿè´£æŠŠæ¨¡å—å’Œè§†å›¾ç»“åˆèµ·æ¥</p><p>  <img src="/img/spring_img/SpringMVC%E6%95%B4%E4%BD%93.png" alt="SpringMVCæ‰§è¡Œæµç¨‹"></p></li></ul><h2 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h2><p><img src="/img/spring_img/SpringMVC%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="SpringMVCæ‰§è¡Œæµç¨‹"></p><ol><li>ç”¨æˆ·å‘é€è¯·æ±‚åˆ°<strong>å‰ç«¯è°ƒåº¦å™¨</strong>ï¼ˆDispatcherServletï¼‰</li><li>è°ƒåº¦å™¨æ”¶åˆ°è¯·æ±‚åè°ƒç”¨<strong>å¤„ç†å™¨æ˜ å°„å™¨</strong>ï¼ˆHandlerMappingï¼‰</li><li>å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®urlæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨å’Œæ‹¦æˆªå™¨ï¼Œç”Ÿæˆæ‰§è¡Œé“¾ï¼Œè¿”å›ç»™è°ƒåº¦å™¨</li><li>è°ƒåº¦å™¨é€šè¿‡<strong>å¤„ç†å™¨é€‚é…å™¨</strong>ï¼ˆHandlerAdapterï¼‰è°ƒç”¨å…·ä½“çš„<strong>å¤„ç†å™¨</strong>ï¼ˆHandlerï¼‰ï¼Œè¿”å›<strong>ModelAndView</strong></li><li>è°ƒåº¦å™¨å°†ModelAndViewä¼ ç»™<strong>è§†å›¾è§£æå™¨</strong>ï¼ˆViewResloverï¼‰è§£æï¼Œè¿”å›<strong>è§†å›¾å¯¹è±¡</strong>ï¼ˆViewï¼‰</li><li>è°ƒåº¦å™¨æ¸²æŸ“è§†å›¾ï¼ŒæŠŠè§†å›¾å’Œæ•°æ®ç»“åˆï¼Œå“åº”ç»™ç”¨æˆ·</li></ol><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h2><ul><li><strong>å‰ç«¯è°ƒåº¦å™¨</strong>ï¼ˆDispatcherServletï¼‰ï¼šæ¥æ”¶è¯·æ±‚ï¼Œå“åº”æ•°æ®ï¼Œéœ€è¦ç¨‹åºå‘˜é…ç½®</li><li>å¤„ç†å™¨æ˜ å°„å™¨ï¼ˆHandlerMappingï¼‰ï¼šé€šè¿‡urlæŸ¥æ‰¾Handler</li><li>å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandler Adapterï¼‰ï¼šæ‰§è¡ŒHandlerä¸­çš„æ–¹æ³•</li><li><strong>å¤„ç†å™¨</strong>ï¼ˆHandlerï¼‰ï¼šä¸šåŠ¡æ–¹æ³•ï¼Œéœ€è¦ç¨‹åºå‘˜ç¼–å†™</li><li>è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰ï¼šæŠŠModelAndViewè§£æå‡ºç»™ç”¨æˆ·çœ‹çš„è§†å›¾</li><li><strong>è§†å›¾</strong>ï¼ˆViewï¼‰ï¼šå±•ç¤ºç»™ç”¨æˆ·çœ‹çš„ï¼Œéœ€è¦ç¨‹åºå‘˜ç¼–å†™</li></ul><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ol><li><p>è°ƒåº¦å™¨ï¼ˆDispatcherServletï¼‰å¦‚ä½•è·å–å¤„ç†å™¨ï¼ˆHandlerï¼‰ï¼Ÿ</p><p>è°ƒåº¦å™¨é‡Œæœ‰ä¸€ä¸ªdoDispatch()æ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†getHandler()æ–¹æ³•ï¼›åœ¨getHandler()é‡Œé¢è°ƒç”¨äº†å¤„ç†å™¨æ˜ å°„å™¨ï¼ˆHandlerMappingï¼‰çš„getHandler()æ–¹æ³•æ¥è·å–å¤„ç†å™¨</p></li><li><p>è°ƒåº¦å™¨å¦‚ä½•æ‰§è¡Œå¤„ç†å™¨ï¼Ÿ</p><p>è°ƒåº¦å™¨é‡Œçš„doDispatch()æ–¹æ³•é‡Œï¼Œé¦–å…ˆé€šè¿‡getHandlerAdapter()æ–¹æ³•è·å–å½“å‰å¤„ç†å™¨çš„å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapterï¼‰æ¥åšé€‚é…ï¼Œç„¶åæ‰§è¡Œé€‚é…å™¨çš„handler()æ–¹æ³•</p></li><li><p>è°ƒåº¦å™¨å¦‚ä½•è§£æè§†å›¾å¯¹è±¡ï¼ˆModelAndViewï¼‰çš„ï¼Ÿ</p><p>è°ƒåº¦å™¨é‡Œçš„doDispatch()æ–¹æ³•é‡Œï¼Œè°ƒç”¨processDispatcherResult()æ–¹æ³•ï¼Œæ–¹æ³•é‡Œè°ƒç”¨render()æ–¹æ³•ï¼Œrender()æ–¹æ³•è°ƒç”¨resolveViewName()ï¼Œé€šè¿‡éå†çš„æ–¹å¼æ¥æ‰¾å’ŒviewNameç›¸åŒçš„View</p></li><li><p>ä¸‰å¤§ç»„ä»¶ï¼ˆHandlerMappingã€HandlerAdapterã€ViewResolverï¼‰æ˜¯è°åˆå§‹åŒ–çš„ï¼Ÿ</p><p>SpringMVCä¸­é€šè¿‡DispatcherServletä¸­çš„initStrategies()æ–¹æ³•ï¼Œé€šè¿‡é»˜è®¤é…ç½®æ¥æ‰¾åˆ°ç±»æ‰€åœ¨ä½ç½®ï¼Œæ¥åˆå§‹åŒ–ç»„ä»¶</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pinia</title>
    <link href="/2023/05/10/%E5%89%8D%E7%AB%AF/vue/Pinia/"/>
    <url>/2023/05/10/%E5%89%8D%E7%AB%AF/vue/Pinia/</url>
    
    <content type="html"><![CDATA[<h1 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h1><blockquote><p>Piniaæ˜¯Vueçš„ä¸“å±çš„æœ€æ–°<strong>çŠ¶æ€ç®¡ç†åº“</strong>ï¼Œæ˜¯VuexçŠ¶æ€ç®¡ç†å·¥å…·çš„æ›¿ä»£å“ï¼Œç”¨äºç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®</p></blockquote><p><a href="https://pinia.vuejs.org/zh/">Piniaä¸­æ–‡æ–‡æ¡£</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ol><li><p>ä¸‹è½½ä¾èµ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs npm">npm install pinia<br></code></pre></td></tr></table></figure></li><li><p>å¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// main.js</span><br><br><span class="hljs-comment">// å¯¼å…¥Pinia</span><br><span class="hljs-keyword">import</span> &#123; createPinia &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><span class="hljs-comment">// åˆ›å»º</span><br><span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()<br><br><span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">use</span>(pinia).<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>ä½¿ç”¨Piniaå®ç°ç®€æ˜“è®¡æ•°å™¨</p><ol><li><p>åˆ›å»ºStoreï¼Œå®šä¹‰å˜é‡å’Œæ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">// stores.counter.js<br>import &#123; ref &#125; from &quot;vue&quot;;<br>import &#123; defineStore &#125; from &quot;pinia&quot;;<br><br>export const useCounterStore = defineStore(&#x27;counter&#x27;, () =&gt; &#123;<br>    const count = ref(0)<br>    function increment() &#123;<br>        count.value++<br>    &#125;<br><br>    return &#123; count, increment &#125;<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>å…¶ä»–ç»„ä»¶ä½¿ç”¨Store</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">// components.PiniaTest.vue<br>&lt;script setup&gt;<br>    import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;<br><br>    const counter = useCounterStore()<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;button @click=&quot;counter.increment()&quot;&gt;&#123;&#123; counter.count &#125;&#125;&lt;/button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure></li></ol><h2 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h2><blockquote><p>ç›¸å½“äºè®¡ç®—å±æ€§</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">import &#123; computed, ref &#125; from &quot;vue&quot;;<br>import &#123; defineStore &#125; from &quot;pinia&quot;;<br><br>export const useCounterStore = defineStore(&#x27;counter&#x27;, () =&gt; &#123;<br>    const count = ref(0)<br>    function increment() &#123;<br>        count.value++<br>    &#125;<br>    // Getter<br>    const doubleCount = computed(() =&gt; count.value * 2)<br><br>    return &#123; <br>        count, <br>        increment,<br>        doubleCount<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><blockquote><p>ç›¸å½“äºæ–¹æ³•</p></blockquote><p>åˆ›å»ºå¼‚æ­¥è·å–æ•°æ®çš„action</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">// store<br>import &#123; ref &#125; from &quot;vue&quot;;<br>import &#123; defineStore &#125; from &quot;pinia&quot;;<br>import axios from &quot;axios&quot;;<br><br>const API_URL = &#x27;http://geek.itheima.net/v1_0/channels&#x27;<br>export const useCounterStore = defineStore(&#x27;counter&#x27;, () =&gt; &#123;<br>    // Action<br>    const list = ref([])<br>    const getList = async () =&gt; &#123;<br>        const res = await axios.get(API_URL)<br>        list.value = res.data.data.channels<br>    &#125;<br><br>    return &#123;         <br>        list,<br>        getList<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>ç»„ä»¶è°ƒç”¨storeçš„action</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>    import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;<br>import &#123; onMounted &#125; from &#x27;vue&#x27;;<br><br>    const counter = useCounterStore()<br><br>    onMounted(() =&gt; &#123;<br>        counter.getList()<br>    &#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;ul&gt;<br>        &lt;li v-for=&quot;item in counter.list&quot; :key=&quot;item.id&quot;&gt;<br>            &#123;&#123; item.name &#125;&#125;<br>        &lt;/li&gt;<br>    &lt;/ul&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="è§£æ„"><a href="#è§£æ„" class="headerlink" title="è§£æ„"></a>è§£æ„</h2><p>å¯ä»¥é€šè¿‡storeToRefsæŠŠstoreè§£æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;<br>import &#123; onMounted &#125; from &#x27;vue&#x27;;<br>import &#123; storeToRefs &#125; from &#x27;pinia&#x27;<br><br>const counter = useCounterStore()<br>// åªèƒ½è§£æ„å‡ºæ•°æ®(state, getter)ï¼Œæ–¹æ³•(action)è§£æ„ä¸å‡ºæ¥<br>const &#123; list &#125; = storeToRefs(counter)<br><br>onMounted(() =&gt; &#123;<br>    counter.getList()<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;ul&gt;<br>        &lt;li v-for=&quot;item in list&quot; :key=&quot;item.id&quot;&gt;<br>            &#123;&#123; item.name &#125;&#125;<br>        &lt;/li&gt;<br>    &lt;/ul&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><h3 id="é€šè¿‡piniaä¼˜åŒ–è¯·æ±‚"><a href="#é€šè¿‡piniaä¼˜åŒ–è¯·æ±‚" class="headerlink" title="é€šè¿‡piniaä¼˜åŒ–è¯·æ±‚"></a>é€šè¿‡piniaä¼˜åŒ–è¯·æ±‚</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/store/category.js</span><br><br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><span class="hljs-keyword">import</span> &#123; defineStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;pinia&quot;</span><br><span class="hljs-keyword">import</span> &#123; getCategoryAPI &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/apis/layout&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCategoryStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">&#x27;categoryStore&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// å¯¼èˆªåˆ—è¡¨</span><br>    <span class="hljs-keyword">const</span> categoryList = <span class="hljs-title function_">ref</span>([])<br>    <span class="hljs-comment">// è·å–å¯¼èˆªåˆ—è¡¨</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCategoryList</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getCategoryAPI</span>()<br>        categoryList.<span class="hljs-property">value</span> = res.<span class="hljs-property">result</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        categoryList,<br>        getCategoryList<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨çˆ¶ç»„ä»¶é‡Œå‘é€è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä¿å­˜åœ¨storeä¸­ï¼Œä¹‹åå­ç»„ä»¶é€šè¿‡storeè·å–æ•°æ®ï¼Œä¸éœ€è¦å†å»é‡æ–°è¯·æ±‚æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vue">// src/views/Layout/index.vue<br><br>&lt;script setup&gt;<br>import LayoutNav from &#x27;./components/LayoutNav.vue&#x27;;<br>import LayoutHeader from &#x27;./components/LayoutHeader.vue&#x27;;<br>import LayoutFooter from &#x27;./components/LayoutFooter.vue&#x27;;<br>import LayoutFixed from &#x27;./components/LayoutFixed.vue&#x27;;<br>import &#123; useCategoryStore &#125; from &#x27;@/stores/category&#x27;;<br>import &#123; onMounted &#125; from &#x27;vue&#x27;;<br><br>// åŠ è½½å¯¼èˆªåˆ—è¡¨ï¼Œè®©å¸é¡¶å¯¼èˆªæ¡å’Œå¯¼èˆªæ¡åªéœ€è¦ä¸€æ¬¡è¯·æ±‚<br>const categoryStore = useCategoryStore()<br>onMounted(() =&gt; &#123;<br>    categoryStore.getCategoryList()<br>&#125;)<br><br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;LayoutFixed/&gt;<br>    &lt;LayoutNav/&gt;<br>    &lt;LayoutHeader/&gt;<br>    &lt;RouterView/&gt;<br>    &lt;LayoutFooter/&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="piniaè´Ÿè´£è§¦å‘action"><a href="#piniaè´Ÿè´£è§¦å‘action" class="headerlink" title="piniaè´Ÿè´£è§¦å‘action"></a>piniaè´Ÿè´£è§¦å‘action</h3><blockquote><p>Piniaè´Ÿè´£ç”¨æˆ·æ•°æ®ç›¸å…³çš„stateå’Œactionï¼Œç»„ä»¶ä¸­åªè´Ÿè´£è§¦å‘actionå‡½æ•°å¹¶ä¼ é€’å‚æ•°</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/store/user.js</span><br><span class="hljs-keyword">import</span> &#123; defineStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; loginAPI &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/apis/user&#x27;</span><br><br><span class="hljs-comment">// ç™»å½•ç”¨æˆ·ä¿¡æ¯Store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// ç”¨æˆ·æ•°æ®</span><br>    <span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">ref</span>(&#123;&#125;)<br>    <span class="hljs-comment">// è·å–æ•°æ®æ–¹æ³•</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">&#123;account, password&#125;</span>) &#123;<br>        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginAPI</span>(&#123; account, password &#125;)<br>        userInfo.<span class="hljs-property">value</span> = res.<span class="hljs-property">result</span><br>    &#125;<br>    <span class="hljs-comment">// è¿”å›</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        userInfo,<br>        getUserInfo<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>ç»„ä»¶é€šè¿‡è°ƒç”¨<code>useUserStore</code>æ¥å‘èµ·è¯·æ±‚ï¼Œå¹¶æŠŠæ•°æ®ä¿å­˜åœ¨Piniaã€‚Piniaä¸­çš„æ•°æ®æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œä¸€åˆ·æ–°å°±æ²¡äº†ï¼Œéœ€è¦è¿›è¡ŒæŒä¹…åŒ–</p><p><a href="https://prazdevs.github.io/pinia-plugin-persistedstate/zh/guide/">PiniaæŒä¹…åŒ–æ’ä»¶</a></p><p>æŒä¹…åŒ–åï¼Œstore returnçš„æ•°æ®ä¼šè¢«ä¿å­˜åˆ°<code>Local Storage</code>ä¸­</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue3</title>
    <link href="/2023/05/06/%E5%89%8D%E7%AB%AF/vue/Vue3/"/>
    <url>/2023/05/06/%E5%89%8D%E7%AB%AF/vue/Vue3/</url>
    
    <content type="html"><![CDATA[<h1 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h1><p><a href="https://cn.vuejs.org/">å®˜ç½‘</a></p><h2 id="å£°æ˜è¯•æ¸²æŸ“"><a href="#å£°æ˜è¯•æ¸²æŸ“" class="headerlink" title="å£°æ˜è¯•æ¸²æŸ“"></a>å£°æ˜è¯•æ¸²æŸ“</h2><p>å½“çŠ¶æ€æ”¹å˜æ—¶ï¼ŒHTML ä¼šè‡ªåŠ¨æ›´æ–°</p><p><strong>å“åº”å¼</strong>ï¼šèƒ½åœ¨æ”¹å˜æ—¶è§¦å‘æ›´æ–°çš„çŠ¶æ€</p><h3 id="ç»„åˆå¼"><a href="#ç»„åˆå¼" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; reactive, ref &#125; from &#x27;vue&#x27;<br><br>const counter = reactive(&#123; count: 0 &#125;)<br>const message = ref(&#x27;Hello World!&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;<br>  &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p><strong>reactiveå’Œrefçš„æ¯”è¾ƒ</strong>ï¼š</p><ul><li><p><strong>reactiveåªèƒ½ç”¨äºå®šä¹‰å¯¹è±¡ï¼Œrefå¯ä»¥å®šä¹‰ä»»ä½•ç±»å‹</strong></p></li><li><p>reactiveæ˜¯é€šè¿‡åˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°å“åº”å¼ï¼Œç»™ä¸€ä¸ªå·²ç»é€šè¿‡reactiveåˆ›å»ºçš„ä»£ç†å¯¹è±¡å†å¥—ä¸€å±‚reactiveè¿”å›çš„ä»æ˜¯åŸæ¥çš„ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡é‡Œçš„å±æ€§ä¹Ÿæ˜¯è¢«ä»£ç†äº†ï¼›å› æ­¤reactiveå¯¹åŸå§‹ç±»å‹æ— æ•ˆ(numberã€stringã€boolean)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vue">const raw = &#123;&#125;<br>const proxy = reactive(raw)<br><br>console.log(proxy === raw) // false<br>console.log(reactive(raw) === proxy) // true<br>console.log(reactive(proxy) === proxy) // true<br></code></pre></td></tr></table></figure></li><li><p>refæ˜¯å°†ä¼ å…¥çš„å€¼åŒ…è£…ä¸ºä¸€ä¸ªå¸¦<code>.value</code>å±æ€§çš„å¯¹è±¡ã€‚refå¯¹è±¡ä½œä¸ºé¡¶å±‚å…ƒç´ åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨è§£åŒ…ï¼Œä¸éœ€è¦<code>.value</code>;ä½œä¸ºå±æ€§æ—¶éœ€è¦<code>.value</code></p></li></ul><p><code>&lt;script setup&gt;</code>ä¸­çš„setupè¡¨ç¤ºé‡Œé¢å®šä¹‰çš„å˜é‡æ˜¯å“åº”å¼çš„</p><h3 id="é€‰é¡¹å¼"><a href="#é€‰é¡¹å¼" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><p>å£°æ˜å˜é‡å’Œå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      message: &#x27;Hello World!&#x27;,<br>      counter: &#123;<br>        count: 0<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;<br>  &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="å±æ€§ç»‘å®šv-bind"><a href="#å±æ€§ç»‘å®šv-bind" class="headerlink" title="å±æ€§ç»‘å®šv-bind :"></a>å±æ€§ç»‘å®š<code>v-bind :</code></h2><p><code>v-bind:</code>(ç¼©å†™<code>:</code>)å¯ä»¥ç”¨äºç»™æ ‡ç­¾çš„å±æ€§ç»‘å®š</p><p>æ³¨æ„ï¼š</p><ul><li><p>å¦‚æœç»‘å®šçš„å€¼ä¸º<code>null</code>æˆ–è€…<code>undefined</code>ï¼Œåˆ™å±æ€§ä¼šè¢«ç§»é™¤</p></li><li><p>å¦‚æœç»‘å®šçš„å€¼ä¸ºtrueæˆ–falseï¼Œåˆ™ä¸ºfalseæ—¶å±æ€§ä¼šè¢«ç§»é™¤</p></li></ul><h3 id="ç»„åˆå¼-1"><a href="#ç»„åˆå¼-1" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br><br>const titleClass = ref(&#x27;title&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h1 :class=&quot;titleClass&quot;&gt;Make me red&lt;/h1&gt;<br>&lt;/template&gt;<br><br>&lt;style&gt;<br>.title &#123;<br>  color: red;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="å“åº”å¼"><a href="#å“åº”å¼" class="headerlink" title="å“åº”å¼"></a>å“åº”å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      titleClass: &#x27;title&#x27;<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h1 :class=&#x27;titleClass&#x27;&gt;Make me red&lt;/h1&gt; &lt;!-- æ­¤å¤„æ·»åŠ ä¸€ä¸ªåŠ¨æ€ class ç»‘å®š --&gt;<br>&lt;/template&gt;<br><br>&lt;style&gt;<br>.title &#123;<br>  color: red;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><h2 id="äº‹ä»¶ç›‘å¬v-on"><a href="#äº‹ä»¶ç›‘å¬v-on" class="headerlink" title="äº‹ä»¶ç›‘å¬v-on @"></a>äº‹ä»¶ç›‘å¬<code>v-on @</code></h2><p>é€šè¿‡<code>v-on:</code>æˆ–<code>@</code>æ¥ç›‘å¬äº‹ä»¶</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>å¯ä»¥ç›´æ¥å†™ä¸€äº›ç®€å•çš„è¡¨ç¤ºå¼</li><li>ç›´æ¥ç»‘å®šæ–¹æ³•åï¼Œæ–¹æ³•å¯ä»¥æœ‰ä¸€ä¸ªåŸç”Ÿ DOM äº‹ä»¶å‚æ•°<code>event</code>ï¼›ç»‘å®š<code>æ–¹æ³•å(å‚æ•°)</code>å¯ä»¥ä¼ é€’å‚æ•°, ä½†<code>event</code>æ²¡äº†ï¼›ç»‘å®š<code>æ–¹æ³•å(å‚æ•°, ..., $event)</code>å¯ä»¥ä¼ å…¥<code>event</code></li></ul><p><strong>äº‹ä»¶ä¿®é¥°ç¬¦</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- å•å‡»äº‹ä»¶å°†åœæ­¢ä¼ é€’ --&gt;<br>&lt;a @click.stop=&quot;doThis&quot;&gt;&lt;/a&gt;<br><br>&lt;!-- æäº¤äº‹ä»¶å°†ä¸å†é‡æ–°åŠ è½½é¡µé¢ --&gt;<br>&lt;form @submit.prevent=&quot;onSubmit&quot;&gt;&lt;/form&gt;<br><br>&lt;!-- ä¿®é¥°è¯­å¯ä»¥ä½¿ç”¨é“¾å¼ä¹¦å†™ --&gt;<br>&lt;a @click.stop.prevent=&quot;doThat&quot;&gt;&lt;/a&gt;<br><br>&lt;!-- ä¹Ÿå¯ä»¥åªæœ‰ä¿®é¥°ç¬¦ --&gt;<br>&lt;form @submit.prevent&gt;&lt;/form&gt;<br><br>&lt;!-- ä»…å½“ event.target æ˜¯å…ƒç´ æœ¬èº«æ—¶æ‰ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨ --&gt;<br>&lt;!-- ä¾‹å¦‚ï¼šäº‹ä»¶å¤„ç†å™¨ä¸æ¥è‡ªå­å…ƒç´  --&gt;<br>&lt;div @click.self=&quot;doThat&quot;&gt;...&lt;/div&gt;<br></code></pre></td></tr></table></figure><p><strong>æŒ‰é”®ä¿®é¥°ç¬¦</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- ä»…åœ¨ `key` ä¸º `Enter` æ—¶è°ƒç”¨ `submit` --&gt;<br>&lt;input @keyup.enter=&quot;submit&quot; /&gt;<br><br>&lt;!-- Alt + Enter --&gt;<br>&lt;input @keyup.alt.enter=&quot;clear&quot; /&gt;<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨çš„æŒ‰é”®çš„åˆ«åï¼š</p><ul><li><code>.enter</code></li><li><code>.tab</code></li><li><code>.delete</code> (æ•è·â€œDeleteâ€å’Œâ€œBackspaceâ€ä¸¤ä¸ªæŒ‰é”®)</li><li><code>.esc</code></li><li><code>.space</code></li><li><code>.up</code></li><li><code>.down</code></li><li><code>.left</code></li><li><code>.right</code></li><li><code>.ctrl</code></li><li><code>.alt</code></li><li><code>.shift</code></li><li><code>.meta</code>ï¼ˆwiné”®ï¼‰</li><li><code>.left</code>ï¼ˆé¼ æ ‡å·¦é”®ï¼‰</li><li><code>.right</code>ï¼ˆé¼ æ ‡å³é”®ï¼‰</li><li><code>.middle</code>ï¼ˆé¼ æ ‡ä¸­é”®ï¼‰</li></ul><h3 id="ç»„åˆå¼-2"><a href="#ç»„åˆå¼-2" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br><br>const count = ref(0)<br>function increment() &#123;<br>  count.value++<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;!-- ä½¿æ­¤æŒ‰é’®ç”Ÿæ•ˆ --&gt;<br>  &lt;button @click=&quot;increment&quot;&gt;count is: &#123;&#123; count &#125;&#125;&lt;/button&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-1"><a href="#é€‰é¡¹å¼-1" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      count: 0<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    increment() &#123;<br>      this.count++<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;!-- ä½¿æ­¤æŒ‰é’®ç”Ÿæ•ˆ --&gt;<br>  &lt;button @click=&quot;increment&quot;&gt;count is: &#123;&#123; count &#125;&#125;&lt;/button&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="è¡¨å•ç»‘å®šv-model"><a href="#è¡¨å•ç»‘å®šv-model" class="headerlink" title="è¡¨å•ç»‘å®šv-model"></a>è¡¨å•ç»‘å®š<code>v-model</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      text: &#x27;&#x27;<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    onInput(e) &#123;<br>      this.text = e.target.value<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;input :value=&quot;text&quot; @input=&quot;onInput&quot; placeholder=&quot;Type here&quot;&gt;<br>  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å†™æ³•éœ€è¦é€šè¿‡<code>v-bind</code>å’Œ<code>v-on</code>æ¥åŒå‘ç»‘å®š</p><p>å¯ä»¥ç”¨è¯­æ³•ç³–<code>&lt;input v-model=&quot;text&quot;&gt;</code>ï¼Œ</p><p><code>&lt;textarea&gt;</code>ï¼ˆå¤šè¡Œæ–‡æœ¬ï¼‰ã€<code>&lt;input type=&quot;checkbox&quot;&gt;</code>ï¼ˆé€‰æ‹©æ¡†ï¼‰ã€<code>&lt;select&gt;</code>ï¼ˆä¸‹æ‹‰æ¡†ï¼‰ã€<code>&lt;input type=&quot;radio&quot;&gt;</code>ï¼ˆå•é€‰æŒ‰é’®ï¼‰ç­‰ä¹Ÿå¯ä»¥ç”¨<code>v-model</code>æ¥ç®€åŒ–ç»‘å®š</p><h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><ul><li><code>.lazy</code>ï¼š<code>v-model</code> ä¼šåœ¨æ¯æ¬¡ <code>input</code> äº‹ä»¶åæ›´æ–°æ•°æ®<code>v-model.lazy</code>ä¼šåœ¨æ¯æ¬¡ <code>change</code> äº‹ä»¶åæ›´æ–°æ•°æ®</li><li><code>.number</code>ï¼šç”¨æˆ·è¾“å…¥è‡ªåŠ¨è½¬æ¢ä¸ºæ•°å­— </li><li><code>.trim</code>ï¼šè‡ªåŠ¨å»é™¤ç”¨æˆ·è¾“å…¥å†…å®¹ä¸­ä¸¤ç«¯çš„ç©ºæ ¼</li></ul><h2 id="æ¡ä»¶æ¸²æŸ“v-if"><a href="#æ¡ä»¶æ¸²æŸ“v-if" class="headerlink" title="æ¡ä»¶æ¸²æŸ“v-if"></a>æ¡ä»¶æ¸²æŸ“<code>v-if</code></h2><p>é€šè¿‡<code>v-if</code>ã€<code>v-else</code>ã€<code>v-else-if</code>æ¥é€‰æ‹©æ¸²æŸ“å…ƒç´ </p><p><code>v-show</code>ä¹Ÿå¯ä»¥ï¼Œä¸åŒåœ¨äº<code>v-show</code>æ˜¯é€šè¿‡<code>display</code>æ¥æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºï¼Œ<code>v-if</code>ç›´æ¥æŠŠå…ƒç´ åˆ äº†</p><h3 id="ç»„åˆå¼-3"><a href="#ç»„åˆå¼-3" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br><br>const awesome = ref(true)<br><br>function toggle() &#123;<br>  awesome.value = !awesome.value<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;<br>  &lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;<br>  &lt;h1 v-else&gt;Oh no &lt;/h1&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-2"><a href="#é€‰é¡¹å¼-2" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      awesome: true<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    toggle() &#123;<br>      this.awesome = !this.awesome<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;<br>  &lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;<br>  &lt;h1 v-else&gt;Oh no&lt;/h1&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="åˆ—è¡¨æ¸²æŸ“v-for"><a href="#åˆ—è¡¨æ¸²æŸ“v-for" class="headerlink" title="åˆ—è¡¨æ¸²æŸ“v-for"></a>åˆ—è¡¨æ¸²æŸ“<code>v-for</code></h2><p>é€šè¿‡<code>v-for å˜é‡ in æ•°ç»„</code>æ¥éå†æ¸²æŸ“ä¸€ä¸ªæ•°ç»„</p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li><code>:key</code>ä½¿å¾— Vue èƒ½å¤Ÿç²¾ç¡®çš„ç§»åŠ¨æ¯ä¸ª <code>&lt;li&gt;</code>ï¼Œä»¥åŒ¹é…å¯¹åº”çš„å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚</li><li><code>v-for</code>ä¹Ÿå¯ä»¥éå†å¯¹è±¡çš„å±æ€§<code>v-for=&quot;(value, key, index) in myObject&quot;</code></li><li>åŒä¸€ä¸ªæ ‡ç­¾é‡Œ<code>v-if</code>çš„ä¼˜å…ˆçº§æ¯”<code>v-for</code>é«˜</li></ul><h3 id="ç»„åˆå¼-4"><a href="#ç»„åˆå¼-4" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br><br>// ç»™æ¯ä¸ª todo å¯¹è±¡ä¸€ä¸ªå”¯ä¸€çš„ id<br>let id = 0<br><br>const newTodo = ref(&#x27;&#x27;)<br>const todos = ref([<br>  &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,<br>  &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,<br>  &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;<br>])<br><br>function addTodo() &#123;<br>  todos.value.push(&#123; id: id++, text: newTodo.value &#125;)<br>  newTodo.value = &#x27;&#x27;<br>&#125;<br><br>function removeTodo(todo) &#123;<br>  todos.value = todos.value.filter((t) =&gt; t !== todo)<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;<br>    &lt;input v-model=&quot;newTodo&quot;&gt;<br>    &lt;button&gt;Add Todo&lt;/button&gt;    <br>  &lt;/form&gt;<br>  &lt;ul&gt;<br>    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;<br>      &#123;&#123; todo.text &#125;&#125;<br>      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;<br>    &lt;/li&gt;<br>  &lt;/ul&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-3"><a href="#é€‰é¡¹å¼-3" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>// ç»™æ¯ä¸ª todo å¯¹è±¡ä¸€ä¸ªå”¯ä¸€çš„ id<br>let id = 0<br><br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      newTodo: &#x27;&#x27;,<br>      todos: [<br>        &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,<br>        &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,<br>        &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;<br>      ]<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    addTodo() &#123;<br>      this.todos.push(&#123; id: id++, text: this.newTodo &#125;)<br>      this.newTodo = &#x27;&#x27;<br>    &#125;,<br>    removeTodo(todo) &#123;<br>      this.todos = this.todos.filter((t) =&gt; t !== todo)<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;<br>    &lt;input v-model=&quot;newTodo&quot;&gt;<br>    &lt;button&gt;Add Todo&lt;/button&gt;    <br>  &lt;/form&gt;<br>  &lt;ul&gt;<br>    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;<br>      &#123;&#123; todo.text &#125;&#125;<br>      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;<br>    &lt;/li&gt;<br>  &lt;/ul&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="è®¡ç®—å±æ€§computed"><a href="#è®¡ç®—å±æ€§computed" class="headerlink" title="è®¡ç®—å±æ€§computed"></a>è®¡ç®—å±æ€§<code>computed</code></h2><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>è®¡ç®—å±æ€§åº”å½“åªç”¨æ¥è®¡ç®—ï¼Œä¸åº”è¯¥åŒ…å«å…¶ä»–åŠŸèƒ½ï¼Œå‡å°‘å¤æ‚æ€§</li><li>è®¡ç®—å±æ€§åº”è¯¥åªè¯»</li></ul><h3 id="ç»„åˆå¼-5"><a href="#ç»„åˆå¼-5" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; reactive, ref, computed &#125; from &#x27;vue&#x27;<br><br>const list = ref([1, 2, 3, 4, 5, 6, 7, 8])<br><br>const computedList = computed(() =&gt; &#123;<br>  return list.value.filter((val) =&gt; val &gt; 2)<br>&#125;)<br><br>// å®šæ—¶å™¨ï¼Œ3ç§’åæ·»åŠ å…ƒç´ ï¼Œè®¡ç®—å±æ€§ä¹Ÿä¼šé‡æ–°è®¡ç®—<br>setTimeout(() =&gt; &#123;<br>  list.value.push(9, 10)<br>&#125;, 3000)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    åŸå§‹æ•°ç»„ï¼š&#123;&#123; list &#125;&#125;<br>  &lt;/div&gt; <br>  &lt;br/&gt;<br>  &lt;div&gt;<br>    è®¡ç®—å±æ€§æ•°ç»„ &#123;&#123; computedList &#125;&#125;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="æ¨¡æ¿å¼•ç”¨-ref"><a href="#æ¨¡æ¿å¼•ç”¨-ref" class="headerlink" title="æ¨¡æ¿å¼•ç”¨ ref"></a>æ¨¡æ¿å¼•ç”¨ <code>ref</code></h2><p>é€šè¿‡<code>ref</code>æ¥è·å–æŒ‡å®šçš„DOMå…ƒç´ </p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>DOMå…ƒç´ æ˜¯åœ¨æŒ‚è½½åæ‰æœ‰çš„</li><li>å­ç»„ä»¶å¯ä»¥é€šè¿‡<code>defineExpose(&#123;&#125;)</code>æ¥å°†å±æ€§å€¼æš´éœ²ç»™çˆ¶ç»„ä»¶</li></ul><h3 id="ç»„åˆå¼-6"><a href="#ç»„åˆå¼-6" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref, onMounted &#125; from &#x27;vue&#x27;<br><br>// é€šè¿‡å˜é‡åæ¥åŒ¹é…DOMå…ƒç´ ï¼Œæ­¤æ—¶è¿˜æ²¡æŒ‚è½½å®Œï¼Œéœ€è¦å…ˆè®¾ä¸ºnull<br>const a = ref(null)<br><br>onMounted(() =&gt; &#123;<br>  a.value.textContent = &#x27;mounted!&#x27;<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;p ref=&quot;a&quot;&gt;hello&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-4"><a href="#é€‰é¡¹å¼-4" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  mounted() &#123;<br>    this.$refs.a.textContent = &#x27;world&#x27;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;p ref=&quot;a&quot;&gt;hello&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="/img/qianduan_img/Vue3%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png"></p><h3 id="ç»„åˆå¼-7"><a href="#ç»„åˆå¼-7" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><p>å’Œé€‰é¡¹å¼çš„åŒºåˆ«åœ¨äºç”Ÿå‘½å‘¨æœŸçš„åå­—å‰åŠ ä¸Šäº†onï¼Œé™¤äº†Createdæ¢æˆäº†setup</p><p>å¦‚æœå®šä¹‰äº†å¤šä¸ªç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œåˆ™ä¼šä¾æ¬¡è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; onMounted &#125; from &#x27;vue&#x27;<br><br>onMounted(() =&gt; &#123;<br>  console.log(&#x27;asdasd&#x27;)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="ç›‘å¬å™¨watch"><a href="#ç›‘å¬å™¨watch" class="headerlink" title="ç›‘å¬å™¨watch"></a>ç›‘å¬å™¨<code>watch</code></h2><p>å½“<code>data</code>å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘</p><p><strong>æ³¨æ„</strong></p><ul><li><p>ç›‘å¬å™¨åªæœ‰åœ¨å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ï¼Œå¦‚æœè¦<strong>åˆ›å»ºæ—¶å°±è§¦å‘</strong>éœ€è¦å®ç°<code>handle</code>æ–¹æ³•å’Œè®¾ç½®<code>immediate=true</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">watch: &#123;<br>    a: &#123;<br>      handler(newA) &#123;<br>        newA = &#x27;b&#x27;<br>        this.a = newA<br>      &#125;,<br>      immediate: true<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœè¦<strong>ç›‘å¬å¯¹è±¡é‡Œå±æ€§çš„å˜åŒ–</strong>ï¼Œéœ€è¦è®¾ç½®<code>deep:true</code>ï¼Œè¿™é‡Œç›‘å¬å±æ€§æ˜¯é€šè¿‡éå†å®ç°çš„ï¼Œæ•ˆç‡å¾ˆä½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">export default &#123;<br>  data() &#123;<br>    return &#123;<br>      a: &#123;<br>        b: &#x27;b&#x27;<br>      &#125;<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    <br>  &#125;,<br>  watch: &#123;<br>    a: &#123;<br>      b: &#123;<br>        handler(newB) &#123;<br>        this.b = newB<br>      &#125;,<br>      deep: true<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç›‘å¬å™¨æ˜¯åœ¨å±æ€§æ”¹å˜å‰è§¦å‘ï¼Œè¦æ”¹å˜åè§¦å‘ï¼Œéœ€è¦è®¾ç½®<code>flush: &#39;post&#39;</code></p></li><li><p>é€šè¿‡<code>this.$watch</code>æ–¹æ³•åˆ›å»ºç›‘å¬å™¨ï¼Œå¥½å¤„æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨è¿”å›çš„æ–¹æ³•æ¥åœæ­¢ç›‘å¬å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vue">export default &#123;<br>  created() &#123;<br>    const w = this.$watch(&#x27;question&#x27;, (newQuestion) =&gt; &#123;<br>      // ...<br>    &#125;)<br>w()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="ç»„åˆå¼-8"><a href="#ç»„åˆå¼-8" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><p>ç»„åˆå¼è¦å¼€å¯æ·±åº¦ä¾¦å¬ã€ç«‹å³å›è°ƒç­‰åŠŸèƒ½æ˜¯åœ¨watchç¬¬ä¸‰ä¸ªå‚æ•°é‡Œä¼ ä¸€ä¸ªå¯¹è±¡</p><p>å¦‚æœè¦ç²¾ç¡®ç›‘å¬å¯¹è±¡çš„æŸä¸ªå€¼ï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°æ”¹ä¸ºå›è°ƒå‡½æ•°ï¼Œè¿”å›è¦ç›‘å¬çš„é‚£ä¸ªå€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref, watch &#125; from &#x27;vue&#x27;<br><br>const todoId = ref(1)<br>const todoData = ref(null)<br><br>async function fetchData() &#123;<br>  todoData.value = null<br>  const res = await fetch(<br>    `https://jsonplaceholder.typicode.com/todos/$&#123;todoId.value&#125;`<br>  )<br>  todoData.value = await res.json()<br>&#125;<br><br>fetchData()<br>  <br>watch(todoId, (newTodoId) =&gt; &#123;<br>  fetchData()<br>&#125;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;<br>  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;<br>  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;<br>  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-5"><a href="#é€‰é¡¹å¼-5" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      todoId: 1,<br>      todoData: null<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    async fetchData() &#123;<br>      this.todoData = null<br>      const res = await fetch(<br>        `https://jsonplaceholder.typicode.com/todos/$&#123;this.todoId&#125;`<br>      )<br>      this.todoData = await res.json()<br>    &#125;<br>  &#125;,<br>  mounted() &#123;<br>    this.fetchData()<br>  &#125;,<br>  watch: &#123;<br>    todoId(newId) &#123;<br>      this.fetchData()<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;<br>  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;<br>  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;<br>  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="ç»„ä»¶-import"><a href="#ç»„ä»¶-import" class="headerlink" title="ç»„ä»¶ import"></a>ç»„ä»¶ <code>import</code></h2><h3 id="ç»„åˆå¼-9"><a href="#ç»„åˆå¼-9" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp /&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="é€‰é¡¹å¼-6"><a href="#é€‰é¡¹å¼-6" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>  import ChildComp from &#x27;./ChildComp.vue&#x27;<br>  export default &#123;<br>    // register child component<br>    components: &#123;<br>      ChildComp<br>    &#125;<br>  &#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;!-- render child component --&gt;<br>  &lt;ChildComp /&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼props"><a href="#çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼props" class="headerlink" title="çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼props"></a>çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼<code>props</code></h3><p>å­ç»„ä»¶å®šä¹‰propï¼Œçˆ¶ç»„ä»¶é€šè¿‡å±æ€§ç»‘å®šä¼ å€¼</p><h4 id="ç»„åˆå¼-10"><a href="#ç»„åˆå¼-10" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>const greeting = ref(&#x27;Hello from parent&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp :msg=&#x27;greeting&#x27;/&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>const props = defineProps(&#123;<br>  msg: String<br>&#125;)<br>console.log(props)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h2&gt;&#123;&#123; msg || &#x27;No props passed yet&#x27; &#125;&#125;&lt;/h2&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h4 id="é€‰é¡¹å¼-7"><a href="#é€‰é¡¹å¼-7" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>export default &#123;<br>  components: &#123;<br>    ChildComp<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      greeting: &#x27;Hello from parent&#x27;<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp :msg=&quot;greeting&quot;/&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  props: &#123;<br>    msg: String<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h2&gt;&#123;&#123; msg || &#x27;No props passed yet&#x27; &#125;&#125;&lt;/h2&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼emits"><a href="#å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼emits" class="headerlink" title="å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼emits"></a>å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼<code>emits</code></h3><p>å­ç»„ä»¶å®šä¹‰è§¦å‘å™¨emitï¼Œçˆ¶ç»„ä»¶é€šè¿‡äº‹ä»¶ç›‘å¬è·å–å­ç»„ä»¶çš„å€¼</p><h4 id="ç»„åˆå¼-11"><a href="#ç»„åˆå¼-11" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>const childMsg = ref(&#x27;No child msg yet&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp @response=&#x27;(msg) =&gt; childMsg = msg&#x27;/&gt;<br>  &lt;p&gt;&#123;&#123; childMsg &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>const emit = defineEmits([&#x27;response&#x27;])<br><br>emit(&#x27;response&#x27;, &#x27;hello from child&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h2&gt;Child component&lt;/h2&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h4 id="é€‰é¡¹å¼-8"><a href="#é€‰é¡¹å¼-8" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>export default &#123;<br>  components: &#123;<br>    ChildComp<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      childMsg: &#x27;No child msg yet&#x27;<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp @response=&#x27;(msg) =&gt; childMsg = msg&#x27;/&gt;<br>  &lt;p&gt;&#123;&#123; childMsg &#125;&#125;&lt;/p&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>export default &#123;<br>  emits: [&#x27;response&#x27;],<br>  created() &#123;<br>    this.$emit(&#x27;response&#x27;, &#x27;hello from child&#x27;)<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;h2&gt;Child component&lt;/h2&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ æ¨¡æ¿slot"><a href="#çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ æ¨¡æ¿slot" class="headerlink" title="çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ æ¨¡æ¿slot"></a>çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ æ¨¡æ¿<code>slot</code></h3><p>å­ç»„ä»¶ä½¿ç”¨æ’æ§½<code>&lt;slot&gt;</code>ä½œä¸ºå ä½ç¬¦ï¼Œçˆ¶ç»„ä»¶ä¼ æ¥çš„æ¨¡æ¿ä¼šæ”¾åˆ°è¿™ä¸ªä½ç½®</p><h4 id="ç»„åˆå¼-12"><a href="#ç»„åˆå¼-12" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>const msg = ref(&#x27;from parent&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp&gt;asd&lt;/ChildComp&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;slot&gt;Fallback content&lt;/slot&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h4 id="é€‰é¡¹å¼-9"><a href="#é€‰é¡¹å¼-9" class="headerlink" title="é€‰é¡¹å¼"></a>é€‰é¡¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>import ChildComp from &#x27;./ChildComp.vue&#x27;<br><br>export default &#123;<br>  components: &#123;<br>    ChildComp<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      msg: &#x27;from parent&#x27;<br>    &#125;<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;ChildComp&gt;asd&lt;/ChildComp&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;slot&gt;Fallback content&lt;/slot&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h3 id="è·¨å±‚ä¼ é€’æ•°æ®provide-inject"><a href="#è·¨å±‚ä¼ é€’æ•°æ®provide-inject" class="headerlink" title="è·¨å±‚ä¼ é€’æ•°æ®provide inject"></a>è·¨å±‚ä¼ é€’æ•°æ®<code>provide inject</code></h3><p>ä¸Šå±‚ç»„ä»¶é€šè¿‡provideå®šä¹‰æ•°æ®&#x2F;æ–¹æ³•ï¼Œä¸‹å±‚é€šè¿‡injectè·å–æ•°æ®&#x2F;æ–¹æ³•</p><h4 id="ç»„åˆå¼-13"><a href="#ç»„åˆå¼-13" class="headerlink" title="ç»„åˆå¼"></a>ç»„åˆå¼</h4><p>ç¬¬ä¸€å±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; provide, ref &#125; from &#x27;vue&#x27;;<br>import RoomMsgItem from &#x27;./room-msg-item.vue&#x27;<br><br>// ä¼ é€’æ™®é€šæ•°æ®<br>provide(&#x27;data-key&#x27;, &#x27;this is room data&#x27;)<br>// ä¼ é€’å“åº”å¼æ•°æ®<br>const count = ref(0)<br>provide(&#x27;count-key&#x27;, count)<br><br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;div&gt;<br>        é¡¶å±‚ç»„ä»¶<br>        &lt;br/&gt; ============ &lt;br/&gt;<br>        &lt;input type=&quot;button&quot; @click=&quot;() =&gt; count++&quot; :value=&quot;count&quot;/&gt;<br>        &lt;div&gt;<br>            &lt;RoomMsgItem/&gt;<br>        &lt;/div&gt;<br>        ============<br>    &lt;/div&gt;<br>    <br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒå±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import roomMsgComment from &#x27;./room-msg-comment.vue&#x27;;<br><br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;div&gt;<br>        ä¸­é—´å±‚ç»„ä»¶<br>        &lt;br/&gt; -------<br>        &lt;div&gt;<br>            &lt;roomMsgComment/&gt;<br>        &lt;/div&gt;<br>        -------<br>    &lt;/div&gt;<br>    <br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰å±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; inject &#125; from &#x27;vue&#x27;;<br><br>const roomData = inject(&#x27;data-key&#x27;)<br>const countData = inject(&#x27;count-key&#x27;)<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;div&gt;<br>        åº•å±‚ç»„ä»¶<br>    &lt;/div&gt;<br>    &lt;div&gt;<br>        æ¥è‡ªé¡¶å±‚ç»„ä»¶ä¸­çš„æ•°æ®ä¸º: &#123;&#123; roomData &#125;&#125;<br>    &lt;/div&gt;<br>    &lt;div&gt;<br>        æ¥è‡ªé¡¶å±‚ç»„ä»¶çš„å“åº”å¼æ•°æ®ä¸º: &#123;&#123; countData &#125;&#125;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="æ³¨å†Œå…¨å±€æŒ‡ä»¤"><a href="#æ³¨å†Œå…¨å±€æŒ‡ä»¤" class="headerlink" title="æ³¨å†Œå…¨å±€æŒ‡ä»¤"></a>æ³¨å†Œå…¨å±€æŒ‡ä»¤</h2><p>æ ‡ç­¾é‡Œä½¿ç”¨æ—¶<code>v-è‡ªå®šä¹‰æŒ‡ä»¤å=&#39;&#39;</code></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/directives/index.js</span><br><br><span class="hljs-keyword">import</span> &#123; useIntersectionObserver &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vueuse/core&#x27;</span><br><br><span class="hljs-comment">// è‡ªå®šä¹‰å…¨å±€æŒ‡ä»¤</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> layzPlugin = &#123;<br>    <span class="hljs-title function_">install</span>(<span class="hljs-params">app</span>) &#123;<br>        app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;img-lazy&#x27;</span>, &#123;<br>            <span class="hljs-comment">// el: æŒ‡ä»¤ç»‘å®šçš„å…ƒç´ </span><br>            <span class="hljs-comment">// binding: æŒ‡ä»¤åé¢çš„å€¼</span><br>            <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) &#123;<br><br>                <span class="hljs-comment">// ç›‘å¬å…ƒç´ æ˜¯å¦è¿›å…¥å±å¹•</span><br>                <span class="hljs-keyword">const</span> &#123;stop&#125; = <span class="hljs-title function_">useIntersectionObserver</span>(<br>                    el,<br>                    <span class="hljs-function">(<span class="hljs-params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;<br>                        <span class="hljs-keyword">if</span> (isIntersecting) &#123;<br>                            <span class="hljs-comment">// åŠ è½½å›¾ç‰‡</span><br>                            el.<span class="hljs-property">src</span> = binding.<span class="hljs-property">value</span><br>                            <span class="hljs-title function_">stop</span>()  <span class="hljs-comment">// å…³é—­ç›‘å¬</span><br>                        &#125;<br>                    &#125;,  <br>                )<br>            &#125;<br>        &#125;)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¼å…¥è‡ªå®šä¹‰æŒ‡ä»¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/main.js</span><br><br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; createPinia &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./styles/common.scss&#x27;</span><br><span class="hljs-comment">// è‡ªå®šä¹‰æ‡’åŠ è½½æŒ‡ä»¤</span><br><span class="hljs-keyword">import</span> &#123; layzPlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./directives&#x27;</span><br><br><span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>    .<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())<br>    .<span class="hljs-title function_">use</span>(router)<br>    .<span class="hljs-title function_">use</span>(layzPlugin)<br>    .<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="æ³¨å†Œå…¨å±€ç»„ä»¶"><a href="#æ³¨å†Œå…¨å±€ç»„ä»¶" class="headerlink" title="æ³¨å†Œå…¨å±€ç»„ä»¶"></a>æ³¨å†Œå…¨å±€ç»„ä»¶</h2><p>å’Œæ³¨å†Œå…¨å±€æŒ‡ä»¤ç±»ä¼¼ï¼Œå…ˆåˆ›å»ºæ’ä»¶ï¼Œå†æŠŠæ’ä»¶æ³¨å†Œåˆ°appä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// /src/components/index.js</span><br><br><span class="hljs-comment">// å°†ç»„ä»¶è¿›è¡Œå…¨å±€åŒ–æ³¨å†Œ</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ImageView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/ImageView/index.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Sku</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/components/XtxSku/index.vue&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> componentPlugin =&#123;<br>    <span class="hljs-title function_">install</span>(<span class="hljs-params">app</span>) &#123;<br>        app.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;XtxImageView&#x27;</span>, <span class="hljs-title class_">ImageView</span>)<br>        app.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;XtxSku&#x27;</span>, <span class="hljs-title class_">Sku</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/main.js</span><br><br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; createPinia &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;pinia&#x27;</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./styles/common.scss&#x27;</span><br><span class="hljs-comment">// è‡ªå®šä¹‰æ‡’åŠ è½½æŒ‡ä»¤</span><br><span class="hljs-keyword">import</span> &#123; layzPlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./directives&#x27;</span><br><span class="hljs-keyword">import</span> &#123; componentPlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/index&#x27;</span><br><br><span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>    .<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())<br>    .<span class="hljs-title function_">use</span>(router)<br>    .<span class="hljs-title function_">use</span>(layzPlugin)    <span class="hljs-comment">// å›¾ç‰‡æ‡’åŠ è½½</span><br>    .<span class="hljs-title function_">use</span>(componentPlugin)   <span class="hljs-comment">// å…¨å±€ç»„ä»¶</span><br>    .<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="é¡¹ç›®æ­å»º"><a href="#é¡¹ç›®æ­å»º" class="headerlink" title="é¡¹ç›®æ­å»º"></a>é¡¹ç›®æ­å»º</h2><p><code>create-vue</code>æ˜¯Vueå®˜æ–¹æ–°çš„è„šæ‰‹æ¶å·¥å…·ï¼Œåº•å±‚ä½¿ç”¨<code>vite</code></p><p><a href="https://cn.vitejs.dev/guide/">Viteæ–‡æ¡£</a></p><ol><li><p>ç¯å¢ƒè¦æ±‚ï¼šNode.jsç‰ˆæœ¬16.0åŠä»¥ä¸Š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">node -v<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºVueåº”ç”¨</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm init vue@latest<br>// ä¼šå®‰è£…å¹¶æ‰§è¡Œcreate-vue<br>// ä¹‹åé€‰æ‹©éœ€è¦çš„ä¾èµ–æ¥åˆå§‹åŒ–é¡¹ç›®<br></code></pre></td></tr></table></figure></li><li><p>ä¸»è¦æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹</p><p><img src="/img/qianduan_img/Vue3%E7%9B%AE%E5%BD%95.png"></p><ul><li>package.jsonï¼šç”¨äºæè¿°é¡¹ç›®æ‰€éœ€ä¾èµ–åŒ…ã€é¡¹ç›®çš„ä¿¡æ¯ã€è„šæœ¬å‘½ä»¤ç­‰çš„å…ƒæ•°æ®æ–‡ä»¶</li><li>vite.config.jsï¼šé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼ŒåŸºäºViteçš„é…ç½®</li><li>main.jsï¼šé¡¹ç›®å…¥å£æ–‡ä»¶</li><li>App.vueï¼šæ ¹ç»„ä»¶</li></ul></li><li><p>å¸¸è§çš„è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶å¤¹</p><ul><li>apisï¼šAPIæ¥å£æ–‡ä»¶å¤¹</li><li>composablesï¼šç»„åˆå‡½æ•°æ–‡ä»¶å¤¹ï¼Œæ”¾ä¸€äº›ä»ç»„ä»¶ä¸­å°è£…å‡ºæ¥çš„å‡½æ•°</li><li>directivesï¼šå…¨å±€æŒ‡ä»¤æ–‡ä»¶å¤¹</li><li>stylesï¼šå…¨å±€æ ·å¼æ–‡ä»¶å¤¹</li><li>utilsï¼šå·¥å…·å‡½æ•°æ–‡ä»¶å¤¹</li></ul></li></ol><h1 id="Element-Plus"><a href="#Element-Plus" class="headerlink" title="Element Plus"></a>Element Plus</h1><blockquote><p>åŸºäº Vue 3çš„Element UI</p></blockquote><p><a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html">Element Plueä¸­æ–‡æ–‡æ¡£</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ol><li><p>å®‰è£…ä¾èµ–</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm install element-plus --save<br></code></pre></td></tr></table></figure></li><li><p>æŒ‰éœ€å¯¼å…¥(åªåŠ è½½ä½¿ç”¨åˆ°çš„ç»„ä»¶)éœ€è¦é¢å¤–å®‰è£…æ’ä»¶</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm install -D unplugin-vue-components unplugin-auto-import<br></code></pre></td></tr></table></figure></li><li><p><code>vite.config.js</code>é…ç½®å¯¼å…¥æ’ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// vite.config.ts</span><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-auto-import/vite&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/vite&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ElementPlusResolver</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;unplugin-vue-components/resolvers&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-title class_">AutoImport</span>(&#123;<br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>()],<br>    &#125;),<br>    <span class="hljs-title class_">Components</span>(&#123;<br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>()],<br>    &#125;),<br>  ],<br>&#125;)<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ç»„ä»¶æ˜¯å¦èƒ½ç”¨</p></li></ol><h2 id="å®šåˆ¶ElementPlusä¸»é¢˜æ ·å¼"><a href="#å®šåˆ¶ElementPlusä¸»é¢˜æ ·å¼" class="headerlink" title="å®šåˆ¶ElementPlusä¸»é¢˜æ ·å¼"></a>å®šåˆ¶ElementPlusä¸»é¢˜æ ·å¼</h2><blockquote><p>ç»„ä»¶åº“é‡Œçš„æ ·å¼æ²¡æœ‰åˆé€‚çš„ï¼Œéœ€è¦è‡ªå·±å®šåˆ¶</p></blockquote><p><strong>åŸºäºsasså®šåˆ¶æ ·å¼</strong></p><ol><li><p>å®‰è£…sass(cssæ‰©å±•è¯­è¨€)</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm i sass -D<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>src/styles/element/index.scss</code>é‡Œæ·»åŠ å‡†å¤‡å¥½çš„å®šåˆ¶åŒ–æ ·å¼æ–‡ä»¶</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// ç¤ºä¾‹</span><br><span class="hljs-keyword">@forward</span> <span class="hljs-string">&#x27;element-plus/theme-chalk/src/common/var.scss&#x27;</span> with (<br>  <span class="hljs-variable">$colors</span>: (<br>    <span class="hljs-string">&#x27;primary&#x27;</span>: (<br>      // ä¸»è‰²<br>      <span class="hljs-string">&#x27;base&#x27;</span>: <span class="hljs-number">#27ba9b</span>,<br>    ),<br>    <span class="hljs-string">&#x27;success&#x27;</span>: (<br>      // æˆåŠŸè‰²<br>      <span class="hljs-string">&#x27;base&#x27;</span>: <span class="hljs-number">#1dc779</span>,<br>    ),<br>    <span class="hljs-string">&#x27;warning&#x27;</span>: (<br>      // è­¦å‘Šè‰²<br>      <span class="hljs-string">&#x27;base&#x27;</span>: <span class="hljs-number">#ffb302</span>,<br>    ),<br>    <span class="hljs-string">&#x27;danger&#x27;</span>: (<br>      // å±é™©è‰²<br>      <span class="hljs-string">&#x27;base&#x27;</span>: <span class="hljs-number">#e26237</span>,<br>    ),<br>    <span class="hljs-string">&#x27;error&#x27;</span>: (<br>      // é”™è¯¯è‰²<br>      <span class="hljs-string">&#x27;base&#x27;</span>: <span class="hljs-number">#cf4444</span>,<br>    ),<br>  )<br>)<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>vite.config.js</code>é…ç½®æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è®¾ç½®elementPlusé‡‡ç”¨sassæ ·å¼é…è‰²ç³»ç»Ÿ</span><br><span class="hljs-title class_">Components</span>(&#123;<br>      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>(&#123; <span class="hljs-attr">importStyle</span>: <span class="hljs-string">&#x27;sass&#x27;</span> &#125;)],<br>    &#125;), <br><br><span class="hljs-comment">// åœ¨pluginsåŒçº§ä¸‹è®¾ç½®æ ·å¼æ–‡ä»¶ä½ç½®</span><br><span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">preprocessorOptions</span>: &#123;<br>      <span class="hljs-attr">scss</span>: &#123;<br>        <span class="hljs-comment">// è‡ªåŠ¨å¯¼å…¥å®šåˆ¶åŒ–æ ·å¼æ–‡ä»¶è¿›è¡Œæ ·å¼è¦†ç›–</span><br>        <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`</span><br><span class="hljs-string">          @use &quot;@/styles/element/index.scss&quot; as *;</span><br><span class="hljs-string">        `</span>,<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></li></ol><h1 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h1><h2 id="å®‰è£…-amp-åŸºç¡€é…ç½®"><a href="#å®‰è£…-amp-åŸºç¡€é…ç½®" class="headerlink" title="å®‰è£…&amp;åŸºç¡€é…ç½®"></a>å®‰è£…&amp;åŸºç¡€é…ç½®</h2><ol><li><p>å®‰è£…ä¾èµ–</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm install axios<br></code></pre></td></tr></table></figure></li><li><p>åŸºç¡€é…ç½®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/utils/http.js</span><br><br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span><br><br><span class="hljs-comment">// åˆ›å»ºaxioså®ä¾‹</span><br><span class="hljs-keyword">const</span> httpInstance = axios.<span class="hljs-title function_">create</span>(&#123;<br>    <span class="hljs-comment">// åŸºåœ°å€</span><br>    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;http://pcapi-xiaotuxian-front-devtest.itheima.net&#x27;</span>,<br>    <span class="hljs-comment">// è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span><br>&#125;)<br><br><span class="hljs-comment">// axiosè¯·æ±‚æ‹¦æˆªå™¨</span><br>httpInstance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> config<br>&#125;, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(e))<br><br><span class="hljs-comment">// axioså“åº”å¼æ‹¦æˆªå™¨</span><br>httpInstance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-property">data</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(e)<br>&#125;)<br><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> httpInstance<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºapiè¯·æ±‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// src/apis/testAPI.js</span><br><br><span class="hljs-keyword">import</span> httpInstance <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/http&quot;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCategory</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">httpInstance</span>(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;home/category/head&#x27;</span><br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; getCategory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/apis/testAPI&#x27;</span><br><span class="hljs-title function_">getCategory</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>&#125;)<br></code></pre></td></tr></table></figure></li></ol><h1 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h1><h2 id="ä¸€çº§è·¯ç”±"><a href="#ä¸€çº§è·¯ç”±" class="headerlink" title="ä¸€çº§è·¯ç”±"></a>ä¸€çº§è·¯ç”±</h2><p>åœ¨<code>src/router/index.js</code>æ–‡ä»¶é‡Œæ·»åŠ ä¿®æ”¹è·¯ç”±ä¿¡æ¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-comment">// å¯¼å…¥è‡ªå®šä¹‰çš„ç»„ä»¶</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Login/index.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Layout/index.vue&#x27;</span><br><br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>),<br>  <span class="hljs-comment">// é…ç½®è·¯ç”±</span><br>  <span class="hljs-attr">routes</span>: [<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Login</span><br>    &#125;<br>  ]<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br><br></code></pre></td></tr></table></figure><p>æ ¹ç»„ä»¶<code>App.vue</code>é‡Œè®°å¾—æ·»åŠ ä¸€çº§<strong>è·¯ç”±å‡ºå£</strong>(ä¸€çº§è·¯ç”±çš„ç»„ä»¶ä¼šè¢«æ¸²æŸ“åˆ°è¿™ä¸ªä½ç½®)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;!-- ä¸€çº§è·¯ç”±å‡ºå£ç»„ä»¶ --&gt;<br>  &lt;RouterView /&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="äºŒçº§è·¯ç”±"><a href="#äºŒçº§è·¯ç”±" class="headerlink" title="äºŒçº§è·¯ç”±"></a>äºŒçº§è·¯ç”±</h2><p>é€šè¿‡<code>children</code>æ¥é…ç½®å­è·¯ç”±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Login/index.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Layout/index.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Home/index.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Category</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/Category/index.vue&#x27;</span><br><br><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>),<br>  <span class="hljs-attr">routes</span>: [<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,<br>      <span class="hljs-attr">children</span>: [<br>        <span class="hljs-comment">// pathä¸ºç©ºåˆ™ä¸ºé»˜è®¤è·¯ç”±</span><br>        &#123;<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>          <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span><br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;category&#x27;</span>,<br>          <span class="hljs-attr">component</span>: <span class="hljs-title class_">Category</span><br>        &#125;,<br>      ]<br>    &#125;,<br><br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Login</span><br>    &#125;<br>  ]<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br><br></code></pre></td></tr></table></figure><p>åœ¨çˆ¶ç»„ä»¶é‡Œæ·»åŠ è·¯ç”±å‡ºå£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        é¦–é¡µ<br>        &lt;RouterView/&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="è·¯ç”±ç¼“å­˜é—®é¢˜"><a href="#è·¯ç”±ç¼“å­˜é—®é¢˜" class="headerlink" title="è·¯ç”±ç¼“å­˜é—®é¢˜"></a>è·¯ç”±ç¼“å­˜é—®é¢˜</h2><p>ä¾‹å¦‚è·¯ç”±ä¸º<code>/users/a</code>å¯¼èˆªåˆ°<code>/users/b</code>æ—¶ï¼Œç»„ä»¶å°†è¢«é‡å¤ä½¿ç”¨ã€‚ä¸¤ä¸ªè·¯ç”±ä¸­ç›¸åŒçš„ç»„ä»¶ä¼šè¢«å¤ç”¨ï¼Œæ›´åŠ é«˜æ•ˆã€‚</p><p>ä½†æ˜¯å¤ç”¨çš„ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸ä¼šå†è¢«è°ƒç”¨ï¼Œå¯¼è‡´æ•°æ®æ— æ³•æ›´æ–°</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><ol><li><p>ä¸è®©ç»„ä»¶å¤ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- ç»™RouterViewæ·»åŠ :keyæ¥é¿å…å¤ç”¨ --&gt;<br>&lt;RouterView :key=&quot;$route.fullPath&quot;/&gt;<br></code></pre></td></tr></table></figure></li><li><p>ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œå˜åŒ–åæ›´æ–°æ•°æ®</p><p>åœ¨ç»„ä»¶é‡Œä½¿ç”¨<code>router</code>çš„<code>onBeforeRouteUpdate()</code>å‡½æ•°æ¥ç›‘å¬è·¯ç”±å˜åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; getCategoryAPI &#125; from &#x27;@/apis/category&#x27;;<br>import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;<br>import &#123; onBeforeRouteUpdate, useRoute &#125; from &#x27;vue-router&#x27;;<br>import &#123; getBannerAPI &#125; from &#x27;@/apis/home&#x27;;<br>import GoodsItem from &#x27;../Home/components/GoodsItem.vue&#x27;;<br><br>// è·å–å•†å“åˆ†ç±»æ•°æ®<br>const router = useRoute()<br>const categoryData = ref(&#123;&#125;)<br>async function getCategory(id = router.params.id) &#123;<br>    const res = await getCategoryAPI(id)<br>    categoryData.value = res.result<br>&#125;<br>// è·å–è½®æ’­å›¾æ•°æ®<br>const bannerList = ref([])<br>async function getBanner() &#123;<br>  const res = await getBannerAPI(&#123;distributionSite: &#x27;2&#x27;&#125;)<br>  bannerList.value = res.result<br>&#125;<br><br>onMounted(() =&gt; &#123;<br>  getCategory()<br>  getBanner()<br>&#125;)<br><br>// ç›‘å¬è·¯ç”±å˜åŒ–æ¥æ›´æ–°æ•°æ®<br>onBeforeRouteUpdate((to) =&gt; &#123;<br>  getCategory(to.params.id)<br>&#125;)<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure></li></ol><h1 id="VueUse"><a href="#VueUse" class="headerlink" title="VueUse"></a>VueUse</h1><blockquote><p>åŸºäºç»„åˆå¼APIçš„å·¥å…·é›†ï¼Œå¯ä»¥ç”¨äºå¦‚è·Ÿè¸ªrefæ›´æ”¹ï¼Œæ£€æµ‹å…ƒç´ å¯è§æ€§ï¼Œç®€åŒ–å¸¸è§ Vue æ¨¡å¼ï¼Œé”®ç›˜&#x2F;é¼ æ ‡è¾“å…¥ç­‰</p></blockquote><p><a href="http://www.vueusejs.com/">ä¸­æ–‡æ–‡æ¡£</a></p><p><a href="https://vueuse.org/">è‹±æ–‡æ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FreeMarker</title>
    <link href="/2023/05/03/%E6%A1%86%E6%9E%B6/FreeMarker/"/>
    <url>/2023/05/03/%E6%A1%86%E6%9E%B6/FreeMarker/</url>
    
    <content type="html"><![CDATA[<h1 id="FreeMarker"><a href="#FreeMarker" class="headerlink" title="FreeMarker"></a>FreeMarker</h1><blockquote><p>æ¨¡æ¿å¼•æ“ï¼Œè§†å›¾çš„æ¨¡æ¿æ˜¯å›ºå®šçš„ï¼Œå°†æ¨¡æ¿ä¸­çš„æ•°æ®ä¿®æ”¹åè¿”å›</p><p>æ¨¡æ¿ + æ•°æ®æ¨¡å‹ &#x3D; è¾“å‡º</p></blockquote><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><h3 id="SpringBootæ•´åˆFreeMarker"><a href="#SpringBootæ•´åˆFreeMarker" class="headerlink" title="SpringBootæ•´åˆFreeMarker"></a><strong>SpringBootæ•´åˆFreeMarker</strong></h3><ol><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">freemarker:</span><br>    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span><br>    <span class="hljs-comment"># æŒ‡å®šæ¨¡æ¿æ–‡ä»¶åç¼€ freemarker template langurage</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.ftl</span><br>    <span class="hljs-comment"># æŒ‡å®šæ¨¡æ¿æ‰€åœ¨è·¯å¾„</span><br>    <span class="hljs-attr">template-loader-path:</span> <span class="hljs-string">classpath:/templates</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">allow-request-override:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">check-template-location:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">content-type:</span> <span class="hljs-string">text/html</span><br>    <span class="hljs-attr">expose-request-attributes:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">expose-session-attributes:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">(Model model)</span> &#123;<br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;myMap&quot;</span>, map);<br>        model.addAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;World&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>resources/templates</code>ä¸‹ç¼–å†™æ¨¡æ¿<code>hello.ftl</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Hello FreeMarker&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;h1&gt;Hello $&#123;name&#125;!&lt;/h1&gt;<br>    &lt;p&gt;Value for key1: $&#123;myMap[&quot;key1&quot;]&#125;&lt;/p&gt;<br>    &lt;p&gt;Value for key2: $&#123;myMap[&quot;key2&quot;]&#125;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure></li></ol><blockquote><p>è¿è¡Œï¼Œè®¿é—®<code>localhost:8080/hello</code></p></blockquote><h3 id="å•ç‹¬ä½¿ç”¨"><a href="#å•ç‹¬ä½¿ç”¨" class="headerlink" title="å•ç‹¬ä½¿ç”¨"></a>å•ç‹¬ä½¿ç”¨</h3><ol><li><p>å¯¼åŒ…ã€é…ç½®</p></li><li><p>ç¼–å†™æ¨¡æ¿<code>welcome.ftl</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Welcome&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome $&#123;name&#125;!&lt;/h1&gt;<br>&lt;p&gt;Today is $&#123;date?string(&quot;yyyy-MM-dd&quot;)&#125;&lt;/p&gt;<br>&lt;ul&gt;<br>    &lt;#list items as item&gt;<br>        &lt;li&gt;$&#123;item&#125;&lt;/li&gt;<br>    &lt;/#list&gt;<br>&lt;/ul&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FmTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">cfg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Configuration.VERSION_2_3_31);<br>        <span class="hljs-comment">// è®¾ç½®æ¨¡æ¿æ‰€åœ¨è·¯å¾„å’Œç¼–ç </span><br>        cfg.setClassLoaderForTemplateLoading(getClass().getClassLoader(), <span class="hljs-string">&quot;/templates/&quot;</span>);<br>        cfg.setDefaultEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br><br>        Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        data.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;John&quot;</span>);<br>        data.put(<span class="hljs-string">&quot;date&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        data.put(<span class="hljs-string">&quot;items&quot;</span>, Arrays.asList(<span class="hljs-string">&quot;Apple&quot;</span>, <span class="hljs-string">&quot;Banana&quot;</span>, <span class="hljs-string">&quot;Orange&quot;</span>));<br><br>        <span class="hljs-comment">// è·å–æ¨¡æ¿</span><br>        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> cfg.getTemplate(<span class="hljs-string">&quot;welcome.ftl&quot;</span>);<br>        <span class="hljs-type">Writer</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>();<br>        <span class="hljs-comment">// ç»™æ•°æ®æ¸²æŸ“æ¨¡æ¿ï¼Œè¾“å‡ºåˆ°writerä¸­</span><br>        template.process(data, out);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">rendered</span> <span class="hljs-operator">=</span> out.toString();<br>        System.out.println(rendered);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><h3 id="æ’å€¼-x2F-è¡¨è¾¾å¼"><a href="#æ’å€¼-x2F-è¡¨è¾¾å¼" class="headerlink" title="æ’å€¼&#x2F;è¡¨è¾¾å¼"></a>æ’å€¼&#x2F;è¡¨è¾¾å¼</h3><p>ä½¿ç”¨<code>$&#123;..&#125;</code>æ¥å¼•å…¥å˜é‡ï¼Œå¦‚ï¼š<code>$&#123;name&#125;</code></p><h4 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h4><p><code>\</code>éœ€è¦è½¬ä¹‰ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²å‰é¢åŠ r</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ftl">$&#123;&quot;hello world&quot;&#125;<br>$&#123;&quot;æˆ‘çš„æ–‡ä»¶ä¿å­˜åœ¨C:\\ç›˜&quot;&#125;<br>$&#123;r&quot;æˆ‘çš„æ–‡ä»¶ä¿å­˜åœ¨C:\ç›˜&quot;&#125;<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²æ‹¼æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;&quot;hello $&#123;name&#125;&quot;&#125;&lt;/div&gt;<br>&lt;div&gt;$&#123;&quot;hello &quot;+ name&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²æˆªå–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;name[0]&#125;$&#123;name[1]&#125;&lt;/div&gt;<br>&lt;div&gt;$&#123;name[0..2]&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure><h4 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h4><ul><li><p>ä»¥é’±çš„å½¢å¼å±•ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#assign num=99&gt;<br>&lt;div&gt;$&#123;num?string.currency&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p>ç™¾åˆ†æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;num?string.percent&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="å¸ƒå°”"><a href="#å¸ƒå°”" class="headerlink" title="å¸ƒå°”"></a>å¸ƒå°”</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#assign flag=true&gt;<br>&lt;div&gt;$&#123;flag?string(&quot;a&quot;,&quot;b&quot;)&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure><h4 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h4><ul><li><p>ç›´æ¥å®šä¹‰ç„¶åè¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#list [&quot;æ˜ŸæœŸä¸€&quot;, &quot;æ˜ŸæœŸäºŒ&quot;, &quot;æ˜ŸæœŸä¸‰&quot;, &quot;æ˜ŸæœŸå››&quot;, &quot;æ˜ŸæœŸäº”&quot;, &quot;æ˜ŸæœŸå…­&quot;, &quot;æ˜ŸæœŸå¤©&quot;] as x&gt;<br>    $&#123;x&#125;&lt;br/&gt;<br>&lt;/#list&gt;<br></code></pre></td></tr></table></figure></li><li><p>é›†åˆçš„å…ƒç´ å¯ä»¥æ˜¯è¡¨è¾¾å¼ã€map</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#list [2+2,&quot;javaboy&quot;] as x&gt;<br>    $&#123;x&#125; &lt;br/&gt;<br>&lt;/#list&gt;<br><br>&lt;#list &#123;&quot;a&quot;:&quot;a&quot;,&quot;b&quot;:&quot;b&quot;&#125;?keys as x&gt;<br>$&#123;x&#125;<br>&lt;/#list&gt;<br>&lt;#list &#123;&quot;a&quot;:&quot;a&quot;,&quot;b&quot;:&quot;b&quot;&#125;?values as x&gt;<br>$&#123;x&#125;<br>&lt;/#list&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><p><strong>ç®—æ•°è¿ç®—</strong></p><ol><li><p>&#x3D; æˆ–è€… &#x3D;&#x3D; åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚</p></li><li><p>!&#x3D; åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰ã€‚</p></li><li><p><code>&gt;</code> æˆ–è€… gt åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼ã€‚</p></li><li><p><code>&gt;=</code> æˆ–è€… gte åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºç­‰äºå³è¾¹å€¼ã€‚</p></li><li><p><code>&lt;</code> æˆ–è€… lt åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºå³è¾¹å€¼ã€‚</p></li><li><p><code>&lt;=</code> æˆ–è€… lte åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;<br>    &lt;#assign age=99&gt;<br>    &lt;#if age=99&gt;age=99&lt;/#if&gt;<br>    &lt;#if age gt 99&gt;age gt 99&lt;/#if&gt;<br>    &lt;#if age gte 99&gt;age gte 99&lt;/#if&gt;<br>    &lt;#if age lt 99&gt;age lt 99&lt;/#if&gt;<br>    &lt;#if age lte 99&gt;age lte 99&lt;/#if&gt;<br>    &lt;#if age!=99&gt;age!=99&lt;/#if&gt;<br>    &lt;#if age==99&gt;age==99&lt;/#if&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ol><p><strong>é€»è¾‘è¿ç®—</strong></p><ol><li><p>é€»è¾‘ä¸ <code>&amp;&amp;</code></p></li><li><p>é€»è¾‘æˆ– <code>||</code></p></li><li><p>é€»è¾‘é <code>!</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;<br>&lt;#assign age=99&gt;<br>&lt;#if age=99 &amp;&amp; 1==1&gt; age=99 &amp;&amp; 1==1 &lt;/#if&gt;<br>&lt;#if age=99 || 1==0&gt; age=99 || 1==0 &lt;/#if&gt;<br>&lt;#if !(age gt 99)&gt; !(age gt 99) &lt;/#if&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h4><ul><li><p><code>!</code>æŒ‡å®šç©ºå€¼çš„é»˜è®¤å€¼ï¼Œåé¢ä¸å†™ä¸œè¥¿åˆ™ä¸ºç©ºå­—ç¬¦ä¸²</p></li><li><p><code>??</code>åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦å­˜åœ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt; $&#123;aaa!&quot;bbb&quot;&#125; &lt;/div&gt;<br>&lt;div&gt; $&#123;aaa!&#125; &lt;/div&gt;<br>&lt;div&gt;<br>&lt;#if aaa??&gt; bbb &lt;/#if&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ul><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>é€šè¿‡Modelä¼ å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">(Model model)</span> &#123;<br>        List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>            u.setUsername(<span class="hljs-string">&quot;name&quot;</span> + i);<br>            u.setAddress(<span class="hljs-string">&quot;address&quot;</span> + i);<br>            users.add(u);<br>        &#125;<br>        Map&lt;String, Object&gt; info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        info.put(<span class="hljs-string">&quot;site&quot;</span>, <span class="hljs-string">&quot;site&quot;</span>);<br>        info.put(<span class="hljs-string">&quot;wechat&quot;</span>, <span class="hljs-string">&quot;wechat&quot;</span>);<br>        info.put(<span class="hljs-string">&quot;github&quot;</span>, <span class="hljs-string">&quot;github&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);<br>        model.addAttribute(<span class="hljs-string">&quot;info&quot;</span>, info);<br>        model.addAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;myName&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Hello FreeMarker&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;#-- æ™®é€šå˜é‡ --&gt;<br>    &lt;div&gt;$&#123;name&#125;&lt;/div&gt;<br><br>    &lt;#-- é›†åˆéå† --&gt;<br>    &lt;div&gt;<br>        &lt;table border=&quot;1&quot;&gt;<br>            &lt;#list users as u&gt;<br>                &lt;tr&gt;<br>                    &lt;#-- è·å–ä¸‹æ ‡ --&gt;<br>                    &lt;td&gt;$&#123;u_index&#125;&lt;/td&gt;<br>                    &lt;td&gt;$&#123;u.username&#125;&lt;/td&gt;<br>                    &lt;td&gt;$&#123;u.address&#125;&lt;/td&gt;<br>                &lt;/tr&gt;<br>            &lt;/#list&gt;<br>        &lt;/table&gt;<br>    &lt;/div&gt;<br>    &lt;#-- é›†åˆéå†ï¼ŒæŒ‡å®šèŒƒå›´ --&gt;<br>    &lt;div&gt;<br>        &lt;table border=&quot;1&quot;&gt;<br>            &lt;#list users[3..5] as u&gt;<br>                &lt;tr&gt;<br>                    &lt;td&gt;$&#123;u.username&#125;&lt;/td&gt;<br>                    &lt;td&gt;$&#123;u.address&#125;&lt;/td&gt;<br>                &lt;/tr&gt;<br>            &lt;/#list&gt;<br>        &lt;/table&gt;<br>    &lt;/div&gt;<br>    &lt;#-- æŒ‡å®šè¾“å‡ºé›†åˆä¸­çš„å…ƒç´  --&gt;<br>    &lt;div&gt;<br>        $&#123;users[3].username&#125;<br>    &lt;/div&gt;<br><br>    &lt;#-- Mapç›´æ¥è·å–å€¼ --&gt;<br>    &lt;div&gt;$&#123;info.wechat&#125;&lt;/div&gt;<br>    &lt;div&gt;$&#123;info[&#x27;site&#x27;]&#125;&lt;/div&gt;<br>    &lt;#-- Mapè·å–æ‰€æœ‰key --&gt;<br>    &lt;div&gt;<br>        &lt;#list info?keys as key&gt;<br>            &lt;div&gt;$&#123;key&#125; -- $&#123;info[key]&#125;&lt;/div&gt;<br>        &lt;/#list&gt;<br>    &lt;/div&gt;<br>    &lt;#-- Mapè·å–æ‰€æœ‰value --&gt;<br>    &lt;div&gt;<br>        &lt;#list info?values as value&gt;<br>            &lt;div&gt;$&#123;value&#125;&lt;/div&gt;<br>        &lt;/#list&gt;<br>    &lt;/div&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h3 id="å†…ç½®å‡½æ•°å’ŒæŒ‡ä»¤"><a href="#å†…ç½®å‡½æ•°å’ŒæŒ‡ä»¤" class="headerlink" title="å†…ç½®å‡½æ•°å’ŒæŒ‡ä»¤"></a>å†…ç½®å‡½æ•°å’ŒæŒ‡ä»¤</h3><h4 id="å¸¸è§å†…ç½®å‡½æ•°"><a href="#å¸¸è§å†…ç½®å‡½æ•°" class="headerlink" title="å¸¸è§å†…ç½®å‡½æ•°"></a>å¸¸è§å†…ç½®å‡½æ•°</h4><ul><li><p><strong>string</strong>å‡½æ•°ï¼šå°†ä¸€ä¸ªéå­—ç¬¦ä¸²å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p></li><li><p><strong>number</strong>å‡½æ•°ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å…¶ä»–ç±»å‹çš„å€¼è½¬æ¢ä¸ºæ•°å­—</p></li><li><p><strong>size</strong>å‡½æ•°ï¼šè¿”å›ä¸€ä¸ªåºåˆ—ï¼ˆå¦‚åˆ—è¡¨ã€æ•°ç»„ã€å­—ç¬¦ä¸²ç­‰ï¼‰çš„å¤§å°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;users?size&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>default</strong>å‡½æ•°ï¼šè¿”å›ç¬¬ä¸€ä¸ªéç©ºå€¼</p></li><li><p><strong>length</strong>å‡½æ•°ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦</p></li><li><p><strong>upper_case</strong>å‡½æ•°ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;&quot;hello&quot;?upper_case&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>lower_case</strong>å‡½æ•°ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;&quot;HELLO&quot;?lower_case&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>cap_first</strong>å‡½æ•°ï¼šé¦–å­—æ¯å¤§å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;&quot;hello&quot;?cap_first&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>trim</strong>ï¼šå»æ‰å‰åç©ºæ ¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;&quot; hello &quot;?trim&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ—¥æœŸè½¬æ¢</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;$&#123;birthday?string(&quot;yyyy-MM-dd&quot;)&#125;&lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="å¸¸è§å†…ç½®æŒ‡ä»¤"><a href="#å¸¸è§å†…ç½®æŒ‡ä»¤" class="headerlink" title="å¸¸è§å†…ç½®æŒ‡ä»¤"></a>å¸¸è§å†…ç½®æŒ‡ä»¤</h4><ul><li><p>#<strong>if</strong>æŒ‡ä»¤ï¼šç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œæ ¹æ®æ¡ä»¶åˆ¤æ–­ç»“æœæ‰§è¡Œç›¸åº”çš„æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;div&gt;<br>    &lt;#assign age=23&gt;<br>    &lt;#if (age&gt;60)&gt;è€å¹´äºº<br>    &lt;#elseif (age&gt;40)&gt;ä¸­å¹´äºº<br>    &lt;#elseif (age&gt;20)&gt;é’å¹´äºº<br>    &lt;#else&gt; å°‘å¹´äºº<br>    &lt;/#if&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure></li><li><p>#<strong>list</strong>æŒ‡ä»¤ï¼šç”¨äºéå†é›†åˆï¼ˆå¦‚æ•°ç»„ã€åˆ—è¡¨ï¼‰å¹¶å¯¹å…¶ä¸­æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ“ä½œ</p></li><li><p>#<strong>assign</strong>æŒ‡ä»¤ï¼šç”¨äºç»™å˜é‡èµ‹å€¼</p></li><li><p>#<strong>macro</strong>æŒ‡ä»¤ï¼šç”¨äºå®šä¹‰å®ï¼ˆç±»ä¼¼äºå‡½æ•°ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#macro book bs&gt;<br>    &lt;table border=&quot;1&quot;&gt;<br>        &lt;#list bs as b&gt;<br>            &lt;tr&gt;<br>                &lt;td&gt;$&#123;b&#125;&lt;/td&gt;<br>            &lt;/tr&gt;<br>        &lt;/#list&gt;<br>    &lt;/table&gt;<br>&lt;/#macro&gt;<br>&lt;@book [&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]/&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<code>&lt;#nested&gt;</code>ä½œä¸ºå ä½ç¬¦ï¼Œè°ƒç”¨å®çš„æ—¶å€™æ ‡ç­¾é‡Œçš„å†…å®¹ä¼šå¡«å……åˆ°å ä½ç¬¦çš„ä½ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#macro book bs&gt;<br>    &lt;table border=&quot;1&quot;&gt;<br>        &lt;#list bs as b&gt;<br>            &lt;tr&gt;<br>                &lt;td&gt;$&#123;b&#125;&lt;/td&gt;<br>            &lt;/tr&gt;<br>        &lt;/#list&gt;<br>    &lt;/table&gt;<br>    &lt;#nested&gt;<br>&lt;/#macro&gt;<br>&lt;@book [&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]&gt;<br>    &lt;h1&gt;hello javaboy!&lt;/h1&gt;<br>&lt;/@book&gt;<br></code></pre></td></tr></table></figure></li><li><p>#<strong>include</strong>æŒ‡ä»¤ï¼šç”¨äºåœ¨æ¨¡æ¿ä¸­å¼•å…¥å…¶ä»–æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#include &quot;./about.ftl&quot;&gt;<br></code></pre></td></tr></table></figure></li><li><p>#<strong>import</strong>æŒ‡ä»¤ï¼šå¯¼å…¥å¤–éƒ¨çš„æ¨¡æ¿</p><p>about.ftl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#macro book bs&gt;<br>    &lt;table border=&quot;1&quot;&gt;<br>        &lt;#list bs as b&gt;<br>            &lt;tr&gt;<br>                &lt;td&gt;$&#123;b&#125;&lt;/td&gt;<br>            &lt;/tr&gt;<br>        &lt;/#list&gt;<br>    &lt;/table&gt;<br>    &lt;#nested&gt;<br>&lt;/#macro&gt;<br></code></pre></td></tr></table></figure><p>hello.ftl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;#import &quot;./about.ftl&quot; as about&gt;<br><br>&lt;@about.book [&quot;ä¸‰å›½æ¼”ä¹‰&quot;,&quot;æ°´æµ’ä¼ &quot;]&gt;<br>&lt;h1&gt;hello javaboy!&lt;/h1&gt;<br>&lt;/@about.book&gt;<br></code></pre></td></tr></table></figure></li><li><p>#<strong>noparse</strong>æŒ‡ä»¤ï¼šæ¡†èµ·æ¥çš„FreeMarkerè¯­æ³•ä¸ä¼šè¢«æ¸²æŸ“</p></li></ul><h4 id="å¸¸è§å†…ç½®å˜é‡"><a href="#å¸¸è§å†…ç½®å˜é‡" class="headerlink" title="å¸¸è§å†…ç½®å˜é‡"></a>å¸¸è§å†…ç½®å˜é‡</h4><ul><li>.nowï¼šè¿”å›å½“å‰æ—¶é—´</li><li>.sizeï¼šè¿”å›ä¸€ä¸ªåºåˆ—ï¼ˆå¦‚åˆ—è¡¨ã€æ•°ç»„ã€å­—ç¬¦ä¸²ç­‰ï¼‰çš„å¤§å°</li><li>.lengthï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦</li></ul><h2 id="SpringBootæ•´åˆFreeMarker-1"><a href="#SpringBootæ•´åˆFreeMarker-1" class="headerlink" title="SpringBootæ•´åˆFreeMarker"></a>SpringBootæ•´åˆFreeMarker</h2><h3 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h3><p>é¦–å…ˆå¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration</code>ä¸ºFreeMarkerçš„è‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfiguration</span><br><span class="hljs-meta">@ConditionalOnClass(&#123;Configuration.class, FreeMarkerConfigurationFactory.class&#125;)</span><br><span class="hljs-meta">@EnableConfigurationProperties(&#123;FreeMarkerProperties.class&#125;)</span><br><span class="hljs-meta">@Import(&#123;FreeMarkerServletWebConfiguration.class, FreeMarkerReactiveWebConfiguration.class, FreeMarkerNonWebConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeMarkerAutoConfiguration</span> &#123;<br>    ...<br></code></pre></td></tr></table></figure><ul><li><p><code>@ConditionalOnClass(&#123;Configuration.class, FreeMarkerConfigurationFactory.class&#125;)</code>ï¼š</p><p>å½“å¯¼å…¥FreeMarkeråï¼Œå°±ä¼šå­˜åœ¨<code>Configuration</code>å’Œ<code>FreeMarkerConfigurationFactory</code>è¿™ä¸¤ä¸ªç±»ï¼Œè‡ªåŠ¨é…ç½®ç±»ä¹Ÿå°±ç”Ÿæ•ˆäº†</p></li><li><p><code>@Import(&#123;FreeMarkerServletWebConfiguration.class, </code>ï¼š</p><p>å‰©ä¸‹çš„é…ç½®åœ¨ç±»<code>FreeMarkerServletWebConfiguration</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">    proxyBeanMethods = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnWebApplication(</span><br><span class="hljs-meta">    type = Type.SERVLET</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123;Servlet.class, FreeMarkerConfigurer.class&#125;)</span><br><span class="hljs-meta">@AutoConfigureAfter(&#123;WebMvcAutoConfiguration.class&#125;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeMarkerServletWebConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractFreeMarkerConfiguration</span> &#123;<br>    ...<br></code></pre></td></tr></table></figure><ul><li><p><code>@ConditionalOnWebApplication(type = Type.SERVLET)</code>ï¼šé…ç½®åœ¨webç¯å¢ƒä¸‹ç”Ÿæ•ˆ</p></li><li><p><code>@AutoConfigureAfter(&#123;WebMvcAutoConfiguration.class&#125;)</code>ï¼šè‡ªåŠ¨åŒ–é…ç½®åœ¨WebMvcAutoConfigurationä¹‹åå®Œæˆ</p></li><li><p>è¿™ä¸ªé…ç½®ç±»ä¸»è¦æä¾›äº†<code>Configuration</code>å’Œ<code>freeMarkerViewResolver</code>ã€‚<code>Configuration</code>æœ‰ä¸€äº›åŸºæœ¬é…ç½®ï¼Œå¦‚ç¼–ç ã€æ¨¡æ¿æ‰€åœ¨ä½ç½®ç­‰ï¼›<code>freeMarkerViewResolver</code>æ˜¯è§†å›¾è§£æå™¨ï¼Œé…ç½®æœ‰åç¼€ç­‰å±æ€§</p></li><li><p>è¿™ä¸ªé…ç½®ç±»çš„æ„é€ æ–¹æ³•æ³¨å…¥äº†<code>FreeMarkerProperties</code>ï¼Œé‡Œé¢æœ‰ä¸€äº›é»˜è®¤çš„é…ç½®ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeMarkerProperties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTemplateViewResolverProperties</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_TEMPLATE_LOADER_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SUFFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.ftlh&quot;</span>;<br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; settings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>    <span class="hljs-keyword">private</span> String[] templateLoaderPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;classpath:/templates/&quot;</span>&#125;;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> preferFileSystemAccess;<br>    ...<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="ä¸»è¦é…ç½®"><a href="#ä¸»è¦é…ç½®" class="headerlink" title="ä¸»è¦é…ç½®"></a>ä¸»è¦é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">freemarker:</span><br>    <span class="hljs-comment"># æ¨¡æ¿ç¼–ç </span><br>    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span><br>    <span class="hljs-comment"># æ¨¡æ¿åç¼€</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.ftl</span><br>    <span class="hljs-comment"># æ¨¡æ¿ä½ç½®</span><br>    <span class="hljs-attr">template-loader-path:</span> <span class="hljs-string">classpath:/templates</span><br>    <span class="hljs-comment"># æ˜¯å¦å¼€å¯ç¼“å­˜</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># HttpServletRequestçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerä¸­modelçš„åŒåé¡¹</span><br>    <span class="hljs-attr">allow-request-override:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># HttpSessionçš„å±æ€§æ˜¯å¦å¯ä»¥è¦†ç›–controllerä¸­modelçš„åŒåé¡¹</span><br>    <span class="hljs-attr">allow-session-override:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># æ˜¯å¦æ£€æŸ¥æ¨¡æ¿ä½ç½®</span><br>    <span class="hljs-attr">check-template-location:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># Content-Typeçš„å€¼</span><br>    <span class="hljs-attr">content-type:</span> <span class="hljs-string">text/html</span><br>    <span class="hljs-comment"># æ˜¯å¦å°†HttpServletRequestä¸­çš„å±æ€§æ·»åŠ åˆ°Modelä¸­</span><br>    <span class="hljs-attr">expose-request-attributes:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># æ˜¯å¦å°†HttpSessionä¸­çš„å±æ€§æ·»åŠ åˆ°Modelä¸­</span><br>    <span class="hljs-attr">expose-session-attributes:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>åˆ›å»ºUserç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String address;<br><br>    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddress</span><span class="hljs-params">(String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºUserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/index&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(Model model)</span> &#123;<br>        ArrayList&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>            user.setId((<span class="hljs-type">long</span>) i);<br>            user.setUsername(<span class="hljs-string">&quot;name&quot;</span> + i);<br>            user.setAddress(<span class="hljs-string">&quot;address&quot;</span> + i);<br>            users.add(user);<br>        &#125;<br>        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºindex.ftlè§†å›¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;table border=<span class="hljs-string">&quot;1&quot;</span>&gt;<br>    &lt;tr&gt;<br>        &lt;td&gt;ç”¨æˆ·ç¼–å·&lt;/td&gt;<br>        &lt;td&gt;ç”¨æˆ·åç§°&lt;/td&gt;<br>        &lt;td&gt;ç”¨æˆ·åœ°å€&lt;/td&gt;<br>    &lt;/tr&gt;<br>    &lt;#list users as user&gt;<br>        &lt;tr&gt;<br>            &lt;td&gt;$&#123;user.id&#125;&lt;/td&gt;<br>            &lt;td&gt;$&#123;user.username&#125;&lt;/td&gt;<br>            &lt;td&gt;$&#123;user.address&#125;&lt;/td&gt;<br>        &lt;/tr&gt;<br>    &lt;/#list&gt;<br>&lt;/table&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>è¿è¡Œï¼Œè®¿é—®<code>localhost:8080/index</code></p><h2 id="é™æ€è¾“å‡ºæ–‡ä»¶"><a href="#é™æ€è¾“å‡ºæ–‡ä»¶" class="headerlink" title="é™æ€è¾“å‡ºæ–‡ä»¶"></a>é™æ€è¾“å‡ºæ–‡ä»¶</h2><p>æ­¥éª¤ï¼š</p><ol><li>æŒ‡å®šæ¨¡æ¿æ–‡ä»¶</li><li>å‡†å¤‡æ•°æ®</li><li>å°†æ•°æ®å’Œæ¨¡æ¿ç»“åˆï¼Œè¾“å‡º</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ftl">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=&quot;utf-8&quot;&gt;<br>    &lt;title&gt;Hello World!&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;b&gt;æ™®é€šæ–‡æœ¬ String å±•ç¤ºï¼š&lt;/b&gt;&lt;br&gt;&lt;br&gt;<br>Hello $&#123;name!&#x27;&#x27;&#125; &lt;br&gt;<br>&lt;hr&gt;<br>&lt;b&gt;å¯¹è±¡Studentä¸­çš„æ•°æ®å±•ç¤ºï¼š&lt;/b&gt;&lt;br/&gt;<br>å§“åï¼š$&#123;stu.name&#125;&lt;br/&gt;<br>å¹´é¾„ï¼š$&#123;stu.age&#125;<br>&lt;hr&gt;<br><br>$&#123;date?string(&#x27;yyyyå¹´MMæœˆddæ—¥&#x27;)&#125;<br><br>&lt;#assign text=&quot;&#123;&#x27;bank&#x27;:&#x27;å·¥å•†é“¶è¡Œ&#x27;,&#x27;account&#x27;:&#x27;10101920201920212&#x27;&#125;&quot; /&gt;<br>&lt;#assign data=text?eval /&gt;<br>å¼€æˆ·è¡Œï¼š$&#123;data.bank&#125;  è´¦å·ï¼š$&#123;data.account&#125;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FreeMarkerTest</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> Configuration configuration;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TemplateException &#123;<br>        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> configuration.getTemplate(<span class="hljs-string">&quot;01-basic.ftl&quot;</span>);<br><span class="hljs-comment">// è¾“å‡ºé™æ€æ–‡ä»¶</span><br>        template.process(getData(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(<span class="hljs-string">&quot;d:/list.html&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Map <span class="hljs-title function_">getData</span><span class="hljs-params">()</span> &#123;<br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;freemarker&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;date&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        student.setName(<span class="hljs-string">&quot;zs&quot;</span>);<br>        student.setAge(<span class="hljs-number">18</span>);<br>        map.put(<span class="hljs-string">&quot;stu&quot;</span>, student);<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ¡†æ¶</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>psutil</title>
    <link href="/2023/04/29/%E5%85%B6%E4%BB%96/python/psutil/"/>
    <url>/2023/04/29/%E5%85%B6%E4%BB%96/python/psutil/</url>
    
    <content type="html"><![CDATA[<h1 id="psutil"><a href="#psutil" class="headerlink" title="psutil"></a>psutil</h1><blockquote><p>ç”¨äºè·å–æ“ä½œç³»ç»Ÿä»¥åŠç¡¬ä»¶ç›¸å…³çš„ä¿¡æ¯</p></blockquote><p>ä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> psutil<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuå‚æ•°&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuæ ¸å¿ƒæ•°:&quot;</span>, psutil.cpu_count(logical=<span class="hljs-literal">False</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuçº¿ç¨‹æ•°:&quot;</span>, psutil.cpu_count())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuåœ¨ç”¨æˆ·è¿›ç¨‹ä¸ŠèŠ±è´¹çš„æ—¶é—´:&quot;</span>, psutil.cpu_times().user)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuåœ¨å†…æ ¸ä¸ŠèŠ±è´¹çš„æ—¶é—´:&quot;</span>, psutil.cpu_times().system)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpuå„çº¿ç¨‹ä½¿ç”¨ç‡:&quot;</span>)<br><span class="hljs-built_in">print</span>(psutil.cpu_percent(interval=<span class="hljs-number">0.5</span>, percpu=<span class="hljs-literal">True</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpué¢‘ç‡:&quot;</span>, psutil.cpu_freq().current)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;======================================&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å†…å­˜å‚æ•°&quot;</span>)<br>total = psutil.virtual_memory().total / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span><br>available = psutil.virtual_memory().available / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å†…å­˜æ€»å¤§å°(GB):%.2f&quot;</span> % <span class="hljs-built_in">float</span>(total))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å†…å­˜å‰©ä½™é‡(GB):%.2f&quot;</span> % <span class="hljs-built_in">float</span>(available))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;======================================&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç£ç›˜å‚æ•°&quot;</span>)<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> psutil.disk_partitions():<br>    <span class="hljs-built_in">print</span>(p.device[<span class="hljs-number">0</span>], end=<span class="hljs-string">&quot; &quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç£ç›˜æ€»å¤§å°(GB):%.2f&quot;</span> % <span class="hljs-built_in">float</span>(psutil.disk_usage(p.device).total / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>), end=<span class="hljs-string">&quot; &quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç£ç›˜å‰©ä½™é‡(GB):%.2f&quot;</span> % <span class="hljs-built_in">float</span>(psutil.disk_usage(p.device).free / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;======================================&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç½‘ç»œå‚æ•°&quot;</span>)<br>last_io_counters = psutil.net_io_counters()<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    io_counters = psutil.net_io_counters()<br>    up_speed = (io_counters.bytes_sent - last_io_counters.bytes_sent) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span><br>    down_speed = (io_counters.bytes_recv - last_io_counters.bytes_recv) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;ä¸Šä¼ é€Ÿåº¦ï¼š<span class="hljs-subst">&#123;up_speed:<span class="hljs-number">.2</span>f&#125;</span> MB/s, ä¸‹è½½é€Ÿåº¦ï¼š<span class="hljs-subst">&#123;down_speed:<span class="hljs-number">.2</span>f&#125;</span> MB/s&#x27;</span>)<br>    last_io_counters = io_counters<br>    time.sleep(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React</title>
    <link href="/2023/04/26/%E5%89%8D%E7%AB%AF/react/React/"/>
    <url>/2023/04/26/%E5%89%8D%E7%AB%AF/react/React/</url>
    
    <content type="html"><![CDATA[<h1 id="React"><a href="#React" class="headerlink" title="React"></a>React</h1><p>å®˜ç½‘ï¼š<a href="https://react.docschina.org/">React (docschina.org)</a></p><h2 id="å®‰è£…React"><a href="#å®‰è£…React" class="headerlink" title="å®‰è£…React"></a>å®‰è£…React</h2><h3 id="htmlä¸­ç›´æ¥å¯¼å…¥"><a href="#htmlä¸­ç›´æ¥å¯¼å…¥" class="headerlink" title="htmlä¸­ç›´æ¥å¯¼å…¥"></a>htmlä¸­ç›´æ¥å¯¼å…¥</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/react/16.4.0/umd/react.development.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><strong>react.min.js</strong> - React çš„æ ¸å¿ƒåº“</li><li><strong>react-dom.min.js</strong> - æä¾›ä¸ DOM ç›¸å…³çš„åŠŸèƒ½</li><li><strong>babel.min.js</strong> - Babel å¯ä»¥å°† ES6 ä»£ç è½¬ä¸º ES5 ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ç›®å‰ä¸æ”¯æŒ ES6 æµè§ˆå™¨ä¸Šæ‰§è¡Œ React ä»£ç ã€‚Babel å†…åµŒäº†å¯¹ JSX çš„æ”¯æŒã€‚é€šè¿‡å°† Babel å’Œ babel-sublime åŒ…ï¼ˆpackageï¼‰ä¸€åŒä½¿ç”¨å¯ä»¥è®©æºç çš„è¯­æ³•æ¸²æŸ“ä¸Šå‡åˆ°ä¸€ä¸ªå…¨æ–°çš„æ°´å¹³ã€‚</li></ul><h3 id="ä½¿ç”¨create-react-appæ„å»ºé¡¹ç›®"><a href="#ä½¿ç”¨create-react-appæ„å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨create-react-appæ„å»ºé¡¹ç›®"></a>ä½¿ç”¨create-react-appæ„å»ºé¡¹ç›®</h3><blockquote><p>create-react-app æ˜¯æ¥è‡ªäº Facebookï¼Œé€šè¿‡è¯¥å‘½ä»¤æˆ‘ä»¬æ— éœ€é…ç½®å°±èƒ½å¿«é€Ÿæ„å»º React å¼€å‘ç¯å¢ƒ</p></blockquote><p>å®˜ç½‘ï¼š<a href="https://create-react-app.dev/">Create React App (create-react-app.dev)</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npx create-react-app my-app<br><span class="hljs-built_in">cd</span> my-app<br>npm <span class="hljs-built_in">start</span><br></code></pre></td></tr></table></figure><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h3><p>JavaScript + XMLï¼Œjsçš„è¯­æ³•æ‰©å±•ï¼Œå¯ä»¥åœ¨JavaScriptä¸­å†™XML</p><blockquote><p>ä½¿ç”¨create-react-appåˆ›å»ºçš„é¡¹ç›®ä¸­æœ‰babelï¼Œç»è¿‡babelç¼–è¯‘å¤„ç†åæ‰èƒ½åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨</p></blockquote><p>ä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span><br><br><span class="hljs-comment">// JSXæ¥åˆ›å»ºreactå…ƒç´ </span><br><span class="hljs-keyword">const</span> element = (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, JSX<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>); <br><br><span class="hljs-comment">// ç‰ˆæœ¬17åŠä¹‹å‰</span><br><span class="hljs-comment">// è¡¨ç¤ºå°† element è¿™ä¸ª JSX æ¸²æŸ“åˆ° id ä¸º root çš„å…ƒç´ ä¸Š</span><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  element,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)<br>);<br><br><span class="hljs-comment">// 18ä¹‹åçš„ç‰ˆæœ¬ç”¨ReactDOM.createRoot()</span><br><span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>));<br>root.<span class="hljs-title function_">render</span>(<br>  element<br>);<br></code></pre></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><ol><li>Reactå…ƒç´ çš„å±æ€§åä½¿ç”¨é©¼å³°å‘½åæ³•</li><li>ç‰¹æ®Šå±æ€§åè¦è½¬æ¢æˆå¯¹åº”å†™æ³•ï¼šclass -&gt; classNameã€for -&gt; htmlForã€tabindex -&gt; tablndex</li><li>æ²¡æœ‰å­èŠ‚ç‚¹çš„Reactå…ƒç´ å¯ä»¥ç”¨<code>/&gt;</code>ç»“æŸ</li><li>æ¨èä½¿ç”¨<code>()</code>åŒ…è£¹JSX</li></ol><h4 id="åµŒå…¥JSè¡¨è¾¾å¼"><a href="#åµŒå…¥JSè¡¨è¾¾å¼" class="headerlink" title="åµŒå…¥JSè¡¨è¾¾å¼"></a>åµŒå…¥JSè¡¨è¾¾å¼</h4><ul><li><p>è¯­æ³•ï¼š{JSè¡¨è¾¾å¼}</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">const name = &#x27;Jack&#x27;<br>const dv = (<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘å«: &#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>)<br></code></pre></td></tr></table></figure></li><li><p>æ³¨æ„ç‚¹</p><ul><li>å•å¤§æ‹¬å·é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨jsè¡¨è¾¾å¼</li><li>JSXè‡ªèº«ä¹Ÿæ˜¯JSè¡¨è¾¾å¼</li><li>ä¸èƒ½åœ¨{}ä¸­å‡ºç°è¯­å¥(å¦‚ï¼šif&#x2F;for)</li></ul></li></ul><h4 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html">const isLoading = false<br>const loadData = () =&gt; &#123;<br>  if (isLoading) &#123;<br>    return <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  &#125;<br>  return <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ•°æ®åŠ è½½å®Œæˆ<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>&#125;<br><br>const root = ReactDOM.createRoot(document.getElementById(&#x27;root&#x27;));<br>root.render(<br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>    &#123;loadData()&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>);<br></code></pre></td></tr></table></figure><h4 id="åˆ—è¡¨æ¸²æŸ“"><a href="#åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="åˆ—è¡¨æ¸²æŸ“"></a>åˆ—è¡¨æ¸²æŸ“</h4><ul><li>ä½¿ç”¨map()æ¥æ¸²æŸ“ä¸€ç»„æ•°æ®</li><li>åˆ—è¡¨åº”è¯¥æ·»åŠ key</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html">const songs = [<br>  &#123;id: 1, name: &#x27;a&#x27;&#125;,<br>  &#123;id: 2, name: &#x27;b&#x27;&#125;,<br>  &#123;id: 3, name: &#x27;c&#x27;&#125;,<br>]<br><br>const root = ReactDOM.createRoot(document.getElementById(&#x27;root&#x27;));<br>root.render(<br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br>    &#123;songs.map(item =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>)&#125;<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>);<br></code></pre></td></tr></table></figure><h4 id="æ ·å¼å¤„ç†"><a href="#æ ·å¼å¤„ç†" class="headerlink" title="æ ·å¼å¤„ç†"></a>æ ·å¼å¤„ç†</h4><ul><li><p>è¡Œå†…æ ·å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html">// ç¬¬ä¸€ä¸ª&#123;&#125;è¡¨ç¤ºåµŒå…¥è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ª&#123;&#125;è¡¨ç¤ºå¯¹è±¡<br>const root = ReactDOM.createRoot(document.getElementById(&#x27;root&#x27;));<br>root.render(<br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span> = <span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> &#x27;<span class="hljs-attr">red</span>&#x27;, <span class="hljs-attr">backgroundColor:</span> &#x27;<span class="hljs-attr">skyblue</span>&#x27; &#125;&#125;&gt;</span><br>    æ ·å¼å¤„ç†<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>);<br></code></pre></td></tr></table></figure></li><li><p>ç±»å</p><p><strong>è®°å¾—å¯¼å…¥</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html">// App.js<br>import &#x27;./index.css&#x27;;<br><br>const root = ReactDOM.createRoot(document.getElementById(&#x27;root&#x27;));<br>root.render(<br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;title&#x27;</span>&gt;</span><br>    æ ·å¼å¤„ç†<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>);<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">// index<span class="hljs-selector-class">.css</span><br><br><span class="hljs-selector-class">.title</span> &#123;<br>  <span class="hljs-attribute">text-align</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><p><code>props</code>æ˜¯çˆ¶ç»„ä»¶ä¼ ç»™å­ç»„ä»¶çš„å±æ€§ï¼ˆåªè¯»ï¼Œå•å‘ï¼‰</p><p>å®šä¹‰ç»„ä»¶æ–¹å¼1ï¼šå‡½æ•°å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComp</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰ç»„ä»¶æ–¹å¼2ï¼šç±»ç»„ä»¶å¼ï¼Œéœ€è¦ç»§æ‰¿React.Componentï¼Œéœ€è¦å®šä¹‰renderæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>;<br><br><span class="hljs-comment">// ç»§æ‰¿äº React.Component</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>   <span class="hljs-comment">// ç±»ä¼¼æ„é€ å‡½æ•°</span><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props); <br>  &#125;<br>  <br>   <span class="hljs-comment">// è¿”å›å±•ç¤ºçš„è§†å›¾ç»“æ„</span><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// render æ–¹æ³•è¿”å›éœ€è¦å±•ç¤ºçš„è§†å›¾ç»“æ„â€”â€”Reactå…ƒç´ </span><br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hello &#123;this.props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="/img/qianduan/React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png"></p><p>æŒ‚è½½é˜¶æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) <span class="hljs-comment">// class çš„æ„é€ æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ super(props) æ¥æ”¶å‚æ•°</span><br><br><span class="hljs-title function_">componentWillMount</span>() <span class="hljs-comment">// æŒ‚è½½å‰</span><br><br><span class="hljs-title function_">render</span>() <span class="hljs-comment">// è¿”å›Reactå…ƒç´ </span><br><br><span class="hljs-title function_">componentDidMount</span>() <span class="hljs-comment">// æŒ‚è½½å</span><br></code></pre></td></tr></table></figure><p>æ›´æ–°é˜¶æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">componentWillReceiveProps</span>(nextProps) <span class="hljs-comment">// props å˜åŒ–æ—¶è°ƒç”¨ï¼ŒnextProps æ˜¯æ–°å‚æ•°</span><br><br><span class="hljs-title function_">shouldComponentUpdate</span>(nextProps, nextState) <span class="hljs-comment">// æ˜¯å¦ç»§ç»­æ‰§è¡Œæ›´æ–°è¿‡ç¨‹ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</span><br><br><span class="hljs-title function_">componentWillUpdate</span>(nextProps, nextState) <span class="hljs-comment">// æ›´æ–°å‰</span><br><br><span class="hljs-title function_">render</span>()<br><br><span class="hljs-title function_">componentDidUpdate</span>(prevProps, prevState) <span class="hljs-comment">// æ›´æ–°å</span><br></code></pre></td></tr></table></figure><p>å¸è½½é˜¶æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123; &#125; <span class="hljs-comment">// ç»„ä»¶è¢«åˆ é™¤å‰è°ƒç”¨ï¼Œæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ</span><br></code></pre></td></tr></table></figure><h3 id="state-amp-props"><a href="#state-amp-props" class="headerlink" title="state&amp;props"></a>state&amp;props</h3><p><strong>props</strong>ï¼šæ˜¯çˆ¶ç»„ä»¶ä¼ ç»™å­ç»„ä»¶çš„å±æ€§ï¼ˆåªè¯»ï¼Œå•å‘ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">HelloWorld</span> = (<span class="hljs-params">props</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">HelloWorld</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Someone :)&quot;</span>/&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure><p>stateï¼šç»„ä»¶è‡ªå·±çš„æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyComp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),<br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Its &#123;this.state.time&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><ol><li><p>åˆ›å»ºé¡¹ç›®</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npx create-react-app my-app<br></code></pre></td></tr></table></figure></li><li><p>ç²¾ç®€é¡¹ç›®</p><p>å°†publicç›®å½•é‡Œé™¤äº†<code>favicon.ico</code>å’Œ<code>index.html</code>çš„æ–‡ä»¶åˆ æ‰</p><p>å°†srcé‡Œé™¤äº†<code>App.js</code>çš„æ–‡ä»¶åˆ æ‰ï¼Œåˆ›å»º<code>index.js</code></p></li><li></li></ol>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// App.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br><br>  <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;App&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;<br><br></code></pre></td></tr></table></figure>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// index.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom&quot;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App&quot;</span><br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span>/&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>))<br></code></pre></td></tr></table></figure>   <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html">// index.html<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;%PUBLIC_URL%/favicon.ico&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>React App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>You need to enable JavaScript to run this app.<span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/img/qianduan/%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>React</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œ</title>
    <link href="/2023/04/15/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    <url>/2023/04/15/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><h3 id="ç½‘ç»œä½“ç³»ç»“æ„"><a href="#ç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="ç½‘ç»œä½“ç³»ç»“æ„"></a>ç½‘ç»œä½“ç³»ç»“æ„</h3><p><img src="/img/inter_img/%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png" alt="ç½‘ç»œä½“ç³»ç»“æ„"></p><p>åº”ç”¨å±‚ï¼šç”¨æˆ·è®¿é—®ç½‘ç»œçš„æ¥å£</p><p>ä¼ è¾“å±‚ï¼šè¿›ç¨‹é—´é€šä¿¡</p><p>ç½‘ç»œå±‚ï¼šé€‰æ‹©åˆé€‚è·¯ç”±å’Œäº¤æ¢èŠ‚ç‚¹ï¼Œå®Œæˆä»»æ„ä¸¤å°ä¸»æœºé—´é€šä¿¡</p><p>æ•°æ®é“¾è·¯å±‚ï¼šIPæ•°æ®æŠ¥å°è£…æˆå¸§åœ¨ç›¸é‚»èŠ‚ç‚¹é—´ä¼ è¾“</p><p>ç‰©ç†å±‚ï¼šç›¸é‚»èŠ‚ç‚¹æ¯”ç‰¹æµçš„é€æ˜ä¼ è¾“</p><h3 id="å„å±‚åè®®"><a href="#å„å±‚åè®®" class="headerlink" title="å„å±‚åè®®"></a>å„å±‚åè®®</h3><p><img src="/img/inter_img/%E5%90%84%E5%B1%82%E5%8D%8F%E8%AE%AE.png" alt="ç½‘ç»œä½“ç³»ç»“æ„"></p><h3 id="æ•°æ®å„å±‚ä¼ è¾“æ–¹å¼"><a href="#æ•°æ®å„å±‚ä¼ è¾“æ–¹å¼" class="headerlink" title="æ•°æ®å„å±‚ä¼ è¾“æ–¹å¼"></a>æ•°æ®å„å±‚ä¼ è¾“æ–¹å¼</h3><p>ä»ä¸Šåˆ°ä¸‹ç»™æ•°æ®åŒ…è£…ï¼Œä»ä¸‹åˆ°ä¸Šè§£åŒ…è£…</p><p><strong>ä¼ è¾“å±‚</strong>ï¼šTCPï¼šæŠ¥æ–‡ï¼ŒUDPï¼šç”¨æˆ·æ•°æ®æŠ¥</p><p><strong>ç½‘ç»œå±‚</strong>ï¼šIPæ•°æ®æŠ¥</p><p><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šå¸§</p><p><strong>ç‰©ç†å±‚</strong>ï¼šæ•°æ®æ¯”ç‰¹æµ</p><p><img src="/img/inter_img/%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B.png" alt="è¯·æ±‚è§£æè¿‡ç¨‹"></p><h3 id="DNSè§£æè¿‡ç¨‹"><a href="#DNSè§£æè¿‡ç¨‹" class="headerlink" title="DNSè§£æè¿‡ç¨‹"></a>DNSè§£æè¿‡ç¨‹</h3><p>åŸŸåå’ŒIPç›¸äº’æ˜ å°„</p><p>è¾“å…¥åŸŸå â€“&gt; æµè§ˆå™¨ç¼“å­˜æ‰¾ â€“&gt; æœ¬åœ°Hostç¼“å­˜ â€“&gt; æœ¬åœ°DNSæœåŠ¡å™¨ â€“&gt; </p><p>(æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆè¿”å›é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼‰ â€“&gt; é¡¶çº§åŸŸåæœåŠ¡å™¨(comï¼Œè¿”å›æƒé™åŸŸåæœåŠ¡å™¨åœ°å€) â€“&gt; æƒé™åŸŸåæœåŠ¡å™¨(<a href="http://www.baidu,è¿”å›è¯·æ±‚åŸŸåçš„ip/">www.baiduï¼Œè¿”å›è¯·æ±‚åŸŸåçš„ip</a>))</p><p><img src="/img/inter_img/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90.png" alt="è¯·æ±‚è§£æè¿‡ç¨‹"></p><h3 id="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</h3><blockquote><p>TCP å»ºç«‹è¿æ¥ã€æ–­å¼€è¿æ¥çš„è¿‡ç¨‹</p></blockquote><p><strong>ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼ˆå»ºç«‹è¿æ¥ï¼‰ï¼š</p><p>â€‹<img src="/img/inter_img/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png"></p><ul><li><p>SYNï¼ˆSynchronize Sequence Numbersï¼‰ï¼šåŒæ­¥åºåˆ—å·</p></li><li><p>ACKï¼ˆAcknowledgement Numberï¼‰ï¼šç¡®è®¤ç¼–å·</p></li><li><p>ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†è§£å†³ç”±äºç½‘ç»œé˜»å¡ç­‰åŸå› ä¸€ä¸ªè¯·æ±‚å»ºç«‹æŠ¥æ–‡æ²¡æœ‰ä¼ é€åˆ°æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯åˆå‘é€ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†è¿™æ¬¡çš„æŠ¥æ–‡ï¼›ä½†ä¹‹å‰æ»ç•™åœ¨ç½‘ç»œä¸­çš„æŠ¥æ–‡åˆåˆ°è¾¾äº†æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¯¯ä»¥ä¸ºæ˜¯å®¢æˆ·ç«¯å‘èµ·äº†æ–°çš„è¿æ¥ï¼Œé€ æˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„çŠ¶æ€ä¸ä¸€è‡´ï¼ŒæœåŠ¡ç«¯ä¼šä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚ï¼ˆ<strong>åœ¨ä¸å¯é çš„ä¿¡é“ä¸Šå»ºç«‹å¯é çš„æ•°æ®è¿æ¥</strong>ï¼‰</p></li></ul><p>ä¼ è¾“ç¡®è®¤ï¼š</p><p>â€‹<img src="/img/inter_img/%E4%BC%A0%E8%BE%93%E7%A1%AE%E8%AE%A4.png"></p><ul><li>æœåŠ¡ç«¯å°†å‘é€ç¼“å­˜åŒºçš„æ•°æ®æŒ‰åºåˆ—å·ä¼ é€ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå›å¤ä¸€ä¸ªACKï¼ŒACKåŒ…å«äº†ä¸€ä¸‹ä¸ªè¯·æ±‚ä¼ è¾“çš„åºåˆ—å·ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°å¯ä»¥è¦æ±‚æœåŠ¡ç«¯é‡ä¼ </li></ul><p><strong>å››æ¬¡æŒ¥æ‰‹</strong>ï¼š</p><p>â€‹<img src="/img/inter_img/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png"></p><ul><li>ç¬¬ä¸€æ¬¡ã€ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€FINï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›å…¥å°†è¦å…³é—­çŠ¶æ€ï¼Œæ­¤æ—¶æœåŠ¡ç«¯è¿˜å¯ä»¥å‘é€æœªå‘å®Œçš„æ•°æ®</li><li>ç¬¬ä¸‰æ¬¡ã€ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯å‘é€å®Œæ¶ˆæ¯ï¼Œå‘é€FINï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå›å¤ACKå¹¶ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆæŠ¥æ–‡æœ€é•¿ç”Ÿå­˜æ—¶é—´*2ï¼‰åå…³é—­ï¼ˆé˜²æ­¢ç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´æœåŠ¡ç«¯æ²¡æ”¶åˆ°ï¼Œä»è€ŒæœåŠ¡ç«¯æ²¡æœ‰å…³é—­è¿æ¥ï¼‰ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ACKåå…³é—­ã€‚</li><li>å››æ¬¡æŒ¥æ‰‹æ˜¯ä¸ºäº†æŠŠæ•°æ®ä¼ å®Œ</li></ul><h3 id="TCPã€UDPæ¯”è¾ƒ"><a href="#TCPã€UDPæ¯”è¾ƒ" class="headerlink" title="TCPã€UDPæ¯”è¾ƒ"></a>TCPã€UDPæ¯”è¾ƒ</h3><p>TCPï¼š</p><ul><li><p>é¢å‘è¿æ¥ï¼Œç‚¹å¯¹ç‚¹ï¼Œå…¨åŒå·¥é€šä¿¡ï¼Œé¢å‘å­—èŠ‚æµï¼Œæ‹¥å¡æ§åˆ¶</p></li><li><p>ç¨³å®šå¯é ï¼Œé€‚ç”¨äºå¯¹ç½‘ç»œé€šè®¯è´¨é‡è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚ä¼ è¾“æ–‡ä»¶ã€æµè§ˆç½‘é¡µ</p></li><li><p>åŸºäºTCPçš„åº”ç”¨å±‚åè®®æœ‰HTTPã€FTPã€SMTPã€SSHç­‰</p></li></ul><p>UDPï¼š</p><ul><li><p>é¢å‘æŠ¥æ–‡ï¼Œå¯ä¸€å¯¹å¤šï¼Œå¤´éƒ¨çŸ­(8Byte)</p></li><li><p>é€Ÿåº¦å¿«ï¼Œé€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œå¦‚è¯­éŸ³é€šè¯ã€ç›´æ’­</p></li><li><p>åŸºäºUDPçš„åº”ç”¨å±‚åè®®æœ‰DNSã€TFTPã€SNMPç­‰</p></li></ul><h3 id="TCPå¤´éƒ¨å­—æ®µ"><a href="#TCPå¤´éƒ¨å­—æ®µ" class="headerlink" title="TCPå¤´éƒ¨å­—æ®µ"></a>TCPå¤´éƒ¨å­—æ®µ</h3><p><img src="/img/inter_img/TCP%E6%8A%A5%E5%A4%B4.png"></p><ul><li><strong>åºå·</strong>ï¼šå‡è®¾Aå’ŒBé€šè®¯ï¼ŒAå‘é€ç»™Bçš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡ä¸­çš„åºå·ä¸ºä¸€ä¸ªéšæœºçš„ISNï¼ˆåˆå§‹åºå·å€¼ï¼‰ï¼Œåç»­å‘é€çš„æŠ¥æ–‡åºå·ä¸ºISN+æºå¸¦æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨å­—èŠ‚æµä¸­çš„åç§»é‡</li><li><strong>ç¡®è®¤å·</strong>ï¼šåœ¨æ”¶åˆ°çš„æŠ¥å¤´çš„åºå·ä¸Š+1</li><li><strong>å¤´éƒ¨é•¿åº¦</strong>ï¼šè¡¨ç¤ºTCPå¤´éƒ¨æœ‰å¤šå°‘ä¸ª32bitçš„å­—ï¼ŒTPCå¤´éƒ¨é•¿åº¦èŒƒå›´ä¸º20Byte ~ 15*4Byte &#x3D; 60Byte</li><li><strong>æ ‡å¿—ä½</strong>ï¼š<ul><li>ACKï¼šè¡¨ç¤ºç¡®è®¤å·æ˜¯å¦æœ‰æ•ˆï¼Œæºå¸¦ACKçš„æŠ¥æ–‡æ®µä¸º<strong>ç¡®è®¤æŠ¥æ–‡æ®µ</strong></li><li>SYNï¼šè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ï¼Œæºå¸¦SYNçš„æŠ¥æ–‡æ®µä¸º<strong>åŒæ­¥æŠ¥æ–‡æ®µ</strong></li><li>FINï¼šè¡¨ç¤ºé€šçŸ¥å¯¹æ–¹æœ¬ç«¯è¦å…³é—­è¿æ¥ï¼Œæºå¸¦FINçš„æŠ¥æ–‡æ®µä¸º<strong>ç»“æŸæŠ¥æ–‡ç«¯</strong></li></ul></li><li><strong>çª—å£å¤§å°</strong>ï¼šå‘Šè¯‰å‘é€ç«¯æœ¬ç«¯çš„æ¥æ”¶ç¼“å†²åŒºè¿˜å‰©å¤šå°‘ï¼Œç”¨æ¥TCPæµé‡æ§åˆ¶</li></ul><h3 id="ç²˜åŒ…ã€åŠåŒ…"><a href="#ç²˜åŒ…ã€åŠåŒ…" class="headerlink" title="ç²˜åŒ…ã€åŠåŒ…"></a>ç²˜åŒ…ã€åŠåŒ…</h3><p>ç²˜åŒ…ï¼šå¤šä¸ªåŒ…ä¸€èµ·å‘é€</p><p>åŠåŒ…ï¼šä¸€ä¸ªåŒ…æ‹†æˆå¤šä¸ªå‘é€</p><p>è§£å†³æ–¹å¼ï¼š</p><ol><li>åœ¨æ•°æ®å°¾éƒ¨æ·»åŠ ç‰¹æ®Šå­—ç¬¦è¿›è¡Œåˆ†å‰²</li><li>å‘é€åˆ†ä¸ºå¤´éƒ¨å’Œå†…å®¹ï¼Œå¤´éƒ¨é‡Œå£°æ˜äº†å†…å®¹çš„å¤§å°</li></ol><h3 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h3><p>æ‹¥å¡çª—å£ï¼šæ¯æ¬¡å‘é€å¤šå°‘ä¸ªæ•°æ®åŒ…</p><p><strong>æ…¢å¼€å§‹</strong>ï¼šå¼€å§‹æ—¶ä¸çŸ¥é“å½“å‰ç½‘ç»œçŠ¶å†µï¼Œå› æ­¤ä»1å¼€å§‹æŒ‡æ•°å¢åŠ æ‹¥å¡çª—å£çš„å¤§å°</p><p><strong>æ‹¥å¡é¿å…</strong>ï¼šå½“æ‹¥å¡çª—å£åˆ°è¾¾é˜ˆå€¼åçº¿æ€§å¢é•¿ï¼Œå½“å‡ºç°è¶…æ—¶äº‹ä»¶æ—¶æ‹¥å¡çª—å£å˜ä¸º1å¹¶é™ä½é˜ˆå€¼ï¼ˆæ­¤æ—¶çš„æ‹¥å¡çª—å£å¤§å°&#x2F;2ï¼‰</p><p><img src="/img/inter_img/%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D.png"></p><p><strong>å¿«é‡ä¼ </strong>ï¼šå¦‚æœæ˜¯å› ä¸ºä¸¢åŒ…è€Œä¸æ˜¯ç½‘ç»œé˜»å¡é€ æˆæ²¡æœ‰æ”¶åˆ°æ•°æ®åŒ…ï¼Œæ¥æ”¶æ–¹è‹¥åœ¨æ•°æ®åŒ…è¶…æ—¶æ—¶é—´å†…è¿ç»­æ”¶åˆ°ä¸‰ä¸ªåŒä¸€ä¸ªåŒ…çš„ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯ï¼Œå°±è®¤ä¸ºæ˜¯ä¸¢åŒ…äº†ï¼Œä¼šç«‹å³é‡æ–°ä¼ è¿™ä¸ªåŒ…çš„ä¸‹ä¸€ä¸ªåŒ…ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è¶…æ—¶æ—¶é—´</p><p><img src="/img/inter_img/%E5%BF%AB%E9%87%8D%E4%BC%A0.png"></p><p><strong>å¿«æ¢å¤</strong>ï¼šå¿«é‡ä¼ åæŠŠé˜ˆå€¼é™ä¸ºæ‹¥å¡çª—å¤§å°çš„ä¸€åŠï¼ŒæŠŠæ‹¥å¡çª—å£é™ä¸ºé˜ˆå€¼è€Œä¸æ˜¯1</p><h3 id="å¸¸è§çŠ¶æ€ç "><a href="#å¸¸è§çŠ¶æ€ç " class="headerlink" title="å¸¸è§çŠ¶æ€ç "></a>å¸¸è§çŠ¶æ€ç </h3><p>200ï¼šè¯·æ±‚æˆåŠŸï¼›</p><p>301ï¼šæ°¸ä¹…é‡å®šå‘ï¼›302ï¼šä¸´æ—¶é‡å®šå‘ï¼›</p><p>404ï¼šæ— æ³•æ‰¾åˆ°æ­¤é¡µé¢ï¼›405ï¼šè¯·æ±‚çš„æ–¹æ³•ç±»å‹ä¸æ”¯æŒï¼›</p><p>500ï¼šæœåŠ¡å™¨å†…éƒ¨å‡ºé”™ã€‚</p><h3 id="URIå’ŒURL"><a href="#URIå’ŒURL" class="headerlink" title="URIå’ŒURL"></a>URIå’ŒURL</h3><ul><li>URIï¼Œå…¨ç§°æ˜¯Uniform Resource Identifierï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œä¸»è¦ä½œç”¨æ˜¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚</li><li>URLï¼Œå…¨ç§°æ˜¯Uniform Resource Locationï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›èµ„æºçš„è·¯å¾„ã€‚</li></ul><h3 id="Cookie-x2F-Session"><a href="#Cookie-x2F-Session" class="headerlink" title="Cookie&#x2F;Session"></a>Cookie&#x2F;Session</h3><p><strong>cookie</strong>ï¼š</p><ol><li>æœåŠ¡ç«¯servletåˆ›å»ºcookieï¼Œä¿å­˜å°‘é‡æ•°æ®ï¼Œå‘é€ç»™æµè§ˆå™¨ã€‚</li><li>æµè§ˆå™¨è·å¾—æœåŠ¡å™¨å‘é€çš„cookieæ•°æ®ï¼Œå°†è‡ªåŠ¨çš„ä¿å­˜åˆ°æµè§ˆå™¨ç«¯ã€‚</li><li>ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œæµè§ˆå™¨å°†è‡ªåŠ¨æºå¸¦cookieæ•°æ®ï¼ˆåˆ°è¯·æ±‚å¤´ï¼‰å‘é€ç»™æœåŠ¡å™¨ã€‚</li></ol><p>sessionï¼š</p><ol><li>æœåŠ¡ç«¯åˆ¤æ–­æµè§ˆå™¨ç«¯è¯·æ±‚æ˜¯å¦åŒ…å«sessionæ ‡è¯†ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºsessionå¹¶è¿”å›sessionIdï¼ˆé€šè¿‡cookieï¼‰</li><li>æµè§ˆå™¨ç«¯ä¹‹åçš„è¯·æ±‚éƒ½æºå¸¦sessionId</li><li>sessionåœ¨è¶…æ—¶æ—¶é—´è¿‡åé”€æ¯ï¼Œè€Œä¸æ˜¯å…³é—­æµè§ˆå™¨</li></ol><h3 id="WebSocket-x2F-Socket"><a href="#WebSocket-x2F-Socket" class="headerlink" title="WebSocket&#x2F;Socket"></a>WebSocket&#x2F;Socket</h3><p>â€‹Socketæ˜¯ä¸€å¥—æ ‡å‡†ï¼Œå®ƒå®Œæˆäº†å¯¹TCP&#x2F;IPçš„é«˜åº¦å°è£…ï¼Œå±è”½ç½‘ç»œç»†èŠ‚ï¼Œä»¥æ–¹ä¾¿å¼€å‘è€…æ›´å¥½åœ°è¿›è¡Œç½‘ç»œç¼–ç¨‹ã€‚Socketå…¶å®å°±æ˜¯ç­‰äº<strong>IPåœ°å€ + ç«¯å£ + åè®®</strong>ã€‚</p><p>â€‹WebSocketæ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„åè®®ï¼Œå®ƒæ˜¯ä¼´éšH5è€Œå‡ºçš„åè®®ï¼Œç”¨æ¥è§£å†³<strong>httpä¸æ”¯æŒæŒä¹…åŒ–è¿æ¥</strong>çš„é—®é¢˜ã€‚</p><p>Socketä¸€ä¸ªæ˜¯<strong>ç½‘ç¼–ç¼–ç¨‹çš„æ ‡å‡†æ¥å£</strong>ï¼Œè€ŒWebSocketåˆ™æ˜¯åº”ç”¨å±‚é€šä¿¡åè®®ã€‚</p><h3 id="ç½‘ç»œæ”»å‡»"><a href="#ç½‘ç»œæ”»å‡»" class="headerlink" title="ç½‘ç»œæ”»å‡»"></a>ç½‘ç»œæ”»å‡»</h3><p><strong>CSRF</strong>ï¼šCross-site request forgeryï¼Œè·¨åŸŸè¯·æ±‚ä¼ªé€ ã€‚æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•</p><p><strong>XSS</strong>ï¼šCross-Site Scriptingï¼Œè·¨åŸŸè„šæœ¬æ”»å‡»ã€‚å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„htmlä»£ç </p><p><strong>ç›—é“¾</strong>ï¼šè·å–å…¶ä»–ç½‘ç«™çš„èµ„æºå±•ç¤ºåœ¨è‡ªå·±çš„ç½‘ç«™ä¸Šã€‚å¯ä»¥é€šè¿‡æ£€æŸ¥refererå¤´éƒ¨å­—æ®µæ¥æ£€æŸ¥è¯·æ±‚æ¥æºï¼Œä»è€Œé˜²ç›—é“¾</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ç½‘ç»œ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MySQL</title>
    <link href="/2023/04/12/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/"/>
    <url>/2023/04/12/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL/</url>
    
    <content type="html"><![CDATA[<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><h4 id="SQLè¯­è¨€"><a href="#SQLè¯­è¨€" class="headerlink" title="SQLè¯­è¨€"></a>SQLè¯­è¨€</h4><p>DDLï¼ˆData Definition Languageï¼‰ï¼šå®šä¹‰&#x2F;æ”¹å˜è¡¨</p><p>DMLï¼ˆData Manipulation Languageï¼‰ï¼šæ•°æ®çš„å¢åˆ æ”¹</p><p>DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®çš„æŸ¥è¯¢</p><p>DCLï¼ˆData Control Languageï¼‰ï¼šè®¾ç½®&#x2F;æ›´æ”¹ç”¨æˆ·æƒé™</p><h4 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID"><a href="#äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID" class="headerlink" title="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID"></a>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID</h4><p>åŸå­æ€§ï¼šAtomicityï¼Œäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒ</p><p>ä¸€è‡´æ€§ï¼šConsistencyï¼Œäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„äº‹åŠ¡éƒ½ä¿æŒä¸€è‡´çŠ¶æ€</p><p>éš”ç¦»æ€§ï¼šIsolationï¼Œäº‹åŠ¡ä¸å—å¤–éƒ¨å½±å“</p><p>æŒä¹…æ€§ï¼šDurabilityï¼Œäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå¯¹æ•°æ®åº“çš„æ”¹å˜æ˜¯æ°¸ä¹…çš„</p><h4 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h4><p>è¯»æœªæäº¤ï¼šå¯ä»¥è¯»åˆ°äº‹åŠ¡æœªæäº¤çš„æ•°æ®</p><p>è¯»å·²æäº¤ï¼šåªèƒ½è¯»åˆ°äº‹åŠ¡å·²æäº¤çš„æ•°æ®</p><p>å¯é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰ï¼šé™åˆ¶äº†è¯»æ•°æ®çš„æ—¶å€™ä¸èƒ½æ›´æ”¹æ•°æ®ï¼ŒåŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œ</p><p>ä¸²è¡ŒåŒ–ï¼šäº‹åŠ¡é—´ä¸²è¡Œæ‰§è¡Œ</p><h3 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h3><blockquote><p>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°&#x2F;æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼</p><p>ä¸åŒè¡¨å¯ä»¥æœ‰ä¸åŒçš„å­˜å‚¨å¼•æ“</p></blockquote><h4 id="MySQLä½“ç³»ç»“æ„"><a href="#MySQLä½“ç³»ç»“æ„" class="headerlink" title="MySQLä½“ç³»ç»“æ„"></a>MySQLä½“ç³»ç»“æ„</h4><p><img src="/img/sql_img/MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png"></p><ul><li>è¿æ¥å±‚ï¼šå¯¹å®¢æˆ·ç«¯çš„è¿æ¥æœåŠ¡ï¼Œå¦‚è¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ç­‰</li><li><strong>æœåŠ¡å±‚</strong>ï¼šå¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ã€SQLåˆ†æå’Œä¼˜åŒ–ã€è¿‡ç¨‹ã€å‡½æ•°ç­‰</li><li><strong>å¼•æ“å±‚</strong>ï¼šè´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼ˆç´¢å¼•æ˜¯ç”±å­˜å‚¨å¼•æ“å®ç°ï¼‰</li><li>å­˜å‚¨å±‚ï¼šå°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Š</li></ul><h4 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h4><ol><li><p>æŸ¥çœ‹æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show engines<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“ï¼ˆé»˜è®¤InnoDBï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE my_myisam(<br>id INT,<br>NAME VARCHAR(10)<br>) ENGINE = MYISAM;<br></code></pre></td></tr></table></figure></li></ol><h4 id="å­˜å‚¨å¼•æ“ç‰¹ç‚¹"><a href="#å­˜å‚¨å¼•æ“ç‰¹ç‚¹" class="headerlink" title="å­˜å‚¨å¼•æ“ç‰¹ç‚¹"></a>å­˜å‚¨å¼•æ“ç‰¹ç‚¹</h4><p><strong>InnoDB</strong>ï¼š</p><ol><li><strong>æ”¯æŒäº‹åŠ¡</strong></li><li><strong>è¡Œçº§é”</strong>ï¼Œæé«˜å¹¶å‘è®¿é—®åº¦</li><li><strong>æ”¯æŒå¤–é”®</strong></li><li>æ¯ä¸€ä¸ªinnodbå¼•æ“æ•°æ®è¡¨éƒ½å¯¹åº”ç€ä¸€ä¸ªxxx.ibdæ–‡ä»¶</li></ol><p><img src="/img/sql_img/InnoDB%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="InnoDBå­˜å‚¨ç»“æ„"></p><p><strong>MyISAM</strong>ï¼š</p><ol><li>æ—©æœŸé»˜è®¤å­˜å‚¨å¼•æ“</li><li>ä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®</li><li>åªæ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</li><li>è®¿é—®é€Ÿåº¦å¿«</li></ol><p><strong>Memory</strong>ï¼š</p><ol><li>æ•°æ®å­˜åœ¨å†…å­˜ï¼Œè®¿é—®é€Ÿåº¦å¿«</li><li>æ”¯æŒhashç´¢å¼•</li></ol><h4 id="é€‰æ‹©å­˜å‚¨å¼•æ“"><a href="#é€‰æ‹©å­˜å‚¨å¼•æ“" class="headerlink" title="é€‰æ‹©å­˜å‚¨å¼•æ“"></a>é€‰æ‹©å­˜å‚¨å¼•æ“</h4><p><strong>InnoDB</strong>ï¼šå¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚æ¯”è¾ƒé«˜æ—¶</p><p>MyISAMï¼šä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œå¾ˆå°‘æ›´æ–°å’Œåˆ é™¤ï¼Œå¯¹å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸é«˜æ—¶ï¼Œå¦‚æ—¥å¿—ã€è¯„è®º â€“&gt; (MongoDB)</p><p>MEMORYï¼šç¼“å­˜ â€“&gt;ï¼ˆRedisï¼‰</p><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><blockquote><p>ç´¢å¼•æ˜¯å¸®åŠ©MySQL<strong>é«˜æ•ˆè·å–</strong>æ•°æ®çš„<strong>æ•°æ®ç»“æ„</strong>ï¼ˆ<strong>æœ‰åº</strong>ï¼‰ï¼Œè¿™ç§æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ã€‚</p></blockquote><h4 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h4><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</p></li><li><p>é€šè¿‡ç´¢å¼•åˆ—é˜Ÿæ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®çš„æ’åºæˆæœ¬</p></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç´¢å¼•éœ€è¦å ç”¨ç©ºé—´</li><li>éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œé™ä½äº†å¢åˆ æ”¹çš„æ•ˆç‡</li></ul><h4 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h4><p>å­˜å‚¨å¼•æ“ä¸»è¦ä½¿ç”¨çš„æ•°æ®ç»“æ„æœ‰ï¼š</p><table><thead><tr><th>ç´¢å¼•ç»“æ„</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>B+Treeç´¢å¼•</strong></td><td>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹</td></tr><tr><td>Hashç´¢å¼•</td><td>ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œåªèƒ½ç²¾ç¡®åŒ¹é…</td></tr><tr><td>R-Treeï¼ˆç©ºé—´ç´¢å¼•ï¼‰</td><td>MyISAMå¼•æ“ä¸­çš„ç´¢å¼•ç±»å‹ï¼Œç”¨äºåœ°ç†ç©ºé—´æŸ¥è¯¢</td></tr><tr><td>Full-textï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰</td><td>é€šè¿‡å€’æ’ç´¢å¼•ï¼Œå¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼</td></tr></tbody></table><p><strong>ç´¢å¼•ç»“æ„</strong>ï¼š</p><ul><li><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼šå·¦å°å³å¤§ï¼Œé¡ºåºæ’å…¥æ—¶ä¼šå½¢æˆä¸€æ£µå•å‰çš„æ ‘ï¼ŒæŸ¥è¯¢æ€§èƒ½å¤§å¤§é™ä½</p></li><li><p>çº¢é»‘æ ‘ï¼šå¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢</p></li><li><p><strong>B-Tree</strong>ï¼ˆå¤šè·¯å¹³è¡¡æ ‘ï¼‰ï¼šä¸€ä¸ªèŠ‚ç‚¹ä¸‹å¯ä»¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹</p><ul><li><p>èŠ‚ç‚¹çš„åº¦æ•°ï¼šèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ï¼›æ ‘çš„åº¦æ•°ï¼šæœ€å¤§åº¦æ•°</p></li><li><p>ä¸€ä¸ªNé˜¶ï¼ˆåº¦æ•°ä¸ºNï¼‰çš„B-Treeçš„èŠ‚ç‚¹æœ€å¤šå¯ä»¥æœ‰N-1ä¸ªKeyï¼ŒNä¸ªæŒ‡é’ˆ</p><p><img src="/img/sql_img/B-Tree%E7%BB%93%E6%9E%84.png"></p></li><li><p>æ„å»ºè¿‡ç¨‹ï¼š</p><ul><li><p>æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè¦æ’å…¥çš„èŠ‚ç‚¹è¿˜æ”¾çš„ä¸‹çš„æ—¶å€™æŒ‰é¡ºåºæ”¾å…¥èŠ‚ç‚¹</p></li><li><p>æ”¾ä¸ä¸‹æ—¶ä¸­é—´å…ƒç´ å¾€ä¸Šå±‚ç§»åŠ¨ï¼Œå·¦å³ä¸¤è¾¹åˆ†è£‚æˆä¸¤ä¸ªèŠ‚ç‚¹</p><p><img src="/img/sql_img/B-Tree%E5%88%86%E8%A3%821.png"></p></li><li><p>ä¸Šå±‚ä¹Ÿæ”¾ä¸ä¸‹æ—¶ï¼Œä¸Šå±‚ä¹Ÿåˆ†è£‚</p><p><img src="/img/sql_img/B-Tree%E5%88%86%E8%A3%822.png"></p></li></ul></li></ul></li><li><p><strong>B+Tree</strong>ï¼šå’ŒB-Treeç±»ä¼¼ï¼Œä½†éå¶å­èŠ‚ç‚¹èµ·åˆ°ç´¢å¼•çš„ä½œç”¨ï¼Œæ•°æ®éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼Œå¶å­ç»“ç‚¹å½¢æˆä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong></p><p><img src="/img/sql_img/B+Tree%E7%BB%93%E6%9E%84.png"></p><ul><li>MySQLå’Œåœ¨ç»å…¸B+Treeä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ª<strong>åŒå‘å¾ªç¯é“¾è¡¨</strong>ï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½</li></ul></li><li><p>Hashï¼šé‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼è½¬æ¢ä¸ºæ–°çš„hashå€¼ï¼Œå­˜å‚¨åˆ°hashè¡¨ä¸­</p></li></ul><blockquote><p>InnoDBä½¿ç”¨B+Treeçš„åŸå› ï¼šç›¸å¯¹äºŒå‰æ ‘å±‚çº§æ›´å°‘ï¼›ç›¸å¯¹äºB-Treeï¼Œéå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®ï¼Œèƒ½å¤Ÿæ”¾çš„keyæ›´å¤šï¼Œå±‚çº§ä¹Ÿå°±æ›´å°‘ï¼›ç›¸å¯¹äºHashï¼Œèƒ½æ”¯æŒèŒƒå›´åŒ¹é…å’Œæ’åºã€‚</p></blockquote><h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><p>æ ¹æ®å­—æ®µç‰¹æ€§åˆ†ç±»</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª</td><td>PRIMARY</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…å€¼é‡å¤</td><td>å¯æœ‰å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¯æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>é€šè¿‡æ–‡æœ¬ä¸­çš„å…³é”®å­—æŸ¥æ‰¾</td><td>å¯æœ‰å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table><p> åœ¨InnoDBä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œå¯ä»¥åˆ†ä¸º</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšç°‡ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œå¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>æœ‰ä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•(Secondary Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œå¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥å­˜åœ¨å¤šä¸ª</td></tr></tbody></table><blockquote><p>èµ°äºŒçº§ç´¢å¼•éœ€è¦é€šè¿‡æŸ¥åˆ°çš„ä¸»é”®å›è¡¨æŸ¥è¯¢</p></blockquote><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><ul><li><p>åˆ›å»ºç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE [UNIQUE|FULLTEXT] INDEX index_name ON table_name(index_col_name, ...);<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW INDEX FROM table_name;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP INDEX index_name ON table_name;<br></code></pre></td></tr></table></figure></li></ul><h4 id="SQLæ€§èƒ½åˆ†æ"><a href="#SQLæ€§èƒ½åˆ†æ" class="headerlink" title="SQLæ€§èƒ½åˆ†æ"></a>SQLæ€§èƒ½åˆ†æ</h4><p><strong>æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰§è¡Œé¢‘ç‡</strong></p><blockquote><p>æŸ¥è¯¢é¢‘ç‡é«˜çš„æ•°æ®åº“éœ€è¦ä¼˜åŒ–</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW GLOBAL STATUS LIKE &#x27;com_______&#x27;;<br></code></pre></td></tr></table></figure><p><img src="/img/sql_img/%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A7%E8%A1%8C%E9%A2%91%E7%8E%87.png"></p><p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong></p><p>è®°å½•äº†æ‰€æœ‰æŒ‡å®šæ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—</p><ul><li><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯æ—¥å¿—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW VARIABLES LIKE &#x27;slow_query_log&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>å¼€å¯æ—¥å¿—(windowsä¸‹)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä¿®æ”¹MySQLç›®å½•ä¸‹çš„my.ini<br>slow-query-log=1<br>long_query_time=10<br></code></pre></td></tr></table></figure></li><li><p>æ—¥å¿—ä¿å­˜åœ¨Dataç›®å½•ä¸‹çš„<code>xxx-slow.log</code>ä¸‹</p></li></ul><p><strong>profile</strong></p><p>æŸ¥çœ‹æ¯ä¸€æ¡sqlçš„è€—æ—¶æƒ…å†µ</p><ul><li><p>æŸ¥çœ‹ã€å¼€å¯profile</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT @@have_profiling;<br>SET have_profiling = 1;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ¯ä¸€æ¡SQLçš„è€—æ—¶è¿›æœ¬æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW PROFILES;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æŒ‡å®šquery_idçš„SQLè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW profile for query_id;<br></code></pre></td></tr></table></figure></li></ul><p><strong>explain</strong></p><ul><li>åœ¨selectä¹‹å‰åŠ ä¸Šexplain</li></ul><p></p><p><img src="/img/sql_img/explain.png"></p><p>å­—æ®µå«ä¹‰ï¼š</p><ol><li>idï¼šè¡¨ç¤ºæ‰§è¡Œé¡ºåºï¼Œç›¸åŒçš„ä»ä¸Šåˆ°ä¸‹ï¼Œä¸åŒçš„å€¼å¤§çš„å…ˆæ‰§è¡Œ</li><li>type:è¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ä¸Šä»é«˜åˆ°ä½<ul><li>NULL </li><li>system </li><li>constï¼šç»“æœåªæœ‰ä¸€æ¡</li><li>eq_refï¼šå”¯ä¸€ç´¢å¼•æ‰«æ</li><li>refï¼šéå”¯ä¸€ç´¢å¼•æ‰«æ</li><li>rangeï¼šç´¢å¼•èŒƒå›´æ‰«æ</li><li>indexï¼šå…¨ç´¢å¼•æ‰«æ</li><li>allï¼šå…¨è¡¨æ‰«æ</li></ul></li><li>possible_keysï¼šå­—æ®µè¡¨ç¤ºå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ï¼›</li><li>keyï¼šå®é™…ç”¨åˆ°çš„ç´¢å¼•</li><li>key_lenï¼šç´¢å¼•é•¿åº¦</li><li>rowsï¼šæ‰«æçš„æ•°æ®è¡Œæ•°</li><li>filteredï¼šè¿”å›ç»“æœçš„è¡Œæ•°å è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œè¶Šå¤§è¶Šå¥½</li></ol><h4 id="ä½¿ç”¨è§„åˆ™"><a href="#ä½¿ç”¨è§„åˆ™" class="headerlink" title="ä½¿ç”¨è§„åˆ™"></a>ä½¿ç”¨è§„åˆ™</h4><ul><li><p><strong>æœ€å·¦å‰ç¼€æ³•åˆ™</strong>ï¼šè”åˆç´¢å¼•ä»æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚æœ€å·¦è¾¹çš„åˆ—å¿…é¡»æœ‰æ‰èµ°ç´¢å¼•ï¼Œå¦‚æœä¸­é—´æœ‰åˆ—ä¸å­˜åœ¨ï¼Œåˆ™åé¢çš„ç´¢å¼•å¤±æ•ˆã€‚åˆ›å»ºè”åˆç´¢å¼•æ—¶è¦è€ƒè™‘é¡ºåº</p></li><li><p><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šè”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°<code>&gt;</code>ã€<code>&lt;</code>èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œä¹‹åçš„ç´¢å¼•ä¼šå¤±æ•ˆï¼Œ<code>&gt;=</code>ã€<code>&lt;=</code>ä¸ä¼šå¤±æ•ˆ</p></li><li><p><strong>ç´¢å¼•å¤±æ•ˆæƒ…å†µ</strong>ï¼š</p><ol><li>ä½¿ç”¨<code>&gt;</code>&#x2F;<code>&lt;</code>èŒƒå›´æŸ¥è¯¢ï¼ˆ<code>&gt;=</code>ã€<code>&lt;=</code>ã€<code>BETWEEN AND</code>ä»å¯ä»¥ä½¿ç”¨åˆ°ç´¢å¼•ï¼‰</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ</li><li>å­—ç¬¦ä¸²ä¸åŠ å¼•å·ï¼Œå­˜åœ¨éšå¼ç±»å‹è½¬æ¢</li><li>åœ¨å¤´éƒ¨è¿›è¡Œæ¨¡ç³ŠåŒ¹é…</li><li>orè¿æ¥çš„æ¡ä»¶ä¸­æœ‰æ²¡æœ‰ç´¢å¼•çš„åˆ—æ—¶ï¼Œä¸ç®¡æœ‰å¤šå°‘ç´¢å¼•ï¼Œéƒ½å¿…é¡»å…¨è¡¨æ‰«ææœç´¢è¿™ä¸ªæ²¡æœ‰ç´¢å¼•çš„åˆ—</li><li>MySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•</li></ol></li><li><p><strong>SQLæç¤º</strong>ï¼š</p><ol><li><p>use indexï¼šæç¤ºä¼˜åŒ–å™¨<strong>å»ºè®®</strong>ä½¿ç”¨å“ªä¸ªç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">explain select * from tb_user use index(idx_user_pro) where profession = &#x27;è½¯ä»¶å·¥ç¨‹&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>ignore indexï¼šæç¤ºä¼˜åŒ–å™¨ä¸ä½¿ç”¨å“ªä¸ªç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">explain select * from tb_user ignore index(idx_user_pro) where profession = &#x27;è½¯ä»¶å·¥ç¨‹&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>force indexï¼šæç¤ºä¼˜åŒ–å™¨<strong>å¿…é¡»</strong>ä½¿ç”¨å“ªä¸ªç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">explain select * from tb_user force index(idx_user_pro) where profession = &#x27;è½¯ä»¶å·¥ç¨‹&#x27;;<br></code></pre></td></tr></table></figure></li></ol></li><li><p><strong>è¦†ç›–ç´¢å¼•</strong></p><p>æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—åœ¨ç´¢å¼•ä¸­å·²ç»èƒ½å…¨éƒ¨æ‰¾åˆ°ï¼Œå°±ä¸éœ€è¦å†å›è¡¨æŸ¥è¯¢ã€‚</p><p>å¦‚ç»™idå’Œnameå»ºç«‹äº†ç´¢å¼•ï¼Œé‚£<code>select id,name</code>æ—¶å°±ä¸éœ€è¦å›è¡¨æŸ¥è¯¢</p><blockquote><p>å°½é‡å°‘ä½¿ç”¨select *ï¼Œå› ä¸ºå®¹æ˜“å›è¡¨æŸ¥è¯¢</p></blockquote></li><li><p><strong>å‰ç¼€ç´¢å¼•</strong></p><p>æ ¹æ®å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€å»ºç«‹ç´¢å¼•ï¼Œé€‚åˆå¤§æ–‡æœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE INDEX idx_xxx ON table_name(column(n));<br></code></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡<code>count(distinct substring(column, m, n))/count(*)</code>æ¥åˆ¤æ–­é€‚ä¸é€‚åˆå»ºç«‹å‰ç¼€ç´¢å¼•ï¼Œå€¼è¶Šå¤§è¶Šå¥½ã€‚</p></li></ul><h4 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h4><ol><li>æ•°æ®é‡å¤§ï¼ˆ&gt;100wï¼‰</li><li>é’ˆå¯¹å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶(Where)ã€æ’åº(Order By)ã€åˆ†ç»„(Group By)çš„å­—æ®µ</li><li>ç´¢å¼•æŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ’åœ¨å‰é¢</li><li>è¾ƒé•¿çš„å­—ç¬¦ä¸²å­—æ®µå»ºç«‹è”åˆç´¢å¼•</li><li>å°½é‡å»ºç«‹è”åˆç´¢å¼•</li><li>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡</li></ol><h3 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h3><h4 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h4><ol><li><p>æ‰¹é‡æ’å…¥ï¼Œä¸è¦ä¸€æ¡ä¸€æ¡æ’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into tb_test valies(1, &#x27;Tome&#x27;), ...;<br></code></pre></td></tr></table></figure></li><li><p>æ‰‹åŠ¨æäº¤äº‹åŠ¡ï¼Œé»˜è®¤æ˜¯æ‰§è¡Œä¸€æ¬¡insertæäº¤ä¸€æ¬¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">start transaction;<br>insert ...<br>commit;<br></code></pre></td></tr></table></figure></li><li><p>ä¸»é”®é¡ºåºæ’å…¥æ€§èƒ½é«˜äºä¹±åº</p></li><li><p>å¤§æ‰¹é‡æ’å…¥æ•°æ®æ—¶ç”¨load</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° --local-infile<br>mysql --local-infile -uroot -p<br># è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³<br>set global local_infile=1;<br># æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®å¯¼å…¥ï¼Œè®¾ç½®å­—æ®µé—´åˆ†éš”ç¬¦ä¸º&#x27;,&#x27;ï¼Œæ•°æ®é—´åˆ†éš”ç¬¦ä¸º&#x27;\n&#x27;<br>load data local infile &#x27;æ–‡ä»¶è·¯å¾„.sql&#x27; into table `è¡¨å` fileds teminatedby &#x27;,&#x27; lines teminatedby by &#x27;\n&#x27;;<br></code></pre></td></tr></table></figure></li></ol><h4 id="ä¸»é”®"><a href="#ä¸»é”®" class="headerlink" title="ä¸»é”®"></a>ä¸»é”®</h4><ol><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦</li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDæˆ–å…¶ä»–éšæœºçš„ä¸»é”®ï¼Œä¼šé€ æˆé¡µåˆ†è£‚</li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹</li></ol><h4 id="æ’åº-x2F-åˆ†ç»„"><a href="#æ’åº-x2F-åˆ†ç»„" class="headerlink" title="æ’åº&#x2F;åˆ†ç»„"></a>æ’åº&#x2F;åˆ†ç»„</h4><p>æ’åºï¼š</p><p>â€‹Using filesortï¼šé€šè¿‡ç´¢å¼•æˆ–å…¨è¡¨æ‰«ææŸ¥æ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œåœ¨ç¼“å†²åŒºé‡Œæ’åº</p><p>â€‹Using indexï¼šé€šè¿‡ç´¢å¼•æŸ¥æ‰¾å‡ºçš„æ•°æ®ç›´æ¥å°±æ˜¯æœ‰åºçš„ï¼Œæ•ˆç‡é«˜</p><p>â€‹åˆ›å»ºè”åˆç´¢å¼•åï¼Œå¦‚æœéƒ½æŒ‰å‡åºæˆ–é™åºæ’åºéƒ½æ˜¯Using indexï¼Œå¦‚æœä¸ä¸€æ ·å°±ä¼šUsing filesort</p><p>â€‹å¯ä»¥åˆ›å»ºè”åˆç´¢å¼•æ—¶æŒ‡å®šæ’åºæ–¹å¼æ¥ä¼˜åŒ–</p><p>åˆ†ç»„ï¼š</p><p>â€‹åˆ†ç»„æ—¶å¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡</p><p>â€‹åˆ†ç»„æ—¶ç´¢å¼•çš„1ä½¿ç”¨ä¹Ÿæ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™</p><h4 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h4><p>é—®é¢˜ï¼š</p><p>â€‹<code>order by id limit 200000, 10</code>éœ€è¦æŸ¥å‡ºå‰200010æ¡æ•°æ®æ’åºåè¿”å›å10æ¡è®°å½•ï¼Œå…¶ä»–æ•°æ®ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§</p><p>è§£å†³æ–¹å¼ï¼š</p><p>â€‹ä½¿ç”¨å»¶è¿Ÿå…³è”çš„æ–¹å¼ï¼šä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>s.* <br>FROM <br>tb_sku s, (SLECT id FROM tb_sku ORDER BY id LIMIT 200000, 10) a <br>WHERE<br>s.id = a.id;<br></code></pre></td></tr></table></figure><p>â€‹å¦‚æœç›´æ¥åˆ†é¡µæŸ¥è¯¢ï¼Œé‚£ä¹ˆæŸ¥åˆ°idåéƒ½è¦å›è¡¨æŸ¥è¯¢ï¼Œæ•ˆç‡å¾ˆä½ï¼›è€Œå­æŸ¥è¯¢é‡Œåˆ†é¡µçš„è¯ï¼Œå› ä¸ºäºŒçº§ç´¢å¼•é‡Œæœ‰idäº†ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œå‡å°‘äº†å›è¡¨æŸ¥è¯¢çš„æ¬¡æ•°</p><h4 id="è®¡æ•°"><a href="#è®¡æ•°" class="headerlink" title="è®¡æ•°"></a>è®¡æ•°</h4><p>ç”¨æ³•ï¼š</p><ol><li>*<em>count(</em>)**ï¼šè¿”å›æ•°æ®è¡Œæ•°   ï¼ˆæ€§èƒ½æœ€é«˜ï¼Œä¼˜åŒ–å™¨åšäº†ä¼˜åŒ–ï¼Œä¸ä¼šæŠŠå€¼å–å‡ºæ¥ï¼‰</li><li>count(ä¸»é”®)ï¼šè¿”å›éç©ºçš„ä¸»é”®æ•°</li><li>count(æŸä¸ªå­—æ®µ)ï¼šè¿”å›éç©ºçš„å­—æ®µæ•°</li><li>count(1)ï¼šå½“åšæ¯è¡Œéƒ½æ˜¯1ï¼Œè®°å½•æ•°æ®è¡Œæ•°</li></ol><h4 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h4><p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹çš„ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä»è¡Œé”å‡çº§ä¸ºè¡¨é”</p><p>æ‰€ä»¥æ›´æ–°æ¡ä»¶æœ‰ç´¢å¼•ä¸ºè¡Œé”ï¼Œæ²¡æœ‰ç´¢å¼•ä¸ºè¡¨é”</p><h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><blockquote><p>è§†å›¾æ˜¯å¼ è™šè¡¨ï¼Œä¸ä¿å­˜æŸ¥è¯¢ç»“æœï¼Œåªä¿å­˜äº†æŸ¥è¯¢çš„SQLé€»è¾‘</p></blockquote><h4 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><ol><li><p>åˆ›å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE [OR REPLACE] VIEW è§†å›¾å AS SELECT åˆ— FROM åŸºè¡¨ [WHERE...];<br><br># æ£€æŸ¥é€‰é¡¹ï¼šå¯¹å¢åˆ æ”¹è¿›è¡Œçº¦æŸ<br># åé¢åŠ  WITH [CASCADED | LOCAL] CHECK OPTION<br># å¦‚æœæ˜¯æ ¹æ®è§†å›¾åˆ›å»ºçš„è§†å›¾<br># CASCADEDä¼šæ£€æŸ¥çˆ¶è§†å›¾çš„æ¡ä»¶ï¼Œä¸ç®¡çˆ¶è§†å›¾æœ‰æ²¡æœ‰åŠ CHECK OPTION<br># LOCALåªä¼šæ£€æŸ¥åŠ äº†CHECK OPTIONçš„çˆ¶è§†å›¾çš„æ¡ä»¶<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># æŸ¥è¯¢åˆ›å»ºè§†å›¾çš„è¯­å¥<br>SHOW CREATE VIEW è§†å›¾å;<br># æŸ¥è¯¢è§†å›¾æ•°æ®<br>SELECT * FROM è§†å›¾å ...;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ALTER VIEW è§†å›¾å AS SELECT...;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP VIEW è§†å›¾å;<br></code></pre></td></tr></table></figure></li><li><p>æ’å…¥ã€æ›´æ–°æ•°æ®</p><p>åªæœ‰è§†å›¾çš„åˆ—å’ŒåŸºè¡¨çš„åˆ—ç›¸åŒæ—¶æ‰èƒ½æ›´æ–°</p></li></ol><h3 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h3><blockquote><p>å¤šæ¡sqlçš„é›†åˆ</p></blockquote><h4 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><ul><li><p>åˆ›å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE PROCEDURE åç§°(å‚æ•°)<br>BEGIN<br>-- SQLè¯­å¥<br>END;<br></code></pre></td></tr></table></figure></li><li><p>è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CALL åç§°(å‚æ•°);<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SHOW CREATE PROCEDURE åç§°;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP PROCEDURE åç§°;<br></code></pre></td></tr></table></figure></li><li><p>å£°æ˜å±€éƒ¨å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create procedure p1()<br>begin<br># å£°æ˜å˜é‡<br>declare stu_count int default 0;<br>    # ç¬¬ä¸€ç§èµ‹å€¼æ–¹å¼<br>set stu_count := 10;<br># ç¬¬äºŒç§èµ‹å€¼æ–¹å¼<br>select count(*) into stu_count from student;<br># æŸ¥çœ‹<br>select stu_count;<br>end;<br></code></pre></td></tr></table></figure></li><li><p>IF</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">IF æ¡ä»¶1 THEN<br>...<br>ELSEIF æ¡ä»¶2 THEN<br>...<br>ELSE<br>...<br>END IF;<br></code></pre></td></tr></table></figure></li><li><p>å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- å‚æ•°ç±»å‹<br>-- IN ä¼ å…¥çš„å‚æ•°ï¼ˆé»˜è®¤ï¼‰<br>-- OUT è¾“å‡ºçš„å‚æ•°<br>-- INOUT å¯è¾“å…¥å¯è¾“å‡ºçš„å‚æ•°<br>create procedure p(in score int, out res varchar(10))<br>begin<br>if score &gt;= 85 then<br>set res := &#x27;ä¼˜ç§€&#x27;;<br>elseif score &gt;= 60 then<br>set res := &#x27;åŠæ ¼&#x27;;<br>else<br>set res := &#x27;ä¸åŠæ ¼&#x27;;<br>end if;<br>end;<br><br>-- è°ƒç”¨<br>call p(68, @res);<br>select @res;<br><br><br>-- inout<br>create procedure p2(inout score double)<br>begin<br>set score := score * 0.5;<br>end;<br><br>set @score = 78;<br>call p2(@score);<br>select @score;<br></code></pre></td></tr></table></figure></li><li><p>CASE</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CASE<br>WHEN æ¡ä»¶ THEN:<br>...<br>WHEN æ¡ä»¶ THEN:<br>...<br>ELSE<br>...<br>END CASE;<br></code></pre></td></tr></table></figure></li><li><p>WHILEï¼šæ»¡è¶³æ¡ä»¶ç»§ç»­å¾ªç¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">create procedure p(in n int)<br>begin<br>declare total int default 0;<br>while n &gt; 0 do<br>set total := total + n;<br>set n := n - 1;<br>end while;<br>select total;<br>end;<br></code></pre></td></tr></table></figure></li><li><p>REPEATï¼šæ»¡è¶³æ¡ä»¶é€€å‡ºå¾ªç¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- æ»¡è¶³æ¡ä»¶åé€€å‡ºå¾ªç¯<br>create procedure p(in n int)<br>begin<br>declare total int default 0;<br>repeat<br>set total := total + n;<br>set n ;= n - 1;<br>until n &lt;= 0<br>end repeat;<br><br>select total;<br>end;<br></code></pre></td></tr></table></figure></li></ul><h3 id="å­˜å‚¨å‡½æ•°"><a href="#å­˜å‚¨å‡½æ•°" class="headerlink" title="å­˜å‚¨å‡½æ•°"></a>å­˜å‚¨å‡½æ•°</h3><blockquote><p>å­˜å‚¨å‡½æ•°æ˜¯æœ‰è¿”å›å€¼çš„å­˜å‚¨è¿‡ç¨‹ï¼Œå‚æ•°åªèƒ½æ˜¯INç±»å‹çš„</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE FUNCTION åç§°(å‚æ•°)<br>RETURNS è¿”å›å€¼ç±»å‹ [characteristic...]<br>BEGIN<br>...<br>RETURN è¿”å›å€¼;<br>END;<br><br>characteristicè¯´æ˜ï¼š<br>DETERMINSTICï¼šç›¸åŒçš„è¾“å…¥å‚æ•°æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœ<br>NO SQLï¼šä¸åŒ…å«SQLè¯­å¥<br>READS SQL DATAï¼šåŒ…å«è¯»å–æ•°æ®çš„è¯­å¥ï¼Œä½†ä¸åŒ…å«å†™å…¥æ•°æ®çš„è¯­å¥<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- è°ƒç”¨<br>å‡½æ•°å(å‚æ•°);<br></code></pre></td></tr></table></figure><h3 id="è§¦å‘å™¨"><a href="#è§¦å‘å™¨" class="headerlink" title="è§¦å‘å™¨"></a>è§¦å‘å™¨</h3><blockquote><p>åœ¨å¢åˆ æ”¹ä¹‹å‰æˆ–ä¹‹åï¼Œè§¦å‘å¹¶æ‰§è¡Œè§¦å‘å™¨é‡Œçš„SQLï¼Œå¯ç”¨äºè®°å½•æ—¥å¿—ã€æ•°æ®æ ¡éªŒç­‰</p><p>è§¦å‘å™¨åªæ”¯æŒè¡Œçº§è§¦å‘ï¼ˆå³ä¿®æ”¹ä¸€è¡Œæ—¶è§¦å‘ä¸€æ¬¡ï¼‰ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘</p></blockquote><h4 id="è¯­æ³•-3"><a href="#è¯­æ³•-3" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><blockquote><p>NEWè¡¨ç¤ºæ›´æ–°ä¹‹åçš„æ•°æ®ï¼ŒOLDè¡¨ç¤ºæ›´æ–°ä¹‹å‰çš„æ•°æ®</p><p>å¯ä»¥é€‰æ‹© BEFORE&#x2F;AFTER   INSERT&#x2F;UPDATE&#x2F;DELETE</p></blockquote><p>ä¾‹å­</p><ul><li><p>åˆ›å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- é€šè¿‡è§¦å‘å™¨è®°å½•userè¡¨çš„å˜æ›´åˆ°user_logè¡¨ä¸­<br>create table user_logs(<br>    id int(11) not null auto_increment,<br>    operation varchar(20) comment &#x27;æ“ä½œç±»å‹&#x27;,<br>    operation_time datetime comment &#x27;æ“ä½œæ—¶é—´&#x27;,<br>    operation_id int(11) comment &#x27;æ“ä½œid&#x27;,<br>    operation_params varchar(500) comment &#x27;æ“ä½œå‚æ•°&#x27;,<br>    primary key(&#x27;id&#x27;)<br>);<br><br><br>CREATE TRIGGER tb_user_insert_trigger<br>AFTER INSERT ON tb_user for each row<br>BEGIN<br>insert into user_logs VALUES<br>(null, &#x27;insert&#x27;, now(), NEW.id, concat(&#x27;æ’å…¥çš„æ•°æ®å†…å®¹ä¸ºï¼šid=&#x27;, NEW.id, &#x27;name=&#x27;, NEW.name));<br>END;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„è§¦å‘å™¨<br>show triggers;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DROP TRIGGER tb_user_insert_trigger;<br></code></pre></td></tr></table></figure></li></ul><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><h4 id="åˆ†ç±»-1"><a href="#åˆ†ç±»-1" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><p>æŒ‰ç²’åº¦åˆ†</p><ol><li>å…¨å±€é”ï¼šé”å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨</li><li>è¡¨çº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨</li><li>è¡Œçº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®</li></ol><h4 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h4><blockquote><p>å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼ŒåŠ é”åæ•´ä¸ªå®ä¾‹å°±å¤„äºåªè¯»çŠ¶æ€ï¼Œåç»­çš„DMLã€DDLå’Œäº‹åŠ¡æäº¤è¯­å¥éƒ½ä¼šè¢«<strong>é˜»å¡</strong></p></blockquote><p>ä½¿ç”¨åœºæ™¯ï¼šå…¨åº“çš„é€»è¾‘å¤‡ä»½ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- æ·»åŠ å…¨å±€é”<br>flush tables with read lock;<br>-- æ•°æ®å¤‡ä»½ï¼Œåœ¨cmdçª—å£æ‰§è¡Œ<br>mysqldump -uç”¨æˆ·å -på¯†ç  æ•°æ®åº“å&gt;è·¯å¾„.sql<br>-- è§£é”<br>unlock tables;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- å¯ä»¥åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹å®ç°å¤‡ä»½ï¼Œé€šè¿‡å¿«ç…§å®ç°<br>mysqldump --single-transaction -uç”¨æˆ·å -på¯†ç  æ•°æ®åº“å&gt;è·¯å¾„.sql<br></code></pre></td></tr></table></figure><h4 id="è¡¨çº§é”"><a href="#è¡¨çº§é”" class="headerlink" title="è¡¨çº§é”"></a>è¡¨çº§é”</h4><p>è¡¨çº§é”ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p><ol><li><strong>è¡¨é”</strong><ul><li>å…±äº«é”</li><li>å†™é”</li></ul></li><li><strong>å…ƒæ•°æ®é”</strong>ï¼ˆmeta data lockï¼‰</li><li><strong>æ„å‘é”</strong></li></ol><h5 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h5><p>è¯­æ³•</p><ul><li><p>åŠ é”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">lock tables è¡¨å... read/write;<br></code></pre></td></tr></table></figure></li><li><p>é‡Šæ”¾é”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">unlock tables;<br></code></pre></td></tr></table></figure></li></ul><h5 id="å…ƒæ•°æ®é”"><a href="#å…ƒæ•°æ®é”" class="headerlink" title="å…ƒæ•°æ®é”"></a>å…ƒæ•°æ®é”</h5><p>æ˜¯ç»™<strong>è¡¨ç»“æ„</strong>è‡ªåŠ¨åŠ çš„é”ï¼Œåœ¨å¢åˆ æ”¹æŸ¥æ—¶åŠ MDLè¯»é”ï¼Œåœ¨ä¿®æ”¹è¡¨ç»“æ„æ—¶åŠ MDLå†™é”</p><h5 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h5><p>å½“è¦åŠ è¡¨é”çš„æ—¶å€™ï¼Œéœ€è¦å»æŸ¥çœ‹æ˜¯å¦åŠ äº†è¡Œé”ï¼Œä¸€è¡Œè¡ŒæŸ¥æ•ˆç‡å¤ªä½</p><p>æ„å‘é”å°±æ˜¯ä¸ºäº†æé«˜æ€§èƒ½çš„</p><p>åœ¨åŠ è¡Œé”çš„æ—¶å€™ä¼šåŠ ä¸Šæ„å‘é”ï¼Œå…¶ä»–çº¿ç¨‹åŠ è¡¨é”çš„æ—¶å€™å°±ä¸ç”¨ä¸€è¡Œè¡Œåˆ¤æ–­äº†</p><p><strong>æ„å‘å…±äº«é”</strong>ï¼šå’Œè¡¨é”å…±äº«é”å…¼å®¹</p><p><strong>æ„å‘æ’ä»–é”</strong>ï¼šå’Œè¡¨é”å…±äº«é”å’Œæ’ä»–é”éƒ½ä¸å…¼å®¹</p><h4 id="è¡Œçº§é”"><a href="#è¡Œçº§é”" class="headerlink" title="è¡Œçº§é”"></a>è¡Œçº§é”</h4><p>æ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ï¼Œç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦æœ€é«˜ï¼Œæ˜¯å¯¹ç´¢å¼•åŠ çš„é”</p><h5 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h5><p>å¢åˆ æ”¹æ—¶è‡ªåŠ¨åŠ è¡Œçº§æ’ä»–é”</p><p>SELECT ä¸åŠ é”</p><p>SELECT â€¦ LOCK IN SHARE MODE åŠ å…±äº«é”</p><p>SELECT â€¦ FOR UPDATE åŠ æ’ä»–é”</p><h5 id="è®°å½•é”-x2F-é—´éš™é”-x2F-ä¸´é”®é”"><a href="#è®°å½•é”-x2F-é—´éš™é”-x2F-ä¸´é”®é”" class="headerlink" title="è®°å½•é”&#x2F;é—´éš™é”&#x2F;ä¸´é”®é”"></a>è®°å½•é”&#x2F;é—´éš™é”&#x2F;ä¸´é”®é”</h5><p>è®°å½•é”ï¼šé”ä½å½“å‰è®°å½•</p><p><strong>é—´éš™é”</strong>ï¼šæŠŠä¸¤ä¸ªç´¢å¼•ä¹‹é—´ä¸å­˜åœ¨çš„ç´¢å¼•é”ä½ï¼Œé”ä½åæ’å…¥è¯­å¥ä¼šè¢«é˜»å¡ï¼Œ<strong>é˜²æ­¢å¹»è¯»</strong></p><p>ä¸´é”®é”ï¼šè®°å½•é”+é—´éš™é”ï¼Œå·¦å¼€å³é—­</p><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><ol><li><p>åœ¨ MySQL çš„å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œé’ˆå¯¹å½“å‰è¯»çš„è¯­å¥ä¼šå¯¹<strong>ç´¢å¼•</strong>åŠ è®°å½•é”+é—´éš™é”ï¼Œè¿™æ ·å¯ä»¥é¿å…å…¶ä»–äº‹åŠ¡æ‰§è¡Œå¢ã€åˆ ã€æ”¹æ—¶å¯¼è‡´å¹»è¯»çš„é—®é¢˜</p></li><li><p>é”é€€åŒ–çš„æƒ…å†µ</p></li></ol><ul><li>ç­‰å€¼æŸ¥è¯¢<ul><li>å”¯ä¸€ç´¢å¼•ï¼šè®°å½•å­˜åœ¨æ—¶é€€åŒ–æˆè®°å½•é”ï¼Œä¸å­˜åœ¨æ—¶é€€åŒ–æˆé—´éš™é”</li><li>éå”¯ä¸€ç´¢å¼•ï¼šå¯¹ç¬¬ä¸€ä¸ªä¸ç¬¦åˆè¦æ±‚çš„è®°å½•é€€åŒ–æˆé—´éš™é”</li></ul></li><li>èŒƒå›´æŸ¥è¯¢<ul><li>å”¯ä¸€ç´¢å¼•åœ¨æ»¡è¶³ä¸€äº›æ¡ä»¶çš„æ—¶å€™ï¼Œç´¢å¼•çš„ next-key lock é€€åŒ–ä¸ºé—´éš™é”æˆ–è€…è®°å½•é”ã€‚</li><li>éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œç´¢å¼•çš„ next-key lock ä¸ä¼šé€€åŒ–ä¸ºé—´éš™é”å’Œè®°å½•é”ã€‚</li></ul></li></ul><ol start="3"><li>åœ¨æ‰§è¡Œ updateã€deleteã€select â€¦ for update ç­‰å…·æœ‰åŠ é”æ€§è´¨çš„è¯­å¥ï¼Œä¸€å®šè¦æ£€æŸ¥è¯­å¥æ˜¯å¦èµ°äº†ç´¢å¼•ï¼Œå¦‚æœæ˜¯å…¨è¡¨æ‰«æçš„è¯ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªç´¢å¼•åŠ  next-key é”ï¼Œç›¸å½“äºæŠŠæ•´ä¸ªè¡¨é”ä½äº†</li></ol><h3 id="InnoDBå¼•æ“"><a href="#InnoDBå¼•æ“" class="headerlink" title="InnoDBå¼•æ“"></a>InnoDBå¼•æ“</h3><h4 id="é€»è¾‘å­˜å‚¨ç»“æ„"><a href="#é€»è¾‘å­˜å‚¨ç»“æ„" class="headerlink" title="é€»è¾‘å­˜å‚¨ç»“æ„"></a>é€»è¾‘å­˜å‚¨ç»“æ„</h4><p><img src="/img/sql_img/%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png"></p><ul><li>è¡¨ç©ºé—´(ibdæ–‡ä»¶)ï¼šä¸€ä¸ªmysqlå®ä¾‹(database)å¯¹åº”å¤šä¸ªè¡¨ç©ºé—´ï¼Œç”¨äºå­˜å‚¨è®°å½•ã€ç´¢å¼•ç­‰æ•°æ®</li><li>æ®µï¼šæ•°æ®æ®µæ˜¯B+æ•°çš„å¶å­ç»“ç‚¹ï¼Œç´¢å¼•æ®µæ˜¯B+æ•°çš„éå¶å­èŠ‚ç‚¹</li><li>åŒºï¼šå¤§å°ä¸º1M</li><li>é¡µï¼šå¤§å°ä¸º16kï¼Œå­˜å‚¨å¼•æ“ç®¡ç†çš„æœ€å°å•ä½</li><li>è¡Œï¼šæ•°æ®æ˜¯æŒ‰è¡Œå­˜æ”¾çš„</li></ul><h4 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h4><h5 id="å†…å­˜æ¶æ„"><a href="#å†…å­˜æ¶æ„" class="headerlink" title="å†…å­˜æ¶æ„"></a>å†…å­˜æ¶æ„</h5><p><img src="/img/sql_img/%E5%86%85%E5%AD%98%E6%9E%B6%E6%9E%84.png"></p><ul><li><p><strong>Buffer Pool</strong>ï¼ˆç¼“å†²æ± ï¼‰ï¼šç¼“å­˜ç£ç›˜ä¸­ç»å¸¸æ“ä½œçš„çœŸå®æ•°æ®ï¼ŒæŒ‰ä¸€å®šé¢‘ç‡åˆ·å›ç£ç›˜ï¼Œå‡å°‘ç£ç›˜IO</p><ul><li><p>ç¼“å†²æ± ä»¥<strong>é¡µ</strong>ä¸ºå•ä½</p><p>free pageï¼šæœªä½¿ç”¨çš„é¡µ</p><p>clean pageï¼šè¢«ä½¿ç”¨çš„é¡µï¼Œæ•°æ®æ²¡æœ‰è¢«ä¿®æ”¹è¿‡</p><p>dirty pageï¼šè¢«ä½¿ç”¨çš„é¡µï¼Œæ•°æ®è¢«ä¿®æ”¹è¿‡</p></li></ul></li><li><p><strong>Change Buffer</strong>ï¼ˆæ›´æ”¹ç¼“å†²æ± ï¼‰ï¼šé’ˆå¯¹éå”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œå¦‚æœè¦æ›´æ”¹çš„æ•°æ®ä¸åœ¨ç¼“å­˜æ± ä¸­ï¼Œåˆ™ä¼šå…ˆå°†æ•°æ®ä¿å­˜åœ¨change bufferä¸­ï¼Œç­‰å°†æ¥è¯»å–æ—¶æ•°æ®è¢«åŠ è½½åˆ°ç¼“å†²æ± åï¼Œå†è¿›è¡Œåˆå¹¶ï¼Œå‡å°‘å› ä¸ºè°ƒæ•´ç´¢å¼•æ ‘é€ æˆçš„ç£ç›˜IO</p></li><li><p><strong>Log Buffer</strong>ï¼ˆæ—¥å¿—ç¼“å†²åŒºï¼‰ï¼šä¿å­˜è¦å†™å…¥ç£ç›˜çš„æ—¥å¿—æ•°æ®ï¼ˆredo log(é‡åšæ—¥å¿—)ï¼Œundo log(æ’¤é”€æ—¥å¿—)ï¼‰</p></li></ul><h5 id="ç£ç›˜ç»“æ„"><a href="#ç£ç›˜ç»“æ„" class="headerlink" title="ç£ç›˜ç»“æ„"></a>ç£ç›˜ç»“æ„</h5><p><img src="/img/sql_img/%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84.png"></p><h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h4><p><strong>åŸç†</strong></p><p>æŒä¹…æ€§ï¼šé€šè¿‡redo logé‡åšæ—¥å¿—ï¼Œåœ¨ç¼“å†²åŒºåˆ·å›ç£ç›˜çš„æ—¶å€™å‘ç”Ÿé”™è¯¯è¿›è¡Œæ•°æ®æ¢å¤</p><p>åŸå­æ€§ï¼šé€šè¿‡undo logå›æ»šæ—¥å¿—ï¼Œå½“äº‹åŠ¡å¤±è´¥æ—¶è¿›è¡Œå›æ»šï¼ˆä¸€èµ·æˆåŠŸï¼Œä¸€èµ·å¤±è´¥ï¼‰</p><h4 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h4><blockquote><p>Multi-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</p><p>å®ç°è¯»å–æ•°æ®ä¸ç”¨åŠ é”ã€‚å¯ä»¥è®©è¯»å–æ•°æ®åŒæ—¶ä¿®æ”¹ï¼Œä¿®æ”¹æ•°æ®æ—¶åŒæ—¶å¯è¯»å–</p></blockquote><h5 id="è§£å†³å¹¶å‘é€šå¸¸çš„æ–¹æ¡ˆ"><a href="#è§£å†³å¹¶å‘é€šå¸¸çš„æ–¹æ¡ˆ" class="headerlink" title="è§£å†³å¹¶å‘é€šå¸¸çš„æ–¹æ¡ˆ"></a>è§£å†³å¹¶å‘é€šå¸¸çš„æ–¹æ¡ˆ</h5><ol><li>ä½¿ç”¨å…±äº«é”å’Œæ’ä»–é”</li><li>é€šè¿‡å¯¹å¹¶å‘æ•°æ®è¿›è¡Œå¿«ç…§å¤‡ä»½ï¼Œä»è€Œè¾¾åˆ°æ— é”è®¿é—®</li></ol><p>MVCCå°±æ˜¯é€šè¿‡ä¿å­˜æ•°æ®çš„å¤šä¸ªå¿«ç…§ç‰ˆæœ¬ï¼Œé€šè¿‡ç‰ˆæœ¬å·æ¥ç¡®è®¤è¦å±•ç¤ºçš„æ•°æ®</p><h5 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p><strong>å½“å‰è¯»</strong>ï¼šè¯»çš„æ˜¯æœ€æ–°çš„æ•°æ®ï¼ˆä¸å¯é‡å¤è¯»ï¼‰</p><p><strong>å¿«ç…§è¯»</strong>ï¼šæ¯æ¬¡selectéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ï¼Œäº‹åŠ¡é‡Œè¯»çš„æ˜¯ç¬¬ä¸€ä¸ªselectæŸ¥åˆ°çš„æ•°æ®ï¼ˆå¯é‡å¤è¯»ï¼‰</p><p><strong>éšè—å­—æ®µ</strong></p><table><thead><tr><th>éšè—å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>DB_TRX_ID</td><td>è®°å½•æ“ä½œè¯¥æ•°æ®äº‹åŠ¡çš„äº‹åŠ¡ID</td></tr><tr><td>DB_ROLL_PTR</td><td>ç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å›æ»šæ®µçš„undoæ—¥å¿—</td></tr><tr><td>DB_ROW_ID</td><td>éšè—ä¸»é”®ï¼Œæ²¡æœ‰æŒ‡å®šä¸»é”®æ—¶ç”Ÿæˆ</td></tr></tbody></table><p><strong>undo log</strong>ï¼ˆå›æ»šæ—¥å¿—ï¼‰</p><p>ç”¨äº<strong>è®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯</strong>ã€‚åœ¨è¡¨è®°å½•ä¿®æ”¹ä¹‹å‰ï¼Œä¼šå…ˆæŠŠæ•°æ®æ‹·è´åˆ°undo logé‡Œï¼Œå¹¶ä¸”è®°å½•è¿™ä¸ªç‰ˆæœ¬çš„äº‹åŠ¡idï¼Œå¦‚æœäº‹åŠ¡å›æ»šï¼Œå³å¯ä»¥é€šè¿‡undo logæ¥è¿˜åŸæ•°æ®ã€‚</p><p>é€šè¿‡ç‰ˆæœ¬é“¾çš„å½¢å¼è®°å½•æ•°æ®çš„å†å²ç‰ˆæœ¬ï¼Œç”¨äº<strong>å›æ»šäº‹åŠ¡</strong>ã€<strong>å¿«ç…§è¯»</strong>ç­‰</p><p><img src="/img/sql_img/%E7%89%88%E6%9C%AC%E9%93%BE.png"></p><p><strong>Read View</strong></p><p>äº‹åŠ¡æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œäº§ç”Ÿçš„è¯»è§†å›¾ï¼Œä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„ï¼Œå³åˆ¤æ–­å½“å‰äº‹åŠ¡å¯è§å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®</p><p>read viewä¸»è¦å±æ€§</p><table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>m_ids</td><td>å½“å‰ç³»ç»Ÿä¸­é‚£äº›æ´»è·ƒ(<strong>å¼€å¯ä¸”æœªæäº¤</strong>)çš„è¯»å†™äº‹åŠ¡ID</td></tr><tr><td>min_limit_id</td><td>m_idsä¸­çš„æœ€å°å€¼</td></tr><tr><td>max_limit_id</td><td>æœ€å¤§äº‹åŠ¡ID+1</td></tr><tr><td>creator_trx_id</td><td>åˆ›å»ºæ—¶çš„äº‹åŠ¡ID</td></tr></tbody></table><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><ul><li><p><strong>è¯»å·²æäº¤</strong>çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸­çš„æ¯æ¬¡selectéƒ½ä¼šåˆ›å»ºæ–°çš„ReadViewï¼Œä¼šæŸ¥æ‰¾ä¸åœ¨m_idsä¸­çš„äº‹åŠ¡IDå¯¹åº”çš„å†å²æ•°æ®</p></li><li><p><strong>å¯é‡å¤è¯»</strong>çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸­åªä¼šåœ¨ç¬¬ä¸€æ¬¡selectæ—¶åˆ›å»ºReadViewï¼Œé€šè¿‡åˆ¤æ–­è¯»å–åˆ°çš„è¡Œçš„ DB_TRX_ID ä¸ DB_ROLL_PTR å­—æ®µæŒ‡å‘çš„ undo log å›æº¯åˆ°äº‹åŠ¡å¼€å¯å‰æˆ–å½“å‰äº‹åŠ¡æœ€åä¸€æ¬¡æ›´æ–°çš„æ•°æ®ç‰ˆæœ¬</p><p><img src="/img/sql_img/%E5%BF%AB%E7%85%A7%E8%AF%BB.png"></p><p>åœ¨ä¿®æ”¹æ•°æ®æ—¶ä¼šå‡ºç°å¹»è¯»</p></li></ul><h3 id="SQLè¯­å¥æ‰§è¡Œæµç¨‹"><a href="#SQLè¯­å¥æ‰§è¡Œæµç¨‹" class="headerlink" title="SQLè¯­å¥æ‰§è¡Œæµç¨‹"></a>SQLè¯­å¥æ‰§è¡Œæµç¨‹</h3><p><a href="https://xiaolincoding.com/mysql/base/how_select.html#mysql-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84">æ‰§è¡Œä¸€æ¡ select è¯­å¥ï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ?</a></p><h4 id="æŸ¥è¯¢è¯­å¥"><a href="#æŸ¥è¯¢è¯­å¥" class="headerlink" title="æŸ¥è¯¢è¯­å¥"></a>æŸ¥è¯¢è¯­å¥</h4><p><img src="/img/sql_img/mysql%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B.png"></p><ul><li>è¿æ¥å™¨ï¼šå»ºç«‹è¿æ¥ï¼Œç®¡ç†è¿æ¥ã€æ ¡éªŒç”¨æˆ·èº«ä»½ï¼›</li><li>æŸ¥è¯¢ç¼“å­˜ï¼šæŸ¥è¯¢è¯­å¥å¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚MySQL 8.0 å·²åˆ é™¤è¯¥æ¨¡å—ï¼›</li><li>è§£æ SQLï¼Œé€šè¿‡è§£æå™¨å¯¹ SQL æŸ¥è¯¢è¯­å¥è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œç„¶åæ„å»ºè¯­æ³•æ ‘ï¼Œæ–¹ä¾¿åç»­æ¨¡å—è¯»å–è¡¨åã€å­—æ®µã€è¯­å¥ç±»å‹ï¼›</li><li>æ‰§è¡Œ SQLï¼šæ‰§è¡Œ SQL å…±æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š<ul><li>é¢„å¤„ç†é˜¶æ®µï¼šæ£€æŸ¥è¡¨æˆ–å­—æ®µæ˜¯å¦å­˜åœ¨ï¼›å°† <code>select *</code> ä¸­çš„ <code>*</code> ç¬¦å·æ‰©å±•ä¸ºè¡¨ä¸Šçš„æ‰€æœ‰åˆ—ã€‚</li><li>ä¼˜åŒ–é˜¶æ®µï¼šåŸºäºæŸ¥è¯¢æˆæœ¬çš„è€ƒè™‘ï¼Œ é€‰æ‹©æŸ¥è¯¢æˆæœ¬æœ€å°çš„æ‰§è¡Œè®¡åˆ’ï¼›</li><li>æ‰§è¡Œé˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼Œä»å­˜å‚¨å¼•æ“è¯»å–è®°å½•ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼›</li></ul></li></ul><p><strong>æ‰§è¡Œå™¨å’Œå­˜å‚¨å¼•æ“çš„äº¤äº’</strong></p><ol><li><p>ä¸»é”®ç´¢å¼•æŸ¥è¯¢</p><p>æ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“çš„æŸ¥è¯¢æ¥å£ï¼Œå¹¶æŠŠæŸ¥è¯¢æ¡ä»¶äº¤ç»™å­˜å‚¨å¼•æ“ï¼›</p><p>å­˜å‚¨å¼•æ“é€šè¿‡B+æ ‘æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œè¿”å›ç»™æ‰§è¡Œå™¨ï¼›</p><p>æ‰§è¡Œå™¨åˆ¤æ–­è®°å½•æ˜¯å¦ç¬¦åˆæ¡ä»¶å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</p><p>å¾ªç¯ä»¥ä¸Šæ­¥éª¤ç›´åˆ°æ²¡æœ‰å†æŸ¥è¯¢åˆ°æ•°æ®</p></li><li><p>å…¨è¡¨æŸ¥è¯¢</p><p>æ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“çš„æŸ¥è¯¢æ¥å£ï¼›</p><p>å­˜å‚¨å¼•æ“æŠŠä¸€æ¡è®°å½•è¿”å›ç»™æ‰§è¡Œå™¨ï¼›</p><p>æ‰§è¡Œå™¨åˆ¤æ–­è®°å½•æ˜¯å¦ç¬¦åˆæ¡ä»¶å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</p><p>å¾ªç¯ä»¥ä¸Šæ­¥éª¤ç›´åˆ°æ²¡æœ‰å†æŸ¥è¯¢åˆ°æ•°æ®</p></li><li><p>ç´¢å¼•ä¸‹æ¨</p><p>åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå’Œå…¨è¡¨æŸ¥è¯¢ä¸åŒçš„æ˜¯ï¼Œä¼šæŠŠæŸ¥è¯¢æ¡ä»¶ä¹Ÿäº¤ç»™å­˜å‚¨å¼•æ“ï¼›</p><p>å½“è”åˆç´¢å¼•éƒ¨åˆ†å¤±æ•ˆæ—¶ï¼Œå¤±æ•ˆçš„å­—æ®µç”±å­˜å‚¨å¼•æ“æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼›</p><p>è¿™æ ·å°±ä¸ç”¨å›è¡¨æŸ¥è¯¢å‡ºè®°å½•åå†ç”±æ‰§è¡Œå™¨æ¥åˆ¤æ–­äº†</p><p><strong>ç´¢å¼•ä¸‹æ¨èƒ½å¤Ÿå‡å°‘äºŒçº§ç´¢å¼•çš„å›è¡¨æ“ä½œ</strong></p></li></ol><h4 id="å­˜å‚¨è¡Œ"><a href="#å­˜å‚¨è¡Œ" class="headerlink" title="å­˜å‚¨è¡Œ"></a>å­˜å‚¨è¡Œ</h4><p><strong>å­˜å‚¨ä½ç½®</strong></p><p>æ•°æ®åº“è¡¨æ–‡ä»¶å­˜å‚¨ä½ç½®<code>show variables like &#39;datadir&#39;</code></p><p>5.7åŠä¹‹å‰ç‰ˆæœ¬çš„æ–‡ä»¶</p><ul><li><code>.frm</code>æ–‡ä»¶ï¼šå­˜å‚¨è¡¨ç»“æ„</li><li><code>.idb</code>æ–‡ä»¶ï¼ˆè¡¨ç©ºé—´ï¼‰ï¼šå­˜å‚¨è¡¨æ•°æ®</li></ul><p>ä¹‹åçš„ç‰ˆæœ¬</p><ul><li><code>.idb</code>æ–‡ä»¶ï¼ˆè¡¨ç©ºé—´ï¼‰ï¼šå­˜å‚¨è¡¨ç»“æ„å’Œè¡¨æ•°æ®</li></ul><p><strong>è¡¨ç©ºé—´ç»“æ„</strong></p><p>è¡Œï¼šä¸€æ¡è®°å½•</p><p><strong>é¡µ</strong>ï¼š16KBï¼Œæ¯æ¬¡è¯»å–ç£ç›˜é‡Œçš„è®°å½•éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½</p><ul><li>é¡µä¸­çš„è®°å½•é€šè¿‡æŒ‡é’ˆå½¢æˆåŒå‘é“¾è¡¨</li><li>è®°å½•åˆ†æˆäº†ä¸€ä¸ªä¸ªç»„</li><li>é¡µä¸­åŒ…å«é¡µç›®å½•ï¼Œç›®å½•ä¸­æœ‰å¤šä¸ªæ§½ï¼Œæ‰§è¡Œå„ä¸ªåˆ†ç»„çš„æœ€åä¸€ä¸ªè®°å½•ã€‚é€šè¿‡äºŒåˆ†æ¥å®šä½åˆ°åˆ†ç»„</li></ul><p>åŒºï¼š1MBï¼Œç”±é¡µæ„æˆ</p><p>æ®µï¼šç”±å¤šä¸ªåŒºç»„æˆï¼Œåˆ†ä¸ºç´¢å¼•æ®µã€æ•°æ®æ®µã€å›æ»šæ®µç­‰</p><p><strong>è¡Œæ ¼å¼</strong></p><p><img src="/img/sql_img/%E8%A1%8C%E6%A0%BC%E5%BC%8F.png"></p><ul><li>å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ï¼šè®°å½•æ¯ä¸ªå˜é•¿å­—æ®µ(varcharã€Textç­‰)çš„é•¿åº¦</li><li>NULLå€¼åˆ—è¡¨ï¼šè®°å½•å¯ä»¥ä¸ºç©ºçš„å­—æ®µæ˜¯å¦ä¸ºNULLå€¼</li><li>è®°å½•å¤´ä¿¡æ¯ï¼šè®°å½•æ˜¯å¦è¢«åˆ é™¤ã€ä¸‹ä¸€æ¡æ•°æ®çš„æŒ‡é’ˆç­‰ä¿¡æ¯</li><li>row_idï¼šæ²¡æœ‰ä¸»é”®æ—¶çš„éšè—ä¸»é”®</li><li>trx_idï¼šåˆ›å»ºè¯¥æ¡è®°å½•çš„äº‹åŠ¡id</li><li>roll_ptrï¼šæŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆ</li></ul><blockquote><p>å› ä¸ºæŒ‡å‘ä¸‹ä¸€æ¡æ•°æ®çš„æŒ‡é’ˆæ˜¯æŒ‡åˆ°â€™è®°å½•å¤´ä¿¡æ¯â€™å’Œâ€™row_idâ€™ä¸­é—´çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢ï¼Œå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨å’ŒNULLå€¼åˆ—è¡¨çš„é¡ºåºå’Œå­—æ®µé¡ºåºç›¸åã€‚</p><p>ä¸€è¡Œè®°å½•çš„é•¿åº¦æœ€å¤§ä¸º65535Bï¼Œè€Œä¸€é¡µçš„å¤§å°ä¸º16KBï¼Œæ‰€ä»¥æ”¾ä¸ä¸‹çš„æ•°æ®ä¼šæ”¾åˆ°æº¢å‡ºé¡µä¸­ï¼ŒåŸæ¥çš„é¡µä¸­æ”¾æŒ‡å‘æº¢å‡ºé¡µçš„æŒ‡é’ˆã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue-admin-template</title>
    <link href="/2023/04/01/%E5%89%8D%E7%AB%AF/vue-element-admin/vue-admin-template/"/>
    <url>/2023/04/01/%E5%89%8D%E7%AB%AF/vue-element-admin/vue-admin-template/</url>
    
    <content type="html"><![CDATA[<h2 id="vue-admin-templateç®€å•ä½¿ç”¨"><a href="#vue-admin-templateç®€å•ä½¿ç”¨" class="headerlink" title="vue-admin-templateç®€å•ä½¿ç”¨"></a>vue-admin-templateç®€å•ä½¿ç”¨</h2><blockquote><p>vue-admin-templateæ˜¯åŸºäºvue-element-adminçš„ä¸€å¥—åå°ç®¡ç†ç³»ç»ŸåŸºç¡€æ¨¡æ¿ï¼ˆæœ€å°‘ç²¾ç®€ç‰ˆï¼‰ï¼Œå¯ä½œä¸ºæ¨¡æ¿è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p></blockquote><p> åŒ…å«äº†axiosã€vueã€vue-routerã€vuexã€element-uiç­‰</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ul><li><p>ä¸‹è½½</p><p><a href="https://github.com/PanJiaChen/vue-admin-template">https://github.com/PanJiaChen/vue-admin-template</a></p></li><li><p>è§£å‹ã€å®‰è£…ä¾èµ–ã€å¯åŠ¨</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> install<br><span class="hljs-built_in">npm</span> run dev<br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®<code>http://localhost:9528/</code></p></li></ul><h3 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada">router<span class="hljs-comment">-- è·¯ç”±ä¿¡æ¯</span><br>api<span class="hljs-comment">-- å‘é€è¯·æ±‚çš„æ–¹æ³•</span><br>views<span class="hljs-comment">-- å…·ä½“é¡µé¢</span><br>main.js<span class="hljs-comment">-- é¡¹ç›®å…¥å£</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>vue-element-admin</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springåº•å±‚åŸç†</title>
    <link href="/2023/03/19/spring/Spring%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"/>
    <url>/2023/03/19/spring/Spring%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="Springåº•å±‚åŸç†"><a href="#Springåº•å±‚åŸç†" class="headerlink" title="Springåº•å±‚åŸç†"></a>Springåº•å±‚åŸç†</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><h3 id="Beançš„åˆ›å»ºè¿‡ç¨‹"><a href="#Beançš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Beançš„åˆ›å»ºè¿‡ç¨‹"></a>Beançš„åˆ›å»ºè¿‡ç¨‹</h3><ol><li><p><strong>æ¨æ–­æ„é€ æ–¹æ³•</strong></p><ol><li><p>é€‰æ‹©ä½¿ç”¨çš„æ„é€ æ–¹æ³•ï¼š</p><ul><li><p>å¦‚æœåªæœ‰æ— å‚çš„æ„é€ æ–¹æ³•ï¼Œå°±ç”¨æ— å‚çš„ï¼›</p></li><li><p>å¦‚æœåªæœ‰ä¸€ä¸ªæœ‰å‚çš„æ„é€ æ–¹æ³•ï¼Œå°±ç”¨è¿™ä¸ªæœ‰å‚çš„ï¼›</p></li><li><p>å¦‚æœæœ‰å¤šä¸ªæœ‰å‚çš„æ„é€ æ–¹æ³•ï¼Œä¼šä½¿ç”¨æ„é€ ä¸ŠåŠ äº†@Autowiredçš„æ„é€ ï¼Œæ²¡æœ‰åˆ™springä¹Ÿä¸çŸ¥é“ç”¨å“ªä¸ªï¼Œä¼šå°è¯•æ‰¾æ— å‚çš„ï¼Œæ²¡æœ‰å°±æŠ¥é”™ã€‚</p></li></ul></li><li><p>å¯¹å…¥å‚è¿›è¡Œä¾èµ–æ³¨å…¥</p><p>ä¼šå¯¹æœ‰å‚çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå…ˆé€šè¿‡ç±»å‹å»å•ä¾‹æ± ä¸­æ‰¾ï¼Œå¦‚æœæœ‰å¤šä¸ªåˆ™å†é€šè¿‡å‚æ•°ååŒ¹é…ï¼Œæ²¡æœ‰å°±æŠ¥é”™ã€‚</p></li></ol></li><li><p><strong>ä¾èµ–æ³¨å…¥</strong></p><p>æ‰¾åŠ äº†å“åº”æ³¨è§£ï¼ˆ@Autowiredã€@Resourceï¼‰çš„å±æ€§ï¼Œå…ˆbyTypeå†byName</p></li><li><p><strong>åˆå§‹åŒ–</strong></p><ul><li>åˆå§‹åŒ–å‰ï¼šæ‰«æå¯¹åº”æ³¨è§£ï¼ˆ@PostConstructï¼‰ï¼Œæ‰§è¡Œåˆå§‹åŒ–å‰æ–¹æ³•</li><li>åˆå§‹åŒ–ä¸­ï¼šæ‰«æå¯¹åº”æ¥å£ï¼ˆafterPropertiesSetï¼‰ï¼Œæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•</li><li>åˆå§‹åŒ–åï¼š<strong>AOPäº§ç”Ÿä»£ç†å¯¹è±¡</strong><ul><li>cglibï¼šä»£ç†å¯¹è±¡ç»§æ‰¿åŸå¯¹è±¡ï¼ŒåŸå¯¹è±¡æˆä¸ºä»£ç†å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚åˆ‡é¢æ–¹æ³•é‡Œé€šè¿‡joinPoint.getTarget()å¯ä»¥è·å–åŸå¯¹è±¡ï¼ŒjoinPoint.getThis()å¯ä»¥è·å–ä»£ç†å¯¹è±¡</li></ul></li></ul></li><li><p>æ”¾åˆ°Mapï¼ˆå•ä¾‹æ± ï¼‰ä¸­</p></li><li><p>Beanå¯¹è±¡</p></li></ol><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p>å’ŒAOPç±»ä¼¼ï¼Œç”Ÿæˆä»£ç†å¯¹è±¡æ¥å¢å¼ºåŠŸèƒ½</p><p><strong>å¼€å¯äº‹åŠ¡</strong>ï¼šåœ¨æ•°æ®åº“é…ç½®ç±»ä¸ŠåŠ @EnableTransactionManagementã€@Configuration</p><ol><li>äº‹åŠ¡ç®¡ç†å™¨æ–°å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥conn</li><li>conn.autocommit &#x3D; false          &#x2F;&#x2F; å…³é—­è‡ªåŠ¨æäº¤</li><li>ä½¿ç”¨@ConfigurationæŠŠdataSourceæ³¨å…¥beanï¼Œä½¿æ¯æ¬¡æ‹¿åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªdataSource</li></ol><p><strong>ä½¿ç”¨äº‹åŠ¡</strong>ï¼š@Transactional</p><h4 id="star-äº‹åŠ¡å¤±æ•ˆåŸç†"><a href="#star-äº‹åŠ¡å¤±æ•ˆåŸç†" class="headerlink" title=":star:äº‹åŠ¡å¤±æ•ˆåŸç†"></a>:star:äº‹åŠ¡å¤±æ•ˆåŸç†</h4><p>å¿…é¡»æ˜¯ä»è·å–åˆ°çš„ä»£ç†å¯¹è±¡æ¥è°ƒç”¨æœ‰äº‹åŠ¡çš„æ–¹æ³•æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>å¦‚æœæ˜¯ä»è‡ªå·±newçš„å¯¹è±¡&#x2F;å…¶ä»–æ–¹æ³•è°ƒç”¨äº‹åŠ¡æ–¹æ³•ç­‰æ–¹å¼åˆ™ä¸ä¼šç»è¿‡åˆ‡é¢ï¼Œä»è€Œäº‹åŠ¡å¤±æ•ˆ</p><h3 id="star-å¾ªç¯ä¾èµ–"><a href="#star-å¾ªç¯ä¾èµ–" class="headerlink" title=":star:å¾ªç¯ä¾èµ–"></a>:star:å¾ªç¯ä¾èµ–</h3><h4 id="æå‰AOP"><a href="#æå‰AOP" class="headerlink" title="æå‰AOP"></a>æå‰AOP</h4><p>â€‹æˆå› ï¼šåœ¨åˆ›å»ºä¸€ä¸ªbeanæ—¶å°†å…¶åå­—æ·»åŠ åˆ°ä¸€ä¸ªsetä¸­ï¼Œåˆ›å»ºå®Œåå°†å…¶åˆ é™¤ã€‚å¦‚æœæ­¤æ—¶å¦ä¸€ä¸ªbeanéœ€è¦ä¾èµ–æ³¨å…¥çš„beanåœ¨å•ä¾‹æ± ä¸­æ‰¾ä¸åˆ°ï¼Œè€Œåœ¨è¿™ä¸ªsetä¸­ï¼Œè¯´æ˜å‡ºç°äº†å¾ªç¯ä¾èµ–</p><p>â€‹åªæœ‰å‡ºç°å¾ªç¯ä¾èµ–æ—¶ï¼Œ<strong>å°†AOPçš„æ­¥éª¤æå‰åˆ°å¡«å……å±æ€§å‰</strong>ï¼Œå¾—åˆ°ä»£ç†å¯¹è±¡æ³¨å…¥åˆ°<strong>äºŒçº§ç¼“å­˜</strong>ï¼ˆearlySingletonObjectsï¼‰ä¸­ã€‚æ­¤æ—¶çš„ä»£ç†å¯¹è±¡è¿˜ä¸èƒ½æ”¾åˆ°å•ä¾‹æ± ä¸­ï¼Œå› ä¸ºä»£ç†å¯¹è±¡é‡Œçš„åŸå¯¹è±¡è¿˜æ²¡åˆ›å»ºå‡ºæ¥ï¼Œç°åœ¨å¤„äºåŠæˆå“çŠ¶æ€</p><p>â€‹åé¢å†å‡ºç°å¾ªç¯ä¾èµ–ï¼Œä¼šå…ˆå»äºŒçº§ç¼“å­˜ä¸­æ‰¾ï¼Œæ²¡æœ‰å†å»æå‰AOP</p><p>â€‹å½“å½“å‰å¯¹è±¡åˆ›å»ºå®Œåï¼Œå†ä»äºŒçº§ç¼“å­˜ä¸­å–å‡ºåŠæˆå“å¯¹è±¡ç»§ç»­åˆå§‹åŒ–å®Œå†æ”¾è¿›å•ä¾‹æ± ä¸­ï¼ŒåŠæˆå“ä¼šè¢«åˆ æ‰</p><p>â€‹è€Œåˆ›å»ºäºŒçº§ç¼“å­˜ä¸­ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå­˜åœ¨<strong>ä¸‰çº§ç¼“å­˜</strong>ï¼ˆsingletonFactoriesï¼‰ä¸­ï¼Œåœ¨å»äºŒçº§ç¼“å­˜ä¸­æ‰¾ä»£ç†å¯¹è±¡è€Œæ²¡æœ‰æ‰¾åˆ°æ—¶è°ƒç”¨ï¼Œè°ƒç”¨å®Œåˆ æ‰ã€‚åœ¨ä¹‹åæ­£å¸¸æµç¨‹çš„AOPæ—¶å‘ç°ä¸‰çº§ç¼“å­˜é‡Œçš„è¢«åˆ é™¤äº†çš„è¯ï¼Œå°±ä¸å†AOP</p><h4 id="Lazy"><a href="#Lazy" class="headerlink" title="@Lazy"></a>@Lazy</h4><p>â€‹æˆå› ï¼š@Asyncä¼šç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä½†å’ŒAOPæ˜¯ä¸åŒçš„é€»è¾‘ï¼Œæ˜¯åœ¨åå¤„ç†å™¨ä¸­åšçš„ä»£ç†ã€‚æ‰€ä»¥åœ¨æå‰AOPæ—¶æ”¾å…¥äºŒçº§ç¼“å­˜çš„æ˜¯åŸå§‹å¯¹è±¡ï¼Œæ³¨å…¥çš„ä¹Ÿæ˜¯åŸå§‹å¯¹è±¡ã€‚è€Œä¹‹åä»äºŒçº§ç¼“å­˜ä¸­å–å‡ºç»§ç»­åˆå§‹åŒ–åï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜çš„å´æ˜¯ä»£ç†å¯¹è±¡</p><p>â€‹æˆå› ï¼šåœ¨æ„é€ å‡½æ•°æ—¶å‡ºç°å¾ªç¯ä¾èµ–ï¼Œå³åˆ›å»ºä¸å‡ºåŸå§‹å¯¹è±¡ï¼Œå¦‚<code>AService(Bservice b)ã€BService(AService a)</code></p><p>â€‹è§£å†³ï¼šä½¿ç”¨@Lazyä¼šå…ˆç”¨ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥å ä½ï¼Œåˆ°ä¹‹åç”¨åˆ°æ—¶å†æ³¨å…¥å¯¹è±¡ï¼Œä»è€Œä¸ä¼šå‘ç”Ÿå¾ªç¯ä¾èµ–</p><h4 id="ä¸‰çº§ç¼“å­˜"><a href="#ä¸‰çº§ç¼“å­˜" class="headerlink" title="ä¸‰çº§ç¼“å­˜"></a>ä¸‰çº§ç¼“å­˜</h4><p>ä¸‰çº§ç¼“å­˜å°±æ˜¯ä¸‰ä¸ªMapï¼Œæœ€ç»ˆæ˜¯ä¸ºäº†ä¿è¯å•ä¾‹</p><ul><li>ç¬¬ä¸€çº§ç¼“å­˜ï¼šsingletonObjects ï¼ˆå•ä¾‹æ± ï¼‰ï¼šå­˜æ”¾åˆ›å»ºå¥½çš„bean</li><li>ç¬¬äºŒçº§ç¼“å­˜ï¼šearlySingletonObjectsï¼šå­˜æ”¾æå‰åˆ›å»ºçš„ä»£ç†å¯¹è±¡</li><li>ç¬¬ä¸‰çº§ç¼“å­˜ï¼šsingletonFactoriesï¼šå­˜æ”¾åˆ›å»ºä»£ç†å¯¹è±¡çš„æ–¹æ³•</li></ul><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><h3 id="1-Beançš„åˆ›å»º"><a href="#1-Beançš„åˆ›å»º" class="headerlink" title="1.Beançš„åˆ›å»º"></a>1.Beançš„åˆ›å»º</h3><h4 id="åˆ†æè¿‡ç¨‹"><a href="#åˆ†æè¿‡ç¨‹" class="headerlink" title="åˆ†æè¿‡ç¨‹"></a>åˆ†æè¿‡ç¨‹</h4><p><strong>ç›®æ ‡</strong>ï¼šé€šè¿‡debugæ¥å¯»æ‰¾åœ¨å“ªé‡Œåˆ›å»ºäº†Userå¯¹è±¡ï¼Œæ ¹æ®ä½•æ—¶æ‰“å°æ„é€ æ–¹æ³•é‡Œçš„æ‰“å°æ¥å¯»æ‰¾</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ol><li>é€šè¿‡é…ç½®æ–‡ä»¶æ–¹å¼å°†beanæ³¨å…¥åˆ°å®¹å™¨ä¸­</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd &quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.domain.User&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.domain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆ›å»ºäº†User&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»ºå®¹å™¨ï¼Œé€šè¿‡debugå‘ç°å®åœ¨åˆ›å»ºå®¹å™¨æ—¶åˆ›å»ºäº†user</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw;<br><br><span class="hljs-keyword">import</span> com.xw.domain.User;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) context.getBean(<span class="hljs-string">&quot;user&quot;</span>);<br>        System.out.println(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>ç»§ç»­å¾€é‡Œçœ‹ï¼Œdebugå‘ç°æ‰§è¡Œåˆ°refresh()æ—¶åˆ›å»ºäº†user</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ClassPathXmlApplicationContext</span><span class="hljs-params">(</span><br><span class="hljs-params">    String[] configLocations, <span class="hljs-type">boolean</span> refresh, <span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span><br>    <span class="hljs-keyword">throws</span> BeansException &#123;<br><br>    <span class="hljs-built_in">super</span>(parent);<br>    setConfigLocations(configLocations);<br>    <span class="hljs-keyword">if</span> (refresh) &#123;<br>        refresh();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>ç‚¹å…¥refresh()ï¼Œ<strong>å‘ç°åˆ›å»ºå®¹å™¨çš„æ­¥éª¤</strong>ï¼Œå…¶ä¸­æ‰§è¡Œåˆ°ç¬¬11æ­¥<code>finishBeanFactoryInitialization(beanFactory);</code>æ—¶åˆ›å»ºäº†user</li></ol><p><img src="/img/spring_img/%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E6%B5%81%E7%A8%8B.png"></p><ol start="5"><li>ç‚¹å…¥<code>finishBeanFactoryInitialization()</code>æ–¹æ³•ï¼Œå‘ç°è°ƒç”¨äº†<code>beanFactory.preInstantiateSingletons();</code>ååˆ›å»ºäº†user</li><li>ç»§ç»­å¾€ä¸‹ç‚¹å‘ç°åœ¨æ–¹æ³•é‡Œåˆ¤æ–­å½“å‰ç±»æ˜¯ä¸æ˜¯æŠ½è±¡ã€å•ä¾‹ã€æ‡’æƒ°ï¼Œåè°ƒç”¨äº†<code>getBean(beanName)</code>æ¥åˆ›å»ºæˆ–è·å–Bean</li><li><code>getBean()</code>è°ƒç”¨<code>doGetBean()</code>ï¼Œä¼šå…ˆå°è¯•ä»ç¼“å­˜ä¸­å–ï¼Œæ²¡æœ‰åˆ™å…ˆåˆå§‹åŒ–ä¾èµ–çš„Beanï¼Œç„¶åè°ƒç”¨<code>createBean()</code>æ¥å®ä¾‹åŒ–å’Œåˆå§‹åŒ–Bean<ol><li><code>createBean()</code>ä¸­è°ƒç”¨äº†<code>InstantiationAwareBeanPostProcessor()</code>åç½®å¤„ç†å™¨æ¥å®ç°AOPï¼Œç„¶åè°ƒç”¨<code>doCreateBean()</code>åå°„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–Bean</li></ol></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>â€‹åˆ°è¿™é‡Œå‘ç°æ˜¯è°ƒç”¨äº†beanFactoryçš„doGetBean()æ–¹æ³•<strong>åˆ›å»ºäº†éæ‡’åŠ è½½çš„å•ä¾‹bean</strong>ã€‚beanFactoryé€šè¿‡åå°„åˆ›å»º<strong>ç©ºå‚</strong>çš„å•ä¾‹å¯¹è±¡ï¼Œåˆ›å»ºåå°†å¯¹è±¡ä¿å­˜åˆ°äº†ä¸€ä¸ªmapé›†åˆä¸­ï¼ˆsingletonObjectsï¼‰,keyä¸ºbeançš„åå­—ï¼Œvalueä¸ºuserçš„å•ä¾‹å¯¹è±¡ã€‚</p><h3 id="2-Beançš„è·å–"><a href="#2-Beançš„è·å–" class="headerlink" title="2.Beançš„è·å–"></a>2.Beançš„è·å–</h3><p>context.getBean()ï¼Œè·å–beanFactoryï¼Œé€šè¿‡beanFactoryçš„getBeanæ–¹æ³•ï¼Œæ ¹æ®åç§°è·å–åˆ›å»ºæ—¶æ”¾è¿›mapé‡Œçš„bean</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Netty</title>
    <link href="/2023/02/26/%E7%BD%91%E7%BB%9C/Netty/"/>
    <url>/2023/02/26/%E7%BD%91%E7%BB%9C/Netty/</url>
    
    <content type="html"><![CDATA[<h1 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h1><p><strong>Netty</strong>æ˜¯ ä¸€ä¸ª<strong>å¼‚æ­¥äº‹ä»¶é©±åŠ¨</strong>çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”¨äº<strong>å¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong>ã€‚</p><h2 id="NIOåŸºç¡€"><a href="#NIOåŸºç¡€" class="headerlink" title="NIOåŸºç¡€"></a>NIOåŸºç¡€</h2><p>NIOï¼ˆ<strong>non-blocking io</strong>ï¼‰éé˜»å¡IO</p><h3 id="ä¸‰å¤§ç»„ä»¶"><a href="#ä¸‰å¤§ç»„ä»¶" class="headerlink" title="ä¸‰å¤§ç»„ä»¶"></a>ä¸‰å¤§ç»„ä»¶</h3><h4 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h4><p>è¯»å†™æ•°æ®çš„<strong>åŒå‘é€šé“</strong></p><p>å¸¸è§Channelæœ‰ï¼š</p><ul><li>FileChannelï¼šä¼ è¾“æ–‡ä»¶</li><li>DatagramChannelï¼šUDP</li><li>SocketChannelï¼šTCP</li><li>ServerSocketChannelï¼šTPCï¼Œä¸“ç”¨äºæœåŠ¡å™¨</li></ul><h4 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h4><p>ç¼“å†²è¯»å†™æ•°æ®</p><p>å¸¸è§Bufferæœ‰ï¼š</p><ul><li>ByteBuffer</li></ul><h4 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h4><p>åœ¨æœåŠ¡å™¨å’Œç”¨æˆ·è¿æ¥ä¸Šçš„å‡ ç§ç­–ç•¥ï¼š</p><ol><li><strong>å¤šçº¿ç¨‹</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªç”¨æˆ·(socket)ã€‚ç¼ºç‚¹ï¼šå†…å­˜å ç”¨é«˜ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜ï¼Œåªé€‚åˆè¿æ¥å°‘çš„åœºæ™¯</li><li><strong>çº¿ç¨‹æ± </strong>ï¼šä¸€ä¸ªçº¿ç¨‹æ± å¯¹åº”å¤šä¸ªç”¨æˆ·(socket)ã€‚ç¼ºç‚¹ï¼šé˜»å¡æ¨¡å¼ä¸‹ï¼Œçº¿ç¨‹ä»…èƒ½å¤„ç†ä¸€ä¸ªsocketï¼Œä»…é€‚åˆçŸ­è¿æ¥åœºæ™¯</li><li><strong>selector</strong>ï¼šä¸€ä¸ªselectorå’Œä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªchannelï¼Œå½“channelæœ‰ä»»åŠ¡è¦çº¿ç¨‹å¤„ç†æ—¶ï¼Œç”±selectoré€šçŸ¥çº¿ç¨‹å»å¤„ç†ï¼Œçº¿ç¨‹æ˜¯éé˜»å¡çš„ã€‚é€‚åˆè¿æ¥å¤šï¼Œæµé‡ä½çš„åœºæ™¯ã€‚</li></ol><p>â€‹<img src="/img/inter_img/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%89%88.png" alt="å¤šçº¿ç¨‹ç‰ˆ"></p><p>â€‹<img src="/img/inter_img/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%89%88.png" alt="çº¿ç¨‹æ± ç‰ˆ"></p><p>â€‹<img src="/img/inter_img/selector%E7%89%88.png" alt="selectorç‰ˆ"></p><h3 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h3><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><p>åŠŸèƒ½ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªdata.txtæ–‡ä»¶ï¼Œè¯»å–è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹</p><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li>åƒbufferå†™å…¥æ•°æ®ï¼Œå¦‚channel.read(buffer)</li><li>è°ƒç”¨filp()åˆ‡æ¢è‡³<strong>è¯»æ¨¡å¼</strong></li><li>ä»bufferä¸­è¯»å–æ•°æ®ï¼Œå¦‚buffer.get()</li><li>è°ƒç”¨clear()æˆ–compact()åˆ‡æ¢è‡³<strong>å†™æ¨¡å¼</strong></li><li>é‡å¤ä»¥ä¸Šæ­¥éª¤</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.nio.ByteBuffer;<br><span class="hljs-keyword">import</span> java.nio.channels.FileChannel;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">// 1. å‡†å¤‡è¾“å…¥è¾“å‡ºæµ</span><br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">FileChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;data.txt&quot;</span>).getChannel())&#123;<br>        <span class="hljs-comment">// 2.å‡†å¤‡ç¼“å†²åŒº</span><br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">10</span>); <span class="hljs-comment">// åˆ’åˆ†10ä¸ªå­—èŠ‚ä½œä¸ºç¼“å†²åŒº</span><br>        <span class="hljs-comment">// 3.å†™å…¥ç¼“å†²åŒº</span><br>        <span class="hljs-keyword">while</span> (channel.read(buffer) != -<span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// 4.ä»bufferä¸­è¯»å‡ºæ•°æ®</span><br>            buffer.flip();  <span class="hljs-comment">// åˆ‡æ¢åˆ°è¯»æ¨¡å¼</span><br>            <span class="hljs-keyword">while</span> (buffer.hasRemaining()) &#123;<br>                System.out.println((<span class="hljs-type">char</span>) buffer.get());<br>            &#125;<br>            buffer.clear(); <span class="hljs-comment">// åˆ‡æ¢åˆ°å†™æ¨¡å¼</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p>å±æ€§ï¼š</p><ol><li>capacity å®¹é‡</li><li>position è¯»å†™æŒ‡é’ˆ</li><li>limit è¯»å†™çš„å°¾éƒ¨æŒ‡é’ˆ</li></ol><p>â€‹<img src="/img/inter_img/byteBuffer%E7%BB%93%E6%9E%841.png" alt="åˆå§‹æ—¶"></p><p>â€‹<img src="/img/inter_img/byteBuffer%E7%BB%93%E6%9E%842.png" alt="å†™å…¥å†…å®¹ï¼ŒpæŒ‡é’ˆåç§»"></p><p>â€‹<img src="/img/inter_img/byteBuffer%E7%BB%93%E6%9E%843.png" alt="è°ƒç”¨flipè¯»å†…å®¹ï¼ŒlæŒ‡é’ˆç§»åˆ°pæŒ‡é’ˆä½ç½®ï¼Œé‡ç½®pæŒ‡é’ˆ"></p><p>â€‹<img src="/img/inter_img/byteBuffer%E7%BB%93%E6%9E%841.png" alt="è°ƒç”¨cleanï¼Œé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ï¼Œä»å¤´å¼€å§‹å†™"></p><p>â€‹<img src="/img/inter_img/byteBuffer%E7%BB%93%E6%9E%844.png" alt="è°ƒç”¨compactï¼Œä¼šæŠŠæœªè¯»çš„å†…å®¹ä¿ç•™ï¼Œåœ¨åé¢è¿½åŠ å†™"></p><h4 id="å¸¸è§æ–¹æ³•"><a href="#å¸¸è§æ–¹æ³•" class="headerlink" title="å¸¸è§æ–¹æ³•"></a>å¸¸è§æ–¹æ³•</h4><h5 id="åˆ†é…ç©ºé—´"><a href="#åˆ†é…ç©ºé—´" class="headerlink" title="åˆ†é…ç©ºé—´"></a>åˆ†é…ç©ºé—´</h5><p>åˆ†é…ä¸€å—å›ºå®šçš„å®¹é‡ï¼ˆå­—èŠ‚ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ†é…å †å†…å­˜ï¼Œæ•ˆç‡è¾ƒä½</span><br>ByteBuffer.allocate(<span class="hljs-number">10</span>);<br><span class="hljs-comment">// åˆ†é…ç›´æ¥å†…å­˜ï¼ˆç³»ç»Ÿå†…å­˜ï¼‰ï¼Œæ•ˆç‡è¾ƒé«˜ï¼ˆé›¶æ‹·è´ï¼‰ï¼Œä¸å—GCå½±å“ï¼Œ</span><br><span class="hljs-comment">// ä½†åˆ†é…æ•ˆç‡ä½ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½é€ æˆå†…å­˜æ³„æ¼</span><br>ByteBuffer.allocateDirect(<span class="hljs-number">16</span>);<br></code></pre></td></tr></table></figure><h5 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="headerlink" title="å†™å…¥æ•°æ®"></a>å†™å…¥æ•°æ®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä»channelä¸­è¯»åˆ°buffer</span><br>channel.read(buffer);<br><span class="hljs-comment">// ç›´æ¥å‘bufferä¸­å†™</span><br>buffer.put();<br></code></pre></td></tr></table></figure><h5 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŠŠbufferä¸­çš„æ•°æ®å†™åˆ°channel</span><br>channel.write(buffer);<br><span class="hljs-comment">// ç›´æ¥ä»bufferä¸­è¯»</span><br>buffer.get();<br></code></pre></td></tr></table></figure><ul><li>rewind() å°†positionç§»åˆ°å¤´éƒ¨</li><li>get(int idx) è¯»å–æŒ‡å®šä¸‹æ ‡çš„æ•°æ®ï¼Œä¸ä¼šæ”¹å˜positionæŒ‡é’ˆ</li></ul><h5 id="åšæ ‡è®°"><a href="#åšæ ‡è®°" class="headerlink" title="åšæ ‡è®°"></a>åšæ ‡è®°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">10</span>);<br>buffer.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br>buffer.flip();<br><br>System.out.println(buffer.get());   <span class="hljs-comment">// 97</span><br>buffer.mark();  <span class="hljs-comment">// åœ¨ä¸‹æ ‡ä¸º1çš„ä½ç½®åšä¸ªæ ‡è®°</span><br>System.out.println(buffer.get());   <span class="hljs-comment">// 98</span><br>System.out.println(buffer.get());   <span class="hljs-comment">// 99</span><br>buffer.reset(); <span class="hljs-comment">// è¿”å›åšæ ‡è®°çš„ä½ç½®</span><br>System.out.println(buffer.get());   <span class="hljs-comment">// 98</span><br></code></pre></td></tr></table></figure><h5 id="Stringå’ŒByteBufferè½¬æ¢"><a href="#Stringå’ŒByteBufferè½¬æ¢" class="headerlink" title="Stringå’ŒByteBufferè½¬æ¢"></a>Stringå’ŒByteBufferè½¬æ¢</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç›´æ¥è½¬ä¸ºbuffer</span><br><span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer1</span> <span class="hljs-operator">=</span> StandardCharsets.UTF_8.encode(<span class="hljs-string">&quot;hello&quot;</span>);<br><span class="hljs-comment">// è½¬ä¸ºString</span><br>System.out.println(StandardCharsets.UTF_8.decode(buffer1).toString());<br></code></pre></td></tr></table></figure><h4 id="ç²˜åŒ…ã€åŠåŒ…"><a href="#ç²˜åŒ…ã€åŠåŒ…" class="headerlink" title="ç²˜åŒ…ã€åŠåŒ…"></a>ç²˜åŒ…ã€åŠåŒ…</h4><p><strong>ç²˜åŒ…</strong>ï¼š</p><ol><li>ä¼ è¾“æ¢è¡Œçš„æ•°æ®æ—¶ï¼Œå¤šè¡Œæ•°æ®åœ¨ä¸€è¡Œä¼ è¾“</li><li>æ˜¯åœ¨æ•ˆç‡ä¸Šè€ƒè™‘ï¼Œå¤šæ¡ä¸€èµ·å‘æ•ˆç‡é«˜</li></ol><p><strong>åŠåŒ…</strong>ï¼š</p><ol><li>ä¸€è¡Œæ•°æ®è¢«æ‹†æˆå¤šè¡Œæ˜¾ç¤º</li><li>å› ä¸ºç¼“å†²åŒºå¤§å°å¯¼è‡´æ•°æ®è¢«æ‹†</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">// æ¨¡æ‹Ÿç½‘ç»œä¼ è¾“æ•°æ®</span><br>    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">32</span>);<br>    source.put(<span class="hljs-string">&quot;Hello,world\nI&#x27;m zhangsan\nHo&quot;</span>.getBytes());<br>    split(source);<br>    source.put(<span class="hljs-string">&quot;w are you?\n&quot;</span>.getBytes());<br>    split(source);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">split</span><span class="hljs-params">(ByteBuffer source)</span> &#123;<br>    <span class="hljs-comment">// å°†sourceä¸­çš„å†…å®¹æŒ‰&#x27;\n&#x27;åˆ†å‰²æ¥è¯»å–</span><br>    source.flip();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; source.limit(); i++) &#123;<br>        <span class="hljs-keyword">if</span> (source.get(i) == <span class="hljs-string">&#x27;\n&#x27;</span>) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> i - source.position() + <span class="hljs-number">1</span>;<br>            <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(length);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; length; j++) &#123;<br>                target.put(source.get());<br>            &#125;<br>            target.flip();<br>            System.out.println(StandardCharsets.US_ASCII.decode(target));<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// æ”¹ä¸ºå†™æ¨¡å¼ï¼Œä¿ç•™æœªè¯»å–çš„æ•°æ®</span><br>    source.compact();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ–‡ä»¶ç¼–ç¨‹"><a href="#æ–‡ä»¶ç¼–ç¨‹" class="headerlink" title="æ–‡ä»¶ç¼–ç¨‹"></a>æ–‡ä»¶ç¼–ç¨‹</h3><h4 id="FileChannel"><a href="#FileChannel" class="headerlink" title="FileChannel"></a>FileChannel</h4><blockquote><p>FileChannelåªèƒ½å·¥ä½œåœ¨é˜»å¡æ¨¡å¼ä¸‹ï¼Œä¸èƒ½ä½¿ç”¨selector</p></blockquote><h5 id="è·å–æ–¹å¼"><a href="#è·å–æ–¹å¼" class="headerlink" title="è·å–æ–¹å¼"></a>è·å–æ–¹å¼</h5><ol><li>FileInputStreamï¼šè·å–çš„channelåªèƒ½è¯»</li><li>FileOutputStreamï¼šè·å–çš„channelåªèƒ½å†™</li><li>RandomAccessFileï¼šæ ¹æ®æ„é€ RandomAccessFileæ—¶çš„è¯»å†™æ¨¡å¼å†³å®š</li></ol><h5 id="è¯»å–"><a href="#è¯»å–" class="headerlink" title="è¯»å–"></a>è¯»å–</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">readBytes</span> <span class="hljs-operator">=</span> channel.read(buffer);<br></code></pre></td></tr></table></figure><h5 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ...;<br>buffer.put(...);<br>buffer.flip();<span class="hljs-comment">// åˆ‡æ¢è¯»æ¨¡å¼</span><br><br><span class="hljs-keyword">while</span> (buffer.hasRemaining()) &#123;<br>    channel.write(buffer);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">channel.close();<br></code></pre></td></tr></table></figure><h5 id="å¼ºåˆ¶å†™å…¥"><a href="#å¼ºåˆ¶å†™å…¥" class="headerlink" title="å¼ºåˆ¶å†™å…¥"></a>å¼ºåˆ¶å†™å…¥</h5><p>â€‹ä¸ºäº†å‡å°‘ioæ“ä½œï¼Œå†™çš„æ•°æ®ä¸ä¼šç«‹å³å†™åˆ°ç£ç›˜ä¸­ã€‚å¯ä»¥è°ƒåŠ¨force(true)ç«‹å³å†™å…¥ç£ç›˜</p><h5 id="ä¼ è¾“æ•°æ®åˆ°å¦ä¸€ä¸ªæ–‡ä»¶"><a href="#ä¼ è¾“æ•°æ®åˆ°å¦ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="ä¼ è¾“æ•°æ®åˆ°å¦ä¸€ä¸ªæ–‡ä»¶"></a>ä¼ è¾“æ•°æ®åˆ°å¦ä¸€ä¸ªæ–‡ä»¶</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> (<br>    <span class="hljs-type">FileChannel</span> <span class="hljs-variable">from</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;data.txt&quot;</span>).getChannel();<br>    <span class="hljs-type">FileChannel</span> <span class="hljs-variable">to</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;to.txt&quot;</span>).getChannel();<br>) &#123;<br>    <span class="hljs-comment">// æŠŠæ–‡ä»¶data.txtçš„å†…å®¹å†™åˆ°to.txtä¸­ï¼Œæ¯æ¬¡æœ€é«˜ä¼ è¾“2Gæ•°æ®</span><br>    <span class="hljs-comment">// é‡‡ç”¨çš„æ˜¯é›¶æ‹·è´ï¼Œæ•ˆç‡é«˜</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> from.size();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> size; left &gt; <span class="hljs-number">0</span>;)<br>        left -= from.transferTo(size - left, left, to);<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Path-amp-Files"><a href="#Path-amp-Files" class="headerlink" title="Path &amp;  Files"></a>Path &amp;  Files</h4><ul><li><p>Pathç”¨äºè¡¨ç¤ºæ–‡ä»¶è·¯å¾„</p></li><li><p>Pathsæ˜¯å·¥å…·ç±»ï¼Œç”¨äºè·å–Pathå®ä¾‹</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Path</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">&quot;1.txt&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>Filesæ˜¯æ“ä½œæ–‡ä»¶çš„å·¥å…·ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Path.get(<span class="hljs-string">&quot;data.txt&quot;</span>);<br>System.out.println(Files.exists(path)); <br><br><span class="hljs-comment">// åˆ›å»ºä¸€çº§ç›®å½•ï¼Œå·²å­˜åœ¨åˆ™æŠ›å¼‚å¸¸</span><br><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Path.get(<span class="hljs-string">&quot;hello/d1&quot;</span>);<br>Files.createDirectory(path);<br><br><span class="hljs-comment">// åˆ›å»ºå¤šçº§ç›®å½•</span><br><span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Path.get(<span class="hljs-string">&quot;hello/d1/d2&quot;</span>);<br>Files.createDirectorys(path);<br><br><span class="hljs-comment">// æ‹·è´æ–‡ä»¶</span><br><span class="hljs-type">Path</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> Path.get(<span class="hljs-string">&quot;helloword/data.txt&quot;</span>);<br><span class="hljs-type">Path</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> Path.get(<span class="hljs-string">&quot;helloword/target.txt&quot;</span>);<br>Files.copy(source, target);<br><br><span class="hljs-comment">// éå†ç›®å½•</span><br>Files.walkFileTree(Paths.get(<span class="hljs-string">&quot;F:\\aaa&quot;</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleFileVisitor</span>&lt;Path&gt;()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title function_">preVisitDirectory</span><span class="hljs-params">(Path dir, BasicFileAttributes attrs)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(dir);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.preVisitDirectory(dir, attrs);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> FileVisitResult <span class="hljs-title function_">visitFile</span><span class="hljs-params">(Path file, BasicFileAttributes attrs)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(file);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.visitFile(file, attrs);<br>    &#125;<br>&#125;);<br><br>ã€‚ã€‚ã€‚<br></code></pre></td></tr></table></figure><h3 id="star-ç½‘ç»œç¼–ç¨‹"><a href="#star-ç½‘ç»œç¼–ç¨‹" class="headerlink" title=":star:ç½‘ç»œç¼–ç¨‹"></a>:star:ç½‘ç»œç¼–ç¨‹</h3><h4 id="é˜»å¡-amp-éé˜»å¡"><a href="#é˜»å¡-amp-éé˜»å¡" class="headerlink" title="é˜»å¡&amp;éé˜»å¡"></a>é˜»å¡&amp;éé˜»å¡</h4><h5 id="å•çº¿ç¨‹æ¨¡å¼ä¸‹"><a href="#å•çº¿ç¨‹æ¨¡å¼ä¸‹" class="headerlink" title="å•çº¿ç¨‹æ¨¡å¼ä¸‹"></a>å•çº¿ç¨‹æ¨¡å¼ä¸‹</h5><p><strong>é˜»å¡æ¨¡å¼</strong></p><p>å•çº¿ç¨‹ä¸èƒ½å¾ˆå¥½çš„å¤„ç†å¤šä¸ªè¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">    é˜»å¡æ¨¡å¼</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>        <span class="hljs-comment">// 1.åˆ›å»ºæœåŠ¡å™¨</span><br>        <span class="hljs-type">ServerSocketChannel</span> <span class="hljs-variable">ssc</span> <span class="hljs-operator">=</span> ServerSocketChannel.open();<br>        <span class="hljs-comment">// 2.ç»‘å®šç›‘å¬ç«¯å£</span><br>        ssc.bind(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>((<span class="hljs-number">8080</span>)));<br>        <span class="hljs-comment">// 3.å»ºç«‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥</span><br>        List&lt;SocketChannel&gt; socketChannels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">16</span>);<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> ssc.accept();    <span class="hljs-comment">// ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</span><br>            socketChannels.add(sc);<br>            <span class="hljs-comment">// 4.æ¥æ”¶æ•°æ®</span><br>            <span class="hljs-keyword">for</span> (SocketChannel channel : socketChannels) &#123;<br>                channel.read(buffer);   <span class="hljs-comment">// ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯å‘æ¶ˆæ¯</span><br>                buffer.flip();<br>                <span class="hljs-keyword">while</span> (buffer.hasRemaining()) &#123;<br>                    System.out.print((<span class="hljs-type">char</span>) buffer.get());<br>                &#125;<br>                System.out.println();<br>                buffer.clear();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> SocketChannel.open();<br>        sc.connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br>        sc.write(StandardCharsets.UTF_8.encode(<span class="hljs-string">&quot;asd&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>éé˜»å¡æ¨¡å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¾ç½®æœåŠ¡å™¨ç«¯ä¸ºéé˜»å¡æ¨¡å¼</span><br>ssc.configureBlocking(<span class="hljs-literal">false</span>);<br><span class="hljs-comment">// å½±å“çš„æ˜¯acceptï¼Œé˜»å¡æ¨¡å¼ä¸‹ä¼šåœä¸‹æ¥ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</span><br><span class="hljs-comment">// éé˜»å¡æ¨¡å¼ä¸‹æ²¡æœ‰è¿æ¥ä¼šè¿”å›null</span><br><span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> ssc.accept();<br><br><span class="hljs-comment">// è®¾ç½®å®¢æˆ·ç«¯è¿æ¥ä¸ºéé˜»å¡</span><br>sc.configureBlocking(<span class="hljs-literal">false</span>);<br><span class="hljs-comment">// å½±å“çš„æ˜¯readï¼Œä¸ä¼šåœä¸‹æ¥ç­‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span><br>channel.read(buffer);<br></code></pre></td></tr></table></figure><h5 id="Selector-1"><a href="#Selector-1" class="headerlink" title="Selector"></a>Selector</h5><p>å¤šè·¯å¤ç”¨ï¼šå•çº¿ç¨‹é…åˆSelectorå®Œæˆå¯¹å¤šä¸ªChannelå¯è¯»å†™äº‹ä»¶çš„ç›‘æ§</p><h6 id="äº‹ä»¶çš„ç§ç±»"><a href="#äº‹ä»¶çš„ç§ç±»" class="headerlink" title="äº‹ä»¶çš„ç§ç±»"></a>äº‹ä»¶çš„ç§ç±»</h6><ol><li>acceptï¼šæœåŠ¡ç«¯åœ¨æœ‰è¿æ¥è¯·æ±‚æ—¶è§¦å‘</li><li>connectï¼šå®¢æˆ·ç«¯è¿æ¥å»ºç«‹åè§¦å‘</li><li>readï¼šå®¢æˆ·ç«¯å‘é€æ¥æ¶ˆæ¯ã€å®¢æˆ·ç«¯æ­£å¸¸&#x2F;å¼‚å¸¸å…³é—­æ—¶è§¦å‘ï¼Œå‘é€æ•°æ®è¶…è¿‡ç¼“å†²åŒºä¼šè§¦å‘å¤šæ¬¡</li><li>writeï¼šå¯å†™äº‹ä»¶</li></ol><h6 id="å¤„ç†è¿æ¥å’Œè¯»äº‹ä»¶"><a href="#å¤„ç†è¿æ¥å’Œè¯»äº‹ä»¶" class="headerlink" title="å¤„ç†è¿æ¥å’Œè¯»äº‹ä»¶"></a>å¤„ç†è¿æ¥å’Œè¯»äº‹ä»¶</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// selectorç®¡ç†channel</span><br>        <span class="hljs-type">Selector</span> <span class="hljs-variable">selector</span> <span class="hljs-operator">=</span> Selector.open();<br>        <span class="hljs-type">ServerSocketChannel</span> <span class="hljs-variable">ssc</span> <span class="hljs-operator">=</span> ServerSocketChannel.open();<br>        ssc.configureBlocking(<span class="hljs-literal">false</span>);<br><br>        <span class="hljs-comment">// æ³¨å†Œåˆ°selectorä¸Š</span><br>        <span class="hljs-comment">// é€šè¿‡SelectionKeyå¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªchannelå‘ç”Ÿäº†å“ªä¸ªäº‹ä»¶</span><br>        <span class="hljs-comment">// å…³æ³¨acceptäº‹ä»¶</span><br>        ssc.register(selector, SelectionKey.OP_ACCEPT, <span class="hljs-literal">null</span>);<br><br>        ssc.bind(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>((<span class="hljs-number">8080</span>)));<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-comment">// æ²¡æœ‰å‘ç”Ÿäº‹ä»¶å°±é˜»å¡</span><br>            selector.select();<br><br>            <span class="hljs-comment">// å¤„ç†äº‹ä»¶ï¼Œselector.selectedKeys()è·å–æ‰€æœ‰å‘ç”Ÿçš„äº‹ä»¶</span><br>            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();<br>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                <span class="hljs-type">SelectionKey</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> iterator.next();<br>                <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                    <span class="hljs-comment">// å¤„ç†è¿æ¥äº‹ä»¶</span><br>                    <span class="hljs-type">ServerSocketChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> (ServerSocketChannel) key.channel();<br>                    <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> channel.accept();<span class="hljs-comment">// ä¸å¤„ç†(acceptæˆ–cancel)keyä¼šé‡æ–°åŠ åˆ°keysä¸­</span><br><br>                    <span class="hljs-comment">// æŠŠå®¢æˆ·ç«¯Channelæ³¨å†Œåˆ°selectorä¸Š</span><br>                    sc.configureBlocking(<span class="hljs-literal">false</span>);<br>                    sc.register(selector, SelectionKey.OP_READ, <span class="hljs-literal">null</span>);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                    <span class="hljs-comment">// å¤„ç†è¯»äº‹ä»¶</span><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> (SocketChannel) key.channel();<br>                        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">16</span>);<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">read</span> <span class="hljs-operator">=</span> channel.read(buffer);    <span class="hljs-comment">// æ­£å¸¸æ–­å¼€è¿”å›-1</span><br>                        <span class="hljs-keyword">if</span> (read == -<span class="hljs-number">1</span>)<br>                            key.cancel();<br>                        buffer.flip();<br>                        System.out.println(StandardCharsets.UTF_8.decode(buffer));<br>                    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                        System.err.println(<span class="hljs-string">&quot;å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€&quot;</span>);<br>                        key.cancel();   <span class="hljs-comment">// æ²¡æœ‰æ¶ˆè´¹æ‰key(read)ï¼Œéœ€è¦æ‰‹åŠ¨å–æ¶ˆ</span><br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-comment">// selectoræ£€æµ‹åˆ°äº‹ä»¶åæŠŠkeyåŠ åˆ°keysä¸­ä¸ä¼šä¸»åŠ¨åˆ é™¤</span><br>                <span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨åˆ é™¤</span><br>                iterator.remove();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="å¤„ç†å†™äº‹ä»¶"><a href="#å¤„ç†å†™äº‹ä»¶" class="headerlink" title="å¤„ç†å†™äº‹ä»¶"></a>å¤„ç†å†™äº‹ä»¶</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ServerSocketChannel</span> <span class="hljs-variable">ssc</span> <span class="hljs-operator">=</span> ServerSocketChannel.open();<br>        ssc.configureBlocking(<span class="hljs-literal">false</span>);<br><br>        <span class="hljs-type">Selector</span> <span class="hljs-variable">selector</span> <span class="hljs-operator">=</span> Selector.open();<br><br>        ssc.register(selector, SelectionKey.OP_ACCEPT, <span class="hljs-literal">null</span>);<br>        ssc.bind(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-number">8080</span>));<br><br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            selector.select();<br><br>            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();<br>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                <span class="hljs-type">SelectionKey</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> iterator.next();<br>                iterator.remove();<br>                <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                    <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> ssc.accept();<br>                    sc.configureBlocking(<span class="hljs-literal">false</span>);<br>                    <span class="hljs-type">SelectionKey</span> <span class="hljs-variable">scKey</span> <span class="hljs-operator">=</span> sc.register(selector, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>);<br><br>                    <span class="hljs-comment">// å‘é€æ•°æ®</span><br>                    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30000000</span>; i++) &#123;<br>                        sb.append(<span class="hljs-string">&quot;a&quot;</span>);<br>                    &#125;<br>                    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> Charset.defaultCharset().encode(sb.toString());<br>                    sc.write(buffer);<br><br>                    <span class="hljs-keyword">if</span> (buffer.hasRemaining()) &#123;<br>                        <span class="hljs-comment">// å…³æ³¨å†™äº‹ä»¶</span><br>                        scKey.interestOps(scKey.interestOps() + SelectionKey.OP_WRITE);<br>                        scKey.attach(buffer);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isWritable()) &#123;<br>                    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span>(ByteBuffer) key.attachment();<br>                    <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> (SocketChannel) key.channel();<br><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">write</span> <span class="hljs-operator">=</span> sc.write(buffer);<br>                    System.out.println(write);<br>                    <span class="hljs-comment">// é‡Šæ”¾è¯»å®Œçš„bufferï¼Œä¸å†å…³æ³¨å†™äº‹ä»¶</span><br>                    <span class="hljs-keyword">if</span> (!buffer.hasRemaining()) &#123;<br>                        key.attach(<span class="hljs-literal">null</span>);<br>                        key.interestOps(key.interestOps() - SelectionKey.OP_WRITE);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> SocketChannel.open();<br>        sc.connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">1026</span> * <span class="hljs-number">1024</span>);<br>            count += sc.read(buffer);<br>            System.out.println(count);<br>            buffer.clear();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¶ˆæ¯è¾¹ç•Œé—®é¢˜"><a href="#æ¶ˆæ¯è¾¹ç•Œé—®é¢˜" class="headerlink" title="æ¶ˆæ¯è¾¹ç•Œé—®é¢˜"></a>æ¶ˆæ¯è¾¹ç•Œé—®é¢˜</h5><p>utf-8ç¼–ç ä¸‹æ±‰å­—å ä¸‰ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ²¡æœ‰è¯»å…¨å°±ä¼šäº§ç”Ÿä¹±ç </p><p><strong>å¤„ç†æ–¹å¼</strong></p><ol><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çº¦å®šå›ºå®šé•¿åº¦çš„æ¶ˆæ¯æ ¼å¼ã€‚ç¼ºç‚¹ï¼šæµªè´¹ç©ºé—´</li><li>åœ¨æ¶ˆæ¯ä¸­åŠ åˆ†éš”ç¬¦ï¼Œæ ¹æ®åˆ†éš”ç¬¦ä¹‹é—´çš„æ¶ˆæ¯é•¿åº¦åˆ†é…bufferã€‚ç¼ºç‚¹ï¼šæ…¢</li><li>å¸¦å¤´ç»“ç‚¹ï¼Œå¤´ç»“ç‚¹é‡Œæœ‰åç»­å†…å®¹çš„é•¿åº¦ä¿¡æ¯ï¼Œæ ¹æ®é•¿åº¦åˆ†é…ä¸åŒé•¿åº¦çš„bufferã€‚<ul><li>TLVæ ¼å¼ï¼šType Length Value</li><li>Http1.1æ˜¯TLVæ ¼å¼</li><li>Http2.0æ˜¯LTVæ ¼å¼</li></ul></li></ol><h5 id="å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="å¤šçº¿ç¨‹ä¼˜åŒ–"></a>å¤šçº¿ç¨‹ä¼˜åŒ–</h5><p>å¥½å¤„ï¼š</p><ol><li>å……åˆ†åˆ©ç”¨å¤šæ ¸cpuèµ„æº</li><li>å’Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiThreadServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„çº¿ç¨‹</span><br>        Thread.currentThread().setName(<span class="hljs-string">&quot;boss&quot;</span>);<br>        <span class="hljs-type">ServerSocketChannel</span> <span class="hljs-variable">ssc</span> <span class="hljs-operator">=</span> ServerSocketChannel.open();<br>        ssc.configureBlocking(<span class="hljs-literal">false</span>);<br>        <span class="hljs-type">Selector</span> <span class="hljs-variable">boss</span> <span class="hljs-operator">=</span> Selector.open();<br>        ssc.register(boss, SelectionKey.OP_ACCEPT, <span class="hljs-literal">null</span>);<br>        ssc.bind(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-number">8080</span>));<br>        <span class="hljs-comment">// åˆ›å»ºworkerçº¿ç¨‹æ± </span><br>        Worker[] workers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>[<span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; workers.length; i++) &#123;<br>            workers[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">&quot;worker-&quot;</span> + i);<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            boss.select();<br>            Iterator&lt;SelectionKey&gt; iterator = boss.selectedKeys().iterator();<br>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                <span class="hljs-type">SelectionKey</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> iterator.next();<br>                iterator.remove();<br>                <span class="hljs-keyword">if</span> (key.isAcceptable()) &#123;<br>                    <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> ssc.accept();<br>                    sc.configureBlocking(<span class="hljs-literal">false</span>);<br>                    workers[index].register(sc);<br>                    index = (index + <span class="hljs-number">1</span>) % workers.length;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br>        <span class="hljs-comment">// å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹</span><br>        <span class="hljs-keyword">private</span> Thread thread;<br>        <span class="hljs-keyword">private</span> Selector selector;<br>        <span class="hljs-keyword">private</span> String name;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-comment">// æ¶ˆæ¯é˜Ÿåˆ—</span><br>        <span class="hljs-keyword">private</span> ConcurrentLinkedQueue&lt;Runnable&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLinkedQueue</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Worker</span><span class="hljs-params">(String name)</span> &#123;<br>            <span class="hljs-built_in">this</span>.name = name;<br>        &#125;<br><br>        <span class="hljs-comment">// åˆå§‹åŒ–çº¿ç¨‹å’Œselector</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(SocketChannel sc)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            <span class="hljs-keyword">if</span> (!start) &#123;<br>                selector = Selector.open();<br>                thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-built_in">this</span>, name);<br>                thread.start();<br>                start = <span class="hljs-literal">true</span>;<br>            &#125;<br>            queue.offer(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    sc.register(selector, SelectionKey.OP_READ, <span class="hljs-literal">null</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (ClosedChannelException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;);<br>            <span class="hljs-comment">// selectoråœ¨select()ä¸Šé˜»å¡ç€</span><br>            <span class="hljs-comment">// éœ€è¦å”¤é†’selector</span><br>            selector.wakeup();<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    selector.select();<br>                    <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> queue.poll();<br>                    <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-comment">// æ‰§è¡Œscæ³¨å†Œåˆ°selector</span><br>                        <span class="hljs-comment">// å¿…é¡»è¦åœ¨selectoræ‰§è¡Œselect()ä¹‹åæ³¨å†Œ</span><br>                        task.run();<br>                    &#125;<br>                    Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();<br>                    <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                        <span class="hljs-type">SelectionKey</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> iterator.next();<br>                        iterator.remove();<br>                        <span class="hljs-keyword">if</span> (key.isReadable()) &#123;<br>                            <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">16</span>);<br>                            <span class="hljs-type">SocketChannel</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> (SocketChannel) key.channel();<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">read</span> <span class="hljs-operator">=</span> sc.read(buffer);<br>                            buffer.flip();<br>                            System.out.println(<span class="hljs-built_in">this</span>.name + <span class="hljs-string">&quot; : &quot;</span> + Charset.defaultCharset().decode(buffer));<br>                        &#125;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="NIOå’ŒBIOå¯¹æ¯”"><a href="#NIOå’ŒBIOå¯¹æ¯”" class="headerlink" title="NIOå’ŒBIOå¯¹æ¯”"></a>NIOå’ŒBIOå¯¹æ¯”</h5><h6 id="stream-å’Œ-channel"><a href="#stream-å’Œ-channel" class="headerlink" title="stream å’Œ channel"></a>stream å’Œ channel</h6><ul><li>ä¸åŒï¼šstreamä¸ä¼šè‡ªåŠ¨ç¼“å†²æ•°æ®ï¼Œchannelä¼šåˆ©ç”¨ç³»ç»Ÿæä¾›çš„å‘é€ç¼“å†²åŒºã€æ¥æ”¶ç¼“å†²åŒº</li><li>streamä»…æ”¯æŒé˜»å¡APIï¼ŒchannelåŒæ—¶æ”¯æŒé˜»å¡ã€éé˜»å¡APIï¼Œç½‘ç»œchannelå¯é…åˆselectorå®ç°å¤šè·¯å¤ç”¨</li><li>ç›¸åŒï¼šå‡ä¸ºå…¨åŒå·¥ï¼ˆè¯»å†™å¯åŒæ—¶è¿›è¡Œï¼‰</li></ul><h4 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a>é›¶æ‹·è´</h4><blockquote><p>é›¶æ‹·è´æŒ‡çš„æ˜¯ä¸éœ€è¦æŠŠæ•°æ®æ‹·è´åˆ°jvmä¸­</p></blockquote><p>ä¸ä½¿ç”¨é›¶æ‹·è´æ•°æ®ä¸­å…±å¤åˆ¶äº†4æ¬¡ï¼Œåˆ‡æ¢ç”¨æˆ·æ€&#x2F;å†…æ ¸æ€3æ¬¡</p><p>â€‹<img src="/img/inter_img/%E9%9B%B6%E6%8B%B7%E8%B4%9D1.png"></p><p>ä½¿ç”¨DirectBufferè®©ç”¨æˆ·ç¼“å†²åŒºå’Œå†…æ ¸ç¼“å†²åŒºå…±ç”¨ä¸€å—å†…å­˜ï¼Œå‡å°‘ä¸€æ¬¡æ‹·è´</p><p>â€‹<img src="/img/inter_img/%E9%9B%B6%E6%8B%B7%E8%B4%9D2.png"></p><p>ç›´æ¥ä»å†…æ ¸ç¼“å†²åŒºå‘å®¢æˆ·ç«¯çš„soketç¼“å†²åŒºå‘æ•°æ®ï¼Œå‡å°‘ä¸€æ¬¡å†…æ ¸åˆ‡æ¢</p><p>â€‹<img src="/img/inter_img/%E9%9B%B6%E6%8B%B7%E8%B4%9D3.png"></p><p>é›¶æ‹·è´çš„æœ‰ç‚¹æœ‰ï¼š</p><ul><li>æ›´å°‘çš„ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢</li><li>ä¸åˆ©ç”¨cpuè®¡ç®—ï¼ˆDMAï¼‰ï¼Œå‡å°‘cpuç¼“å­˜ä¼ªå…±äº«</li><li>é›¶æ‹·è´é€‚åˆå°æ–‡ä»¶ä¼ è¾“</li></ul><h2 id="Netty-1"><a href="#Netty-1" class="headerlink" title="Netty"></a>Netty</h2><p><strong>Netty</strong>æ˜¯ ä¸€ä¸ª<strong>å¼‚æ­¥äº‹ä»¶é©±åŠ¨</strong>çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œç”¨äº<strong>å¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong>ã€‚</p><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><h4 id="ä¸ºä½•è¦å¼‚æ­¥"><a href="#ä¸ºä½•è¦å¼‚æ­¥" class="headerlink" title="ä¸ºä½•è¦å¼‚æ­¥"></a>ä¸ºä½•è¦å¼‚æ­¥</h4><ol><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆ<strong>å¤šçº¿ç¨‹</strong>ã€å¤šæ ¸cpuæ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ ï¼Œå¼‚æ­¥æé«˜çš„æ˜¯å•ä½æ—¶é—´å†…çš„<strong>ååé‡</strong></li><li>åˆç†è¿›è¡Œ<strong>ä»»åŠ¡æ‹†åˆ†</strong>ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ol><h4 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h4><ol><li><p>å¯¼åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.netty<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>netty-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.59.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æœåŠ¡å™¨ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// å¯åŠ¨å™¨ï¼šç»„è£…nettyç»„ä»¶</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>()<br>            <span class="hljs-comment">// ç»„é‡Œæœ‰è´Ÿè´£å¯è¿æ¥äº‹ä»¶çš„loopï¼Œå’Œè´Ÿè´£å¤„ç†å¯è¯»äº‹ä»¶çš„loop(selector, thread)</span><br>            .group(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>())<br><br>            <span class="hljs-comment">// é€‰æ‹©æœåŠ¡å™¨ç«¯channelçš„å®ç°</span><br>            .channel(NioServerSocketChannel.class)<br><br>            <span class="hljs-comment">// å†³å®šäº†workerï¼ˆchildï¼‰èƒ½æ‰§è¡Œå“ªäº›æ“ä½œ</span><br>            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;NioSocketChannel&gt;() &#123;<br><br>                <span class="hljs-comment">// ç»™å®¢æˆ·ç«¯channelæ·»åŠ handler</span><br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    <span class="hljs-comment">// è§£ç handler  ByteBuf --&gt; å­—ç¬¦ä¸²</span><br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>());<br>                    <span class="hljs-comment">// è‡ªå®šä¹‰handler</span><br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span>() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                            System.out.println(msg);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;)<br>            .bind(<span class="hljs-number">8080</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-comment">// å®¢æˆ·ç«¯å¯åŠ¨å™¨</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>()<br>            .group(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>())<br>            .channel(NioSocketChannel.class)<br>            .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;NioSocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    <span class="hljs-comment">// ç¼–ç handler</span><br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>());<br>                &#125;<br>            &#125;)<br>            <span class="hljs-comment">// å¼‚æ­¥è¿æ¥æœåŠ¡å™¨</span><br>            .connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>))<br>            <span class="hljs-comment">// é˜»å¡æ–¹æ³•ï¼Œè¿æ¥å»ºç«‹åå¾€ä¸‹æ‰§è¡Œ</span><br>            .sync()<br>            <span class="hljs-comment">// å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„channel</span><br>            .channel()<br>            <span class="hljs-comment">// å‘é€æ•°æ®</span><br>            .writeAndFlush(<span class="hljs-string">&quot;Hello World&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h4><h5 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a>EventLoop</h5><p>â€‹EventLoopæœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆselector + threadï¼‰ï¼Œå¤„ç†channelä¸Šå‘ç”Ÿçš„äº‹ä»¶</p><p>â€‹EventLoopGroupæ˜¯ä¸€ç»„EventLoopï¼ŒChannelä¼šç»‘å®šå…¶ä¸­ä¸€ä¸ªEventLoopï¼Œåç»­è¿™ä¸ªChannelä¸Šçš„<strong>io</strong>äº‹ä»¶éƒ½ç”±æ­¤EventLoopæ¥å¤„ç†ï¼ˆä¿è¯ioäº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestEventLoop</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºäº‹ä»¶å¾ªç¯ç»„ï¼Œå¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°</span><br>        <span class="hljs-comment">// NioEventLoopGroupçš„å®ç°å¯ä»¥æ‰§è¡Œioï¼Œæ™®é€šï¼Œå®šæ—¶ä»»åŠ¡</span><br>        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">2</span>);<br>        <span class="hljs-comment">// è·å–EventLoopå¯¹è±¡</span><br>        System.out.println(group.next());<br>        <span class="hljs-comment">// æ‰§è¡Œæ™®é€šä»»åŠ¡</span><br>        group.next().submit(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;task&quot;</span>);<br>        &#125;);<br>        <span class="hljs-comment">// æ‰§è¡Œå®šæ—¶ä»»åŠ¡</span><br>        group.next().scheduleAtFixedRate(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;scheduleï¼š&quot;</span> + LocalTime.now());<br>        &#125;, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹åˆ†å·¥ï¼š</p><ul><li>group(EventLoopGroup, EventLoopGroup)ï¼šå¯ä»¥æŒ‡å®šä¸¤ä¸ªgroupæ¥åˆ†å·¥ï¼Œå‰ä¸€ä¸ªä¸ºç›‘å¬accpetäº‹ä»¶ï¼Œåä¸€ä¸ªä¸ºå¤„ç†è¯»å†™äº‹ä»¶</li><li>addLast(EventExecutorGroup, String, ChannelHandler)ï¼šæŒ‡å®šEventLoopGroupæ‰§è¡Œè¿™ä¸ªå¤„ç†å™¨ï¼›æŒ‡å®šå¤„ç†å™¨åï¼›å¤„ç†å™¨</li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventLoopServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">DefaultEventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultEventLoopGroup</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>()<br>            .group(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">2</span>))<br>            .channel(NioServerSocketChannel.class)<br>            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;NioSocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    ch.pipeline().addLast(<span class="hljs-string">&quot;handler1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span>() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                            <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> (ByteBuf) msg;<br>                            System.out.println(buf.toString(Charset.defaultCharset()));<br>                            <span class="hljs-comment">// ä¼ ç»™ä¸‹ä¸€ä¸ªhandler</span><br>                            ctx.fireChannelRead(msg);<br>                        &#125;<br>                    &#125;).addLast(group, <span class="hljs-string">&quot;handler2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span>() &#123;<br>                        <span class="hljs-comment">// å‰åä¸¤ä¸ªhandleræ‰§è¡Œçš„çº¿ç¨‹ä¸åŒæ—¶ï¼Œç”±ä¸Šä¸€ä¸ªçº¿ç¨‹å‘ä¸€ä¸ªRunnableç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ</span><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                            <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> (ByteBuf) msg;<br>                            System.out.println(buf.toString(Charset.defaultCharset()));<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;)<br>            .bind(<span class="hljs-number">8080</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Channel-1"><a href="#Channel-1" class="headerlink" title="Channel"></a>Channel</h5><p>è¯»å†™æ•°æ®çš„åŒå‘é€šé“</p><p>ä¸»è¦æ–¹æ³•ï¼š</p><ul><li>close()</li><li>closeFuture()ï¼šå…³é—­channelåè°ƒç”¨çš„æ–¹æ³•</li><li>pipeline()ï¼šæ·»åŠ å¤„ç†å™¨</li><li>write()ï¼šå†™å…¥æ•°æ®åˆ°ç¼“å†²åŒº</li><li>writeAndFlush()ï¼šå†™å…¥æ•°æ®å¹¶åˆ·å‡º</li></ul><p><strong>å¤„ç†è¿æ¥ç»“æœ</strong></p><p>connect()æ˜¯éé˜»å¡æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡sync()å½“å‰çº¿ç¨‹é˜»å¡ç­‰å¾…è¿æ¥å»ºç«‹ï¼Œæˆ–è€…addListener()æ·»åŠ listenerè®©å…¶ä»–çº¿ç¨‹ç­‰å¾…è¿æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventLoopClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, IOException &#123;<br>        <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">channelFuture</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>()<br>            .group(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>())<br>            .channel(NioSocketChannel.class)<br>            .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;NioSocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>());<br>                &#125;<br>            &#125;)<br>            .connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>));<br><br>        channelFuture.addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelFutureListener</span>() &#123;<br>            <span class="hljs-comment">// å®Œæˆè¿æ¥åä¼šè°ƒç”¨operationComplete</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operationComplete</span><span class="hljs-params">(ChannelFuture future)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                future.channel().writeAndFlush(<span class="hljs-string">&quot;www&quot;</span>);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¤„ç†å…³é—­</strong></p><p>è°ƒç”¨channel.close()å…³é—­channelåï¼Œå¯ä»¥ç”¨<code>ChannelFuture future = channel.closeFuture();</code>æ¥è¿›è¡Œå–„åå¤„ç†</p><p>sync()åŒæ­¥å¤„ç†ï¼ŒaddListener()å¼‚æ­¥å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‰ç•¥</span><br><span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> channelFuture.channel();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>    <span class="hljs-type">Scanner</span> <span class="hljs-variable">sc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        System.out.print(<span class="hljs-string">&quot;: &quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> sc.nextLine();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;q&quot;</span>.equals(msg)) &#123;<br>            channel.close();<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        channel.writeAndFlush(msg);<br>    &#125;<br>&#125;, <span class="hljs-string">&quot;input&quot;</span>).start();<br><br><span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> channel.closeFuture();<br>future.sync();<br>System.out.println(<span class="hljs-string">&quot;å–„åå·¥ä½œ&quot;</span>);<br></code></pre></td></tr></table></figure><h5 id="Future-amp-Promise"><a href="#Future-amp-Promise" class="headerlink" title="Future &amp; Promise"></a>Future &amp; Promise</h5><p>ç»§æ‰¿å…³ç³»ï¼šjdkçš„Future &lt;â€“ nettyçš„Future &lt;â€“ Promise</p><ul><li>jdkçš„Futureåªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸ</li><li>nettyçš„Futureå¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸ</li><li>Promiseä¸ä»…æœ‰Futureçš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ª<strong>çº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestJdkFuture</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>        Future&lt;Integer&gt; future = service.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-comment">// åŒæ­¥ç­‰å¾…</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> future.get();<br>        System.out.println(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestNettyFuture</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">NioEventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">2</span>);<br>        <span class="hljs-type">EventLoop</span> <span class="hljs-variable">eventLoop</span> <span class="hljs-operator">=</span> group.next();<br>        Future&lt;Integer&gt; future = eventLoop.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>            &#125;<br>        &#125;);<br>        <span class="hljs-comment">// å¼‚æ­¥ç­‰å¾…ç»“æœ</span><br>        future.addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericFutureListener</span>&lt;Future&lt;? <span class="hljs-built_in">super</span> Integer&gt;&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">operationComplete</span><span class="hljs-params">(Future&lt;? <span class="hljs-built_in">super</span> Integer&gt; future)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                System.out.println(Thread.currentThread() + <span class="hljs-string">&quot;:&quot;</span> + future.get());<br>            &#125;<br>        &#125;);<br>        System.out.println(Thread.currentThread());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPromise</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">NioEventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">2</span>);<br>        DefaultPromise&lt;Integer&gt; promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultPromise</span>&lt;&gt;(group.next());<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            <span class="hljs-comment">// å¾€promiseé‡Œè£…ç»“æœ</span><br>            promise.setSuccess(<span class="hljs-number">1</span>);<br>        &#125;).start();<br><br>        System.out.println(promise.get());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Handler-amp-Pipeline"><a href="#Handler-amp-Pipeline" class="headerlink" title="Handler &amp; Pipeline"></a>Handler &amp; Pipeline</h5><p>Pipelineç±»ä¼¼æµæ°´çº¿ï¼Œhandlerä¸ºæµæ°´çº¿ä¸Šçš„ä¸€é“é“å·¥åº</p><p>handleråˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§</p><ul><li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯<code>ChannelInBoundHandlerAdapter</code>çš„å­ç±»ï¼Œè¯»å–å®¢æˆ·ç«¯æ•°æ®æ—¶è§¦å‘ï¼Œä¹Ÿå¯ä»¥å‘å®¢æˆ·ç«¯å†™æ•°æ®</li><li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯<code>ChannelOutBoundHandlerAdapter</code>çš„å­ç±»ï¼Œå‘å®¢æˆ·ç«¯å†™å›æ•°æ®æ—¶è§¦å‘ï¼Œ<em><strong>å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œé¡ºåºé€‚åˆå…¥ç«™å¤„ç†å™¨ç›¸åçš„</strong></em></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPipeline</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>()<br>            .group(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>())<br>            .channel(NioServerSocketChannel.class)<br>            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;NioSocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(NioSocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                    <span class="hljs-type">ChannelPipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> ch.pipeline();<br>                    <span class="hljs-comment">// åŠ åœ¨ head -&gt; ... -&gt; h1 -&gt; tail</span><br>                    pipeline.addLast(<span class="hljs-string">&quot;h1&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span>()&#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                            System.out.println(<span class="hljs-number">1</span>);<br>                            <span class="hljs-built_in">super</span>.channelRead(ctx, msg);<br>                        &#125;<br>                    &#125;);<br>                    <span class="hljs-comment">// å‡ºç«™å¤„ç†å™¨åœ¨å¾€channelä¸­å†™æ•°æ®æ—¶è§¦å‘</span><br>                    <span class="hljs-comment">// å‡ºç«™çš„å¤„ç†é¡ºåºå’Œå…¥ç«™æ—¶ç›¸å</span><br>                    pipeline.addLast(<span class="hljs-string">&quot;h2&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelOutboundHandlerAdapter</span>()&#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                            System.out.println(<span class="hljs-number">2</span>);<br>                            <span class="hljs-built_in">super</span>.write(ctx, msg, promise);<br>                        &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;)<br>            .bind(<span class="hljs-number">8080</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ByteBuf"><a href="#ByteBuf" class="headerlink" title="ByteBuf"></a>ByteBuf</h5><p>æ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…</p><h6 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h6><ul><li>æ± åŒ–</li><li>è¯»å†™æŒ‡é’ˆåˆ†ç¦»</li><li>å¯ä»¥è‡ªåŠ¨æ‰©å®¹</li><li>æ”¯æŒé“¾å¼è°ƒç”¨</li><li>æ”¯æŒæµ…æ‹·è´</li></ul><h6 id="è‡ªåŠ¨æ‰©å®¹"><a href="#è‡ªåŠ¨æ‰©å®¹" class="headerlink" title="è‡ªåŠ¨æ‰©å®¹"></a>è‡ªåŠ¨æ‰©å®¹</h6><p>å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª16çš„æ•´æ•°å€æ‰©å®¹</p><p>å†™å…¥åæ•°æ®å¤§å°è¶…è¿‡512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª2^næ‰©å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestByteBuf</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.buffer();<br>        System.out.println(buf);    <span class="hljs-comment">// èµ·å§‹256å­—èŠ‚å®¹é‡</span><br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">300</span>; i++) &#123;<br>            sb.append(<span class="hljs-string">&quot;a&quot;</span>);<br>        &#125;<br>        buf.writeBytes(sb.toString().getBytes());<br>        System.out.println(buf);    <span class="hljs-comment">// æ‰©å®¹å512å­—èŠ‚å®¹é‡</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="é€‰æ‹©ä½¿ç”¨çš„å†…å­˜"><a href="#é€‰æ‹©ä½¿ç”¨çš„å†…å­˜" class="headerlink" title="é€‰æ‹©ä½¿ç”¨çš„å†…å­˜"></a>é€‰æ‹©ä½¿ç”¨çš„å†…å­˜</h6><p>ä½¿ç”¨å †å†…å­˜ï¼Œå†™å¿«è¯»æ…¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ByteBuf</span> <span class="hljs-variable">byteBuf</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.heapBuffer(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œå†™æ…¢è¯»å¿«</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ByteBuf</span> <span class="hljs-variable">byteBuf</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.directBuffer(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><h6 id="æ± åŒ–"><a href="#æ± åŒ–" class="headerlink" title="æ± åŒ–"></a>æ± åŒ–</h6><p>é€šè¿‡æ± æ¥é‡ç”¨bufï¼Œ4.1åé»˜è®¤å¼€å¯</p><h6 id="å›æ”¶"><a href="#å›æ”¶" class="headerlink" title="å›æ”¶"></a>å›æ”¶</h6><p>æ ¹æ®å®ç°æ–¹å¼ä¸åŒï¼Œå†…å­˜å›æ”¶æ–¹å¼ä¹Ÿä¸åŒ</p><ul><li>UnpooledHeapByteBufï¼šä½¿ç”¨çš„æ˜¯JVMå†…å­˜ï¼Œåªéœ€GCå†…å­˜å›æ”¶å³å¯</li><li>UnpooledDirectByteBufï¼šä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œéœ€è¦ç‰¹æ®Šæ–¹æ³•å›æ”¶</li><li>PooledByteBufï¼šæ± åŒ–ï¼Œä¸ç”¨æ—¶å½’è¿˜å›æ± ä¸­ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜</li></ul><p>æ¯ä¸ªByteBuféƒ½å®ç°ReferenceCountedæ¥å£ï¼Œé€šè¿‡å¼•ç”¨è®¡æ•°æ–¹å¼æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶</p><p>å¦‚æœæ²¡é‡Šæ”¾Bufï¼Œåœ¨å¤„ç†å™¨é“¾çš„å°¾&#x2F;å¤´ä¼šè¢«é‡Šæ”¾</p><h6 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h6><p>å°†ä¸€å—ByteBufåˆ‡æˆé€»è¾‘ä¸Šçš„ä¸¤å—ï¼Œå®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿæ•°æ®çš„æ‹·è´ </p><p>åˆ‡ç‰‡æ˜¯ä¸èƒ½æ‰©å®¹çš„</p><p>åŸbufé‡Šæ”¾å†…å­˜ä¼šå½±å“åˆ‡ç‰‡ï¼Œå¯ä»¥é€šè¿‡retain()æ–¹æ³•æ¥è®¡æ•°åŠ 1ä»è€Œä¸ä¼šé‡Šæ”¾å†…å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestByteBuf</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>        buf.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br><br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">f1</span> <span class="hljs-operator">=</span> buf.slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);<br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">f2</span> <span class="hljs-operator">=</span> buf.slice(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>);<br>        System.out.println(f1);<br>        System.out.println(f2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="åˆå¹¶"><a href="#åˆå¹¶" class="headerlink" title="åˆå¹¶"></a>åˆå¹¶</h6><p>å°†å¤šå—ByteBufåˆå¹¶æˆé€»è¾‘ä¸Šçš„ä¸€å—ï¼Œå®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿæ•°æ®çš„æ‹·è´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestByteBuf</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf1</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>        buf1.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br><br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf2</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.buffer(<span class="hljs-number">10</span>);<br>        buf2.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>&#125;);<br><br>        <span class="hljs-type">CompositeByteBuf</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.compositeBuffer();<br>        buffer.addComponent(<span class="hljs-literal">true</span>, buf1);<br>        buffer.addComponent(<span class="hljs-literal">true</span>, buf2);<br><br>        System.out.println(buffer);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><h4 id="ç²˜åŒ…-åŠåŒ…"><a href="#ç²˜åŒ…-åŠåŒ…" class="headerlink" title="ç²˜åŒ… åŠåŒ…"></a>ç²˜åŒ… åŠåŒ…</h4><p><strong>åŸå› </strong>ï¼šç”¨TCPåè®®ä¼ è¾“æ•°æ®ï¼Œç”±äºæ»‘åŠ¨çª—å£ï¼ˆç¼“å†²åŒºï¼‰ä¼ é€çš„æ—¶å€™å¯èƒ½æŠŠä¸€æ®µæ•°æ®åˆ†æˆäº†å‡ ä»½ï¼Œå¯¼è‡´æ¥æ”¶æ–¹æ”¶åˆ°çš„æ•°æ®ä¸å…¨ï¼ˆåŠåŒ…ï¼‰ï¼Œæˆ–å‡ æ¡æ•°æ®ä¸€èµ·å‘è¿‡æ¥ï¼ˆç²˜åŒ…ï¼‰ï¼›ByteBufå¤§å°ä¹Ÿç±»ä¼¼</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><ol><li>å®šé•¿è§£ç å™¨ï¼š<code>ch.pipline().addLast(new FixedLengthFrameDecode(é•¿åº¦))</code>è§„å®šæ¯æ¡æ¶ˆæ¯çš„é•¿åº¦å›ºå®š<ul><li>ç¼ºç‚¹ï¼šå¯èƒ½é€ æˆå¸¦å®½çš„æµªè´¹</li></ul></li><li>åˆ†éš”ç¬¦ï¼š<code>ch.pipline().addLast(new LineBaseFrameDecoder(é™å®šæœ€å¤§é•¿åº¦))</code>ï¼Œä»¥æ¢è¡Œç¬¦ä¸ºåˆ†éš”ç¬¦<ul><li>æ•ˆç‡ä½</li></ul></li><li>LTCè§£ç å™¨ï¼šç±»ä¼¼æŠ¥å¤´ï¼Œå¦‚åŒ…å«å†…å®¹é•¿åº¦ä¿¡æ¯ç­‰</li></ol><h4 id="åè®®"><a href="#åè®®" class="headerlink" title="åè®®"></a>åè®®</h4><p>å®ä¾‹ï¼šå¤„ç†httpçš„å…¥ç«™ä¿¡æ¯å’Œè¿”å›ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestHttp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">NioEventLoopGroup</span> <span class="hljs-variable">boss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();<br>        <span class="hljs-type">NioEventLoopGroup</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">channelFuture</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>()<br>                .group(boss, worker)<br>                .channel(NioServerSocketChannel.class)<br>                .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                        <span class="hljs-comment">// httpåè®®ç¼–ç è§£ç å¤„ç†å™¨</span><br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());<br>                        <span class="hljs-comment">// æŒ‡å®šå¤„ç†HttpRequestçš„ä¿¡æ¯</span><br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;HttpRequest&gt;() &#123;<br>                            <span class="hljs-meta">@Override</span><br>                            <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, HttpRequest msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                                System.out.println(msg.uri());<br><br>                                <span class="hljs-type">DefaultFullHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpResponse</span>(msg.getProtocolVersion(), HttpResponseStatus.OK);<br>                                <span class="hljs-type">byte</span>[] bytes = <span class="hljs-string">&quot;&lt;h1&gt;Hello&lt;/h1&gt;&quot;</span>.getBytes();<br>                                response.headers().setInt(HttpHeaderNames.CONTENT_LENGTH, bytes.length);<br>                                response.content().writeBytes(bytes);<br>                                ctx.writeAndFlush(response);<br>                            &#125;<br>                        &#125;);<br>                    &#125;<br>                &#125;)<br>                .bind(<span class="hljs-number">8080</span>)<br>                .sync();<br>            channelFuture.channel().closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            boss.shutdownGracefully();<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è‡ªå®šä¹‰åè®®"><a href="#è‡ªå®šä¹‰åè®®" class="headerlink" title="è‡ªå®šä¹‰åè®®"></a>è‡ªå®šä¹‰åè®®</h5><ol start="0"><li>è¦ç´ </li></ol><p>â€‹<img src="/img/inter_img/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E8%A6%81%E7%B4%A0.png"></p><ol><li><p>æ¶ˆæ¯ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®æ¶ˆæ¯ç±»å‹å­—èŠ‚ï¼Œè·å¾—å¯¹åº”çš„æ¶ˆæ¯ class</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> messageType æ¶ˆæ¯ç±»å‹å­—èŠ‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ¶ˆæ¯ class</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Message</span>&gt; getMessageClass(<span class="hljs-type">int</span> messageType) &#123;<br>        <span class="hljs-keyword">return</span> messageClasses.get(messageType);<br>    &#125;<br><br>    <span class="hljs-comment">// è¯·æ±‚åºåˆ—å·</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> sequenceId;<br><br>    <span class="hljs-comment">// æ¶ˆæ¯ç±»å‹</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> messageType;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMessageType</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">// æŒ‡ä»¤ç±»å‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LoginRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LoginResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ChatRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ChatResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupCreateRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupCreateResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupJoinRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupJoinResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupQuitRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupQuitResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupChatRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupChatResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">11</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupMembersRequestMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GroupMembersResponseMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PingMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PongMessage</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¯·æ±‚ç±»å‹ byte å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RPC_MESSAGE_TYPE_REQUEST</span> <span class="hljs-operator">=</span> <span class="hljs-number">101</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å“åº”ç±»å‹ byte å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>  <span class="hljs-variable">RPC_MESSAGE_TYPE_RESPONSE</span> <span class="hljs-operator">=</span> <span class="hljs-number">102</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Integer, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Message</span>&gt;&gt; messageClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// æŠ½è±¡ç±»çš„å®ç°ç±»</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        messageClasses.put(LoginRequestMessage, LoginRequestMessage.class);<br>        messageClasses.put(LoginResponseMessage, LoginResponseMessage.class);<br>        messageClasses.put(ChatRequestMessage, ChatRequestMessage.class);<br>        messageClasses.put(ChatResponseMessage, ChatResponseMessage.class);<br>        messageClasses.put(GroupCreateRequestMessage, GroupCreateRequestMessage.class);<br>        messageClasses.put(GroupCreateResponseMessage, GroupCreateResponseMessage.class);<br>        messageClasses.put(GroupJoinRequestMessage, GroupJoinRequestMessage.class);<br>        messageClasses.put(GroupJoinResponseMessage, GroupJoinResponseMessage.class);<br>        messageClasses.put(GroupQuitRequestMessage, GroupQuitRequestMessage.class);<br>        messageClasses.put(GroupQuitResponseMessage, GroupQuitResponseMessage.class);<br>        messageClasses.put(GroupChatRequestMessage, GroupChatRequestMessage.class);<br>        messageClasses.put(GroupChatResponseMessage, GroupChatResponseMessage.class);<br>        messageClasses.put(GroupMembersRequestMessage, GroupMembersRequestMessage.class);<br>        messageClasses.put(GroupMembersResponseMessage, GroupMembersResponseMessage.class);<br>        messageClasses.put(RPC_MESSAGE_TYPE_REQUEST, RpcRequestMessage.class);<br>        messageClasses.put(RPC_MESSAGE_TYPE_RESPONSE, RpcResponseMessage.class);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–è§£ç å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageCodec</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ByteToMessageCodec</span>&lt;Message&gt; &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¼–ç æˆè‡ªå®šä¹‰çš„åè®®æ ¼å¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channelHandlerContext</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> msg</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> out</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">encode</span><span class="hljs-params">(ChannelHandlerContext channelHandlerContext, Message msg, ByteBuf out)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// é­”æ•° 5å­—èŠ‚</span><br>        out.writeBytes(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>&#125;);<br>        <span class="hljs-comment">// ç‰ˆæœ¬å·  1å­—èŠ‚</span><br>        out.writeByte(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// åºåˆ—åŒ–æ–¹å¼ï¼ŒæŒ‡å®š 0 jdkï¼Œ1 json  1å­—èŠ‚</span><br>        out.writeByte(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// æŒ‡ä»¤ç±»å‹  1å­—èŠ‚</span><br>        out.writeByte(msg.getMessageType());<br>        <span class="hljs-comment">// è¯·æ±‚åºå·ï¼Œæä¾›å¼‚æ­¥èƒ½åŠ›  4å­—èŠ‚</span><br>        out.writeInt(msg.getSequenceId());<br>        <span class="hljs-comment">// è·å–æ­£æ–‡</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos);<br>        oos.writeObject(msg);<br>        <span class="hljs-type">byte</span>[] bytes = bos.toByteArray();<br>        <span class="hljs-comment">// æ­£æ–‡é•¿åº¦ 4å­—èŠ‚</span><br>        out.writeInt(bytes.length);<br>        <span class="hljs-comment">// æ­£æ–‡</span><br>        out.writeBytes(bytes);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decode</span><span class="hljs-params">(ChannelHandlerContext channelHandlerContext, ByteBuf in, List&lt;Object&gt; out)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// è¯»å–é­”æ•°</span><br>        <span class="hljs-type">byte</span>[] magic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">5</span>];<br>        in.readBytes(magic);<br>        <span class="hljs-comment">// è¯»å–ç‰ˆæœ¬</span><br>        <span class="hljs-type">byte</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> in.readByte();<br>        <span class="hljs-comment">// è¯»å–åºåˆ—åŒ–æ–¹å¼</span><br>        <span class="hljs-type">byte</span> <span class="hljs-variable">serializerType</span> <span class="hljs-operator">=</span> in.readByte();<br>        <span class="hljs-comment">// è¯»å–æŒ‡ä»¤ç±»å‹</span><br>        <span class="hljs-type">byte</span> <span class="hljs-variable">messageType</span> <span class="hljs-operator">=</span> in.readByte();<br>        <span class="hljs-comment">// è¯»å–åºåˆ—å·</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sequenceId</span> <span class="hljs-operator">=</span> in.readInt();<br>        <span class="hljs-comment">// è¯»å–æ­£æ–‡é•¿åº¦</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> in.readInt();<br>        <span class="hljs-comment">// è¯»å–æ­£æ–‡</span><br>        <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[length];<br>        in.readBytes(bytes, <span class="hljs-number">0</span>, length);<br><br>        <span class="hljs-comment">// ååºåˆ—åŒ–æˆMessage</span><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes));<br>        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> (Message) ois.readObject();<br><br>        System.out.println(Arrays.toString(magic));<br>        System.out.println(version);<br>        System.out.println(serializerType);<br>        System.out.println(messageType);<br>        System.out.println(sequenceId);<br>        System.out.println(length);<br>        System.out.println(message);<br><br>        <span class="hljs-comment">// ä¼ ç»™ä¸‹ä¸€ä¸ªhandler</span><br>        out.add(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">EmbeddedChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmbeddedChannel</span>(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LengthFieldBasedFrameDecoder</span>(<span class="hljs-number">1024</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-comment">// è§£å†³ç²˜åŒ…åŠåŒ…</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageCodec</span>());<br><br>        <span class="hljs-comment">// æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯</span><br>        <span class="hljs-type">LoginRequestMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginRequestMessage</span>(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        channel.writeOutbound(message);<br><br>        <span class="hljs-comment">// æ¨¡æ‹Ÿæ¥æ”¶</span><br>        <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> ByteBufAllocator.DEFAULT.buffer();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageCodec</span>().encode(<span class="hljs-literal">null</span>, message, buf);  <span class="hljs-comment">// ç¼–ç åå†™åˆ°buf</span><br>        channel.writeInbound(buf);  <span class="hljs-comment">// å…¥ç«™</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">è¾“å‡º</span><br><span class="hljs-comment">[1, 1, 4, 5, 1]</span><br><span class="hljs-comment">1</span><br><span class="hljs-comment">0</span><br><span class="hljs-comment">0</span><br><span class="hljs-comment">0</span><br><span class="hljs-comment">193</span><br><span class="hljs-comment">LoginRequestMessage(super=Message(sequenceId=0, messageType=0), username=zs, password=123456)</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ç½‘ç»œ</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•</title>
    <link href="/2023/02/23/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/"/>
    <url>/2023/02/23/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><h3 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h3><p>å¦‚æœè§£å†³ä¸€ä¸ªé—®é¢˜éœ€è¦è‹¥å¹²æ­¥éª¤ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªæ­¥éª¤éƒ½é¢ä¸´è‹¥å¹²é€‰é¡¹ï¼Œåˆ™å¯ä»¥å°è¯•å›æº¯</p><p>å›æº¯æ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">dfs</span><span class="hljs-params">(å‚æ•°)</span> &#123;<br>    <span class="hljs-keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;<br>        å­˜æ”¾ç»“æœ;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (é€‰æ‹©å…ƒç´ ) &#123;<br>        æ·»åŠ å…ƒç´ ;<br>        dfs();<br>        æ’¤é”€å…ƒç´ <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å›æº¯æ³•å¸¸ç”¨æ’åºæ¥å‰ªæ</p><h3 id="äºŒè¿›åˆ¶æšä¸¾"><a href="#äºŒè¿›åˆ¶æšä¸¾" class="headerlink" title="äºŒè¿›åˆ¶æšä¸¾"></a>äºŒè¿›åˆ¶æšä¸¾</h3><p>é€šè¿‡äºŒè¿›åˆ¶æ•°çš„0&#x2F;1 è¡¨ç¤º é€‰æ‹©&#x2F;å˜æ¢ å¯¹åº”ä½ç½®ä¸Šçš„å­—ç¬¦&#x2F;æ•°å­—</p><p>ä¾‹å¦‚æ±‚å­—ç¬¦ä¸²çš„æ‰€æœ‰å­é›†</p><p>è‹¥å­—ç¬¦ä¸²é•¿ä¸º3ï¼Œåˆ™å¯ä»¥é€‰æ‹©æˆ–ä¸é€‰æ‹©è¿™ä¸ªä½ç½®ä¸Šçš„å­—ç¬¦æ¥ç»„æˆå­é›†ï¼Œæœ‰2 ^ 3ç§æ„æˆæ–¹å¼</p><p>å¯ä»¥é€šè¿‡0~2^nçš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºé€‰æˆ–è€…ä¸é€‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">count</span><span class="hljs-params">(String s)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> s.length();<br>    <br>    List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; (<span class="hljs-number">1</span> &lt;&lt; n); ++i) &#123;<span class="hljs-comment">//1 &lt;&lt; n ç­‰ä»·äº 2^n</span><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; n; ++j) &#123;<br>            <span class="hljs-keyword">if</span> (((i &gt;&gt; j) &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">1</span>) &#123;<span class="hljs-comment">// åˆ¤æ–­è¯¥ä½ä¸ŠäºŒè¿›åˆ¶æ•°</span><br>                sb.append(s.charAt(j));<br>            &#125;<br>        &#125;<br>        list.add(sb.toString());<br>    &#125;<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>äºŒè¿›åˆ¶æšä¸¾é€‚åˆnæ¯”è¾ƒå°çš„é¢˜ï¼Œnå¤§çš„è¯å¾—é€šè¿‡dfsçš„å‰ªææ¥é™ä½å¤æ‚åº¦</strong></p><p><strong>ä¾‹é¢˜</strong></p><p><a href="https://leetcode.cn/problems/letter-case-permutation/">784. å­—æ¯å¤§å°å†™å…¨æ’åˆ— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h3 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h3><p><a href="https://www.runoob.com/data-structures/union-find-basic.html">å¹¶æŸ¥é›†åŸºç¡€ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><p>æ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnionFind</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] parent;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UnionFind</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>        parent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];<br>        <span class="hljs-built_in">this</span>.size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ·»åŠ å…ƒç´ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        parent[x] = x;<br>        size++;<br>    &#125;<br><br>    <span class="hljs-comment">// æŸ¥æ‰¾xå¯¹åº”çš„é›†åˆç¼–å·</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">if</span> (parent[x] != x)<br>            parent[x] = find(parent[x]);<br>        <span class="hljs-keyword">return</span> parent[x];<br>    &#125;<br><br>    <span class="hljs-comment">// æŸ¥çœ‹pï¼Œqæ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isConnected</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        <span class="hljs-keyword">return</span> find(x) == find(y);<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå¹¶ä¸¤ä¸ªå…ƒç´ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        x = find(x);<br>        y = find(y);<br>        <span class="hljs-keyword">if</span> (x != y) &#123;<br>            parent[x] = parent[y];<br>            size--;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¾‹é¢˜</strong></p><p><a href="https://leetcode.cn/problems/minimum-score-of-a-path-between-two-cities/">6255. ä¸¤ä¸ªåŸå¸‚é—´è·¯å¾„çš„æœ€å°åˆ†æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h3 id="æ ¼é›·ç "><a href="#æ ¼é›·ç " class="headerlink" title="æ ¼é›·ç "></a>æ ¼é›·ç </h3><p><a href="https://leetcode.cn/problems/gray-code/">89. æ ¼é›·ç¼–ç  - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><p>åœ¨æ ¼é›·ç ä¸­ï¼Œä»»æ„ä¸¤ä¸ªç›¸é‚»çš„ä»£ç åªæœ‰ä¸€ä½äºŒè¿›åˆ¶æ•°ä¸åŒï¼Œæœ€å¤§ç ä¸æœ€å°ç ä¹‹é—´ä¹Ÿä»…ä¸€ä½ä¸åŒ</p><p>è½¬æ¢æ–¹å¼ï¼šæ™®é€šäºŒè¿›åˆ¶è®°ä¸ºBn-1 Bn-2 â€¦ B0ï¼Œæ ¼é›·ç è®°ä¸ºGn-1 Gn-2 â€¦ G0       </p><p>Gn-1 &#x3D; Bn-1;</p><p>Gi &#x3D; Bi+1 å¼‚æˆ– Bi  (0 &lt;&#x3D; i &lt;&#x3D; n - 2)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">grayCode</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    List&lt;Integer&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; (<span class="hljs-type">int</span>)Math.pow(<span class="hljs-number">2</span>, n); ++i) &#123;<br>        res.add((i &gt;&gt; <span class="hljs-number">1</span>) ^ i);<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ ‘éå†"><a href="#æ ‘éå†" class="headerlink" title="æ ‘éå†"></a>æ ‘éå†</h3><h4 id="é€’å½’å†™æ³•"><a href="#é€’å½’å†™æ³•" class="headerlink" title="é€’å½’å†™æ³•"></a>é€’å½’å†™æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸­åº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">LDR</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    LDR(node.left);<br>    System.out.println(node.val);<br>    LDR(node.right);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å…ˆåº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">DLR</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    System.out.println(node.val);<br>    DLR(node.left);<br>    DLR(node.right);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ååº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">LRD</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    LRD(node.left);<br>    LRD(node.right);<br>    System.out.println(node.val);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è¿­ä»£å†™æ³•"><a href="#è¿­ä»£å†™æ³•" class="headerlink" title="è¿­ä»£å†™æ³•"></a>è¿­ä»£å†™æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸­åº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">LDR</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    Deque&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br>    <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span> || !stack.isEmpty()) &#123;<br>        <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node);<br>            node = node.left;<br>        &#125;<br>        node = stack.poll();<br>        System.out.println(node.val);<br>        node = node.right;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å…ˆåº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">DLR</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    Deque&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br>    <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span> || !stack.isEmpty()) &#123;<br>        <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(node.val);<br>            stack.push(node);<br>            node = node.left;<br>        &#125;<br>        node = stack.poll();<br>        node = node.right;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ååº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">LRD</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    Deque&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br>    <span class="hljs-comment">// è®°å½•ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹</span><br>    <span class="hljs-type">TreeNode</span> <span class="hljs-variable">pre</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span> || !stack.isEmpty()) &#123;<br>        <span class="hljs-keyword">while</span> (node != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node);<br>            node = node.left;<br>        &#125;<br>     node = stack.peek();<br>        <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span> &amp;&amp; node.right != prev) &#123;<br>            node = node.right;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            stack.poll();<br>            System.out.println(node.val);<br>            prev = node;<br>            node = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h3><p>è®¾æ•°ç»„numsï¼Œå‰ç¼€å’Œæ•°ç»„sï¼Œåˆ™s[i + 1] &#x3D; s[i] + nums[i]ï¼Œs[i]è¡¨ç¤ºnums[i]<strong>å‰é¢</strong>å…ƒç´ ä¹‹å’Œ</p><p>é€šè¿‡å‰ç¼€å’Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ<strong>å­æ•°ç»„çš„å…ƒç´ å’Œè½¬æ¢æˆä¸¤ä¸ªå‰ç¼€å’Œçš„å·®</strong></p><p>å¦‚nums &#x3D; [1, 2, -1, 2]ï¼Œåˆ™å­æ•°ç»„[2, -1, 2]çš„å’Œä¸ºs[4] - s[1] &#x3D; 3</p><h3 id="å‰ç¼€æ ‘"><a href="#å‰ç¼€æ ‘" class="headerlink" title="å‰ç¼€æ ‘"></a>å‰ç¼€æ ‘</h3><p>æ¨¡æ¿</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Trie</span> &#123;<br>    TrieNode root;<br><br>    <span class="hljs-comment">/** Initialize your data structure here. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Trie</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrieNode</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/** Inserts a word into the trie. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(String word)</span> &#123;<br>        <span class="hljs-type">TrieNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> root;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> ch : word.toCharArray()) &#123;<br>            <span class="hljs-keyword">if</span> (node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br>                node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrieNode</span>();<br>            &#125;<br>            node = node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>];<br>        &#125;<br>        node.isWord = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/** Returns if the word is in the trie. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">search</span><span class="hljs-params">(String word)</span> &#123;<br>        <span class="hljs-type">TrieNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> root;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> ch : word.toCharArray()) &#123;<br>            <span class="hljs-keyword">if</span> (node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            node = node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>];<br>        &#125;<br>        <span class="hljs-keyword">return</span> node.isWord == <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/** Returns if there is any word in the trie that starts with the given prefix. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startsWith</span><span class="hljs-params">(String prefix)</span> &#123;<br>        <span class="hljs-type">TrieNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> root;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> ch : prefix.toCharArray()) &#123;<br>            <span class="hljs-keyword">if</span> (node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            node = node.children[ch - <span class="hljs-string">&#x27;a&#x27;</span>];<br>        &#125;<br>        <span class="hljs-keyword">return</span> node != <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrieNode</span> &#123;<br>        TrieNode[] children;<br>        <span class="hljs-type">boolean</span> isWord;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">TrieNode</span><span class="hljs-params">()</span> &#123;<br>            children = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrieNode</span>[<span class="hljs-number">26</span>];<br>            isWord = <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><h4 id="è®¡æ•°æ’åº"><a href="#è®¡æ•°æ’åº" class="headerlink" title="è®¡æ•°æ’åº"></a>è®¡æ•°æ’åº</h4><p>è®¾æ•°ç»„é•¿åº¦ä¸ºnï¼Œæ•°ç»„æœ€å¤§å€¼å’Œæœ€å°å€¼å·®ä¸ºk</p><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n + k)</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(k)</p><p><strong>é€‚ç”¨èŒƒå›´</strong>ï¼škè¿œå°äºnæ—¶ï¼Œæ—¶é—´å¤æ‚åº¦å¯è§†ä¸ºO(n)ï¼Œä¼˜äºå…¶ä»–åŸºäºæ¯”è¾ƒçš„æ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] sortArray(<span class="hljs-type">int</span>[] nums) &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> Integer.MAX_VALUE;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> Integer.MIN_VALUE;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;<br>        min = Math.min(min, num);<br>        max = Math.max(max, num);<br>    &#125;<br>    <span class="hljs-type">int</span>[] counts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[max - min + <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;<br>        counts[num - min]++;<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> min; num &lt;= max; ++num) &#123;<br>        <span class="hljs-keyword">while</span> (counts[num - min] &gt; <span class="hljs-number">0</span>) &#123;<br>            nums[idx] = num;<br>            counts[num - min]--;<br>            idx++;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> nums;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h4><p>æ—¶é—´å¤æ‚åº¦ï¼šæœ€å¥½O(nlogn)ï¼Œæœ€å·®O(n ^ 2)</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] sortArray(<span class="hljs-type">int</span>[] nums) &#123;<br>    quicksort(nums, <span class="hljs-number">0</span>, nums.length - <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> nums;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quicksort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> &#123;<br>    <span class="hljs-keyword">if</span> (start &lt; end) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> partition(nums, start, end);<br>        quicksort(nums, start, pivot - <span class="hljs-number">1</span>);<br>        quicksort(nums, pivot + <span class="hljs-number">1</span>, end);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(end - start + <span class="hljs-number">1</span>) + start;<br>    swap(nums, random, end);<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">small</span> <span class="hljs-operator">=</span> start - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">big</span> <span class="hljs-operator">=</span> start; big &lt; end; ++big) &#123;<br>        <span class="hljs-keyword">if</span> (nums[big] &lt; nums[end]) &#123;<br>            small++;<br>            swap(nums, small, big);<br>        &#125;<br>    &#125;<br>    small++;<br>    swap(nums, small, end);<br>    <span class="hljs-keyword">return</span> small;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h4><p>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å†™æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] sortArray(<span class="hljs-type">int</span>[] nums) &#123;<br>    <span class="hljs-type">int</span>[] dst = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[nums.length];<br>    dst = Arrays.copyOf(nums, nums.length);<br>    mergeSort(nums, dst, <span class="hljs-number">0</span>, nums.length);<br>    <span class="hljs-keyword">return</span> dst;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span>[] dst, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> &#123;<br>    <span class="hljs-keyword">if</span> (start + <span class="hljs-number">1</span> &gt;= end) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> start + ((end - start) &gt;&gt; <span class="hljs-number">1</span>);<br>    mergeSort(nums, dst, start, mid);<br>    mergeSort(nums, dst, mid, end);<br>    <br>    <span class="hljs-comment">// åˆå¹¶ä¸¤ä¸ªéƒ¨åˆ†</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start, j = mid, k = start;<br>    <span class="hljs-keyword">while</span> (i &lt; mid || j &lt; end) &#123;<br>        <span class="hljs-keyword">if</span> (j == end || (i &lt; mid &amp;&amp; nums[i] &lt; nums[j])) &#123;<br>            dst[k++] = nums[i++];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            dst[k++] = nums[j++];<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åŒä½™"><a href="#åŒä½™" class="headerlink" title="åŒä½™"></a>åŒä½™</h3><p>â€‹<strong>å®šä¹‰</strong>ï¼šä¸¤ä¸ªæ•°xå’Œyï¼Œå¦‚æœ<code>(x - y) mod m = 0</code>ï¼Œåˆ™ç§°xä¸yå¯¹æ¨¡måŒä½™ï¼Œè®°ä½œï¼š<code>x = y (mod m)</code></p><p>ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªæ•°æ¨¡ä¸€ä¸ªæ•°åå¾—åˆ°ç›¸åŒçš„æ•°ï¼Œä¾‹å¦‚ <code>42 = 12 ï¼ˆmod 10ï¼‰</code>ã€<code>-17 = 3 ï¼ˆmod 10ï¼‰</code></p><p>â€‹<strong>å¤„ç†å–æ¨¡æŠ€å·§</strong>ï¼šå¦‚æœæ•°xä¸ºè´Ÿæ•°ï¼Œåˆ™ <code>x mod m = y mod m</code> ç­‰åŒäº<code>(x mod m + m) mod m = y mod m</code></p><p>ä¾‹é¢˜ï¼š<a href="https://leetcode.cn/problems/smallest-missing-non-negative-integer-after-operations/">6321. æ‰§è¡Œæ“ä½œåçš„æœ€å¤§ MEX - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h3 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h3><h4 id="æ•°ä½DP"><a href="#æ•°ä½DP" class="headerlink" title="æ•°ä½DP"></a>æ•°ä½DP</h4><p>æ•°ä½ DPï¼šç”¨æ¥è§£å†³ä¸€ç±»ç‰¹å®šé—®é¢˜ï¼Œè¿™ç§é—®é¢˜æ¯”è¾ƒå¥½è¾¨è®¤ï¼Œä¸€èˆ¬å…·æœ‰è¿™å‡ ä¸ªç‰¹å¾ï¼š</p><ol><li>è¦æ±‚ç»Ÿè®¡æ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ•°çš„æ•°é‡ï¼ˆå³ï¼Œæœ€ç»ˆç›®çš„ä¸ºè®¡æ•°ï¼‰ï¼›</li><li>è¿™äº›æ¡ä»¶ç»è¿‡è½¬åŒ–åå¯ä»¥ä½¿ç”¨ã€Œæ•°ä½ã€çš„æ€æƒ³å»ç†è§£å’Œåˆ¤æ–­ï¼›</li><li>è¾“å…¥ä¼šæä¾›ä¸€ä¸ªæ•°å­—åŒºé—´ï¼ˆæœ‰æ—¶ä¹Ÿåªæä¾›ä¸Šç•Œï¼‰æ¥ä½œä¸ºç»Ÿè®¡çš„é™åˆ¶ï¼›</li><li>ä¸Šç•Œå¾ˆå¤§ï¼ˆæ¯”å¦‚ <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="10^{18}">10 ^ 18)ï¼Œæš´åŠ›æšä¸¾éªŒè¯ä¼šè¶…æ—¶ã€‚</li></ol><p><strong>åŸºæœ¬åŸç†</strong>ï¼š</p><p>â€‹è€ƒè™‘äººç±»è®¡æ•°çš„æ–¹å¼ï¼Œæœ€æœ´ç´ çš„è®¡æ•°å°±æ˜¯ä»å°åˆ°å¤§å¼€å§‹ä¾æ¬¡åŠ ä¸€ã€‚ä½†æˆ‘ä»¬å‘ç°å¯¹äºä½æ•°æ¯”è¾ƒå¤šçš„æ•°ï¼Œè¿™æ ·çš„è¿‡ç¨‹ä¸­æœ‰è®¸å¤šé‡å¤çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä» 7000 æ•°åˆ° 7999ã€ä» 8000 æ•°åˆ° 8999ã€å’Œä» 9000 æ•°åˆ° 9999 çš„è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯åä¸‰ä½ä» 000 å˜åˆ° 999ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹åªæœ‰åƒä½è¿™ä¸€ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¿‡ç¨‹å½’å¹¶èµ·æ¥ï¼Œå°†è¿™äº›è¿‡ç¨‹ä¸­äº§ç”Ÿçš„è®¡æ•°ç­”æ¡ˆä¹Ÿéƒ½å­˜åœ¨ä¸€ä¸ªé€šç”¨çš„æ•°ç»„é‡Œã€‚</p><p>ä¾‹é¢˜ï¼š<a href="https://leetcode.cn/problems/numbers-with-repeated-digits/">1012. è‡³å°‘æœ‰ 1 ä½é‡å¤çš„æ•°å­— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h4 id="èƒŒåŒ…é—®é¢˜"><a href="#èƒŒåŒ…é—®é¢˜" class="headerlink" title="èƒŒåŒ…é—®é¢˜"></a>èƒŒåŒ…é—®é¢˜</h4><p><strong>01èƒŒåŒ…</strong></p><p>èƒŒåŒ…å®¹é‡ä»åå¾€å‰æ¨ï¼Œæ¯è½®å°è¯•å°†ä¸€ä¸ªç‰©å“æ”¾å…¥èƒŒåŒ…</p><p><a href="https://leetcode.cn/problems/YaVDxD/?favorite=e8X3pBZi">å‰‘æŒ‡ Offer II 102. åŠ å‡çš„ç›®æ ‡å€¼ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><p><strong>å¤šé‡èƒŒåŒ…</strong></p><p>èƒŒåŒ…å®¹é‡ä»å‰å¾€åæ¨ï¼Œå°è¯•å°†æ¯ä¸ªç‰©å“æ”¾å…¥æ¯ä¸ªèƒŒåŒ…å®¹é‡</p><p><a href="https://leetcode.cn/problems/gaM7Ch/?favorite=e8X3pBZi">å‰‘æŒ‡ Offer II 103. æœ€å°‘çš„ç¡¬å¸æ•°ç›® - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h3 id="æ‰¾è´¨æ•°"><a href="#æ‰¾è´¨æ•°" class="headerlink" title="æ‰¾è´¨æ•°"></a>æ‰¾è´¨æ•°</h3><blockquote><p>è´¨æ•°æ˜¯æŒ‡åœ¨å¤§äº1çš„è‡ªç„¶æ•°ä¸­ï¼Œé™¤äº†1å’Œå®ƒæœ¬èº«ä»¥å¤–ä¸å†æœ‰å…¶ä»–å› æ•°çš„è‡ªç„¶æ•°ã€‚</p></blockquote><h4 id="åŸƒæ°ç­›"><a href="#åŸƒæ°ç­›" class="headerlink" title="åŸƒæ°ç­›"></a>åŸƒæ°ç­›</h4><p><strong>å®šä¹‰</strong></p><p>â€‹ç»™å‡ºè¦ç­›<a href="https://baike.baidu.com/item/%E6%95%B0%E5%80%BC?fromModule=lemma_inlink">æ•°å€¼</a>çš„èŒƒå›´nï¼Œæ‰¾å‡ºä»¥å†…çš„<a href="https://baike.baidu.com/item/%E7%B4%A0%E6%95%B0?fromModule=lemma_inlink">ç´ æ•°</a>ã€‚å…ˆç”¨2å»ç­›ï¼Œå³æŠŠ2ç•™ä¸‹ï¼ŒæŠŠ2çš„å€æ•°å‰”é™¤æ‰ï¼›å†ç”¨ä¸‹ä¸€ä¸ª<a href="https://baike.baidu.com/item/%E8%B4%A8%E6%95%B0?fromModule=lemma_inlink">è´¨æ•°</a>ï¼Œä¹Ÿå°±æ˜¯3ç­›ï¼ŒæŠŠ3ç•™ä¸‹ï¼ŒæŠŠ3çš„å€æ•°å‰”é™¤æ‰ï¼›æ¥ä¸‹å»ç”¨ä¸‹ä¸€ä¸ªè´¨æ•°5ç­›ï¼ŒæŠŠ5ç•™ä¸‹ï¼ŒæŠŠ5çš„<a href="https://baike.baidu.com/item/%E5%80%8D%E6%95%B0?fromModule=lemma_inlink">å€æ•°</a>å‰”é™¤æ‰ï¼›ä¸æ–­é‡å¤ä¸‹å»â€¦â€¦ã€‚</p><p><strong>æ¨¡æ¿</strong></p><p>é¢„å¤„ç†å‡ºè´¨æ•°åˆ—è¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">for</span> (Integer i : <span class="hljs-keyword">new</span> <span class="hljs-title class_">Main</span>().primeList()) &#123;<br>            System.out.println(i);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-type">int</span> <span class="hljs-variable">MAX</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) Math.pow(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>) + <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">primeList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">boolean</span>[] isPrime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[MAX];<br>        Arrays.fill(isPrime, <span class="hljs-literal">true</span>);<br><br>        List&lt;Integer&gt; primes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; i &lt; MAX; ++i) &#123;<br>            <span class="hljs-keyword">if</span> (isPrime[i]) &#123;<br>                primes.add(i);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i * i; j &lt; MAX; j += i) &#123;<br>                    isPrime[j] = <span class="hljs-literal">false</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> primes;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¾‹é¢˜</strong></p><p>â€‹<a href="https://leetcode.cn/problems/prime-subtraction-operation/">6355. è´¨æ•°å‡æ³•è¿ç®— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h3 id="æœ€å¤§å…¬å› æ•°-x2F-æœ€å°å…¬å€æ•°"><a href="#æœ€å¤§å…¬å› æ•°-x2F-æœ€å°å…¬å€æ•°" class="headerlink" title="æœ€å¤§å…¬å› æ•°&#x2F;æœ€å°å…¬å€æ•°"></a>æœ€å¤§å…¬å› æ•°&#x2F;æœ€å°å…¬å€æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javav">public int gcd(int a, int b) &#123;<br>return b == 0 ? a : gcd(b, a % b);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">lcm</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> &#123;<br><span class="hljs-keyword">return</span> (a * b) / gcd(a, b);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²åŒ¹é…KMP"><a href="#å­—ç¬¦ä¸²åŒ¹é…KMP" class="headerlink" title="å­—ç¬¦ä¸²åŒ¹é…KMP"></a>å­—ç¬¦ä¸²åŒ¹é…KMP</h3><p>å¦‚æœæš´åŠ›åŒ¹é…ï¼Œå¦‚æœæ¨¡å¼ä¸²å’Œä¸»ä¸²ä¸åŒ¹é…æ—¶ï¼Œæ¨¡å¼ä¸²éœ€è¦ä»å¤´å¼€å§‹åŒ¹é…ï¼›</p><p>ä½¿ç”¨KMPçš„è¯ï¼Œå¯ä»¥é€šè¿‡nextæ•°ç»„æ¥å›é€€æ¨¡å¼ä¸²æ¥ç»§ç»­åŒ¹é…ï¼Œä¸ç”¨å†ä»å¤´å¼€å§‹</p><ul><li>nextæ•°ç»„ï¼šè®°å½•äº†æ¨¡å¼ä¸²ä¸ä¸»ä¸²(æ–‡æœ¬ä¸²)ä¸åŒ¹é…çš„æ—¶å€™ï¼Œæ¨¡å¼ä¸²åº”è¯¥ä»å“ªé‡Œå¼€å§‹é‡æ–°åŒ¹é…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-comment">// KMPç®—æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">strStr</span><span class="hljs-params">(String haystack, String needle)</span> &#123;<br>        <span class="hljs-type">char</span>[] hChs = haystack.toCharArray();<br>        <span class="hljs-type">char</span>[] nChs = needle.toCharArray();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> hChs.length, n = nChs.length;<br><br>        <span class="hljs-type">int</span>[] next = next(nChs);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; m; ++i) &#123;<br>            <span class="hljs-keyword">while</span>(j - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; hChs[i] != nChs[j])<br>                j = next[j - <span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (hChs[i] == nChs[j])<br>                j++;<br>            <span class="hljs-keyword">if</span> (j == n)<br>                <span class="hljs-keyword">return</span> i - n + <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] next(<span class="hljs-type">char</span>[] chs) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> chs.length;<br>        <span class="hljs-type">int</span>[] next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, i = <span class="hljs-number">1</span>; i &lt; n; ++i) &#123;<br>            <span class="hljs-keyword">while</span> (j - <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; chs[i] != chs[j])<br>                j = next[j - <span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (chs[i] == chs[j])<br>                j++;<br>            next[i] = j;<br>        &#125;<br>        <span class="hljs-keyword">return</span> next;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•é¢˜</title>
    <link href="/2023/02/21/%E5%85%B6%E4%BB%96/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <url>/2023/02/21/%E5%85%B6%E4%BB%96/%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h1><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="äºŒåˆ†"><a href="#äºŒåˆ†" class="headerlink" title="äºŒåˆ†"></a>äºŒåˆ†</h4><p>é—®é¢˜1ï¼š128ä¸ªå…ƒç´ æœ€å¤šäºŒåˆ†å‡ æ¬¡æ‰¾åˆ°ç›®æ ‡</p><p>ç­”ï¼š128 &#x3D; 2^7ï¼Œæœ€å¤š7æ¬¡</p><p>é—®é¢˜2ï¼š100000000000ä¸ªå…ƒç´ æœ€å¤šäºŒåˆ†å‡ æ¬¡æ‰¾åˆ°ç›®æ ‡</p><p>ç­”ï¼š</p><p>â€‹å…¬å¼ï¼š<font color="red">logb(a) &#x3D; logc(a) &#x2F; logc(b)</font></p><p>â€‹log2(100000000000) &#x3D; log10(100000000000) &#x2F; log10(2)ï¼Œå‘ä¸Šå–æ•´</p><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><h5 id="ç»å…¸æ’åºç®—æ³•"><a href="#ç»å…¸æ’åºç®—æ³•" class="headerlink" title="ç»å…¸æ’åºç®—æ³•"></a>ç»å…¸æ’åºç®—æ³•</h5><p><strong>å†’æ³¡æ’åº</strong>ï¼šæ¯æ¬¡ç›¸é‚»ä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œä¸€è¶Ÿé€‰å‡ºä¸€ä¸ªæœ€å¤§&#x2F;æœ€å°çš„å…ƒç´ </p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¼˜åŒ–è¿‡çš„å†’æ³¡ï¼Œè®°å½•æœ€åä¸€æ¬¡äº¤æ¢ç´¢å¼•ä½œä¸ºä¸‹è½®å†’æ³¡çš„æ¯”è¾ƒæ¬¡æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubble</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length - <span class="hljs-number">1</span>;<span class="hljs-comment">// è®°å½•æ¯æ¬¡å¾ªç¯æ¯”è¾ƒçš„æ¬¡æ•°</span><br>    <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<span class="hljs-comment">// è®°å½•æœ€åä¸€æ¬¡äº¤æ¢çš„ç´¢å¼•</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;<br>            <span class="hljs-keyword">if</span> (arr[i] &gt; arr[i + <span class="hljs-number">1</span>]) &#123;<br>                swap(arr, i, i + <span class="hljs-number">1</span>);<br>                last = i;<br>            &#125;<br>        &#125;<br>        n = last;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é€‰æ‹©æ’åº</strong>ï¼šæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªæœ€å¤§&#x2F;æœ€å°å…ƒç´ ï¼Œæ”¾åˆ°å·²æ’åºåŒºåŸŸçš„æœ«å°¾</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selection</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length - <span class="hljs-number">1</span>; ++i) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> i;<span class="hljs-comment">// æœ€å°å…ƒç´ ä¸‹æ ‡</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> s + <span class="hljs-number">1</span>; j &lt; arr.length; ++j) &#123;<br>            <span class="hljs-keyword">if</span> (arr[s] &gt; arr[j])<br>                s = j;<br>        &#125;<br>        swap(arr, s, i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ’å…¥æ’åº</strong>ï¼šéå†æ¯ä¸ªå…ƒç´ ï¼Œæ’å…¥åˆ°å·²æ’åºåŒºåŸŸä¸­é€‚åˆçš„ä½ç½®</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; arr.length; ++i) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> arr[i];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - <span class="hljs-number">1</span>; j &gt;= <span class="hljs-number">0</span>; --j) &#123;<br>            <span class="hljs-keyword">if</span> (arr[j] &gt; tmp) &#123;<br>                arr[j + <span class="hljs-number">1</span>] = arr[j];<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        arr[j + <span class="hljs-number">1</span>] = tmp;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¸Œå°”æ’åº</strong>ï¼šå¼€å§‹é€‰å®šä¸€ä¸ªé—´éš™nï¼Œæ¯è½®æ’åºé—´éš”nçš„å…ƒç´ ï¼Œä¹‹åå‡å°nå†æ’åºï¼Œç›´åˆ°n&#x3D;1ã€‚è¿™ä¹ˆåšå¤§çš„å…ƒç´ ä¼šæ›´å¿«çš„å¾€å³è¾¹é ï¼Œå‡å°‘ä¹‹åçš„ç§»åŠ¨æ¬¡æ•°ã€‚</p><p><strong>å¿«é€Ÿæ’åº</strong>ï¼šæ¯è½®æ‰¾ä¸€ä¸ªåŸºå‡†ç‚¹è¿›è¡Œåˆ†åŒºï¼Œæ¯”åŸºå‡†ç‚¹å°çš„æ”¾åˆ°åŸºå‡†ç‚¹å·¦è¾¹ï¼Œå¤§çš„æ”¾åˆ°åŸºå‡†ç‚¹å³è¾¹ã€‚ç›´åˆ°åˆ†åŒºå†…å…ƒç´ ä¸ªæ•°å°äºç­‰äº1ã€‚</p><ol><li><p>å•è¾¹å¾ªç¯å¿«æ’</p><ol><li><p>ä»¥æœ€å³è¾¹å…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹</p></li><li><p>iï¼ŒjæŒ‡é’ˆæŒ‡å‘å·¦è¾¹ç•Œçš„å…ƒç´ </p></li><li><p>jå¾€å³ç§»ï¼Œå½“æ‰¾åˆ°æ¯”åŸºå‡†ç‚¹å°çš„å…ƒç´ å°±å’Œiäº¤æ¢ï¼Œi++</p></li><li><p>å½“äº¤æ¢å®Œåiå’ŒåŸºå‡†ç‚¹äº¤æ¢ï¼Œè¿™æ ·åŸºå‡†ç‚¹å·¦è¾¹çš„å…ƒç´ å°±æ¯”åŸºå‡†ç‚¹å°</p></li></ol><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> staic <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>&#125;;<br>    quick(arr, <span class="hljs-number">0</span>, arr.length - <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-keyword">if</span> (l &gt;= r)<br>        <span class="hljs-keyword">return</span>;<br> <span class="hljs-type">int</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> partition(arr, l, r);<br>    partition(arr, l, p - <span class="hljs-number">1</span>);<br>    partition(arr, p + <span class="hljs-number">1</span>, r);<br>&#125;<br><br><span class="hljs-comment">// åˆ†åŒºï¼Œè¿”å›ä¸­é—´ä¸‹æ ‡</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-keyword">if</span> (l &gt;= r)<br>        <span class="hljs-keyword">return</span> l;<br><span class="hljs-type">int</span> <span class="hljs-variable">pv</span> <span class="hljs-operator">=</span> a[r];<span class="hljs-comment">// åŸºå‡†ç‚¹</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> l;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> l; j &lt; r; ++j) &#123;<br>        <span class="hljs-keyword">if</span> (arr[j] &lt; pv) &#123;<br>            swap(arr, i, j);<br>            ++i;<br>        &#125;<br>    &#125;<br>    swap(arr, r, i);<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åŒè¾¹å¾ªç¯å¿«æ’(æ›´å¿«ä¸€ç‚¹)</p><ol><li>ä»¥æœ€å·¦è¾¹å…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹</li><li>iæŒ‡å‘å·¦è¾¹ç•Œï¼ŒjæŒ‡å‘å³è¾¹ç•Œï¼Œä¸¤è¾¹äº’æ‰¾</li><li>å½“iï¼Œjç›¸é‡æ—¶å§åŸºå‡†ç‚¹å’Œiäº¤æ¢</li></ol><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> staic <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>&#125;;<br>    quick(arr, <span class="hljs-number">0</span>, arr.length - <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-keyword">if</span> (l &gt;= r)<br>        <span class="hljs-keyword">return</span>;<br> <span class="hljs-type">int</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> partition(arr, l, r);<br>    partition(arr, l, p - <span class="hljs-number">1</span>);<br>    partition(arr, p + <span class="hljs-number">1</span>, r);<br>&#125;<br><br><span class="hljs-comment">// åˆ†åŒºï¼Œè¿”å›ä¸­é—´ä¸‹æ ‡</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">pv</span> <span class="hljs-operator">=</span> arr[l];<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> l, j = r;<br>    <span class="hljs-keyword">while</span> (i &lt; j) &#123;<br>        <span class="hljs-comment">// è¿™ä¸¤ä¸ªwhileä¸èƒ½äº¤æ¢</span><br>        <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt; pv)<br>            --j;<br>        <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= pv)<br>            ++i;<br>        swap(arr, i, j);<br>    &#125;<br>    swap(arr, l, i);<br>    <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/else_img/%E6%8E%92%E5%BA%8F.png"></p></li></ol><h4 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h4><p><img src="/img/else_img/%E9%9B%86%E5%90%88%E5%85%B3%E7%B3%BB%E5%9B%BE.png"></p><h5 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h5><h6 id="æˆå‘˜å˜é‡-x2F-æ„é€ å‡½æ•°"><a href="#æˆå‘˜å˜é‡-x2F-æ„é€ å‡½æ•°" class="headerlink" title="æˆå‘˜å˜é‡&#x2F;æ„é€ å‡½æ•°"></a>æˆå‘˜å˜é‡&#x2F;æ„é€ å‡½æ•°</h6><table><thead><tr><th>å˜é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Object[] elementData</td><td>å­˜æ”¾å…ƒç´ </td></tr><tr><td>int size</td><td>å¤§å°</td></tr><tr><td>static final int DEFAULT_CAPACITY &#x3D; 10</td><td>åˆå§‹å®¹é‡</td></tr><tr><td>static final Object[] EMPTY_ELEMENTDATA &#x3D; {}</td><td></td></tr><tr><td>static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA &#x3D; {}</td><td></td></tr></tbody></table><table><thead><tr><th>æ„é€ å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public ArrayList(int initialCapacity)</td><td>è‹¥å‚æ•°åˆæ³•åˆ™æ ¹æ®å‚æ•°æ¥åˆå§‹åŒ–æ­¤å®¹é‡çš„é›†åˆ</td></tr><tr><td>public ArrayList()</td><td>elementData &#x3D; DEFAULTCAPACITY_EMPTY_ELEMENTDATA</td></tr><tr><td>public ArrayList(Collection&lt;? extends E&gt; c)</td><td>å°†cè½¬æ¢æˆæ•°ç»„ï¼Œå°†æ•°ç»„çš„åœ°å€èµ‹ç»™elementData</td></tr></tbody></table><h6 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h6><p>â€‹<strong>åˆå§‹åŒ–</strong>ï¼šæ— å‚æ„é€ åˆšåˆ›å»ºå‡ºæ¥çš„æ—¶å€™å®¹é‡ä¸º0ï¼Œæœ‰å‚åˆ™æŒ‰ä¼ å…¥çš„å€¼æˆ–é›†åˆçš„å¤§å°ä½œä¸ºå®¹é‡</p><p>â€‹<strong>addæ–¹æ³•</strong>ï¼š</p><ol><li>æ·»åŠ å…ƒç´ æ—¶ä¼šå…ˆåˆ¤æ–­æ·»åŠ å…ƒç´ åçš„å®¹é‡æ˜¯å¦è¶…è¿‡å½“å‰å®¹é‡</li><li>å¦‚æœæ˜¯æ— å‚æ„é€ ï¼Œé¦–æ¬¡æ·»åŠ å…ƒç´ æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º<code>DEFAULT_CAPACITY=10</code>çš„æ•°ç»„ï¼Œ</li><li>ä¹‹åæ¯æ¬¡æ·»åŠ å…ƒç´ å®¹é‡ä¸è¶³æ—¶ä¼šæŒ‰åŸæ•°ç»„å®¹é‡çš„<strong>1.5å€</strong>ï¼ˆå‘ä¸‹å–æ•´ï¼‰åˆ›å»ºæ–°æ•°ç»„ï¼ŒæŠŠåŸæ•°ç»„çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œç”¨æ–°æ•°ç»„æ›¿æ¢åŸæ•°ç»„ã€‚</li></ol><p>â€‹<strong>addAllæ–¹æ³•</strong>ï¼šæ²¡æœ‰å…ƒç´ æ—¶æ‰©å®¹ä¸ºMath.max(10, å®é™…å…ƒç´ ä¸ªæ•°)ï¼Œæœ‰å…ƒç´ æ—¶ä¸ºMath.max(åŸå®¹é‡1.5å€, å®é™…å…ƒç´ ä¸ªæ•°)ã€‚</p><h6 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h6><p>å½“åœ¨ä½¿ç”¨è¿­ä»£å™¨æ—¶æœ‰å…¶å®ƒçº¿ç¨‹ä¿®æ”¹æ•°ç»„æ—¶æœ‰ä¸¤ç§<strong>ç­–ç•¥</strong>ï¼š</p><ol><li><strong>fail-fast</strong>ï¼šåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„çº¿ç¨‹ç«‹å³æŠ¥é”™</li><li><strong>fail-safe</strong>ï¼šå‘ç°æœ‰äººä¿®æ”¹äº†åˆ™é‡‡å–ä¸€äº›å¯¹ç­–ï¼Œä¾‹å¦‚ç‰ºç‰²ä¸€äº›ä¸€è‡´æ€§æ¥è®©æ•´ä¸ªéå†å®Œæˆ</li></ol><p><strong>åŸç†</strong></p><p>â€‹fail-fastæ˜¯åœ¨åˆ›å»ºè¿­ä»£å™¨æ—¶è®°å½•æ•°ç»„è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ¯æ¬¡è·å–ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶åˆ¤æ–­ç°åœ¨æ•°ç»„çš„ä¿®æ”¹æ¬¡æ•°æ˜¯å¦å’Œä¹‹å‰è®°å½•çš„ä¿æŒä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æŠ¥é”™ï¼ˆç±»ä¼¼ä¹è§‚é”ï¼‰ã€‚</p><blockquote><p>ArrayListä½¿ç”¨çš„ç¬¬ä¸€ç§ç­–ç•¥ï¼ŒCopyOnWriteArrayListæ˜¯ç¬¬äºŒç§ç­–ç•¥ï¼ˆå¯¹ç­–æ˜¯æ·»åŠ æŠŠåŸé›†åˆå¤åˆ¶å‡ºæ¥ï¼Œåœ¨æ–°é›†åˆä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å¥½åæŒ‡å‘æ–°é›†åˆã€‚åˆ›å»ºè¿­ä»£å™¨æ—¶ä¼šæŒ‡å‘å½“å‰é›†åˆï¼Œéå†çš„æ˜¯æ—§é›†åˆä¸å½±å“ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰ï¼‰ï¼›</p></blockquote><h6 id="æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢"><a href="#æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢" class="headerlink" title="æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢"></a>æ•°ç»„å’ŒListä¹‹é—´çš„è½¬æ¢</h6><p>æ•°ç»„è½¬Listï¼ˆæµ…æ‹·è´ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">String[] strs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>&#125;;<br>List&lt;String&gt; list = Arrays.asList(strs);<br></code></pre></td></tr></table></figure><p>Listè½¬æ•°ç»„ï¼ˆæ·±æ‹·è´ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>list.add(<span class="hljs-string">&quot;a&quot;</span>); list.add(<span class="hljs-string">&quot;b&quot;</span>);<br>String[] strs = list.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[list.size()]);<br></code></pre></td></tr></table></figure><h5 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h5><h6 id="ä¸ArrayListçš„æ¯”è¾ƒ"><a href="#ä¸ArrayListçš„æ¯”è¾ƒ" class="headerlink" title="ä¸ArrayListçš„æ¯”è¾ƒ"></a>ä¸ArrayListçš„æ¯”è¾ƒ</h6><ul><li><p><strong>åº•å±‚æ•°æ®ç»“æ„</strong></p><p>ArrayListåŸºäºåŠ¨æ€æ•°ç»„ï¼Œéœ€è¦è¿ç»­å†…å­˜</p><p>LinkedListåŸºäºåŒå‘é“¾è¡¨ï¼Œæ— éœ€è¿ç»­å†…å­˜</p></li><li><p><strong>æ•ˆç‡</strong></p><p>ArrayListéšæœºè®¿é—®å¿«ï¼Œå°¾éƒ¨æ’å…¥å’Œæ’å…¥æ€§èƒ½å¯ä»¥ï¼Œå…¶å®ƒéƒ¨åˆ†éƒ½ä¼šç§»åŠ¨å…ƒç´ ï¼Œæ€§èƒ½ä½</p><p>LinkedListéšæœºè®¿é—®æ…¢ï¼Œå°¾æ’å…¥åˆ é™¤æ€§èƒ½é«˜ï¼Œå…¶ä»–éƒ¨åˆ†æ•ˆç‡ä½</p></li><li><p><strong>å ç”¨ç©ºé—´</strong></p><p>ArrayListå¯ä»¥åˆ©ç”¨cpuç¼“å­˜ï¼Œå±€éƒ¨æ€§åŸç†</p><p>LinkedListå ç”¨å†…å­˜å¤š</p></li><li><p><strong>çº¿ç¨‹å®‰å…¨</strong></p><p>ArrayListå’ŒLinkedListéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥é€šè¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Object&gt; list = Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>List&lt;Object&gt; list = Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;());<br></code></pre></td></tr></table></figure><p>åŒ…è£…ä¸€ä¸‹ï¼Œå˜æˆçº¿ç¨‹å®‰å…¨çš„</p></li></ul><h5 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h5><h6 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h6><ul><li><p><strong>é“¾è¡¨è¿‡é•¿æ—¶çš„è§£å†³æ–¹æ³•</strong></p><p><img src="/img/else_img/hashMap.png" alt="æ¡¶æ•°ç»„æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®å…ƒç´ ï¼Œé“¾è¡¨æ˜¯ç”¨æ¥è§£å†³å†²çªï¼Œçº¢é»‘æ ‘æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢çš„æ•ˆç‡"></p><ol><li><strong>æ•°ç»„æ‰©å®¹</strong>ï¼š<ol><li>putå…ƒç´ åæ£€æŸ¥ï¼Œå½“å…ƒç´ æ€»æ•°å¤§äºé˜ˆå€¼ï¼ˆé˜ˆå€¼&#x3D;å®¹é‡*è´Ÿè½½å› å­ï¼‰æ—¶ä¼šå‘ç”Ÿä¸€æ¬¡æ‰©å®¹</li><li>æ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ä¹‹å‰å®¹é‡çš„2å€</li><li>æ‰©å®¹ä¹‹åä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒæŠŠè€æ•°ç»„ä¸­çš„å…ƒç´ è¿ç§»è¿‡å»<ul><li>æ²¡æœ‰hashå†²çªçš„èŠ‚ç‚¹ï¼Œç›´æ¥<code>e.hash &amp; (newCap - 1)</code>è®¡ç®—ç´¢å¼•ä¸‹æ ‡</li><li>çº¢é»‘æ ‘åˆ™èµ°çº¢é»‘æ ‘é€»è¾‘</li><li>å¦‚æœæ˜¯é“¾è¡¨ï¼Œåˆ™éœ€è¦éå†é“¾è¡¨ï¼Œå¯èƒ½éœ€è¦æ‹†åˆ†é“¾è¡¨ï¼Œåˆ¤æ–­<code>e.hash &amp; oldCap == 0</code>æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæˆç«‹åˆ™ä»åœ¨è¿™ä¸ªä½ç½®ï¼Œå¦åˆ™ç§»åŠ¨åˆ°<code>åŸå§‹ä½ç½®+oldCap</code>ä¸Š</li></ul></li></ol></li><li><strong>æ ‘åŒ–</strong>ï¼ˆjdk1.8ï¼‰ï¼šè‹¥æ•°ç»„å®¹é‡å°äº64æ—¶ä¼šå…ˆå°è¯•æ‰©å®¹ï¼Œå½“æ•°ç»„å®¹é‡è¶…è¿‡64ä¸”é“¾è¡¨é•¿åº¦å¤§äº8ï¼ˆé˜ˆå€¼ï¼‰æ—¶ä¼šæ ‘åŒ–</li></ol></li><li><p><strong>åº•å±‚æ•°æ®ç»“æ„ï¼Œ1.7å’Œ1.8æœ‰ä½•ä¸åŒ?</strong></p><ul><li>1.7ä¸ºæ•°ç»„+é“¾è¡¨ï¼Œ1.8ä¸ºæ•°ç»„+(é“¾è¡¨ | çº¢é»‘æ ‘)</li><li>1.7ä¸ºå¤´æ’æ³•ï¼Œ1.8ä¸ºå°¾æ’æ³•</li><li>1.7å…ˆæ‰©å®¹åæ’å…¥ï¼Œ1.8å…ˆæ’å…¥åæ‰©å®¹ï¼ˆå‡å°‘é¢‘ç¹è½¬æ¢çš„æ¦‚ç‡ï¼‰</li></ul></li><li><p><strong>ä¸ºä½•è¦ç”¨çº¢é»‘æ ‘ï¼Œä¸ºä½•ä¸ä¸€ä¸Šæ¥å°±æ ‘åŒ–ï¼Œæ ‘åŒ–é˜ˆå€¼ä¸ºä½•æ˜¯8ï¼Œä½•æ—¶ä¼šæ ‘åŒ–ï¼Œä½•æ—¶ä¼šé€€åŒ–æˆé“¾è¡¨</strong></p><ol><li><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹é“¾è¡¨é•¿åº¦æ˜¯ä¸ä¼šè¶…è¿‡8çš„ï¼Œåªæœ‰åœ¨åƒDosæ”»å‡»æ—¶è¢«æ³¨å…¥å¤§é‡keyç›¸åŒçš„å…ƒç´ æ—¶é“¾è¡¨æ‰ä¼šè¿‡é•¿ã€‚çº¢é»‘æ ‘ç”¨æ¥é˜²æ­¢é“¾è¡¨è¿‡é•¿æ—¶çš„æ€§èƒ½ä¸‹é™ã€‚å¹³è¡¡äºŒå‰æ ‘æ˜¯æ¯”çº¢é»‘æ ‘æ›´ä¸¥æ ¼çš„å¹³è¡¡æ ‘ï¼Œæ‰€ä»¥å¹³è¡¡äºŒå‰æ ‘æ’å…¥å’Œåˆ é™¤çš„æ•ˆç‡ æ¯”çº¢é»‘æ ‘è¦ä½ï¼Œæ•…ç”¨çº¢é»‘æ ‘ã€‚</p></li><li><p>hashè¡¨æŸ¥æ‰¾å’Œæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œçº¢é»‘æ ‘ä¸ºO(log2(n))ï¼Œä¸”çº¢é»‘æ ‘çš„TreeNodeæ¯”é“¾è¡¨çš„Nodeå ç”¨å†…å­˜å¤§ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨é“¾è¡¨</p></li><li><p>é€‰æ‹©8æ˜¯ä¸ºäº†è®©æ ‘åŒ–å‡ ç‡è¶³å¤Ÿå°ï¼›çº¢é»‘æ ‘å†è½¬å›é“¾è¡¨çš„é˜ˆå€¼æ˜¯6ï¼Œç›®çš„æ˜¯é˜²æ­¢èŠ‚ç‚¹æ•°åœ¨8é™„è¿‘å¾˜å¾Šå¯¼è‡´é¢‘ç¹å‘ç”Ÿè½¬æ¢</p></li><li><p>æ ‘åŒ–æ¡ä»¶ï¼šé“¾è¡¨é•¿åº¦&gt;&#x3D;é˜ˆå€¼8 ä¸” æ•°ç»„å®¹é‡&gt;&#x3D;64</p></li><li><p>é€€åŒ–æƒ…å†µ1ï¼š<strong>æ‰©å®¹æ—¶</strong>æ ‘è¢«æ‹†åˆ†ï¼Œæ ‘å…ƒç´ ä¸ªæ•°&lt;&#x3D;6ä¼šé€€åŒ–æˆé“¾è¡¨ï¼›</p><p>é€€åŒ–æƒ…å†µ2ï¼š<strong>removeèŠ‚ç‚¹æ—¶</strong>ï¼Œæ£€æŸ¥è‹¥rootï¼Œroot.leftï¼Œroot.rightï¼Œroot.left.leftä¸­æœ‰ä¸€ä¸ªä¸ºnullï¼Œåˆ™é€€åŒ–</p></li></ol></li><li><p><strong>ç´¢å¼•æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼ŸhashCodeéƒ½æœ‰äº†ä¸ºä½•è¿˜è¦hash()æ–¹æ³•ï¼Ÿæ•°ç»„å®¹é‡ä¸ºä½•æ˜¯2^nï¼Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-comment">// keyçš„hashCodeå’Œkeyçš„hashCodeå³ç§»16ä½åšå¼‚æˆ–è¿ç®—</span><br>    <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>è°ƒç”¨å¯¹è±¡çš„hashCode()æ–¹æ³•è·å¾—åŸå§‹hashï¼Œå†è°ƒç”¨HashMapçš„hash()æ–¹æ³•äºŒæ¬¡å“ˆå¸Œï¼Œæœ€å<code>tab[i = (n - 1) &amp; hash]</code>è·å–åˆ°å¯¹åº”çš„ä½ç½®ï¼Œnä¸ºtableçš„é•¿åº¦</li><li>ä¸ºäº†æé«˜ç»¼åˆé«˜ä½æ•°æ®ï¼Œè®©å“ˆå¸Œåˆ†å¸ƒæ›´åŠ å‡åŒ€ï¼Œå‡å°‘å†²çª</li><li>è®¡ç®—ç´¢å¼•æ—¶ï¼Œå¦‚æœæ˜¯2çš„næ¬¡å¹‚å¯ä»¥ä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿å–æ¨¡ï¼Œæé«˜æ•ˆç‡ï¼›æ‰©å®¹æ—¶<code>hash &amp; oldCap == 0</code>çš„å…ƒç´ ç•™åœ¨åŸå¤„ï¼Œå¦åˆ™<code>æ–°ä½ç½®=æ—§ä½ç½® + oldCap</code></li></ul></li><li><p><strong>ä»‹ç»ä¸€ä¸‹putæ–¹æ³•æµç¨‹ï¼Œ1.7å’Œ1.8çš„æœ‰ä½•ä¸åŒï¼Ÿ</strong></p><p><img src="/img/else_img/hashMap%E7%9A%84put%E6%B5%81%E7%A8%8B.png"></p><ol><li>åˆ¤æ–­tableæ˜¯å¦ä¸ºnullï¼Œæ˜¯çš„è¯æ‰§è¡Œresize()æ‰©å®¹ï¼ˆæ‡’æƒ°åˆå§‹åŒ–ï¼‰</li><li>è®¡ç®—ç´¢å¼•ï¼ˆhashCode() â€“&gt; hash() â€“&gt; å’Œæ¡¶å¤§å°æ±‚æ¨¡ï¼‰</li><li>å¦‚æœæ¡¶ä¸‹æ ‡æ²¡äººå ç”¨ï¼Œåˆ™åˆ›å»ºNodeå ä½è¿”å›</li><li>å¦‚æœæœ‰äººå ç”¨äº†<ol><li>å¦‚æœæ˜¯TreeNodeèµ°çº¢é»‘æ ‘é€»è¾‘</li><li>å¦‚æœæ˜¯æ™®é€šNodeèµ°é“¾è¡¨é€»è¾‘ï¼Œæ’å…¥æ–°èŠ‚ç‚¹åï¼Œå¦‚æœéœ€è¦æ ‘åŒ–åˆ™èµ°æ ‘åŒ–é€»è¾‘</li><li>éå†é“¾è¡¨æˆ–çº¢é»‘æ ‘æ—¶å‘ç°keyå·²å­˜åœ¨åˆ™è¦†ç›–åŸå…ˆçš„å€¼</li></ol></li><li>è¿”å›å‰æ£€æŸ¥å®¹é‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œè¶…è¿‡åˆ™æ‰©å®¹</li></ol><p>ä¸åŒï¼š</p><ol><li>1.7æ˜¯å¤´æ’æ³•ï¼Œ1.8æ˜¯å°¾æ’æ³•</li><li>1.7æ˜¯å…ƒç´ æ•°é‡&gt;&#x3D;é˜ˆå€¼ä¸”æ²¡æœ‰ç©ºä½æ—¶æ‰æ‰©å®¹ï¼Œ1.8æ˜¯&gt;é˜ˆå€¼æ—¶å°±æ‰©å®¹</li><li>1.8åœ¨æ‰©å®¹è®¡ç®—ç´¢å¼•æ—¶æœ‰ä¼˜åŒ–</li></ol></li><li><p><strong>ä»‹ç»ä¸€ä¸‹getæ–¹æ³•æµç¨‹</strong></p><ol><li>å…ˆåˆ¤æ–­tableæ˜¯å¦éç©ºæˆ–å¤§å°ä¸º0ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å›null</li><li>åˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ çš„keyæ˜¯å¦å’Œè¦æ‰¾çš„keyç›¸åŒï¼Œæ˜¯åˆ™è¿”å›</li><li>å¦åˆ™åˆ¤æ–­èŠ‚ç‚¹çš„ç±»å‹<ol><li>å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™èµ°çº¢é»‘æ ‘çš„é€»è¾‘</li><li>å¦åˆ™éå†é“¾è¡¨æ¥æ‰¾å¯¹åº”keyçš„èŠ‚ç‚¹</li></ol></li></ol></li><li><p><strong>åŠ è½½å› å­ä¸ºä½•é»˜è®¤0.75ï¼Ÿ</strong></p><p>åœ¨ç©ºé—´å ç”¨å’ŒæŸ¥è¯¢æ—¶é—´ä¹‹é—´å–å¾—è¾ƒå¥½çš„å¹³è¡¡</p><p>å¤§äº0.75ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†é“¾è¡¨é•¿äº†å½±å“æ€§èƒ½</p><p>å°äº0.75ï¼Œå†²çªå‡å°‘ï¼Œä½†æ‰©å®¹é¢‘ç¹ç©ºé—´å ç”¨æ›´å¤š</p></li><li><p><strong>å¤šçº¿ç¨‹ä¸‹ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><ol><li><strong>æ‰©å®¹æ­»é“¾</strong>ï¼ˆ1.7ï¼‰ï¼š1.7æ‰©å®¹æ˜¯é‡‡ç”¨å¤´æ’æ³•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè‹¥ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰©å®¹å®Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å†å»æ‰©å®¹ï¼Œä¼šä½¿å¾—é“¾è¡¨å˜æˆå¾ªç¯é“¾è¡¨ï¼Œé€ æˆæ­»é“¾</li><li><strong>æ•°æ®é”™ä¹±</strong>ï¼ˆ1.7ï¼Œ1.8ï¼‰ï¼šputé€»è¾‘æ˜¯å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œåæ’å…¥æ•°æ®ã€‚å¹¶å‘æ¡ä»¶ä¸‹å¯èƒ½å‡ºç°ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ¤æ–­ä¸€ä¸ªä½ç½®ä¸ºç©ºï¼Œåéƒ½å¾€ä¸€ä¸ªä½ç½®æ’å…¥æ•°æ®ï¼Œé€ æˆæ•°æ®ä¸¢å¤±</li></ol></li><li><p><strong>keyèƒ½å¦ä¸ºnullï¼Œä½œä¸ºkeyçš„å¯¹è±¡æœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿ</strong></p><ol><li>HashMapçš„keyå¯ä»¥ä¸ºnullã€‚ä½†Mapçš„å…¶å®ƒå®ç°åˆ™ä¸ç„¶</li><li>ä½œä¸ºkeyçš„å¯¹è±¡ï¼Œå¿…é¡»å®ç°hashCode()ï¼ˆä¸ºäº†keyåœ¨æ•´ä¸ªHashMapä¸­æœ‰æ›´å¥½çš„åˆ†å¸ƒæ€§ï¼‰å’Œequals()ï¼ˆå½“keyç›¸åŒæ—¶åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”keyçš„å†…å®¹ä¸å¯ä»¥ä¿®æ”¹</li></ol></li><li><p><strong>åˆå§‹åŒ–æ—¶ä¼ å…¥çš„å®¹é‡ä¸æ˜¯2çš„å€æ•°ä¼šæ€æ ·ï¼Ÿ</strong></p><p>ä¼šå‘ä¸Šå¯»æ‰¾ç¦»å¾—æœ€è¿‘çš„2çš„å€æ•°</p></li></ul><h4 id="hashCodeå’Œequals"><a href="#hashCodeå’Œequals" class="headerlink" title="hashCodeå’Œequals"></a>hashCodeå’Œequals</h4><p><strong>ä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡» é‡å†™hashCode æ–¹æ³•ï¼Ÿ</strong></p><p>hashCode() çš„ä½œâ½¤æ˜¯è·å–å“ˆå¸Œç ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼Œä¸»è¦åœ¨å“ˆå¸Œè¡¨è¿™ç±»é›†åˆæ˜ å°„çš„æ—¶å€™ç”¨åˆ°</p><ul><li><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™ hashcode â¼€å®šä¹Ÿæ˜¯ç›¸åŒçš„</p></li><li><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ hashcode å€¼ï¼Œå®ƒä»¬ä¹Ÿä¸â¼€å®šæ˜¯ç›¸ç­‰çš„</p></li></ul><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><h5 id="5ç§å®ç°æ–¹å¼"><a href="#5ç§å®ç°æ–¹å¼" class="headerlink" title="5ç§å®ç°æ–¹å¼"></a>5ç§å®ç°æ–¹å¼</h5><h6 id="1-é¥¿æ±‰å¼"><a href="#1-é¥¿æ±‰å¼" class="headerlink" title="1.é¥¿æ±‰å¼"></a>1.é¥¿æ±‰å¼</h6><blockquote><p>è¦ç‚¹ï¼šæ„é€ æ–¹æ³•ç§æœ‰ã€é™æ€æˆå‘˜å˜é‡ã€é™æ€æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton1</span><span class="hljs-params">()</span> &#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton1</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton1</span>();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton1 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç ´åå•ä¾‹çš„åœºæ™¯</strong>ï¼š1.åå°„è·å–ç§æœ‰æ„é€ æ–¹æ³•ï¼Œ2.ååºåˆ—åŒ–ç ´åå•ä¾‹ï¼Œ3ï¼Œunsafeç ´åå•ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1.åå°„è·å–ç§æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">// é¢„é˜²æ–¹æ³•ï¼šåœ¨æ„é€ æ–¹æ³•é‡Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²åˆ›å»º</span><br>Class&lt;Singleton1&gt; clazz = Singleton1.class;<br><br>Constructor&lt;Singleton1&gt; constructor = clazz.getDeclaredConstructor();<span class="hljs-comment">// è·å–æ„é€ æ–¹æ³•</span><br>constructor.setAccessible(<span class="hljs-literal">true</span>);<span class="hljs-comment">// è®¾ç½®ç§æœ‰æ„é€ æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨</span><br>constructor.newInstance();<span class="hljs-comment">// åå°„åˆ›å»ºå®ä¾‹</span><br><br><span class="hljs-comment">// 2.ååºåˆ—åŒ–ç ´åå•ä¾‹</span><br><span class="hljs-comment">// æŠŠå¯¹è±¡å†™åˆ°è¾“å‡ºæµ</span><br><span class="hljs-comment">// ç”¨è¾“å…¥æµè¯»å–è¿™ä¸ªå¯¹è±¡ï¼Œè¿˜åŸå‡ºæ¥çš„å¯¹è±¡ä¸ºæ–°çš„å¯¹è±¡</span><br><span class="hljs-comment">// é¢„é˜²æ–¹æ³•ï¼šé‡å†™readResolve()æ–¹æ³•</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">readResolve</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> INStANCE;<br>&#125;<br><br><span class="hljs-comment">// 3.unsafeç ´åå•ä¾‹</span><br><span class="hljs-comment">// unsafeå¯ä»¥åˆ†é…å†…å­˜ã€é‡Šæ”¾å†…å­˜ã€‚é€šè¿‡Singleton1çš„å­—èŠ‚ç å¯¹è±¡å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„</span><br></code></pre></td></tr></table></figure><h6 id="2-æšä¸¾ç±»"><a href="#2-æšä¸¾ç±»" class="headerlink" title="2.æšä¸¾ç±»"></a>2.æšä¸¾ç±»</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton2</span> &#123;<br>INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åå°„å’Œååºåˆ—åŒ–ä¸ä¼šç ´åå•ä¾‹</p></blockquote><h6 id="3-æ‡’æ±‰å¼"><a href="#3-æ‡’æ±‰å¼" class="headerlink" title="3.æ‡’æ±‰å¼"></a>3.æ‡’æ±‰å¼</h6><blockquote><p>éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton3</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton3</span><span class="hljs-params">()</span> &#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton3</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> Singleton3 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>            INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton3</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="star-4-DCLæ‡’æ±‰å¼"><a href="#star-4-DCLæ‡’æ±‰å¼" class="headerlink" title=":star:4.DCLæ‡’æ±‰å¼"></a>:star:4.DCLæ‡’æ±‰å¼</h6><blockquote><p>double check lockï¼Œç¬¬ä¸‰ç§çš„ä¼˜åŒ–</p></blockquote><p>â€‹<strong>volatile</strong>ï¼šè§£å†³å…±äº«å˜é‡çš„æœ‰åºæ€§å’Œå¯è§æ€§ã€‚</p><p>â€‹è¿™é‡Œä½¿ç”¨volatileä¸»è¦è§£å†³<strong>æœ‰åºæ€§</strong>é—®é¢˜ï¼šnewå¯¹è±¡æ—¶ä¸»è¦æ­¥éª¤ä¸ºåˆ†é…å†…å­˜ã€è°ƒç”¨æ„é€ ã€ç»™é™æ€å˜é‡èµ‹å€¼ã€‚jvmå¯èƒ½ä¼šå¯¹åˆ›å»ºå¯¹è±¡æ­¥éª¤è¿›è¡Œé‡æ’ä¼˜åŒ–ï¼Œå¯¼è‡´å…ˆç»™æ™¯æ³°å˜é‡èµ‹å€¼å†è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œåˆ«çš„çº¿ç¨‹ä¼šè·å¾—ä¸€ä¸ªæ²¡æœ‰åˆå§‹åŒ–å®Œçš„å¯¹è±¡ã€‚volatileä¿®é¥°ååˆ™ä¸ä¼šå‘é€é‡æ’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton4</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton4</span><span class="hljs-params">()</span> &#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton4</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton4 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (Singleton4.class) &#123;<br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>            INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton3</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="5-å†…éƒ¨ç±»å¼"><a href="#5-å†…éƒ¨ç±»å¼" class="headerlink" title="5.å†…éƒ¨ç±»å¼"></a>5.å†…éƒ¨ç±»å¼</h6><blockquote><p>æ‡’æ±‰å¼çš„ï¼Œæ¨è</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton5</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton5</span><span class="hljs-params">()</span> &#123;<br>        <br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span> &#123;<br>        <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton5</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton5</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> Singleton5 <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Holder.INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="jdkä¸­ç”¨åˆ°å•ä¾‹çš„åœ°æ–¹"><a href="#jdkä¸­ç”¨åˆ°å•ä¾‹çš„åœ°æ–¹" class="headerlink" title="jdkä¸­ç”¨åˆ°å•ä¾‹çš„åœ°æ–¹"></a>jdkä¸­ç”¨åˆ°å•ä¾‹çš„åœ°æ–¹</h5><ol><li><p>Runtimeç±»ï¼šé¥¿æ±‰å¼ã€‚åœ¨Systemçš„exit()å’Œgc()æ–¹æ³•ä¸­æœ‰ä½¿ç”¨åˆ°</p></li><li><p>Consoleç±»ï¼šDCLå¼ã€‚æ§åˆ¶å°çš„æŠ½è±¡</p></li><li><p>Collectionsä¸­ç”¨åˆ°ä¸€äº›ç©ºé›†åˆæ—¶ï¼Œè¿™ä¸ªç©ºçš„é›†åˆç”¨åˆ°äº†å•ä¾‹ï¼Œå¦‚EmptyNavigableSetï¼Œä¸ºå†…éƒ¨ç±»å¼</p></li></ol><h3 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h3><h4 id="çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€"><a href="#çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€"></a>çº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€</h4><ul><li><p>javaçº¿ç¨‹åˆ†æˆå…­ç§çŠ¶æ€</p><ol><li><strong>NEW-æ–°å»º</strong>ï¼šçº¿ç¨‹åˆšåˆšåˆ›å»ºå‡ºæ¥ï¼Œè¿˜æ²¡æœ‰è·Ÿæ“ä½œç³»ç»Ÿåº•å±‚çš„çº¿ç¨‹å…³è”èµ·æ¥</li><li><strong>RUNNABLE-å¯è¿è¡Œ</strong>ï¼šjavaçº¿ç¨‹è°ƒç”¨start()åï¼Œè·Ÿæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ç›¸å…³è”ï¼Œä»£ç ç”±æ“ä½œç³»ç»Ÿäº¤ç»™CPUæ‰§è¡Œ</li><li><strong>TERMINATED-ç»ˆç»“</strong>ï¼šä»£ç æ‰§è¡Œå®Œæ¯•</li><li><strong>BLOCKED-é˜»å¡</strong>ï¼šçº¿ç¨‹æ²¡è·å–åˆ°é”æ—¶è¿›å…¥é˜»å¡çŠ¶æ€</li><li><strong>WAITING-ç­‰å¾…</strong>ï¼šè·å–åˆ°é”äº†ï¼Œä½†å‘ç°è¿è¡Œæ‰€éœ€æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨wait()è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä¼šé‡Šæ”¾é”ï¼›å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œç”±å…¶ä»–çº¿ç¨‹è°ƒç”¨notify()å”¤é†’çº¿ç¨‹</li><li><strong>TIMED_WAITING-æœ‰æ—¶é™ç­‰å¾…</strong>ï¼šæ˜¯ç­‰å¾…çŠ¶æ€çš„æœ‰æ—¶é™ç‰ˆã€‚è¿˜æœ‰è°ƒç”¨sleep()ä¹Ÿæ˜¯è¿›å…¥æœ‰æ—¶é™ç­‰å¾…çŠ¶æ€</li></ol><p><img src="/img/else_img/java%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png"></p></li><li><p>æ“ä½œç³»ç»Ÿå±‚é¢åˆ†ä¸ºäº”ç§çŠ¶æ€</p><ol><li><strong>è¿è¡Œ</strong>ï¼šåˆ†åˆ°CPUæ—¶é—´ç‰‡</li><li><strong>å°±ç»ª</strong>ï¼šå¯ä»¥åˆ†åˆ°CPUæ—¶é—´ç‰‡</li><li><strong>é˜»å¡</strong>ï¼šåˆ†ä¸åˆ°CPUæ—¶é—´ç‰‡</li></ol><blockquote><p>Javaä¸­çš„RUNNABLEæ¶µç›–å°±ç»ªã€è¿è¡Œã€é˜»å¡I&#x2F;O</p></blockquote><p><img src="/img/else_img/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png"></p></li></ul><h4 id="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"><a href="#çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°" class="headerlink" title="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"></a>çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°</h4><p>â€‹<img src="/img/else_img/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0.png"></p><p><strong>çº¿ç¨‹æ± </strong>ï¼šç®¡ç†ä¸€ç»„çº¿ç¨‹ï¼Œæ‰§è¡Œæäº¤ç»™çº¿ç¨‹æ± çš„ä»»åŠ¡</p><p><strong>çº¿ç¨‹æ± ä¸»è¦å‚æ•°</strong>ï¼š</p><ol><li>corePollSize æ ¸å¿ƒçº¿ç¨‹æ•°<ul><li>æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°</li></ul></li><li>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°<ul><li>æ ¸å¿ƒçº¿ç¨‹ + æ•‘æ€¥çº¿ç¨‹</li></ul></li><li>keepAliveTime ç”Ÿå­˜æ—¶é—´<ul><li>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹ï¼Œé˜»å¡é˜Ÿåˆ—æ»¡æ—¶åˆ›å»ºæ•‘æ€¥çº¿ç¨‹</li></ul></li><li>unit æ—¶é—´å•ä½<ul><li>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹</li></ul></li><li>workQueue é˜»å¡é˜Ÿåˆ—<ul><li>æ²¡æœ‰ç©ºé—²çš„æ ¸å¿ƒçº¿ç¨‹æ—¶ä»»åŠ¡çš„æš‚å­˜åŒº</li></ul></li><li>threadFactory çº¿ç¨‹å·¥å‚<ul><li>å¯ä»¥ç»™çº¿ç¨‹èµ·å</li></ul></li><li>handler æ‹’ç»ç­–ç•¥<ul><li>æ²¡æœ‰ç©ºé—²çº¿ç¨‹ä¸”é˜»å¡é˜Ÿåˆ—æ»¡çš„æ—¶å€™çš„ç­–ç•¥ï¼Œå››ç§</li></ul></li></ol><p><strong>æ‹’ç»ç­–ç•¥</strong></p><ol><li>AbortPolicy ï¼ˆé»˜è®¤ï¼‰<ul><li>ä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸</li></ul></li><li>CallerRunsPolicy<ul><li>ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li></ul></li><li>DiscardPolicy<ul><li>ä¸¢å¼ƒä»»åŠ¡</li></ul></li><li>DiscardOldPolicy<ul><li>ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­æ”¾çš„æœ€ä¹…çš„ä»»åŠ¡ï¼ŒæŠŠæ–°çš„åŠ å…¥è¿›å»</li></ul></li></ol><p>â€‹</p><h4 id="sleep-amp-wait"><a href="#sleep-amp-wait" class="headerlink" title="sleep &amp; wait"></a>sleep &amp; wait</h4><p><strong>å…±åŒç‚¹</strong>ï¼š</p><ul><li>wait()ã€wait(long)ã€sleep(long) éƒ½æ˜¯è®©çº¿ç¨‹æ”¾å¼ƒCPUçš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</li></ul><p><strong>ä¸åŒç‚¹</strong>ï¼š</p><ul><li>æ–¹æ³•å½’å±ä¸åŒ<ol><li>sleep(long)æ˜¯Threadçš„é™æ€æ–¹æ³•</li><li>wait()ã€wait(long)æ˜¯Objectçš„æˆå‘˜æ–¹æ³•</li></ol></li><li>é†’æ¥æ—¶æœºä¸åŒ<ol><li>sleep(long)å’Œwait(long)åœ¨ç­‰å¤Ÿæ—¶é—´åè¢«å”¤é†’</li><li>wait()å’Œwait(long)è¿˜å¯ä»¥è¢«notify()&#x2F;notifyAll()å”¤é†’</li><li>éƒ½å¯ä»¥é€šè¿‡interrupt()æ‰“æ–­æ¥å”¤é†’ï¼ˆå”¤é†’ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼‰</li></ol></li><li>é”ç‰¹æ€§ä¸åŒ<ol><li>è°ƒç”¨wait()æ–¹æ³•å¿…é¡»å…ˆè·å–åˆ°é”</li><li>wait()æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾é”</li><li>è€Œsleep()å’Œsynchronizedä»£ç å—ä¸€èµ·ä½¿ç”¨åˆ™ä¸ä¼šé‡Šæ”¾é”</li></ol></li></ul><h4 id="Lock-amp-synchronized"><a href="#Lock-amp-synchronized" class="headerlink" title="Lock &amp; synchronized"></a>Lock &amp; synchronized</h4><p><strong>è¯­æ³•å±‚é¢</strong>ï¼š</p><ul><li>synchronizedæ˜¯å…³é”®å­—ï¼ˆC++å®ç°ï¼‰ï¼ŒLockæ˜¯æ¥å£</li><li>synchronizedé€€å‡ºä»£ç å—æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼ŒLockè¦æ‰‹åŠ¨è°ƒç”¨unLock()æ–¹æ³•</li></ul><p><strong>åŠŸèƒ½å±‚é¢</strong>ï¼š</p><ul><li><p>éƒ½æ˜¯æ‚²è§‚é”ï¼Œéƒ½å…·å¤‡äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½</p></li><li><p>Lockæœ‰æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€å¯æ‰“æ–­ã€å¯è¶…æ—¶ã€å¤šæ¡ä»¶å˜é‡</p><blockquote><p>å…¬å¹³é”ï¼šæŒ‰ç…§å…¥é˜»å¡é˜Ÿé¡ºåºè·å–é”</p><p>éå…¬å¹³é”ï¼šè¿˜æœªå…¥é˜Ÿçš„çº¿ç¨‹å¯èƒ½å…ˆè·å–åˆ°é”ï¼ˆæ’é˜Ÿï¼‰</p><p>æ¡ä»¶å˜é‡ï¼šå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè°ƒç”¨Condition.await()è¿›å…¥</p></blockquote></li><li><p>Lockæœ‰é€‚åˆä¸åŒåœºæ™¯çš„å®ç°ï¼Œå¦‚ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰ï¼ŒReentrantReadWriteLockï¼ˆé€‚åˆè¯»å¤šå†™å°‘é”ï¼‰</p></li></ul><p><strong>æ€§èƒ½å±‚é¢</strong>ï¼š</p><ul><li>åœ¨ç«äº‰å°‘æ—¶synchronizedåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ€§èƒ½å¥½</li><li>ç«äº‰å¤šæ—¶Lockæ€§èƒ½æ›´å¥½</li></ul><h4 id="volatileèƒ½å¦ä¿è¯çº¿ç¨‹å®‰å…¨"><a href="#volatileèƒ½å¦ä¿è¯çº¿ç¨‹å®‰å…¨" class="headerlink" title="volatileèƒ½å¦ä¿è¯çº¿ç¨‹å®‰å…¨"></a>volatileèƒ½å¦ä¿è¯çº¿ç¨‹å®‰å…¨</h4><p>çº¿ç¨‹å®‰å…¨è¦è€ƒè™‘ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ol><li>å¯è§æ€§ï¼šå¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å…¶ä»–çº¿ç¨‹èƒ½çœ‹åˆ°æœ€æ–°ç»“æœ</li><li>æœ‰åºæ€§ï¼šä»£ç æŒ‰ç¼–å†™é¡ºåºæ‰§è¡Œ</li><li>åŸå­æ€§ï¼šå¤šè¡Œä»£ç ä»¥ä¸€ä¸ªæ•´ä½“è¿è¡Œï¼ŒæœŸé—´ä¸èƒ½æœ‰å…¶ä»–çº¿ç¨‹æ’é˜Ÿ</li></ol><blockquote><p>å¯è§æ€§é—®é¢˜ï¼šçº¿ç¨‹<strong>é¢‘ç¹</strong>è¯»å–ä¸€ä¸ªåŒä¸€ä¸ªå€¼çš„å˜é‡æ—¶JITç¼–è¯‘å™¨ä¼šå¯¹è¿™æ®µä»£ç è¿›è¡Œä¼˜åŒ–ï¼ŒæŠŠä»£ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œè¿™æ—¶ä¿®æ”¹å†…å­˜ä¸­çš„å˜é‡å¯¹äºè¿™ä¸ªçº¿ç¨‹æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚</p><p>åŠ volatileå…³é”®å­—JITå°±ä¸ä¼šå¯¹å…¶ä¼˜åŒ–</p></blockquote><blockquote><p>æœ‰åºæ€§ï¼šjvmä¼šé€šè¿‡æŒ‡ä»¤é‡æ’æ¥è¿›è¡Œä¼˜åŒ–ã€‚</p><p>åŠ volatileä¼šä½¿ç”¨<strong>å†™å±éšœ</strong>ä¿è¯ä¸Šé¢çš„ä»£ç ä¸åˆ°å½“å‰å˜é‡çš„ä¸‹é¢ï¼Œä½¿ç”¨<strong>è¯»å±éšœ</strong>ä¿è¯ä¸‹é¢çš„ä»£ç ä¸åˆ°ä¸Šé¢æ¥</p></blockquote><p>volatileåªèƒ½ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</p><h4 id="ä¹è§‚é”-amp-æ‚²è§‚é”"><a href="#ä¹è§‚é”-amp-æ‚²è§‚é”" class="headerlink" title="ä¹è§‚é” &amp; æ‚²è§‚é”"></a>ä¹è§‚é” &amp; æ‚²è§‚é”</h4><ol><li><strong>æ‚²è§‚é”</strong>çš„ä»£è¡¨æ˜¯synchronizedå’ŒLock<ol><li>æ ¸å¿ƒæ˜¯åªæœ‰å æœ‰äº†é”æ‰èƒ½æ“ä½œå…±äº«å˜é‡</li><li>çº¿ç¨‹ä»è¿è¡Œ-&gt;é˜»å¡-&gt;å”¤é†’æ¶‰åŠä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé¢‘ç¹çš„è¯å½±å“æ€§èƒ½</li><li>è·å–é”æ—¶åˆ¤æ–­å·²è¢«ä¸Šé”ï¼Œä¼šå°è¯•é‡è¯•å‡ æ¬¡ï¼Œå‡å°‘é˜»å¡çš„æœºä¼šï¼ˆè‡ªæ—‹ï¼‰</li></ol></li><li><strong>ä¹è§‚é”</strong>çš„ä»£è¡¨æ˜¯AtomicIntegerï¼ˆåŸå­æ•´æ•°ï¼‰ï¼Œä½¿ç”¨casä¿è¯åŸå­æ€§<ol><li>æ ¸å¿ƒæ˜¯æ— éœ€åŠ é”ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸä¿®æ”¹å…±äº«å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹ä¸æ–­é‡è¯•ç›´è‡³æˆåŠŸï¼ˆCASçš„èµ‹å€¼æ“ä½œæ˜¯åŸå­æ€§çš„ï¼‰</li><li>æ²¡æœ‰é˜»å¡ï¼Œä¸æ¶‰åŠä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>éœ€è¦å¤šæ ¸cpuæ”¯æŒï¼Œä¸”çº¿ç¨‹æ•°ä¸åº”è¶…è¿‡cpuæ ¸æ•°ï¼ˆè¶…è¿‡äº†ä»ç„¶ä¼šå‡ºç°ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰</li></ol></li></ol><h4 id="Hashtable-vs-ConcurrentHashMap"><a href="#Hashtable-vs-ConcurrentHashMap" class="headerlink" title="Hashtable vs ConcurrentHashMap"></a>Hashtable vs ConcurrentHashMap</h4><ol><li>éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„Mapé›†åˆ</li><li>Hashtableå¹¶å‘åº¦ä½ï¼Œæ•´ä¸ªHashtableåªæœ‰ä¸€æŠŠé”ï¼ŒåŒæ—¶åªèƒ½ä¸€ä¸ªçº¿ç¨‹æ“ä½œå®ƒ</li><li>1.8å¼€å§‹ConcurrentHashMapå°†æ¯ä¸ªæ•°ç»„çš„å¤´ç»“ç‚¹ä½œä¸ºé”ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„å¤´ç»“ç‚¹ä¸ä¼šäº§ç”Ÿå†²çª</li></ol><p><strong>ConcurrentHashMap</strong>ï¼š</p><ol><li><p>ç»“æ„ï¼šæ•°ç»„+é“¾è¡¨|çº¢é»‘æ ‘</p></li><li><p>åˆ°è¾¾å®¹é‡çš„0.75å°±ä¼šæ‰©å®¹</p></li><li><p>å±æ€§ï¼š</p><ul><li>capacityï¼šå‡å®šcapacityä¸ºè¦æ”¾è¿›æ¥çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œé€šè¿‡capacityæ¥è®¡ç®—æ•°ç»„çš„é•¿åº¦ã€‚ï¼ˆHashMapçš„capacityæ„æ€ä¸ºåˆå§‹æ•°ç»„é•¿åº¦ï¼‰</li><li>factorï¼šæ‰©å®¹çš„é˜ˆå€¼ï¼Œåªåœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ï¼Œä¹‹åéƒ½æŒ‰0.75è®¡ç®—</li></ul></li><li><p>å› ä¸ºæ¯ä¸ªæ•°ç»„çš„å¤´ç»“ç‚¹éƒ½åˆ†åˆ«æœ‰ä¸€æŠŠé”ï¼Œæ•…å¹¶å‘åº¦é«˜</p></li><li><p>æ‰©å®¹æµç¨‹ï¼š</p><ul><li>ä»æœ€åä¸€ä¸ªæ•°ç»„èŠ‚ç‚¹å¼€å§‹æ‰©å®¹ï¼›</li><li>é“¾è¡¨è¿ç§»æ˜¯é€šè¿‡å¤åˆ¶<em><strong>æ–°çš„</strong></em>é“¾è¡¨å…ƒç´ åˆ°æ–°æ•°ç»„ä¸­ï¼Œé˜²æ­¢è¿ç§»è¿‡ç¨‹ä¸­é“¾è¡¨çš„nextæŒ‡é’ˆå‘ç”Ÿå˜åŠ¨é€ æˆçš„å½±å“å½±å“;</li><li>æ‰©å®¹å®Œåç»™åŸæ•°ç»„èŠ‚ç‚¹çš„å¤´ç»“ç‚¹ç½®<code>forwardingNode</code>ï¼Œè¡¨ç¤ºå·²ç»æ‰©å®¹å®Œæ¯•ã€‚</li><li>å¿…é¡»ç­‰æ•´ä¸ªmapæ‰©å®¹å®Œæ‰èƒ½æ‰§è¡Œputæ“ä½œï¼Œå¦‚æœæ¥putçš„çº¿ç¨‹å‘ç°mapæ­£åœ¨æ‰©å®¹ï¼Œå¯ä»¥æ¥å¸®å¿™æ‰©å®¹ã€‚</li></ul></li></ol><h4 id="è°ˆè°ˆå¯¹ThreadLocalçš„ç†è§£"><a href="#è°ˆè°ˆå¯¹ThreadLocalçš„ç†è§£" class="headerlink" title="è°ˆè°ˆå¯¹ThreadLocalçš„ç†è§£"></a>è°ˆè°ˆå¯¹ThreadLocalçš„ç†è§£</h4><p><strong>ä½œç”¨</strong>ï¼šå¯ä»¥å®ç°èµ„æºå¯¹è±¡çº¿ç¨‹é—´çš„éš”ç¦»ï¼Œçº¿ç¨‹å†…çš„å…±äº«</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Utils</span>&#123;<br>    <span class="hljs-comment">// çº¿ç¨‹é—´ä½¿ç”¨ä¸åŒçš„èµ„æºï¼Œçº¿ç¨‹é—´éš”ç¦»</span><br>    <span class="hljs-comment">// çº¿ç¨‹å†…å…±äº«åŒä¸€ä¸ªèµ„æº</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Connection&gt; t1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>&lt;&gt;();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> t1.get();<br>        <span class="hljs-keyword">if</span> (conn == <span class="hljs-literal">null</span>) &#123;<br>            conn = innerGetConnection();<span class="hljs-comment">// åˆ›å»ºæ–°çš„è¿æ¥å¯¹è±¡</span><br>            t1.set(conn);<br>        &#125;<br>        <span class="hljs-keyword">return</span> conn;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">innerGetConnection</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test?userSSL=false&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼š</p><ul><li>æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªThreadLocalMapï¼Œç”¨æ¥å­˜å‚¨èµ„æº</li><li>è°ƒç”¨ThreadLocalçš„set()æ–¹æ³•æ—¶ï¼Œå°±æ˜¯æŠŠThreadLocalä½œä¸ºkeyï¼Œèµ„æºå¯¹è±¡ä½œä¸ºvalueå­˜å…¥åˆ°mapä¸­</li><li>è°ƒç”¨ThreadLocalçš„get()æ–¹æ³•æ—¶ï¼Œå°±æ˜¯å»mapä¸­æ‰¾ä»¥å½“å‰ThreadLocalä¸ºkeyçš„èµ„æº</li><li>è°ƒç”¨ThreadLocalçš„remove()æ–¹æ³•æ—¶ï¼Œ å°±æ˜¯å»mapä¸­åˆ é™¤ä»¥å½“å‰ThreadLocalä¸ºkeyçš„èµ„æº</li><li>å¦‚æœäº§ç”Ÿhashå†²çªè§£å†³æ–¹æ³•æ˜¯å¼€æ”¾å¯»å€æ³•</li><li>åƒåœ¾å›æ”¶ï¼š<ul><li>ThreadLocalMapçš„keyæ˜¯å¼±å¼•ç”¨ï¼ˆå¦‚æœå¯¹äºå¯¹è±¡çš„å¼•ç”¨ä¸­æœ‰å¼ºå¼•ç”¨ï¼Œåˆ™ä¸èƒ½è¢«å›æ”¶ï¼Œå¦‚æœéƒ½æ˜¯å¼±å¼•ç”¨ï¼Œåˆ™å¯ä»¥è¢«å›æ”¶ï¼‰ï¼Œç”¨äºè§£å†³å½“å…¶å®ƒåœ°æ–¹éƒ½æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªèµ„æºæ—¶ï¼Œè¿™ä¸ªèµ„æºçš„keyå¯ä»¥è¢«åƒåœ¾å›æ”¶</li><li>åœ¨get()æ—¶å‘ç°keyä¸ºnullï¼Œvalueå°±ä¼šè¢«é‡Šæ”¾ï¼›</li><li>åœ¨set()æ—¶å‘ç°keyä¸ºnullï¼Œä¼šæŠŠå‘¨å›´çš„null keyä¹Ÿé¡ºæ‰‹é‡Šæ”¾</li><li>åœ¨remove()æ—¶ä¼šé‡Šæ”¾value</li></ul></li></ul><h4 id="å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe"><a href="#å¿«é€Ÿå¤±è´¥-fail-fast-å’Œå®‰å…¨å¤±è´¥-fail-safe" class="headerlink" title="å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)"></a>å¿«é€Ÿå¤±è´¥(fail-fast)å’Œå®‰å…¨å¤±è´¥(fail-safe)</h4><p><strong>å¿«é€Ÿå¤±è´¥</strong></p><ul><li>java.utilåŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œå¦‚ArrayList</li><li>è¿­ä»£å™¨ä¸­ä½¿ç”¨modCountè®°å½•åŸé›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ¯éå†ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéƒ½ä¼šå’ŒåŸæ•°ç»„ä¸­çš„modCountå€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸ä¸€è‡´ç›´æ¥æŠ›å‡º<code>Concurrent Modification Exception</code>å¼‚å¸¸</li></ul><p><strong>å®‰å…¨å¤±è´¥</strong></p><ul><li>java.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¦‚CopyOnWriteArrayList</li><li>éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆ å¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†</li><li>ç¼ºç‚¹ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿ åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„</li></ul><blockquote><p>CopyOnWriteArrayListé‡‡ç”¨äº†ä¸€ç§<strong>è¯»å†™åˆ†ç¦»</strong>çš„å¹¶å‘ç­–ç•¥ã€‚CopyOnWriteArrayListå®¹å™¨ å…è®¸å¹¶å‘è¯»ï¼Œè¯»æ“ä½œæ˜¯æ— é”çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚è‡³äºå†™æ“ä½œï¼Œæ¯”å¦‚å‘å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªå…ƒ ç´ ï¼Œåˆ™é¦–å…ˆå°†å½“å‰å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œç»“æŸä¹‹åå†å°†åŸå®¹ å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚</p></blockquote><h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><h4 id="JVMå†…å­˜ç»“æ„"><a href="#JVMå†…å­˜ç»“æ„" class="headerlink" title="JVMå†…å­˜ç»“æ„"></a>JVMå†…å­˜ç»“æ„</h4><ul><li>Java Sourceï¼šæºä»£ç </li><li>Java Classï¼šå­—èŠ‚ç </li><li>ç±»åŠ è½½å­ç³»ç»Ÿï¼šæŠŠå­—èŠ‚ç æ–‡ä»¶åŠ è½½åˆ°æ–¹æ³•åŒºï¼Œå­˜æ”¾ç±»çš„ä¿¡æ¯</li><li>Heapå †ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ï¼Œå­˜æ”¾å¯¹è±¡çš„ä¿¡æ¯</li><li>JVM Stacksè™šæ‹Ÿæœºæ ˆï¼šä»è™šæ‹Ÿæœºæ ˆä¸­ç»™çº¿ç¨‹åˆ†é…å†…å­˜ï¼Œå­˜æ”¾æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ã€å¯¹è±¡çš„å¼•ç”¨</li><li>PCç¨‹åºè®¡æ•°å™¨ï¼šå­˜æ”¾å½“å‰çº¿ç¨‹æ‰§è¡Œåˆ°äº†ç¬¬å‡ è¡Œä»£ç </li><li>Interpreterè§£é‡Šå™¨ï¼šé€è¡Œè§£é‡Šæ‰§è¡Œä»£ç ï¼Œæ•ˆç‡ä½</li><li>JIT Compiler å³æ—¶ç¼–è¯‘å™¨ï¼šå­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæ•ˆç‡é«˜</li></ul><p>â€‹<img src="/img/else_img/JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.png"></p><h5 id="æ–¹æ³•åŒºä¸æ°¸ä¹…ä»£ã€å…ƒç©ºé—´çš„å…³ç³»"><a href="#æ–¹æ³•åŒºä¸æ°¸ä¹…ä»£ã€å…ƒç©ºé—´çš„å…³ç³»" class="headerlink" title="æ–¹æ³•åŒºä¸æ°¸ä¹…ä»£ã€å…ƒç©ºé—´çš„å…³ç³»"></a>æ–¹æ³•åŒºä¸æ°¸ä¹…ä»£ã€å…ƒç©ºé—´çš„å…³ç³»</h5><ol><li>æ–¹æ³•åŒºæ˜¯JVMè§„èŒƒä¸­<strong>å®šä¹‰</strong>çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œç”¨æ¥å­˜å‚¨ç±»å…ƒæ•°æ®ã€æ–¹æ³•å­—èŠ‚ç ã€å³æ—¶ç¼–è¯‘å™¨éœ€è¦çš„ä¿¡æ¯ç­‰</li><li>æ°¸ä¹…ä»£æ˜¯Hotspotè™šæ‹Ÿæœºå¯¹JVMè§„èŒƒçš„<strong>å®ç°</strong>ï¼ˆ1.8ä¹‹å‰ï¼‰</li><li>å…ƒç©ºé—´æ˜¯Hotspotè™šæ‹Ÿæœºå¯¹JVMè§„èŒƒçš„<strong>å®ç°</strong>ï¼ˆ1.8ä¹‹åï¼‰</li><li>æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´æœ€å¤§çš„åŒºåˆ«æ˜¯å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ä½œä¸ºä¿¡æ¯çš„å­˜å‚¨ç©ºé—´</li></ol><h5 id="å…ƒç©ºé—´åŠ è½½ã€é‡Šæ”¾ç±»ä¿¡æ¯"><a href="#å…ƒç©ºé—´åŠ è½½ã€é‡Šæ”¾ç±»ä¿¡æ¯" class="headerlink" title="å…ƒç©ºé—´åŠ è½½ã€é‡Šæ”¾ç±»ä¿¡æ¯"></a>å…ƒç©ºé—´åŠ è½½ã€é‡Šæ”¾ç±»ä¿¡æ¯</h5><p>åŠ è½½ï¼šå½“ç¬¬ä¸€æ¬¡ä½¿ç”¨ç±»çš„æ—¶å€™æŠŠå­—èŠ‚ç åŠ è½½åˆ°å…ƒç©ºé—´</p><p>é‡Šæ”¾ï¼šå½“ç±»çš„å®ä¾‹ã€Classç±»ä¸å†è¢«ä½¿ç”¨ï¼Œä¸”åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨ä¹Ÿä¸å†ä½¿ç”¨ï¼ˆç±»åŠ è½½å™¨åŠ è½½çš„æ‰€æœ‰ç±»éƒ½ä¸å†è¢«ä½¿ç”¨ï¼‰çš„æ—¶å€™æ‰ä¼šè¢«é‡Šæ”¾</p><h5 id="å†…å­˜å‚æ•°"><a href="#å†…å­˜å‚æ•°" class="headerlink" title="å†…å­˜å‚æ•°"></a>å†…å­˜å‚æ•°</h5><p><strong>ä¾‹é¢˜</strong>ï¼š<code>-Xmx10260m -Xms10240m -Xmn5120m -XX:SurvivorRatio=3</code>ï¼Œå…¶æœ€å°å†…å­˜å’ŒSurvivoråŒºæ€»å¤§å°åˆ†åˆ«æ˜¯ï¼Ÿ</p><p>â€‹<code>-Xmx</code>ï¼šè™šæ‹Ÿæœºæœ€å¤§å†…å­˜</p><p>â€‹<code>-Xms</code>ï¼šè™šæ‹Ÿæœºæœ€å°å†…å­˜</p><p>â€‹<code>-Xmn</code>ï¼šæ–°ç”Ÿä»£å†…å­˜å¤§å°</p><p>â€‹<code>-Xss</code>ï¼šè™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªçº¿ç¨‹æœ€å¤§å†…å­˜</p><p>â€‹<code>-XX:SurvivorRatio</code>ï¼šæ–°ç”Ÿä»£ä¼Šç”¸åŒºå’Œ<code>from</code>æˆ–<code>to</code>åŒºçš„æ¯”ä¾‹</p><p>â€‹æ‰€ä»¥è¿™é¢˜æœ€å°å†…å­˜ä¸º10Gï¼ŒSurvivoråŒºï¼ˆfrom+toï¼‰å¤§å°ä¸º2G</p><h4 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h4><ol><li><p><strong>æ ‡è®°æ¸…é™¤</strong></p><ol><li><p>æ ‡è®°ï¼šä¸€å®šä¸ä¼šè¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡è¢«ä½œä¸ºæ ¹å¯¹è±¡ï¼Œæ²¿ç€æ ¹å¯¹è±¡çš„å¼•ç”¨è¿›è¡Œæ ‡è®°ï¼Œè¢«æ ‡è®°çš„å¯¹è±¡ä¸èƒ½è¢«åƒåœ¾å›æ”¶</p></li><li><p>æ¸…é™¤ï¼šæŠŠæ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡è¿›è¡Œå†…å­˜é‡Šæ”¾</p></li><li><p>ç¼ºç‚¹ï¼šå¯¹è±¡ä¸æ˜¯è¿ç»­çš„ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ï¼Œå·²ç»æ²¡æœ‰å›æ”¶å™¨åœ¨ä½¿ç”¨è¿™ä¸ªç®—æ³•</p><p><img src="/img/else_img/%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4.png"></p></li></ol></li><li><p><strong>æ ‡è®°æ•´ç†</strong></p><ol><li><p>æ•´ç†ï¼šæ¸…é™¤åç§»åŠ¨å¯¹è±¡å¾€ä¸€ç«¯é æ‹¢</p></li><li><p>ç¼ºç‚¹ï¼šç§»åŠ¨å¯¹è±¡é€ æˆæ•ˆç‡ä½</p><p><img src="/img/else_img/%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86.png"></p></li></ol></li><li><p><strong>æ ‡è®°å¤åˆ¶</strong></p><ol><li><p>å¤åˆ¶ï¼šæ ‡è®°åæŠŠå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€å—å†…å­˜ä¸­ï¼Œæ¸…ç©ºåŸæ¥çš„é‚£ç‰‡å†…å­˜</p></li><li><p>ç¼ºç‚¹ï¼šå ç”¨çš„å†…å­˜è¾ƒå¤š</p><p><img src="/img/else_img/%E6%A0%87%E8%AE%B0%E5%A4%8D%E5%88%B6.png"></p></li></ol></li></ol><p>æ–°ç”Ÿä»£é€‚åˆæ ‡è®°å¤åˆ¶æ³•ï¼Œè€å¹´ä»£é€‚åˆæ ‡è®°æ•´ç†</p><h5 id="GCå’Œåˆ†ä»£å›æ”¶ç®—æ³•"><a href="#GCå’Œåˆ†ä»£å›æ”¶ç®—æ³•" class="headerlink" title="GCå’Œåˆ†ä»£å›æ”¶ç®—æ³•"></a>GCå’Œåˆ†ä»£å›æ”¶ç®—æ³•</h5><ul><li>GCçš„ç›®çš„åœ¨äºè‡ªåŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ï¼ŒåŠ å¿«åˆ†é…é€Ÿåº¦</li><li>GCè¦ç‚¹<ol><li>å›æ”¶åŒºåŸŸæ˜¯<strong>å †å†…å­˜</strong>ï¼Œè™šæ‹Ÿæœºæ ˆå†…å­˜åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸä¼šè‡ªåŠ¨é‡Šæ”¾</li><li>ä½¿ç”¨<strong>å¯è¾¾æ€§ç®—æ³•</strong>ï¼Œ<strong>ä¸‰è‰²æ ‡è®°æ³•</strong>æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œé‡Šæ”¾æœªæ ‡è®°å¯¹è±¡</li><li>GCå¤§éƒ½åœ¨ç”¨<strong>åˆ†ä»£å›æ”¶æ€æƒ³</strong>ï¼Œå°†å›æ”¶åŒºåŸŸåˆ†æˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œåº”ç”¨ä¸åŒçš„ç­–ç•¥</li><li>æ ¼å±€GCè§„æ¨¡å¯ä»¥åˆ†æˆ<strong>MinorGC</strong>ã€<strong>MixedGC</strong>ã€<strong>FullGC</strong></li></ol></li><li>åˆ†ä»£å›æ”¶<ol><li>ä¼Šç”¸åŒºedenï¼šåˆ†é…æ–°å¯¹è±¡</li><li>å¹¸å­˜åŒºsurvivorï¼šåˆ†æˆfromå’Œtoï¼Œå­˜æ”¾å¹¸å­˜å¯¹è±¡</li><li>è€å¹´ä»£oldï¼Œå­˜æ”¾æ‰›è¿‡å¤šæ¬¡å›æ”¶åæ™‹å‡çš„å¯¹è±¡ï¼ˆå¹¸å­˜åŒºå†…å­˜ä¸è¶³æˆ–å¤§å¯¹è±¡ä¼šå¯¼è‡´æå‰æ™‹å‡ï¼‰</li></ol></li><li>GCè§„æ¨¡<ol><li>MinorGCå‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼Œæ—¶é—´çŸ­</li><li>MixedGCä¸ºæ–°ç”Ÿä»£+éƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼ŒG1æ”¶é›†å™¨ç‰¹æœ‰</li><li>FullGCä¸ºæ–°ç”Ÿä»£+è€å¹´ä»£ï¼Œå›æ”¶æ—¶é—´é•¿</li></ol></li></ul><h5 id="ä¸‰è‰²æ ‡è®°ä¸å¹¶å‘æ¼æ ‡"><a href="#ä¸‰è‰²æ ‡è®°ä¸å¹¶å‘æ¼æ ‡" class="headerlink" title="ä¸‰è‰²æ ‡è®°ä¸å¹¶å‘æ¼æ ‡"></a>ä¸‰è‰²æ ‡è®°ä¸å¹¶å‘æ¼æ ‡</h5><ul><li><p>ç”¨ä¸‰ç§é¢œè‰²æ ‡è®°å¯¹è±¡çš„æ ‡è®°çŠ¶æ€</p><ol><li>é»‘è‰² - å·²æ ‡è®°</li><li>ç°è‰² - æ ‡è®°ä¸­</li><li>ç™½è‰² - æœªæ ‡è®°</li></ol><p><img src="/img/else_img/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0.png"></p></li><li><p>æ¼æ ‡é—®é¢˜</p><ol><li>åƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æ ‡è®°æ—¶ç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¯¼è‡´å¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»å‘ç”Ÿæ”¹å˜ï¼Œä»è€Œå½±å“æ ‡è®°çš„è¿‡ç¨‹</li><li>è§£å†³æ–¹æ¡ˆï¼š<ol><li>Incremental Updateï¼šè®°å½•å¼•ç”¨å…³ç³»è¢«ä¿®æ”¹çš„å¯¹è±¡ï¼ˆé»‘-&gt;ç°ï¼‰ï¼Œåœ¨æœ€åstop the worldæ—¶é‡æ–°æ ‡è®°è¿™äº›å¯¹è±¡</li><li>Snapshot At The Beginningï¼šè®°å½•æ–°åŠ å…¥çš„å¯¹è±¡å’Œè¢«åˆ é™¤å¼•ç”¨å…³ç³»çš„å¯¹è±¡ï¼Œåœ¨æœ€åstop the worldæ—¶é‡æ–°æ ‡è®°è¿™äº›å¯¹è±¡</li></ol></li></ol></li></ul><h4 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h4><ul><li>ï¼ˆå¹¶è¡Œå›æ”¶å™¨ï¼‰Parallel GC<ol><li>endenå†…å­˜ä¸è¶³æ—¶å‘ç”ŸMinorGCï¼Œæ ‡è®°å¤åˆ¶STW</li><li>oldå†…å­˜ä¸è¶³æ—¶å‘ç”ŸFullGCï¼Œæ ‡è®°æ•´ç†STW</li><li>å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ<strong>æ³¨é‡ååé‡</strong></li></ol></li><li>ï¼ˆå¹¶å‘æ ‡è®°æ•´ç†ï¼‰Concurrent Mark Sweep GC<ol><li>old<strong>å¹¶å‘æ ‡è®°</strong>ï¼Œé‡æ–°æ ‡è®°æ—¶éœ€è¦STWï¼Œ<strong>å¹¶å‘æ¸…é™¤</strong></li><li>Failback Full GC å¹¶å‘å¤±è´¥æ—¶è§¦å‘Full GC</li><li>å¤§éƒ¨åˆ†æ—¶é—´å’Œç”¨æˆ·çº¿ç¨‹å¹¶å‘ï¼Œ<strong>æ³¨é‡å“åº”æ—¶é—´</strong></li></ol></li><li>G1 GC<ol><li>å…¼é¡¾å“åº”æ—¶é—´å’Œååé‡</li><li>åˆ’åˆ†å¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“edenï¼Œsurvivorï¼Œoldï¼Œhumongous</li><li>è¿‡ç¨‹ï¼š<ol><li>æ–°ç”Ÿä»£å›æ”¶ï¼šedenæ ‡è®°å¤åˆ¶STW</li><li>å¹¶å‘æ ‡è®°ï¼šold<strong>å¹¶å‘æ ‡è®°</strong>ï¼Œé‡æ–°æ ‡è®°æ—¶éœ€STW</li><li><strong>æ··åˆæ”¶é›†</strong>ï¼šeden + ä¼˜å…ˆæ”¶é›†å›æ”¶ä»·å€¼é«˜çš„oldï¼Œå¤åˆ¶æ—¶STW</li><li>Failback Full GCï¼šå…œåº•</li></ol></li></ol></li></ul><h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p>é™¤äº†ç¨‹åºè®¡æ•°å™¨ï¼Œå…¶ä»–éƒ½æœ‰å¯èƒ½äº§ç”Ÿæº¢å‡º</p><h5 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h5><p>OutOfMemoryErrorï¼š</p><ol><li>å †å†…å­˜è€—å°½</li><li>æ–¹æ³•åŒºå†…å­˜è€—å°½</li><li>è™šæ‹Ÿæœºæ ˆç´¯ç§¯ - æ¯ä¸ªçº¿ç¨‹æœ€å¤šå ç”¨1Må†…å­˜ï¼Œçº¿ç¨‹ä¸ªæ•°å¤ªå¤šå¯¼è‡´æº¢å‡º</li></ol><p>StackOverflowErrorï¼š</p><ol><li>è™šæ‹Ÿæœºæ ˆå†…éƒ¨ - æ–¹æ³•è°ƒç”¨è¿‡å¤šå¯¼è‡´çº¿ç¨‹çš„å†…å­˜æº¢å‡º</li></ol><h5 id="æº¢å‡ºæƒ…å†µ"><a href="#æº¢å‡ºæƒ…å†µ" class="headerlink" title="æº¢å‡ºæƒ…å†µ"></a>æº¢å‡ºæƒ…å†µ</h5><p>æƒ…å†µ1ï¼šè¯¯ç”¨å›ºå®šå¤§å°çº¿ç¨‹æ± </p><ul><li>ä½¿ç”¨<code>Executors.newFixedThreadPool()</code>åˆ›å»ºçš„çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰ï¼Œå¯ä»¥æ”¾æ— æ•°çš„ä»»åŠ¡ï¼Œä»»åŠ¡å¯¹è±¡å¤ªå¤šå¯¼è‡´å †å†…å­˜æº¢å‡º</li><li>è§£å†³æ–¹å¼ï¼šä¸ä½¿ç”¨<code>newFixedThreadPool()</code>ï¼Œè€Œæ˜¯è‡ªå·±<code>new ThreadPoolExecutor</code>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</li></ul><p>æƒ…å†µ2ï¼šè¯¯ç”¨å¸¦ç¼“å†²çº¿ç¨‹æ± </p><ul><li>ä½¿ç”¨<code>Executors.newCacheThreadPool()</code>åˆ›å»ºçš„çº¿ç¨‹æ± åªæœ‰æ•‘æ€¥çº¿ç¨‹ï¼Œå¯ä»¥åˆ›å»ºæ— æ•°çš„çº¿ç¨‹å¯¼è‡´è™šæ‹Ÿæœºæ ˆæº¢å‡º</li><li>è§£å†³æ–¹å¼ï¼šè‡ªå·±<code>new ThreadPoolExecutor</code></li></ul><p>æƒ…å†µ3ï¼šä¸€æ¬¡æŸ¥è¯¢å¤ªå¤šæ•°æ®</p><ul><li>æ•°æ®é‡å¤ªå¤§æŠŠç‰©ç†å†…å­˜æŒ¤çˆ†äº†</li><li>è§£å†³æ–¹å¼ï¼šç»™æŸ¥è¯¢é™åˆ¶æœ€å¤§æ¡æ•°</li></ul><p>æƒ…å†µ4ï¼šåŠ¨æ€ç±»å¤ªå¤š</p><ul><li>ä¸æ–­åŠ è½½æ–°çš„Classåˆ°æ–¹æ³•åŒºï¼ŒæŠŠæ–¹æ³•åŒºæŒ¤çˆ†äº†</li><li>è§£å†³æ–¹å¼ï¼šé™ä½ç±»çš„å£°æ˜å‘¨æœŸï¼Œå¦‚ä¸ä½¿ç”¨staticç­‰</li></ul><h4 id="ç±»åŠ è½½è¿‡ç¨‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶"><a href="#ç±»åŠ è½½è¿‡ç¨‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶"></a>ç±»åŠ è½½è¿‡ç¨‹ï¼ŒåŒäº²å§”æ´¾æœºåˆ¶</h4><p><strong>ç±»åŠ è½½æ–¹å¼</strong>ï¼š</p><ol><li>éšå¼è£…è½½ï¼šé€šè¿‡newç­‰æ–¹å¼ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œéšå¼è°ƒç”¨ç±»åŠ è½½å™¨åŠ è½½å¯¹åº”çš„ç±»åˆ°JVMä¸­</li><li>æ˜¾ç¤ºè£…è½½ï¼š<code>Class.forName(className)</code>æˆ–<code>ClassLoad.loadClass(className)</code></li></ol><p><strong>ç±»åŠ è½½å™¨ç§ç±»</strong>ï¼š</p><ol><li>BootStrap Loaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰ï¼ŒåŠ è½½ç³»ç»Ÿç±»</li><li>ExtClass Loaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰ï¼ŒåŠ è½½æ‰©å±•ç±»</li><li>AppClass Loaderï¼ˆåº”ç”¨ç±»åŠ è½½å™¨ï¼‰ï¼ŒåŠ è½½åº”ç”¨ç±»</li></ol><p><strong>ç±»åŠ è½½è¿‡ç¨‹</strong>ï¼š</p><p><img src="/img/else_img/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png"></p><ol><li><strong>åŠ è½½</strong><ol><li>é€šè¿‡ç±»çš„å…¨é™å®šåæ¥è·å–åˆ°classæ–‡ä»¶ï¼Œå°†å­—èŠ‚ç æ–‡ä»¶è½½å…¥æ–¹æ³•åŒºï¼Œå¹¶åˆ›å»º.classå¯¹è±¡(å †å†…)</li><li>ç±»çš„çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±»</li><li>åŠ è½½æ˜¯æ‡’æƒ°æ‰§è¡Œ</li></ol></li><li><strong>é“¾æ¥</strong><ol><li>éªŒè¯-éªŒè¯ç±»æ˜¯å¦ç¬¦åˆClassè§„èŒƒ</li><li>å‡†å¤‡-ä¸ºstaticå˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼ï¼ˆé›¶å€¼ï¼‰ï¼›å°†ç±»çš„å…ƒä¿¡æ¯åŠ è½½è¿›å…ƒç©ºé—´</li><li>è§£æ-å°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</li><li>ç»™finalå˜é‡èµ‹å€¼ï¼Œå¦‚æœè°ƒç”¨finalå˜é‡ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li></ol></li><li><strong>åˆå§‹åŒ–</strong><ol><li>ä»ä¸Šå¾€ä¸‹ç»™éfinalé™æ€å˜é‡çš„èµ‹å€¼å’Œæ‰§è¡Œé™æ€ä»£ç å—</li><li>åˆå§‹åŒ–æ˜¯æ‡’æƒ°æ‰§è¡Œ</li></ol></li></ol><p><strong>ç±»åˆå§‹åŒ–æ–¹æ³•</strong>ï¼š</p><ul><li>æŠŠé™æ€å˜é‡ã€finalä¿®é¥°çš„å¼•ç”¨ç±»å‹å’Œé™æ€ä»£ç å—åˆæˆä¸€ä¸ªstaticæ–¹æ³•ï¼Œåœ¨ç±»çš„åˆå§‹åŒ–æ—¶è°ƒç”¨</li></ul><p><strong>è§£æè¿‡ç¨‹</strong>ï¼š</p><ul><li>æ–¹æ³•å†…è¿˜æ²¡æœ‰ä½¿ç”¨åˆ°ç±»çš„æ—¶å€™ï¼Œå¸¸é‡æ± é‡Œçš„ç±»ä¸ºç¬¦å·å¼•ç”¨</li><li>å½“ä½¿ç”¨åˆ°è¿™ä¸ªç±»æ—¶ï¼Œè¿™ä¸ªç±»è¢«åŠ è½½åˆ°å †ä¸­ï¼ŒåŸå…ˆè°ƒç”¨è¿™ä¸ªç±»çš„å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨ä¹Ÿå°±è¢«æ›¿æ¢ä¸ºçœŸå®çš„åœ°å€</li></ul><p><strong>åŒäº²å§”æ´¾</strong></p><ul><li>æŒ‡ä¼˜å…ˆå§”æ´¾ä¸Šçº§ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½</li><li>å½“ä¸Šçº§ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°è¦åŠ è½½çš„ç±»ï¼Œä¸‹çº§ç±»åŠ è½½å™¨æ‰æœ‰èµ„æ ¼æ‰§è¡ŒåŠ è½½</li><li>ä¸Šçº§ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å¯¹ä¸‹çº§å¯è§</li><li>ç›®çš„ï¼šè®©ç±»åŠ è½½æœ‰ä¼˜å…ˆæ¬¡åºï¼Œä¿è¯æ ¸å¿ƒç±»ä¼˜å…ˆåŠ è½½</li></ul><p>â€‹<img src="/img/else_img/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png"></p><h4 id="å¯¹è±¡å¼•ç”¨ç±»å‹"><a href="#å¯¹è±¡å¼•ç”¨ç±»å‹" class="headerlink" title="å¯¹è±¡å¼•ç”¨ç±»å‹"></a>å¯¹è±¡å¼•ç”¨ç±»å‹</h4><ol><li>å¼ºå¼•ç”¨<ol><li>å¦‚<code>A a = new A()</code>å°±ä¸ºå¼ºå¼•ç”¨</li><li>é€šè¿‡GC Rootçš„å¼•ç”¨é“¾èƒ½æ‰¾åˆ°å¯¹è±¡aå°±ä¸ä¼šè¢«å›æ”¶</li></ol></li><li>è½¯å¼•ç”¨<ol><li>å¦‚<code>SoftReference a = new SoftReference(new A())</code>å°±ä¸ºè½¯å¼•ç”¨</li><li>å¦‚æœåªæœ‰è½¯å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œé¦–æ¬¡åƒåœ¾å›æ”¶ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ï¼Œå¦‚æœå†…å­˜ä»ç„¶ä¸è¶³ï¼Œå†æ¬¡å›æ”¶æ—¶æ‰ä¼šé‡Šæ”¾å¯¹è±¡</li><li>è½¯å¼•ç”¨è‡ªèº«éœ€è¦é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾</li><li>ä¾‹å­ï¼šåå°„è·å¾—çš„æ•°æ®æ˜¯è½¯å¼•ç”¨</li></ol></li><li>å¼±å¼•ç”¨<ol><li>å¦‚<code>WeakReference a = new WeakReference(new A())</code>å°±ä¸ºå¼±å¼•ç”¨</li><li>å¦‚æœåªæœ‰å¼±å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œåªè¦åƒåœ¾å›æ”¶å°±ä¼šå›æ”¶è¯¥å¯¹è±¡</li><li>å¼±å¼•ç”¨è‡ªèº«éœ€è¦é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾</li><li>ä¾‹å­ï¼šThreadLocalMapä¸­çš„Entryå¯¹è±¡ä½¿ç”¨äº†å¼±å¼•ç”¨</li></ol></li><li>è™šå¼•ç”¨<ol><li>å¦‚<code>PhantomReference a = new PhatomReference(new A())</code>å°±ä¸ºè™šå¼•ç”¨</li><li>å¿…é¡»é…åˆé˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œå½“æ–°å¼•ç”¨å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œä¼šå°†è™šå¼•ç”¨å¯¹è±¡å…¥é˜Ÿï¼Œé…åˆReference Handlerçº¿ç¨‹é‡Šæ”¾å…¶å…³è”çš„å¤–éƒ¨èµ„æºï¼ˆéjavaçš„èµ„æºï¼‰</li></ol></li></ol><h4 id="finalize"><a href="#finalize" class="headerlink" title="finalize"></a>finalize</h4><ul><li><p>å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•</p></li><li><p>ç”±FinalizerThreadè°ƒç”¨finalizeæ–¹æ³•ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå¯èƒ½æ²¡æ¥å¾—åŠè°ƒç”¨å®Œæ–¹æ³•å°±ç»“æŸäº†</p></li><li><p>finalizeæœ‰å¼‚å¸¸ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</p></li><li><p>å½±å“æ€§èƒ½ï¼šåƒåœ¾å›æ”¶æ—¶ç¬¬ä¸€æ¬¡ä¸èƒ½é‡Šæ”¾å†…å­˜ï¼Œè¦ç­‰çº¿ç¨‹è°ƒç”¨å®Œfinalizeæ–¹æ³•åä¸‹æ¬¡åƒåœ¾å›æ”¶æ‰èƒ½é‡Šæ”¾</p></li></ul><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="refreshåˆ›å»ºIOCå®¹å™¨"><a href="#refreshåˆ›å»ºIOCå®¹å™¨" class="headerlink" title="refreshåˆ›å»ºIOCå®¹å™¨"></a>refreshåˆ›å»ºIOCå®¹å™¨</h3><p>Spring å®¹å™¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºIOCå®¹å™¨,åœ¨åˆ›å»ºå®¹å™¨æ—¶,ä¼šè°ƒç”¨ refresh()æ–¹æ³•,æ•´ä¸ªå®¹å™¨å°±æ˜¯é€šè¿‡è¯¥æ–¹æ³•,å®Œæˆæ‰€æœ‰çš„ bean çš„åˆ›å»ºä»¥åŠåˆå§‹åŒ–</p><h4 id="é‡è¦çš„ç±»-x2F-å¯¹è±¡"><a href="#é‡è¦çš„ç±»-x2F-å¯¹è±¡" class="headerlink" title="é‡è¦çš„ç±»&#x2F;å¯¹è±¡"></a>é‡è¦çš„ç±»&#x2F;å¯¹è±¡</h4><ul><li>ClassPathXmlApplicationContextï¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„å®¹å™¨</li><li>AnnotationConfigApplicationContextï¼šä½¿ç”¨é…ç½®ç±»çš„å®¹å™¨</li><li>BeanDefinitionï¼šBeançš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚æ˜¯å¦æ˜¯å•ä¾‹çš„ï¼ŒBeançš„ç±»å‹ï¼Œæ˜¯å¦æ˜¯æ‡’åŠ è½½ï¼Œä¾èµ–å“ªäº›ç±»ï¼Œè‡ªåŠ¨è£…é…çš„æ¨¡å‹</li><li>beanDefinitionMapï¼šå­˜æ”¾beanå¯¹åº”çš„BeanDefinition</li><li>beanDefinitionNamesï¼šå­˜æ”¾æ‰€æœ‰beançš„åå­—</li><li>BeanFactoryPostProcessorï¼šBeanFactoryçš„åç½®å¤„ç†å™¨</li><li>BeanPostProcessorï¼šBeançš„åç½®å¤„ç†å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°AOPã€Beançš„åˆ›å»º</li></ul><h4 id="é‡è¦æ­¥éª¤"><a href="#é‡è¦æ­¥éª¤" class="headerlink" title="é‡è¦æ­¥éª¤"></a>é‡è¦æ­¥éª¤</h4><p><img src="/img/else_img/BeanFactory%E5%88%9D%E5%A7%8B%E5%8C%96.png" alt="BeanFactoryåˆå§‹åŒ–"></p><p><code>invokeBeanFactoryPostProcessors()</code>ä¼šæ‰§è¡Œæ‰€æœ‰<code>BeanFactoryPostProcessor</code></p><ul><li>Springå†…ç½®çš„BeanFactoryåå¤„ç†å™¨ï¼š<code>ConfigurationClassPostProcessor</code>ï¼Œä¼šè§£æå‡ºæ‰€æœ‰äº¤ç”±Springç®¡ç†çš„Beanå¹¶è§£ææˆ<code>BeanDefinition</code></li><li>è‡ªå®šä¹‰çš„BeanFactoryåå¤„ç†å™¨ï¼šå®ç°äº†<code>BeanFactoryPostProcessor</code>æ¥å£æˆ–<code>BeanDefinitionRegistryPostProcessor</code>æ¥å£ã€‚ä¼šå…ˆæ‰§è¡Œåè€…çš„å®ç°ç±»</li></ul><p><img src="/img/else_img/%E5%87%86%E5%A4%87%E4%B8%8A%E4%B8%8B%E6%96%87.png" alt="å‡†å¤‡ä¸Šä¸‹æ–‡"></p><p> <code>registerBeanPostProcessors()</code>ä¼šæ‰¾åˆ°å¹¶å®ä¾‹åŒ–æ‰€æœ‰çš„<code>BeanPostProcessor</code>ï¼Œå¹¶æ”¾åˆ°<code>beanPostProcessors</code>é›†åˆä¸­</p><p><code>finishBeanFactoryInitialization()</code>å®Œæˆäº†æ‰€æœ‰éæ‡’åŠ è½½çš„å•ä¾‹<code>Bean</code>çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ï¼Œå±æ€§çš„å¡«å……ä»¥åŠè§£å†³äº†å¾ªç¯ä¾èµ–ç­‰é—®é¢˜</p><h4 id="12ä¸ªæ­¥éª¤"><a href="#12ä¸ªæ­¥éª¤" class="headerlink" title="12ä¸ªæ­¥éª¤"></a>12ä¸ªæ­¥éª¤</h4><p><strong>æ¦‚è§ˆ</strong></p><ul><li>1ï¼šå‡†å¤‡å·¥ä½œ</li><li>2~6ï¼šåˆ›å»ºå‡†å¤‡BeanFactoryçš„å„é¡¹åŠŸèƒ½</li><li>7~12ï¼šå‡†å¤‡ApplicationContext</li></ul><h5 id="1-prepareRefresh-å¼€å¯å®¹å™¨ï¼ŒåŠ è½½é”®å€¼"><a href="#1-prepareRefresh-å¼€å¯å®¹å™¨ï¼ŒåŠ è½½é”®å€¼" class="headerlink" title="1.prepareRefresh()-å¼€å¯å®¹å™¨ï¼ŒåŠ è½½é”®å€¼"></a>1.prepareRefresh()-å¼€å¯å®¹å™¨ï¼ŒåŠ è½½é”®å€¼</h5><ul><li><p>åˆ›å»ºå’Œå‡†å¤‡äº†<strong>Environment</strong>å¯¹è±¡</p></li><li><p>Environmentå¯¹è±¡çš„ä½œç”¨ï¼šåŠ è½½äº†ä¸€äº›é”®å€¼ä¿¡æ¯ï¼š</p><ul><li>jvmæä¾›çš„é”®å€¼</li><li>æ“ä½œç³»ç»Ÿç³»ç»Ÿé‡Œçš„é”®å€¼</li><li>é…ç½®æ–‡ä»¶é‡Œæä¾›çš„é”®å€¼ä¿¡æ¯</li></ul></li><li><p>Environmentçš„ä½œç”¨ä¹‹ä¸€æ˜¯ä¸ºåç»­@Valueæ³¨å…¥å€¼çš„æ—¶å€™æä¾›ä¿¡æ¯</p><p><img src="/img/else_img/environment.png"></p></li></ul><h5 id="2-obtainFreshBeanFactory-è·å–æˆ–åˆ›å»ºBeanå·¥å‚"><a href="#2-obtainFreshBeanFactory-è·å–æˆ–åˆ›å»ºBeanå·¥å‚" class="headerlink" title="2.obtainFreshBeanFactory()-è·å–æˆ–åˆ›å»ºBeanå·¥å‚"></a>2.obtainFreshBeanFactory()-è·å–æˆ–åˆ›å»ºBeanå·¥å‚</h5><ul><li><p>åˆ›å»ºäº†<strong>BeanFactory</strong>å¯¹è±¡</p></li><li><p>BeanDefinitionMapä¸ºBeanFactoryçš„æˆå‘˜å¯¹è±¡ï¼Œå­˜å‚¨äº†BeanDefinition</p><ul><li>BeanDefinitionä½œä¸ºbeançš„è®¾è®¡è“å›¾ï¼Œè§„å®šäº†beançš„ç‰¹å¾ï¼Œå¦‚å•ä¾‹å¤šä¾‹ã€ä¾èµ–å…³ç³»ã€åˆå§‹åŒ–é”€æ¯æ–¹æ³•ç­‰</li><li>BeanDefinitionçš„æ¥æºå¯ä»¥é€šè¿‡xmlè·å–ã€é…ç½®ç±»è·å¾—ã€ç»„ä»¶æ‰«ææˆ–ç¼–ç¨‹æ·»åŠ ç­‰</li></ul></li><li><p>BeanFactoryçš„ä½œç”¨æ˜¯è´Ÿè´£beançš„åˆ›å»ºã€ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–</p><p><img src="/img/else_img/beanFactory.png"></p></li></ul><h5 id="3-prepareBeanFactory-å®Œå–„Beanå·¥å‚"><a href="#3-prepareBeanFactory-å®Œå–„Beanå·¥å‚" class="headerlink" title="3.prepareBeanFactory()-å®Œå–„Beanå·¥å‚"></a>3.prepareBeanFactory()-å®Œå–„Beanå·¥å‚</h5><ul><li><p>åˆ›å»ºç”¨æ¥è§£æSpELçš„beanExpressionResolver</p></li><li><p>åˆ›å»ºæ‰§è¡Œç±»å‹è½¬æ¢çš„propertyEditorRegistrars</p></li><li><p>åˆ›å»ºç‰¹æ®Šbeanæ³¨å…¥çš„resolvableDependencies</p></li><li><p>æ‰©å±•beançš„åˆ›å»ºåŠŸèƒ½çš„beanPostProcessors</p><p><img src="/img/else_img/prepareBeanFactory.png"></p></li><li><p>StandardBeanExpressionResolveræ¥è§£æSpEL</p></li><li><p>ResourceEditorRegisterä¼šæ³¨é‡Šç±»å‹è½¬æ¢å™¨ï¼Œå¹¶åº”ç”¨ApplicationContextæä¾›çš„Environmentæ¥å®Œæˆ${}è§£æ</p></li><li><p>ç‰¹æ®ŠbeanæŒ‡beanFactoryä»¥åŠApplicationContextï¼Œé€šè¿‡registerResolvableDependencyæ¥æ³¨å†Œå®ƒä»¬</p></li></ul><h5 id="4-postProcessBeanFactory-å­ç±»æ‰©å±•Beanå·¥å‚"><a href="#4-postProcessBeanFactory-å­ç±»æ‰©å±•Beanå·¥å‚" class="headerlink" title="4.postProcessBeanFactory()-å­ç±»æ‰©å±•Beanå·¥å‚"></a>4.postProcessBeanFactory()-å­ç±»æ‰©å±•Beanå·¥å‚</h5><ul><li>åå¤„ç†å¯ä»¥ç†è§£ä¸ºæ·»åŠ åŠŸèƒ½ã€‚</li><li>é»˜è®¤ä¸ºç©ºå®ç°ï¼Œç•™ä¸ªå­ç±»æ‰©å±•</li><li>ä¸€èˆ¬Webç¯å¢ƒçš„ApplicationContextéƒ½è¦åˆ©ç”¨å®ƒæ³¨å†Œæ–°çš„Scopeï¼Œå®Œå–„Webä¸‹çš„BeanFactory</li></ul><h5 id="5-invokeBeanFactoryPostProcessors-åå¤„ç†å™¨æ‰©å±•Beanå·¥å‚"><a href="#5-invokeBeanFactoryPostProcessors-åå¤„ç†å™¨æ‰©å±•Beanå·¥å‚" class="headerlink" title="5.invokeBeanFactoryPostProcessors()-åå¤„ç†å™¨æ‰©å±•Beanå·¥å‚"></a>5.invokeBeanFactoryPostProcessors()-åå¤„ç†å™¨æ‰©å±•Beanå·¥å‚</h5><ul><li>é¢„å…ˆå®šä¹‰å¥½çš„åå¤„ç†ï¼Œé€šè¿‡å¤„ç†å™¨çš„æ–¹å¼æ·»åŠ BeanFactoryçš„åŠŸèƒ½</li><li>åç½®å¤„ç†å™¨å¯ä»¥æ‰©å±•beanFactoryçš„åŠŸèƒ½ï¼Œç”¨æ¥è¡¥å……å’Œä¿®æ”¹BeanDefinition</li><li>ConfigurationClassPostProcessor-è§£æ@Configurationã€@Beanã€@Importç­‰</li></ul><h5 id="6-registerBeanPostProcessors-æ³¨å†ŒBeanåå¤„ç†å™¨"><a href="#6-registerBeanPostProcessors-æ³¨å†ŒBeanåå¤„ç†å™¨" class="headerlink" title="6.registerBeanPostProcessors()-æ³¨å†ŒBeanåå¤„ç†å™¨"></a>6.registerBeanPostProcessors()-æ³¨å†ŒBeanåå¤„ç†å™¨</h5><ul><li>beanååå¤„ç†å™¨å……å½“beançš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥å·¥ä½œåœ¨beançš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ã€åˆå§‹åŒ–é˜¶æ®µ</li><li>å¦‚æœ‰è§£æ@Autowiredã€@Valueã€@Resourceç­‰æ³¨è§£çš„åå¤„ç†å™¨</li></ul><h5 id="7-initMessageSource-å›½é™…åŒ–"><a href="#7-initMessageSource-å›½é™…åŒ–" class="headerlink" title="7.initMessageSource()-å›½é™…åŒ–"></a>7.initMessageSource()-å›½é™…åŒ–</h5><ul><li><p>åˆå§‹åŒ–messageSourceï¼Œç”¨æ¥åšå›½é™…åŒ–åŠŸèƒ½</p><p><img src="/img/else_img/messageSource.png"></p></li></ul><h5 id="8-initApplicationEventMulticaster-åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨"><a href="#8-initApplicationEventMulticaster-åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨" class="headerlink" title="8.initApplicationEventMulticaster()-åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨"></a>8.initApplicationEventMulticaster()-åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨</h5><ul><li>è¿™ä¸ªç±»ä¼šæŒæœ‰æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨(<code>ApplicationListener</code>)ï¼Œå½“æœ‰<code>ApplicationEvent</code>äº‹ä»¶å‘å¸ƒæ—¶ï¼Œè¯¥äº‹ä»¶ç›‘å¬å™¨èƒ½æ ¹æ®äº‹ä»¶ç±»å‹ï¼Œæ£€ç´¢åˆ°å¯¹è¯¥äº‹ä»¶æ„Ÿå…´è¶£çš„<code>ApplicationListener</code></li></ul><p>â€‹<img src="/img/else_img/multicaster.png"></p><h5 id="9-onRefresh-åˆå§‹åŒ–å­å®¹å™¨ä¸­çš„bean"><a href="#9-onRefresh-åˆå§‹åŒ–å­å®¹å™¨ä¸­çš„bean" class="headerlink" title="9.onRefresh()-åˆå§‹åŒ–å­å®¹å™¨ä¸­çš„bean"></a>9.onRefresh()-åˆå§‹åŒ–å­å®¹å™¨ä¸­çš„bean</h5><ul><li>æ‰§è¡Œå…¶ä»–çš„åˆå§‹åŒ–æ“ä½œï¼Œä¾‹å¦‚å’Œ<code>SpringMVC</code>æ•´åˆæ—¶ï¼Œéœ€è¦åˆå§‹åŒ–ä¸€äº›å…¶ä»–çš„<code>bean</code>ï¼Œä½†æ˜¯å¯¹äºçº¯<code>Spring</code>å·¥ç¨‹æ¥è¯´ï¼Œ<code>onRefresh()</code>æ–¹æ³•æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ã€‚</li></ul><h5 id="10-registerListeners-æ³¨å†Œç›‘å¬å™¨"><a href="#10-registerListeners-æ³¨å†Œç›‘å¬å™¨" class="headerlink" title="10.registerListeners()-æ³¨å†Œç›‘å¬å™¨"></a>10.registerListeners()-æ³¨å†Œç›‘å¬å™¨</h5><ul><li>æ¥æ”¶äº‹ä»¶</li></ul><h5 id="11-finishBeanFactoryInitialization-åˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„å•ä¾‹-bean"><a href="#11-finishBeanFactoryInitialization-åˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„å•ä¾‹-bean" class="headerlink" title="11.finishBeanFactoryInitialization()- åˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„å•ä¾‹ bean"></a>11.finishBeanFactoryInitialization()- åˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„å•ä¾‹ bean</h5><ul><li>conversionServiceä¹Ÿæ˜¯ä¸€å¥—è½¬æ¢æœºåˆ¶ï¼Œä½œä¸ºå¯¹PropertyEditorçš„è¡¥å……</li><li>å†…åµŒå€¼è§£æå™¨ç”¨æ¥è§£æ@Valueä¸­çš„${}ï¼Œå€Ÿç”¨çš„æ˜¯Environmentçš„åŠŸèƒ½</li><li>å•ä¾‹æ± ç”¨æ¥ç¼“å­˜æ‰€æœ‰å•ä¾‹å¯¹è±¡</li><li>å¯¹è±¡åˆ›å»ºåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šåˆ›å»ºã€ä¾èµ–æ³¨å…¥ã€åˆå§‹åŒ–ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸åŒçš„beanå¤„ç†å™¨å‚ä¸æ‰©å±•</li></ul><p>â€‹<img src="/img/else_img/finishBeanFactoryInitialozation.png"></p><h5 id="12-finishRefresh-å‡†å¤‡å£°æ˜å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshäº‹ä»¶"><a href="#12-finishRefresh-å‡†å¤‡å£°æ˜å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshäº‹ä»¶" class="headerlink" title="12.finishRefresh()-å‡†å¤‡å£°æ˜å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshäº‹ä»¶"></a>12.finishRefresh()-å‡†å¤‡å£°æ˜å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshäº‹ä»¶</h5><ul><li>lifecycleProcessorç”¨æ¥æ§åˆ¶å®¹å™¨å†…éœ€è¦ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„bean</li></ul><p><img src="/img/else_img/finishRefersh.png"></p><h3 id="Beançš„ä½œç”¨åŸŸ"><a href="#Beançš„ä½œç”¨åŸŸ" class="headerlink" title="Beançš„ä½œç”¨åŸŸ"></a>Beançš„ä½œç”¨åŸŸ</h3><ul><li>Singletonï¼šé»˜è®¤ï¼Œåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹</li><li>Prototypeï¼šå¯ä»¥æœ‰å¤šä¸ªå®ä¾‹</li><li>Requestï¼šæ¯æ¬¡httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªBean</li><li>Sessionï¼šä¸€ä¸ªSessionä¸­å¯¹åº”ä¸€ä¸ªBeanå¯¹åº”ä¸€ä¸ªå®ä¾‹</li><li>Global-sessionï¼šå…¨å±€Sessionä¸­ï¼Œä¸€ä¸ªBeanå¯¹åº”ä¸€ä¸ªå®ä¾‹</li></ul><h3 id="Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="/img/else_img/bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png"></p><h4 id="7ä¸ªé˜¶æ®µ"><a href="#7ä¸ªé˜¶æ®µ" class="headerlink" title="7ä¸ªé˜¶æ®µ"></a>7ä¸ªé˜¶æ®µ</h4><p>Beanä¸ºæ‡’æƒ°åˆå§‹åŒ–ï¼Œç”Ÿå‘½å‘¨æœŸä»doGetBean()æ–¹æ³•å¼€å§‹</p><p><strong>æ¦‚è§ˆ</strong></p><ul><li>é˜¶æ®µ1ï¼šå¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜</li><li>é˜¶æ®µ2ï¼šæ£€æŸ¥çˆ¶å·¥å‚</li><li>é˜¶æ®µ3ï¼šæ£€æŸ¥DependsOn</li><li>é˜¶æ®µ4ï¼šæŒ‰Scopeåˆ›å»ºbean</li><li>é˜¶æ®µ5ï¼šåˆ›å»ºbean</li><li>é˜¶æ®µ6ï¼šç±»å‹è½¬æ¢</li><li>é˜¶æ®µ7ï¼šé”€æ¯bean</li></ul><h5 id="é˜¶æ®µ1"><a href="#é˜¶æ®µ1" class="headerlink" title="é˜¶æ®µ1"></a>é˜¶æ®µ1</h5><ul><li>å…ˆæŠŠåˆ«åè§£æä¸ºå®é™…åç§°ï¼Œå†è¿›è¡Œåç»­å¤„ç†</li><li>è‹¥è¦FactoryBeanæœ¬èº«ï¼Œéœ€è¦ä½¿ç”¨&amp;åç§°è·å–</li><li>æ£€æŸ¥ç¼“å­˜é‡Œæ˜¯å¦æœ‰ï¼š<ul><li>ä¸€çº§ç¼“å­˜æ˜¯singletonObjectsï¼Œæ”¾å•ä¾‹æˆå“å¯¹è±¡</li><li>äºŒçº§ç¼“å­˜æ˜¯earlySingletonObjectsï¼Œæ”¾å•ä¾‹å·¥å‚çš„äº§å“ï¼Œå¯ç§°ä¸ºæå‰å•ä¾‹å¯¹è±¡</li><li>ä¸‰çº§ç¼“å­˜æ˜¯singletonFactoriesï¼Œæ”¾å•ä¾‹å·¥å‚</li></ul></li></ul><h5 id="é˜¶æ®µ2"><a href="#é˜¶æ®µ2" class="headerlink" title="é˜¶æ®µ2"></a>é˜¶æ®µ2</h5><ul><li>ç¼“å­˜ä¸­æ²¡æœ‰beanå›å»çˆ¶å®¹å™¨ä¸­æ‰¾</li><li>çˆ¶å®¹å™¨ä¸­çš„beanå’Œå­å®¹å™¨ä¸­çš„beanåç§°å¯ä»¥é‡å¤</li></ul><h5 id="é˜¶æ®µ3"><a href="#é˜¶æ®µ3" class="headerlink" title="é˜¶æ®µ3"></a>é˜¶æ®µ3</h5><ul><li>å¦‚æœAæ˜¾å¼ä¾èµ–äºBï¼Œåˆ™Bä¼šè¢«å…ˆåˆ›å»º</li><li>DependsOnç”¨åœ¨éæ˜¾å¼ä¾èµ–çš„beançš„åˆ›å»ºé¡ºåºæ§åˆ¶</li></ul><h5 id="é˜¶æ®µ4"><a href="#é˜¶æ®µ4" class="headerlink" title="é˜¶æ®µ4"></a>é˜¶æ®µ4</h5><ul><li>å¸¸è§scopeï¼š<ul><li>singleton scopeè¡¨ç¤ºä»å•ä¾‹æ± èŒƒå›´å†…è·å–bean<ul><li>å®¹å™¨åˆ›å»ºæ—¶åˆ›å»ºï¼Œå®¹å™¨é”€æ¯æ—¶é”€æ¯</li></ul></li><li>prototype scopeè¡¨ç¤ºä»ä¸ç¼“å­˜beanï¼Œæ¯æ¬¡åˆ›å»ºæ–°çš„<ul><li>ç”¨æ—¶åˆ›å»ºï¼Œä¸ç”¨æ—¶æ‰‹åŠ¨é”€æ¯</li></ul></li><li>request scopeè¡¨ç¤ºä»requestå¯¹è±¡èŒƒå›´å†…è·å–bean<ul><li>åœ¨requeståŸŸä¸­åˆ›å»ºï¼Œrequesté”€æ¯æ—¶é”€æ¯</li></ul></li></ul></li></ul><h5 id="é˜¶æ®µ5"><a href="#é˜¶æ®µ5" class="headerlink" title="é˜¶æ®µ5"></a>é˜¶æ®µ5</h5><ul><li>åˆ›å»ºé˜¶æ®µï¼š<ul><li>AutowiredAnnotationBeanPostProcessoré€‰æ‹©æ„é€ ï¼šä¼˜å…ˆä½¿ç”¨å¸¦@Autowiredçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºbeanï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ ï¼Œåˆ™ç”¨è¿™ä¸ªæœ‰å‚æ„é€ åˆ›å»ºbean</li><li>é»˜è®¤æ„é€ ï¼šä¿åº•ä½¿ç”¨æ— å‚æ„é€ æ¥åˆ›å»º</li></ul></li><li>ä¾èµ–æ³¨å…¥é˜¶æ®µï¼š<ul><li>åå¤„ç†å™¨æ‰©å±•åŠŸèƒ½ï¼šæŒ‰æ³¨è§£åŒ¹é…è¦æ³¨å…¥çš„bean</li><li>æ ¹æ®åå­—ã€ç±»å‹å»å®¹å™¨ä¸­æ‰¾bean</li><li>xmlç²¾ç¡®æŒ‡å®šbean</li></ul></li><li>åˆå§‹åŒ–é˜¶æ®µï¼š<ul><li>å¤„ç†Awareæ¥å£ï¼Œå¦‚BeanNameAwareã€BeanFactoryAwareï¼ŒBeanFactoryä¼šæŠŠç›¸åº”çš„èµ„æºä¼ é€’è¿›æ¥</li><li>è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼Œåˆå§‹åŒ–æ–¹æ³•å®šä¹‰æœ‰@PostConstructã€å®ç°InitalizingBeanæ¥å£ç­‰</li><li>åˆ›å»ºaopä»£ç†</li></ul></li><li>æ³¨å†Œå¯é”€æ¯bean<ul><li>å°†æœ‰é”€æ¯æ–¹æ³•çš„beanä¿å­˜èµ·æ¥ï¼Œé”€æ¯æ—¶è°ƒç”¨æ–¹æ³•</li></ul></li></ul><p>â€‹<img src="/img/else_img/%E5%88%9B%E5%BB%BAbean.png"></p><h5 id="é˜¶æ®µ6"><a href="#é˜¶æ®µ6" class="headerlink" title="é˜¶æ®µ6"></a>é˜¶æ®µ6</h5><ul><li>å¦‚æœgetBeançš„requiredTypeå‚æ•°ä¸å®é™…å¾—åˆ°çš„å¯¹è±¡ç±»å‹ä¸åŒï¼Œä¼šå°è¯•ç±»å‹è½¬æ¢</li></ul><h5 id="é˜¶æ®µ7"><a href="#é˜¶æ®µ7" class="headerlink" title="é˜¶æ®µ7"></a>é˜¶æ®µ7</h5><ul><li>æ ¹æ®scpoeæ¥é”€æ¯bean</li></ul><h3 id="äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"><a href="#äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º" class="headerlink" title="äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"></a>äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</h3><table><thead><tr><th>çº§åˆ«</th><th>æè¿°</th></tr></thead><tbody><tr><td>Requiredï¼ˆé»˜è®¤ï¼‰</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰äº‹åŠ¡ä¼šåˆ›å»ºä¸€ä¸ª</td></tr><tr><td>Supports</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰äº‹åŠ¡åˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œ</td></tr><tr><td>Mandatory</td><td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œæ²¡æœ‰äº‹åŠ¡ä¼šæŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>Requires_new</td><td>åˆ›å»ºæ–°äº‹åŠ¡å¹¶æŒ‚èµ·å½“å‰äº‹åŠ¡</td></tr><tr><td>Not_supported</td><td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œä¼šæŒ‚èµ·å½“å‰äº‹åŠ¡</td></tr><tr><td>Never</td><td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œæœ‰äº‹åŠ¡ä¼šæŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>Nested</td><td>åµŒå¥—äº‹åŠ¡</td></tr></tbody></table><h3 id="äº‹åŠ¡å¤±æ•ˆåœºæ™¯"><a href="#äº‹åŠ¡å¤±æ•ˆåœºæ™¯" class="headerlink" title="äº‹åŠ¡å¤±æ•ˆåœºæ™¯"></a>äº‹åŠ¡å¤±æ•ˆåœºæ™¯</h3><h4 id="åœºæ™¯1ï¼šæ£€æŸ¥å¼‚å¸¸"><a href="#åœºæ™¯1ï¼šæ£€æŸ¥å¼‚å¸¸" class="headerlink" title="åœºæ™¯1ï¼šæ£€æŸ¥å¼‚å¸¸"></a>åœºæ™¯1ï¼šæ£€æŸ¥å¼‚å¸¸</h4><blockquote><p>éœ€è¦<code>try..catch</code>æˆ–<code>throw</code>çš„å¼‚å¸¸éƒ½æ˜¯æ£€æŸ¥å¼‚å¸¸</p><p>è¿è¡Œæ—¶å¼‚å¸¸æ˜¯éæ£€æŸ¥å¼‚å¸¸</p></blockquote><p>æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸å¯¼è‡´äº‹åŠ¡ä¸èƒ½æ­£å¸¸å›æ»š</p><p>åŸå› ï¼šspringé»˜è®¤åªä¼šå›æ»šéæ£€æŸ¥å¼‚å¸¸</p><p>è§£å†³æ–¹å¼ï¼šåœ¨æ³¨è§£ä¸ŠåŠ ä¸Š<code>@Transactional(rollbackFor=Exception.class)</code>è®¾ç½®éœ€è¦å›æ»šçš„å¼‚å¸¸</p><h4 id="åœºæ™¯2ï¼šé”™è¯¯try-catch"><a href="#åœºæ™¯2ï¼šé”™è¯¯try-catch" class="headerlink" title="åœºæ™¯2ï¼šé”™è¯¯try catch"></a>åœºæ™¯2ï¼šé”™è¯¯try catch</h4><p>åŸå› ï¼šäº‹åŠ¡æ˜¯é€šè¿‡ä»£ç†å®ç°çš„ï¼Œå¦‚æœåœ¨è¢«ä»£ç†æ–¹æ³•å†…catchäº†å¼‚å¸¸ï¼Œå¤–å±‚è°ƒç”¨è€…æ˜¯ä¸çŸ¥é“å‘ç”Ÿäº†å¼‚å¸¸çš„ï¼Œä»è€Œäº‹åŠ¡å¤±æ•ˆ</p><p>è§£å†³æ–¹å¼1ï¼šæŠŠå¼‚å¸¸æŠ›å‡ºå»</p><p>è§£å†³æ–¹å¼2ï¼šæ‰‹åŠ¨è®¾ç½®äº‹åŠ¡çŠ¶æ€<code>TransactionStatus.setRollbackOnly()</code></p><h4 id="åœºæ™¯3ï¼šaopåˆ‡é¢é¡ºåºä¸å¯¹"><a href="#åœºæ™¯3ï¼šaopåˆ‡é¢é¡ºåºä¸å¯¹" class="headerlink" title="åœºæ™¯3ï¼šaopåˆ‡é¢é¡ºåºä¸å¯¹"></a>åœºæ™¯3ï¼šaopåˆ‡é¢é¡ºåºä¸å¯¹</h4><p>åŸå› ï¼šåœ¨è‡ªå®šä¹‰åˆ‡é¢é‡Œcatchäº†å¼‚å¸¸ï¼Œå¯¼è‡´æ›´ä¸Šå±‚çš„äº‹åŠ¡åˆ‡é¢ä¸çŸ¥é“å‘ç”Ÿäº†å¼‚å¸¸</p><p>è§£å†³æ–¹å¼1ï¼šåŒåœºæ™¯2</p><p>è§£å†³æ–¹å¼2ï¼šä½¿è‡ªå®šä¹‰åˆ‡é¢ä¼˜å…ˆçº§æ¯”äº‹åŠ¡çš„é«˜<code>@Order(Ordered.LOWEST.PRECEDENCE - 1)</code></p><h4 id="åœºæ™¯4ï¼šåŠ åœ¨éå…¬å…±æ–¹æ³•ä¸Š"><a href="#åœºæ™¯4ï¼šåŠ åœ¨éå…¬å…±æ–¹æ³•ä¸Š" class="headerlink" title="åœºæ™¯4ï¼šåŠ åœ¨éå…¬å…±æ–¹æ³•ä¸Š"></a>åœºæ™¯4ï¼šåŠ åœ¨éå…¬å…±æ–¹æ³•ä¸Š</h4><p>åŸå› ï¼šSpringä¸ºæ–¹æ³•åˆ›å»ºä»£ç†ã€æ·»åŠ äº‹åŠ¡é€šçŸ¥ã€å‰ææ¡ä»¶éƒ½æ˜¯æ–¹æ³•æ˜¯publicçš„</p><h4 id="åœºæ™¯5ï¼šçˆ¶å­å®¹å™¨å¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆ"><a href="#åœºæ™¯5ï¼šçˆ¶å­å®¹å™¨å¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆ" class="headerlink" title="åœºæ™¯5ï¼šçˆ¶å­å®¹å™¨å¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆ"></a>åœºæ™¯5ï¼šçˆ¶å­å®¹å™¨å¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆ</h4><p>åŸå› ï¼šå­å®¹å™¨æ‰«æèŒƒå›´è¿‡å¤§ï¼ŒæŠŠæœªåŠ äº‹åŠ¡é…ç½®çš„serviceæ‰«æè¿›æ¥</p><p>è§£å†³æ–¹å¼1ï¼šå®¹å™¨å„è‡ªæ‰«å„è‡ªçš„åŒ…</p><p>è§£å†³æ–¹å¼2ï¼šä¸ç”¨çˆ¶å­å®¹å™¨</p><h4 id="åœºæ™¯6ï¼šè°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"><a href="#åœºæ™¯6ï¼šè°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ" class="headerlink" title="åœºæ™¯6ï¼šè°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"></a>åœºæ™¯6ï¼šè°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ</h4><p>åŸå› ï¼šæœ¬ç±»æ–¹æ³•è°ƒç”¨æ²¡æœ‰ç»è¿‡ä»£ç†å¢å¼º</p><p>è§£å†³æ–¹å¼ï¼šä¾èµ–æ³¨å…¥è‡ªèº«</p><h4 id="åœºæ™¯7ï¼šé”å¤±æ•ˆ"><a href="#åœºæ™¯7ï¼šé”å¤±æ•ˆ" class="headerlink" title="åœºæ™¯7ï¼šé”å¤±æ•ˆ"></a>åœºæ™¯7ï¼šé”å¤±æ•ˆ</h4><p>åŸå› ï¼š@Transactionalæ²¡æœ‰ä¿è¯åŸå­è¡Œä¸ºï¼Œåœ¨æ–¹æ³•ä¸ŠåŠ é”åªèƒ½ä¿è¯æ–¹æ³•å†…çš„åŸå­æ€§ï¼Œæäº¤äº‹åŠ¡æ—¶é”å¤±æ•ˆ</p><p>è§£å†³æ–¹å¼1ï¼šsynchronizedèŒƒå›´æ‰©å¤§è‡³ä»£ç†æ–¹æ³•è°ƒç”¨</p><p>è§£å†³æ–¹å¼2ï¼šsqlè¯­å¥<code>select ... for update</code>æ›¿æ¢<code>select</code></p><h3 id="SpringMVCæ‰§è¡Œæµç¨‹"><a href="#SpringMVCæ‰§è¡Œæµç¨‹" class="headerlink" title="SpringMVCæ‰§è¡Œæµç¨‹"></a>SpringMVCæ‰§è¡Œæµç¨‹</h3><ol><li><p>åˆå§‹åŒ–é˜¶æ®µ</p><ul><li>ç¬¬ä¸€æ¬¡ç”¨åˆ°DispatcherServletæ—¶ï¼Œä¼šåˆ›å»ºå…¶å¯¹è±¡å¹¶æ‰§è¡Œinitæ–¹æ³•</li><li>å®¹å™¨åˆå§‹åŒ–åï¼Œä¼šå°†åˆå§‹åŒ–å¥½çš„é‡è¦ç»„ä»¶èµ‹å€¼ç»™DispatcherServletçš„æˆå‘˜å˜é‡</li></ul><p><img src="/img/else_img/springMVC%E5%88%9D%E5%A7%8B%E5%8C%96.png"></p></li><li><p>åŒ¹é…é˜¶æ®µ</p><ul><li>ç”¨æˆ·è¯·æ±‚åˆ°è¾¾DispatcherServletï¼Œç”±å…¶éå†æ‰€æœ‰çš„HandlerMappingï¼Œæ‰¾åˆ°ä¸è·¯å¾„åŒ¹é…çš„å¤„ç†å™¨</li><li>å°†HandlerMethodè¿åŒåŒ¹é…åˆ°çš„æ‹¦æˆªå™¨ï¼Œç”Ÿæˆè°ƒç”¨é“¾å¯¹è±¡è¿”å›</li><li>éå†HandlerAdapterï¼Œæ‰¾åˆ°èƒ½å¤„ç†HandlerMethodçš„é€‚é…å™¨ï¼Œå¼€å§‹è°ƒç”¨</li></ul><p><img src="/img/else_img/springMVC%E5%8C%B9%E9%85%8D%E9%98%B6%E6%AE%B5.png"></p></li><li><p>æ‰§è¡Œé˜¶æ®µ</p><ul><li>æ‰§è¡Œæ‹¦æˆªå™¨çš„preHandle</li><li>è°ƒç”¨HandlerMethod,è¿”å›ModelAndView</li><li>æ‰§è¡Œæ‹¦æˆªå™¨çš„postHandle</li><li>è§£æModelAndView</li><li>æ‰§è¡Œæ‹¦æˆªå™¨çš„afterCompletion</li></ul><p><img src="/img/else_img/SpringMVC%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5.png"></p></li></ol><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><h4 id="Springå¸¸è§æ³¨è§£"><a href="#Springå¸¸è§æ³¨è§£" class="headerlink" title="Springå¸¸è§æ³¨è§£"></a>Springå¸¸è§æ³¨è§£</h4><p><img src="/img/else_img/Spring%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3.png"></p><h4 id="SpringMVCå¸¸è§æ³¨è§£"><a href="#SpringMVCå¸¸è§æ³¨è§£" class="headerlink" title="SpringMVCå¸¸è§æ³¨è§£"></a>SpringMVCå¸¸è§æ³¨è§£</h4><p><img src="/img/else_img/SpringMVC%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3.png"></p><h4 id="SpringBootå¸¸è§æ³¨è§£"><a href="#SpringBootå¸¸è§æ³¨è§£" class="headerlink" title="SpringBootå¸¸è§æ³¨è§£"></a>SpringBootå¸¸è§æ³¨è§£</h4><p><img src="/img/else_img/SpringBoot%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3.png"></p><h3 id="SpringBootè‡ªåŠ¨é…ç½®"><a href="#SpringBootè‡ªåŠ¨é…ç½®" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®"></a>SpringBootè‡ªåŠ¨é…ç½®</h3><p>@SpringBootApplicationä¸»è¦ç”±ä¸‰ä¸ªæ³¨è§£æ„æˆ</p><ul><li>@SpringBootConfiguration<ul><li>@Configurationå¯ä»¥å¤šä¸ªï¼Œ@SpringBootConfigurationåªèƒ½ä¸€ä¸ªï¼Œç”¨äºè¡¨ç¤ºå½“å‰ç±»ä¸ºSpringBooté…ç½®ç±»</li></ul></li><li>@EnableAutoConfiguration<ul><li>@AutoConfigurationPackageï¼šè®°å½•æ ‡æ³¨äº†è¿™ä¸ªæ³¨è§£çš„åŒ…å</li><li>@Import(AutoConfigurationImportSelector.class)ï¼šå¯¼å…¥è‡ªåŠ¨é…ç½®ç›¸å…³çš„beanï¼ŒåŠ è½½META-INF&#x2F;spring.factoriesä¸­çš„é…ç½®ç±»</li></ul></li><li>@ComponentScan<ul><li>å±æ€§excludeFiltersç”¨äºæ’é™¤ä¸€äº›ç±»ä¸æ³¨å†Œä¸ºbean</li></ul></li></ul><h3 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h3><p><img src="/img/else_img/bean%E7%9A%84%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.png"></p><h4 id="åˆ‡é¢"><a href="#åˆ‡é¢" class="headerlink" title="åˆ‡é¢"></a>åˆ‡é¢</h4><p>é€šè¿‡ä»£ç†å¯¹è±¡æ¥å…³è”ProxyFactoryå®ç°åˆ‡é¢ï¼ŒSpringBooté€šè¿‡è‡ªåŠ¨ä»£ç†åå¤„ç†å™¨æ¥è¯†åˆ«ç›¸å…³æ³¨è§£</p><p><strong>æœ¯è¯­</strong></p><ul><li><p>Advisorï¼šæœ€åŸºç¡€çš„åˆ‡é¢ï¼ŒæŠŠä¸€ä¸ªAdviceå’Œä¸€ä¸ªPointcutç»„åˆèµ·æ¥</p></li><li><p>Adviceï¼šå¢å¼º</p></li><li><p>Pointcutï¼šåˆ‡ç‚¹</p></li><li><p>Aspectï¼šåˆ‡é¢</p></li></ul><blockquote><ol><li><p>æœ€åŸºæœ¬çš„åˆ‡é¢æ˜¯Advisorï¼Œä¸€ä¸ªAspectåˆ‡é¢å¯¹åº”ä¸€åˆ°å¤šä¸ªAdvisor</p></li><li><p>æœ€åŸºæœ¬çš„Adviceæ˜¯MethodInterceptorï¼Œå…¶ä»–Adviceæœ€ç»ˆéƒ½ä¼šé€‚é…ä¸ºMethodInterceptor</p></li><li><p>åˆ›å»ºä»£ç†çš„æ–¹å¼æœ‰ï¼šå®ç°äº†ç”¨æˆ·è‡ªå®šä¹‰æ¥å£ï¼Œé‡‡ç”¨jdkåŠ¨æ€ä»£ç†ï¼›æ²¡æœ‰å®ç°ç”¨æˆ·è‡ªå®šä¹‰æ¥å£ï¼Œé‡‡ç”¨cglibä»£ç†ï¼›è®¾ç½®äº†setProxyTargetClass(True)ï¼Œç»Ÿä¸€é‡‡ç”¨cglibä»£ç†</p></li><li><p>åˆ‡é¢ã€åˆ‡ç‚¹ã€é€šçŸ¥ç­‰éƒ½ä¸ä¼šè¢«ä»£ç†</p></li><li><p>è‡ªåŠ¨ä»£ç†åå¤„ç†å™¨è°ƒç”¨æ—¶æœºï¼šåˆ›å»ºé˜¶æ®µã€<strong>ä¾èµ–æ³¨å…¥é˜¶æ®µ</strong>ã€<strong>åˆå§‹åŒ–é˜¶æ®µ</strong></p></li></ol></blockquote><p><strong>æ³¨è§£</strong></p><ul><li>@Aspectï¼šè¡¨ç¤ºä¸ºåˆ‡é¢ç±»</li><li>@Aroundã€@Beforeã€@Afterç­‰ï¼šé€šçŸ¥æ–¹æ³•ï¼Œå¯ä»¥åŠ åˆ‡ç‚¹è¡¨è¾¾å¼</li></ul><h4 id="ä¸‰çº§ç¼“å­˜"><a href="#ä¸‰çº§ç¼“å­˜" class="headerlink" title="ä¸‰çº§ç¼“å­˜"></a>ä¸‰çº§ç¼“å­˜</h4><p><img src="/img/else_img/bean%E7%9A%84%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98.png"></p><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><ul><li>ä¸€çº§ç¼“å­˜ä½œç”¨ï¼šé™åˆ¶beanåœ¨beanFactoryä¸­åªå­˜ä¸€ä»½</li></ul><p>â€‹<strong>åªæœ‰ä¸€çº§ç¼“å­˜ä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</strong></p><p>â€‹<img src="/img/else_img/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%961.png"></p><ul><li><p>äºŒçº§ç¼“å­˜ä½œç”¨ï¼ˆSpringä¸­çš„ä¸‰çº§ç¼“å­˜ï¼‰ï¼šå­˜è¿˜æœªè£…è½½æˆå‘˜å˜é‡çš„ç©ºå¯¹è±¡ï¼Œè§£å†³å¾ªç¯ä¾èµ–ï¼Œåœ¨åˆå§‹åŒ–å®ŒåæŠŠäºŒçº§ç¼“å­˜ä¸­çš„ç©ºå¯¹è±¡æ¸…é™¤æ‰</p><p><img src="/img/else_img/bean%E7%9A%84%E7%AC%AC%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98.png"></p><p><strong>äºŒçº§ç¼“å­˜ä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ä¸­æœ‰ä»£ç†çš„æƒ…å†µ</strong></p><p><img src="/img/else_img/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%962.png"></p></li><li><p>ä¸‰çº§ç¼“å­˜ä½œç”¨ï¼ˆSpringä¸­çš„äºŒçº§ç¼“å­˜ï¼‰ï¼šè§£å†³å¾ªç¯ä¾èµ–ä¸­ä»£ç†åˆ›å»ºè¿‡æ™šçš„é—®é¢˜ï¼Œé€šè¿‡å·¥å‚åˆ¤æ–­æ˜¯å¦éœ€è¦ä»£ç†ï¼Œéœ€è¦åˆ™æå‰åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¦åˆ™è¿”å›æœ¬èº«ç©ºå¯¹è±¡</p><p><img src="/img/else_img/bean%E7%9A%84%E7%AC%AC%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98.png"></p><p><strong>ä¸‰çº§ç¼“å­˜ä¸èƒ½è§£å†³æ„é€ å‡½æ•°ä¸­æœ‰å¾ªç¯ä¾èµ–</strong>ï¼šæ„é€ ä¸å‡ºæ¥ï¼Œæ— æ³•æ”¾åˆ°ç¼“å­˜ä¸­</p><p><img src="/img/else_img/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%963.png"></p><p>è§£å†³æ–¹å¼1ï¼šåŠ @Lazyæ³¨è§£ï¼Œä¼šå…ˆåˆ›å»ºä»£ç†å¯¹è±¡æ³¨å…¥ï¼Œå¾…ç”¨åˆ°æ—¶å†æ³¨å…¥</p><p><img src="/img/else_img/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%964.png"></p><p>è§£å†³æ–¹å¼2ï¼šé€šè¿‡<code>ObjectFactory&lt;B&gt; b</code> æ¥å…ˆæ³¨å…¥å·¥å‚ï¼Œä½¿ç”¨æ—¶åœ¨åˆ›å»ºbean</p><p><img src="/img/else_img/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%965.png"></p></li></ul><h3 id="å•ä¾‹Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"><a href="#å•ä¾‹Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—" class="headerlink" title="å•ä¾‹Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"></a>å•ä¾‹Beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—</h3><p>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚@Scopeæ³¨è§£é»˜è®¤æ˜¯singtonå•ä¾‹çš„ã€‚å¦‚æœspringçš„beanä¸­æ³¨å…¥çš„éƒ½æ˜¯æ— çŠ¶æ€çš„å¯¹è±¡ï¼Œæ˜¯æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œå¦‚æœåœ¨beanä¸­å®šä¹‰äº†å¯ä»¥ä¿®æ”¹çš„æˆå‘˜å˜é‡ï¼Œæ˜¯è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¾‹æˆ–åŠ é”æ¥è§£å†³é—®é¢˜</p><h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><blockquote><p>é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç”¨äºå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œä½†å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„å…¬å…±è¡Œä¸ºæˆ–é€»è¾‘ï¼ŒæŠ½å‡ºå¹¶å°è£…æˆä¸€ä¸ªå¯é‡ç”¨çš„æ¨¡å—</p></blockquote><p>å¸¸è§AOPä½¿ç”¨åœºæ™¯</p><ul><li><p>è®°å½•æ“ä½œæ—¥å¿—</p></li><li><p>ç¼“å­˜å¤„ç†</p></li><li><p>äº‹åŠ¡</p><blockquote><p>ç¼–ç¨‹å¼äº‹åŠ¡ï¼šä½¿ç”¨TransactionTemplateï¼Œå¯¹ä»£ç æœ‰ä¾µå…¥æ€§</p><p>å£°æ˜å¼äº‹åŠ¡ï¼šä½¿ç”¨@Transactionalæ³¨è§£ï¼Œé€šè¿‡AOPåŠŸèƒ½ï¼Œå¯¹æ–¹æ³•è¿›è¡Œæ‹¦æˆª</p></blockquote></li></ul><h3 id="è‡ªåŠ¨è£…é…"><a href="#è‡ªåŠ¨è£…é…" class="headerlink" title="è‡ªåŠ¨è£…é…"></a>è‡ªåŠ¨è£…é…</h3><p>@SpringBootApplicationä¸­åŒ…å«çš„@EnableAutoConfigurationä¸­ç”¨@Importå¯¼å…¥äº†é…ç½®é€‰æ‹©å™¨</p><p>å†…éƒ¨è¯»å–äº†è¯¥é¡¹ç›®å’Œå¼•ç”¨çš„JaråŒ…çš„classpathè·¯å¾„ä¸‹<code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­çš„æ‰€é…ç½®çš„ç±»çš„å…¨ç±»åï¼Œæ ¹æ®è¿™äº›é…ç½®ç±»ä¸­å®šä¹‰çš„Beanæ‰€æŒ‡å®šçš„æ¡ä»¶æ¥å†³å®šæ˜¯å¦æ³¨å…¥åˆ°Springå®¹å™¨ä¸­</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="åŸºç¡€-1"><a href="#åŸºç¡€-1" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>redisé»˜è®¤ç«¯å£å·ï¼š6379</p><p>redisé»˜è®¤æœ‰16ä¸ªåº“</p><p>redisäº”ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼š</p><ol><li>string(å­—ç¬¦ä¸²)</li><li>hash(å“ˆå¸Œ) </li><li>list(åˆ—è¡¨)</li><li>set(é›†åˆ)</li><li>sortedSet(æœ‰åºé›†åˆ)</li></ol><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>ç¼“å­˜ï¼ˆç©¿é€ã€å‡»ç©¿ã€é›ªå´©ã€åŒå†™ä¸€è‡´ã€æŒä¹…åŒ–ã€æ•°æ®è¿‡æœŸã€æ·˜æ±°ç­–ç•¥ï¼‰ã€</p><p>åˆ†å¸ƒå¼é”ï¼ˆsetnxã€redissonï¼‰</p><p>è®¡æ•°å™¨ï¼ˆæµè§ˆé‡ã€ç‚¹èµæ•°ï¼‰</p><p>æ’è¡Œæ¦œ</p><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p><strong>å®šä¹‰</strong>ï¼šæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼ŒmysqlæŸ¥è¯¢ä¸åˆ°æ•°æ®ä¹Ÿä¸ä¼šç›´æ¥å†™å…¥ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½æŸ¥è¯¢æ•°æ®åº“</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><ol><li><p>ç¼“å­˜ç©ºæ•°æ®ï¼ˆæ¶ˆè€—å†…å­˜ï¼Œå¯èƒ½å‘é€ä¸ä¸€è‡´çš„é—®é¢˜ï¼‰</p></li><li><p>å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªä¸å­˜åœ¨çš„æ•°æ®ï¼ˆå†…å­˜å ç”¨å°ï¼Œå­˜åœ¨è¯¯åˆ¤çš„é£é™©ï¼Œå®ç°å¤æ‚ï¼‰</p><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼šé€šè¿‡ä½å›¾æ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œhashå†²çªå¯èƒ½é€ æˆè¯¯åˆ¤</p></blockquote></li></ol><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p><strong>å®šä¹‰</strong>ï¼šæŸä¸ªkeyè¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚åœ¨åŒä¸€æ—¶é—´å‘è¿‡æ¥ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ‰“åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¦‚æœé‡å»ºç¼“å­˜æ—¶é—´å¤ªé•¿ï¼Œæ•°æ®åº“å°±æœ‰å¯èƒ½å´©æºƒ</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><ol><li><p>äº’æ–¥é”ï¼ˆå¼ºä¸€è‡´ï¼Œæ€§èƒ½å·®ï¼‰</p><blockquote><p>ç¬¬ä¸€ä¸ªæ²¡æŸ¥åˆ°ç¼“å­˜çš„çº¿ç¨‹è·å–é”å»é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…</p></blockquote></li><li><p>é€»è¾‘è¿‡æœŸï¼ˆå¼±ä¸€è‡´ï¼Œé«˜å¯ç”¨ï¼‰</p><blockquote><p>æ·»åŠ é€»è¾‘è¿‡æœŸå­—æ®µï¼Œç¬¬ä¸€ä¸ªå‘ç°è¿‡æœŸçš„çº¿ç¨‹è·å–äº’æ–¥é”ï¼Œæ–°å¼€ä¸€ä¸ªçº¿ç¨‹å»é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹è¿”å›æ—§æ•°æ®</p></blockquote></li></ol><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p><strong>å®šä¹‰</strong>ï¼šåŒä¸€æ—¶æ®µå¤§é‡keyåŒæ—¶è¿‡æœŸæˆ–RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“</p><p><strong>è§£å†³æ–¹å¼</strong>ï¼š</p><ol><li>ç»™keyè®¾ç½®ä¸åŒçš„TTL</li><li>æ­å»ºé›†ç¾¤</li><li>æ·»åŠ é™çº§é™æµè§„åˆ™</li><li>æ·»åŠ å¤šçº§ç¼“å­˜</li></ol><h3 id="åŒå†™ä¸€è‡´æ€§"><a href="#åŒå†™ä¸€è‡´æ€§" class="headerlink" title="åŒå†™ä¸€è‡´æ€§"></a>åŒå†™ä¸€è‡´æ€§</h3><p><strong>å®šä¹‰</strong>ï¼šæŒ‡çš„æ˜¯mysqlçš„æ•°æ®å’Œredisçš„æ•°æ®ä¿æŒä¸€è‡´</p><p>è¯»æ“ä½œï¼šç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ï¼›æœªå‘½ä¸­æŸ¥è¯¢æ•°æ®åº“ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´å†™å…¥ç¼“å­˜</p><p>å†™æ“ä½œï¼š</p><ol><li><strong>å»¶è¿ŸåŒåˆ </strong>ï¼ˆå¼±ä¸€è‡´ï¼Œå…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´åå†åˆ ä¸€æ¬¡ï¼‰</li><li><strong>åŠ é”åå†™æ•°æ®</strong>ï¼ˆå¼ºä¸€è‡´ï¼‰</li><li>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ•°æ®åº“æ›´æ–°åé€šçŸ¥redisï¼ˆå¼±ä¸€è‡´ï¼‰</li></ol><blockquote><p><strong>ä¸å»¶æ—¶åŒåˆ </strong></p><p>å…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼šåˆ é™¤ç¼“å­˜ååˆæœ‰çº¿ç¨‹é‡å»ºäº†ç¼“å­˜ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´</p><p>å…ˆæ›´æ–°æ•°æ®åº“å†åˆ ç¼“å­˜ï¼šæ­¤æ—¶keyè¿‡æœŸï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æŸ¥åˆ°æ—§æ•°æ®ï¼Œå¾…åˆ é™¤ç¼“å­˜ååˆé‡å»ºç¼“å­˜ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´</p></blockquote><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p><strong>RDB</strong>ï¼šRedis Database Backup fileï¼ŒRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰æ•°æ®éƒ½å¤‡ä»½åˆ°ç£ç›˜</p><p><strong>æ‰§è¡ŒåŸç†</strong>ï¼š</p><p>ä¸»è¿›ç¨‹ä½¿ç”¨é¡µè¡¨æ˜ å°„å†…å­˜ä¸­çš„åœ°å€ï¼Œå­è¿›ç¨‹å¤‡ä»½æ•°æ®æ—¶æ‹·è´ä¸€ä»½é¡µè¡¨æ¥è¿›è¡Œå¤‡ä»½ï¼›</p><p>ä¸»è¿›ç¨‹å†™æ“ä½œæ—¶ï¼Œå…ˆæ‹·è´ä¸€ä»½è¦ä¿®æ”¹æ•°æ®åˆ°å¦ä¸€å—å†…å­˜ï¼Œä¿®æ”¹å®Œæ•°æ®åä¿®æ”¹é¡µè¡¨æŒ‡å‘çš„å†…å­˜åœ°å€ï¼ˆcopy-on-writeï¼‰ï¼Œä¿è¯å¤‡ä»½æ—¶çš„æ•°æ®ä¸€è‡´æ€§</p><p><strong>AOF</strong>ï¼šAppend Only Fileï¼Œè¿½åŠ æ–‡ä»¶ï¼Œè®°å½•æ¯ä¸€ä¸ªå†™æ“ä½œã€‚éœ€è¦å»é…ç½®æ–‡ä»¶é‡Œæ‰“å¼€æ­¤åŠŸèƒ½</p><p><strong>æ¯”è¾ƒ</strong>ï¼š</p><ul><li>å®Œæ•´æ€§æ¯”RDBé«˜ï¼Œæ–‡ä»¶å¤§å°ä¼šæ¯”RDBå¤§ï¼Œå¯ä»¥é€šè¿‡bgrewriteaofæ¥é‡å†™AOFä»¥å‡å°‘å¤§å°</li><li>rdbå’Œaopéƒ½ä¸èƒ½ä¿è¯æ¢å¤æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœåœ¨å†™rdbå’Œaopæ–‡ä»¶æ—¶å‡ºç°æ•…éšœï¼Œæˆ–ç”±äºå‹ç¼©rdbã€é‡å†™aopéƒ½æœ‰å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±</li></ul><h3 id="è¿‡æœŸç­–ç•¥"><a href="#è¿‡æœŸç­–ç•¥" class="headerlink" title="è¿‡æœŸç­–ç•¥"></a>è¿‡æœŸç­–ç•¥</h3><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šä½¿ç”¨æ—¶å‘ç°keyè¿‡æœŸäº†æ‰åˆ é™¤ï¼Œå å†…å­˜</p><p><strong>å®šæœŸåˆ é™¤</strong>ï¼šæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥ä¸€æ‰¹keyï¼ŒæŠŠè¿‡æœŸçš„åˆ é™¤</p><p>Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯ä¸¤è€…ç»“åˆ</p><h3 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h3><p>å†…å­˜å ç”¨å¤ªå¤šæ—¶åˆ æ‰ä¸€äº›æ•°æ®</p><ul><li><p>noevictionï¼šå†…å­˜æ»¡æ—¶ä¸æ·˜æ±°æ•°æ®ï¼Œè€Œæ˜¯ä¸å…è®¸å†™å…¥æ•°æ®ï¼ˆé»˜è®¤ï¼‰</p></li><li><p>volatile-ttlï¼šæ·˜æ±°TTLå°çš„æ•°æ®</p></li><li><p>allkeys-randomï¼šå¯¹æ‰€æœ‰æ•°æ®éšæœºæ·˜æ±°</p></li><li><p>volatile-randomï¼šå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®éšæœºæ·˜æ±°</p></li><li><p><strong>allkeys-lru</strong>ï¼šï¼ˆLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyï¼‰</p></li><li><p>volatile-lru</p></li><li><p><strong>allkeys-lfu</strong>ï¼šï¼ˆLeast Frequently Usedï¼Œæœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼šä¸€å®šæ—¶é—´å†…ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„keyï¼‰</p></li><li><p>volatile-lfu</p></li></ul><h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><h4 id="Redissonå®ç°åˆ†å¸ƒå¼é”"><a href="#Redissonå®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="Redissonå®ç°åˆ†å¸ƒå¼é”"></a>Redissonå®ç°åˆ†å¸ƒå¼é”</h4><p>åŠ é”ã€è®¾ç½®è¿‡æœŸæ—¶é—´éƒ½æ˜¯é€šè¿‡<strong>Lua</strong>è„šæœ¬å®ç°çš„</p><p><strong>çœ‹é—¨ç‹—æœºåˆ¶</strong>ï¼ˆWatch Dogï¼‰ï¼šæ¯éš”ä¸€å®šæ—¶é—´ï¼ˆreleaseTime&#x2F;3ï¼‰åšä¸€æ¬¡ç»­æœŸ</p><p><strong>é‡è¯•æœºåˆ¶</strong>ï¼šåœ¨ä¸€å®šæ¬¡æ•°å†…é€šè¿‡whileå¾ªç¯å°è¯•åŠ é”ï¼Œå¢åŠ åˆ†å¸ƒå¼é”çš„æ€§èƒ½</p><p><strong>å¯é‡å…¥</strong>ï¼šæ ¹æ®çº¿ç¨‹idåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€çº¿ç¨‹</p><p><img src="/img/else_img/redisson%E9%94%81%E9%87%8D%E5%85%A5.png"></p><p><strong>ä¸»ä»ä¸€è‡´æ€§</strong>ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»èŠ‚ç‚¹åŠ é”åï¼Œä¸»èŠ‚ç‚¹è¿˜æ²¡æœ‰å’Œä»èŠ‚ç‚¹åŒæ­¥æ•°æ®å°±å®•æœºäº†ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥åŠ é”ï¼Œå°±ä¼šå¯¼è‡´åŒä¸€æŠŠé”è¢«ä¸¤ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</li><li>redissonè§£å†³æ–¹å¼1ï¼šRedLockï¼ˆçº¢é”ï¼‰ï¼šåœ¨å¤šä¸ªrediså®ä¾‹ä¸Šåˆ›å»ºé”ï¼ˆn &#x2F; 2 + 1ï¼‰ï¼Œæ€§èƒ½å·®</li></ul><h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><p><strong>ä¸»ä»å¤åˆ¶</strong>ï¼šæ­å»ºä¸»ä»èŠ‚ç‚¹ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œæé«˜å¹¶å‘èƒ½åŠ›</p><p><img src="/img/else_img/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png" alt="ä¸»èŠ‚ç‚¹å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è¯»æ“ä½œ"></p><p><strong>ä¸»ä»åŒæ­¥</strong></p><p><img src="/img/else_img/redis%E5%85%A8%E9%87%8F%E5%90%8C%E6%AD%A5.png" alt="å…¨é‡åŒæ­¥"></p><p><img src="/img/else_img/redis%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5.png" alt="å¢é‡åŒæ­¥"></p><ul><li>é€šè¿‡replidåˆ¤æ–­ä¸»ä»èŠ‚ç‚¹æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœä»èŠ‚ç‚¹æ²¡æœ‰replidè¡¨ç¤ºç¬¬ä¸€æ¬¡åŒæ­¥æ•°æ®ï¼Œä¸»èŠ‚ç‚¹éœ€è¦å‘é€RDBæ–‡ä»¶ï¼ˆå…¨é‡åŒæ­¥ï¼‰</li><li>å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥æ•°æ®ï¼Œåˆ™é€šè¿‡offsetåç§»é‡åˆ¤æ–­éœ€è¦ä»repl_backlogä¸­å‘é€å¤šå°‘æ•°æ®æ¥æ›´æ–°ä»èŠ‚ç‚¹æ•°æ®ï¼ˆå¢é‡åŒæ­¥ï¼‰</li></ul><p><strong>å“¨å…µæ¨¡å¼</strong>ï¼šç›‘æ§ã€æ•…éšœæ¢å¤ã€é€šçŸ¥</p><p>ç›‘æ§ï¼šå¿ƒè·³æ£€æµ‹ï¼Œç›‘æ§ä¸»ä»èŠ‚ç‚¹æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ</p><p>æ•…éšœæ¢å¤ï¼šä¸»èŠ‚ç‚¹æŒ‚äº†é€‰æ‹©offsetå¤§çš„ä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹</p><p>é€šçŸ¥ï¼šå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œé€šçŸ¥Rediså®¢æˆ·ç«¯</p><p>è„‘è£‚é—®é¢˜ï¼šä¸»èŠ‚ç‚¹æ²¡æœ‰æŒ‚ï¼Œè€Œæ˜¯ç”±äºç½‘ç»œå»¶è¿Ÿå¯¼è‡´å“¨å…µèŠ‚ç‚¹æ£€æµ‹ä¸åˆ°ï¼Œä»è€Œåˆé€‰äº†ä¸ªä¸»èŠ‚ç‚¹ï¼ŒåŸå…ˆçš„ä¸»èŠ‚ç‚¹å¼ºåˆ¶å˜ä¸ºä»èŠ‚ç‚¹ï¼Œè€Œä¸»èŠ‚ç‚¹é‡Œè¿™æ®µæ—¶é—´çš„å†™æ•°æ®å°±ä¸¢å¤±äº†ã€‚<strong>è§£å†³æ–¹å¼</strong>ï¼šè®¾ç½®ä¸»èŠ‚ç‚¹è¦æœ‰ä¸€å®šæ•°é‡çš„ä»èŠ‚ç‚¹æ—¶æ‰èƒ½æ¥æ”¶å†™æ•°æ®ã€è®¾ç½®ä¸»ä»åŒæ­¥å»¶è¿Ÿæ—¶é—´çš„ä¸Šé™</p><p><strong>åˆ†ç‰‡é›†ç¾¤</strong></p><p>è§£å†³æµ·é‡æ•°æ®å­˜å‚¨å’Œé«˜å¹¶å‘å†™çš„é—®é¢˜</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterã€æ¯ä¸ªmasterä¿å­˜ä¸åŒçš„æ•°æ®</li><li>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</li><li>masterä¹‹é—´é€šè¿‡pingæ£€æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</li></ul><p>æ•°æ®è¯»å†™ï¼š</p><ul><li>Redisé›†ç¾¤æœ‰16384ä¸ª<strong>å“ˆå¸Œæ§½</strong>ï¼Œæ¯ä¸ªkeyé€šè¿‡å“ˆå¸Œè¿ç®—åå†³å®šæ”¾åˆ°å“ªä¸ªæ§½ä¸­ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½</li></ul><h3 id="Redisä¸ºä»€ä¹ˆå¿«"><a href="#Redisä¸ºä»€ä¹ˆå¿«" class="headerlink" title="Redisä¸ºä»€ä¹ˆå¿«"></a>Redisä¸ºä»€ä¹ˆå¿«</h3><ul><li>Redisæ˜¯åŸºäºå†…å­˜çš„</li><li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>ä½¿ç”¨I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IOï¼ˆå®ç°é«˜æ•ˆçš„ç½‘ç»œè¯·æ±‚ï¼‰</li></ul><p><strong>I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹</strong></p><ul><li><p>Rediså®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼š</p><p>Redisç›‘å¬ä¸€ä¸ªTCPç«¯å£æ¥æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå®¢æˆ·ç«¯ socket ä¼šè¢«è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œç„¶ååˆ›å»ºäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯çš„æ•°æ®</p></li><li><p>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼š</p><p>ç”¨æˆ·ç©ºé—´åªèƒ½æ‰§è¡Œå—é™çš„å‘½ä»¤ï¼Œå†…æ ¸ç©ºé—´å¯ä»¥æ‰§è¡Œç‰¹æƒå‘½ä»¤ï¼Œè°ƒç”¨ä¸€åˆ‡ç³»ç»Ÿèµ„æº</p></li><li><p>é˜»å¡IOã€éé˜»å¡IOå’Œå¤šè·¯å¤ç”¨IO</p><p>é˜»å¡IOï¼šç”¨æˆ·è¯·æ±‚æ•°æ®ï¼Œå†…æ ¸åœ¨å‡†å¤‡æ•°æ®å’Œæ‹·è´æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´ï¼Œå…¶ä»–ç”¨æˆ·è¿›ç¨‹é˜»å¡ç­‰å¾…</p><p>éé˜»å¡IOï¼šå†…æ ¸å‡†å¤‡æ•°æ®æ—¶å®¢æˆ·ç«¯ä¸æ–­è¯·æ±‚ç›´åˆ°æ•°æ®å‡†å¤‡å®Œæˆï¼Œæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´æ—¶é˜»å¡ç­‰å¾…</p><p><strong>é˜»å¡&#x2F;éé˜»å¡IOçš„é—®é¢˜æ˜¯Rediså•çº¿ç¨‹åŒæ—¶åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå…¶ä»–å®¢æˆ·ç«¯åªèƒ½ç­‰å¾…</strong></p><p><strong>å¤šè·¯å¤ç”¨IO</strong>ï¼šå…¶å®æ˜¯ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ª Socket çš„å°±ç»ªçŠ¶æ€ï¼Œå½“Socketæœ‰è¯»å†™äº‹ä»¶æ—¶æ‰ä¼šå»æ‰§è¡Œï¼Œä¸ä¼šä¸€ç›´é˜»å¡åœ¨ä¸€ä¸ªSocketä¸Š</p><p><img src="/img/else_img/redis%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png"></p></li></ul><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢"><a href="#å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢" class="headerlink" title="å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢"></a>å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢</h3><p>æ–¹æ¡ˆä¸€ï¼šå¼€æºå·¥å…·</p><ul><li>è°ƒè¯•å·¥å…·ï¼šArthas</li><li>è¿ç»´å·¥å…·ï¼šPrometheusã€Skywalking</li></ul><p>æ–¹æ¡ˆäºŒï¼šMySQLæ…¢æ—¥å¿—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># my.cnfå¼€å¯æ…¢æ—¥å¿—ï¼ˆåœ¨è°ƒè¯•é˜¶æ®µæ‰ä¼šå¼€å¯ï¼Œå› ä¸ºä¼šæŸè€—æ€§èƒ½ï¼‰<br>slow_query_log = 1<br># è®¾ç½®æ‰§è¡Œæ—¶é—´(s)å¤šä¹…è§†ä¸ºæ…¢æŸ¥è¯¢<br>long_query_time = 2<br><br># åœ¨localhost-slow.logä¸­è®°å½•äº†æ…¢æŸ¥è¯¢<br></code></pre></td></tr></table></figure><h3 id="æ…¢æŸ¥è¯¢ä¼˜åŒ–"><a href="#æ…¢æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="æ…¢æŸ¥è¯¢ä¼˜åŒ–"></a>æ…¢æŸ¥è¯¢ä¼˜åŒ–</h3><p>åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ <code>EXPLAIN</code>è·å–æ‰§è¡Œçš„ä¿¡æ¯</p><p>possible_keyï¼šå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</p><p>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</p><p>key_lenï¼šç´¢å¼•å ç”¨çš„å¤§å°ï¼ˆå¯ä»¥åˆ¤æ–­ç´¢å¼•æ˜¯å¦å¤±æ•ˆï¼‰</p><p>Extraï¼šé¢å¤–çš„ä¼˜åŒ–å»ºè®®</p><table><thead><tr><th>Extra</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>Using where; Using Index</td><td>ä½¿ç”¨äº†ç´¢å¼•ä¸”ä¸éœ€è¦å›è¡¨</td></tr><tr><td>Using index condition</td><td>ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†éœ€è¦å›è¡¨</td></tr></tbody></table><p>typeï¼šsqlçš„æŸ¥è¯¢çš„ç±»å‹ï¼Œå½“ä¸ºindexæˆ–allæ—¶é€Ÿåº¦æ…¢</p><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>system</td><td>æŸ¥è¯¢ç³»ç»Ÿä¸­çš„è¡¨</td></tr><tr><td>const</td><td>æ ¹æ®ä¸»é”®æŸ¥è¯¢</td></tr><tr><td>eq_ref</td><td>ä¸»é”®ç´¢å¼•æŸ¥è¯¢æˆ–å”¯ä¸€ç´¢å¼•æŸ¥è¯¢ï¼ŒåªæŸ¥è¯¢ä¸€æ¡æ•°æ®</td></tr><tr><td>ref</td><td>ç´¢å¼•æŸ¥è¯¢</td></tr><tr><td>range</td><td>èŒƒå›´æŸ¥è¯¢</td></tr><tr><td>index</td><td>ç´¢å¼•æ ‘æ‰«æ</td></tr><tr><td>all</td><td>å…¨è¡¨æ‰«æ</td></tr></tbody></table><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><blockquote><p>é«˜æ•ˆè·å–æ•°æ®çš„<strong>æ•°æ®ç»“æ„</strong>ï¼Œæé«˜æ•°æ®åº“çš„æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</p></blockquote><p><strong>æ•°æ®ç»“æ„å¯¹æ¯”</strong></p><p>äºŒå‰æœç´¢æ•°ï¼šæœ€åå¯èƒ½é€€åŒ–æˆé“¾è¡¨</p><p>çº¢é»‘æ ‘ï¼šæ•°æ®é‡å¤§æ—¶å±‚æ•°å¤ªå¤§</p><p>Bæ ‘ï¼šå¤šå‰è·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œéå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå±‚çº§æ¯”B+æ ‘å¤§</p><p>(mysqlçš„)B+æ ‘ï¼šç±»ä¼¼Bæ ‘ï¼Œåªåœ¨å¶å­èŠ‚ç‚¹å­˜æ•°æ®(éå¶å­èŠ‚ç‚¹èƒ½å­˜æ›´å¤šç´¢å¼•ï¼Œå±‚çº§æ›´å°)ï¼Œå¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¾ªç¯é“¾è¡¨(èŒƒå›´æŸ¥è¯¢)</p><p><strong>B+æ ‘ä¼˜åŠ¿</strong>ï¼šç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ï¼ŒæŸ¥è¯¢æ•ˆç‡ç¨³å®šï¼Œä¾¿äºæ‰«åº“å’ŒèŒƒå›´æŸ¥è¯¢</p><p><strong>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</strong></p><p>ä¹Ÿå«èšé›†ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•</p><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>èšç°‡ç´¢å¼•ï¼ˆå¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼‰</td><td>æ•°æ®å’Œç´¢å¼•ä¿å­˜åœ¨ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†<strong>è¡Œæ•°æ®</strong></td></tr><tr><td>éèšç°‡ç´¢å¼•ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰</td><td>æ•°æ®å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œå¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„<strong>ä¸»é”®</strong></td></tr></tbody></table><p><strong>å›è¡¨æŸ¥è¯¢</strong>ï¼šèµ°äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®åèµ°èšé›†ç´¢å¼•</p><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- å¦‚æœéèšç°‡ç´¢å¼•ä¸­åŒ…å«äº†col1å’Œcol2ï¼Œé‚£å°±ä¸éœ€è¦å›è¡¨æŸ¥è¯¢<br>SELECT col1, col2 FROM mytable WHERE col1 = 123;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘ç£ç›˜ I&#x2F;O æ“ä½œå’Œ CPU å¼€é”€ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½</p><p><strong>è¶…å¤§åˆ†é¡µ</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">-- MySQLéœ€è¦å¯¹æ•´ä¸ªæŸ¥è¯¢ç»“æœé›†è¿›è¡Œæ’åºï¼Œå½“æ•°æ®è§„æ¨¡è¿‡å¤§æ—¶ï¼Œæ’åºæ—¶é—´ä¼šæ˜æ˜¾å¢åŠ <br>select * from tb_sku limit 900000, 10;<br><br>-- ä½¿ç”¨è¦†ç›–ç´¢å¼•+å­æŸ¥è¯¢æ¥ä¼˜åŒ–<br>select *<br>from tb_sku t,<br>(select id from tb_sku order by id limit 900000, 10) a<br>where t.id = a.id;<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºç´¢å¼•åŸåˆ™</strong>ï¼š</p><ol><li>å¯¹æ•°æ®é‡å¤§(&gt; 10w)ä¸”æŸ¥è¯¢é¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•</li><li>å¯¹æŸ¥è¯¢æ¡ä»¶(where)ã€æ’åº(order by)ã€åˆ†ç»„(group by)æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•</li><li>å¯¹å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„é•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥å»ºå‰ç¼€ç´¢å¼•</li><li>ä½¿ç”¨è”åˆç´¢å¼•æ¥è¿›è¡Œè¦†ç›–ç´¢å¼•</li><li>ç´¢å¼•æ•°é‡é€‚ä¸­</li><li>ä¸èƒ½å­˜NULLå€¼æ—¶ä½¿ç”¨NOT NULLæ¥çº¦æŸ</li></ol><h3 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h3><ol><li>è¿æ³•æœ€å·¦å‰ç¼€æ³•åˆ™ï¼ˆè·³è¿‡å‰é¢ã€ä¸­é—´çš„åˆ—ï¼‰ï¼Œ</li><li>èŒƒå›´æŸ¥è¯¢ï¼Œ</li><li>è¿ç®—æ“ä½œï¼Œ</li><li>å­—ç¬¦ä¸²ä¸åŠ å¼•å·ï¼ˆå‘ç”Ÿäº†ç±»å‹è½¬æ¢ï¼‰</li><li>å¤´éƒ¨ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢</li></ol><h3 id="sqlä¼˜åŒ–"><a href="#sqlä¼˜åŒ–" class="headerlink" title="sqlä¼˜åŒ–"></a>sqlä¼˜åŒ–</h3><p><strong>è¡¨è®¾è®¡ä¼˜åŒ–</strong>ï¼š</p><ol><li>é€‰æ‹©åˆé€‚çš„æ•°å€¼ç±»å‹ï¼ˆtinyintã€intã€bigintï¼‰</li><li>é€‰æ‹©åˆé€‚çš„å­—ç¬¦ä¸²ç±»å‹ï¼ˆcharã€varcharï¼‰</li></ol><p><strong>SQLè¯­å¥ä¼˜åŒ–</strong>ï¼š</p><ol><li>selectè¯­å¥é¿å…ä½¿ç”¨select *ï¼ˆå¯èƒ½é€ æˆå›è¡¨æŸ¥è¯¢ï¼‰</li><li>é¿å…ç´¢å¼•å¤±æ•ˆ</li><li>å°½é‡ä½¿ç”¨union allä»£æ›¿unionï¼ˆunionä¼šè¿‡æ»¤é‡å¤æ•°æ®ï¼Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ï¼‰</li><li>å°½é‡ç”¨inner join ä»£æ›¿left join&#x2F;right joinï¼Œå°½é‡å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œå‡å°‘æ•°æ®åº“è¿æ¥ã€‚inner joinä¼šä¼˜åŒ–æŠŠå°è¡¨æ”¾åˆ°å¤–è¾¹ï¼Œå¤§è¡¨æ”¾åˆ°é‡Œè¾¹</li><li>ä¸»ä»å¤åˆ¶ï¼Œè¯»å†™åˆ†ç¦»</li></ol><h3 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h3><p><strong>åŸå­æ€§</strong>(Atomicity)ï¼šä¸å¯åˆ†å‰²</p><p><strong>ä¸€è‡´æ€§</strong>(Consistency)ï¼šæ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çš„çŠ¶æ€</p><p><strong>éš”ç¦»æ€§</strong>(Isolation)ï¼šäº‹åŠ¡ä¸å—å¤–éƒ¨å¹¶å‘å½±å“</p><p><strong>æŒä¹…æ€§</strong>(Durability)ï¼šäº‹åŠ¡æäº¤æˆ–å›æ»šï¼Œå¯¹æ•°æ®åº“çš„å½±å“æ˜¯æ°¸ä¹…çš„</p><h3 id="å¹¶å‘äº‹åŠ¡é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡é—®é¢˜</h3><p>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®</p><p>ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡å…ˆåä¸¤æ¬¡è¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†è¯»åˆ°çš„æ•°æ®ä¸åŒ</p><p>å¹»è¯»ï¼šäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶æ²¡æœ‰å¯¹åº”æ•°æ®ï¼Œä½†æ’å…¥æ—¶å‘ç°æ•°æ®å·²ç»å­˜åœ¨äº†</p><h3 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h3><blockquote><p>è§£å†³äº‹åŠ¡å¹¶å‘é—®é¢˜</p></blockquote><p>è¯»æœªæäº¤</p><p>è¯»å·²æäº¤ï¼šè§£å†³è„è¯»</p><p>å¯é‡å¤è¯»ï¼šInnoDBé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œè§£å†³ä¸å¯é‡å¤è¯»</p><p>ä¸²è¡ŒåŒ–ï¼šæ€§èƒ½ä½</p><h3 id="æ—¥å¿—æ–‡ä»¶"><a href="#æ—¥å¿—æ–‡ä»¶" class="headerlink" title="æ—¥å¿—æ–‡ä»¶"></a>æ—¥å¿—æ–‡ä»¶</h3><p><strong>bin log</strong>ï¼šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•æ¯ä¸€æ¡DDLå’ŒDMLï¼Œç”¨äºå¤‡ä»½æ¢å¤å’Œä¸»ä»å¤åˆ¶</p><p><strong>redo log</strong>ï¼šé‡åšæ—¥å¿—ï¼Œè®°å½•ç¼“å†²æ± é‡Œæ•°æ®çš„å˜åŒ–ã€‚å½“åˆ·æ–°è„é¡µåˆ°ç£ç›˜æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå°±ä½¿ç”¨redo logè¿›è¡Œæ•°æ®æ¢å¤ï¼Œä¿è¯æŒä¹…æ€§</p><p><strong>undo log</strong>ï¼šå›æ»šæ—¥å¿—ï¼Œè®°å½•è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯æˆ–åå‘æ“ä½œã€‚æä¾›å›æ»šå’ŒMVCCï¼Œä¿è¯ä¸€è‡´æ€§å’ŒæŒä¹…æ€§</p><h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><blockquote><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çª</p></blockquote><p><strong>éšè—å­—æ®µ</strong>ï¼š</p><ul><li>DB_TRX_IDï¼šå½“å‰çš„äº‹åŠ¡ID</li><li>DB_ROLL_PTRï¼šæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬</li></ul><p><strong>undo logç‰ˆæœ¬é“¾</strong>ï¼šè®°å½•çš„å¤šä¸ªç‰ˆæœ¬ä¸²æˆé“¾è¡¨ï¼Œé“¾è¡¨å¤´ä¸ºæœ€æ–°çš„è®°å½•</p><p><strong>readView</strong>ï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>m_ids</td><td>å½“å‰è¿˜æ²¡æäº¤çš„äº‹åŠ¡IDçš„é›†åˆ</td></tr><tr><td>min_trx_id</td><td>m_idsé‡Œé¢æœ€å°çš„äº‹åŠ¡ID</td></tr><tr><td>max_trx_id</td><td>m_idsé‡Œé¢æœ€å¤§çš„äº‹åŠ¡ID+1</td></tr><tr><td>creator_trx_id</td><td>ReadViewåˆ›å»ºæ—¶çš„äº‹åŠ¡ID</td></tr></tbody></table><p>è¯»å·²æäº¤ä¸‹æ¯æ¬¡è¯»éƒ½ä¼šåˆ›å»ºä¸€ä¸ªreadViewï¼ˆå½“å‰è¯»ï¼‰</p><p>å¯é‡å¤è¯»ä¸‹åœ¨äº‹åŠ¡çš„ç¬¬ä¸€æ¬¡è¯»æ—¶åˆ›å»ºreadViewï¼Œåç»­éƒ½ç”¨è¿™ä¸ªï¼ˆå¿«ç…§è¯»ï¼‰</p><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>binLogæ—¥å¿—è®°å½•ä¸»åº“çš„DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰å’ŒDDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥ï¼Œä»åº“å»æ‹‰ä¸»åº“çš„binLogåˆ°è‡ªå·±çš„Relay Logä¸­ï¼Œå†é€šè¿‡Relay LogåŒæ­¥æ•°æ®</p><h3 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h3><p>å•è¡¨æ•°æ®é‡è¾¾1000wæˆ–20G</p><p>å¯ä»¥é€šè¿‡ä¸šåŠ¡æˆ–å­—æ®µæˆ–æ•°æ®æ¥åˆ†åº“åˆ†è¡¨</p><h3 id="æ•°æ®å¤‡ä»½"><a href="#æ•°æ®å¤‡ä»½" class="headerlink" title="æ•°æ®å¤‡ä»½"></a>æ•°æ®å¤‡ä»½</h3><p>å¯¼å‡ºå¤‡ä»½sqlæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysqldump -u [username] -p [database_name] &gt; [backup_file].sql<br></code></pre></td></tr></table></figure><p> æ¢å¤æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql -u [username] -p [database_name] &lt; [backup_file].sql<br></code></pre></td></tr></table></figure><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h3 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h3><p><img src="/img/else_img/MyBatis%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png"></p><ol><li>åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆè¿è¡Œç¯å¢ƒï¼Œæ˜ å°„æ–‡ä»¶ï¼‰</li><li>æ„å»ºSqlSessionFactory</li><li>é€šè¿‡SqlSessionFactoryåˆ›å»ºSqlSessionå¯¹è±¡ï¼ˆæä¾›å¢åˆ æ”¹æŸ¥APIï¼‰</li><li>Executoræ ¸å¿ƒä½œç”¨æ˜¯å¤„ç†SQLè¯·æ±‚ã€äº‹åŠ¡ç®¡ç†ã€ç»´æŠ¤ç¼“å­˜ä»¥åŠæ‰¹å¤„ç†ç­‰</li><li>æŠŠæ˜ å°„æ–‡ä»¶é‡Œçš„ä¿¡æ¯å°è£…åˆ°Exectorçš„MappedStatementä¸­</li><li>æŠŠè¯·æ±‚å‚æ•°è½¬åŒ–ä¸ºmysqlå¯ä»¥è¯†åˆ«çš„æ•°æ®ç±»å‹</li><li>æŠŠè¿”å›å€¼è½¬åŒ–ä¸ºjavaå¯¹è±¡</li></ol><h3 id="å»¶è¿ŸåŠ è½½"><a href="#å»¶è¿ŸåŠ è½½" class="headerlink" title="å»¶è¿ŸåŠ è½½"></a>å»¶è¿ŸåŠ è½½</h3><blockquote><p>åœ¨æ‰§è¡Œ SQL æŸ¥è¯¢æ—¶ï¼ŒåªåŠ è½½éœ€è¦ç«‹å³è¿”å›åˆ° Java å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œè€Œå°†å…¶ä½™æ•°æ®çš„åŠ è½½æ¨è¿Ÿåˆ°è®¿é—®æ—¶</p><p>MyBatis ä¸­çš„å»¶è¿ŸåŠ è½½ä¸»è¦æ˜¯é’ˆå¯¹ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šçš„å…³è”å…³ç³»ä¸­çš„å…³è”å¯¹è±¡è¿›è¡Œçš„</p></blockquote><p>é€šè¿‡<code>fetchType = true</code>å¼€å¯å»¶è¿ŸåŠ è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">&lt;!-- å»¶è¿ŸåŠ è½½ä¸€å¯¹å¤šå…³è”å…³ç³» --&gt;<br>&lt;resultMap id=&quot;userMap&quot; type=&quot;User&quot;&gt;<br>  &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;<br>  &lt;result column=&quot;userName&quot; property=&quot;userName&quot;/&gt;<br>  &lt;result column=&quot;password&quot; property=&quot;password&quot;/&gt;<br>  &lt;collection property=&quot;posts&quot; ofType=&quot;Post&quot; column=&quot;id&quot;<br>              select=&quot;selectPostsByUserId&quot; fetchType=&quot;lazy&quot;/&gt;<br>&lt;/resultMap&gt;<br><br>&lt;select id=&quot;selectUserById&quot; resultMap=&quot;userMap&quot;&gt;<br>  SELECT * FROM user WHERE id = #&#123;id&#125;<br>&lt;/select&gt;<br><br>&lt;select id=&quot;selectPostsByUserId&quot; resultType=&quot;Post&quot;&gt;<br>  SELECT * FROM post WHERE userId = #&#123;id&#125;<br>&lt;/select&gt;<br></code></pre></td></tr></table></figure><p>å¼€å¯å…¨å±€å»¶è¿ŸåŠ è½½</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">default-lazy-loading-enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p><strong>ä¸€çº§ç¼“å­˜</strong>ï¼šä½œç”¨åŸŸä¸ºSessionï¼Œå½“Sessionè¢«flush()æˆ–è€…close()æ—¶ç¼“å­˜å°±ä¼šæ¸…ç©º</p><p><strong>äºŒçº§ç¼“å­˜</strong>ï¼šä½œç”¨åŸŸä¸ºæ•´ä¸ªMySQLå®ä¾‹ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨</p><ul><li><p>äºŒçº§ç¼“å­˜éœ€è¦ç¼“å­˜çš„æ•°æ®è¦å®ç°Serializableæ¥å£</p></li><li><p>åªæœ‰Sessionæäº¤æˆ–å…³é—­åï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®æ‰ä¼šè½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­</p></li><li><p>å½“è¿›è¡Œäº†å¢åˆ æ”¹æ“ä½œåï¼Œä¸€ã€äºŒçº§ç¼“å­˜éƒ½ä¼šæ¸…ç©º</p></li><li><p>ä¸€çº§ç¼“å­˜é»˜è®¤å¼€å¯ï¼ŒäºŒçº§ç¼“å­˜è¦æ‰‹åŠ¨å¼€å¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">cache-enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœ¨mapperä¸ŠåŠ ä¸Š@CacheNamespace</span><br><span class="hljs-comment">// åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Š @Options(useCache = true)</span><br><span class="hljs-meta">@CacheNamespace</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-meta">@Select(value = &quot;select * from user where id = #&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@Options(useCache = true)</span><br>    User <span class="hljs-title function_">selectUserById</span><span class="hljs-params">(Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">// å¦‚æœæ˜¯åœ¨xmlä¸­å®šä¹‰çš„sqlè¯­å¥ï¼Œéœ€è¦åŠ ä¸Š<span class="hljs-tag">&lt;<span class="hljs-name">cache</span>/&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><h3 id="5å¤§ç»„ä»¶"><a href="#5å¤§ç»„ä»¶" class="headerlink" title="5å¤§ç»„ä»¶"></a>5å¤§ç»„ä»¶</h3><p>æ³¨å†Œä¸­å¿ƒï¼ˆEurekaã€Nacosã€zookeeperç­‰ï¼‰</p><p>è¿œç¨‹è°ƒç”¨ï¼ˆFeignç­‰ï¼‰</p><p>è´Ÿè½½å‡è¡¡ï¼ˆRibbonç­‰ï¼‰</p><p>æœåŠ¡ç†”æ–­ï¼ˆHystrixã€Sentinelç­‰ï¼‰</p><p>ç½‘å…³ï¼ˆGetwayã€Zuulç­‰ï¼‰</p><h3 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h3><p><strong>ä¸»è¦ä½œç”¨</strong>ï¼šæœåŠ¡æ³¨å†Œå’Œå‘ç°ã€æœåŠ¡å¥åº·ç›‘æ§</p><p>æœåŠ¡æ³¨å†Œï¼šæœåŠ¡æä¾›è€…éœ€è¦æŠŠè‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­ï¼Œå¦‚æœåŠ¡åç§°ã€ipå’Œç«¯å£ç­‰</p><p>æœåŠ¡å‘ç°ï¼šæ¶ˆè´¹è€…æ‹‰å–æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¦‚æœæœåŠ¡æä¾›è€…æœ‰é›†ç¾¤ï¼Œåˆ™ä¼šåˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå‘èµ·è°ƒç”¨</p><p>æœåŠ¡ç›‘æ§ï¼šæœåŠ¡æä¾›è€…æ¯éš”ä¸€æ®µæ—¶é—´å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³ï¼ŒæŠ¥å‘Šå¥åº·çŠ¶æ€ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œè¿™ä»æœåŠ¡åˆ—è¡¨é‡Œå‰”é™¤</p><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p><ul><li><strong>RoundRobinRule</strong>ï¼šç®€å•è½®è¯¢</li><li><strong>WeightedResponseTimeRule</strong>ï¼šæŒ‰ç…§æƒé‡æ¥é€‰æ‹©æœåŠ¡å™¨ï¼Œå“åº”æ—¶é—´è¶Šé•¿ï¼Œæƒé‡è¶Šå°</li><li><strong>RandomRule</strong>ï¼šéšæœºé€‰æ‹©</li><li>BestAvailableRuleï¼šé€‰æ‹©å½“å‰å¹¶å‘åº¦ä½çš„æœåŠ¡å™¨</li><li>RetryRuleï¼šé‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘</li><li>AvailabilityFilteringRuleï¼šå…ˆè¿‡æ»¤éå¥åº·çš„ï¼Œå†é€‰æ‹©è¿æ¥æ•°è¾ƒå°çš„å®ä¾‹</li><li><strong>ZoneAvoidanceRule</strong>ï¼šæŒ‰åŒºåŸŸå°±è¿‘é€‰æ‹©æœåŠ¡å™¨</li></ul><p>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p><ul><li>å®ç°IRuleæ¥å£ï¼ˆå…¨å±€ç”Ÿæ•ˆï¼‰</li><li>é€šè¿‡é…ç½®æ–‡ä»¶ç»™å•ç‹¬çš„æœåŠ¡é€‰æ‹©è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå±€éƒ¨ï¼‰</li></ul><h3 id="æœåŠ¡é›ªå´©"><a href="#æœåŠ¡é›ªå´©" class="headerlink" title="æœåŠ¡é›ªå´©"></a>æœåŠ¡é›ªå´©</h3><p><strong>æœåŠ¡é›ªå´©</strong>ï¼šä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå¯¼è‡´æ•´æ¡é“¾è·¯çš„æœåŠ¡éƒ½å¤±è´¥çš„æƒ…å†µ</p><p>è§£å†³æ–¹å¼ï¼š</p><ul><li><p>æœåŠ¡é™çº§</p><p>åœ¨è¿œç¨‹è°ƒç”¨@FeignClient()ä¸­è®¾ç½®fallback</p></li><li><p>æœåŠ¡ç†”æ–­</p><p>Hystrixç†”æ–­æœºåˆ¶ï¼šå¦‚æœ10så†…è¯·æ±‚çš„å¤±è´¥ç‡è¶…è¿‡50%è§¦å‘ç†”æ–­æœºåˆ¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå¤±è´¥ã€‚ç†”æ–­æ—¶é—´ç»“æŸåå°è¯•æ”¾è¡Œè¯·æ±‚ï¼Œå¦‚æœæˆåŠŸåˆ™å…³é—­æ–­è·¯å™¨</p></li><li><p>é™æµ</p></li></ul><h3 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h3><p>ç”¨äºé—®é¢˜å®šä½å’Œæ€§èƒ½åˆ†æ</p><p>å¸¸è§æœåŠ¡ç›‘æ§å·¥å…·</p><ul><li>Spring Boot admin</li><li>prometheus + Grafana</li><li>zipkin</li><li><strong>skywalking</strong></li></ul><h3 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h3><p>ä¸ºä½•è¦é™æµï¼š</p><ul><li>å¹¶å‘å¤§</li><li>é˜²æ­¢æ¶æ„åˆ·æ¥å£</li></ul><p>å®ç°æ–¹å¼ï¼š</p><ul><li><p><strong>Nginx</strong>ï¼šæ¼æ¡¶ç®—æ³•(çªå‘æµé‡)ã€æ§åˆ¶å¹¶å‘è¿æ¥æ•°</p><p><img src="/img/else_img/nginx%E6%BC%8F%E6%A1%B6%E7%AE%97%E6%B3%95.png"></p></li><li><p><strong>ç½‘å…³</strong>ï¼šè¿‡æ»¤å™¨RequestRateLimiterï¼ˆä»¤ç‰Œæ¡¶ï¼‰</p></li><li><p>è‡ªå®šä¹‰æ‹¦æˆªå™¨</p></li></ul><h3 id="åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º"></a>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º</h3><p><strong>CAPå®šç†</strong>ï¼š</p><ol><li><p>Consistencyï¼šä¸€è‡´æ€§ï¼Œç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´</p></li><li><p>Availabilityï¼šå¯ç”¨æ€§ï¼Œè®¿é—®èŠ‚ç‚¹å¿…é¡»å¾—åˆ°å“åº”</p></li><li><p>Partition toleranceï¼šåˆ†åŒºå®¹é”™æ€§ï¼Œå‡ºç°åˆ†åŒºæ—¶ä¹Ÿè¦å¯¹å¤–æä¾›æœåŠ¡</p><blockquote><p>åˆ†åŒºï¼šç”±äºç½‘ç»œæ•…éšœç­‰åŸå› é€ æˆéƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹å¤±å»è”ç³»</p></blockquote></li></ol><p>åŒæ—¶åªèƒ½æ»¡è¶³ä¸¤ä¸ªï¼Œå¦‚æœè¦å¯ç”¨æ€§åˆ™åªèƒ½ç‰ºç‰²ä¸€è‡´æ€§ï¼Œåä¹‹äº¦ç„¶</p><p><strong>BASEç†è®º</strong>ï¼š</p><ol><li>Basically Availableï¼šåŸºæœ¬å¯ç”¨ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨</li><li>Soft Stateï¼šè½¯çŠ¶æ€ï¼Œå…è®¸å‡ºç°ä¸´æ—¶çš„æ•°æ®ä¸ä¸€è‡´</li><li>Eventually Consistentï¼šæœ€ç»ˆä¸€è‡´æ€§ï¼Œåœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´</li></ol><h3 id="æ¥å£å¹‚ç­‰æ€§"><a href="#æ¥å£å¹‚ç­‰æ€§" class="headerlink" title="æ¥å£å¹‚ç­‰æ€§"></a>æ¥å£å¹‚ç­‰æ€§</h3><p><strong>å¹‚ç­‰</strong>ï¼šå¤šæ¬¡è°ƒç”¨æ–¹æ³•æˆ–è€…æ¥å£ä¸ä¼šæ”¹å˜ä¸šåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯é‡å¤è°ƒç”¨çš„ç»“æœå’Œå•æ¬¡è°ƒç”¨çš„ç»“æœä¸€è‡´</p><p>å¦‚ï¼šç‚¹å‡»æäº¤è®¢å•ï¼Œç‚¹å‡»å¤šæ¬¡ä¹Ÿåªèƒ½æœ‰ä¸€æ¬¡æ˜¯æˆåŠŸçš„</p><table><thead><tr><th>è¯·æ±‚æ–¹å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>GET</td><td>æŸ¥è¯¢æ“ä½œï¼Œå¤©ç„¶å¹‚ç­‰</td></tr><tr><td>POST</td><td>æ–°å¢æ“ä½œï¼Œä¸æ˜¯å¹‚ç­‰çš„</td></tr><tr><td>PUT</td><td>æ›´æ–°æ“ä½œï¼Œå¦‚æœæ˜¯è®¾ç½®å€¼ï¼Œæ˜¯å¹‚ç­‰çš„ï¼›å¦‚æœæ˜¯åœ¨ä¸€ä¸ªå€¼ä¸Šè¿›è¡Œå¢é‡æ“ä½œï¼Œä¸æ˜¯å¹‚ç­‰çš„</td></tr><tr><td>DELETE</td><td>åˆ é™¤æ“ä½œï¼Œæ˜¯å¹‚ç­‰çš„</td></tr></tbody></table><p><strong>ä¿è¯å¹‚ç­‰çš„æ–¹å¼</strong>ï¼š</p><p><strong>token+redis</strong>ï¼š</p><p><img src="/img/else_img/%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%891.png"></p><p>å¦‚ç‚¹å‡»è´­ä¹°ï¼Œç”Ÿæˆtokenå­˜æ”¾åˆ°rediså¹¶è¿”å›ç»™å‰ç«¯ï¼›ä¹‹åæäº¤è®¢å•åˆ™å‰ç«¯å¸¦ç€tokenæ¥éªŒè¯ï¼ŒéªŒè¯æˆåŠŸåˆ™ç”Ÿæˆè®¢å•å¹¶åˆ é™¤redisä¸­çš„tokenï¼Œä¹‹åçš„è¯·æ±‚å°±ä¸ä¼šé‡å¤ç”Ÿæˆè®¢å•</p><p><strong>åˆ†å¸ƒå¼é”</strong>ï¼š</p><p>å¦‚ç¬¬ä¸€æ¬¡æäº¤è®¢å•åˆ™åŠ é”æ¥ç”Ÿæˆè®¢å•ï¼Œä¹‹åçš„è¯·æ±‚å°±ä¼šç”±äºæŠ¢ä¸åˆ°é”è€Œä¸é‡å¤ç”Ÿæˆè®¢å•</p><h2 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h2><h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><h4 id="æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="æ¶ˆæ¯ä¸ä¸¢å¤±"></a>æ¶ˆæ¯ä¸ä¸¢å¤±</h4><p>æ¶ˆæ¯å¯èƒ½åœ¨å‘é€åˆ°äº¤æ¢æœºã€é˜Ÿåˆ—å’Œæ¶ˆè´¹è€…å®•æœºæ—¶ä¸¢å¤±</p><p>RabbitMQæä¾›publisher confirmï¼ˆç”Ÿäº§è€…ç¡®è®¤ï¼‰æœºåˆ¶æ¥é¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚æ¶ˆæ¯å‘é€åˆ°MQåï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœç»™ç”Ÿäº§è€…ã€‚</p><p><img src="/img/else_img/RabbitMQ%E7%94%9F%E4%BA%A7%E8%80%85%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6.png"></p><p><strong>æ¶ˆæ¯ä¸¢å¤±åå¤„ç†æ–¹å¼</strong>ï¼š</p><ul><li>ç«‹å³é‡å‘</li><li>è®°å½•æ—¥å¿—</li><li>ä¿å­˜å‘é€å¤±è´¥çš„æ•°æ®ï¼Œå®šæ—¶ä¸€èµ·é‡å‘</li></ul><p><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šMQé»˜è®¤æ˜¯å†…å­˜å­˜å‚¨æ¶ˆæ¯ï¼Œå¼€å¯æŒä¹…åŒ–å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</p><ol><li><p>äº¤æ¢æœºæŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">simpleExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// äº¤æ¢æœºåç§°ã€æ˜¯å¦æŒä¹…åŒ–ã€æ²¡æœ‰queueç»‘å®šæ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(<span class="hljs-string">&quot;simple.direct&quot;</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é˜Ÿåˆ—æŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">simpleQueue</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> QueueBuilder.durable(<span class="hljs-string">&quot;simple.queue&quot;</span>).build();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆæ¯æŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> MessageBuilder<br>    .withBody(message.getBytes())<br>    .setDelieryMode(MessageDelieryMode.PERSISTENT)<span class="hljs-comment">// æŒä¹…åŒ–</span><br>    .build();<br></code></pre></td></tr></table></figure></li></ol><p><strong>æ¶ˆè´¹è€…ç¡®è®¤</strong>ï¼šæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯è¿”å›ackï¼ŒMQæ”¶åˆ°ackåæ‰ä¼šåˆ é™¤æ¶ˆæ¯ã€‚å¦‚æœå¤šæ¬¡è·å–æ¶ˆæ¯å¤±è´¥ï¼Œåˆ™å°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºæ¥å¤„ç†</p><h4 id="æ­»ä¿¡äº¤æ¢æœº-x2F-å»¶è¿Ÿé˜Ÿåˆ—"><a href="#æ­»ä¿¡äº¤æ¢æœº-x2F-å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡äº¤æ¢æœº&#x2F;å»¶è¿Ÿé˜Ÿåˆ—"></a>æ­»ä¿¡äº¤æ¢æœº&#x2F;å»¶è¿Ÿé˜Ÿåˆ—</h4><p><strong>å»¶è¿Ÿé˜Ÿåˆ—</strong>ï¼šè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ä¼šè¢«å»¶è¿Ÿæ¶ˆè´¹çš„é˜Ÿåˆ—ï¼Œå»¶è¿Ÿé˜Ÿåˆ—&#x3D;æ­»ä¿¡äº¤æ¢æœº+TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰</p><p>ä½¿ç”¨åœºæ™¯ï¼šè¶…æ—¶è®¢å•å–æ¶ˆã€é™æ—¶ä¼˜æƒ ã€å®šæ—¶å‘å¸ƒç­‰</p><p><strong>æ­»ä¿¡</strong>ï¼šè¿‡æœŸæ¶ˆæ¯ã€æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯ã€æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†æ—¶æœ€æ—©çš„æ¶ˆæ¯</p><p><strong>æ­»ä¿¡äº¤æ¢æœº</strong>ï¼šæ¥æ”¶æ­»ä¿¡çš„äº¤æ¢æœº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">ttlQueue</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> QueueBuilder.durable(<span class="hljs-string">&quot;simple.queue&quot;</span>)<br>        .ttl(<span class="hljs-number">10000</span>)<br>        .deadLetterExchange(<span class="hljs-string">&quot;dl.direct&quot;</span>)<span class="hljs-comment">// æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span><br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯å †ç§¯"><a href="#æ¶ˆæ¯å †ç§¯" class="headerlink" title="æ¶ˆæ¯å †ç§¯"></a>æ¶ˆæ¯å †ç§¯</h4><p>ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ—¶ï¼Œå°±ä¼šå¯¼è‡´å †ç§¯</p><p>è§£å†³æ–¹å¼ï¼š</p><ul><li>å¢åŠ æ¶ˆè´¹è€…</li><li>æ¶ˆè´¹è€…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</li><li>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯</li><li><strong>æƒ°æ€§é˜Ÿåˆ—</strong>ï¼šæ¶ˆæ¯æ¥æ”¶åå­˜åˆ°ç£ç›˜ä¸­ï¼Œæ—¶æ•ˆæ€§ä½</li></ul><h4 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h4><p><strong>æ™®é€šé›†ç¾¤</strong></p><ul><li>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å…±äº«äº¤æ¢æœºã€é˜Ÿåˆ—ä¿¡æ¯ï¼Œä¸åŒ…å«é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li><li>å½“è®¿é—®é›†ç¾¤æŸèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li><li>é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</li></ul><p><strong>é•œåƒé›†ç¾¤</strong></p><ul><li>ä¸»ä»æ¨¡å¼ï¼Œé•œåƒèŠ‚ç‚¹åšå¤‡ä»½ï¼Œä¸»èŠ‚ç‚¹å®Œæˆæ“ä½œï¼Œä¸»èŠ‚ç‚¹å®•æœºç”±é•œåƒèŠ‚ç‚¹æ›¿ä»£</li></ul><p><strong>ä»²è£é˜Ÿåˆ—</strong></p><ul><li>ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»åŒæ­¥åŸºäºRaftåè®®ï¼Œè§£å†³é•œåƒèŠ‚ç‚¹ä¸»ä»åŒæ­¥æ—¶ä¸»èŠ‚ç‚¹å®•æœºçš„é—®é¢˜</li></ul><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><h3 id="åŸºç¡€-2"><a href="#åŸºç¡€-2" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h4><p>è¿›ç¨‹ï¼šå½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½ä»£ç åˆ°å†…å­˜ï¼Œæ­¤æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹</p><p>çº¿ç¨‹ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹</p><p><strong>æ¯”è¾ƒ</strong>ï¼š</p><ol><li>è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œçš„å®ä¾‹ï¼Œè¿›ç¨‹åŒ…å«çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œä¸åŒçš„ä»»åŠ¡</li><li>ä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·æ›´ä½</li></ol><h4 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h4><p>å¹¶å‘ï¼šä¸€ä¸ªcpuåŒæ—¶å¤„ç†å¤šä¸ªçº¿ç¨‹</p><p>å¹¶è¡Œï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</p><h4 id="star-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"><a href="#star-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼" class="headerlink" title=":star:åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼"></a>:star:åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</h4><ul><li>ç»§æ‰¿<strong>Thread</strong>ç±»ï¼Œé‡å†™run()ï¼Œstart()å¼€å¯</li><li>å®ç°<strong>Runnable</strong>æ¥å£ï¼Œé‡å†™run()ï¼Œç”¨Thread()åŒ…è£…ï¼Œstart()å¼€å¯</li><li>å®ç°<strong>Callable</strong>æ¥å£ï¼Œé‡å†™call()ï¼Œç”¨FutureTask()åŒ…è£…ï¼Œå†ç”¨Thread()åŒ…è£…ï¼Œstart()å¼€å¯ï¼Œget()è·å–è¿”å›å€¼</li><li><strong>çº¿ç¨‹æ± </strong>åˆ›å»ºçº¿ç¨‹ï¼Œå°†ä»»åŠ¡submitæäº¤ç»™çº¿ç¨‹æ± </li></ul><p>Runnableå’ŒCallableçš„åŒºåˆ«ï¼š</p><ul><li>Runnableæ¥å£çš„runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼ŒCallableæ¥å£callæ–¹æ³•æœ‰è¿”å›å€¼</li><li>Callableæ¥å£çš„callæ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼ŒRunnableçš„runåªèƒ½catch</li></ul><h4 id="start-å’Œrun-çš„åŒºåˆ«"><a href="#start-å’Œrun-çš„åŒºåˆ«" class="headerlink" title="start()å’Œrun()çš„åŒºåˆ«"></a>start()å’Œrun()çš„åŒºåˆ«</h4><p>start()ï¼šå¯åŠ¨çº¿ç¨‹ï¼Œstartæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡</p><p>run()ï¼šè¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç </p><h4 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">State</span>&#123;<br>    <span class="hljs-comment">// æ–°å»º</span><br>    NEW,<br>    <br>    <span class="hljs-comment">// å°±ç»ª</span><br>    RUNNABLE,<br>    <br>    <span class="hljs-comment">// é˜»å¡</span><br>    BLOCKED,<br>    <br>    <span class="hljs-comment">// ç­‰å¾…</span><br>    WAITING,<br>    <br>    <span class="hljs-comment">// æœ‰é™æ—¶ç­‰å¾…</span><br>    TIMED_WAITING,<br>    <br>    <span class="hljs-comment">// ç»ˆæ­¢</span><br>    TERMINATED;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>Thread.join()ï¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œ</p><p>Object.wait()ï¼šæ”¾å¼ƒé”ï¼Œåœ¨è¿™ä¸ªé”ä¸Šç­‰å¾…</p><p>Object.notify()ï¼šéšæœºå”¤é†’é”ä¸Šç­‰å¾…çš„çº¿ç¨‹</p><p>Object.notifyAll()ï¼šå”¤é†’å½“å‰é”ä¸Šçš„æ‰€æœ‰çº¿ç¨‹</p><p>Thread.sleep()ï¼šæŠ±ç€é”ç¡çœ </p><p>Thread.interrupt()ï¼šæ‰“æ–­çº¿ç¨‹ï¼Œè¢«æ‰“æ–­çš„çº¿ç¨‹å¦‚æœåœ¨é˜»å¡ä¼šæŠ›å¼‚å¸¸ï¼›è¢«æ‰“æ–­çº¿ç¨‹æ²¡æœ‰é˜»å¡ï¼Œåˆ™è‡ªå·±é€šè¿‡interruptå˜é‡åˆ¤æ–­æ˜¯å¦è¦ç»ˆæ­¢çº¿ç¨‹</p><h3 id="å¹¶å‘å®‰å…¨"><a href="#å¹¶å‘å®‰å…¨" class="headerlink" title="å¹¶å‘å®‰å…¨"></a>å¹¶å‘å®‰å…¨</h3><h4 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h4><p><strong>synchronized</strong></p><blockquote><p>äº’æ–¥çš„å¯¹è±¡é”ï¼Œé‡é‡çº§é”ï¼Œæ€§èƒ½è¾ƒä½ï¼Œä¸€æ—¦é”å‘ç”Ÿç«äº‰éƒ½ä¼šå‡çº§ä¸ºé‡é‡çº§é”</p></blockquote><p><strong>åŸç†</strong></p><p>synchronized(lock)ä¸­çš„lockä¼šä¸Monitorå…³è”ï¼ˆå¯¹è±¡çš„MarkWordæŒ‡å‘Monitorï¼‰</p><p>Monitorç›‘è§†å™¨ï¼š</p><ul><li>WaitSetï¼šåœ¨é”ä¸Šwaitçš„çº¿ç¨‹</li><li>EntryListï¼šç­‰å¾…é”çš„çº¿ç¨‹é˜Ÿåˆ—</li><li>Ownerï¼šå½“å‰é”çš„æŒæœ‰è€…</li></ul><p><strong>è½»é‡çº§é”</strong>ï¼šé€šè¿‡CASæ¥è·å–é”ï¼›é”å¯¹è±¡çš„MarkWordæŒ‡å‘é”è®°å½•åœ°å€ï¼ŒåŸæ¥MarkWordçš„å†…å®¹æ”¾åœ¨æŒæœ‰é”çº¿ç¨‹ä¸­</p><p><strong>åå‘é”</strong>ï¼šåªæ˜¯åœ¨MarkWordä¸­è®°å½•ä¸€ä¸‹æŒæœ‰é”çº¿ç¨‹çš„idï¼Œé”é‡å…¥æ—¶ä¸éœ€è¦cas</p><h4 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h4><blockquote><p>JMMï¼ˆJava Memory Modelï¼‰ï¼Œå®šä¹‰äº†<strong>å…±äº«å†…å­˜</strong>å’Œ<strong>å¤šçº¿ç¨‹ç¨‹åº</strong>è¯»å†™æ“ä½œçš„è¡Œä¸ºè§„èŒƒ</p></blockquote><p><img src="/img/else_img/JMM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png"></p><h4 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h4><blockquote><p>Compare And Swapï¼Œä½“ç°ä¹è§‚é”çš„æ€æƒ³ï¼Œåœ¨æ— é”çŠ¶æ€ä¸‹ä¿è¯çº¿ç¨‹æ“ä½œæ•°æ®çš„åŸå­æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¼ªä»£ç </span><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-type">int</span> æ—§å€¼A = å…±äº«å˜é‡V;<br>    <span class="hljs-type">int</span> æ–°å€¼B = æ—§å€¼A + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (compareAndSwap(æ—§å€¼A, æ–°å€¼B)) &#123;<span class="hljs-comment">// æ¯”è¾ƒVçš„å€¼æ˜¯å¦å’Œæ—§å€¼Aç›¸åŒ</span><br>        <span class="hljs-comment">// æˆåŠŸï¼Œé€€å‡ºå¾ªç¯</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">// caså¤±è´¥åˆ™ä¼šé‡è¯•ä¸€å®šæ¬¡æ•°(è‡ªæ—‹)</span><br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ²¡æœ‰åŠ é”ï¼Œçº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæ•ˆç‡è¾ƒé«˜</li><li>è‹¥ç«äº‰æ¿€çƒˆï¼Œé‡è¯•é¢‘ç¹ï¼Œæ•ˆç‡ä¼šå—å½±å“</li></ul><p><strong>åº•å±‚</strong>ï¼š</p><p>â€‹ä¾èµ–äºUnsafeç±»æ¥ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„CASæŒ‡ä»¤</p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ReentrantLockã€AtomicXXXç±»ç­‰</li></ul><h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h4><blockquote><p>å…³é”®å­—ï¼Œè¢«ä¿®é¥°çš„å˜é‡å¯ä»¥ä¿è¯<strong>å¯è§æ€§</strong>å’Œé˜²æ­¢<strong>æŒ‡ä»¤é‡æ’åº</strong></p></blockquote><p><strong>å…±äº«å˜é‡ä¸å¯è§çš„æƒ…å†µ</strong>ï¼šç”±äºä¸€ä¸ªå˜é‡éœ€è¦è¯»å¾ˆå¤šæ¬¡ï¼Œè€Œæ¯æ¬¡éƒ½è¯»åˆ°çš„åŒä¸€ä¸ªå€¼ï¼ŒJITç¼–è¯‘å™¨å°±ä¼šåšä¼˜åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">while</span>(!stop) &#123;<span class="hljs-comment">// è¿™é‡Œ!stopå°±å¯èƒ½è¢«ä¼˜åŒ–æˆtrue</span><br>    i++;<br>&#125;<br><br><span class="hljs-comment">// é€šè¿‡ volatile boolean stop å¯ä»¥ä¸è¢«ä¼˜åŒ–</span><br></code></pre></td></tr></table></figure><p><strong>æŒ‡ä»¤é‡æ’åºçš„æƒ…å†µ</strong>ï¼šç¼–è¯‘å™¨ä¼˜åŒ–ä»£ç é¡ºåº</p><p>volatileé€šè¿‡å‘ä¸Šçš„å†™å±éšœå’Œå‘ä¸‹çš„è¯»å±éšœæ¥é˜²æ­¢æŒ‡ä»¤é‡æ’</p><h4 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h4><blockquote><p>Abstract Queue Synchronizedï¼ŒæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨</p></blockquote><p><strong>åŸç†</strong>ï¼šé€šè¿‡stateå˜é‡è¡¨ç¤ºé”æ˜¯å¦è¢«å ç”¨(0 æ— é”ï¼Œ1 æœ‰é”)ï¼Œçº¿ç¨‹é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œä¿®æ”¹ï¼Œæ²¡æŠ¢åˆ°é”çš„å»FIFOé˜Ÿåˆ—ç­‰å¾…</p><p><strong>AQSå¸¸è§çš„å®ç°ç±»</strong></p><ul><li>ReentrantLock å¯é‡å…¥é”</li><li>Semaphore ä¿¡å·é‡</li><li>CountDownLatch å€’è®¡æ—¶é”</li></ul><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>é¢è¯•é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaè™šæ‹Ÿæœº</title>
    <link href="/2023/02/18/java/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    <url>/2023/02/18/java/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaè™šæ‹Ÿæœº"><a href="#Javaè™šæ‹Ÿæœº" class="headerlink" title="Javaè™šæ‹Ÿæœº"></a>Javaè™šæ‹Ÿæœº</h1><p>å­¦ä¹ è‡ª:<a href="https://shuyi.tech/">é™ˆæ ‘ä¹‰çš„åšå®¢ (shuyi.tech)</a></p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœº"><a href="#ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœº" class="headerlink" title="ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœº"></a>ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœº</h3><p>â€‹<strong>Javaè·¨å¹³å°</strong>ï¼šJava è¯­è¨€å¹¶ä¸ç›´æ¥å°†ä»£ç ç¼–è¯‘æˆä¸ç³»ç»Ÿæœ‰å…³çš„æœºå™¨ç ï¼Œè€Œæ˜¯ç¼–è¯‘æˆä¸€ç§ç‰¹å®šçš„è¯­è¨€è§„èŒƒï¼Œè¿™ç§è¯­è¨€è§„èŒƒæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å­—èŠ‚ç </strong>ã€‚Java è™šæ‹Ÿæœºä¼šè§£æå­—èŠ‚ç æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†å…¶ç¿»è¯‘ä¸ºå„æ“ä½œç³»ç»Ÿèƒ½ç†è§£çš„æœºå™¨ç ã€‚<strong>å®é™…ä¸Š Java è™šæ‹Ÿæœºè¿è¡Œçš„æ˜¯å­—èŠ‚ç æ–‡ä»¶</strong></p><p><img src="/img/jvm_img/java%E8%B7%A8%E5%B9%B3%E5%8F%B0.png" alt="ä¸€æ¬¡ç¼–è¯‘ åˆ°å¤„è¿è¡Œ"></p><p>â€‹ Java è™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ç ç¿»è¯‘å™¨ï¼Œå®ƒå°†å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘æˆå„ä¸ªç³»ç»Ÿå¯¹åº”çš„æœºå™¨ç ï¼Œç¡®ä¿å­—èŠ‚ç æ–‡ä»¶èƒ½åœ¨å„ä¸ªç³»ç»Ÿæ­£ç¡®è¿è¡Œ</p><h3 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a>ç¼–è¯‘è¿‡ç¨‹</h3><p>â€‹ç¼–è¯‘å™¨åˆ†ç±»ï¼šå‰ç«¯ç¼–è¯‘å™¨ã€JIT ç¼–è¯‘å™¨ï¼ˆJust In Time Compilerï¼Œå³æ—¶ç¼–è¯‘å™¨ï¼‰å’ŒAOTç¼–è¯‘å™¨ï¼ˆAhead of Time Compilerï¼Œé™æ€æå‰ç¼–è¯‘å™¨ï¼‰</p><h4 id="å‰ç«¯ç¼–è¯‘å™¨"><a href="#å‰ç«¯ç¼–è¯‘å™¨" class="headerlink" title="å‰ç«¯ç¼–è¯‘å™¨"></a>å‰ç«¯ç¼–è¯‘å™¨</h4><p>â€‹ JDK çš„å®‰è£…ç›®å½•é‡Œæœ‰ä¸€ä¸ª javac å·¥å…·ï¼Œå°±æ˜¯å®ƒå°† Java ä»£ç ç¿»è¯‘æˆå­—èŠ‚ç ï¼Œè¿™ä¸ªå·¥å…·æˆ‘ä»¬å«åšç¼–è¯‘å™¨ã€‚ç›¸å¯¹äºåé¢è¦è®²çš„å…¶ä»–ç¼–è¯‘å™¨ï¼Œå…¶å› ä¸ºå¤„äºç¼–è¯‘çš„å‰æœŸï¼Œå› æ­¤åˆè¢«æˆä¸º<strong>å‰ç«¯ç¼–è¯‘å™¨</strong></p><p><strong>ä½œç”¨</strong></p><p>â€‹æºä»£ç  â€“&gt; å­—èŠ‚ç </p><p><strong>è¿‡ç¨‹</strong></p><ol><li>è¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼šjavacç¼–è¯‘å™¨â€è¯»æ‡‚â€æºä»£ç ï¼Œç”Ÿæˆè¯­æ³•æ ‘</li><li>å¡«å……ç¬¦å·è¡¨ï¼šç¼–è¯‘é˜¶æ®µæ— æ³•çŸ¥é“ä»£ç ä¸­å¼•ç”¨åˆ°çš„å…¶ä»–ç±»çš„åœ°å€ï¼Œå…ˆç”¨ä¸€ä¸ªç¬¦å·å¡«å……ï¼Œåˆ°ç±»åŠ è½½é˜¶æ®µå†æ›¿æ¢ä¸ºçœŸå®åœ°å€</li><li>åˆ†ææ³¨è§£</li><li>ç”Ÿæˆå­—èŠ‚ç </li></ol><h4 id="JIT-ç¼–è¯‘å™¨"><a href="#JIT-ç¼–è¯‘å™¨" class="headerlink" title="JIT ç¼–è¯‘å™¨"></a>JIT ç¼–è¯‘å™¨</h4><p>â€‹ç”Ÿæˆå­—èŠ‚ç åï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨javaè§£é‡Šå™¨è¿è¡Œï¼Œæˆ–è€…ä½¿ç”¨JITç¼–è¯‘å™¨å…ˆå°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç å†è¿è¡Œã€‚å‰è€…å¯åŠ¨é€Ÿåº¦å¿«ä½†è¿è¡Œé€Ÿåº¦æ…¢ï¼Œè€Œåè€…å¯åŠ¨é€Ÿåº¦æ…¢ä½†è¿è¡Œé€Ÿåº¦å¿«ã€‚ä¸ºäº†è¿è¡Œé€Ÿåº¦ä»¥åŠæ•ˆç‡ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨<strong>ä¸¤è€…ç›¸ç»“åˆ</strong>çš„æ–¹å¼è¿›è¡Œ Java ä»£ç çš„ç¼–è¯‘æ‰§è¡Œ</p><p><strong>ä½œç”¨</strong></p><p>â€‹å­—èŠ‚ç  â€“&gt; æœºå™¨ç </p><p><strong>ç±»å‹</strong>ï¼š</p><p>â€‹HotSpot è™šæ‹Ÿæœºå†…ç½®æœ‰ä¸¤ç§JITç¼–è¯‘å™¨ï¼šClient Compiler å’ŒServer Compilerï¼Œç®€ç§°ä¸ºC1ç¼–è¯‘æ¨¡å¼ã€C2ç¼–è¯‘æ¨¡å¼ã€‚</p><p>â€‹ä¸åŒï¼šC1ç¼–è¯‘æ¨¡å¼ç¼–è¯‘é€Ÿåº¦å¿«ã€ä¼˜åŒ–ä¿å®ˆï¼›C2ç¼–è¯‘æ¨¡å¼ç¼–è¯‘è¾ƒæ…¢ã€ä¼˜åŒ–ç›¸å¯¹è¾ƒå¥½ã€‚</p><p><strong>å‚æ•°</strong>ï¼š</p><p>â€‹é»˜è®¤æ˜¯æ··åˆèµ·æ¥ç”¨çš„(Mixed Mode)ï¼Œç¼–è¯‘æ—¶å¯ä½¿ç”¨å‚æ•°<code>-client</code>æˆ–<code>-server</code>æŒ‡å®šåªä½¿ç”¨å…¶ä¸­ä¸€ç§</p><p>â€‹<code>-Xint</code>ï¼šåªè§£é‡Šè¿è¡Œï¼Œä¸ç¼–è¯‘ã€‚</p><p>â€‹<code>-Xcomp</code>ï¼šä¼˜å…ˆç¼–è¯‘</p><h4 id="AOTç¼–è¯‘å™¨"><a href="#AOTç¼–è¯‘å™¨" class="headerlink" title="AOTç¼–è¯‘å™¨"></a>AOTç¼–è¯‘å™¨</h4><p>â€‹AOT ç¼–è¯‘å™¨åˆ™èƒ½å°†æºä»£ç ç›´æ¥ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œé€Ÿåº¦å¿«äºå‰ç«¯ç¼–è¯‘å™¨ï¼Œæ…¢äºå³æ—¶ç¼–è¯‘å™¨ã€‚å­˜åœ¨çš„ç›®çš„åœ¨äºJava è™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚ä¸å¿…ç­‰å¾…åŠæ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘ Java åº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒã€‚</p><p><strong>ä½œç”¨</strong></p><p>â€‹æºä»£ç  â€“&gt; æœºå™¨ç </p><h3 id="å­—èŠ‚ç æ–‡ä»¶ç»“æ„"><a href="#å­—èŠ‚ç æ–‡ä»¶ç»“æ„" class="headerlink" title="å­—èŠ‚ç æ–‡ä»¶ç»“æ„"></a>å­—èŠ‚ç æ–‡ä»¶ç»“æ„</h3><p>â€‹ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šäº† Java è™šæ‹Ÿæœºç»“æ„ã€Class ç±»æ–‡ä»¶ç»“æ„ã€å­—èŠ‚ç æŒ‡ä»¤ç­‰å†…å®¹ã€‚</p><p>å­—èŠ‚ç æ–‡ä»¶ç»“æ„æ˜¯ä¸€ç»„ä»¥ 8 ä½ä¸ºæœ€å°åŸºç¡€çš„åå…­è¿›åˆ¶æ•°æ®æµã€‚</p><p>å­—èŠ‚ç ç”±ä¸¤ç§åŸºæœ¬æ•°æ®ç±»å‹ç»„æˆï¼š</p><ul><li>æ— ç¬¦å·æ•°ï¼šu1ã€u2ã€u4ã€u8 å…­ä¸ƒåˆ†åˆ«ä»£è¡¨ 1 ä¸ªå­—èŠ‚ã€2 ä¸ªå­—èŠ‚ã€4 ä¸ªå­—èŠ‚ã€8 ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°</li><li>è¡¨ï¼šç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–å…¶ä»–è¡¨ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œä»¥<code>_info</code>ç»“å°¾ã€‚å­—èŠ‚ç æ–‡ä»¶æœ¬è´¨å°±æ˜¯ä¸€å¼ è¡¨</li></ul><p><img src="/img/jvm_img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E7%BB%84%E6%88%90.png"></p><h4 id="é­”æ•°"><a href="#é­”æ•°" class="headerlink" title="é­”æ•°"></a>é­”æ•°</h4><p>â€‹Class æ–‡ä»¶çš„ç¬¬ 1 - 4 ä¸ªå­—èŠ‚ä»£è¡¨äº†è¯¥æ–‡ä»¶çš„é­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå…¶å€¼å›ºå®šæ˜¯ï¼š0xCAFEBABEã€‚ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„ Class æ–‡ä»¶</p><h4 id="æ–‡ä»¶ç‰ˆæœ¬"><a href="#æ–‡ä»¶ç‰ˆæœ¬" class="headerlink" title="æ–‡ä»¶ç‰ˆæœ¬"></a>æ–‡ä»¶ç‰ˆæœ¬</h4><p>â€‹Class æ–‡ä»¶çš„ç¬¬ 5 - 6 ä¸ªå­—èŠ‚ä»£è¡¨äº† Class æ–‡ä»¶çš„æ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰ï¼Œå³ç¼–è¯‘è¯¥ Class æ–‡ä»¶çš„ JDK æ¬¡ç‰ˆæœ¬å·ã€‚</p><p>â€‹Class æ–‡ä»¶çš„ç¬¬ 7 - 8 ä¸ªå­—èŠ‚ä»£è¡¨äº† Class æ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰ï¼Œå³ç¼–è¯‘è¯¥ Class æ–‡ä»¶çš„ JDK ä¸»ç‰ˆæœ¬å·ã€‚</p><p>â€‹JDK1.8çš„åå…­è¿›åˆ¶ç‰ˆæœ¬å·ä¸º0000 0034</p><h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>â€‹å ä¸¤ä¸ªå­—èŠ‚çš„constant_pool_countè¡¨ç¤ºå¸¸é‡æ± ä¸­çš„å¸¸é‡ä¸ªæ•°</p><p>â€‹<code>cp_info</code>è¡¨ç¤ºæ•´ä¸ªå¸¸é‡æ± ï¼Œé‡Œé¢çš„ç»“æ„ä¸º<code>å¸¸é‡ç±»å‹(u2) + å¸¸é‡çš„æ•°æ®ç»“æ„(ä¸å®šé•¿) </code>çš„ç»„åˆï¼Œå¸¸é‡çš„æ•°æ®ç»“æ„å…±æœ‰14 ç§ ç±»å‹</p><p>â€‹<img src="/img/jvm_img/%E5%B8%B8%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png"></p><h4 id="è®¿é—®æ ‡å¿—"><a href="#è®¿é—®æ ‡å¿—" class="headerlink" title="è®¿é—®æ ‡å¿—"></a>è®¿é—®æ ‡å¿—</h4><p>â€‹access_flagsç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯</p><p>â€‹<img src="/img/jvm_img/%E5%AD%97%E8%8A%82%E7%A0%81%E8%AE%BF%E9%97%AE%E6%A0%87%E5%BF%97.png"></p><p>â€‹è®¿é—®æ ‡å¿—å¯èƒ½æ˜¯ç”±å¤šä¸ªæ ‡å¿—åç§°ç»„æˆçš„ï¼Œå¦‚0021æ˜¯ç”±0x0001 | 0x0020å¾—æ¥çš„</p><h4 id="ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•"><a href="#ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•" class="headerlink" title="ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•"></a>ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•</h4><p>â€‹<strong>ç±»ç´¢å¼•</strong>ï¼šç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œå¤§å°ä¸ºu2ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­çš„å¸¸é‡</p><p>â€‹<strong>çˆ¶ç±»ç´¢å¼•</strong>ï¼šå¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œå¤§å°ä¸ºu2ï¼ŒæŒ‡å‘å¸¸é‡æ± ä¸­çš„å¸¸é‡</p><p>â€‹<strong>æ¥å£ç´¢å¼•</strong>ï¼šç”¨æ¥æè¿°å“ªä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œu2 è®°å½•æ¥å£æ•°é‡ï¼Œåé¢interfacesè®°å½•æ‰€æœ‰çš„æ¥å£ä¿¡æ¯</p><h4 id="å­—æ®µè¡¨"><a href="#å­—æ®µè¡¨" class="headerlink" title="å­—æ®µè¡¨"></a>å­—æ®µè¡¨</h4><p>â€‹ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ï¼Œå­—æ®µè¡¨çš„æ¯ä¸ªå­—æ®µç”¨ä¸€ä¸ªåä¸º field_info çš„è¡¨æ¥è¡¨ç¤º</p><p>â€‹<img src="/img/jvm_img/%E5%AD%97%E6%AE%B5%E4%BF%A1%E6%81%AF%E8%A1%A8.png"></p><h4 id="æ–¹æ³•è¡¨"><a href="#æ–¹æ³•è¡¨" class="headerlink" title="æ–¹æ³•è¡¨"></a>æ–¹æ³•è¡¨</h4><p>â€‹ç”¨äºæè¿°ç±»ä¸­çš„æ–¹æ³•ä¿¡æ¯</p><p>â€‹<img src="/img/jvm_img/%E6%96%B9%E6%B3%95%E4%BF%A1%E6%81%AF%E8%A1%A8.png"></p><h4 id="å±æ€§è¡¨"><a href="#å±æ€§è¡¨" class="headerlink" title="å±æ€§è¡¨"></a>å±æ€§è¡¨</h4><p>â€‹æè¿°<strong>ç±»</strong>çš„å±æ€§ä¿¡æ¯</p><h4 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h4><p>â€‹å¯ä»¥é€šè¿‡<code>javap -verbose æ–‡ä»¶å.class</code>åç¼–è¯‘å°†å­—èŠ‚ç æ–‡ä»¶å…¨éƒ¨åˆ†æå‡ºæ¥</p><p>â€‹<img src="/img/jvm_img/%E5%8F%8D%E7%BC%96%E8%AF%91.png"></p><p>â€‹<img src="/img/jvm_img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E6%95%B4%E4%BD%93%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><h3 id="è™šæ‹Ÿæœºå†…å­˜ç»“æ„"><a href="#è™šæ‹Ÿæœºå†…å­˜ç»“æ„" class="headerlink" title="è™šæ‹Ÿæœºå†…å­˜ç»“æ„"></a>è™šæ‹Ÿæœºå†…å­˜ç»“æ„</h3><p>â€‹å­—èŠ‚ç æ–‡ä»¶ä¼šåŠ è½½è¿›è™šæ‹Ÿæœºå†…å­˜ä¸­ï¼Œè¿›è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–åè¿è¡Œå¾—å‡ºç»“æœã€‚</p><p>â€‹Java è™šæ‹Ÿæœºçš„å†…å­˜ç»“æ„å¯ä»¥åˆ†ä¸ºå…¬æœ‰å’Œç§æœ‰ä¸¤éƒ¨åˆ†ã€‚å…¬æœ‰æŒ‡çš„æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½å…±äº«çš„éƒ¨åˆ†ï¼ŒæŒ‡çš„æ˜¯ <strong>Java å †</strong>ã€<strong>æ–¹æ³•åŒº</strong>ã€<strong>å¸¸é‡æ± </strong>ã€‚ç§æœ‰æŒ‡çš„æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š<strong>PCå¯„å­˜å™¨</strong>ã€<strong>Java è™šæ‹Ÿæœºæ ˆ</strong>ã€<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ã€‚</p><h4 id="å…¬æœ‰éƒ¨åˆ†"><a href="#å…¬æœ‰éƒ¨åˆ†" class="headerlink" title="å…¬æœ‰éƒ¨åˆ†"></a>å…¬æœ‰éƒ¨åˆ†</h4><p>â€‹<strong>javaå †</strong>ï¼šä¸“é—¨ç”¨äº Java å®ä¾‹å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå‡ ä¹æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½åœ¨ä¼šè¿™é‡Œè¿›è¡Œå†…å­˜çš„åˆ†é…ï¼Œæœ‰äº›å°å¯¹è±¡å¯èƒ½åœ¨æ ˆä¸Šåˆ†é…å†…å­˜</p><p>æ ¹æ®å¯¹è±¡å­˜æ´»æ—¶é—´ï¼Œå †å¯ä»¥åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºï¼‰</p><p><img src="/img/jvm_img/%E5%A0%86%E7%BB%93%E6%9E%84.png"></p><ol><li><p><strong>æ–°ç”Ÿä»£</strong>ï¼š</p><ul><li>Eden ï¼ˆä¼Šç”¸ï¼‰åŒºï¼šJavaæ–°å¯¹è±¡çš„å‡ºç”Ÿåœ°ï¼ˆå¦‚æœæ–°åˆ›å»ºçš„å¯¹è±¡å ç”¨å†…å­˜å¾ˆå¤§ï¼Œåˆ™ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼‰ã€‚å½“EdenåŒºå†…å­˜ä¸å¤Ÿçš„æ—¶å€™å°±ä¼šè§¦å‘MinorGCï¼Œå¯¹æ–°ç”Ÿä»£åŒºè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚</li><li>ServivorToã€ServivorFromï¼šæ¯æ¬¡MinorGCéƒ½ä¼šæ¸…ç†serviorFromå’ŒEdenåŒºçš„å¯¹è±¡ï¼Œç„¶åå°†å¹¸å­˜å¯¹è±¡<strong>å¤åˆ¶åˆ°</strong>ServiorToä¸­ï¼ˆè¾¾åˆ°è€å¹´ä»£æŒ‡æ ‡çš„å¯¹è±¡å­˜åˆ°è€å¹´ä»£ï¼‰ï¼Œéšåæ¸…ç©ºEdenå’ŒServicorFromä¸­çš„å¯¹è±¡ï¼Œæœ€åäº¤æ¢serviorToå’ŒServiorFromã€‚ï¼ˆ<strong>å¤åˆ¶ç®—æ³•</strong>ï¼‰</li></ul><p>ä¸‰ä¸ªåŒºåŸŸçš„æ¯”ä¾‹Edenï¼šfrom ï¼što &#x3D; 8:1:1 ï¼Œé€šè¿‡<code>-XX:MaxTenuringThreshold = </code>è®¾ç½®GCå¤šå°‘æ¬¡æ™‹å‡åˆ°è€å¹´ä»£ï¼Œé»˜è®¤15ã€‚</p></li><li><p><strong>è€å¹´ä»£</strong>ï¼š</p><p>â€‹å½“è€å¹´ä»£çš„ç©ºé—´ä¸è¶³æ—¶ä¼šè§¦å‘MajorGCï¼Œé¦–å…ˆæ‰«æä¸€æ¬¡æ‰€æœ‰è€å¹´ä»£ï¼Œæ ‡è®°å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå›æ”¶æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡ï¼ˆ<strong>æ ‡è®°æ¸…é™¤æ³•</strong>ï¼‰</p></li><li><p><strong>æ–¹æ³•åŒº</strong>ï¼š</p><p>â€‹æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸï¼Œä¸»è¦å­˜æ”¾Classå’ŒMetaï¼ˆå…ƒæ•°æ®ï¼‰çš„ä¿¡æ¯ï¼Œåœ¨Java8ä¸­ï¼Œæ°¸ä¹…ä»£å·²ç»è¢«ç§»é™¤ï¼Œè¢«ä¸€ä¸ªç§°ä¸ºâ€œå…ƒæ•°æ®åŒºâ€ï¼ˆå…ƒç©ºé—´ï¼‰çš„åŒºåŸŸæ‰€å–ä»£ã€‚å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š<strong>å…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜</strong></p></li></ol><h4 id="ç§æœ‰éƒ¨åˆ†"><a href="#ç§æœ‰éƒ¨åˆ†" class="headerlink" title="ç§æœ‰éƒ¨åˆ†"></a>ç§æœ‰éƒ¨åˆ†</h4><ol><li><strong>PC å¯„å­˜å™¨</strong>ï¼šä¿å­˜çº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•ï¼Œä»»æ„æ—¶åˆ»ï¼Œä¸€æ¡ Java è™šæ‹Ÿæœºçº¿ç¨‹åªä¼šæ‰§è¡Œä¸€ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå…¶åœ°å€è¢«å­˜åœ¨ PC å¯„å­˜å™¨ä¸­ã€‚</li><li><strong>Java è™šæ‹Ÿæœºæ ˆ</strong>ï¼šç”¨æ¥å­˜å‚¨æ ˆå¸§ï¼Œæ ˆå¸§å­˜å‚¨äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥å’Œæ–¹æ³•è¿”å›åœ°å€ç­‰ä¿¡æ¯</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼šç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•ï¼ˆéjavaä»£ç çš„æ¥å£ï¼‰çš„è°ƒç”¨</li></ol><h3 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h3><p>æŒ‡è™šæ‹Ÿæœºå°†å­—èŠ‚ç è¯»å–è¿›å†…å­˜ï¼Œä»è€Œè¿›è¡Œè§£æã€è¿è¡Œç­‰æ•´ä¸ªè¿‡ç¨‹</p><p>ç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºï¼š<strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨ã€å¸è½½</strong></p><p>åŠ è½½ï¼š</p><p>â€‹æŠŠä»£ç æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­</p><p>éªŒè¯ï¼š</p><p>â€‹æ ¡éªŒClasså­—èŠ‚ç æ–‡ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆJVMè§„èŒƒï¼ŒåŠ è½½å®Œå­—èŠ‚ç ååœ¨å†…å­˜ä¸­åˆ›å»ºå¯¹åº”çš„Classå¯¹è±¡ï¼Œä¹‹åæ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯</p><p><strong>å‡†å¤‡</strong>ï¼š</p><p>â€‹ç»™ç±»åˆ†é…å†…å­˜ï¼Œåªä¼šå…ˆç»™staticä¿®é¥°çš„å˜é‡åˆ†é…å†…å­˜å¹¶èµ‹äºˆå¯¹åº”ç±»å‹çš„0å€¼(0, â€œâ€, false,null)ï¼Œè€Œä¿®é¥°äº†finalçš„è¯åˆ™ç›´æ¥èµ‹äºˆç”¨æˆ·å¸Œæœ›çš„å€¼</p><p>è§£æï¼š</p><p>â€‹å°†å¼•ç”¨åœ¨å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å…¶åœ¨å†…å­˜ä¸­çš„ç›´æ¥å¼•ç”¨</p><p><strong>åˆå§‹åŒ–</strong>ï¼š</p><p>â€‹JVM ä¼šæ ¹æ®<strong>è¯­å¥æ‰§è¡Œé¡ºåº</strong>å¯¹ç±»å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–</p><p>â€‹ç±»åˆå§‹åŒ–ï¼šç»™é™æ€å˜é‡èµ‹å€¼ï¼Œæ‰§è¡Œé™æ€ä»£ç å—ï¼Œæœ‰çˆ¶ç±»ä¼šå…ˆç±»åˆå§‹åŒ–çˆ¶ç±»ï¼Œmainå‡½æ•°æ‰€åœ¨ç±»ä¼šè¢«ç±»åˆå§‹åŒ–</p><p>â€‹å¯¹è±¡åˆå§‹åŒ–ï¼šä¼šå…ˆç±»åˆå§‹åŒ–ã€‚ç»™æˆå‘˜å˜é‡èµ‹å€¼ï¼Œæ‰§è¡Œæ™®é€šä»£ç å—ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°</p><p>â€‹æ•´ä½“ä¸Šå°±æ˜¯æƒ°æ€§åˆå§‹åŒ–ï¼Œåªæœ‰ç”¨åˆ°æ—¶æ‰è¿›è¡Œåˆå§‹åŒ–</p><p>ä½¿ç”¨ï¼š</p><p>â€‹JVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç </p><p>å¸è½½ï¼š</p><p>â€‹æ‰§è¡Œå®Œç¨‹åºï¼Œé”€æ¯Classå¯¹è±¡ï¼Œæœ€åJVMä¹Ÿé€€å‡ºå†…å­˜</p><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><blockquote><p>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œåˆ™ä¼šè¢«å½“åšåƒåœ¾è€Œå›æ”¶ã€‚</p></blockquote><h4 id="å¦‚ä½•çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨"><a href="#å¦‚ä½•çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨" class="headerlink" title="å¦‚ä½•çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨"></a>å¦‚ä½•çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å¼•ç”¨</h4><ol><li><p>è®¡æ•°æ–¹æ³•ï¼ˆå·²æ·˜æ±°ï¼‰ï¼šå¯¹è±¡è¢«å¼•ç”¨æ—¶å°±+1ï¼Œä¸å†å¼•ç”¨å°±-1ã€‚å­˜åœ¨çš„é—®é¢˜ï¼š**å¾ªç¯å¼•ç”¨(**Aå¼•ç”¨Bï¼ŒBå¼•ç”¨Aï¼Œä½†æ²¡æœ‰è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œä¸¤è€…å¼•ç”¨éƒ½ä¸ä¸º0ï¼Œæ— æ³•è¢«å›æ”¶)</p></li><li><p>å¯è¾¾æ€§ç®—æ³•<strong>GC Root Tracing</strong>ï¼šä» GC Root å‡ºå‘ï¼Œæ‰€æœ‰å¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„å¯¹è±¡ï¼Œä¸å¯è¾¾çš„ä¸ºåƒåœ¾ã€‚</p><p>GC Root å°±æ˜¯ä¸€ç»„æ´»è·ƒå¼•ç”¨çš„é›†åˆï¼Œé€šå¸¸GC RootåŒ…æ‹¬ï¼š</p><ul><li>æ‰€æœ‰å½“å‰è¢«åŠ è½½çš„ Java ç±»</li><li>Java ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li><li>Javaç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„å¼•ç”¨ç±»å‹å¸¸é‡</li><li>VMçš„ä¸€äº›é™æ€æ•°æ®ç»“æ„é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨</li><li>ç­‰ç­‰</li></ul></li></ol><h4 id="å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶"><a href="#å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶" class="headerlink" title="å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶"></a>å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶</h4><ol><li><strong>æ ‡è®°æ¸…é™¤æ³•</strong>ï¼šæ ‡è®°æ‰€æœ‰ç”± GC Root è§¦å‘çš„å¯è¾¾å¯¹è±¡ï¼Œæ¸…é™¤æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚ç¼ºç‚¹ï¼šä¼šæœ‰äº§ç”Ÿå†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚</li><li><strong>å¤åˆ¶ç®—æ³•</strong>ï¼šå°†åŸæœ‰çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ï¼Œåƒåœ¾å›æ”¶æ—¶å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œæ¸…é™¤å½“å‰å—å†…æ‰€æœ‰å¯¹è±¡ã€‚ç¼ºç‚¹ï¼šå†…å­˜æ²¡æœ‰è¢«å®Œå…¨ä½¿ç”¨ã€‚</li><li><strong>æ ‡è®°å‹ç¼©ç®—æ³•</strong>ï¼šä¸Šé¢ä¸¤ç§æ–¹æ³•çš„ç»“åˆã€‚æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå¤åˆ¶åˆ°å†…å­˜çš„ä¸€è¾¹ï¼Œæ¸…ç©ºå‰©ä½™åŒºåŸŸã€‚</li></ol><p>å®é™…æ˜¯æ¯ç§æ–¹æ³•ç»“åˆç€ç”¨ã€‚æ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡è¾ƒå°‘ï¼Œé€‚åˆå¤åˆ¶ç®—æ³•ï¼›è€å¹´ä»£å­˜æ´»å¯¹è±¡å¤šï¼Œé€‚åˆæ ‡è®°æ¸…é™¤æ³•æˆ–æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œå‡å°‘å¯¹è±¡çš„ç§»åŠ¨ã€‚</p><h4 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h4><p><strong>Minor GC&#x2F;Young GC</strong>ï¼šä»å¹´è½»ä»£ç©ºé—´å›æ”¶å†…å­˜</p><p><strong>Major GC&#x2F;Old GC</strong>ï¼šä»è€å¹´ä»£ç©ºé—´å›æ”¶å†…å­˜</p><p><strong>Full GC</strong>ï¼šæ¸…ç†å¹´è½»ä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼Œå½“å‘ç°å¹´è½»ä»£ç©ºé—´å¤ªå°æˆ–æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³æ—¶ä¼šè§¦å‘</p><p><strong>Stop-The-World</strong>ï¼šåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶å› ä¸ºæ ‡è®°æˆ–æ¸…ç†çš„éœ€è¦ï¼Œå¿…é¡»è®©æ‰€æœ‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹åœæ­¢æ‰§è¡Œä»»åŠ¡ï¼Œä»è€Œè®©åƒåœ¾å›æ”¶çº¿ç¨‹å›æ”¶åƒåœ¾çš„æ—¶é—´é—´éš”</p><h3 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h3><h4 id="ä¸²è¡Œå›æ”¶å™¨ï¼ˆSerialï¼‰"><a href="#ä¸²è¡Œå›æ”¶å™¨ï¼ˆSerialï¼‰" class="headerlink" title="ä¸²è¡Œå›æ”¶å™¨ï¼ˆSerialï¼‰"></a><strong>ä¸²è¡Œå›æ”¶å™¨ï¼ˆSerialï¼‰</strong></h4><p>æŒ‡ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶çš„å›æ”¶å™¨</p><p><strong>åˆ†ç±»</strong></p><ol><li><strong>æ–°ç”Ÿä»£ä¸²è¡Œå›æ”¶å™¨</strong>ï¼šé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œåƒåœ¾å›æ”¶æ—¶å…¶ä»–çº¿ç¨‹éœ€è¦æš‚åœï¼ˆ<strong>Stop-The-World</strong>ï¼‰</li><li><strong>è€å¹´ä»£ä¸²è¡Œå›æ”¶å™¨</strong>ï¼šé‡‡ç”¨æ ‡è®°å‹ç¼©ç®—æ³•ï¼Œä¹Ÿä¼šStop-The-Worldï¼Œå¯ä»¥ä¸å¤šç§æ–°ç”Ÿä»£å›æ”¶å™¨é…åˆä½¿ç”¨</li></ol><p><strong>å‚æ•°</strong></p><ul><li><p><code>-XX:UseSerialGC</code>ï¼šæ–°ç”Ÿä»£ã€è€å¹´ä»£éƒ½ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</p></li><li><p><code>-XX:UseParNewGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParNew å›æ”¶å™¨ï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</p></li><li><p><code>-XX:UseParallelGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParallelGC å›æ”¶å™¨ï¼ˆå¤šçº¿ç¨‹ï¼‰ï¼Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</p></li></ul><h4 id="å¹¶è¡Œå›æ”¶å™¨ï¼ˆParallelï¼‰"><a href="#å¹¶è¡Œå›æ”¶å™¨ï¼ˆParallelï¼‰" class="headerlink" title="å¹¶è¡Œå›æ”¶å™¨ï¼ˆParallelï¼‰"></a>å¹¶è¡Œå›æ”¶å™¨ï¼ˆParallelï¼‰</h4><p>æŒ‡ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯ä»¥æœ‰æ•ˆç¼©çŸ­åƒåœ¾å›æ”¶æ‰€ä½¿ç”¨çš„æ—¶é—´</p><p><strong>åˆ†ç±»</strong></p><ol><li><p><strong>æ–°ç”Ÿä»£ParNew å›æ”¶å™¨</strong>ï¼šåªæ˜¯ç®€å•åœ°å°†ä¸²è¡Œå›æ”¶å™¨å¤šçº¿ç¨‹åŒ–</p><p><strong>å¯åŠ¨å‚æ•°</strong></p><ul><li><code>-XX:+UseParNewGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParNew å›æ”¶å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</li><li><code>-XX:UseConcMarkSweepGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParNew å›æ”¶å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ CMSã€‚</li><li><code>-XX:ParallelGCThreads</code>ï¼šæŒ‡å®š ParNew å›æ”¶å™¨çš„å·¥ä½œçº¿ç¨‹æ•°é‡ã€‚</li></ul></li><li><p><strong>æ–°ç”Ÿä»£ Parallel GC å›æ”¶å™¨</strong>ï¼šç›¸æ¯”äºParNewæ›´åŠ <strong>æ³¨é‡ç³»ç»Ÿçš„ååé‡</strong></p><p><strong>è®¾ç½®å‚æ•°</strong></p><ul><li><code>-XX:+UseAdaptiveSizePolicy</code>ï¼šè‡ªåŠ¨è°ƒèŠ‚æ–°ç”Ÿä»£çš„å¤§å°ã€Eden å’Œ Survivor çš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ç­‰å‚æ•°</li><li><code>-XX:MaxGCPauseMillis</code>ï¼šè®¾ç½®æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li><li><code>-XX:GCTimeRatio</code>ï¼šè®¾ç½®ååé‡å¤§å°</li></ul><p><strong>å¯åŠ¨å‚æ•°</strong></p><ul><li><code>-XX:+UseParallelGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ Parallel å›æ”¶å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨ã€‚</li><li><code>-XX:+UseParallelOldGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParallelGC å›æ”¶å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ ParallelOldGC å›æ”¶å™¨ã€‚</li></ul></li><li><p><strong>è€å¹´ä»£ ParallelOldGC å›æ”¶å™¨</strong>ï¼šæ³¨é‡ååé‡çš„è€å¹´ä»£çš„å›æ”¶å™¨</p><p><strong>å¯åŠ¨å‚æ•°</strong></p><ul><li><code>-XX:UseParallelOldGC</code>ï¼šæ–°ç”Ÿä»£ä½¿ç”¨ ParallelGC å›æ”¶å™¨ï¼Œè€å¹´ä»£ä½¿ç”¨ ParallelOldGC å›æ”¶å™¨ã€‚</li></ul></li></ol><blockquote><p>jdk1.8 é»˜è®¤åƒåœ¾æ”¶é›†å™¨Parallel Scavengeï¼ˆæ–°ç”Ÿä»£ï¼‰+Parallel Oldï¼ˆè€å¹´ä»£ï¼‰</p></blockquote><h4 id="CMS-å›æ”¶å™¨"><a href="#CMS-å›æ”¶å™¨" class="headerlink" title="CMS å›æ”¶å™¨"></a>CMS å›æ”¶å™¨</h4><p>Concurrent Mark Sweepï¼ˆå¹¶å‘æ ‡è®°æ‰«æï¼‰ï¼ŒCMS å›æ”¶å™¨ä¸»è¦<strong>å…³æ³¨ç³»ç»Ÿåœé¡¿æ—¶é—´</strong></p><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><p>â€‹<strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°æ‰€æœ‰çš„æ ¹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ ¹å¯¹è±¡ç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥åŠè¢«å¹´è½»ä»£ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡æ‰€å¼•ç”¨çš„è€å¹´ä»£å¯¹è±¡ï¼Œä¼šStop-The-Worldï¼Œæ—¶é—´çŸ­</p><p>â€‹<strong>å¹¶å‘æ ‡è®°</strong>ï¼šæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œæ—¶é—´é•¿ï¼Œå’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œã€‚<strong>æ­¤é˜¶æ®µç”±äºä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå¯¹è±¡çš„çŠ¶æ€å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–</strong>ï¼ŒJVMä¼šå°†æ”¹å˜çš„åŒºåŸŸæ ‡è®°ä¸ºâ€œè„â€åŒºï¼ˆå¡ç‰‡æ ‡è®°ï¼‰</p><p>â€‹<strong>å¹¶å‘é¢„æ¸…ç†</strong>ï¼šæ ‡è®°è€å¹´ä»£å­˜æ´»çš„å¯¹è±¡ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©é‡æ–°æ ‡è®°é˜¶æ®µçš„STWå°½å¯èƒ½çŸ­ï¼Œå’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œã€‚</p><p>â€‹<code>-XX:-CMSPrecleaningEnabled</code>ï¼šå…³é—­å¹¶å‘é¢„å¤„ç†</p><p>â€‹<strong>æœ€ç»ˆæ ‡è®°&#x2F;é‡æ–°æ ‡è®°</strong>ï¼šé‡æ–°æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œä¹‹å‰çš„æ‰«æéƒ½æ˜¯å¹¶å‘çš„ï¼Œå¯èƒ½è·Ÿä¸ä¸Šä¿®æ”¹é€Ÿåº¦ã€‚ç›®æ ‡æ˜¯å®Œæˆè€å¹´ä»£ä¸­æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„æ ‡è®°ï¼Œä¼šè§¦å‘Stop The World</p><p>â€‹<strong>å¹¶å‘æ¸…é™¤å’Œå¹¶å‘é‡ç½®</strong>ï¼šç”¨æˆ·çº¿ç¨‹è¢«é‡æ–°æ¿€æ´»ï¼Œä¸éœ€è¦STWï¼Œç›®æ ‡æ˜¯åˆ é™¤ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œå¹¶ä¸ºä¸‹æ¬¡GCåšå‡†å¤‡</p><h4 id="G1å›æ”¶å™¨"><a href="#G1å›æ”¶å™¨" class="headerlink" title="G1å›æ”¶å™¨"></a>G1å›æ”¶å™¨</h4><p>â€‹G1ï¼ˆ<strong>Garbage First</strong>ï¼Œåƒåœ¾ä¼˜å…ˆï¼‰</p><p>â€‹ JDK 1.7 ä¸­ä½¿ç”¨çš„å…¨æ–°åƒåœ¾å›æ”¶å™¨ï¼ŒJDK9ä¹‹åçš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨ï¼Œæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨</p><p>â€‹<img src="/img/jvm_img/G1%E5%9B%9E%E6%94%B6%E5%99%A8.png"></p><p>â€‹åœ¨ G1 å›æ”¶å™¨ä¸­ï¼ŒæŠŠå †å†…å­˜åˆ†å‰²ä¸ºå¾ˆå¤šä¸ç›¸å…³çš„åŒºåŸŸ(regionç‰©ç†ä¸Šä¸è¿ç»­),æŠŠå †åˆ†ä¸º2048ä¸ªåŒºåŸŸã€‚ç”¨ä¸åŒçš„regionå¯ä»¥æ¥è¡¨ç¤ºEdenã€å¹¸å­˜è€…0åŒºã€å¹¸å­˜è€…1åŒºã€è€å¹´ä»£ç­‰ï¼ŒG1å›æ”¶å™¨ä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Region</p><p><strong>åˆ†åŒºRegion</strong></p><ul><li>æ¯ä¸ªRegionå—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”ä¸º2çš„Næ¬¡å¹‚ã€‚å¯é€šè¿‡<code>-XX :G1HeapRegionSize</code>è®¾å®šå¤§å°</li><li><strong>Humongous</strong>å†…å­˜åŒºåŸŸä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡1.5ä¸ªregion, å°±æ”¾åˆ°H</li></ul><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><ul><li>æ–°ç”Ÿä»£ GCï¼ˆYoung GCï¼‰ï¼šå¯åŠ¨å¤šçº¿ç¨‹æ‰§è¡Œå¹´è½»ä»£å›æ”¶ï¼Œä¼šSTW</li><li>è€å¹´ä»£å¹¶å‘æ ‡è®°å‘¨æœŸï¼ˆConcurrent Markingï¼‰ï¼šæ‰€æœ‰å°†è¦è¢«å›æ”¶çš„åŒºåŸŸä¼šè¢« G1 è®°å½•åœ¨ä¸€ä¸ªç§°ä¹‹ä¸º Collection Set çš„é›†åˆä¸­</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šé¦–å…ˆé’ˆå¯¹ Collection Set ä¸­çš„å†…å­˜è¿›è¡Œå›æ”¶ï¼Œåœ¨æ··åˆå›æ”¶çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ‰§è¡Œå¤šæ¬¡æ–°ç”Ÿä»£ GC å’Œ æ··åˆ GC</li><li>å¦‚æœéœ€è¦ï¼Œå¯èƒ½è¿›è¡Œ FullGC</li></ul><h3 id="JVMå‚æ•°"><a href="#JVMå‚æ•°" class="headerlink" title="JVMå‚æ•°"></a>JVMå‚æ•°</h3><h4 id="å †æ ˆç©ºé—´é…ç½®"><a href="#å †æ ˆç©ºé—´é…ç½®" class="headerlink" title="å †æ ˆç©ºé—´é…ç½®"></a>å †æ ˆç©ºé—´é…ç½®</h4><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-Xms</td><td align="center">åˆå§‹å †å¤§å°</td></tr><tr><td align="center">-Xmx</td><td align="center">æœ€å¤§å †ç©ºé—´</td></tr><tr><td align="center">-Xmn</td><td align="center">è®¾ç½®æ–°ç”Ÿä»£å¤§å°</td></tr><tr><td align="center">-XX:SurvivorRatio</td><td align="center">è®¾ç½®æ–°ç”Ÿä»£edenç©ºé—´å’Œfrom&#x2F;toç©ºé—´çš„æ¯”ä¾‹å…³ç³»</td></tr><tr><td align="center">-XX:PermSize</td><td align="center">æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰åˆå§‹å¤§å°ï¼ˆJDK1.7ï¼‰</td></tr><tr><td align="center">-XX:MaxPermSize</td><td align="center">æ–¹æ³•ï¼ˆæ°¸ä¹…ä»£ï¼‰åŒºæœ€å¤§å¤§å°ï¼ˆJDK1.7ï¼‰</td></tr><tr><td align="center">-XX:MetaspaceSize</td><td align="center">å…ƒç©ºé—´GCé˜ˆå€¼ï¼ˆJDK1.8ï¼‰</td></tr><tr><td align="center">-XX:MaxMetaspaceSize</td><td align="center">æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼ˆJDK1.8ï¼‰</td></tr><tr><td align="center">-Xss</td><td align="center">æ ˆå¤§å°</td></tr><tr><td align="center">-XX:MaxDirectMemorySize</td><td align="center">ç›´æ¥å†…å­˜å¤§å°ï¼Œé»˜è®¤ä¸ºæœ€å¤§å †ç©ºé—´</td></tr><tr><td align="center">-XX:+PrintGCDetails</td><td align="center">æŸ¥çœ‹å†…å­˜åŒºåŸŸçš„åˆ†é…ä¿¡æ¯</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p><strong>å †é…ç½®</strong></p><p><code>java -Xms20m -Xmx30m</code>ï¼šè®¾ç½® JVM çš„åˆå§‹å †å¤§å°ä¸º 20Mï¼Œæœ€å¤§å †ç©ºé—´ä¸º 30M</p><p><code>java -Xms20m -Xmn10M</code>ï¼šè®¾ç½® JVM å †åˆå§‹å¤§å°ä¸º20Mï¼Œå…¶ä¸­å¹´è½»ä»£çš„å¤§å°ä¸º 10M</p><p><code>java -Xms20m -Xmn10M -XX:SurvivorRatio=2 -XX:+PrintGCDetails</code>ï¼šè®¾ç½® JVM å †åˆå§‹å¤§å°ä¸º20Mï¼›å¹´è½»ä»£çš„å¤§å°ä¸º 10Mï¼Œå…¶ä¸­æ¯”ä¾‹ä¸ºeden &#x2F; from &#x3D; eden &#x2F; to &#x3D; 2ï¼Œå³5Mï¼š2.5Mï¼š2.5Mï¼›æ‰“å°å†…å­˜åŒºåŸŸçš„åˆ†é…ä¿¡æ¯</p><p><code>java -XX:PermSize10m -XX:MaxPermSize50m -XX:+PrintGCDetails</code>ï¼šï¼ˆjdk1.7ï¼‰è®¾ç½®æ°¸ä¹…ä»£åˆå§‹å¤§å°ä¸º10Mï¼Œæœ€å¤§50M</p><p><code>java -XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=50m -XX:+PrintGCDetails</code>ï¼šè®¾ç½®å…ƒç©ºé—´å‘ç”Ÿ GC çš„åˆå§‹é˜ˆå€¼ä¸º10Mï¼Œå…ƒç©ºé—´æœ€å¤§å¤§å°ä¸º50Mï¼Œé»˜è®¤ä¸ºæœºå™¨å†…å­˜å¤§å°</p><p><strong>æ ˆé…ç½®</strong></p><p><code>java -Xss2m</code>ï¼šè®¾ç½®æ ˆç©ºé—´æœ€å¤§ä¸º2M</p><p><code>java -XX:MaxDirectMemorySize=50m</code>:è®¾ç½®ç›´æ¥å†…å­˜å¤§å°ä¸º50M</p><h4 id="æŸ¥çœ‹å‚æ•°"><a href="#æŸ¥çœ‹å‚æ•°" class="headerlink" title="æŸ¥çœ‹å‚æ•°"></a>æŸ¥çœ‹å‚æ•°</h4><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-XX:+PrintVMOptions</td><td align="center">ç¨‹åºè¿è¡Œæ—¶ï¼Œæ‰“å°è™šæ‹Ÿæœºæ¥å—åˆ°çš„å‘½ä»¤è¡Œæ˜¾å¼å‚æ•°ã€‚</td></tr><tr><td align="center">XX:+PrintCommandLineFlags</td><td align="center">æ‰“å°ä¼ é€’ç»™è™šæ‹Ÿæœºçš„æ˜¾å¼å’Œéšå¼å‚æ•°ã€‚</td></tr><tr><td align="center">-XX:+PrintFlagsFinal</td><td align="center">æ‰“å°æ‰€æœ‰çš„ç³»ç»Ÿå‚æ•°çš„å€¼</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p><code>java  -XX:+UseSerialGC -XX:+PrintVMOptions</code>ï¼šæ‰“å°æ˜¾ç¤ºå‚æ•°ï¼ˆè‡ªå·±è®¾å®šçš„å‚æ•°ï¼‰</p><p><code>java  -XX:+UseSerialGC -XX:+PrintCommandLineFlags</code>: æ‰“å°æ˜¾å¼å’Œéšå¼å‚æ•°ï¼ˆé»˜è®¤å‚æ•°ï¼‰</p><p><code>java  -XX:+UseSerialGC -XX:+PrintFlagsFinal æ–‡ä»¶å  &gt; jvm_flag_final.txt</code>ï¼šæ‰“å°æ‰€æœ‰ç³»ç»Ÿå‚æ•°å¹¶é‡å®šå‘åˆ°</p><p>jvm_flag_final.txtæ–‡ä»¶ä¸­</p><h4 id="è¿½è¸ªç±»ä¿¡æ¯å‚æ•°"><a href="#è¿½è¸ªç±»ä¿¡æ¯å‚æ•°" class="headerlink" title="è¿½è¸ªç±»ä¿¡æ¯å‚æ•°"></a>è¿½è¸ªç±»ä¿¡æ¯å‚æ•°</h4><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-verbose:class</td><td align="center">è·Ÿè¸ªç±»çš„åŠ è½½å’Œå¸è½½</td></tr><tr><td align="center">-XX:+TraceClassLoading</td><td align="center">è·Ÿè¸ªç±»çš„åŠ è½½</td></tr><tr><td align="center">-XX:+TraceClassUnloading</td><td align="center">è·Ÿè¸ªç±»çš„å¸è½½</td></tr><tr><td align="center">-XX:+PrintClassHistogram</td><td align="center">æ˜¾ç¤ºç±»ä¿¡æ¯æŸ±çŠ¶å›¾</td></tr></tbody></table><h4 id="GCæ—¥å¿—å‚æ•°"><a href="#GCæ—¥å¿—å‚æ•°" class="headerlink" title="GCæ—¥å¿—å‚æ•°"></a>GCæ—¥å¿—å‚æ•°</h4><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center"><strong>-XX:PrintGC</strong></td><td align="center">æ‰“å°GCæ—¥å¿—</td></tr><tr><td align="center"><strong>-XX:+PrintGCDetails</strong></td><td align="center">æ‰“å°è¯¦ç»†çš„GCæ—¥å¿—ã€‚è¿˜ä¼šåœ¨é€€å‡ºå‰æ‰“å°å †çš„è¯¦ç»†ä¿¡æ¯ã€‚</td></tr><tr><td align="center">-XX:+PrintHeapAtGC</td><td align="center">æ¯æ¬¡GCå‰åæ‰“å°å †ä¿¡æ¯ã€‚</td></tr><tr><td align="center">-XX:+PrintGCTimeStamps</td><td align="center">æ‰“å°GCå‘ç”Ÿçš„æ—¶é—´ã€‚</td></tr><tr><td align="center">-XX:+PrintGCApplicationConcurrentTime</td><td align="center">æ‰“å°åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ—¶é—´</td></tr><tr><td align="center">-XX:+PrintGCApplicationStoppedTime</td><td align="center">æ‰“å°åº”ç”¨ç”±äºGCè€Œäº§ç”Ÿçš„åœé¡¿æ—¶é—´</td></tr><tr><td align="center">-XX:+PrintReferenceGC</td><td align="center">è·Ÿè¸ªè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å’ŒFinallizeé˜Ÿåˆ—ã€‚</td></tr><tr><td align="center">-XLoggc</td><td align="center">å°†GCæ—¥å¿—ä»¥æ–‡ä»¶å½¢å¼è¾“å‡ºã€‚</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p><code>java -XX:+UseSerialGC -Xms20M -Xmx20M -Xmn10M -XX:SurvivorRatio=8 -XX:+PrintGC Demo</code>ï¼šæ‰“å°ç®€å•æ—¥å¿—</p><ul><li>-XX:+UseSerialGC è¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨Serial+SerialOldæ”¶é›†å™¨ç»„åˆ</li><li>-Xms20m è¡¨ç¤ºå †ç©ºé—´åˆå§‹å¤§å°ä¸º 20 Mã€‚</li><li>-Xmx20m è¡¨ç¤ºå †ç©ºé—´æœ€å¤§å¤§å°ä¸º 20 Mã€‚</li><li>-Xmn10m è¡¨ç¤ºæ–°ç”Ÿä»£å¤§å°ä¸º 10Mã€‚</li><li>-XX:SurvivorRatio&#x3D;8 è¡¨ç¤ºEden:Survivor&#x3D;8:1</li><li>-XX:PrintGC æ‰“å°GCæ—¥å¿—</li></ul><p>â€‹<img src="/img/jvm_img/GC%E5%8F%82%E6%95%B01.png" alt="å›æ”¶å‰-&gt;å›æ”¶å(å¯ç”¨)"></p><h3 id="æ€§èƒ½ç›‘æ§"><a href="#æ€§èƒ½ç›‘æ§" class="headerlink" title="æ€§èƒ½ç›‘æ§"></a>æ€§èƒ½ç›‘æ§</h3><h4 id="jpsæŒ‡ä»¤"><a href="#jpsæŒ‡ä»¤" class="headerlink" title="jpsæŒ‡ä»¤"></a>jpsæŒ‡ä»¤</h4><p>jpsï¼ˆJava Virtual Machine Process Status Toolï¼‰ï¼šåˆ—å‡ºæ‰€æœ‰çš„ Java è¿›ç¨‹</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-q</td><td align="center">æŒ‡å®šjpsåªè¾“å‡ºè¿›ç¨‹ID</td></tr><tr><td align="center">-m</td><td align="center">è¾“å‡ºä¼ é€’ç»™Javaè¿›ç¨‹çš„å‚æ•°</td></tr><tr><td align="center">-l</td><td align="center">è¾“å‡ºä¸»å‡½æ•°çš„å®Œæ•´è·¯å¾„</td></tr><tr><td align="center">-v</td><td align="center">æ˜¾ç¤ºä¼ é€’ç»™Javaè™šæ‹Ÿæœºçš„å‚æ•°</td></tr></tbody></table><h4 id="jstatæŒ‡ä»¤"><a href="#jstatæŒ‡ä»¤" class="headerlink" title="jstatæŒ‡ä»¤"></a>jstatæŒ‡ä»¤</h4><p>jstateï¼ˆJava Virtual Machine Statistics Monitoring Toolï¼‰ï¼šè§‚å¯Ÿ Java å †ä¿¡æ¯çš„è¯¦ç»†æƒ…å†µ</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-class</td><td align="center">ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—è´¹çš„æ—¶é—´</td></tr><tr><td align="center">-gc</td><td align="center">ç›‘è§†Javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰çš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GCæ—¶é—´åˆè®¡ç­‰ä¿¡æ¯</td></tr><tr><td align="center">-gccapacity</td><td align="center">ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td align="center">-gcutil</td><td align="center">ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”</td></tr><tr><td align="center">-gccause</td><td align="center">ä¸-gcutilåŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ä¸Šä¸€æ¬¡GCäº§ç”Ÿçš„åŸå› </td></tr><tr><td align="center">-gcnew</td><td align="center">ç›‘è§†æ–°ç”Ÿä»£GCçŠ¶å†µ</td></tr><tr><td align="center">-gcnewcapacity</td><td align="center">ç›‘è§†å†…å®¹ä¸-gcnewåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td align="center">-gcold</td><td align="center">ç›‘è§†è€å¹´ä»£GCçŠ¶å†µ</td></tr><tr><td align="center">-gcoldcapacity</td><td align="center">ç›‘è§†å†…å®¹ä¸-gcoldåŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td align="center">-gcpermcapacity</td><td align="center">è¾“å‡ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td align="center">-compiler</td><td align="center">è¾“å‡ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ä¿¡æ¯</td></tr><tr><td align="center">-printcompilation</td><td align="center">è¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p><code>jstat -gcutil 2366 </code>ï¼šæŸ¥çœ‹javaè¿›ç¨‹2366çš„å †ä½¿ç”¨æƒ…å†µ</p><h4 id="jinfoæŒ‡ä»¤"><a href="#jinfoæŒ‡ä»¤" class="headerlink" title="jinfoæŒ‡ä»¤"></a>jinfoæŒ‡ä»¤</h4><p>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„æ‰©å±•å‚æ•°</p><h4 id="jmap-å‘½ä»¤"><a href="#jmap-å‘½ä»¤" class="headerlink" title="jmap å‘½ä»¤"></a>jmap å‘½ä»¤</h4><p>å¯ä»¥ç”Ÿæˆ Java ç¨‹åºçš„ Dump æ–‡ä»¶ï¼ˆå½“ç¨‹åºäº§ç”Ÿå¼‚å¸¸æ—¶ï¼Œç”¨æ¥è®°å½•å½“æ—¶çš„ç¨‹åºçŠ¶æ€ä¿¡æ¯ï¼‰ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹å †å†…å¯¹è±¡å®ä¾‹çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ ClassLoader çš„ä¿¡æ¯ä»¥åŠ finalizer é˜Ÿåˆ—</p><h4 id="jhat-å‘½ä»¤"><a href="#jhat-å‘½ä»¤" class="headerlink" title="jhat å‘½ä»¤"></a>jhat å‘½ä»¤</h4><p>ç”¨äºåˆ†æ Java åº”ç”¨çš„å¯¹å¿«ç…§å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥åˆ†æjmapç”Ÿæˆdumpæ–‡ä»¶</p><h2 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h2><h3 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1.æ¦‚å¿µ"></a>1.æ¦‚å¿µ</h3><p><strong>jvmåˆ†é…å†…å­˜ç»™å¯¹è±¡</strong></p><ul><li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼š</li></ul><p>â€‹ç»™å¯¹è±¡åˆ†é…å†…å­˜éƒ½åœ¨ä¸€è¾¹ï¼Œåˆ†é…å†…å­˜å°±æŠŠæŒ‡é’ˆç§»åŠ¨å¯¹è±¡å¤§å°çš„è·ç¦»</p><ul><li><strong>ç©ºé—´åˆ—è¡¨</strong>ï¼š</li></ul><p>â€‹ç±»ä¼¼ç©ºé—´åˆ†åŒºè¡¨</p><p><strong>å†…å­˜</strong></p><ul><li><p><strong>å†…å­˜æº¢å‡º</strong>ï¼ˆOOMï¼‰</p><p>ç”³è¯·çš„å†…å­˜è¶…è¿‡äº†å¯ç”¨å†…å­˜</p></li><li><p><strong>å†…å­˜æ³„æ¼</strong></p><p>å†…å­˜æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾</p></li></ul><h3 id="2-å¯¹è±¡åˆ›å»ºè¿‡ç¨‹"><a href="#2-å¯¹è±¡åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="2.å¯¹è±¡åˆ›å»ºè¿‡ç¨‹"></a>2.å¯¹è±¡åˆ›å»ºè¿‡ç¨‹</h3><p><img src="/img/else_img/%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B.png"></p><h3 id="3-å¯¹è±¡å†…å­˜å¸ƒå±€"><a href="#3-å¯¹è±¡å†…å­˜å¸ƒå±€" class="headerlink" title="3.å¯¹è±¡å†…å­˜å¸ƒå±€"></a>3.å¯¹è±¡å†…å­˜å¸ƒå±€</h3><ol><li><p>å¯¹è±¡å¤´ï¼š</p><ol><li><strong>Mark Word</strong>ï¼šå“ˆå¸Œç ã€åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ç­‰</li><li>ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘å½“å‰å¯¹è±¡æ˜¯å“ªä¸ªç±»</li></ol></li><li><p>å®ä¾‹æ•°æ®ï¼šå­˜æ”¾å­—æ®µçš„ä¿¡æ¯</p></li><li><p>å¡«å……å¯¹é½</p></li></ol><h3 id="4-åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»"><a href="#4-åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»" class="headerlink" title="4.åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»"></a>4.åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»</h3><ol><li><p>å¼•ç”¨è®¡æ•°</p><p>å¯¹è±¡ä¸­æ·»åŠ å¼•ç”¨è®¡æ•°å™¨ï¼Œè®°å½•å½“å‰å¼•ç”¨çš„æ¬¡æ•°ã€‚ç¼ºé™·ï¼šå¾ªç¯å¼•ç”¨</p></li><li><p><strong>å¯è¾¾æ€§åˆ†æ</strong></p><p>ä»GCRootså‡ºå‘ï¼Œæœç´¢å¯ä»¥åˆ°è¾¾çš„å¯¹è±¡å¹¶æ ‡è®°ï¼Œæ²¡æœ‰æ ‡è®°çš„å¯¹è±¡å°±æ˜¯å¯å›æ”¶çš„</p><blockquote><p>ä¸»è¦çš„GCRootsï¼š</p><p>1.è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</p><p>2.ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</p><p>3.å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</p><p>4.æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡</p></blockquote></li></ol><h3 id="5-å¼•ç”¨ç§ç±»"><a href="#5-å¼•ç”¨ç§ç±»" class="headerlink" title="5.å¼•ç”¨ç§ç±»"></a>5.å¼•ç”¨ç§ç±»</h3><ol><li><p>å¼ºå¼•ç”¨ï¼šä¸€å®šä¸ä¼šè¢«å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br></code></pre></td></tr></table></figure></li><li><p>è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³æ—¶å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-type">ReferenceQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>();<br><span class="hljs-type">SoftReference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>(obj, queue);<br></code></pre></td></tr></table></figure></li><li><p>å¼±å¼•ç”¨ï¼šåƒåœ¾å›æ”¶æ—¶å°±ä¼šè¢«å›æ”¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-type">ReferenceQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>();<br><span class="hljs-type">WeakReference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>(obj, queue);<br></code></pre></td></tr></table></figure></li><li><p>è™šå¼•ç”¨ï¼šä¸ºäº†èƒ½åœ¨è¿™ä¸ªå¯¹è±¡ è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-type">ReferenceQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>();<br><span class="hljs-type">PhantomReference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhantomReference</span>(obj, queue);<br></code></pre></td></tr></table></figure></li></ol><h3 id="6-åƒåœ¾å›æ”¶ç®—æ³•"><a href="#6-åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="6.åƒåœ¾å›æ”¶ç®—æ³•"></a>6.åƒåœ¾å›æ”¶ç®—æ³•</h3><ol><li>æ ‡è®°æ¸…é™¤</li><li>æ ‡è®°å¤åˆ¶ï¼šæ–°ç”Ÿä»£</li><li>æ ‡è®°æ•´ç†ï¼šè€å¹´ä»£</li></ol><h3 id="7-åƒåœ¾å›æ”¶è§¦å‘æ—¶æœº"><a href="#7-åƒåœ¾å›æ”¶è§¦å‘æ—¶æœº" class="headerlink" title="7.åƒåœ¾å›æ”¶è§¦å‘æ—¶æœº"></a>7.åƒåœ¾å›æ”¶è§¦å‘æ—¶æœº</h3><ol><li>Minor GCï¼ˆYoung GCï¼‰ï¼šEdenåŒºç©ºé—´ä¸è¶³æ—¶</li><li>Full GCï¼š<ol><li>Minor GC å‰åˆ¤æ–­ä»å¹´è½»ä»£å‡å…¥è€å¹´ä»£çš„å¯¹è±¡å¯èƒ½æ”¾ä¸ä¸‹æ—¶</li><li>Minor GC åå‘ç°æ”¾ä¸ä¸‹æ—¶</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶</li><li>æ™‹å‡&#x2F;æå‰æ™‹å‡çš„å¯¹è±¡åœ¨è€å¹´ä»£ä¸­æ”¾ä¸ä¸‹æ—¶</li><li>System.gc()</li></ol></li></ol><h3 id="8-æ™‹å‡è€å¹´ä»£æ—¶æœº"><a href="#8-æ™‹å‡è€å¹´ä»£æ—¶æœº" class="headerlink" title="8.æ™‹å‡è€å¹´ä»£æ—¶æœº"></a>8.æ™‹å‡è€å¹´ä»£æ—¶æœº</h3><ol><li>æ–°ç”Ÿä»£ä¸­å¯¹è±¡åˆ°è¾¾ä¸€å®šå¹´é¾„</li><li>å¤§å¯¹è±¡ç›´æ¥æ™‹å‡</li><li>åŠ¨æ€åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦æ™‹å‡</li><li>æŠŠMinorGCåä»ç„¶æ”¾ä¸ä¸‹çš„å¯¹è±¡æ”¾å…¥è€å¹´ä»£</li></ol><h3 id="9-ä¸»è¦åƒåœ¾æ”¶é›†å™¨ç§ç±»"><a href="#9-ä¸»è¦åƒåœ¾æ”¶é›†å™¨ç§ç±»" class="headerlink" title="9.ä¸»è¦åƒåœ¾æ”¶é›†å™¨ç§ç±»"></a>9.ä¸»è¦åƒåœ¾æ”¶é›†å™¨ç§ç±»</h3><ol><li>Serialæ”¶é›†å™¨ï¼ˆä¸²è¡Œæ”¶é›†å™¨ï¼‰ï¼šä¸€ä¸ªçº¿ç¨‹åƒåœ¾å›æ”¶ï¼Œæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹éœ€è¦åœä¸‹ï¼Œæ–°ç”Ÿä»£æ ‡è®°å¤åˆ¶ï¼Œè€å¹´ä»£æ ‡è®°æ•´ç†</li><li>ParNewï¼šå¤šä¸ªSerialæ”¶é›†å™¨ï¼Œæ–°ç”Ÿä»£å¹¶å‘ï¼Œè€å¹´ä»£è¿˜æ˜¯å•çº¿ç¨‹</li><li>Parallel Scavengeï¼ˆå¹¶è¡Œæ”¶é›†å™¨ï¼‰ï¼šæ³¨é‡ååé‡ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é•¿ï¼‰ï¼Œè€å¹´ä»£ä¹Ÿå¹¶å‘</li><li>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨ï¼ˆå¹¶å‘æ”¶é›†å™¨ï¼‰ï¼šè€å¹´ä»£æ”¶é›†å™¨ï¼Œä»¥æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œ<strong>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</strong></li><li>G1ï¼ˆGarbage Firstï¼‰æ”¶é›†å™¨ï¼ˆå¹¶å‘æ”¶é›†å™¨ï¼‰ï¼šå¼±åŒ–åˆ†ä»£ï¼Œè€Œæ˜¯åˆ†åŒºæ”¶é›†ï¼ˆä¼Šç”¸åŒºã€è¾›å­˜åŒºã€è€å¹´åŒºã€å¤§å¯¹è±¡åŒºï¼‰ï¼Œ<strong>è§£å†³å†…å­˜ç¢ç‰‡é—®é¢˜</strong></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RabbitMQ</title>
    <link href="/2023/02/15/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/"/>
    <url>/2023/02/15/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/</url>
    
    <content type="html"><![CDATA[<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><blockquote><p>RabbitMQæ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒæ˜¯è½»é‡çº§ä¸”æ˜“äºéƒ¨ç½²çš„ï¼Œå®ƒèƒ½æ”¯æŒå¤šç§æ¶ˆæ¯åè®®ã€‚RabbitMQå¯ä»¥éƒ¨ç½²åœ¨åˆ†å¸ƒå¼å’Œè”åˆé…ç½®ä¸­ï¼Œä»¥æ»¡è¶³é«˜è§„æ¨¡ã€é«˜å¯ç”¨æ€§çš„éœ€æ±‚ã€‚</p></blockquote><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ol><li><p>é¦–å…ˆéœ€è¦å®‰è£…Erlangç¯å¢ƒ</p><ul><li><p>Erlangç‰ˆæœ¬å’ŒRabbitMQç‰ˆæœ¬å¯¹ç…§ï¼š<a href="https://www.rabbitmq.com/which-erlang.html">RabbitMQ Erlang Version Requirements â€” RabbitMQ</a></p></li><li><p>ä¸‹è½½ï¼š<a href="https://www.erlang.org/downloads">Downloads - Erlang&#x2F;OTP</a> é€‰æ‹©å®‰è£…è·¯å¾„åä¸€è·¯next</p></li></ul></li><li><p>å®‰è£…RabbitMQ</p><ul><li><p>ä¸‹è½½ï¼š<a href="https://www.rabbitmq.com/download.html">Downloading and Installing RabbitMQ â€” RabbitMQ</a> é€‰æ‹©å®‰è£…è·¯å¾„åä¸€è·¯next</p></li><li><p>ä¸‹è½½å®Œè¿›å…¥sbinç›®å½•ï¼Œcmdçª—å£è¾“å…¥</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">rabbitmq-plugins <span class="hljs-built_in">enable</span> rabbitmq_management<br></code></pre></td></tr></table></figure><p>ä¸‹è½½æ’ä»¶</p></li><li><p>ç‚¹å‡»sbinç›®å½•ä¸‹çš„rabbitmq-service.batå¯åŠ¨</p></li><li><p>è®¿é—®ï¼š<a href="http://localhost:15672/">http://localhost:15672</a> æ‰“å¼€æ§åˆ¶é¢æ¿ï¼Œé»˜è®¤è´¦æˆ·ï¼šguestï¼Œé»˜è®¤å¯†ç ï¼šguest</p></li></ul></li></ol><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><p>è§å¾®æœåŠ¡&#x2F;æ¶ˆæ¯é˜Ÿåˆ—</p><h3 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h3><p>è¯¦ç»†è§å¾®æœåŠ¡&#x2F;æ¶ˆæ¯é˜Ÿåˆ—</p><h3 id="SpringBootæ•´åˆRabbitMQ"><a href="#SpringBootæ•´åˆRabbitMQ" class="headerlink" title="SpringBootæ•´åˆRabbitMQ"></a>SpringBootæ•´åˆRabbitMQ</h3><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>åŠŸèƒ½ï¼šä¸‹è®¢å•æ—¶å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°å»¶æ—¶é˜Ÿåˆ—ä¸­ï¼Œè‹¥è¶…æ—¶æœªä»˜æ¬¾åˆ™è½¬å‘æ¶ˆæ¯åˆ°çœŸæ­£å–æ¶ˆè®¢å•çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­</p><ol start="0"><li><p>åœ¨RabbitMQçš„æ§åˆ¶é¢æ¿åˆ›å»ºç”¨æˆ·ï¼Œè´¦å·å¯†ç ä¸ºmallï¼Œåˆ›å»ºè™šæ‹Ÿç›®å½•&#x2F;mallï¼Œç»™mallç”¨æˆ·&#x2F;mallçš„æ‰€æœ‰æƒé™</p></li><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--AMQP--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">rabbitmq:</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment"># rabbitmqçš„è¿æ¥åœ°å€</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span> <span class="hljs-comment"># rabbitmqçš„è¿æ¥ç«¯å£å·</span><br>        <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/mall</span> <span class="hljs-comment"># rabbitmqçš„è™šæ‹Ÿhost</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">mall</span> <span class="hljs-comment"># rabbitmqçš„ç”¨æˆ·å</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">mall</span> <span class="hljs-comment"># rabbitmqçš„å¯†ç </span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.dto;<br><br><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">QueueEnum</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¶ˆæ¯é€šçŸ¥é˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    QUEUE_ORDER_CANCEL(<span class="hljs-string">&quot;mall.order.direct&quot;</span>, <span class="hljs-string">&quot;mall.order.cancel&quot;</span>, <span class="hljs-string">&quot;mall.order.cancel&quot;</span>),<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¶ˆæ¯é€šçŸ¥ttlé˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    QUEUE_TTL_ORDER_CANCEL(<span class="hljs-string">&quot;mall.order.direct.ttl&quot;</span>, <span class="hljs-string">&quot;mall.order.cancel.ttl&quot;</span>, <span class="hljs-string">&quot;mall.order.cancel.ttl&quot;</span>);<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * äº¤æ¢åç§°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String exchange;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é˜Ÿåˆ—åç§°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·¯ç”±é”®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String routeKey;<br><br>    QueueEnum(String exchange, String name, String routeKey) &#123;<br>        <span class="hljs-built_in">this</span>.exchange = exchange;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.routeKey = routeKey;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.config;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®šä¹‰äº¤æ¢æœºå’Œæ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMqConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  è®¢å•æ¶ˆæ¯å®é™…æ¶ˆè´¹é˜Ÿåˆ—æ‰€ç»‘å®šçš„äº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">orderDirect</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (DirectExchange) ExchangeBuilder<br>            .directExchange(QueueEnum.QUEUE_ORDER_CANCEL.getExchange()) <span class="hljs-comment">// å®šå‘äº¤æ¢æœºï¼Œè®¾å®šåç§°</span><br>            .durable(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// æ˜¯å¦æŒä¹…åŒ–</span><br>            .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¢å•å»¶è¿Ÿé˜Ÿåˆ—é˜Ÿåˆ—æ‰€ç»‘å®šçš„äº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">orderTTLDirect</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (DirectExchange) ExchangeBuilder<br>            .directExchange(QueueEnum.QUEUE_TTL_ORDER_CANCEL.getExchange()) <span class="hljs-comment">// å®šå‘äº¤æ¢æœºï¼Œè®¾å®šåç§°</span><br>            .durable(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// æ˜¯å¦æŒä¹…åŒ–</span><br>            .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¢å•å®é™…æ¶ˆè´¹é˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(QueueEnum.QUEUE_ORDER_CANCEL.getName());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¢å•å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰</span><br><span class="hljs-comment">     * å½“è®¢å•è¶…æ—¶åè¢«è½¬å‘åˆ°è®¢å•é˜Ÿåˆ—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderTTLQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> QueueBuilder<br>            .durable(QueueEnum.QUEUE_TTL_ORDER_CANCEL.getName())<br>            .withArgument(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>, QueueEnum.QUEUE_ORDER_CANCEL.getExchange())<span class="hljs-comment">//åˆ°æœŸåè½¬å‘çš„äº¤æ¢æœº</span><br>            .withArgument(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>, QueueEnum.QUEUE_ORDER_CANCEL.getRouteKey())<span class="hljs-comment">//åˆ°æœŸåè½¬å‘çš„è·¯ç”±é”®</span><br>            .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†è®¢å•é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">orderBinding</span><span class="hljs-params">(DirectExchange orderDirect, Queue orderQueue)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder<br>            .bind(orderQueue)<br>            .to(orderDirect)<br>            .with(QueueEnum.QUEUE_ORDER_CANCEL.getRouteKey());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†è®¢å•å»¶è¿Ÿé˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    Binding <span class="hljs-title function_">orderTtlBinding</span><span class="hljs-params">(DirectExchange orderTTLDirect,Queue orderTTLQueue)</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder<br>            .bind(orderTTLQueue)<br>            .to(orderTTLDirect)<br>            .with(QueueEnum.QUEUE_TTL_ORDER_CANCEL.getRouteKey());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å–æ¶ˆè®¢å•æ¶ˆæ¯ç”Ÿäº§è€…</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancelOrderSender</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AmqpTemplate amqpTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Long orderId, <span class="hljs-keyword">final</span> Long delayTime)</span> &#123;<br>        <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†å™¨ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´</span><br>        <span class="hljs-type">MessagePostProcessor</span> <span class="hljs-variable">messagePostProcessor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePostProcessor</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">postProcessMessage</span><span class="hljs-params">(Message message)</span> <span class="hljs-keyword">throws</span> AmqpException &#123;<br>                message.getMessageProperties().setExpiration(String.valueOf(delayTime));<br>                <span class="hljs-keyword">return</span> message;<br>            &#125;<br>        &#125;;<br>        <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>        amqpTemplate.convertAndSend(QueueEnum.QUEUE_TTL_ORDER_CANCEL.getExchange(), <span class="hljs-comment">// å‘é€åˆ°çš„äº¤æ¢æœº</span><br>                QueueEnum.QUEUE_TTL_ORDER_CANCEL.getRouteKey(), <span class="hljs-comment">// è·¯ç”±Key</span><br>                orderId,    <span class="hljs-comment">// æ¶ˆæ¯</span><br>                messagePostProcessor    <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†å™¨</span><br>        );<br>        log.info(<span class="hljs-string">&quot;è®¢å•id:&#123;&#125;&quot;</span>, orderId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å–æ¶ˆè®¢å•æ¶ˆæ¯æ¶ˆè´¹è€…</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancelOrderReceiver</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> OmsPortalOrderService omsPortalOrderService;<br><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;mall.order.cancel&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Long orderId)</span> &#123;<br>        omsPortalOrderService.cancelOrder(orderId);<br>        log.info(<span class="hljs-string">&quot;å¤„ç†å–æ¶ˆè®¢å•æ¶ˆæ¯çš„id:&#123;&#125;&quot;</span>, orderId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>serviceå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OmsPortalOrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OmsPortalOrderService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> CancelOrderSender cancelOrderSender;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">generateOrder</span><span class="hljs-params">(OrderParam orderParam)</span> &#123;<br>        <span class="hljs-comment">// ä¸‹å•æ“ä½œï¼Œç”Ÿæˆè®¢å•å’Œè®¢å•id</span><br>        log.info(<span class="hljs-string">&quot;ä¸‹å•æ“ä½œ....&quot;</span>);<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> <span class="hljs-number">10L</span>;<br>        <span class="hljs-comment">// ä¸‹å®Œå•åå‘é€ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œè‹¥æœŸé—´æ²¡æœ‰ä»˜æ¬¾åˆ™å–æ¶ˆè®¢å•</span><br>        sendDelayMessageCancelOrder(orderId);<br>        <span class="hljs-keyword">return</span> CommonResult.success(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;ä¸‹å•æˆåŠŸ&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(Long orderId)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å–æ¶ˆè®¢å•ï¼Œid:&#123;&#125;&quot;</span>, orderId);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDelayMessageCancelOrder</span><span class="hljs-params">(Long orderId)</span> &#123;<br>        <span class="hljs-comment">// 30ç§’</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">delayTimes</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">1000L</span>;<br>        cancelOrderSender.sendMessage(orderId, delayTimes);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>controllerå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Api(tags = &quot;è®¢å•ç®¡ç†&quot;)</span><br><span class="hljs-meta">@RestController(&quot;/order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OmsPortalOrderController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> OmsPortalOrderService omsPortalOrderService;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;æ ¹æ®è´­ç‰©è½¦ä¿¡æ¯ç”Ÿæˆè®¢å•&quot;)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/generateOrder&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">generateOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderParam orderParam)</span> &#123;<br>        <span class="hljs-keyword">return</span> omsPortalOrderService.generateOrder(orderParam);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>RabbitMQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB</title>
    <link href="/2023/02/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/Mongodb/"/>
    <url>/2023/02/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/Mongodb/</url>
    
    <content type="html"><![CDATA[<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><blockquote><p>MongoDB æ˜¯ç”±C++è¯­è¨€ç¼–å†™çš„ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿã€‚</p><p>åœ¨é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯æœåŠ¡å™¨æ€§èƒ½ã€‚</p><p>MongoDB æ—¨åœ¨ä¸ºWEBåº”ç”¨æä¾›å¯æ‰©å±•çš„é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</p><p>MongoDB å°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ•°æ®ç»“æ„ç”±é”®å€¼(key&#x3D;&gt;value)å¯¹ç»„æˆã€‚MongoDB æ–‡æ¡£ç±»ä¼¼äº JSON å¯¹è±¡ã€‚å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ã€‚</p><p>Mongoæ˜¯ä¸€ç§NoSqlæ•°æ®åº“ï¼Œï¼š</p><p>1.å¯¹æ•°æ®åº“é«˜å¹¶å‘è¯»å†™ã€‚</p><p>2ã€å¯¹æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡å­˜å‚¨å’Œè®¿é—®ã€‚</p><p>3ã€å¯¹æ•°æ®åº“çš„é«˜å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§</p></blockquote><p> <a href="https://spring.io/projects/spring-data-mongodb#learn">å®˜æ–¹æ–‡æ¡£</a></p><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p><strong>é€‚ç”¨åœºæ™¯</strong></p><p>1ã€ç½‘ç«™æ•°æ®ï¼šMongoéå¸¸é€‚åˆå®æ—¶çš„æ’å…¥ï¼Œæ›´æ–°ä¸æŸ¥è¯¢ï¼Œå¹¶å…·å¤‡ç½‘ç«™å®æ—¶æ•°æ®å­˜å‚¨æ‰€éœ€çš„å¤åˆ¶åŠé«˜åº¦ä¼¸ç¼©æ€§ã€‚</p><p>2ã€ç¼“å­˜ï¼šç”±äºæ€§èƒ½å¾ˆé«˜ï¼ŒMongoä¹Ÿé€‚åˆä½œä¸ºä¿¡æ¯åŸºç¡€è®¾æ–½çš„ç¼“å­˜å±‚ã€‚åœ¨ç³»ç»Ÿé‡å¯ä¹‹åï¼Œç”±M ongoæ­å»ºçš„æŒä¹…åŒ–ç¼“å­˜å±‚å¯ä»¥é¿å…ä¸‹å±‚çš„æ•°æ®æºè¿‡è½½ã€‚</p><p>3ã€å¤§å°ºå¯¸ï¼Œä½ä»·å€¼çš„æ•°æ®ï¼šä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ä¸€äº›æ•°æ®æ—¶å¯èƒ½ä¼šæ¯”è¾ƒæ˜‚è´µï¼Œ åœ¨æ­¤ä¹‹å‰ï¼Œå¾ˆå¤šæ—¶å€™ç¨‹åºå‘˜å¾€å¾€ä¼šé€‰æ‹©ä¼ ç»Ÿçš„æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚</p><p>4ã€é«˜ä¼¸ç¼©æ€§çš„åœºæ™¯ï¼šMongoéå¸¸é€‚åˆç”±æ•°åæˆ–æ•°ç™¾å°æœåŠ¡å™¨ç»„æˆçš„æ•°æ®åº“ã€‚Mongoçš„è·¯çº¿å›¾ä¸­å·²ç»åŒ…å«å¯¹Map Reduceå¼“æ‘©çš„å†…ç½®æ”¯æŒã€‚</p><p>5ã€ç”¨äºå¯¹è±¡åŠ JSONæ•°æ®çš„å­˜å‚¨ï¼šMongoçš„BSONæ•°æ®æ ¼å¼éå¸¸é€‚åˆæ–‡æ¡£åŒ–æ ¼å¼çš„å­˜å‚¨ åŠæŸ¥è¯¢ã€‚</p><p><strong>ä¸é€‚ç”¨åœºåˆ</strong></p><p>1ã€é«˜åº¦äº‹åŠ¡æ€§çš„ç³»ç»Ÿï¼šä¾‹å¦‚é“¶è¡Œæˆ–ä¼šè®¡ç³»ç»Ÿã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ç›®å‰è¿˜æ˜¯æ›´é€‚ç”¨äºéœ€è¦å¤§é‡åŸå­æ€§å¤æ‚äº‹åŠ¡çš„åº”ç”¨ç¨‹åºã€‚</p><p>2ã€ä¼ ç»Ÿçš„å•†ä¸šæ™ºèƒ½åº”ç”¨ï¼šé’ˆå¯¹ç‰¹å®šé—®é¢˜çš„BIæ•°æ®åº“ä¼šå¯¹äº§ç”Ÿé«˜åº¦ä¼˜åŒ–çš„æŸ¥è¯¢æ–¹å¼ã€‚å¯¹äºæ­¤ç±»åº”ç”¨ï¼Œæ•°æ®ä»“åº“å¯èƒ½æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ol><li><p>ä¸‹è½½mongodb</p><ul><li><a href="https://www.mongodb.com/try/download/community">å®˜ç½‘ä¸‹è½½</a> é€‰æ‹©msi</li><li>è¿›å…¥å¼•å¯¼ç•Œé¢ï¼Œé€‰æ‹©Customè‡ªå®šä¹‰å®‰è£…è·¯å¾„</li><li>ä¹‹åä¼šé»˜è®¤è®©å®‰è£…compasså¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥ä¸ä¸‹è½½ä¹‹åä¸‹ç¬¬ä¸‰æ–¹çš„</li><li>ä¸€è·¯next</li></ul></li><li><p>å®‰è£…ä¸ºæœåŠ¡</p><ul><li>é€šè¿‡msiä¸‹è½½çš„mongdbä¼šè‡ªåŠ¨ç”Ÿæˆdataå’Œlogç›®å½•</li></ul><p><img src="/img/mongodb_img/%E7%9B%AE%E5%BD%951.png"></p><ul><li><p>è¿˜ä¼šåœ¨binç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆmongod.cfgé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å†™äº†dataå’Œlogç›®å½•çš„ä½ç½®</p><p><img src="/img/mongodb_img/%E7%9B%AE%E5%BD%952.png"></p></li><li><p>è¿›å…¥binç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œå°†mongodbæ³¨å†Œä¸ºæœåŠ¡</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">mongod <span class="hljs-attr">--config</span> mongod<span class="hljs-selector-class">.cfg</span> <span class="hljs-attr">--install</span> <span class="hljs-attr">--serviceName</span> <span class="hljs-string">&quot;MongoDB&quot;</span> <span class="hljs-attr">--journal</span><br></code></pre></td></tr></table></figure></li><li><p>æœåŠ¡ç›¸å…³å‘½ä»¤ï¼ˆç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dos">å¯åŠ¨æœåŠ¡ï¼š<span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> MongoDB<br>å…³é—­æœåŠ¡ï¼š<span class="hljs-built_in">net</span> stop MongoDB<br>ç§»é™¤æœåŠ¡ï¼ˆbinç›®å½•ä¸‹ï¼‰ï¼šmongod.exe --remove<br></code></pre></td></tr></table></figure></li></ul></li><li><p>ä¸‹è½½å¯è§†åŒ–å·¥å…·</p><p><a href="https://studio3t.com/download-studio3t-free">Download Studio 3T for MongoDB | Windows, macOS &amp; Linux</a></p><ul><li>ä¸‹è½½å®Œè§£å‹ï¼Œå†å®‰è£…</li><li>æµ‹è¯•è¿æ¥localhost:27017</li></ul></li></ol><h4 id="é€šè¿‡dockerå®‰è£…"><a href="#é€šè¿‡dockerå®‰è£…" class="headerlink" title="é€šè¿‡dockerå®‰è£…"></a>é€šè¿‡dockerå®‰è£…</h4><ul><li><p>æ‹‰å–é•œåƒ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> pull mongo:latest<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -d --restart=always -p <span class="hljs-number">27017</span>:<span class="hljs-number">27017</span> --name mymongo -v <span class="hljs-regexp">/data/</span>db:<span class="hljs-regexp">/data/</span>db -d mongo<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># è¿›å…¥å®¹å™¨</span><br>docker exec -it mymongo <span class="hljs-regexp">/bin/</span>bash<br><span class="hljs-comment"># ä½¿ç”¨mongoDBå®¢æˆ·ç«¯è¿›è¡Œæ“ä½œ</span><br>mongo<br><span class="hljs-comment"># æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“</span><br>show dbs<br></code></pre></td></tr></table></figure></li></ul><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><table><thead><tr><th>SQLæœ¯è¯­&#x2F;æ¦‚å¿µ</th><th>MongoDBæœ¯è¯­&#x2F;æ¦‚å¿µ</th><th>è§£é‡Š&#x2F;è¯´æ˜</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>æ•°æ®åº“</td></tr><tr><td>table</td><td><strong>collection</strong></td><td>æ•°æ®åº“è¡¨&#x2F;é›†åˆ</td></tr><tr><td>row</td><td><strong>document</strong></td><td>æ•°æ®è®°å½•è¡Œ&#x2F;æ–‡æ¡£</td></tr><tr><td>column</td><td>field</td><td>æ•°æ®å­—æ®µ&#x2F;åŸŸ</td></tr><tr><td>index</td><td>index</td><td>ç´¢å¼•</td></tr><tr><td>table joins</td><td></td><td>è¡¨è¿æ¥,MongoDBä¸æ”¯æŒ</td></tr><tr><td>primary key</td><td>primary key</td><td>ä¸»é”®,MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”®</td></tr></tbody></table><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs stata"># åœ¨mongoDBå®¢æˆ·ç«¯ä¸‹è¿›è¡Œæ“ä½œ<br><br>1ã€ <span class="hljs-keyword">Help</span>æŸ¥çœ‹å‘½ä»¤æç¤º <br><span class="hljs-keyword">db</span>.<span class="hljs-keyword">help</span>();<br><br>2ã€ åˆ‡æ¢/åˆ›å»ºæ•°æ®åº“<br><span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span><br>å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ•°æ®åº“ï¼Œå¦åˆ™åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“<br><br>3ã€ æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ <br>show dbs;<br><br>4ã€ åˆ é™¤å½“å‰ä½¿ç”¨æ•°æ®åº“ <br><span class="hljs-keyword">db</span>.dropDatabase();<br><br>5ã€ æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ <br><span class="hljs-keyword">db</span>.getName();<br><br>6ã€ æ˜¾ç¤ºå½“å‰<span class="hljs-keyword">db</span>çŠ¶æ€ <br><span class="hljs-keyword">db</span>.stats();<br><br>7ã€ å½“å‰<span class="hljs-keyword">db</span>ç‰ˆæœ¬ <br><span class="hljs-keyword">db</span>.<span class="hljs-keyword">version</span>();<br><br>8ã€ æŸ¥çœ‹å½“å‰<span class="hljs-keyword">db</span>çš„é“¾æ¥æœºå™¨åœ°å€ <br><span class="hljs-keyword">db</span>.getMongoã€‡;<br></code></pre></td></tr></table></figure><p><strong>é›†åˆ</strong></p><blockquote><p>å¯¹åº”å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨</p></blockquote><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sas">1ã€ åˆ›å»ºä¸€ä¸ªé›†åˆï¼ˆ<span class="hljs-keyword">table</span>)<br>db.createCollectio<span class="hljs-meta">n</span>( <span class="hljs-string">&quot;collName&quot;</span>);<br>2ã€ å¾—åˆ°æŒ‡å®šåç§°çš„é›†åˆï¼ˆ<span class="hljs-keyword">table</span> )<br>db.getCollectio<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;user&quot;</span>);<br></code></pre></td></tr></table></figure><p><strong>è®°å½•</strong></p><blockquote><p>å¯¹åº”å…³ç³»å‹æ•°æ®åº“ä¸­çš„å­—æ®µ</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 1.æ’å…¥æ•°æ®</span><br>&gt; db.User.save(&#123;name:<span class="hljs-string">&#x27;zhangsan&#x27;</span>,age:21,sex:true&#125;)<br>&gt; db.User.<span class="hljs-built_in">find</span>()<br><br><span class="hljs-comment"># 2.æŸ¥è¯¢</span><br><span class="hljs-comment"># 2.1æŸ¥è¯¢æ‰€æœ‰</span><br>db.User.<span class="hljs-built_in">find</span>()<br><span class="hljs-comment"># 2.2æ¡ä»¶æŸ¥è¯¢</span><br>db.User.<span class="hljs-built_in">find</span>(&#123;<span class="hljs-string">&#x27;name&#x27;</span>:1&#125;)<br><span class="hljs-comment"># 2.3æŒ‡å®šå­—æ®µ</span><br>db.User.<span class="hljs-built_in">find</span>(&#123;age:21&#125;,&#123;<span class="hljs-string">&#x27;name&#x27;</span>:1,<span class="hljs-string">&#x27;age&#x27;</span>:1&#125;)<br><span class="hljs-comment"># 2.4æ’åº</span><br>db.User.<span class="hljs-built_in">find</span>().sort(&#123;age:1&#125;)<br><span class="hljs-comment"># 2.5åˆ†é¡µæŸ¥è¯¢</span><br>db.User.<span class="hljs-built_in">find</span>().skip(0).limit(3)<br>.<br>.<br>.<br><br></code></pre></td></tr></table></figure><h3 id="SpringBoot-æ•´åˆMongoDB"><a href="#SpringBoot-æ•´åˆMongoDB" class="headerlink" title="SpringBoot æ•´åˆMongoDB"></a>SpringBoot æ•´åˆMongoDB</h3><blockquote><p>spring-data-mongodbæä¾›äº†MongoTemplateä¸MongoRepositoryä¸¤ç§æ–¹å¼è®¿é—®mongodbï¼ŒMongoRepositoryæ“ä½œç®€å•ï¼ŒMongoTemplateæ“ä½œçµæ´»ï¼Œå¯ä»¥çµæ´»é€‚ç”¨è¿™ä¸¤ç§æ–¹å¼æ“ä½œmongodbï¼ŒMongoRepositoryçš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ï¼ŒMongoTemplateæ­£å¥½å¯ä»¥å¼¥è¡¥ä¸è¶³ã€‚</p></blockquote><h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@Document</td><td>æ ‡ç¤ºæ˜ å°„åˆ°Mongodbæ–‡æ¡£ä¸Šçš„é¢†åŸŸå¯¹è±¡</td></tr><tr><td>@Id</td><td>å°†ç›¸åº”å­—æ®µè®¾ç½®ä¸ºä¸»é”®</td></tr><tr><td>@Indexed</td><td>æ ‡ç¤ºæŸä¸ªå­—æ®µä¸ºMongodbçš„ç´¢å¼•å­—æ®µï¼Œæé«˜è¯¥å­—æ®µçš„æ£€ç´¢é€Ÿåº¦</td></tr><tr><td>@Query</td><td>å¯ä»¥ç”¨Mongodbçš„JSONæŸ¥è¯¢è¯­å¥è¿›è¡ŒæŸ¥è¯¢</td></tr></tbody></table><h4 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h4><h5 id="MongoTemplate"><a href="#MongoTemplate" class="headerlink" title="MongoTemplate"></a>MongoTemplate</h5><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">data:</span><br><span class="hljs-comment"># è¿æ¥åœ°å€ ç«¯å£å· è¿æ¥çš„æ•°æ®åº“</span><br>    <span class="hljs-attr">mongodb:</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://127.0.0.1:27017/mall-port</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Document(&quot;User&quot;)</span>   <span class="hljs-comment">//å¯¹åº”MongoDbä¸­çš„è¡¨å</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String email;<br>    <span class="hljs-keyword">private</span> String createDate;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ä½¿ç”¨</p><p>æ’å…¥ã€æŸ¥è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoMongoDBApplicationTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MongoTemplate mongoTemplate;<br><br>    <span class="hljs-comment">// insert æ’å…¥æ•°æ®</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setAge(<span class="hljs-number">20</span>);<br>        user.setName(<span class="hljs-string">&quot;test&quot;</span>);<br>        user.setEmail(<span class="hljs-string">&quot;111@qq.com&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> mongoTemplate.insert(user);<br>        System.out.println(user1);<br>    &#125;<br><br>    <span class="hljs-comment">// findAll æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; all = mongoTemplate.findAll(User.class);<br>        System.out.println(all);<br>    &#125;<br><br>    <span class="hljs-comment">// findById é€šè¿‡idæŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mongoTemplate.findById(<span class="hljs-string">&quot;634c047f1bda8149e63ff1ee&quot;</span>, User.class);<br>        System.out.println(user);<br>    &#125;<br><br>    <span class="hljs-comment">// æ¡ä»¶æŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ„å»ºæ¡ä»¶</span><br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria<br>                .where(<span class="hljs-string">&quot;name&quot;</span>).is(<span class="hljs-string">&quot;test&quot;</span>)<br>                .and(<span class="hljs-string">&quot;age&quot;</span>).is(<span class="hljs-number">20</span>));<br>        List&lt;User&gt; userList = mongoTemplate.find(query, User.class);<br>        System.out.println(userList);<br>    &#125;<br><br>    <span class="hljs-comment">// æ¨¡ç³Šæ¡ä»¶æŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findLikeUserList</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-comment">// æ„å»ºæ­£åˆ™</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;est&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">regex</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%s%s%s&quot;</span>, <span class="hljs-string">&quot;.*&quot;</span>, name, <span class="hljs-string">&quot;*$&quot;</span>);<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(regex, Pattern.CASE_INSENSITIVE);<br>        <span class="hljs-comment">// æ„å»ºæ¡ä»¶</span><br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria<br>                .where(<span class="hljs-string">&quot;name&quot;</span>).regex(pattern));<br>        List&lt;User&gt; userList = mongoTemplate.find(query, User.class);<br>        System.out.println(userList);<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findPageUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>        <span class="hljs-comment">// æ„å»ºæ­£åˆ™</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;est&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">regex</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%s%s%s&quot;</span>, <span class="hljs-string">&quot;.*&quot;</span>, name, <span class="hljs-string">&quot;*$&quot;</span>);<br>        <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(regex, Pattern.CASE_INSENSITIVE);<br>        <span class="hljs-comment">// æ„å»ºæ¡ä»¶</span><br>        <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria<br>                .where(<span class="hljs-string">&quot;name&quot;</span>).regex(pattern));<br><br>        <span class="hljs-comment">// åˆ†é¡µæ„å»º</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> mongoTemplate.count(query, User.class);    <span class="hljs-comment">//è®°å½•æ•°</span><br>        <span class="hljs-comment">// skip(å½“å‰é¡µçš„å¼€å§‹ä¸‹æ ‡).limit(æŸ¥è¯¢é¡µæ•°)</span><br>        List&lt;User&gt; userList = mongoTemplate.find(query.skip((current - <span class="hljs-number">1</span>) * size).limit(size), User.class);<br>        System.out.println(<span class="hljs-string">&quot;æ€»è®°å½•æ•°:&quot;</span> + count);<br>        System.out.println(userList);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ã€åˆ é™¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¿®æ”¹</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mongoTemplate.findById(<span class="hljs-string">&quot;634c047f1bda8149e63ff1ee&quot;</span>, User.class);<br>    user.setName(<span class="hljs-string">&quot;asdasdasd&quot;</span>);<br><br>    <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria.where(<span class="hljs-string">&quot;_id&quot;</span>).is(user.getId()));<br>    <span class="hljs-type">Update</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Update</span>();<br>    update.set(<span class="hljs-string">&quot;name&quot;</span>, user.getName());<br>    update.set(<span class="hljs-string">&quot;age&quot;</span>, user.getAge());<br>    update.set(<span class="hljs-string">&quot;email&quot;</span>, user.getEmail());<br><br>    <span class="hljs-comment">// é€šè¿‡æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢å‡ºæ•°æ®ï¼Œæ›´æ–°çš„å±æ€§</span><br>    <span class="hljs-type">UpdateResult</span> <span class="hljs-variable">upsert</span> <span class="hljs-operator">=</span> mongoTemplate.upsert(query, update, User.class);<br>    <span class="hljs-comment">// æ”¹å˜çš„æ¡æ•°</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">modifiedCount</span> <span class="hljs-operator">=</span> upsert.getModifiedCount();<br>    System.out.println(modifiedCount);<br>&#125;<br><br><span class="hljs-comment">// åˆ é™¤</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Query</span>(Criteria.where(<span class="hljs-string">&quot;_id&quot;</span>).is(<span class="hljs-string">&quot;634c047f1bda8149e63ff1ee&quot;</span>));<br><br>    <span class="hljs-type">DeleteResult</span> <span class="hljs-variable">remove</span> <span class="hljs-operator">=</span> mongoTemplate.remove(query, User.class);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">deletedCount</span> <span class="hljs-operator">=</span> remove.getDeletedCount();<br>    System.out.println(deletedCount);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h5 id="MongoRepository"><a href="#MongoRepository" class="headerlink" title="MongoRepository"></a>MongoRepository</h5><ul><li><p>æ·»åŠ Repositoryç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MongoRepository</span>&lt;User, String&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>CRUD</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoMongoDBApplicationTest1</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserRepository userRepository;<br><br>    <span class="hljs-comment">// save æ’å…¥æ•°æ®</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setAge(<span class="hljs-number">20</span>);<br>        user.setName(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        user.setEmail(<span class="hljs-string">&quot;3332200@qq.com&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userRepository.save(user);<br>    &#125;<br><br>    <span class="hljs-comment">// findAll æŸ¥è¯¢æ‰€æœ‰æ•°æ®</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; all = userRepository.findAll();<br>        System.out.println(all);<br>    &#125;<br><br>    <span class="hljs-comment">// findById é€šè¿‡idæŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userRepository.findById(<span class="hljs-string">&quot;634c06471bda8149e63ff1ef&quot;</span>).get();<br>        System.out.println(user);<br>    &#125;<br><br>    <span class="hljs-comment">// æ¡ä»¶æŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ„é€ æŸ¥è¯¢æ¡ä»¶</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setAge(<span class="hljs-number">20</span>);<br>        Example&lt;User&gt; userExample = Example.of(user);<br><br>        List&lt;User&gt; users = userRepository.findAll(userExample);<br>        System.out.println(users);<br>    &#125;<br><br>    <span class="hljs-comment">// æ¨¡ç³Šæ¡ä»¶æŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findLikeUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//åˆ›å»ºåŒ¹é…å™¨ï¼Œå³å¦‚ä½•ä½¿ç”¨æŸ¥è¯¢æ¡ä»¶</span><br>        <span class="hljs-type">ExampleMatcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> ExampleMatcher.matching() <span class="hljs-comment">//æ„å»ºå¯¹è±¡</span><br>                .withStringMatcher(ExampleMatcher.StringMatcher.CONTAINING) <span class="hljs-comment">//æ”¹å˜é»˜è®¤å­—ç¬¦ä¸²åŒ¹é…æ–¹å¼ï¼šæ¨¡ç³ŠæŸ¥è¯¢</span><br>                .withIgnoreCase(<span class="hljs-literal">true</span>); <span class="hljs-comment">//æ”¹å˜é»˜è®¤å¤§å°å†™å¿½ç•¥æ–¹å¼ï¼šå¿½ç•¥å¤§å°å†™</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setName(<span class="hljs-string">&quot;ä¸‰&quot;</span>);<br>        Example&lt;User&gt; userExample = Example.of(user, matcher);<br>        List&lt;User&gt; userList = userRepository.findAll(userExample);<br>        System.out.println(userList);<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findPageUserList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Pageable</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br><br>        Page&lt;User&gt; pages = userRepository.findAll(page);<br>        System.out.println(pages);<br>    &#125;<br><br>    <span class="hljs-comment">// ä¿®æ”¹</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userRepository.findById(<span class="hljs-string">&quot;635fc9b4d74a3c02b054754a&quot;</span>).get();<br>        user.setName(<span class="hljs-string">&quot;ç‹äº”&quot;</span>);<br>        userRepository.save(user);  <span class="hljs-comment">// æœ‰ç›¸åŒidæ—¶ä¸ºä¿®æ”¹</span><br>    &#125;<br><br>    <span class="hljs-comment">// åˆ é™¤</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span> &#123;<br>        userRepository.deleteById(<span class="hljs-string">&quot;635fc9b4d74a3c02b054754a&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><p>springBoot ç‰ˆæœ¬2.7.8</p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Spring Data MongoDB--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">data:</span><br>    <span class="hljs-attr">mongodb:</span><br>      <span class="hljs-comment"># è¿æ¥åœ°å€ ç«¯å£å· è¿æ¥çš„æ•°æ®åº“</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://127.0.0.1:27017/mall-port</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æ˜ å°„åˆ°mongodbçš„æ–‡æ¡£å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æˆ·å•†å“æµè§ˆå†å²è®°å½•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Document</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemberReadHistory</span> &#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br><br>    <span class="hljs-meta">@Indexed</span><br>    <span class="hljs-keyword">private</span> Long memberId;<br><br>    <span class="hljs-keyword">private</span> String memberNickname;<br><br>    <span class="hljs-keyword">private</span> String memberIcon;<br><br>    <span class="hljs-meta">@Indexed</span><br>    <span class="hljs-keyword">private</span> Long productId;<br><br>    <span class="hljs-keyword">private</span> String productName;<br><br>    <span class="hljs-keyword">private</span> String productPic;<br><br>    <span class="hljs-keyword">private</span> String productSubTitle;<br><br>    <span class="hljs-keyword">private</span> String productPrice;<br><br>    <span class="hljs-keyword">private</span> Date createTime;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æ“ä½œç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MemberReadHistoryRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MongoRepository</span>&lt;MemberReadHistory, String&gt; &#123;<br>    List&lt;MemberReadHistory&gt; <span class="hljs-title function_">findByMemberIdOrderByCreateTimeDesc</span><span class="hljs-params">(Long memberId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™Serviceæ¥å£ã€å®ç°æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemberReadHistoryServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MemberReadHistoryService</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> MemberReadHistoryRepository memberReadHistoryRepository;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">create</span><span class="hljs-params">(MemberReadHistory memberReadHistory)</span> &#123;<br>        memberReadHistory.setId(<span class="hljs-literal">null</span>);<br>        memberReadHistory.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        memberReadHistoryRepository.save(memberReadHistory);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(List&lt;String&gt; ids)</span> &#123;<br>        List&lt;MemberReadHistory&gt; deleteList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(String id : ids)&#123;<br>            <span class="hljs-type">MemberReadHistory</span> <span class="hljs-variable">memberReadHistory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemberReadHistory</span>();<br>            memberReadHistory.setId(id);<br>            deleteList.add(memberReadHistory);<br>        &#125;<br>        memberReadHistoryRepository.deleteAll(deleteList);<br>        <span class="hljs-keyword">return</span> ids.size();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;MemberReadHistory&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long memberId)</span> &#123;<br>        <span class="hljs-keyword">return</span> memberReadHistoryRepository.findByMemberIdOrderByCreateTimeDesc(memberId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Api(tags = &quot;ä¼šå‘˜å•†å“æµè§ˆè®°å½•ç®¡ç†&quot;)</span><br><span class="hljs-meta">@RestController(&quot;/member/readHistory&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemberReadHistoryController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> MemberReadHistoryService memberReadHistoryService;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;åˆ›å»ºæµè§ˆè®°å½•&quot;)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/create&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> MemberReadHistory memberReadHistory)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> memberReadHistoryService.create(memberReadHistory);<br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> CommonResult.success(count);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> CommonResult.failed();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;åˆ é™¤æµè§ˆè®°å½•&quot;)</span><br>    <span class="hljs-meta">@PostMapping(value = &quot;/delete&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;ids&quot;)</span> List&lt;String&gt; ids)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> memberReadHistoryService.delete(ids);<br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> CommonResult.success(count);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> CommonResult.failed();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;å±•ç¤ºæµè§ˆè®°å½•&quot;)</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;List&lt;MemberReadHistory&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Long memberId)</span> &#123;<br>        List&lt;MemberReadHistory&gt; memberReadHistoryList = memberReadHistoryService.list(memberId);<br>        <span class="hljs-keyword">return</span> CommonResult.success(memberReadHistoryList);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Elasticsearch</title>
    <link href="/2023/02/09/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/"/>
    <url>/2023/02/09/%E4%B8%AD%E9%97%B4%E4%BB%B6/Elasticsearch/</url>
    
    <content type="html"><![CDATA[<h2 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¯æ‰©å±•ã€å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="windowså®‰è£…"><a href="#windowså®‰è£…" class="headerlink" title="windowså®‰è£…"></a>windowså®‰è£…</h4><ol><li><p>å®˜ç½‘ä¸‹è½½Elasticsearch</p><p><a href="https://www.elastic.co/cn/downloads/past-releases/#elasticsearch">Past Releases of Elastic Stack Software | Elastic</a></p></li><li><p>å®˜ç½‘ä¸‹è½½kibana(eså®¢æˆ·ç«¯ï¼Œç‰ˆæœ¬è¦å’Œesä¸€è‡´)</p><p><a href="https://www.elastic.co/cn/downloads/past-releases/#kibana">Past Releases of Elastic Stack Software | Elastic</a></p></li><li><p>å®‰è£…ä¸­æ–‡åˆ†è¯æ’ä»¶ï¼Œåœ¨esçš„binç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆç‰ˆæœ¬è¦å’Œesä¸€è‡´ï¼‰ï¼šelasticsearch-plugin install <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.2/elasticsearch-analysis-ik-6.2.2.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.2/elasticsearch-analysis-ik-6.2.2.zip</a></p></li><li><p>åˆ°eså’Œkibanaçš„binç›®å½•ä¸‹ï¼Œç‚¹å‡»è¿è¡Œelasticsearch.batå’Œkibana.bat</p></li><li><p>è®¿é—®<code>localhost:5601</code>æ‰“å¼€kibanaç•Œé¢ï¼Œç‚¹å‡»<code>dev tools</code>æ¥è¾“å…¥esçš„å‘½ä»¤</p></li></ol><h4 id="Linuxå®‰è£…"><a href="#Linuxå®‰è£…" class="headerlink" title="Linuxå®‰è£…"></a>Linuxå®‰è£…</h4><p>è§å¾®æœåŠ¡ç¬”è®°çš„åˆ†å¸ƒå¼æœç´¢(1)</p><h3 id="Spring-Data-Elasticsearch"><a href="#Spring-Data-Elasticsearch" class="headerlink" title="Spring Data Elasticsearch"></a>Spring Data Elasticsearch</h3><p>æ˜¯Springæä¾›çš„ä¸€ç§ä»¥Spring Dataé£æ ¼æ¥æ“ä½œæ•°æ®å­˜å‚¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥é¿å…ç¼–å†™å¤§é‡çš„æ ·æ¿ä»£ç </p><p><a href="https://spring.io/projects/spring-data-elasticsearch#learn">å®˜æ–¹æ–‡æ¡£</a></p><p><strong>å®ä¾‹</strong></p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ³¨æ„è¿™é‡Œelasticsearch.versionç‰ˆæœ¬ä¸€å®š!!!è¦å’Œelasticsearchçš„ç‰ˆæœ¬ä¸€è‡´--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch.version</span>&gt;</span>7.17.3<span class="hljs-tag">&lt;/<span class="hljs-name">elasticsearch.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--Spring Data Elasticsearch--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># ymlé…ç½®elasticsearchå®¢æˆ·ç«¯åœ°å€ï¼ˆå¯é…ç½®é¡¹æœ‰é™ï¼‰</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://127.0.0.1:9200</span> <span class="hljs-comment"># elasticsearch è¿æ¥åœ°å€</span><br>    <span class="hljs-comment">#username: elastic # ç”¨æˆ·å</span><br>    <span class="hljs-comment">#password: 123456 # å¯†ç </span><br>    <span class="hljs-attr">connection-timeout:</span> <span class="hljs-string">10s</span> <span class="hljs-comment"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤1sï¼‰</span><br>    <span class="hljs-attr">socket-timeout:</span> <span class="hljs-string">30s</span> <span class="hljs-comment"># æ•°æ®è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤30sï¼‰</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™ä¿å­˜åˆ°esä¸­çš„å®ä½“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Document(indexName = &quot;user&quot;)</span><span class="hljs-comment">// ç´¢å¼•å</span><br><span class="hljs-meta">@Setting(shards = 3, replicas = 0)</span><span class="hljs-comment">// åˆ·æ–°æ—¶é—´å’Œåˆ†ç‰‡æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-meta">@Field(type = FieldType.Integer)</span><br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;)</span><br>    <span class="hljs-keyword">private</span> String address;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(Integer id, String name, Integer age, String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æ“ä½œç±»(ç±»ä¼¼mysqlçš„mapper)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;User, Integer&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> UserRepository repository;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;ä¸Šæµ·å¸‚é—µè¡ŒåŒº&quot;</span>);<br>    <span class="hljs-type">User</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> repository.save(user);<br><br>    Optional&lt;User&gt; optionalUser = repository.findById(<span class="hljs-number">1</span>);<br>    System.out.println(optionalUser.get());<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@Document</td><td>æ ‡ç¤ºæ˜ å°„åˆ°Elasticsearchæ–‡æ¡£ä¸Šçš„é¢†åŸŸå¯¹è±¡</td></tr><tr><td>@Id</td><td>è¡¨ç¤ºæ˜¯æ–‡æ¡£çš„idï¼Œæ–‡æ¡£å¯ä»¥è®¤ä¸ºæ˜¯mysqlä¸­è¡¨è¡Œçš„æ¦‚å¿µ</td></tr><tr><td>@Field</td><td>è®¾ç½®å­—æ®µç±»å‹ã€æ˜¯å¦å€’æ’ç´¢å¼•ç­‰ä¿¡æ¯</td></tr><tr><td>@Query</td><td>å¯ä»¥ç›´æ¥å†™DSLè¯­å¥</td></tr><tr><td>@Setting</td><td>åˆ†ç‰‡æ•°ã€åˆ·æ–°æ—¶é—´ç­‰å‚æ•°ä¸å†åœ¨<code>@Docement</code>ä¸­å£°æ˜ï¼Œè€Œæ˜¯åœ¨@Settingä¸­å£°æ˜</td></tr></tbody></table><p><strong>@Field</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Field &#123;<br>  <span class="hljs-comment">//æ–‡æ¡£ä¸­å­—æ®µçš„ç±»å‹</span><br>FieldType <span class="hljs-title function_">type</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> FieldType.Auto;<br>  <span class="hljs-comment">//æ˜¯å¦å»ºç«‹å€’æ’ç´¢å¼•</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">index</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>  <span class="hljs-comment">//æ˜¯å¦è¿›è¡Œå­˜å‚¨</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">store</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-comment">//åˆ†è¯å™¨åæ¬¡</span><br>String <span class="hljs-title function_">analyzer</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//ä¸ºæ–‡æ¡£è‡ªåŠ¨æŒ‡å®šå…ƒæ•°æ®ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">FieldType</span> &#123;<br>Text,<span class="hljs-comment">//ä¼šè¿›è¡Œåˆ†è¯å¹¶å»ºäº†ç´¢å¼•çš„å­—ç¬¦ç±»å‹</span><br>Integer,<br>Long,<br>Date,<br>Float,<br>Double,<br>Boolean,<br>Object,<br>Auto,<span class="hljs-comment">//è‡ªåŠ¨åˆ¤æ–­å­—æ®µç±»å‹</span><br>Nested,<span class="hljs-comment">//åµŒå¥—å¯¹è±¡ç±»å‹</span><br>Ip,<br>Attachment,<br>Keyword<span class="hljs-comment">//ä¸ä¼šè¿›è¡Œåˆ†è¯å»ºç«‹ç´¢å¼•çš„ç±»å‹</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>@Query</strong></p><p>å¯ä»¥ç›´æ¥å†™DSLè¯­å¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Query(&quot;&#123;&quot;bool&quot; : &#123;&quot;must&quot; : &#123;&quot;field&quot; : &#123;&quot;name&quot; : &quot;?0&quot;&#125;&#125;&#125;&#125;&quot;)</span><br>Page&lt;EsProduct&gt; <span class="hljs-title function_">findByName</span><span class="hljs-params">(String name,Pageable pageable)</span>;<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•ç”Ÿæˆæœºåˆ¶"><a href="#æ–¹æ³•ç”Ÿæˆæœºåˆ¶" class="headerlink" title="æ–¹æ³•ç”Ÿæˆæœºåˆ¶"></a>æ–¹æ³•ç”Ÿæˆæœºåˆ¶</h4><p>å¯¹äºæ“ä½œç±»æ¥å£æ–¹æ³•çš„å‘½åï¼Œæ ¹æ®è§„åˆ™å¯ä»¥è‡ªåŠ¨å®ç°</p><table><thead><tr><th align="left">å…³é”®è¯</th><th align="left">ç¤ºä¾‹</th><th align="left">å¯¹åº”esæœç´¢æŸ¥è¯¢å­—ç¬¦ä¸²</th></tr></thead><tbody><tr><td align="left"><code>And</code></td><td align="left"><code>findByNameAndPrice</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125; &#125;, &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;price&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Or</code></td><td align="left"><code>findByNameOrPrice</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;should&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125; &#125;, &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;price&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Is</code></td><td align="left"><code>findByName</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Not</code></td><td align="left"><code>findByNameNot</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must_not&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Between</code></td><td align="left"><code>findByPriceBetween</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : ?, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>LessThan</code></td><td align="left"><code>findByPriceLessThan</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : false &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>LessThanEqual</code></td><td align="left"><code>findByPriceLessThanEqual</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>GreaterThan</code></td><td align="left"><code>findByPriceGreaterThan</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : false, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>GreaterThanEqual</code></td><td align="left"><code>findByPriceGreaterThan</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Before</code></td><td align="left"><code>findByPriceBefore</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>After</code></td><td align="left"><code>findByPriceAfter</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;range&quot; : &#123;&quot;price&quot; : &#123;&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true &#125; &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Like</code></td><td align="left"><code>findByNameLike</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?*&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125;, &quot;analyze_wildcard&quot;: true &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>StartingWith</code></td><td align="left"><code>findByNameStartingWith</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;?*&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125;, &quot;analyze_wildcard&quot;: true &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>EndingWith</code></td><td align="left"><code>findByNameEndingWith</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;*?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125;, &quot;analyze_wildcard&quot;: true &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>Contains/Containing</code></td><td align="left"><code>findByNameContaining</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;*?*&quot;, &quot;fields&quot; : [ &quot;name&quot; ] &#125;, &quot;analyze_wildcard&quot;: true &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>In</code>ï¼ˆå½“æ³¨é‡Šä¸º FieldType.å…³é”®å­—æ—¶ï¼‰</td><td align="left"><code>findByNameIn(Collection&lt;String&gt;names)</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;bool&quot; : &#123;&quot;must&quot; : [ &#123;&quot;terms&quot; : &#123;&quot;name&quot; : [&quot;?&quot;,&quot;?&quot;]&#125;&#125; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>In</code></td><td align="left"><code>findByNameIn(Collection&lt;String&gt;names)</code></td><td align="left"><code>&#123; &quot;query&quot;: &#123;&quot;bool&quot;: &#123;&quot;must&quot;: [&#123;&quot;query_string&quot;:&#123;&quot;query&quot;: &quot;\&quot;?\&quot; \&quot;?\&quot;&quot;, &quot;fields&quot;: [&quot;name&quot;]&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>NotIn</code>ï¼ˆå½“æ³¨é‡Šä¸º FieldType.å…³é”®å­—æ—¶ï¼‰</td><td align="left"><code>findByNameNotIn(Collection&lt;String&gt;names)</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123;&quot;bool&quot; : &#123;&quot;must_not&quot; : [ &#123;&quot;terms&quot; : &#123;&quot;name&quot; : [&quot;?&quot;,&quot;?&quot;]&#125;&#125; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>NotIn</code></td><td align="left"><code>findByNameNotIn(Collection&lt;String&gt;names)</code></td><td align="left"><code>&#123;&quot;query&quot;: &#123;&quot;bool&quot;: &#123;&quot;must&quot;: [&#123;&quot;query_string&quot;: &#123;&quot;query&quot;: &quot;NOT(\&quot;?\&quot; \&quot;?\&quot;)&quot;, &quot;fields&quot;: [&quot;name&quot;]&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>True</code></td><td align="left"><code>findByAvailableTrue</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;true&quot;, &quot;fields&quot; : [ &quot;available&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>False</code></td><td align="left"><code>findByAvailableFalse</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;false&quot;, &quot;fields&quot; : [ &quot;available&quot; ] &#125; &#125; ] &#125; &#125;&#125;</code></td></tr><tr><td align="left"><code>OrderBy</code></td><td align="left"><code>findByAvailableTrueOrderByNameDesc</code></td><td align="left"><code>&#123; &quot;query&quot; : &#123; &quot;bool&quot; : &#123; &quot;must&quot; : [ &#123; &quot;query_string&quot; : &#123; &quot;query&quot; : &quot;true&quot;, &quot;fields&quot; : [ &quot;available&quot; ] &#125; &#125; ] &#125; &#125;, &quot;sort&quot;:[&#123;&quot;name&quot;:&#123;&quot;order&quot;:&quot;desc&quot;&#125;&#125;] &#125;</code></td></tr><tr><td align="left"><code>Exists</code></td><td align="left"><code>findByNameExists</code></td><td align="left"><code>&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;name&quot;&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>IsNull</code></td><td align="left"><code>findByNameIsNull</code></td><td align="left"><code>&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must_not&quot;:[&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;name&quot;&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>IsNotNull</code></td><td align="left"><code>findByNameIsNotNull</code></td><td align="left"><code>&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;name&quot;&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>IsEmpty</code></td><td align="left"><code>findByNameIsEmpty</code></td><td align="left"><code>&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;exists&quot;:&#123;&quot;field&quot;:&quot;name&quot;&#125;&#125;],&quot;must_not&quot;:[&#123;&quot;wildcard&quot;:&#123;&quot;name&quot;:&#123;&quot;wildcard&quot;:&quot;*&quot;&#125;&#125;&#125;]&#125;&#125;]&#125;&#125;&#125;</code></td></tr><tr><td align="left"><code>IsNotEmpty</code></td><td align="left"><code>findByNameIsNotEmpty</code></td><td align="left"><code>&#123;&quot;query&quot;:&#123;&quot;bool&quot;:&#123;&quot;must&quot;:[&#123;&quot;wildcard&quot;:&#123;&quot;name&quot;:&#123;&quot;wildcard&quot;:&quot;*&quot;&#125;&#125;&#125;]&#125;&#125;&#125;</code></td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringTask</title>
    <link href="/2023/02/08/spring/SpringTask/"/>
    <url>/2023/02/08/spring/SpringTask/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringTask"><a href="#SpringTask" class="headerlink" title="SpringTask"></a>SpringTask</h2><p>SpringTaskæ˜¯Springè‡ªä¸»ç ”å‘çš„è½»é‡çº§<strong>å®šæ—¶ä»»åŠ¡å·¥å…·</strong></p><h3 id="Cronè¡¨è¾¾å¼"><a href="#Cronè¡¨è¾¾å¼" class="headerlink" title="Cronè¡¨è¾¾å¼"></a>Cronè¡¨è¾¾å¼</h3><p><strong>æ ¼å¼</strong>ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ</p><table><thead><tr><th>æ—¶é—´å…ƒç´ </th><th>å¯å‡ºç°çš„å­—ç¬¦</th><th>æœ‰æ•ˆæ•°å€¼èŒƒå›´</th></tr></thead><tbody><tr><td>Seconds</td><td>, - * &#x2F;</td><td>0-59</td></tr><tr><td>Minutes</td><td>, - * &#x2F;</td><td>0-59</td></tr><tr><td>Hours</td><td>, - * &#x2F;</td><td>0-23</td></tr><tr><td>DayofMonth</td><td>, - * &#x2F; ? L W</td><td>0-31</td></tr><tr><td>Month</td><td>, - * &#x2F;</td><td>1-12</td></tr><tr><td>DayofWeek</td><td>, - * &#x2F; ? L #</td><td>1-7æˆ–SUN-SAT</td></tr></tbody></table><p><strong>è¯´æ˜</strong>ï¼š</p><table><thead><tr><th>å­—ç¬¦</th><th>ä½œç”¨</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>,</td><td>åˆ—å‡ºæšä¸¾å€¼</td><td>åœ¨MinutesåŸŸä½¿ç”¨5,10ï¼Œè¡¨ç¤ºåœ¨5åˆ†å’Œ10åˆ†å„è§¦å‘ä¸€æ¬¡</td></tr><tr><td>-</td><td>è¡¨ç¤ºè§¦å‘èŒƒå›´</td><td>åœ¨MinutesåŸŸä½¿ç”¨5-10ï¼Œè¡¨ç¤ºä»5åˆ†åˆ°10åˆ†é’Ÿæ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</td></tr><tr><td>*</td><td>åŒ¹é…ä»»æ„å€¼</td><td>åœ¨MinutesåŸŸä½¿ç”¨*, è¡¨ç¤ºæ¯åˆ†é’Ÿéƒ½ä¼šè§¦å‘ä¸€æ¬¡</td></tr><tr><td>&#x2F;</td><td>èµ·å§‹æ—¶é—´å¼€å§‹è§¦å‘ï¼Œæ¯éš”å›ºå®šæ—¶é—´è§¦å‘ä¸€æ¬¡</td><td>åœ¨MinutesåŸŸä½¿ç”¨5&#x2F;10,è¡¨ç¤º5åˆ†æ—¶è§¦å‘ä¸€æ¬¡ï¼Œæ¯10åˆ†é’Ÿå†è§¦å‘ä¸€æ¬¡</td></tr><tr><td>?</td><td>åœ¨DayofMonthå’ŒDayofWeekä¸­ï¼Œç”¨äºåŒ¹é…ä»»æ„å€¼</td><td>åœ¨DayofMonthåŸŸä½¿ç”¨?,è¡¨ç¤ºæ¯å¤©éƒ½è§¦å‘ä¸€æ¬¡</td></tr><tr><td>#</td><td>åœ¨DayofMonthä¸­ï¼Œç¡®å®šç¬¬å‡ ä¸ªæ˜ŸæœŸå‡ </td><td>1#3è¡¨ç¤ºç¬¬ä¸‰ä¸ªæ˜ŸæœŸæ—¥</td></tr><tr><td>L</td><td>è¡¨ç¤ºæœ€å</td><td>åœ¨DayofWeekä¸­ä½¿ç”¨5L,è¡¨ç¤ºåœ¨æœ€åä¸€ä¸ªæ˜ŸæœŸå››è§¦å‘</td></tr><tr><td>W</td><td>è¡¨ç¤ºæœ‰æ•ˆå·¥ä½œæ—¥(å‘¨ä¸€åˆ°å‘¨äº”)</td><td>åœ¨DayofMonthä½¿ç”¨5Wï¼Œå¦‚æœ5æ—¥æ˜¯æ˜ŸæœŸå…­ï¼Œåˆ™å°†åœ¨æœ€è¿‘çš„å·¥ä½œæ—¥4æ—¥è§¦å‘ä¸€æ¬¡</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ol><li><p>æ¯ä¸¤ç§’æ‰§è¡Œä¸€æ¬¡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">0/2 <span class="hljs-emphasis">* *</span> <span class="hljs-emphasis">* *</span> <span class="hljs-emphasis">*</span><br></code></pre></td></tr></table></figure></li><li><p>æ¯ä¸ªäºŒã€å››ã€å…­æ˜ŸæœŸçš„ä¸‹åˆä¸¤ç‚¹æ‰§è¡Œä¸€æ¬¡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">*</span> <span class="hljs-emphasis">* 14 *</span> <span class="hljs-emphasis">* 2,4,6</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li><p>SpringTaskå·²ç»å­˜åœ¨äºSpringæ¡†æ¶ä¸­ï¼Œæ— éœ€æ·»åŠ æ–°çš„ä¾èµ–</p></li><li><p><code>@EnableScheduling</code>å¼€å¯å®šæ—¶ä»»åŠ¡åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringTaskConfig</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ç¤ºä¾‹</p><p>æ¯ååˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.component;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeOutCancelTask</span> &#123;<br><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 0/10 * * * *&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelTimeOutOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å®šæ—¶ä»»åŠ¡</span><br>        log.info(<span class="hljs-string">&quot;task&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jwt</title>
    <link href="/2023/02/06/%E5%85%B6%E4%BB%96/Jwt/"/>
    <url>/2023/02/06/%E5%85%B6%E4%BB%96/Jwt/</url>
    
    <content type="html"><![CDATA[<h2 id="Jwt"><a href="#Jwt" class="headerlink" title="Jwt"></a>Jwt</h2><blockquote><p>JWTæ˜¯JSON WEB TOKENçš„ç¼©å†™ï¼Œå®ƒæ˜¯åŸºäº RFC 7519 æ ‡å‡†å®šä¹‰çš„ä¸€ç§å¯ä»¥å®‰å…¨ä¼ è¾“çš„çš„JSONå¯¹è±¡ï¼Œç”±äºä½¿ç”¨äº†<strong>æ•°å­—ç­¾å</strong>ï¼Œæ‰€ä»¥æ˜¯å¯ä¿¡ä»»å’Œå®‰å…¨çš„ã€‚</p></blockquote><h3 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h3><p>header.payload.signature</p><blockquote><p>headerä¸­å­˜æ”¾ç­¾åçš„ç”Ÿæˆç®—æ³•</p><p>payloadå­˜æ”¾é™„åŠ ä¿¡æ¯</p><p>signatureä¸ºé€šè¿‡headerå’Œpayloadç”Ÿæˆçš„ç­¾å</p></blockquote><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ç”¨æˆ·ç™»å½•åï¼Œç³»ç»Ÿç”Ÿæˆtokenè¿”å›ç»™ç”¨æˆ·ã€‚</p><p>ä¹‹åæ¯æ¬¡è°ƒç”¨æ¥å£éƒ½è¦åœ¨è¯·æ±‚ä¸­æ·»åŠ Authorizationè¯·æ±‚å¤´ï¼Œå€¼ä¸ºä¹‹å‰çš„tokenã€‚</p><p>åå°ç³»ç»Ÿé€šè¿‡tokenæ¥å¯¹ç”¨æˆ·<strong>è®¤è¯å’Œæˆæƒ</strong>ã€‚</p><p><font color="red">jwtä¸èƒ½é˜²æ­¢å†’å……å…¶ä»–ç”¨æˆ·</font></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ç”¨åˆ°SpringSecurityæ¥ä¼ ç”¨æˆ·ä¿¡æ¯ --&gt;</span><br><span class="hljs-comment">&lt;!--SpringSecurityä¾èµ–é…ç½®--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># è‡ªå®šä¹‰jwt key</span><br><span class="hljs-attr">jwt:</span><br>  <span class="hljs-attr">tokenHeader:</span> <span class="hljs-string">Authorization</span> <span class="hljs-comment">#JWTå­˜å‚¨çš„è¯·æ±‚å¤´</span><br>  <span class="hljs-attr">secret:</span> <span class="hljs-string">mySecret</span> <span class="hljs-comment">#JWTåŠ è§£å¯†ä½¿ç”¨çš„å¯†é’¥</span><br>  <span class="hljs-attr">expiration:</span> <span class="hljs-number">604800</span> <span class="hljs-comment">#JWTçš„è¶…æœŸé™æ—¶é—´(60*60*24)</span><br>  <span class="hljs-attr">tokenHead:</span> <span class="hljs-string">Bearer</span>  <span class="hljs-comment">#JWTè´Ÿè½½ä¸­æ‹¿åˆ°å¼€å¤´</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™å·¥å…·ç±»ï¼ˆç»“åˆSpring Securityï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.utils;<br><br><span class="hljs-keyword">import</span> io.jsonwebtoken.*;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetails;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * tokenå·¥å…·ç±»</span><br><span class="hljs-comment"> * è·å–tokenã€æ ¡éªŒtokenã€åˆ·æ–°tokenè¿‡æœŸæ—¶é—´</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenUtil</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CLAIM_KEY_USERNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;sub&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CLAIM_KEY_CREATED</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;created&quot;</span>;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String secret;  <span class="hljs-comment">// åŠ å¯†ç§˜é’¥</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Long expiration;    <span class="hljs-comment">// tokenä¿ç•™æ—¶é—´</span><br><br>    <span class="hljs-comment">// è·å–tokenä¸­çš„ç”¨æˆ·å</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserNameFormToken</span><span class="hljs-params">(String token)</span> &#123;<br>        String username;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> getClaimsFormToken(token);<br>            username = claims.getSubject();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> username;<br>    &#125;<br><br>    <span class="hljs-comment">// éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateToken</span><span class="hljs-params">(String token, UserDetails userDetails)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> getUserNameFormToken(token);<br>        <span class="hljs-keyword">return</span> userDetails.getUsername().equals(username) &amp;&amp; isTokenExpired(token);<br>    &#125;<br><br>    <span class="hljs-comment">// ç”ŸæˆToken</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateToken</span><span class="hljs-params">(UserDetails userDetails)</span> &#123;<br>        HashMap&lt;String, Object&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        claims.put(CLAIM_KEY_USERNAME, userDetails.getUsername());<br>        claims.put(CLAIM_KEY_CREATED, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        <span class="hljs-keyword">return</span> generateTokenFromClaims(claims);<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ·æ–°token</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">refreshToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> getClaimsFormToken(token);<br>        claims.put(CLAIM_KEY_CREATED, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        <span class="hljs-keyword">return</span> generateTokenFromClaims(claims);<br>    &#125;<br><br>    <span class="hljs-comment">// éªŒè¯tokenæ˜¯å¦å®æ•ˆ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isTokenExpired</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-type">Date</span> <span class="hljs-variable">expireDate</span> <span class="hljs-operator">=</span> getExpireDateFormToken(token);<br>        <span class="hljs-keyword">return</span> expireDate.before(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–Tokenè¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-keyword">private</span> Date <span class="hljs-title function_">getExpireDateFormToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> getClaimsFormToken(token);<br>        <span class="hljs-keyword">return</span> claims.getExpiration();<br>    &#125;<br><br>    <span class="hljs-comment">// æ ¹æ®è´Ÿè½½ä¿¡æ¯ç”ŸæˆToken</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateTokenFromClaims</span><span class="hljs-params">(Map&lt;String, Object&gt; claims)</span> &#123;<br>        <span class="hljs-keyword">return</span> Jwts.builder()<br>                .setClaims(claims)  <span class="hljs-comment">// è®¾ç½®tokenä¸­è´Ÿè½½ä¿¡æ¯</span><br>                .setExpiration(generateExpirationDate())    <span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ—¶é—´</span><br>                .signWith(SignatureAlgorithm.ES512, secret) <span class="hljs-comment">// è®¾ç½®åŠ å¯†æ–¹å¼</span><br>                .compact();<br>    &#125;<br><br>    <span class="hljs-comment">// ç”ŸæˆTokenè¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-keyword">private</span> Date <span class="hljs-title function_">generateExpirationDate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + expiration * <span class="hljs-number">1000</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–tokenä¸­çš„JWTè´Ÿè½½</span><br>    <span class="hljs-keyword">private</span> Claims <span class="hljs-title function_">getClaimsFormToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            claims = Jwts.parser()<br>                    .setSigningKey(secret)<br>                    .parseClaimsJws(token)<br>                    .getBody();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.info(<span class="hljs-string">&quot;JWTéªŒè¯å¤±è´¥:&#123;&#125;&quot;</span>, token);<br>        &#125;<br>        <span class="hljs-keyword">return</span> claims;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™å·¥å…·ç±»ï¼ˆä¸æ˜¯ç”¨å…¶ä»–æ¡†æ¶ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.place.utils;<br><br><span class="hljs-keyword">import</span> io.jsonwebtoken.*;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.crypto.SecretKey;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * tokenå·¥å…·ç±»</span><br><span class="hljs-comment"> * è·å–tokenã€æ ¡éªŒtokenã€åˆ·æ–°tokenè¿‡æœŸæ—¶é—´</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtTokenUtil</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.secret&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String SECRET;      <span class="hljs-comment">// åŠ å¯†ç§˜é’¥</span><br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.expiration&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Long EXPIRATION;    <span class="hljs-comment">// tokenä¿ç•™æ—¶é—´(s)</span><br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jwt.refresh_time&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Integer REFRESH_TIME;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆtoken</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getToken</span><span class="hljs-params">(Long id)</span> &#123;<br>        HashMap&lt;String, Object&gt; claimMaps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        claimMaps.put(<span class="hljs-string">&quot;id&quot;</span>, id);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">return</span> Jwts.builder()<br>                .setId(UUID.randomUUID().toString())<br>                .setIssuedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(currentTime))     <span class="hljs-comment">// ç­¾å‘æ—¶é—´</span><br>                .setSubject(<span class="hljs-string">&quot;system&quot;</span>)                   <span class="hljs-comment">// è¯´æ˜</span><br>                .setAudience(<span class="hljs-string">&quot;app&quot;</span>)                     <span class="hljs-comment">// æ¥æ”¶ç”¨æˆ·</span><br>                .compressWith(CompressionCodecs.GZIP)   <span class="hljs-comment">// æ•°æ®å‹ç¼©æ–¹å¼</span><br>                .signWith(SignatureAlgorithm.HS512, generalKey())   <span class="hljs-comment">// æ•°æ®å‹ç¼©æ–¹å¼</span><br>                .setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(currentTime + EXPIRATION * <span class="hljs-number">1000</span>))     <span class="hljs-comment">// è¿‡æœŸæ—¶é—´æˆ³</span><br>                .addClaims(claimMaps)                   <span class="hljs-comment">// è½½è·ä¿¡æ¯</span><br>                .compact();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåŠ å¯†key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SecretKey <span class="hljs-title function_">generalKey</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">byte</span>[] encodedKey = Base64.getEncoder().encode(SECRET.getBytes());<br>        <span class="hljs-type">SecretKey</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(encodedKey, <span class="hljs-number">0</span>, encodedKey.length, <span class="hljs-string">&quot;AES&quot;</span>);<br>        <span class="hljs-keyword">return</span> key;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–payload bodyä¿¡æ¯</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Claims <span class="hljs-title function_">getClaimsBody</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> getJws(token).getBody();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–headers bodyä¿¡æ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JwsHeader <span class="hljs-title function_">getHeaderBody</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">return</span> getJws(token).getHeader();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ¤æ–­tokenæ˜¯å¦è¿‡æœŸ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> claims</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> -1 æœ‰æ•ˆï¼Œ0 æœ‰æ•ˆï¼Œ1ï¼šè¿‡æœŸï¼Œ2 è¿‡æœŸ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">verifyToken</span><span class="hljs-params">(Claims claims)</span> &#123;<br>        <span class="hljs-keyword">if</span> (claims == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            claims.getExpiration()<br>                    .before(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            <span class="hljs-keyword">if</span> ((claims.getExpiration().getTime() - System.currentTimeMillis()) &gt; REFRESH_TIME * <span class="hljs-number">1000</span>) &#123;<br>                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (ExpiredJwtException ex) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–è½½è·ä¿¡æ¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Jws&lt;Claims&gt; <span class="hljs-title function_">getJws</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">return</span> Jwts.parser()<br>                .setSigningKey(generalKey())<br>                .parseClaimsJws(token);<br>    &#125;<br><br><br>    <span class="hljs-comment">// æµ‹è¯•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(JwtTokenUtil.getToken(<span class="hljs-number">1102L</span>));<br>        Jws&lt;Claims&gt; jws = JwtTokenUtil.getJws(<span class="hljs-string">&quot;eyJhbGciOiJIUzUxMiIsInppcCI6IkdaSVAifQ.H4sIAAAAAAAAAB2LUQrEIAwF75JvBROjYm-jVcGFBUELW0rv3nT_3jDzLvisDhtwKxzCbrRr6DQ3izqVitpzzL5FyqYgKOhpwYY-UkDHziuYR5b3POeqX_HpKIJpDNn1N_6ttWTobbs4REP3Az_PtEl1AAAA.Mrst1ZCLW7ItSxLl26TiYbpN-7XPNn1HUuP0ZyGqNZgLitUlt3Vqfnu9MGI1blugwdI6wBriAmydZITaYuRRmA&quot;</span>);<br>        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> jws.getBody();<br>        System.out.println(claims.get(<span class="hljs-string">&quot;id&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPä»£ç ç”Ÿæˆå™¨</title>
    <link href="/2023/02/03/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <url>/2023/02/03/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="MPä»£ç ç”Ÿæˆå™¨"><a href="#MPä»£ç ç”Ÿæˆå™¨" class="headerlink" title="MPä»£ç ç”Ÿæˆå™¨"></a>MPä»£ç ç”Ÿæˆå™¨</h2><p><a href="https://baomidou.com/pages/779a6e/#%E5%AE%89%E8%A3%85">å®˜ç½‘æ–‡æ¡£</a></p><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><ol><li><p>å¯¼å…¥åæ ‡</p><blockquote><p>æ³¨æ„mybatis-plus-generatorçš„ç‰ˆæœ¬å¿…é¡»ä¸º3.5.1</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--MybatisPlusã€MybatisPlusç”Ÿæˆå™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8080</span><br>spring:<br>  datasource:<br>    url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/mall?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span><br>    username: root<br>    password: <span class="hljs-number">123456</span><br><br>mybatis:<br>  mapper-locations:<br>    - classpath:mapper<span class="hljs-comment">/*.xml</span><br><span class="hljs-comment">    - classpath*:com/**/</span>mapper<span class="hljs-comment">/*.xml</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™ä»£ç ï¼Œæ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.mallLearning.generator;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºç”Ÿäº§MBGçš„ä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Generator</span> &#123;<br>    <span class="hljs-comment">// åŸºç¡€ä¿¡æ¯é…ç½®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mall?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USERNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PARENT_PACKAGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.xw.mallLearning.generator&quot;</span>;  <span class="hljs-comment">// åŒ…å</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PROJECT_ROOT_PATH</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PROJECT_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mall-learning&quot;</span>;     <span class="hljs-comment">// å½“å‰é¡¹ç›®åç§°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MODULE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;mbg&quot;</span>;      <span class="hljs-comment">// æ¨¡å—åç§°, ä»£ç ä¼šç”Ÿæˆåœ¨generator/MODULE_NAMEä¸‹</span><br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰§è¡Œæ­¤å¤„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        simpleGenerator();<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">simpleGenerator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ·»åŠ éœ€è¦è‡ªåŠ¨ç”Ÿæˆä»£ç çš„è¡¨å, ä¸ºç©ºåˆ™ç”Ÿæˆæ‰€æœ‰è¡¨å¯¹åº”ä»£ç </span><br>        List&lt;String&gt; tables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        tables.add(<span class="hljs-string">&quot;pms_brand&quot;</span>);<br><br>        <span class="hljs-comment">// åŒ…è·¯å¾„</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">packagePath</span> <span class="hljs-operator">=</span> PROJECT_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + PROJECT_NAME + <span class="hljs-string">&quot;/src/main/java&quot;</span>;<br>        <span class="hljs-comment">// XMLæ–‡ä»¶çš„è·¯å¾„</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">mapperXmlPath</span> <span class="hljs-operator">=</span> PROJECT_ROOT_PATH + <span class="hljs-string">&quot;/&quot;</span> + PROJECT_NAME + <span class="hljs-string">&quot;/src/main/resources/mapper&quot;</span>;<br><br>        <span class="hljs-comment">// å¼€å§‹æ‰§è¡Œä»£ç ç”Ÿæˆ</span><br>        FastAutoGenerator.create(URL, USERNAME, PASSWORD)<br>            <span class="hljs-comment">// 1. å…¨å±€é…ç½®</span><br>            .globalConfig(builder -&gt; builder<br>                          <span class="hljs-comment">// ä½œè€…åç§°</span><br>                          .author(<span class="hljs-string">&quot;xw&quot;</span>)<br>                          <span class="hljs-comment">// å¼€å¯è¦†ç›–å·²ç”Ÿæˆçš„æ–‡ä»¶ã€‚æ³¨é‡Šæ‰åˆ™å…³é—­è¦†ç›–ã€‚</span><br>                          .fileOverride()<br>                          <span class="hljs-comment">// ç¦æ­¢æ‰“å¼€è¾“å‡ºç›®å½•ã€‚æ³¨é‡Šæ‰åˆ™ç”Ÿæˆå®Œæ¯•åï¼Œè‡ªåŠ¨æ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶ç›®å½•ã€‚</span><br>                          .disableOpenDir()<br>                          <span class="hljs-comment">// æŒ‡å®šè¾“å‡ºç›®å½•ã€‚å¦‚æœæŒ‡å®šï¼ŒWindowsç”Ÿæˆè‡³Dç›˜æ ¹ç›®å½•ä¸‹ï¼ŒLinux or MAC ç”Ÿæˆè‡³ /tmp ç›®å½•ä¸‹ã€‚</span><br>                          .outputDir(packagePath)<br>                          <span class="hljs-comment">// å¼€å¯swagger2.æ³¨é‡Šæ‰åˆ™é»˜è®¤å…³é—­ã€‚</span><br>                          <span class="hljs-comment">// .enableSwagger()</span><br>                          <span class="hljs-comment">// æŒ‡å®šæ—¶é—´ç­–ç•¥ã€‚</span><br>                          .dateType(DateType.TIME_PACK)<br>                          <span class="hljs-comment">// æ³¨é‡Šæ—¶é—´ç­–ç•¥ã€‚</span><br>                          .commentDate(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>)<br>                         )<br><br>            <span class="hljs-comment">// 2. åŒ…é…ç½®</span><br>            .packageConfig(builder -&gt; builder<br>                           <span class="hljs-comment">// è®¾ç½®çˆ¶è¡¨å</span><br>                           .parent(PARENT_PACKAGE_NAME)<br>                           .moduleName(MODULE_NAME)<br>                           .entity(<span class="hljs-string">&quot;entity&quot;</span>)<br>                           .service(<span class="hljs-string">&quot;service&quot;</span>)<br>                           .serviceImpl(<span class="hljs-string">&quot;service.impl&quot;</span>)<br>                           .controller(<span class="hljs-string">&quot;controller&quot;</span>)<br>                           .mapper(<span class="hljs-string">&quot;mapper&quot;</span>)<br>                           .xml(<span class="hljs-string">&quot;mapper&quot;</span>)<br>                           <span class="hljs-comment">// mapper.xml æ–‡ä»¶çš„è·¯å¾„ã€‚å•æ¨¡å—ä¸‹ï¼Œå…¶ä»–æ–‡ä»¶è·¯å¾„é»˜è®¤å³å¯ã€‚</span><br>                           .pathInfo(Collections.singletonMap(OutputFile.mapperXml, mapperXmlPath))<br>                          )<br><br>            <span class="hljs-comment">// 3. ç­–ç•¥é…ç½®</span><br>            .strategyConfig(builder -&gt; builder.addInclude(tables)<br>                            <span class="hljs-comment">// é˜¶æ®µ1ï¼šEntityå®ä½“ç±»ç­–ç•¥é…ç½®</span><br>                            .entityBuilder()<br>                            <span class="hljs-comment">// å¼€å¯ç”Ÿæˆå®ä½“æ—¶ç”Ÿæˆå­—æ®µæ³¨è§£ã€‚</span><br>                            <span class="hljs-comment">// ä¼šåœ¨å®ä½“ç±»çš„å±æ€§å‰ï¼Œæ·»åŠ [@TableField(&quot;nickname&quot;)]</span><br>                            .enableTableFieldAnnotation()<br>                            <span class="hljs-comment">// é€»è¾‘åˆ é™¤å­—æ®µå(æ•°æ®åº“)ã€‚</span><br>                            <span class="hljs-comment">//.logicDeleteColumnName(&quot;is_delete&quot;)</span><br>                            <span class="hljs-comment">// é€»è¾‘åˆ é™¤å±æ€§å(å®ä½“)ã€‚</span><br>                            <span class="hljs-comment">// ä¼šåœ¨å®ä½“ç±»çš„è¯¥å­—æ®µå±æ€§å‰åŠ æ³¨è§£[@TableLogic]</span><br>                            <span class="hljs-comment">//.logicDeletePropertyName(&quot;isDelete&quot;)</span><br>                            <span class="hljs-comment">// ä¼šåœ¨å®ä½“ç±»çš„è¯¥å­—æ®µä¸Šè¿½åŠ æ³¨è§£[@TableField(value = &quot;create_time&quot;, fill = FieldFill.INSERT)]</span><br>                            .addTableFills(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Column</span>(<span class="hljs-string">&quot;create_time&quot;</span>, FieldFill.INSERT))<br>                            <span class="hljs-comment">// ä¼šåœ¨å®ä½“ç±»çš„è¯¥å­—æ®µä¸Šè¿½åŠ æ³¨è§£[@TableField(value = &quot;update_time&quot;, fill = FieldFill.INSERT_UPDATE)]</span><br>                            .addTableFills(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Column</span>(<span class="hljs-string">&quot;update_time&quot;</span>, FieldFill.INSERT_UPDATE))<br>                            <span class="hljs-comment">// é˜¶æ®µ2ï¼šMapperç­–ç•¥é…ç½®</span><br>                            .mapperBuilder()<br>                            <span class="hljs-comment">// å¼€å¯ @Mapper æ³¨è§£ã€‚</span><br>                            <span class="hljs-comment">// ä¼šåœ¨mapperæ¥å£ä¸Šæ·»åŠ æ³¨è§£[@Mapper]</span><br>                            .enableMapperAnnotation()<br>                            <span class="hljs-comment">// å¯ç”¨ BaseResultMap ç”Ÿæˆã€‚</span><br>                            <span class="hljs-comment">// ä¼šåœ¨mapper.xmlæ–‡ä»¶ç”Ÿæˆ[é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ]é…ç½®ã€‚</span><br>                            .enableBaseResultMap()<br>                            <span class="hljs-comment">// å¯ç”¨ BaseColumnListã€‚</span><br>                            <span class="hljs-comment">// ä¼šåœ¨mapper.xmlæ–‡ä»¶ç”Ÿæˆ[é€šç”¨æŸ¥è¯¢ç»“æœåˆ— ]é…ç½®</span><br>                            .enableBaseColumnList()<br>                            <span class="hljs-comment">// é˜¶æ®µ4ï¼šControllerç­–ç•¥é…ç½®</span><br>                            .controllerBuilder()<br>                            <span class="hljs-comment">// ä¼šåœ¨æ§åˆ¶ç±»ä¸­åŠ [@RestController]æ³¨è§£ã€‚</span><br>                            .enableRestStyle()<br>                            <span class="hljs-comment">// å¼€å¯é©¼å³°è½¬è¿å­—ç¬¦</span><br>                            .enableHyphenStyle()<br>                            .build()<br>                           )<br><br>            <span class="hljs-comment">// 4. æ¨¡æ¿å¼•æ“é…ç½®ï¼Œé»˜è®¤ Velocity å¯é€‰æ¨¡æ¿å¼•æ“ Beetl æˆ– Freemarker</span><br>            <span class="hljs-comment">//.templateEngine(new BeetlTemplateEngine())</span><br>            .templateEngine(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FreemarkerTemplateEngine</span>())<br><br>            <span class="hljs-comment">// 5. æ‰§è¡Œ</span><br>            .execute();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
      <category>mybatis-plus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django</title>
    <link href="/2022/12/02/%E5%85%B6%E4%BB%96/python/Django/"/>
    <url>/2022/12/02/%E5%85%B6%E4%BB%96/python/Django/</url>
    
    <content type="html"><![CDATA[<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><blockquote><p>Django æ˜¯ä¸€ä¸ªç”± <strong>Python</strong> ç¼–å†™çš„ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„ <strong>Web åº”ç”¨æ¡†æ¶</strong>ã€‚</p></blockquote><h3 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>pip</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> django<br></code></pre></td></tr></table></figure><p>pycharm</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl">è½¯ä»¶åŒ…æœD<span class="hljs-function"><span class="hljs-title">jango</span> --&gt;</span> å®‰è£…è½¯ä»¶åŒ…<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œåä¼šåœ¨Libç›®å½•ä¸‹ä¸‹è½½djangoæºç ï¼Œåœ¨Scriptsä¸‹ç”Ÿæˆdjango-admin.exeç”¨äºç”Ÿæˆdjangoé¡¹ç›®</p><h4 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h4><p>cmd</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-comment"># è¿›åˆ°è¦åˆ›å»ºé¡¹ç›®çš„ç›®å½•</span><br>django-<span class="hljs-literal">admin</span> startproject é¡¹ç›®åç§°<br></code></pre></td></tr></table></figure><p>pycharm</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">æ–‡ä»¶</span> <span class="hljs-literal">--</span>&gt; <span class="hljs-comment">æ–°å»ºé¡¹ç›®</span> <span class="hljs-literal">--</span>&gt; <span class="hljs-comment">Django</span> <span class="hljs-literal">--</span>&gt; <span class="hljs-comment">è¾“å…¥é¡¹ç›®ååˆ›å»ºé¡¹ç›®</span><br></code></pre></td></tr></table></figure><h4 id="é¡¹ç›®ç›®å½•è¯´æ˜"><a href="#é¡¹ç›®ç›®å½•è¯´æ˜" class="headerlink" title="é¡¹ç›®ç›®å½•è¯´æ˜"></a>é¡¹ç›®ç›®å½•è¯´æ˜</h4><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-- é¡¹ç›®åŒåæ–‡ä»¶å¤¹</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- __init__.py# ç©ºçš„ï¼Œæ ‡è®°è¿™ä¸ªè½¯ä»¶åŒ…ä¸ºpythonè½¯ä»¶åŒ…</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- asgi.py# æ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ï¼‰</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- settings.py# é¡¹ç›®çš„é…ç½®æ–‡ä»¶</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- urls.py# è®¿é—®è·¯å¾„å’Œå‡½æ•°é—´çš„æ˜ å°„å…³ç³»</span><br><span class="hljs-string"></span>|<span class="hljs-string">   `-- wsgi.py# æ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼ˆåŒæ­¥ï¼‰</span><br><span class="hljs-string">`-- manage.py# é¡¹ç›®ç®¡ç†ï¼Œå¯åŠ¨é¡¹ç›®ï¼Œåˆ›å»ºappï¼Œæ•°æ®ç®¡ç†</span><br></code></pre></td></tr></table></figure><h4 id="App"><a href="#App" class="headerlink" title="App"></a>App</h4><blockquote><p>ç±»ä¼¼javaä¸­mavené¡¹ç›®çš„æ¨¡å—</p></blockquote><p>åˆ›å»ºapp</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-comment"># åœ¨é¡¹ç›®ç›®å½•ä¸‹</span><br>python manage.py startapp <span class="hljs-variable">&lt;appå&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨å†Œapp</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">åœ¨settings.<span class="hljs-keyword">py</span>æ–‡ä»¶çš„INSTALLED_APPSä¸­æ·»åŠ appçš„apps.<span class="hljs-keyword">py</span>ä¸­çš„å¯åŠ¨ç±»<br></code></pre></td></tr></table></figure><p>appç›®å½•ç»“æ„</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-- appå</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- __init__.py</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- admin.py# djangoé»˜è®¤æä¾›äº†adminåå°ç®¡ç†</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- apps.py# appå¯åŠ¨ç±»</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- models.py           # **å¯¹æ•°æ®åº“æ“ä½œ**</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- tests.py            # å•å…ƒæµ‹è¯•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- views.py# **æ”¾ä¸è¯·æ±‚è·¯å¾„å¯¹åº”çš„å‡½æ•°**</span><br><span class="hljs-string">`-- manage.py</span><br></code></pre></td></tr></table></figure><h3 id="ç¬¬ä¸€ä¸ªé¡¹ç›®"><a href="#ç¬¬ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="ç¬¬ä¸€ä¸ªé¡¹ç›®"></a>ç¬¬ä¸€ä¸ªé¡¹ç›®</h3><ol><li>åˆ›å»ºapp</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> startapp HelloWorld<br></code></pre></td></tr></table></figure><ol start="2"><li>settings.pyçš„INSTALLED_APPSä¸­æ³¨å†Œapp</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">INSTALLED_APPS = [<br>    <span class="hljs-string">&#x27;django.contrib.admin&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.contenttypes&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.staticfiles&#x27;</span>,<br>    <span class="hljs-string">&#x27;HelloWorld.apps.HelloworldConfig&#x27;</span>,     <span class="hljs-comment"># æ³¨å†Œapp</span><br>]<br></code></pre></td></tr></table></figure><ol start="3"><li>urls.pyä¸­åŠ å…¥æ˜ å°„</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [<br>    path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>    <span class="hljs-comment"># è®¿é—®è·¯å¾„å’Œå‡½æ•°çš„æ˜ å°„</span><br>    path(<span class="hljs-string">&#x27;index/&#x27;</span>, views.index),<br>]<br></code></pre></td></tr></table></figure><ol start="4"><li>åœ¨views.pyä¸­ç¼–å†™å¯¹åº”å‡½æ•°</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;Hello World&quot;</span>)<br></code></pre></td></tr></table></figure><ol start="5"><li>å¯åŠ¨</li></ol><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver<br>æˆ–<br>pycharm ä¸­ç»¿è‰²ä¸‰è§’<br></code></pre></td></tr></table></figure><ol start="6"><li>é¡µé¢è®¿é—®<code>localhost:8000/index</code></li></ol><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><blockquote><p>åœ¨appä¸‹å»ºç«‹templatesç›®å½•æ¥æ”¾ç½®ç½‘é¡µæ–‡ä»¶</p><p>staticç›®å½•æ”¾é™æ€æ–‡ä»¶</p></blockquote><p>åœ¨å‡½æ•°ä¸­ä½¿ç”¨<code>return render(request, &quot;æ–‡ä»¶å&quot;)</code>æ¥è¿”å›ç½‘é¡µ</p><p>æœç´¢ç½‘é¡µæ–‡ä»¶é¡ºåº</p><ol><li><p>ä¼˜å…ˆé¡¹ç›®æ ¹ç›®å½•çš„templatesä¸­æ‰¾</p><blockquote><p>è¦åœ¨é…ç½®æ–‡ä»¶çš„TEMPLATESä¸­æ ‡è¯†<code>&#39;DIRS&#39;: [os.path.join(BASE_DIR, &#39;templates&#39;)]</code></p></blockquote></li><li><p>æ ¹æ®appæ³¨å†Œé¡ºåºï¼Œåœ¨æ¯ä¸ªappçš„templatesä¸­æ‰¾</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flask</title>
    <link href="/2022/12/01/%E5%85%B6%E4%BB%96/python/flask/"/>
    <url>/2022/12/01/%E5%85%B6%E4%BB%96/python/flask/</url>
    
    <content type="html"><![CDATA[<h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><h3 id="å°æ¡ˆä¾‹"><a href="#å°æ¡ˆä¾‹" class="headerlink" title="å°æ¡ˆä¾‹"></a>å°æ¡ˆä¾‹</h3><p><strong>åç«¯</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><span class="hljs-keyword">import</span> pymysql<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/add/user&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_user</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;add_user.html&quot;</span>)<br><br>    <span class="hljs-comment"># ä¿å­˜åˆ°mysql</span><br>    conn = get_conn()<br>    insert(conn, request)<br>    conn.close()<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ·»åŠ æˆåŠŸ&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/show/user&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_user</span>():<br>    conn = get_conn()<br>    all_info = get_all(conn)<br>    conn.close()<br>    <span class="hljs-built_in">print</span>(all_info)<br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;show_user.html&quot;</span>, data_list=all_info)<br><br><span class="hljs-comment"># è·å–æ¸¸æ ‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_conn</span>():<br>    conn = pymysql.connect(host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>                           port=<span class="hljs-number">3306</span>,<br>                           user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                           password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>                           charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                           db=<span class="hljs-string">&#x27;pyconn&#x27;</span>)<br><br>    <span class="hljs-keyword">return</span> conn<br><br><br><span class="hljs-comment"># æ’å…¥æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">conn, request</span>):<br>    info = &#123;<br>        <span class="hljs-string">&quot;user&quot;</span>: request.form.get(<span class="hljs-string">&quot;user&quot;</span>),<br>        <span class="hljs-string">&quot;pwd&quot;</span>: request.form.get(<span class="hljs-string">&quot;pwd&quot;</span>),<br>        <span class="hljs-string">&quot;mobile&quot;</span>: request.form.get(<span class="hljs-string">&quot;mobile&quot;</span>),<br>    &#125;<br>    cursor = conn.cursor()<br>    sql = <span class="hljs-string">&quot;insert into admin(username, password, mobile) values (%s, %s, %s)&quot;</span><br>    cursor.execute(sql, [info[<span class="hljs-string">&quot;user&quot;</span>], info[<span class="hljs-string">&quot;pwd&quot;</span>], info[<span class="hljs-string">&quot;mobile&quot;</span>]])<br>    conn.commit()<br><br><br><span class="hljs-comment"># è·å–æ‰€æœ‰æ•°æ®</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all</span>(<span class="hljs-params">conn</span>):<br>    cursor = conn.cursor(pymysql.cursors.DictCursor)<br>    sql = <span class="hljs-string">&quot;select * from admin&quot;</span><br>    cursor.execute(sql)<br>    <span class="hljs-keyword">return</span> cursor.fetchall()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p><strong>å‰ç«¯</strong></p><p>æ·»åŠ ç”¨æˆ·</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ·»åŠ ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/add/user&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pwd&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;å¯†ç &quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mobile&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æ‰‹æœºå·&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å±•ç¤ºç”¨æˆ·</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç”¨æˆ·åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å¯†ç <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>æ‰‹æœºå·<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>        &#123;% for item in data_list %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; item.id &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; item.username &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; item.PASSWORD &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; item.mobile &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &#123;% endfor %&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonè¿æ¥æ•°æ®åº“</title>
    <link href="/2022/12/01/%E5%85%B6%E4%BB%96/python/python%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2022/12/01/%E5%85%B6%E4%BB%96/python/python%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="pythonè¿æ¥æ•°æ®åº“"><a href="#pythonè¿æ¥æ•°æ®åº“" class="headerlink" title="pythonè¿æ¥æ•°æ®åº“"></a>pythonè¿æ¥æ•°æ®åº“</h2><h3 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h3><blockquote><p>é€šè¿‡pymysqlè¿›è¡Œæ•°æ®åº“æ“ä½œ</p></blockquote><h4 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># 1.åˆ›å»ºè¿æ¥</span><br>conn = pymysql.connect(host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>                       port=<span class="hljs-number">3306</span>,<br>                       user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                       password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>                       charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                       db=<span class="hljs-string">&#x27;pyconn&#x27;</span>)<br><br><span class="hljs-comment"># 2.åˆ›å»ºæ¸¸æ ‡ï¼ˆcursorï¼‰</span><br>cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)<br><br><span class="hljs-comment"># 3.æ‰§è¡Œsql</span><br>sql = <span class="hljs-string">&quot;&quot;&quot;CREATE TABLE admin(</span><br><span class="hljs-string">id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,</span><br><span class="hljs-string">username VARCHAR(16) NOT NULL,</span><br><span class="hljs-string">PASSWORD VARCHAR(64) NOT NULL,</span><br><span class="hljs-string">mobile CHAR(11) NOT NULL</span><br><span class="hljs-string">) DEFAULT CHARSET=utf8;&quot;&quot;&quot;</span><br><br>cursor.execute(sql)<br><br><span class="hljs-comment"># 4.æ–­å¼€è¿æ¥</span><br>conn.close()<br></code></pre></td></tr></table></figure><h4 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h4><blockquote><p>è¦ä½¿ç”¨connitæäº¤åˆ°æ•°æ®åº“</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1.åˆ›å»ºè¿æ¥</span><br>conn = pymysql.connect(host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>                       port=<span class="hljs-number">3306</span>,<br>                       user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                       password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>                       charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                       db=<span class="hljs-string">&#x27;pyconn&#x27;</span>)<br><span class="hljs-comment"># 2.åˆ›å»ºæ¸¸æ ‡ï¼ˆcursorï¼‰</span><br>cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)<br><br><span class="hljs-comment"># 3.ç”¨æ¸¸æ ‡executeæ‰§è¡Œsqlè¯­å¥</span><br>cursor.execute(<span class="hljs-string">&quot;insert into admin(username, password, mobile) values (&#x27;zs&#x27;,&#x27;123456&#x27;,&#x27;12312345678&#x27;)&quot;</span>)<br>conn.commit()<br><br><span class="hljs-comment"># 4.æ–­å¼€è¿æ¥</span><br>conn.close()<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸è¦ç”¨æ‹¼æ¥å­—ç¬¦ä¸²æ¥æ³¨å…¥å˜é‡ï¼Œè€Œæ˜¯ä½¿ç”¨pymysqlçš„å ä½ç¬¦</span><br>sql = <span class="hljs-string">&quot;insert into admin(username, password, mobile) values (%s,%s,%s)&quot;</span><br>cursor.execute(sql, [<span class="hljs-string">&#x27;ls&#x27;</span>, <span class="hljs-string">&#x27;123456&#x27;</span>, <span class="hljs-string">&#x27;45612345678&#x27;</span>])<br></code></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pthon"># å¯ä»¥ç»™å ä½ç¬¦èµ·å<br>sql = &quot;insert into admin(username, password, mobile) values (%(n1)s,%(n2)s,%(n3)s)&quot;<br>cursor.execute(sql, &#123;&#x27;n1&#x27;: &#x27;ww&#x27;, &#x27;n2&#x27;: &#x27;123456&#x27;, &#x27;n3&#x27;: &#x27;12345678123&#x27;&#125;)<br></code></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h4><blockquote><p>fetchone()ï¼šæŸ¥è¯¢ä¸€æ¡</p><p>fetchall(): è¿”å›æ‰€æœ‰ç»“æœçš„é›†åˆ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># 1.åˆ›å»ºè¿æ¥</span><br>conn = pymysql.connect(host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>                       port=<span class="hljs-number">3306</span>,<br>                       user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                       password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>                       charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                       db=<span class="hljs-string">&#x27;pyconn&#x27;</span>)<br><span class="hljs-comment"># 2.åˆ›å»ºæ¸¸æ ‡ï¼ˆcursorï¼‰</span><br>cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)<br><br><span class="hljs-comment"># 3.æ‰§è¡Œsql</span><br>sql = <span class="hljs-string">&#x27;select * from admin&#x27;</span><br>cursor.execute(sql)<br><br><span class="hljs-comment"># 3.1fetchone</span><br>data = cursor.fetchone()<br><br><span class="hljs-comment"># 3.2fetchall</span><br>data_list = cursor.fetchall()<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> data_list:<br>    <span class="hljs-built_in">print</span>(row)<br><br><span class="hljs-comment"># 4.æ–­å¼€è¿æ¥</span><br>conn.close()<br></code></pre></td></tr></table></figure><h4 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs pyhton">import pymysql<br><br># 1.åˆ›å»ºè¿æ¥<br>conn = pymysql.connect(host=&quot;127.0.0.1&quot;,<br>                       port=3306,<br>                       user=&#x27;root&#x27;,<br>                       password=&#x27;123456&#x27;,<br>                       charset=&#x27;utf8&#x27;,<br>                       db=&#x27;pyconn&#x27;)<br># 2.åˆ›å»ºæ¸¸æ ‡ï¼ˆcursorï¼‰<br>cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)<br><br># 3.æ‰§è¡Œsql<br>sql = &#x27;update admin set password = %s where id = %s&#x27;<br>cursor.execute(sql, [&#x27;987654&#x27;, &#x27;1&#x27;])<br>conn.commit()<br><br># 4.æ–­å¼€è¿æ¥<br>conn.close()<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># 1.åˆ›å»ºè¿æ¥</span><br>conn = pymysql.connect(host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>                       port=<span class="hljs-number">3306</span>,<br>                       user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                       password=<span class="hljs-string">&#x27;123456&#x27;</span>,<br>                       charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>                       db=<span class="hljs-string">&#x27;pyconn&#x27;</span>)<br><span class="hljs-comment"># 2.åˆ›å»ºæ¸¸æ ‡ï¼ˆcursorï¼‰</span><br>cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)<br><br><span class="hljs-comment"># 3.æ‰§è¡Œsql</span><br>sql = <span class="hljs-string">&#x27;delete from admin where id=%s&#x27;</span><br>cursor.execute(sql, [<span class="hljs-number">1</span>, ])<br>conn.commit()<br><br><span class="hljs-comment"># 4.æ–­å¼€è¿æ¥</span><br>conn.close()<br></code></pre></td></tr></table></figure><h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pythoon">try: <br>    sql = &#x27;delete from admin where id=%s&#x27;<br>    cursor.execute(sql, [1, ])<br>    conn.commit()<br>except:<br>    conn.rollback()# å›æ»šäº‹åŠ¡<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jsonè½¬æ¢</title>
    <link href="/2022/11/29/%E5%85%B6%E4%BB%96/json%E8%BD%AC%E6%8D%A2/"/>
    <url>/2022/11/29/%E5%85%B6%E4%BB%96/json%E8%BD%AC%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="jsonè½¬æ¢"><a href="#jsonè½¬æ¢" class="headerlink" title="jsonè½¬æ¢"></a>jsonè½¬æ¢</h2><h3 id="jackson"><a href="#jackson" class="headerlink" title="jackson"></a>jackson</h3><h4 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.13.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ï¼šJSONè½¬Java"><a href="#ä½¿ç”¨ï¼šJSONè½¬Java" class="headerlink" title="ä½¿ç”¨ï¼šJSONè½¬Java"></a>ä½¿ç”¨ï¼šJSONè½¬Java</h4><blockquote><p>æ“ä½œåŸºäº<strong>ObjectMapper</strong>å¯¹è±¡çš„**readValue()**æ¥å®Œæˆ</p><p>è½¬æ¢è§„åˆ™ï¼šå°†JSONå¯¹è±¡çš„å­—æ®µæ˜ å°„åˆ°Javaå¯¹è±¡ä¸­çš„å±æ€§ã€‚ Jacksonåˆ é™¤äº†getterå’Œsetteræ–¹æ³•åç§°çš„â€œ getâ€å’Œâ€œ setâ€éƒ¨åˆ†ï¼Œå¹¶å°†å…¶ä½™åç§°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚</p><p><strong>éœ€è¦å®ç°getã€setæ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">brand</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">doors</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">/** Getter and Setter */</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSON-â€“-gt-Javaå¯¹è±¡"><a href="#JSON-â€“-gt-Javaå¯¹è±¡" class="headerlink" title="JSON â€“&gt; Javaå¯¹è±¡"></a>JSON â€“&gt; Javaå¯¹è±¡</h5><blockquote><p>readValue()é‡è½½æ–¹æ³•å¯ä»¥ä¼ å…¥ï¼š</p><p>å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€å­—ç¬¦è¾“å…¥æµï¼ˆReaderï¼‰ã€å­—èŠ‚è¾“å…¥æµï¼ˆInputStreamï¼‰ã€</p><p>æ–‡ä»¶ï¼ˆFileï¼‰ã€URLã€äºŒè¿›åˆ¶ï¼ˆbyte[]ï¼‰ç­‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">carJson</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;&#123; \&quot;brand\&quot; : \&quot;Mercedes\&quot;, \&quot;doors\&quot; : 5 &#125;&quot;</span>;<br><br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> objectMapper.readValue(carJson, Car.class);<br><br>        System.out.println(car);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Javaå¯¹è±¡æ•°ç»„"><a href="#JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Javaå¯¹è±¡æ•°ç»„" class="headerlink" title="JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Javaå¯¹è±¡æ•°ç»„"></a>JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Javaå¯¹è±¡æ•°ç»„</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">jsonArray</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;[&#123;\&quot;brand\&quot;:\&quot;ford\&quot;&#125;, &#123;\&quot;brand\&quot;:\&quot;Fiat\&quot;&#125;]&quot;</span>;<br><br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        Car[] cars = objectMapper.readValue(jsonArray, Car[].class);<br><br>        <span class="hljs-keyword">for</span> (Car car : cars) &#123;<br>            System.out.println(car);<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-List"><a href="#JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-List" class="headerlink" title="JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; List"></a>JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; List</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;Car&gt; cars = objectMapper.readValue(jsonArray, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;Car&gt;&gt;() &#123;&#125;);<br></code></pre></td></tr></table></figure><h5 id="JSON-â€“-gt-Map"><a href="#JSON-â€“-gt-Map" class="headerlink" title="JSON â€“&gt; Map"></a>JSON â€“&gt; Map</h5><blockquote><p> JSONå¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½å°†æˆä¸ºJava Mapä¸­çš„é”®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;brand\&quot;:\&quot;ford\&quot;, \&quot;doors\&quot;:5&#125;&quot;</span>;<br><br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        Map&lt;String, Object&gt; cars = objectMapper.readValue(jsonObject, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, Object&gt;&gt;() &#123;&#125;);<br><br>        System.out.println(cars.keySet());<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å¿½ç•¥ä¸åŒ¹é…çš„å­—æ®µ"><a href="#å¿½ç•¥ä¸åŒ¹é…çš„å­—æ®µ" class="headerlink" title="å¿½ç•¥ä¸åŒ¹é…çš„å­—æ®µ"></a>å¿½ç•¥ä¸åŒ¹é…çš„å­—æ®µ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><h5 id="ä¸å…è®¸åŸºæœ¬ç±»å‹ä¸ºnull"><a href="#ä¸å…è®¸åŸºæœ¬ç±»å‹ä¸ºnull" class="headerlink" title="ä¸å…è®¸åŸºæœ¬ç±»å‹ä¸ºnull"></a>ä¸å…è®¸åŸºæœ¬ç±»å‹ä¸ºnull</h5><blockquote><p>é»˜è®¤ä¼šèµ‹ç©ºå€¼ï¼Œè®¾ç½®äº†è¿™ä¸ªåˆ™ä¼šæŠ¥é”™</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">objectMapper.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ï¼šJavaè½¬JSON"><a href="#ä½¿ç”¨ï¼šJavaè½¬JSON" class="headerlink" title="ä½¿ç”¨ï¼šJavaè½¬JSON"></a>ä½¿ç”¨ï¼šJavaè½¬JSON</h4><blockquote><p>æ“ä½œåŸºäº<strong>ObjectMapper</strong>å¯¹è±¡çš„**writeValue()&#x2F;writeValueAsString()&#x2F;writeValueAsBytes()**æ¥å®Œæˆ</p></blockquote><h5 id="Javaå¯¹è±¡-â€“-gt-JSON"><a href="#Javaå¯¹è±¡-â€“-gt-JSON" class="headerlink" title="Javaå¯¹è±¡ â€“&gt; JSON"></a>Javaå¯¹è±¡ â€“&gt; JSON</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br>    <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>    car.setBrand(<span class="hljs-string">&quot;BMW&quot;</span>);<br>    car.setDoors(<span class="hljs-number">4</span>);<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span>  <span class="hljs-operator">=</span> objectMapper.writeValueAsString(car);<br>        System.out.println(json);<br>    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å°†Dateç±»å‹è½¬ä¸ºString"><a href="#å°†Dateç±»å‹è½¬ä¸ºString" class="headerlink" title="å°†Dateç±»å‹è½¬ä¸ºString"></a>å°†Dateç±»å‹è½¬ä¸ºString</h5><blockquote><p>é»˜è®¤æ˜¯è½¬ä¸ºæ¯«ç§’</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>    <span class="hljs-comment">// è®¾ç½®æ—¥æœŸè½¬æ¢å™¨</span><br>    <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">simpleDateFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    objectMapper.setDateFormat(simpleDateFormat);<br><br>    <span class="hljs-type">Car</span> <span class="hljs-variable">car</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>    car.setBrand(<span class="hljs-string">&quot;BMW&quot;</span>);<br>    car.setDoors(<span class="hljs-number">4</span>);<br>    car.setData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span>  <span class="hljs-operator">=</span> objectMapper.writeValueAsString(car);<br>        System.out.println(json);<br>    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h4><table><thead><tr><th>æ³¨è§£</th><th><strong>ç”¨æ³•</strong></th></tr></thead><tbody><tr><td>@JsonProperty</td><td>ç”¨äºå±æ€§ï¼ŒæŠŠå±æ€§çš„åç§°åºåˆ—åŒ–æ—¶è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªåç§°ã€‚ç¤ºä¾‹ï¼š<br/>@JsonProperty(â€œbirth_ dateâ€)<br/>private Date birthDate;</td></tr><tr><td>@JsonFormat</td><td>ç”¨äºå±æ€§æˆ–è€…æ–¹æ³•ï¼ŒæŠŠå±æ€§çš„æ ¼å¼åºåˆ—åŒ–æ—¶è½¬æ¢æˆæŒ‡å®šçš„æ ¼å¼ã€‚ç¤ºä¾‹ï¼š<br/>  @JsonFormat(timezone &#x3D;â€GMT+8â€, pattern &#x3D; â€œyyyy-MM-dd HH:mmâ€) <br/>  public Date getBirthDate()</td></tr><tr><td>@JsonPropertyOrder</td><td>ç”¨äºç±»ï¼Œ æŒ‡å®šå±æ€§åœ¨åºåˆ—åŒ–æ—¶ json ä¸­çš„é¡ºåº ï¼Œ ç¤ºä¾‹ï¼š<br/>@JsonPropertyOrder({ â€œbirth_Dateâ€, â€œnameâ€ })<br/>public class Person</td></tr><tr><td>@JsonCreator</td><td>ç”¨äºæ„é€ æ–¹æ³•ï¼Œå’Œ @JsonProperty é…åˆä½¿ç”¨ï¼Œé€‚ç”¨æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚<br/> ç¤ºä¾‹ï¼š@JsonCreator<br/>public Person(@JsonProperty(â€œnameâ€)String name) {â€¦}</td></tr><tr><td>@JsonAnySetter</td><td>ç”¨äºå±æ€§æˆ–è€…æ–¹æ³•ï¼Œè®¾ç½®æœªååºåˆ—åŒ–çš„å±æ€§åå’Œå€¼ä½œä¸ºé”®å€¼å­˜å‚¨åˆ° map ä¸­<br/>@JsonAnySetter<br/>public void set(String key, Object value) {<br/>map.put(key, value);<br/>}</td></tr><tr><td>@JsonAnyGetter</td><td>ç”¨äºæ–¹æ³• ï¼Œè·å–æ‰€æœ‰æœªåºåˆ—åŒ–çš„å±æ€§<br/>public Map&lt;String, Object&gt; any() { return map; }</td></tr></tbody></table><h3 id="Gson"><a href="#Gson" class="headerlink" title="Gson"></a>Gson</h3><h4 id="ä¾èµ–-1"><a href="#ä¾èµ–-1" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºGson"><a href="#åˆ›å»ºGson" class="headerlink" title="åˆ›å»ºGson"></a>åˆ›å»ºGson</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç›´æ¥åˆ›å»º</span><br><span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br><span class="hljs-comment">// é€šè¿‡å·¥å‚ç±»åˆ›å»º</span><br><span class="hljs-type">GsonBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GsonBuilder</span>();<br><span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> builder.create();<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ï¼šJSONè½¬Java-1"><a href="#ä½¿ç”¨ï¼šJSONè½¬Java-1" class="headerlink" title="ä½¿ç”¨ï¼šJSONè½¬Java"></a>ä½¿ç”¨ï¼šJSONè½¬Java</h4><blockquote><p>æ“ä½œåŸºäº<strong>Gson</strong>å¯¹è±¡æ¥çš„**fromJson()**å®Œæˆ</p><p><strong>éœ€è¦å®ç°getã€setæ–¹æ³•</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String firstName;<br>    <span class="hljs-keyword">private</span> String lastName;<br>    <span class="hljs-keyword">private</span> String email;<br><br><span class="hljs-comment">// Getter and Setter</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSON-â€“-gt-Javaå¯¹è±¡-1"><a href="#JSON-â€“-gt-Javaå¯¹è±¡-1" class="headerlink" title="JSON â€“&gt; Javaå¯¹è±¡"></a>JSON â€“&gt; Javaå¯¹è±¡</h5><blockquote><p>ç±»ä¼¼jacksonçš„readValue()æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;&#x27;id&#x27;:1001, &#x27;firstName&#x27;:&#x27;Lokesh&#x27;, &#x27;lastName&#x27;:&#x27;Gupta&#x27;, &#x27;email&#x27;:&#x27;howtodoinjava@gmail.com&#x27;&#125;&quot;</span>;<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">empObject</span> <span class="hljs-operator">=</span> gson.fromJson(jsonString, Employee.class);<br>    System.out.println(empObject);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Javaå¯¹è±¡æ•°ç»„-1"><a href="#JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Javaå¯¹è±¡æ•°ç»„-1" class="headerlink" title="JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Javaå¯¹è±¡æ•°ç»„"></a>JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Javaå¯¹è±¡æ•°ç»„</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;[&#123;&#x27;id&#x27;:1001, &#x27;firstName&#x27;:&#x27;Lokesh&#x27;, &#x27;lastName&#x27;:&#x27;Gupta&#x27;, &#x27;email&#x27;:&#x27;howtodoinjava@gmail.com&#x27;&#125;,&quot;</span> +<br>        <span class="hljs-string">&quot;&#123;&#x27;id&#x27;:1001, &#x27;firstName&#x27;:&#x27;Lokesh&#x27;, &#x27;lastName&#x27;:&#x27;Gupta&#x27;, &#x27;email&#x27;:&#x27;howtodoinjava@gmail.com&#x27;&#125;]&quot;</span>;<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br>    Employee[] employees = gson.fromJson(json, Employee[].class);<br>    <span class="hljs-keyword">for</span> (Employee employee : employees) &#123;<br>        System.out.println(employee);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-List-1"><a href="#JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-List-1" class="headerlink" title="JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; List"></a>JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; List</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;[&#123;&#x27;id&#x27;:1001, &#x27;firstName&#x27;:&#x27;Lokesh&#x27;, &#x27;lastName&#x27;:&#x27;Gupta&#x27;, &#x27;email&#x27;:&#x27;howtodoinjava@gmail.com&#x27;&#125;,&quot;</span> +<br>        <span class="hljs-string">&quot;&#123;&#x27;id&#x27;:1001, &#x27;firstName&#x27;:&#x27;Lokesh&#x27;, &#x27;lastName&#x27;:&#x27;Gupta&#x27;, &#x27;email&#x27;:&#x27;howtodoinjava@gmail.com&#x27;&#125;]&quot;</span>;<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br>    ArrayList&lt;Employee&gt; employees = gson.fromJson(json, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeToken</span>&lt;ArrayList&lt;Employee&gt;&gt;() &#123;<br>    &#125;.getType());<br><br>    <span class="hljs-keyword">for</span> (Employee employee : employees) &#123;<br>        System.out.println(employee);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Set"><a href="#JSONæ•°ç»„å­—ç¬¦ä¸²-â€“-gt-Set" class="headerlink" title="JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Set"></a>JSONæ•°ç»„å­—ç¬¦ä¸² â€“&gt; Set</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Set&lt;Employee&gt; employees = gson.fromJson(json, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeToken</span>&lt;HashSet&lt;Employee&gt;&gt;() &#123;<br>       &#125;.getType());<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨ï¼šJavaè½¬Json"><a href="#ä½¿ç”¨ï¼šJavaè½¬Json" class="headerlink" title="ä½¿ç”¨ï¼šJavaè½¬Json"></a>ä½¿ç”¨ï¼šJavaè½¬Json</h4><blockquote><p>æ“ä½œåŸºäº<strong>Gson</strong>å¯¹è±¡çš„**toJson()**æ¥å®Œæˆ</p><p>é‡è½½æ”¯æŒset</p></blockquote><h5 id="Javaå¯¹è±¡-â€“-gt-JSON-1"><a href="#Javaå¯¹è±¡-â€“-gt-JSON-1" class="headerlink" title="Javaå¯¹è±¡ â€“&gt; JSON"></a>Javaå¯¹è±¡ â€“&gt; JSON</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1001</span>, <span class="hljs-string">&quot;Lokesh&quot;</span>, <span class="hljs-string">&quot;Gupta&quot;</span>, <span class="hljs-string">&quot;howtodoinjava@gmail.com&quot;</span>);<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">jsonString</span> <span class="hljs-operator">=</span> gson.toJson(emp);<br>    System.out.println(jsonString);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ ¼å¼åŒ–è¾“å‡º"><a href="#æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡º"></a>æ ¼å¼åŒ–è¾“å‡º</h5><blockquote><p>é€šè¿‡å·¥å‚ç±»åˆ›å»ºGsonï¼Œè®¾ç½®setPrettyPrinting</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Employee</span> <span class="hljs-variable">employeeObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Lokesh&quot;</span>, <span class="hljs-string">&quot;Gupta&quot;</span>, <span class="hljs-string">&quot;howtogoinjava@gmail.com&quot;</span>);<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GsonBuilder</span>()<br>        .setPrettyPrinting()<br>        .create();<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> gson.toJson(employeeObj);<br>    System.out.println(json);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æ‰“å°<br>&#123;<br>  <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Lokesh&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Gupta&quot;</span>,<br>  <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;howtogoinjava@gmail.com&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ³¨è§£-1"><a href="#æ³¨è§£-1" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h4><table><thead><tr><th>æ³¨è§£</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>@SerializedName</td><td>è‡ªå®šä¹‰å­—æ®µçš„åå­—</td></tr><tr><td>@Expose</td><td>åªè¦æœ‰ä¸€ä¸ªå­—æ®µä½¿ç”¨äº†Exposeæ³¨è§£ï¼Œæ‰€æœ‰éœ€è¦å‚ä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å­—æ®µéƒ½è¦æœ‰è¿™ä¸ªæ³¨è§£<br/>@Expose(deserialize &#x3D; false)å£°æ˜ä¸å‚ä¸ååºåˆ—åŒ–<br/>@Expose(serialize &#x3D; false)å£°æ˜è¯¥å­—æ®µä¸å‚ä¸åºåˆ—åŒ–</td></tr></tbody></table><h3 id="fastJson"><a href="#fastJson" class="headerlink" title="fastJson"></a>fastJson</h3><h4 id="ä¾èµ–-2"><a href="#ä¾èµ–-2" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.33<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨@Beanæ³¨å…¥fastJsonHttpMessageConvert</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> HttpMessageConverter <span class="hljs-title function_">fastJsonHttpMessageConverters</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//1.éœ€è¦å®šä¹‰ä¸€ä¸ªConvertè½¬æ¢æ¶ˆæ¯çš„å¯¹è±¡</span><br>        <span class="hljs-type">FastJsonHttpMessageConverter</span> <span class="hljs-variable">fastConverter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FastJsonHttpMessageConverter</span>();<br>        <span class="hljs-type">FastJsonConfig</span> <span class="hljs-variable">fastJsonConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FastJsonConfig</span>();<br>        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);<br>        fastJsonConfig.setDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br><br>        SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);<br><br>        fastJsonConfig.setSerializeConfig(SerializeConfig.globalInstance);<br>        fastConverter.setFastJsonConfig(fastJsonConfig);<br>        HttpMessageConverter&lt;?&gt; converter = fastConverter;<br>        <span class="hljs-keyword">return</span> converter;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;<br>        converters.add(fastJsonHttpMessageConverters());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shiro</title>
    <link href="/2022/11/26/%E5%85%B6%E4%BB%96/Shiro/"/>
    <url>/2022/11/26/%E5%85%B6%E4%BB%96/Shiro/</url>
    
    <content type="html"><![CDATA[<h1 id="Shiro"><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h1><p>å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/54176956">Shiroå®‰å…¨æ¡†æ¶ã€å¿«é€Ÿå…¥é—¨ã€‘å°±è¿™ä¸€ç¯‡ï¼ - çŸ¥ä¹ (zhihu.com)</a></p><h3 id="åšä»€ä¹ˆçš„"><a href="#åšä»€ä¹ˆçš„" class="headerlink" title="åšä»€ä¹ˆçš„"></a>åšä»€ä¹ˆçš„</h3><blockquote><p>å¼€æºå®‰å…¨æ¡†æ¶ï¼Œå¤„ç†èº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†</p><ul><li>è®¤è¯ï¼šè¯†åˆ«ç”¨æˆ·èº«ä»½ï¼ˆç™»å½•ï¼‰</li><li>æˆæƒï¼šç»™ç”¨æˆ·æŸäº›æ“ä½œçš„æƒé™ï¼ˆèµ‹äºˆè§’è‰²ï¼‰</li><li>åŠ å¯†ï¼šå¯¹æ•°æ®æºä½¿ç”¨åŠ å¯†ç®—æ³•</li><li>ä¼šè¯ç®¡ç†ï¼šç‰¹å®šäºç”¨æˆ·çš„ä¼šè¯ç®¡ç†</li></ul></blockquote><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h3><blockquote><p>åˆ†ä¸ºSubject,SecurityManagerå’Œ Realmä¸‰å±‚</p></blockquote><p><img src="/img/quick_img/Shior%E6%9E%B6%E6%9E%84.png"></p><h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><ul><li><strong>Subject</strong></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">å¯ä»¥æ˜¯ä¸€ä¸ªé€šè¿‡æµè§ˆå™¨è¯·æ±‚çš„ç”¨æˆ·ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿è¡Œçš„ç¨‹åº<br><br>Subjectåœ¨shiroä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¤–éƒ¨ç¨‹åºé€šè¿‡subjectè¿›è¡Œè®¤è¯æˆï¼Œè€Œsubjectæ˜¯é€šè¿‡SecurityManagerå®‰å…¨ç®¡ç†å™¨è¿›è¡Œè®¤è¯æˆæƒ<br></code></pre></td></tr></table></figure><ul><li><strong>SecurityManager</strong></li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">shiroçš„æ ¸å¿ƒ</span><br><span class="hljs-keyword"></span>å¯¹æ‰€æœ‰çš„<span class="hljs-keyword">subjectè¿›è¡Œå®‰å…¨ç®¡ç†ï¼Œå¯ä»¥å®Œæˆsubjectçš„è®¤è¯ã€æˆæƒç­‰</span><br><span class="hljs-keyword"></span>é€šè¿‡Authenticatorè®¤è¯å™¨è¿›è¡Œè®¤è¯<br>é€šè¿‡Authorizeræˆæƒå™¨è¿›è¡Œæˆæƒ<br>é€šè¿‡SessionManagerè¿›è¡Œä¼šè¯ç®¡ç†<br></code></pre></td></tr></table></figure><ul><li><strong>Realm</strong></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">æ•°æ®åº“è¯»å–+è®¤è¯åŠŸèƒ½+æˆæƒåŠŸèƒ½å®ç°<br>ç›¸å½“äºdatasourceæ•°æ®æºï¼ŒsecurityManagerè¿›è¡Œå®‰å…¨è®¤è¯éœ€è¦é€šè¿‡Realmè·å–ç”¨æˆ·æƒé™æ•°æ®<br></code></pre></td></tr></table></figure><ul><li>CacheManager</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å°†ç”¨æˆ·æƒé™æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ä»¥æé«˜æ€§èƒ½<br></code></pre></td></tr></table></figure><ul><li>Cryptography</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å¯†ç ç®¡ç†<br></code></pre></td></tr></table></figure><h3 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><h4 id="èº«ä»½è®¤è¯"><a href="#èº«ä»½è®¤è¯" class="headerlink" title="èº«ä»½è®¤è¯"></a>èº«ä»½è®¤è¯</h4><h5 id="ä»iniæ–‡ä»¶è¯»å–"><a href="#ä»iniæ–‡ä»¶è¯»å–" class="headerlink" title="ä»iniæ–‡ä»¶è¯»å–"></a>ä»iniæ–‡ä»¶è¯»å–</h5><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨resourceç›®å½•ä¸‹ç¼–å†™iniæ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#å£°æ˜ç”¨æˆ·è´¦å·</span><br><span class="hljs-section">[users]</span><br><span class="hljs-attr">jay</span>=<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloShiro</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shiroLogin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å¯¼å…¥æƒé™iniæ–‡ä»¶æ„å»ºæƒé™å·¥å‚</span><br>        <span class="hljs-type">IniSecurityManagerFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IniSecurityManagerFactory</span>(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>);<br>        <span class="hljs-comment">// ç”¨å·¥å‚æ„å»ºManager</span><br>        <span class="hljs-type">SecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> factory.getInstance();<br>        <span class="hljs-comment">// ä½¿Managerç”Ÿæ•ˆ</span><br>        SecurityUtils.setSecurityManager(securityManager);<br><br>        <span class="hljs-comment">// è·å–Subject</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">// åˆ›å»ºToken</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;jay&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-comment">// subjecté€šè¿‡tokenç™»å½•</span><br>        subject.login(token);<br>        System.out.println(<span class="hljs-string">&quot;æ˜¯å¦ç™»å½•æˆåŠŸï¼š&quot;</span> + subject.isAuthenticated());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="ä»Realmä¸­è¯»å–"><a href="#ä»Realmä¸­è¯»å–" class="headerlink" title="ä»Realmä¸­è¯»å–"></a>ä»Realmä¸­è¯»å–</h5><ol><li><p>ç¼–å†™serviceï¼Œæ¨¡æ‹Ÿä»æ•°æ®åº“è¯»å–ç”¨æˆ·å¯†ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">findPasswordByLoginName</span><span class="hljs-params">(String loginName)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–å¯†ç </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;123&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰Realm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefinitionRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-type">SecurityService</span> <span class="hljs-variable">securityService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityServiceImpl</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æˆæƒ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> principalCollection</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¤è¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> authenticationToken</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> AuthenticationException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">// è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> (String) authenticationToken.getPrincipal();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> securityService.findPasswordByLoginName(loginName);<br>        <span class="hljs-keyword">if</span> (password == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(password))<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnknownAccountException</span>(<span class="hljs-string">&quot;è´¦æˆ·ä¸å­˜åœ¨&quot;</span>);<br><span class="hljs-comment">// ä¼ é€’è´¦å·å’Œå¯†ç </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(loginName, password, <span class="hljs-built_in">this</span>.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨iniæ–‡ä»¶ä¸­è®¾ç½®realm</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[main]</span><br><span class="hljs-attr">definitionRealm</span>=com.xw.realm.DefinitionRealm<br><span class="hljs-attr">securityManager.realms</span>=<span class="hljs-variable">$definitionRealm</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™æµ‹è¯•ç±»</p><p>å’Œä¸Šé¢çš„ä¸€æ ·</p></li><li><p>è®¤è¯è¿‡ç¨‹</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl">S<span class="hljs-function"><span class="hljs-title">ubject</span> -&gt;</span> S<span class="hljs-function"><span class="hljs-title">ecurityManager</span> -&gt;</span> A<span class="hljs-function"><span class="hljs-title">uthenticator</span> -&gt;</span> R<span class="hljs-function"><span class="hljs-title">ealm</span> -&gt;</span> è‡ªå®šä¹‰Realmå°†æ•°æ®åº“ä¸­æŸ¥åˆ°çš„è´¦å·å¯†ç è¿”å›<br>æœ€ååœ¨Realmä¸­æ¯”è¾ƒSubjectä¼ è¿‡æ¥çš„Tokenå’Œæ•°æ®åº“ä¸­çš„æ˜¯å¦ä¸€è‡´<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç¼–ç è§£ç "><a href="#ç¼–ç è§£ç " class="headerlink" title="ç¼–ç è§£ç "></a>ç¼–ç è§£ç </h4><p><strong>é€šè¿‡shiroçš„Hexå’ŒBase64æ¥è¿›è¡Œç¼–ç è§£ç </strong></p><ol><li><p>ç¼–å†™å·¥å…·ç±»ï¼ˆæŠŠä¸¤ç§æ–¹å¼æ•´åˆåˆ°ä¸€ä¸ªå·¥å…·ç±»ä¸Šï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EncodesUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰ç…§16è¿›åˆ¶ç¼–ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> bytes</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encodeHex</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> &#123;<br>        <span class="hljs-keyword">return</span> Hex.encodeToString(bytes);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰ç…§16è¿›åˆ¶è§£ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> s</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] decodeHex(String s) &#123;<br>        <span class="hljs-keyword">return</span> Hex.decode(s);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰ç…§16è¿›åˆ¶ç¼–ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> bytes</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encodeBase64</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> &#123;<br>        <span class="hljs-keyword">return</span> Base64.encodeToString(bytes);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰ç…§16è¿›åˆ¶è§£ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> s</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] decodeBase64(String s) &#123;<br>        <span class="hljs-keyword">return</span> Base64.decode(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">pwd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br>    <span class="hljs-comment">// æµ‹è¯•16è¿›åˆ¶ç¼–ç è§£ç </span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">encode</span> <span class="hljs-operator">=</span> EncodesUtils.encodeHex(pwd.getBytes());<br>    <span class="hljs-type">String</span> <span class="hljs-variable">decode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(EncodesUtils.decodeHex(encode));<br>    System.out.println(decode.equals(pwd) ? <span class="hljs-string">&quot;ç›¸ç­‰&quot;</span> : <span class="hljs-string">&quot;ä¸ç›¸ç­‰&quot;</span>);<br>    <span class="hljs-comment">// æµ‹è¯•base64ç¼–ç è§£ç </span><br>    encode = EncodesUtils.encodeBase64(pwd.getBytes());<br>    decode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(EncodesUtils.decodeBase64(encode));<br>    System.out.println(decode.equals(pwd) ? <span class="hljs-string">&quot;ç›¸ç­‰&quot;</span> : <span class="hljs-string">&quot;ä¸ç›¸ç­‰&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p><strong>æ•£åˆ—ç®—æ³•</strong></p><p>é€šè¿‡SimpleHash(ç®—æ³•åç§°ï¼ŒåŸå¯†ç ï¼Œç›å€¼ï¼ŒåŠ å¯†æ¬¡æ•°)æ¥è¿›è¡ŒåŠ å¯†</p><ol><li><p>ç¼–å†™å·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DigestUtil</span> &#123;<br><br>    <span class="hljs-comment">// ç®—æ³•åç§°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SHA1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SHA-1&quot;</span>;<br><br>    <span class="hljs-comment">// åŠ å¯†æ¬¡æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">ITERATIONS</span> <span class="hljs-operator">=</span> <span class="hljs-number">512</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡sha1åŠ å¯†</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> s</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> salt</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">sha1</span><span class="hljs-params">(String s, String salt)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHash</span>(SHA1, s, salt, ITERATIONS).toString();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›åŠ å¯†åçš„å¯†ç å’Œç›å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> passwordPlain</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, String&gt; <span class="hljs-title function_">entryptPassword</span><span class="hljs-params">(String passwordPlain)</span> &#123;<br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">salt</span> <span class="hljs-operator">=</span> generateSalt();<br>        map.put(<span class="hljs-string">&quot;salt&quot;</span>, salt);<br>        map.put(<span class="hljs-string">&quot;password&quot;</span>, sha1(passwordPlain, salt));<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆéšæœºç›å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateSalt</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SecureRandomNumberGenerator</span> <span class="hljs-variable">randomNumberGenerator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandomNumberGenerator</span>();<br>        <span class="hljs-keyword">return</span> randomNumberGenerator.nextBytes().toHex();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">pwd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br>    Map&lt;String, String&gt; map = DigestUtil.entryptPassword(pwd);<br>    System.out.println(map.toString());<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="Realmä¸­æŒ‡å®šåŒ¹é…å™¨"><a href="#Realmä¸­æŒ‡å®šåŒ¹é…å™¨" class="headerlink" title="Realmä¸­æŒ‡å®šåŒ¹é…å™¨"></a>Realmä¸­æŒ‡å®šåŒ¹é…å™¨</h4><blockquote><p>è‡ªå®šä¹‰åŒ¹é…å™¨çš„ç›å€¼ï¼ŒåŠ å¯†æ¬¡æ•°</p></blockquote><ol><li><p>serviceå±‚è¿”å›åŠ å¯†åçš„å¯†ç å’Œç›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">findPasswordByLoginName</span><span class="hljs-params">(String loginName)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–å¯†ç </span><br>        <span class="hljs-keyword">return</span> DigestUtil.entryptPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è‡ªå®šä¹‰Realmé‡å†™æ„é€ å‡½æ•°ï¼Œè®¾ç½®åŒ¹é…å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefinitionRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-type">SecurityService</span> <span class="hljs-variable">securityService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityServiceImpl</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefinitionRealm</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºåŒ¹é…å™¨ï¼ŒæŒ‡å®šåŒ¹é…æ–¹å¼</span><br>        <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>(DigestUtil.SHA1);<br>        <span class="hljs-comment">// æŒ‡å®šè¿­ä»£æ¬¡æ•°</span><br>        matcher.setHashIterations(DigestUtil.ITERATIONS);<br>        <span class="hljs-comment">// ä½¿åŒ¹é…å™¨ç”Ÿæ•ˆ</span><br>        setCredentialsMatcher(matcher);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æˆæƒ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> principalCollection</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¤è¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> authenticationToken</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> AuthenticationException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">// è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> (String) authenticationToken.getPrincipal();<br>        Map&lt;String, String&gt; map = securityService.findPasswordByLoginName(loginName);<br>        <span class="hljs-keyword">if</span> (map.isEmpty())<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnknownAccountException</span>(<span class="hljs-string">&quot;è´¦æˆ·ä¸å­˜åœ¨&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">&quot;password&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">salt</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">&quot;salt&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(loginName, password, ByteSource.Util.bytes(salt), <span class="hljs-built_in">this</span>.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ol><h4 id="èº«ä»½æˆæƒ"><a href="#èº«ä»½æˆæƒ" class="headerlink" title="èº«ä»½æˆæƒ"></a>èº«ä»½æˆæƒ</h4><ol><li><p>serviceå±‚è¿”å›æŸ¥è¯¢åˆ°çš„è§’è‰²ã€æƒé™ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">findRoleByLoginName</span><span class="hljs-params">(String loginName)</span> &#123;<br>    <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–è§’è‰²</span><br>    List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    list.add(<span class="hljs-string">&quot;admin&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;dev&quot;</span>);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">findPermissionByLoginName</span><span class="hljs-params">(String loginName)</span> &#123;<br>    <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–æƒé™</span><br>    List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    list.add(<span class="hljs-string">&quot;order:add&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;order:list&quot;</span>);<br>    list.add(<span class="hljs-string">&quot;order:del&quot;</span>);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Realmä¸­æ„å»ºæ ¡éªŒä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefinitionRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-type">SecurityService</span> <span class="hljs-variable">securityService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityServiceImpl</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æˆæƒ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> principalCollection</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>        <span class="hljs-comment">// è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> (String) principalCollection.getPrimaryPrincipal();<br>        <span class="hljs-comment">// ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·è§’è‰²å’Œæƒé™</span><br>        List&lt;String&gt; roles = securityService.findRoleByLoginName(loginName);<br>        List&lt;String&gt; permissions = securityService.findPermissionByLoginName(loginName);<br>        <span class="hljs-comment">// æ„å»ºæ ¡éªŒä¿¡æ¯</span><br>        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">authenticationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();<br>        authenticationInfo.addRoles(roles);<br>        authenticationInfo.addStringPermissions(permissions);<br><br>        <span class="hljs-keyword">return</span> authenticationInfo;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPermissionRealm</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> shiroLogin();<br><br>    <span class="hljs-comment">// éªŒè¯è§’è‰²</span><br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦æœ‰adminè§’è‰²ï¼š&quot;</span> + subject.hasRole(<span class="hljs-string">&quot;admin&quot;</span>));<span class="hljs-comment">// true</span><br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦æœ‰coderè§’è‰²ï¼š&quot;</span> + subject.hasRole(<span class="hljs-string">&quot;coder&quot;</span>));<span class="hljs-comment">// false</span><br><br>    <span class="hljs-comment">// éªŒè¯æƒé™</span><br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦æœ‰æ·»åŠ è®¢å•æƒé™ï¼š&quot;</span> + subject.isPermitted(<span class="hljs-string">&quot;order:add&quot;</span>));<span class="hljs-comment">// true</span><br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦æœ‰ä¿®æ”¹è®¢å•æƒé™ï¼š&quot;</span> + subject.isPermitted(<span class="hljs-string">&quot;order:update&quot;</span>));<span class="hljs-comment">// false</span><br><br>&#125;<br><br><span class="hljs-keyword">public</span> Subject <span class="hljs-title function_">shiroLogin</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// å¯¼å…¥æƒé™iniæ–‡ä»¶æ„å»ºæƒé™å·¥å‚</span><br>    <span class="hljs-type">IniSecurityManagerFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IniSecurityManagerFactory</span>(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>);<br>    <span class="hljs-comment">// ç”¨å·¥å‚æ„å»ºManager</span><br>    <span class="hljs-type">SecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> factory.getInstance();<br>    <span class="hljs-comment">// ä½¿Managerç”Ÿæ•ˆ</span><br>    SecurityUtils.setSecurityManager(securityManager);<br><br>    <span class="hljs-comment">// è·å–subject</span><br>    <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>    <span class="hljs-comment">// åˆ›å»ºToken</span><br>    <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;jay&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>    <span class="hljs-comment">// subjecté€šè¿‡tokenç™»å½•</span><br>    subject.login(token);<br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦ç™»å½•æˆåŠŸï¼š&quot;</span> + subject.isAuthenticated());<br><br>    <span class="hljs-keyword">return</span> subject;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h3><h4 id="Shiroè®¤è¯è¿‡ç¨‹"><a href="#Shiroè®¤è¯è¿‡ç¨‹" class="headerlink" title="Shiroè®¤è¯è¿‡ç¨‹"></a>Shiroè®¤è¯è¿‡ç¨‹</h4><blockquote><p>éªŒè¯ç”¨æˆ·èº«ä»½</p></blockquote><p><img src="/img/quick_img/Shior%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B.png"></p><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationTest</span> &#123;<br><br>    <span class="hljs-type">SimpleAccountRealm</span> <span class="hljs-variable">simpleAccountRealm</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAccountRealm</span>();<br><br>    <span class="hljs-meta">@Before</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å¾€RealmåŸŸä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯</span><br>        simpleAccountRealm.addAccount(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAuthentication</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1.æ„å»ºSecurityManagerç¯å¢ƒ</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">defaultSecurityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        defaultSecurityManager.setRealm(simpleAccountRealm);<br><br>        SecurityUtils.setSecurityManager(defaultSecurityManager);   <span class="hljs-comment">// è®¾ç½®SecurityManagerç¯å¢ƒ</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();   <span class="hljs-comment">// è·å–å½“å‰ä¸»ä½“</span><br><br>        <span class="hljs-comment">// 2.ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        subject.login(token);   <span class="hljs-comment">// ç™»å½•</span><br><br>        System.out.println(<span class="hljs-string">&quot;isAuthenticated:&quot;</span> + subject.isAuthenticated());<br><br>        subject.logout();<br><br>        System.out.println(<span class="hljs-string">&quot;isAuthenticated:&quot;</span> + subject.isAuthenticated());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Shiroæˆæƒè¿‡ç¨‹"><a href="#Shiroæˆæƒè¿‡ç¨‹" class="headerlink" title="Shiroæˆæƒè¿‡ç¨‹"></a>Shiroæˆæƒè¿‡ç¨‹</h4><blockquote><p>èµ‹äºˆ&#x2F;éªŒè¯ç”¨æˆ·è§’è‰²</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationTest2</span> &#123;<br><br>    <span class="hljs-type">SimpleAccountRealm</span> <span class="hljs-variable">simpleAccountRealm</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAccountRealm</span>();<br><br>    <span class="hljs-meta">@Before</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å¾€RealmåŸŸä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯</span><br>        <span class="hljs-comment">// ä½¿å…¶å…·å¤‡adminå’Œuserä¸¤ä¸ªè§’è‰²</span><br>        simpleAccountRealm.addAccount(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAuthentication</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1.æ„å»ºSecurityManagerç¯å¢ƒ</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">defaultSecurityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        defaultSecurityManager.setRealm(simpleAccountRealm);<br><br>        SecurityUtils.setSecurityManager(defaultSecurityManager);   <span class="hljs-comment">// è®¾ç½®SecurityManagerç¯å¢ƒ</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();   <span class="hljs-comment">// è·å–å½“å‰ä¸»ä½“</span><br><br>        <span class="hljs-comment">// 2.ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        subject.login(token);   <span class="hljs-comment">// ç™»å½•</span><br><br>        System.out.println(<span class="hljs-string">&quot;isAuthenticated:&quot;</span> + subject.isAuthenticated());<br><br>        <span class="hljs-comment">// éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„è§’è‰²ï¼Œæ²¡æœ‰åˆ™æŠ¥é”™</span><br>        subject.checkRoles(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>);<br><br>        <span class="hljs-comment">// subject.checkRoles(&quot;admin&quot;, &quot;user&quot;, &quot;xxx&quot;); // UnauthorizedException</span><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰Realm"><a href="#è‡ªå®šä¹‰Realm" class="headerlink" title="è‡ªå®šä¹‰Realm"></a>è‡ªå®šä¹‰Realm</h4><blockquote><p>realmç±»ä¼¼MVCçš„repositoryå±‚</p></blockquote><p>è‡ªå®šä¹‰Realm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¨¡æ‹Ÿæ•°æ®åº“æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    Map&lt;String, String&gt; userMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);<br><br>    &#123;<br>        userMap.put(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-built_in">super</span>.setName(<span class="hljs-string">&quot;myRealm&quot;</span>); <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰Realmçš„åç§°</span><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æˆæƒ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> principalCollection</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> (String) principalCollection.getPrimaryPrincipal();<br><br>        <span class="hljs-comment">// ä»æ•°æ®åº“ä¸­è·å–è§’è‰²å’Œæƒé™æ•°æ®</span><br>        Set&lt;String&gt; roles = getRolesByUserName(userName);<br>        Set&lt;String&gt; permissions = getPermissionsByUserName(userName);<br><br>        <span class="hljs-comment">// æ·»åŠ åˆ°æˆæƒä¿¡æ¯ä¸­å¹¶è¿”å›</span><br>        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">simpleAuthorizationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();<br>        simpleAuthorizationInfo.setStringPermissions(permissions);<br>        simpleAuthorizationInfo.setRoles(roles);<br><br>        <span class="hljs-keyword">return</span> simpleAuthorizationInfo;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¤è¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> authenticationToken</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> AuthenticationException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) authenticationToken.getPrincipal();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> getPasswordByUserName(username);<br>        <span class="hljs-keyword">if</span> (password == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">SimpleAuthenticationInfo</span> <span class="hljs-variable">simpleAuthenticationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(<span class="hljs-string">&quot;user&quot;</span>, password, <span class="hljs-string">&quot;myRealm&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> simpleAuthenticationInfo;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®ç”¨æˆ·åè·å–æƒé™ä¿¡æ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; <span class="hljs-title function_">getPermissionsByUserName</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹ŸæŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›</span><br>        HashSet&lt;String&gt; permission = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        permission.add(<span class="hljs-string">&quot;user:delete&quot;</span>);<br>        permission.add(<span class="hljs-string">&quot;user:add&quot;</span>);<br>        <span class="hljs-keyword">return</span> permission;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–è§’è‰²æ•°æ®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userName</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; <span class="hljs-title function_">getRolesByUserName</span><span class="hljs-params">(String userName)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹ŸæŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›</span><br>        Set&lt;String&gt; roles = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        roles.add(<span class="hljs-string">&quot;admin&quot;</span>);<br>        roles.add(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-keyword">return</span> roles;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç”¨æˆ·å¯†ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userName</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getPasswordByUserName</span><span class="hljs-params">(String userName)</span> &#123;<br>        <span class="hljs-comment">// æ¨¡æ‹Ÿè·å–ç”¨æˆ·å¯†ç /å‡­è¯</span><br>        <span class="hljs-keyword">return</span> userMap.get(userName);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationTest3</span> &#123;<br><br>    <span class="hljs-type">MyRealm</span> <span class="hljs-variable">myRealm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRealm</span>();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAuthentication</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1.æ„å»ºSecurityManagerç¯å¢ƒ</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">defaultSecurityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        defaultSecurityManager.setRealm(myRealm);<br><br>        SecurityUtils.setSecurityManager(defaultSecurityManager);<br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();   <span class="hljs-comment">// è·å–å½“å‰ä¸»ä½“</span><br><br>        <span class="hljs-comment">// 2.ä¸»ä½“æäº¤è®¤è¯è¯·æ±‚</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        subject.login(token);   <span class="hljs-comment">// ç™»å½•</span><br><br>        subject.checkRoles(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>);<br><br>        subject.checkPermission(<span class="hljs-string">&quot;user:add&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ShiroåŠ å¯†"><a href="#ShiroåŠ å¯†" class="headerlink" title="ShiroåŠ å¯†"></a>ShiroåŠ å¯†</h4><blockquote><p>ä½¿ç”¨MD5åŠ å¯†å¯ä»¥ä½¿æ•°æ®åº“ä¸­çš„å¯†ç ä¸æ˜¯æ˜æ–‡ä¿å­˜ï¼Œæ•°æ®åº“æ³„éœ²çš„æŸå¤±ä¼šå‡å°</p><p>ä½†å¯ä»¥é€šè¿‡ç”¨ä¸€äº›ç®€å•å¸¸ç”¨çš„å¯†ç æ¥æ’åº“ï¼Œä»è€Œåæ¨åŸå¯†ç </p></blockquote><p>è§£å†³æ–¹å¼ï¼š</p><p><strong>åŠ ç›ï¼š</strong>åœ¨åŸå§‹å¯†ç ä¸ŠåŠ ä¸Šéšæœºæ•°ï¼Œå†è¿›è¡ŒMD5åŠ å¯†ã€‚éœ€è¦æŠŠéšæœºæ•°ä¹Ÿå­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä»¥ä¾¿ä¹‹åè¿›è¡ŒéªŒè¯</p><p><strong>å¤šæ¬¡åŠ å¯†</strong>ï¼šå¤šæ¬¡åŠ å¯†MD5ï¼Œä»è€Œè®©æ”»å‡»è€…ä¸çŸ¥é“åŠ å¯†çš„æ¬¡æ•°</p><p>Shiroå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationTest4</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAuthentication</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br><br>        <span class="hljs-comment">// ç›å€¼ï¼ˆéšæœºæ•°ï¼‰</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">salt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandomNumberGenerator</span>().nextBytes().toString();<br>        <span class="hljs-comment">// åŠ å¯†æ¬¡æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">times</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>        <span class="hljs-comment">// åŠ å¯†æ–¹å¼</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">alogrithmName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;md5&quot;</span>;<br><br>        <span class="hljs-type">SimpleHash</span> <span class="hljs-variable">encodePassword</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHash</span>(alogrithmName, password, salt, times);<br>        System.out.println(<span class="hljs-string">&quot;åŸå¯†ç ï¼š&quot;</span> + password);<br>        System.out.println(<span class="hljs-string">&quot;åŠ å¯†åï¼š&quot;</span> + encodePassword);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><a href="https://github.com/Xwww12/Shiro-">å°dmeo</a></p><h3 id="SpringBooté›†æˆShiro"><a href="#SpringBooté›†æˆShiro" class="headerlink" title="SpringBooté›†æˆShiro"></a>SpringBooté›†æˆShiro</h3><p><a href="https://blog.csdn.net/Yearingforthefuture/article/details/117384035">SpringBootä¹‹æ•´åˆShiro springboot+shiro</a></p><h4 id="æ•´åˆShiro"><a href="#æ•´åˆShiro" class="headerlink" title="æ•´åˆShiro"></a>æ•´åˆShiro</h4><h5 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--shiro--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="ç¼–å†™è‡ªå®šä¹‰Realm"><a href="#ç¼–å†™è‡ªå®šä¹‰Realm" class="headerlink" title="ç¼–å†™è‡ªå®šä¹‰Realm"></a>ç¼–å†™è‡ªå®šä¹‰Realm</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.shiro.realm;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¼–å†™Shiroé…ç½®ç±»"><a href="#ç¼–å†™Shiroé…ç½®ç±»" class="headerlink" title="ç¼–å†™Shiroé…ç½®ç±»"></a>ç¼–å†™Shiroé…ç½®ç±»</h5><p>ä¸»è¦é…ç½®è¿‡æ»¤å™¨ã€SecurityManagerã€Realm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.config;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShiroConfig</span> &#123;<br><br>    <span class="hljs-comment">// è¿‡æ»¤å™¨</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title function_">getShiroFilterFactoryBean</span><span class="hljs-params">(DefaultWebSecurityManager securityManager)</span> &#123;<br>        <span class="hljs-type">ShiroFilterFactoryBean</span> <span class="hljs-variable">shiroFilterFactoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShiroFilterFactoryBean</span>();<br>        <span class="hljs-comment">// ç»™ShiroFilteré…ç½®å®‰å…¨ç®¡ç†å™¨</span><br>        shiroFilterFactoryBean.setSecurityManager(securityManager);<br>        <span class="hljs-comment">//é…ç½®ç³»ç»Ÿå—é™èµ„æº</span><br>        <span class="hljs-comment">//é…ç½®ç³»ç»Ÿå…¬å…±èµ„æº</span><br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>        map.put(<span class="hljs-string">&quot;/index.jsp&quot;</span>,<span class="hljs-string">&quot;authc&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªèµ„æºéœ€è¦è®¤è¯å’Œæˆæƒ</span><br>        <span class="hljs-comment">// è®¾ç½®è®¤è¯ç•Œé¢è·¯å¾„</span><br>        shiroFilterFactoryBean.setLoginUrl(<span class="hljs-string">&quot;/login.jsp&quot;</span>);<br>        shiroFilterFactoryBean.setFilterChainDefinitionMap(map);<br><br>        <span class="hljs-keyword">return</span> shiroFilterFactoryBean;<br>    &#125;<br><br>    <span class="hljs-comment">// SecurityManager</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title function_">getDefaultWebSecurityManager</span><span class="hljs-params">(Realm realm)</span> &#123;<br>        <span class="hljs-type">DefaultWebSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWebSecurityManager</span>();<br>        securityManager.setRealm(realm);<br>        <span class="hljs-keyword">return</span> securityManager;<br>    &#125;<br><br>    <span class="hljs-comment">// è‡ªå®šä¹‰Realm</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Realm <span class="hljs-title function_">getRealm</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CustomerRealm</span> <span class="hljs-variable">customerRealm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerRealm</span>();<br>        <span class="hljs-keyword">return</span> customerRealm;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç™»å½•ç™»å‡º"><a href="#ç™»å½•ç™»å‡º" class="headerlink" title="ç™»å½•ç™»å‡º"></a>ç™»å½•ç™»å‡º</h4><h5 id="ç¼–å†™Controller"><a href="#ç¼–å†™Controller" class="headerlink" title="ç¼–å†™Controller"></a>ç¼–å†™Controller</h5><p>ç™»å½•ç™»å‡ºæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.controller;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// è·å–ä¸»ä½“</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">// é€€å‡º</span><br>        subject.logout();<br><br>        <span class="hljs-comment">// é‡å®šå‘åˆ°ç™»å½•ç•Œé¢</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/login.jsp&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password)</span> &#123;<br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(username, password);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// ç™»å½•</span><br>            subject.login(token);<br>            System.out.println(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/index.jsp&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·é”™è¯¯&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/login.jsp&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¼–å†™è‡ªå®šä¹‰Realmçš„è®¤è¯æ–¹æ³•"><a href="#ç¼–å†™è‡ªå®šä¹‰Realmçš„è®¤è¯æ–¹æ³•" class="headerlink" title="ç¼–å†™è‡ªå®šä¹‰Realmçš„è®¤è¯æ–¹æ³•"></a>ç¼–å†™è‡ªå®šä¹‰Realmçš„è®¤è¯æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¤è¯</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) authenticationToken.getPrincipal();<br>    <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–è´¦å·å¯†ç </span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;zhangsan&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br>    <span class="hljs-keyword">if</span> (account.equals(username)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(username, password, <span class="hljs-built_in">this</span>.getName());<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é…ç½®ç±»"><a href="#ä¿®æ”¹é…ç½®ç±»" class="headerlink" title="ä¿®æ”¹é…ç½®ç±»"></a>ä¿®æ”¹é…ç½®ç±»</h5><p>å°†loginæ–¹æ³•è®¾ä¸ºå…¬å…±èµ„æºï¼Œå…¶ä»–çš„ä¸ºå—é™èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;();<br>map.put(<span class="hljs-string">&quot;/user/login&quot;</span>,<span class="hljs-string">&quot;anon&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªä¸ºå…¬å…±èµ„æº ä¸€å®šæ˜¯åœ¨å—é™èµ„æºä¸Šé¢</span><br>map.put(<span class="hljs-string">&quot;/**&quot;</span>,<span class="hljs-string">&quot;authc&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªå—é™èµ„æºéœ€è¦è®¤è¯å’Œæˆæƒ</span><br></code></pre></td></tr></table></figure><h4 id="MD5ã€Saltè®¤è¯"><a href="#MD5ã€Saltè®¤è¯" class="headerlink" title="MD5ã€Saltè®¤è¯"></a>MD5ã€Saltè®¤è¯</h4><h5 id="ç¼–å†™ç”Ÿæˆç›å€¼å·¥å…·ç±»"><a href="#ç¼–å†™ç”Ÿæˆç›å€¼å·¥å…·ç±»" class="headerlink" title="ç¼–å†™ç”Ÿæˆç›å€¼å·¥å…·ç±»"></a>ç¼–å†™ç”Ÿæˆç›å€¼å·¥å…·ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.utils;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaltUtil</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSalt</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandomNumberGenerator</span>().nextBytes().toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¼–å†™è·å–å¯¹è±¡å·¥å…·ç±»"><a href="#ç¼–å†™è·å–å¯¹è±¡å·¥å…·ç±»" class="headerlink" title="ç¼–å†™è·å–å¯¹è±¡å·¥å…·ç±»"></a>ç¼–å†™è·å–å¯¹è±¡å·¥å…·ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.utils;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextUtil</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextAware</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ApplicationContext context;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-built_in">this</span>.context = applicationContext;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String beanName)</span> &#123;<br>        <span class="hljs-keyword">return</span> context.getBean(beanName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¼–å†™Serviceæ³¨å†Œæ–¹æ³•"><a href="#ç¼–å†™Serviceæ³¨å†Œæ–¹æ³•" class="headerlink" title="ç¼–å†™Serviceæ³¨å†Œæ–¹æ³•"></a>ç¼–å†™Serviceæ³¨å†Œæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.service.impl;<br><br><span class="hljs-meta">@Service(&quot;userService&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-comment">// æ·»åŠ ç›å€¼</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">salt</span> <span class="hljs-operator">=</span> SaltUtil.getSalt();<br>        user.setSalt(salt);<br>        <span class="hljs-comment">// æ˜æ–‡å¯†ç è¿›è¡Œmd5 + salt + hashæ•£åˆ—</span><br>        <span class="hljs-type">Md5Hash</span> <span class="hljs-variable">MD5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Md5Hash</span>(user.getPassword(), salt, <span class="hljs-number">1024</span>);<br>        user.setPassword(MD5.toHex());<br>        userMapper.save(user);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-keyword">return</span> userMapper.findByUsername(username);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="è‡ªå®šä¹‰Realmä¸­æ”¹ä¸ºä»Serviceä¸­è·å–æ•°æ®"><a href="#è‡ªå®šä¹‰Realmä¸­æ”¹ä¸ºä»Serviceä¸­è·å–æ•°æ®" class="headerlink" title="è‡ªå®šä¹‰Realmä¸­æ”¹ä¸ºä»Serviceä¸­è·å–æ•°æ®"></a>è‡ªå®šä¹‰Realmä¸­æ”¹ä¸ºä»Serviceä¸­è·å–æ•°æ®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¤è¯</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) authenticationToken.getPrincipal();<br>    <span class="hljs-comment">// è·å–userServiceå¯¹è±¡</span><br>    <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> (UserService) ApplicationContextUtil.getBean(<span class="hljs-string">&quot;userService&quot;</span>);<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findByUsername(username);<br>    <span class="hljs-keyword">if</span> (!ObjectUtils.isEmpty(user)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(user.getUsername(), user.getPassword(), ByteSource.Util.bytes(user.getSalt()), <span class="hljs-built_in">this</span>.getName());<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é…ç½®ç±»-1"><a href="#ä¿®æ”¹é…ç½®ç±»-1" class="headerlink" title="ä¿®æ”¹é…ç½®ç±»"></a>ä¿®æ”¹é…ç½®ç±»</h5><p>ä¿®æ”¹å…¬å…±èµ„æºå’Œæ·»åŠ åŒ¹é…å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">map.put(<span class="hljs-string">&quot;/user/login&quot;</span>,<span class="hljs-string">&quot;anon&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªä¸ºå…¬å…±èµ„æº ä¸€å®šæ˜¯åœ¨å—é™èµ„æºä¸Šé¢</span><br>map.put(<span class="hljs-string">&quot;/user/register&quot;</span>,<span class="hljs-string">&quot;anon&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªä¸ºå…¬å…±èµ„æº ä¸€å®šæ˜¯åœ¨å—é™èµ„æºä¸Šé¢</span><br>map.put(<span class="hljs-string">&quot;/register.jsp&quot;</span>,<span class="hljs-string">&quot;anon&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªä¸ºå…¬å…±èµ„æº ä¸€å®šæ˜¯åœ¨å—é™èµ„æºä¸Šé¢</span><br>map.put(<span class="hljs-string">&quot;/**&quot;</span>,<span class="hljs-string">&quot;authc&quot;</span>);<span class="hljs-comment">//è¡¨ç¤ºè¿™ä¸ªå—é™èµ„æºéœ€è¦è®¤è¯å’Œæˆæƒ</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰Realm</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Realm <span class="hljs-title function_">getRealm</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åŒ¹é…å™¨</span><br>    <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();<br>    credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>);<br>    credentialsMatcher.setHashIterations(<span class="hljs-number">1024</span>);<br>    <span class="hljs-comment">// æ·»åŠ åŒ¹é…å™¨</span><br>    <span class="hljs-type">CustomerRealm</span> <span class="hljs-variable">customerRealm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerRealm</span>();<br>    customerRealm.setCredentialsMatcher(credentialsMatcher);<br>    <span class="hljs-keyword">return</span> customerRealm;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h4><h5 id="æˆäºˆè§’è‰²å’Œæƒé™"><a href="#æˆäºˆè§’è‰²å’Œæƒé™" class="headerlink" title="æˆäºˆè§’è‰²å’Œæƒé™"></a>æˆäºˆè§’è‰²å’Œæƒé™</h5><p>User &lt;â€“&gt; Role &lt;â€“&gt; Perm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æˆæƒ</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> &#123;<br>    <span class="hljs-comment">// è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> (String) principalCollection.getPrimaryPrincipal();<br>    <span class="hljs-comment">// è·å–UserService</span><br>    <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> (UserService) ApplicationContextUtil.getBean(<span class="hljs-string">&quot;userService&quot;</span>);<br><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findRoleByUsername(principal);<br>    <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(user.getRoles())) &#123;<br>        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();<br>        user.getRoles().forEach(role -&gt; &#123;<br>            <span class="hljs-comment">// å°†ç”¨æˆ·è§’è‰²æ”¾åˆ°infoä¸­å¹¶è¿”å›</span><br>            info.addRole(role.getName());<br>            <span class="hljs-comment">// æ ¹æ®è§’è‰²idè·å–è§’è‰²å¯¹åº”çš„æƒé™ä¿¡æ¯</span><br>            List&lt;Perms&gt; perms = userService.findPermsByRoleId2(role.getId());<br>            <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(perms) &amp;&amp; perms.get(<span class="hljs-number">0</span>) != <span class="hljs-literal">null</span>) &#123;<br>                perms.forEach(perm -&gt; info.addStringPermission(perm.getName()));<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åˆ¤æ–­æ˜¯å¦æœ‰è§’è‰²å’Œæƒé™"><a href="#åˆ¤æ–­æ˜¯å¦æœ‰è§’è‰²å’Œæƒé™" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æœ‰è§’è‰²å’Œæƒé™"></a>åˆ¤æ–­æ˜¯å¦æœ‰è§’è‰²å’Œæƒé™</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.controller;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br>    <span class="hljs-comment">// åŸºäºæ–¹æ³•</span><br><span class="hljs-comment">//    @RequestMapping(&quot;save&quot;)</span><br><span class="hljs-comment">//    public String save() &#123;</span><br><span class="hljs-comment">//        //åŸºäºè§’è‰²</span><br><span class="hljs-comment">//        //è·å–ä¸»ä½“å¯¹è±¡</span><br><span class="hljs-comment">//        Subject subject = SecurityUtils.getSubject();</span><br><span class="hljs-comment">//        //ä»£ç æ–¹å¼</span><br><span class="hljs-comment">//        if (subject.hasRole(&quot;admin&quot;)) &#123;</span><br><span class="hljs-comment">//            System.out.println(&quot;ä¿å­˜è®¢å•!&quot;);</span><br><span class="hljs-comment">//        &#125;else&#123;</span><br><span class="hljs-comment">//            System.out.println(&quot;æ— æƒè®¿é—®!&quot;);</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//        System.out.println(&quot;è¿›å…¥saveæ–¹æ³•============&quot;);</span><br><span class="hljs-comment">//        return &quot;redircet:/index.jsp&quot;;</span><br><span class="hljs-comment">//    &#125;</span><br><br>    <span class="hljs-comment">// åŸºäºæ³¨è§£</span><br>    <span class="hljs-meta">@RequiresRoles(value=&#123;&quot;admin&quot;,&quot;user&quot;&#125;)</span><span class="hljs-comment">//ç”¨æ¥åˆ¤æ–­è§’è‰²  åŒæ—¶å…·æœ‰ admin user</span><br>    <span class="hljs-meta">@RequiresPermissions(&quot;user:update:01&quot;)</span> <span class="hljs-comment">//ç”¨æ¥åˆ¤æ–­æƒé™å­—ç¬¦ä¸²</span><br>    <span class="hljs-meta">@RequestMapping(&quot;save&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">save</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿›å…¥æ–¹æ³•&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/index.jsp&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å¯ç”¨ç¼“å­˜"><a href="#å¯ç”¨ç¼“å­˜" class="headerlink" title="å¯ç”¨ç¼“å­˜"></a>å¯ç”¨ç¼“å­˜</h4><p>å°†ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å»æ•°æ®åº“æŸ¥</p><h5 id="EhCache"><a href="#EhCache" class="headerlink" title="EhCache"></a>EhCache</h5><blockquote><p>EhCacheæ˜¯shiroçš„é»˜è®¤ç¼“å­˜</p></blockquote><p><strong>å¯¼å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®ç¼“å­˜ç®¡ç†å™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Realm <span class="hljs-title function_">getRealm</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åŒ¹é…å™¨</span><br>    <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();<br>    credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>);<br>    credentialsMatcher.setHashIterations(<span class="hljs-number">1024</span>);<br>    <span class="hljs-comment">// æ·»åŠ åŒ¹é…å™¨</span><br>    <span class="hljs-type">CustomerRealm</span> <span class="hljs-variable">customerRealm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerRealm</span>();<br>    customerRealm.setCredentialsMatcher(credentialsMatcher);<br><br>    <span class="hljs-comment">// å¼€å¯ç¼“å­˜ç®¡ç†å™¨</span><br>    customerRealm.setCacheManager(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EhCacheManager</span>());<br>    customerRealm.setCachingEnabled(<span class="hljs-literal">true</span>);<span class="hljs-comment">//å¼€å¯ç¼“å­˜</span><br>    customerRealm.setAuthenticationCachingEnabled(<span class="hljs-literal">true</span>);<span class="hljs-comment">//å¼€å¯è®¤è¯ç¼“å­˜</span><br>    customerRealm.setAuthenticationCacheName(<span class="hljs-string">&quot;authentication&quot;</span>);<br>    customerRealm.setAuthorizationCachingEnabled(<span class="hljs-literal">true</span>);<span class="hljs-comment">//å¼€å¯æˆæƒç¼“å­˜</span><br>    customerRealm.setAuthorizationCacheName(<span class="hljs-string">&quot;authorization&quot;</span>);<br>    <span class="hljs-keyword">return</span> customerRealm;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h5><p><strong>å¯¼å…¥ä¾èµ–</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p><strong>é…ç½®Redis</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™Redisç¼“å­˜ç®¡ç†å™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.config.redis;<br><br><span class="hljs-keyword">import</span> com.xw.utils.ApplicationContextUtil;<br><span class="hljs-keyword">import</span> org.apache.shiro.cache.Cache;<br><span class="hljs-keyword">import</span> org.apache.shiro.cache.CacheException;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><br><span class="hljs-keyword">import</span> java.util.Collection;<br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰redisç¼“å­˜çš„å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCache</span>&lt;k,v&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span>&lt;k,v&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> String cacheName;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisCache</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisCache</span><span class="hljs-params">(String cacheName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cacheName = cacheName;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> v <span class="hljs-title function_">get</span><span class="hljs-params">(k k)</span> <span class="hljs-keyword">throws</span> CacheException &#123;<br>        <span class="hljs-keyword">return</span> (v) getRedisTemplate().opsForHash().get(<span class="hljs-built_in">this</span>.cacheName, k.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> v <span class="hljs-title function_">put</span><span class="hljs-params">(k k, v v)</span> <span class="hljs-keyword">throws</span> CacheException &#123;<br>        System.out.println(<span class="hljs-string">&quot;put key: &quot;</span>+k);<br>        System.out.println(<span class="hljs-string">&quot;put value:&quot;</span>+v);<br>        getRedisTemplate().opsForHash().put(<span class="hljs-built_in">this</span>.cacheName,k.toString(), v);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> v <span class="hljs-title function_">remove</span><span class="hljs-params">(k k)</span> <span class="hljs-keyword">throws</span> CacheException &#123;<br>        System.out.println(<span class="hljs-string">&quot;=============remove=============&quot;</span>);<br>        <span class="hljs-keyword">return</span> (v) getRedisTemplate().opsForHash().delete(<span class="hljs-built_in">this</span>.cacheName,k.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CacheException &#123;<br>        System.out.println(<span class="hljs-string">&quot;=============clear==============&quot;</span>);<br>        getRedisTemplate().delete(<span class="hljs-built_in">this</span>.cacheName);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> getRedisTemplate().opsForHash().size(<span class="hljs-built_in">this</span>.cacheName).intValue();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Set&lt;k&gt; <span class="hljs-title function_">keys</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> getRedisTemplate().opsForHash().keys(<span class="hljs-built_in">this</span>.cacheName);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Collection&lt;v&gt; <span class="hljs-title function_">values</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> getRedisTemplate().opsForHash().values(<span class="hljs-built_in">this</span>.cacheName);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> RedisTemplate <span class="hljs-title function_">getRedisTemplate</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtil.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        <span class="hljs-keyword">return</span> redisTemplate;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.config.redis;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCacheManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CacheManager</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;K, V&gt; Cache&lt;K, V&gt; <span class="hljs-title function_">getCache</span><span class="hljs-params">(String cacheName)</span> <span class="hljs-keyword">throws</span> CacheException &#123;<br>        System.out.println(cacheName);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisCache</span>&lt;K, V&gt;(cacheName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¼€å¯ç¼“å­˜ç®¡ç†å™¨çš„åœ°æ–¹æ”¹æˆRedisCacheManager</strong></p><p><strong>simpleByteSourceå®ç°æ²¡æœ‰å®ç°åºåˆ—åŒ–ï¼Œå¦‚æœä½¿ç”¨åˆ°äº†ç›å€¼ï¼Œéœ€è¦è‡ªå®šä¹‰ç›å€¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.shiro.salt;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰saltå®ç° å®ç°åºåˆ—åŒ–æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyByteSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ByteSource</span>, Serializable &#123;<br>    <span class="hljs-keyword">private</span>  <span class="hljs-type">byte</span>[] bytes;<br>    <span class="hljs-keyword">private</span> String cachedHex;<br>    <span class="hljs-keyword">private</span> String cachedBase64;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = bytes;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(<span class="hljs-type">char</span>[] chars)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = CodecSupport.toBytes(chars);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(String string)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = CodecSupport.toBytes(string);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(ByteSource source)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = source.getBytes();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(File file)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyByteSource</span>.BytesHelper()).getBytes(file);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyByteSource</span><span class="hljs-params">(InputStream stream)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bytes = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyByteSource</span>.BytesHelper()).getBytes(stream);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCompatible</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> o <span class="hljs-keyword">instanceof</span> <span class="hljs-type">byte</span>[] || o <span class="hljs-keyword">instanceof</span> <span class="hljs-type">char</span>[] || o <span class="hljs-keyword">instanceof</span> String || o <span class="hljs-keyword">instanceof</span> ByteSource || o <span class="hljs-keyword">instanceof</span> File || o <span class="hljs-keyword">instanceof</span> InputStream;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.bytes;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.bytes == <span class="hljs-literal">null</span> || <span class="hljs-built_in">this</span>.bytes.length == <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toHex</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cachedHex == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-built_in">this</span>.cachedHex = Hex.encodeToString(<span class="hljs-built_in">this</span>.getBytes());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.cachedHex;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toBase64</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cachedBase64 == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-built_in">this</span>.cachedBase64 = Base64.encodeToString(<span class="hljs-built_in">this</span>.getBytes());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.cachedBase64;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.toBase64();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.bytes != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.bytes.length != <span class="hljs-number">0</span> ? Arrays.hashCode(<span class="hljs-built_in">this</span>.bytes) : <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">if</span> (o == <span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (o <span class="hljs-keyword">instanceof</span> ByteSource) &#123;<br>            <span class="hljs-type">ByteSource</span> <span class="hljs-variable">bs</span> <span class="hljs-operator">=</span> (ByteSource)o;<br>            <span class="hljs-keyword">return</span> Arrays.equals(<span class="hljs-built_in">this</span>.getBytes(), bs.getBytes());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BytesHelper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CodecSupport</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-title function_">BytesHelper</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes(File file) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.toBytes(file);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes(InputStream stream) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.toBytes(stream);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŠŠè‡ªå®šä¹‰Realmä¸­è®¤è¯åœ°æ–¹çš„simpleByteSourceæ”¹æˆè‡ªå®šä¹‰çš„MyByteSource</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>javaå¹¶å‘ç¼–ç¨‹ï¼ˆæ¨¡å¼ï¼‰</title>
    <link href="/2022/11/24/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E6%A8%A1%E5%BC%8F%EF%BC%89/"/>
    <url>/2022/11/24/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E6%A8%A1%E5%BC%8F%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="javaå¹¶å‘ç¼–ç¨‹ï¼ˆæ¨¡å¼ï¼‰"><a href="#javaå¹¶å‘ç¼–ç¨‹ï¼ˆæ¨¡å¼ï¼‰" class="headerlink" title="javaå¹¶å‘ç¼–ç¨‹ï¼ˆæ¨¡å¼ï¼‰"></a>javaå¹¶å‘ç¼–ç¨‹ï¼ˆæ¨¡å¼ï¼‰</h2><h3 id="ä¿æŠ¤æ€§æš‚åœ"><a href="#ä¿æŠ¤æ€§æš‚åœ" class="headerlink" title="ä¿æŠ¤æ€§æš‚åœ"></a>ä¿æŠ¤æ€§æš‚åœ</h3><blockquote><p> ç”¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœ</p><p> ä¿æŠ¤æ€§æš‚åœæ˜¯<strong>åŒæ­¥çš„</strong></p></blockquote><p><img src="/img/bingfa_img/GuardedSuspension.png"></p><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.text4&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test4</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">GuardedObject</span> <span class="hljs-variable">guardedObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuardedObject</span>();<br>        <span class="hljs-comment">// çº¿ç¨‹1ç­‰å¾…çº¿ç¨‹2çš„ç»“æœ</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;ç­‰å¾…ç»“æœ&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> (String)guardedObject.get();<br>            log.debug(<span class="hljs-string">&quot;ç»“æœ&quot;</span> + str);<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">3000</span>);<br>                log.debug(<span class="hljs-string">&quot;äº§ç”Ÿç»“æœ&quot;</span>);<br>                guardedObject.complete(<span class="hljs-string">&quot;aaaaa&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;t2&quot;</span>).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GuardedObject</span>&#123;<br><br>    <span class="hljs-keyword">private</span> Object response;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è¿™é‡Œç”¨whileæ˜¯ä¸ºäº†è§£å†³è™šå‡å”¤é†’é—®é¢˜</span><br>                <span class="hljs-keyword">while</span> (response == <span class="hljs-literal">null</span>)<br>                    <span class="hljs-built_in">this</span>.wait();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br><br>    <span class="hljs-comment">// å¸¦è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>            <span class="hljs-type">long</span> <span class="hljs-variable">passedTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">while</span> (response == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">waitTime</span> <span class="hljs-operator">=</span> timeout - passedTime;<br>                    <span class="hljs-keyword">if</span> (waitTime &lt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-built_in">this</span>.wait(waitTime);<br>                    passedTime = System.currentTimeMillis() - begin;<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Object response)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-built_in">this</span>.response = response;<br>            <span class="hljs-built_in">this</span>.notifyAll();<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¿æŠ¤æ€§æš‚åœä¾‹å­</strong></p><blockquote><p>é‚®é€’å‘˜é€ä¿¡ï¼Œå±…æ°‘æ”¶ä¿¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.text4&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test4</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>            <span class="hljs-type">People</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>();<br>            people.start();<br>        &#125;<br>        Thread.sleep(<span class="hljs-number">500</span>);<br>        <span class="hljs-keyword">for</span> (Integer id : Mailboxes.getIds()) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Postman</span>(id, <span class="hljs-string">&quot;å†…å®¹&quot;</span> + id).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.People&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ”¶ä¿¡</span><br>        <span class="hljs-type">GuardedObject</span> <span class="hljs-variable">guardedObject</span> <span class="hljs-operator">=</span> Mailboxes.createGuardedObject();<br>        log.debug(<span class="hljs-string">&quot;å¼€å§‹æ”¶ä¿¡ï¼š&#123;&#125;&quot;</span>, guardedObject.getId());<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">mail</span> <span class="hljs-operator">=</span> guardedObject.get(<span class="hljs-number">5000</span>);<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;æ”¶åˆ°ä¿¡ï¼š&#123;&#125;&quot;</span>, guardedObject.getId(), mail);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.Postman&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Postman</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String mail;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// é€ä¿¡</span><br>        <span class="hljs-type">GuardedObject</span> <span class="hljs-variable">go</span> <span class="hljs-operator">=</span> Mailboxes.getGuardedObject(<span class="hljs-built_in">this</span>.id);<br>        go.complete(mail);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Postman</span><span class="hljs-params">(<span class="hljs-type">int</span> id, String mail)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.mail = mail;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mailboxes</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;Integer, GuardedObject&gt; boxes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">generateId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id++;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> GuardedObject <span class="hljs-title function_">createGuardedObject</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">GuardedObject</span> <span class="hljs-variable">go</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuardedObject</span>(generateId());<br>        boxes.put(go.getId(), go);<br>        <span class="hljs-keyword">return</span> go;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;Integer&gt; <span class="hljs-title function_">getIds</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> boxes.keySet();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GuardedObject <span class="hljs-title function_">getGuardedObject</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-keyword">return</span> boxes.remove(id);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GuardedObject</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br><br>    <span class="hljs-keyword">private</span> Object response;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GuardedObject</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GuardedObject</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è¿™é‡Œç”¨whileæ˜¯ä¸ºäº†è§£å†³è™šå‡å”¤é†’é—®é¢˜</span><br>                <span class="hljs-keyword">while</span> (response == <span class="hljs-literal">null</span>)<br>                    <span class="hljs-built_in">this</span>.wait();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br><br>    <span class="hljs-comment">// å¸¦è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>            <span class="hljs-type">long</span> <span class="hljs-variable">passedTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">while</span> (response == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">waitTime</span> <span class="hljs-operator">=</span> timeout - passedTime;<br>                    <span class="hljs-keyword">if</span> (waitTime &lt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-built_in">this</span>.wait(waitTime);<br>                    passedTime = System.currentTimeMillis() - begin;<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(Object response)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-built_in">this</span>.response = response;<br>            <span class="hljs-built_in">this</span>.notifyAll();<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…-x2F-æ¶ˆè´¹è€…"><a href="#ç”Ÿäº§è€…-x2F-æ¶ˆè´¹è€…" class="headerlink" title="ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…"></a>ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…</h3><blockquote><p>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°</p><p>æ˜¯<strong>å¼‚æ­¥çš„</strong></p></blockquote><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageQueue</span> &#123;<br>    <span class="hljs-keyword">private</span> LinkedList&lt;Message&gt; list;<br>    <span class="hljs-comment">// å®¹é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> capcity;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MessageQueue</span><span class="hljs-params">(<span class="hljs-type">int</span> capcity)</span> &#123;<br>        list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        <span class="hljs-built_in">this</span>.capcity = capcity;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">take</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-comment">// æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span><br>            <span class="hljs-keyword">while</span> (list.isEmpty()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.debug(<span class="hljs-string">&quot;é˜Ÿåˆ—ä¸ºç©º&quot;</span>);<br>                    <span class="hljs-built_in">this</span>.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// è¿”å›å¹¶åˆ é™¤é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ </span><br>            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> list.removeFirst();<br>            <span class="hljs-built_in">this</span>.notifyAll();   <span class="hljs-comment">// é€šçŸ¥ç”Ÿäº§è€…</span><br>            log.debug(<span class="hljs-string">&quot;å·²æ¶ˆè´¹&quot;</span> + msg);<br>            <span class="hljs-keyword">return</span> msg;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ”¾å…¥æ¶ˆæ¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(Message msg)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">while</span> (list.size() == capcity) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.debug(<span class="hljs-string">&quot;é˜Ÿåˆ—å·²æ»¡&quot;</span>);<br>                    <span class="hljs-built_in">this</span>.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            list.addLast(msg);<br>            log.debug(<span class="hljs-string">&quot;å·²ç”Ÿäº§&quot;</span> + msg);<br>            <span class="hljs-built_in">this</span>.notifyAll();   <span class="hljs-comment">// é€šçŸ¥æ¶ˆè´¹è€…</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// æ¶ˆæ¯</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> Object value;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Message</span><span class="hljs-params">(<span class="hljs-type">int</span> id, Object value)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.value = value;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é¡ºåºæ§åˆ¶"><a href="#é¡ºåºæ§åˆ¶" class="headerlink" title="é¡ºåºæ§åˆ¶"></a>é¡ºåºæ§åˆ¶</h3><blockquote><p>å¿…é¡»æŒ‰ç…§é¡ºåºæ‰§è¡Œä»£ç </p><p>åŒæ­¥çš„</p></blockquote><p>æ¡ˆä¾‹</p><blockquote><p>é¡ºåºäº¤æ›¿æ‰“å°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test8</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">AwaitSignal</span> <span class="hljs-variable">as</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AwaitSignal</span>(<span class="hljs-number">5</span>);<br>        <span class="hljs-type">Condition</span> <span class="hljs-variable">aWaitSet</span> <span class="hljs-operator">=</span> as.newCondition();<br>        <span class="hljs-type">Condition</span> <span class="hljs-variable">bWaitSet</span> <span class="hljs-operator">=</span> as.newCondition();<br>        <span class="hljs-type">Condition</span> <span class="hljs-variable">cWaitSet</span> <span class="hljs-operator">=</span> as.newCondition();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            as.print(<span class="hljs-string">&quot;a&quot;</span>, aWaitSet, bWaitSet);<br>        &#125;).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            as.print(<span class="hljs-string">&quot;b&quot;</span>, bWaitSet, cWaitSet);<br>        &#125;).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            as.print(<span class="hljs-string">&quot;c&quot;</span>, cWaitSet, aWaitSet);<br>        &#125;).start();<br><br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        as.start(aWaitSet);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.AwaitSignal&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AwaitSignal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReentrantLock</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> loopNum;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AwaitSignal</span><span class="hljs-params">(<span class="hljs-type">int</span> loopNum)</span> &#123;<br>        <span class="hljs-built_in">this</span>.loopNum = loopNum;<br>    &#125;<br><br>    <span class="hljs-comment">// ç”±ä¸»çº¿ç¨‹å°†ç¬¬ä¸€ä¸ªçº¿ç¨‹å”¤é†’</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">(Condition first)</span> &#123;<br>        <span class="hljs-built_in">this</span>.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;start&quot;</span>);<br>            first.signal();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-built_in">this</span>.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(String str, Condition current, Condition next)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; loopNum; i++) &#123;<br>            <span class="hljs-built_in">this</span>.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                current.await();    <span class="hljs-comment">// å…ˆéƒ½åˆ°é˜»å¡é˜Ÿåˆ—</span><br>                log.debug(str);<br>                next.signal();  <span class="hljs-comment">// å«é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹</span><br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-built_in">this</span>.unlock();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="çŠ¹è±«æ¨¡å¼"><a href="#çŠ¹è±«æ¨¡å¼" class="headerlink" title="çŠ¹è±«æ¨¡å¼"></a>çŠ¹è±«æ¨¡å¼</h3><blockquote><p>åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒçš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åš äº†ï¼Œç›´æ¥ç»“æŸè¿”å›</p></blockquote><p>å®ä¾‹1ï¼ˆåªå¯åŠ¨ä¸€ä¸ªç›‘æ§çº¿ç¨‹ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitorService</span> &#123;<br>    <span class="hljs-comment">// ç”¨æ¥è¡¨ç¤ºæ˜¯å¦å·²ç»æœ‰çº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œå¯åŠ¨äº†</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> starting;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å°è¯•å¯åŠ¨ç›‘æ§çº¿ç¨‹...&quot;</span>);<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">if</span> (starting) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            starting = <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// çœŸæ­£å¯åŠ¨ç›‘æ§çº¿ç¨‹...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ä¾‹2ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> INSTANCE;<br>        &#125;<br>        INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h3><p>javaä¸­ï¼ŒåŒ…è£…ç±»Booleanï¼ŒByteï¼ŒShortï¼ŒIntegerï¼ŒLongï¼ŒCharacterç­‰ä½¿ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ã€‚è°ƒç”¨valueOfæ–¹æ³•æ—¶ï¼Œå¦‚æœå€¼åœ¨å…¶ç¼“å­˜çš„æ•°ç»„å†…ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–</p><p>Longçš„valueOfæ–¹æ³•å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title function_">valueOf</span><span class="hljs-params">(<span class="hljs-type">long</span> l)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> <span class="hljs-number">128</span>;<br>    <span class="hljs-keyword">if</span> (l &gt;= -<span class="hljs-number">128</span> &amp;&amp; l &lt;= <span class="hljs-number">127</span>) &#123; <span class="hljs-comment">// will cache</span><br>        <span class="hljs-keyword">return</span> LongCache.cache[(<span class="hljs-type">int</span>)l + offset];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Long</span>(l);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å„ä¸ªåŒ…è£…ç±»çš„ç¼“å­˜èŒƒå›´</p><ul><li>Byte, Short, Long ç¼“å­˜çš„èŒƒå›´éƒ½æ˜¯ -128~127</li><li>Character ç¼“å­˜çš„èŒƒå›´æ˜¯ 0~127 </li><li>Integerçš„é»˜è®¤èŒƒå›´æ˜¯ -128~127 <ul><li>æœ€å°å€¼ä¸èƒ½å˜ </li><li>ä½†æœ€å¤§å€¼å¯ä»¥é€šè¿‡è°ƒæ•´è™šæ‹Ÿæœºå‚æ•° <code>  -Djava.lang.Integer.IntegerCache.high</code> æ¥æ”¹å˜</li></ul></li><li>Boolean ç¼“å­˜äº† TRUE å’Œ FALSE</li></ul></blockquote><p><strong>çº¿ç¨‹æ± å°demo</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test20</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Pool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>(<span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> pool.borrow();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">1000</span>));<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                pool.free(conn);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.Pool&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Pool</span> &#123;<br>    <span class="hljs-comment">// è¿æ¥æ± å¤§å°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> poolSize;<br><br>    <span class="hljs-comment">// è¿æ¥å¯¹è±¡çš„æ•°ç»„</span><br>    <span class="hljs-keyword">private</span> Connection[] connections;<br><br>    <span class="hljs-comment">// è¿æ¥çŠ¶æ€çš„æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ1 è¡¨ç¤ºç¹å¿™</span><br>    <span class="hljs-keyword">private</span> AtomicIntegerArray states;<br><br>    <span class="hljs-comment">// æ„é€ æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Pool</span><span class="hljs-params">(<span class="hljs-type">int</span> poolSize)</span> &#123;<br>        <span class="hljs-built_in">this</span>.poolSize = poolSize;<br>        <span class="hljs-built_in">this</span>.connections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Connection</span>[poolSize];<br>        <span class="hljs-built_in">this</span>.states = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[poolSize]);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>            connections[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockConnection</span>(<span class="hljs-string">&quot;è¿æ¥&quot;</span> + i);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–è¿æ¥</span><br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">borrow</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>                <span class="hljs-keyword">if</span> (states.get(i) == <span class="hljs-number">0</span>) &#123;<br>                    states.compareAndSet(i, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>                    log.debug(<span class="hljs-string">&quot;è·å–è¿æ¥&#123;&#125;&quot;</span>, connections[i].toString());<br>                    <span class="hljs-keyword">return</span> connections[i];<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// æ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé˜²æ­¢cpuç©ºè½¬</span><br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.debug(<span class="hljs-string">&quot;ç­‰å¾…è·å–è¿æ¥&quot;</span>);<br>                    <span class="hljs-built_in">this</span>.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å½’è¿˜è¿æ¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(Connection connection)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>            <span class="hljs-keyword">if</span> (connections[i] == connection) &#123;<br>                states.set(i, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                    log.debug(<span class="hljs-string">&quot;å½’è¿˜è¿æ¥&#123;&#125;&quot;</span>, connections[i].toString());<br>                    <span class="hljs-built_in">this</span>.notifyAll();<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ†å·¥æ¨¡å¼"><a href="#åˆ†å·¥æ¨¡å¼" class="headerlink" title="åˆ†å·¥æ¨¡å¼"></a>åˆ†å·¥æ¨¡å¼</h3><p>è®©æœ‰é™çš„å·¥ä½œçº¿ç¨‹ï¼ˆWorker Threadï¼‰æ¥è½®æµå¼‚æ­¥å¤„ç†æ— é™å¤šçš„ä»»åŠ¡ï¼Œå®ƒçš„å…¸å‹å®ç° å°±æ˜¯çº¿ç¨‹æ± ï¼Œä¹Ÿä½“ç°äº†ç»å…¸è®¾è®¡æ¨¡å¼ä¸­çš„äº«å…ƒæ¨¡å¼ã€‚</p><p><strong>é¥¥é¥¿é—®é¢˜</strong></p><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ± çš„çº¿ç¨‹ä»€ä¹ˆéƒ½åšï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿé¥¥é¥¿ã€‚</p><p>å¦‚ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºè°ƒç”¨å…¶ä»–çº¿ç¨‹çš„çŠ¶æ€ï¼Œè€Œæ²¡æœ‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œå°±ä¼šå‘ç”Ÿé¥¥é¥¿</p><p><strong>è§£å†³é¥¥é¥¿æ–¹å¼</strong></p><p>ä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œé‡‡ç”¨ä¸åŒçš„çº¿ç¨‹æ± </p><p><strong>åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± åˆé€‚</strong></p><p>çº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå¤ªå¤šçº¿ç¨‹ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šæ¶ˆè€—èµ„æº</p><p>ä»»åŠ¡åˆ†ä¸ºè¿ç®—å¯†é›†å‹å’ŒI&#x2F;Oå¯†é›†å‹ï¼Œå½“è¿ç®—å¯†é›†å‹ä»»åŠ¡å¤šçš„æ—¶å€™ï¼Œåº”çº¿ç¨‹æ•°è¾ƒå°‘ï¼›è€ŒI&#x2F;Oå¯†é›†å‹ä»»åŠ¡å¤šæ—¶ï¼Œåº”å¤šåˆ›å»ºçº¿ç¨‹</p><p>ç»éªŒå…¬å¼ï¼š<code>çº¿ç¨‹æ•° = æ ¸æ•° * æœŸæœ› CPU åˆ©ç”¨ç‡ * æ€»æ—¶é—´(CPUè®¡ç®—æ—¶é—´+ç­‰å¾…æ—¶é—´) / CPU è®¡ç®—æ—¶é—´</code></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>gitå·¥ä½œæµ</title>
    <link href="/2022/11/24/git/git%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
    <url>/2022/11/24/git/git%E5%B7%A5%E4%BD%9C%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<h2 id="gitå·¥ä½œæµ"><a href="#gitå·¥ä½œæµ" class="headerlink" title="gitå·¥ä½œæµ"></a>gitå·¥ä½œæµ</h2><h3 id="é€šå¸¸"><a href="#é€šå¸¸" class="headerlink" title="é€šå¸¸"></a>é€šå¸¸</h3><ol><li><p>å…ˆå°†è¿œç¨‹ä»“åº“çš„é¡¹ç›®æ‹‰åˆ°æœ¬åœ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git clone &lt;ä»“åº“åœ°å€&gt;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨æœ¬åœ°<strong>æ–°å»ºä¸€ä¸ªè‡ªå·±çš„åˆ†æ”¯</strong></p><blockquote><p>å»ºè®®åœ¨è‡ªå·±çš„branchä¸Šä¿®æ”¹ä»£ç ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ä¸»åˆ†æ”¯ä¸Šä¿®æ”¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git checkout -b &lt;åˆ†æ”¯å&gt;<br>// -b æ–°å»ºå¹¶ä¸”åˆ‡æ¢åˆ°æ–°åˆ†æ”¯<br></code></pre></td></tr></table></figure></li><li><p>åœ¨è‡ªå·±åˆ†æ”¯ä¸Š<strong>ä¿®æ”¹ä»£ç </strong></p></li><li><p>åœ¨å†™å®Œä»£ç ï¼Œè¿˜æ²¡æœ‰ä¿å­˜åˆ°gitæœ¬åœ°ä»“åº“æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>git diff</code>æŸ¥çœ‹ä¿®æ”¹åçš„ä»£ç å’Œä¿®æ”¹å‰çš„ä»£ç çš„ä¸åŒ</p><blockquote><p>å»ºè®®å…ˆçœ‹ä¸€ä¸‹ä¿®æ”¹äº†å“ªäº›å†…å®¹å†ç»§ç»­</p></blockquote></li><li><p>å°†ä¿®æ”¹çš„ä»£ç <strong>ä¿å­˜åˆ°æš‚å­˜åŒº</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git status// æŸ¥çœ‹è¿˜æ²¡æœ‰ä¿å­˜åˆ°æš‚å­˜åŒºçš„æ–‡ä»¶<br>git add &lt;æ–‡ä»¶å/*&gt;// å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œ*è¡¨ç¤ºæ‰€æœ‰<br></code></pre></td></tr></table></figure></li><li><p>å°†æš‚å­˜åŒºçš„ä»£ç <strong>æäº¤åˆ°gitæœ¬åœ°ä»“åº“ä¸­</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git commit -m &quot;&lt;å¤‡æ³¨ä¿¡æ¯&gt;&quot;<br></code></pre></td></tr></table></figure></li><li><p>å°†è‡ªå·±<strong>æœ¬åœ°çš„åˆ†æ”¯æäº¤åˆ°è¿œç¨‹ä»“åº“</strong>ï¼Œè¿œç¨‹ä»“åº“ä¼šå¤šå‡ºä¸€ä¸ªæ–°åˆ†æ”¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git push origin &lt;æäº¤çš„è¿œç¨‹ä»“åº“çš„åˆ†æ”¯å&gt;<br></code></pre></td></tr></table></figure></li></ol><hr><h3 id="å½“è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯ä»£ç æœ‰æ”¹åŠ¨æ—¶"><a href="#å½“è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯ä»£ç æœ‰æ”¹åŠ¨æ—¶" class="headerlink" title="å½“è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯ä»£ç æœ‰æ”¹åŠ¨æ—¶"></a>å½“è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯ä»£ç æœ‰æ”¹åŠ¨æ—¶</h3><blockquote><p>å¦‚æœåœ¨åˆå¹¶è‡ªå·±çš„åˆ†æ”¯å’Œè¿œç¨‹ä»“åº“ä¸»åˆ†æ”¯æ—¶ï¼Œè¿œç¨‹ä»“åº“ä¸»åˆ†æ”¯çš„ä»£ç åœ¨ä¹‹å‰cloneä¸‹æ¥çš„åŸºç¡€ä¸Šæœ‰æ”¹åŠ¨ï¼Œéœ€è¦åŒæ­¥è¿œç¨‹ä»“åº“çš„ä»£ç åˆ°æœ¬åœ°çš„åˆ†æ”¯é‡Œï¼Œçœ‹çœ‹ä¼šä¸ä¼šå†²çª</p></blockquote><ol start="8"><li><p>å…ˆå°†æœ¬åœ°gitçš„åˆ†æ”¯åˆ‡æ¢å›ä¸»åˆ†æ”¯ï¼Œå†<strong>å°†è¿œç¨‹ä»“åº“çš„ä»£ç æ‹‰åˆ°æœ¬åœ°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git checkout main<br>git pull origin main<br></code></pre></td></tr></table></figure></li><li><p>åˆ‡æ¢åˆ°åˆ†æ”¯ä¸Šï¼Œå°†åˆ†æ”¯ä¸Šçš„ä»£ç å’Œæœ€æ–°çš„ä»£ç <strong>å°è¯•è¿›è¡Œåˆå¹¶</strong></p><blockquote><p>å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨é€‰æ‹©è¦ä¿å­˜çš„ä»£ç </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git rebase main// æ„æ€æ˜¯åœ¨æœ€æ–°çš„mainçš„åŸºç¡€ä¸Šï¼Œå°†æˆ‘çš„ä¿®æ”¹æ·»åŠ åˆ°mainä¸­<br></code></pre></td></tr></table></figure></li><li><p>è§£å†³å®Œå†²çªåï¼Œå°†æœ¬åœ°çš„åˆ†æ”¯æ¨åˆ°è¿œç¨‹ä»“åº“çš„åˆ†æ”¯ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git push -f origin &lt;åˆ†æ”¯å&gt;<br>// -f forceå¼ºè¡Œ<br></code></pre></td></tr></table></figure></li></ol><hr><h3 id="è¿œç¨‹ä»“åº“ä¸Šå°†åˆ†æ”¯å’Œä¸»åˆ†æ”¯åˆå¹¶"><a href="#è¿œç¨‹ä»“åº“ä¸Šå°†åˆ†æ”¯å’Œä¸»åˆ†æ”¯åˆå¹¶" class="headerlink" title="è¿œç¨‹ä»“åº“ä¸Šå°†åˆ†æ”¯å’Œä¸»åˆ†æ”¯åˆå¹¶"></a>è¿œç¨‹ä»“åº“ä¸Šå°†åˆ†æ”¯å’Œä¸»åˆ†æ”¯åˆå¹¶</h3><ol start="11"><li><p>è¿œç¨‹ä»“åº“ä¸»äººé€šè¿‡pull requestçš„squash and merge å°†æ‰€æœ‰çš„commitåˆå¹¶æˆä¸€ä¸ªcommit ï¼Œå†åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Š</p><p><img src="/img/git_img/pullRequest.png"></p></li><li><p>åˆå¹¶å®Œï¼Œé€šå¸¸ä¼šåˆ é™¤æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ï¼Œå†æŠŠæœ€æ–°çš„ä¸»åˆ†æ”¯æ‹‰åˆ°æœ¬åœ°ä¸»åˆ†æ”¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git branch -D &lt;åˆ†æ”¯å&gt;// åˆ é™¤æœ¬åœ°åˆ†æ”¯<br>git pull origin main// æŠŠæœ€æ–°çš„ä¸»åˆ†æ”¯æ‹‰åˆ°æœ¬åœ°ä¸»åˆ†æ”¯<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼šç‚¹å‡»view all branchsï¼Œç‚¹å‡»åƒåœ¾æ¡¶æ ‡è¯†å°±å¯åˆ é™¤äº†<br></code></pre></td></tr></table></figure><p><img src="/img/git_img/viewBranchs.png"></p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaå¹¶å‘ç¼–ç¨‹</title>
    <link href="/2022/11/15/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    <url>/2022/11/15/java/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="javaå¹¶å‘ç¼–ç¨‹"><a href="#javaå¹¶å‘ç¼–ç¨‹" class="headerlink" title="javaå¹¶å‘ç¼–ç¨‹"></a>javaå¹¶å‘ç¼–ç¨‹</h2><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="1-è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#1-è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="1.è¿›ç¨‹å’Œçº¿ç¨‹"></a>1.è¿›ç¨‹å’Œçº¿ç¨‹</h3><p><strong>è¿›ç¨‹</strong>å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ï¼Œç¨‹åºå¯ä»¥å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼Œè¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚</p><p><strong>çº¿ç¨‹</strong>æ˜¯å±äºè¿›ç¨‹çš„ï¼Œä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ</p><p><strong>æ¯”è¾ƒ</strong></p><ul><li>è¿›ç¨‹ï¼šèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹ï¼šè°ƒåº¦çš„æœ€å°å•ä½</li><li>è¿›ç¨‹åŸºæœ¬ç›¸äº’ç‹¬ç«‹ï¼Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›†</li><li>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ï¼ˆç»Ÿä¸€è®¡ç®—æœºé—´ã€ä¸åŒè®¡ç®—æœºé—´ï¼‰ï¼Œçº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•</li><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬æ¯”è¿›ç¨‹ä½</li></ul><h3 id="2-å¹¶å‘å’Œå¹¶è¡Œ"><a href="#2-å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="2.å¹¶å‘å’Œå¹¶è¡Œ"></a>2.å¹¶å‘å’Œå¹¶è¡Œ</h3><p><strong>ä¸¾ä¾‹</strong></p><p>å¹¶å‘ï¼šå•ä¸ªCPUåŒä¸€æ—¶é—´æ‰§è¡Œå¤šæ¡æŒ‡ä»¤(äº¤æ›¿)</p><p>å¹¶è¡Œï¼šå¤šä¸ªCPUåŒä¸€æ—¶é—´åŒæ—¶æ‰§è¡ŒæŒ‡ä»¤</p><p>å¹¶è¡Œå’Œå¹¶å‘æ˜¯åŒæ—¶å­˜åœ¨çš„</p><h3 id="3-åŒæ­¥å’Œå¼‚æ­¥"><a href="#3-åŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="3.åŒæ­¥å’Œå¼‚æ­¥"></a>3.åŒæ­¥å’Œå¼‚æ­¥</h3><p>åŒæ­¥ï¼šç­‰å¾…è¿è¡Œå®Œè¿”å›ç»“æœæ‰ç»§ç»­æ‰§è¡Œä¹‹åçš„ä»£ç </p><p>å¼‚æ­¥ï¼šä¸ç­‰ï¼Œç»§ç»­æ‰§è¡Œä¹‹åçš„ä»£ç </p><h3 id="4-Javaçº¿ç¨‹åŸºç¡€"><a href="#4-Javaçº¿ç¨‹åŸºç¡€" class="headerlink" title="4.Javaçº¿ç¨‹åŸºç¡€"></a>4.Javaçº¿ç¨‹åŸºç¡€</h3><h4 id="åˆ›å»ºçº¿ç¨‹æ–¹å¼"><a href="#åˆ›å»ºçº¿ç¨‹æ–¹å¼" class="headerlink" title="åˆ›å»ºçº¿ç¨‹æ–¹å¼"></a>åˆ›å»ºçº¿ç¨‹æ–¹å¼</h4><p><strong>(1)</strong> ç›´æ¥new Thread()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>() &#123;<br>        <span class="hljs-comment">// run æ–¹æ³•å†…å®ç°è¦æ‰§è¡Œçš„ä»»åŠ¡</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>        &#125;<br>    &#125;;<br>    <span class="hljs-comment">// ç»™çº¿ç¨‹èµ·å</span><br>    t.setName(<span class="hljs-string">&quot;t1&quot;</span>);<br>    <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span><br>    t.start();<br><br>    <span class="hljs-comment">// ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span><br>    log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>&#125;<br><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-comment">// 21:19:20 [main] c.Test - running</span><br><span class="hljs-comment">// 21:19:20 [t1] c.Test - running</span><br></code></pre></td></tr></table></figure><p>**(2)**Runnable é…åˆThread</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Runnable</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>()&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">&quot;t2&quot;</span>);<br>    t.start();<br><br>    log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>&#125;<br><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-comment">// 21:30:56 [main] c.Test - running</span><br><span class="hljs-comment">// 21:30:56 [t2] c.Test - running</span><br></code></pre></td></tr></table></figure><ul><li>ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ </li><li>ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»</li></ul><p>**(3)**FutureTaské…åˆThread</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// å®ç°Callableæ¥å£</span><br>    FutureTask&lt;Integer&gt; task = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;Integer&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt;() &#123;<br>        <span class="hljs-comment">// Runnableçš„runæ²¡æœ‰è¿”å›å€¼ï¼Œè€ŒCallableçš„callå¯ä»¥æœ‰è¿”å›å€¼</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            log.debug(<span class="hljs-string">&quot;running&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task, <span class="hljs-string">&quot;t3&quot;</span>);<br>    t3.start();<br><br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, task.get());<br>&#125;<br><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-comment">// 21:47:12 [t3] c.Test - running</span><br><span class="hljs-comment">// 21:47:13 [main] c.Test - 100 </span><br></code></pre></td></tr></table></figure><p>FutureTask èƒ½å¤Ÿæ¥æ”¶ Callable ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥å¤„ç†<strong>æœ‰è¿”å›ç»“æœ</strong>çš„æƒ…å†µ</p><h3 id="5-ThraedLocal"><a href="#5-ThraedLocal" class="headerlink" title="5.ThraedLocal"></a>5.ThraedLocal</h3><p>çº¿ç¨‹æœ¬åœ°å˜é‡ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆè®¿é—® è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ª<strong>å˜é‡çš„ä¸€ä¸ªæœ¬åœ°æ‹·è´</strong>ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡çš„æ—¶ å€™ï¼Œå®é™…æ˜¯æ“ä½œè‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ï¼Œä»è€Œèµ·åˆ°<strong>çº¿ç¨‹éš”ç¦»</strong>çš„ä½œç”¨ï¼Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</p><p><strong>ä½¿ç”¨</strong></p><p>åˆ›å»ºï¼šnew</p><p>å­˜å‚¨ï¼šset</p><p>è·å–ï¼šget</p><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><p>å­˜å‚¨ç”¨æˆ·tokenã€æ•°æ®åº“è¿æ¥æ± å­˜å‚¨Connectionï¼ˆä¿è¯å½“å‰çº¿ç¨‹ç”¨çš„æ˜¯åŒä¸€ä¸ªè¿æ¥å¯¹è±¡ï¼‰</p><p><strong>åŸç†</strong></p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸ªThreadLocalMapæ¥å­˜å‚¨ThreadLocalï¼ˆçš„å¼±å¼•ç”¨ï¼‰å’Œvalueä¹‹é—´çš„æ˜ å°„å…³ç³»</p><p>ThreadLocalæœ¬èº«ä¸å­˜å€¼ï¼Œåªæ˜¯ä½œä¸ºkeyæ¥å¾€mapä¸­å­˜å€¼</p><p>å“ˆå¸Œå†²çªæ—¶ç”¨å¼€æ”¾å®šå€æ³•æ¥è§£å†³å“ˆå¸Œå†²çª</p><p>å½“æ¸…ç†å®Œè¿‡æœŸçš„Entryåå…ƒç´ æ•°é‡è¶…è¿‡75%ä¼šè¿›è¡Œæ‰©å®¹</p><blockquote><p>å¼±å¼•ç”¨ï¼šåªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨æ‰«åˆ°åä¼šè¢«å›æ”¶</p><p>è¿™é‡Œåªä¼šå›æ”¶ThreadLocalï¼Œè€Œvalueå›æ”¶ä¸åˆ°ï¼Œæœ‰å†…å­˜æ³„æ¼çš„é£é™©</p><p>è§£å†³æ–¹å¼ï¼šä¸ç”¨äº†remove()æ‰</p></blockquote><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><h3 id="5-æŸ¥çœ‹è¿›ç¨‹æ–¹å¼"><a href="#5-æŸ¥çœ‹è¿›ç¨‹æ–¹å¼" class="headerlink" title="5.æŸ¥çœ‹è¿›ç¨‹æ–¹å¼"></a>5.æŸ¥çœ‹è¿›ç¨‹æ–¹å¼</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a><strong>windows</strong></h4><ul><li>ä»»åŠ¡ç®¡ç†å™¨</li><li><code>tasklist</code> æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼Œ å¯ä»¥<code>tasklist | findstr &lt;å…³é”®å­—&gt;</code>æ¥ç­›é€‰è¿›ç¨‹</li><li><code>taskkill</code>æ€æ­»è¿›ç¨‹ï¼Œ å‚æ•°ï¼š<code>/F /PID &lt;pid&gt;</code> å¼ºåˆ¶æ€æ­»æŒ‡å®špidçš„è¿›ç¨‹</li></ul><h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a><strong>linux</strong></h4><ul><li><code>ps -ef</code> æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹</li><li><code>ps -fT -p &lt;PID&gt;</code>æŸ¥çœ‹è¿›ç¨‹å·ä¸ºPIDçš„æ‰€æœ‰çº¿ç¨‹</li><li><code>kill</code>æ€æ­»è¿›ç¨‹</li><li><code>top</code> åŠ¨æ€æ˜¾ç¤ºè¿›ç¨‹ï¼ŒæŒ‰Håˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºè¿›ç¨‹</li><li><code>top -H -p &lt;PID&gt;</code> æŸ¥çœ‹è¿›ç¨‹å·ä¸ºPIDçš„æ‰€æœ‰çº¿ç¨‹</li></ul><h4 id="javaï¼ˆjdkè‡ªå¸¦çš„"><a href="#javaï¼ˆjdkè‡ªå¸¦çš„" class="headerlink" title="javaï¼ˆjdkè‡ªå¸¦çš„)"></a><strong>javaï¼ˆjdkè‡ªå¸¦çš„)</strong></h4><ul><li><p><code>jps</code>(java process status) æŸ¥çœ‹æ‰€æœ‰javaè¿›ç¨‹</p></li><li><p><code>jstack &lt;PID&gt;</code> æŸ¥çœ‹æŸä¸€æ—¶åˆ»è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹çŠ¶æ€</p></li><li><p><code>jconsole</code> æ¥æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼ˆå›¾å½¢ç•Œé¢ï¼‰</p><p><img src="/img/bingfa_img/jconsole%E7%95%8C%E9%9D%A2.png"></p></li></ul><h3 id="6-çº¿ç¨‹è¿è¡Œ"><a href="#6-çº¿ç¨‹è¿è¡Œ" class="headerlink" title="6.çº¿ç¨‹è¿è¡Œ"></a>6.çº¿ç¨‹è¿è¡Œ</h3><h4 id="æ ˆå’Œæ ˆå¸§"><a href="#æ ˆå’Œæ ˆå¸§" class="headerlink" title="æ ˆå’Œæ ˆå¸§"></a><strong>æ ˆå’Œæ ˆå¸§</strong></h4><ul><li>JVMä¸­ç”±å †ã€<strong>æ ˆ</strong>å’Œæ–¹æ³•åŒºç»„æˆã€‚æ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—<strong>æ ˆå†…å­˜</strong></li><li>çº¿ç¨‹æ ˆæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶å ç”¨çš„å†…å­˜ï¼ˆå±€éƒ¨å˜é‡è¡¨ã€è¿”å›åœ°å€ç­‰ï¼‰</li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ª<strong>æ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li></ul><h4 id="ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢"></a><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></h4><p>å¯¼è‡´CPUåˆ‡æ¢çº¿ç¨‹çš„åŸå› </p><ul><li>çº¿ç¨‹çš„cpuæ—¶é—´ç‰‡ç”¨å®Œ</li><li>åƒåœ¾å›æ”¶æ—¶ä¼šåœæ­¢æ‰€æœ‰çº¿ç¨‹ï¼Œè½¬è€Œè¿è¡Œåƒåœ¾å›æ”¶çš„çº¿ç¨‹</li><li>æ¥äº†ä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹</li><li>å½“å‰çº¿ç¨‹è‡ªå·±ä¼‘çœ äº†ç­‰</li></ul><p>åˆ‡æ¢æ—¶éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼ˆå±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰ï¼‰</p><p><strong>é¢‘ç¹åˆ‡æ¢ä¼šå½±å“æ€§èƒ½</strong></p><h4 id="çº¿ç¨‹å¸¸è§æ–¹æ³•"><a href="#çº¿ç¨‹å¸¸è§æ–¹æ³•" class="headerlink" title="çº¿ç¨‹å¸¸è§æ–¹æ³•"></a>çº¿ç¨‹å¸¸è§æ–¹æ³•</h4><p><img src="/img/else_img/%E7%BA%BF%E7%A8%8B%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95.png"></p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>public void start()</td><td>å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼ŒJavaè™šæ‹Ÿæœºè°ƒç”¨æ­¤çº¿ç¨‹çš„ run æ–¹æ³•</td></tr><tr><td>public void run()</td><td>çº¿ç¨‹å¯åŠ¨åè°ƒç”¨è¯¥æ–¹æ³•</td></tr><tr><td>public void setName(String name)</td><td>ç»™å½“å‰çº¿ç¨‹å–åå­—</td></tr><tr><td>public void getName()</td><td>è·å–å½“å‰çº¿ç¨‹çš„åå­— çº¿ç¨‹å­˜åœ¨é»˜è®¤åç§°ï¼šå­çº¿ç¨‹æ˜¯ Thread-ç´¢å¼•ï¼Œä¸»çº¿ç¨‹æ˜¯ main</td></tr><tr><td>public static Thread currentThread()</td><td>è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œä»£ç åœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ</td></tr><tr><td>public static void sleep(long time)</td><td>è®©å½“å‰çº¿ç¨‹ä¼‘çœ å¤šå°‘æ¯«ç§’å†ç»§ç»­æ‰§è¡Œ <strong>Thread.sleep(0)</strong> : è®©æ“ä½œç³»ç»Ÿç«‹åˆ»é‡æ–°è¿›è¡Œä¸€æ¬¡ CPU ç«äº‰</td></tr><tr><td>public static native void yield()</td><td>æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡ºå½“å‰çº¿ç¨‹å¯¹ CPU çš„ä½¿ç”¨</td></tr><tr><td>public final int getPriority()</td><td>è¿”å›æ­¤çº¿ç¨‹çš„ä¼˜å…ˆçº§</td></tr><tr><td>public final void setPriority(int priority)</td><td>æ›´æ”¹æ­¤çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå¸¸ç”¨ 1 5 10</td></tr><tr><td>public void interrupt()</td><td>ä¸­æ–­è¿™ä¸ªçº¿ç¨‹ï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶</td></tr><tr><td>public static boolean interrupted()</td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­ï¼Œæ¸…é™¤æ‰“æ–­æ ‡è®°</td></tr><tr><td>public boolean isInterrupted()</td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­ï¼Œä¸æ¸…é™¤æ‰“æ–­æ ‡è®°</td></tr><tr><td>public final void join()</td><td>ç­‰å¾…è¿™ä¸ªçº¿ç¨‹ç»“æŸ</td></tr><tr><td>public final void join(long millis)</td><td>ç­‰å¾…è¿™ä¸ªçº¿ç¨‹æ­»äº¡ millis æ¯«ç§’ï¼Œ0 æ„å‘³ç€æ°¸è¿œç­‰å¾…</td></tr><tr><td>public final native boolean isAlive()</td><td>çº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼ˆè¿˜æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼‰</td></tr><tr><td>public final void setDaemon(boolean on)</td><td>å°†æ­¤çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹æˆ–ç”¨æˆ·çº¿ç¨‹</td></tr></tbody></table><h5 id="run-start"><a href="#run-start" class="headerlink" title="run start"></a><strong>run start</strong></h5><ul><li>ç›´æ¥è°ƒç”¨runæ–¹æ³•ç›¸å½“äºåœ¨å½“å‰çº¿ç¨‹ä¸­è¿›è¡Œäº†æ™®é€šçš„æ–¹æ³•è°ƒç”¨ï¼Œ</li><li>ä½¿ç”¨startæ–¹æ³•åˆ™ä¸ºå¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹æ‰§è¡Œrunä¸­çš„ä»£ç </li></ul><h5 id="sleep-yield"><a href="#sleep-yield" class="headerlink" title="sleep yield"></a><strong>sleep yield</strong></h5><p>sleep</p><blockquote><p> è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹<strong>ä» Running è¿›å…¥ Timed Waiting çŠ¶æ€</strong>ï¼ˆé˜»å¡ï¼‰</p><p>å½“ç¡çœ æ—¶é—´ç»“æŸåçŠ¶æ€ä¸ºRunnable</p><p>å¯ä»¥ä½¿ç”¨TimeUnitçš„sleepæ¥ä½¿çº¿ç¨‹ç¡çœ ï¼ˆå¯ä»¥æ›´å¥½çš„çœ‹å‡ºæ—¶é—´å•ä½ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;t1&quot;</span>) &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">2000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;;<br><br>    t1.start();<br>    <span class="hljs-comment">// t1çŠ¶æ€ä¸ºRUNNABLE</span><br>    log.debug(<span class="hljs-string">&quot;t1 state: &#123;&#125;&quot;</span>, t1.getState());<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-comment">// t1çº¿ç¨‹è°ƒç”¨sleepæ–¹æ³•ï¼ŒçŠ¶æ€ä»RUNNING -&gt; Waiting</span><br>    log.debug(<span class="hljs-string">&quot;t1 state: &#123;&#125;&quot;</span>, t1.getState());<br>&#125;<br></code></pre></td></tr></table></figure><p>yields</p><blockquote><p>ä¼šè®©å½“å‰çº¿ç¨‹<strong>ä» Running è¿›å…¥ Runnable</strong> å°±ç»ªçŠ¶æ€</p></blockquote><p><strong>çº¿ç¨‹ä¼˜å…ˆçº§</strong></p><blockquote><p>é€šè¿‡<strong>setPriority</strong>è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä½†åªæ˜¯ç»™è°ƒåº¦å™¨çš„å‚è€ƒ</p><p>æœ€ç»ˆå¦‚ä½•åˆ†é…æ—¶é—´ç‰‡è¿˜æ˜¯ç”±è°ƒåº¦å™¨å†³å®š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Runnable</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> () -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            System.out.println(<span class="hljs-string">&quot;----&gt;1 &quot;</span> + count++);<br>        &#125;<br>    &#125;;<br>    <span class="hljs-type">Runnable</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> () -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-comment">// Thread.yield();</span><br>            System.out.println(<span class="hljs-string">&quot;       ----&gt;2 &quot;</span> + count++);<br>        &#125;<br>    &#125;;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task1, <span class="hljs-string">&quot;t1&quot;</span>);<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task2, <span class="hljs-string">&quot;t2&quot;</span>);<br>    t1.setPriority(Thread.MIN_PRIORITY);<br>    t2.setPriority(Thread.MAX_PRIORITY);<br>    t1.start();<br>    t2.start();<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="join"><a href="#join" class="headerlink" title="join"></a><strong>join</strong></h5><blockquote><p>join()ç­‰å¾…è¿™ä¸ªçº¿ç¨‹ç»“æŸ</p><p>join(long n) æœ€å¤šç­‰å¾…nç§’</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    log.debug(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>);<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        r = <span class="hljs-number">10</span>;<br>        log.debug(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>);<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br>    t1.start();<br>    t1.join();  <span class="hljs-comment">// ç­‰å¾…t1ç»“æŸåç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç </span><br>    <span class="hljs-comment">// t1.join(1000); r: 0</span><br>    log.debug(<span class="hljs-string">&quot;r: &#123;&#125;&quot;</span>, r);  <span class="hljs-comment">// r: 10</span><br>    log.debug(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="interrupt"><a href="#interrupt" class="headerlink" title="interrupt"></a><strong>interrupt</strong></h5><blockquote><p>æ‰“æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</p><ul><li><p>æ‰“æ–­åªæ˜¯é€šçŸ¥è¦è¢«æ‰“æ–­çš„çº¿ç¨‹ï¼Œå°†isInterruptedç½®ä¸ºtrue</p><p>æ˜¯å¦ç»“æŸçº¿ç¨‹ç”±è¢«æ‰“æ–­çº¿ç¨‹è‡ªå·±åˆ¤æ–­ï¼ˆä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼‰</p></li><li><p>stopæ–¹æ³•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼ˆä¸æ¨èï¼‰</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰“æ–­ç¡çœ ä¸­çš„çº¿ç¨‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;sleep..&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">50000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            log.debug(<span class="hljs-string">&quot;è¢«æ‰“æ–­&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    t1.start();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    log.debug(<span class="hljs-string">&quot;interrupt&quot;</span>);<br>    t1.interrupt();<br>    <span class="hljs-comment">// æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ï¼Œæ‰“æ–­æ ‡è®°ä¸ºtrueï¼Œ</span><br>    <span class="hljs-comment">// æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œæ‰“æ–­æ ‡è®°ä¸ºfalse</span><br>    log.debug(<span class="hljs-string">&quot;æ‰“æ–­æ ‡è®°ï¼š&#123;&#125;&quot;</span>, t1.isInterrupted());<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰“æ–­æ­£å¸¸çº¿ç¨‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">if</span> (Thread.currentThread().isInterrupted()) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    t1.start();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    log.debug(<span class="hljs-string">&quot;interrupt&quot;</span>);<br>    t1.interrupt();<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait notify"></a>wait notify</h5><blockquote><p><strong>wait</strong> è®©å½“å‰çº¿ç¨‹è¿›å…¥<strong>WaitSet</strong>ï¼Œå˜ä¸º<strong>WAITING</strong>çŠ¶æ€</p><p>å½“Ownerçº¿ç¨‹è°ƒç”¨<strong>notify</strong>æ—¶ä¼šå”¤é†’waitçš„çº¿ç¨‹ä¸­çš„ä¸€ä¸ªï¼Œå¹¶è®©å…¶è¿›å…¥é˜»å¡é˜Ÿåˆ—æ¥ç«äº‰é”</p><p><strong>notifyAll</strong>ä¼šå”¤é†’waitçš„æ‰€æœ‰çº¿ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-meta">@SneakyThrows</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                log.debug(<span class="hljs-string">&quot;t1è¢«å”¤é†’&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    lock.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                log.debug(<span class="hljs-string">&quot;t2è¢«å”¤é†’&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br><br>        t1.start();<br>        t2.start();<br><br>        Thread.sleep(<span class="hljs-number">2000</span>);<br>        <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>            lock.notify();  <span class="hljs-comment">// å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span><br>            <span class="hljs-comment">// lock.notifyAll();  // å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li>sleepå’ŒwaitåŒºåˆ«ï¼šwaitä¼šè®©å‡ºé”ï¼Œsleepæ˜¯æŠ±ç€é”ç¡è§‰</li><li>å¦‚æœæœ‰å¤šä¸ªwaitçš„çº¿ç¨‹ï¼Œå¯èƒ½å”¤é†’çš„ä¸æ˜¯æƒ³è¦å”¤é†’çš„çº¿ç¨‹ï¼ˆè™šå‡å”¤é†’ï¼‰</li></ul><p>park unpark</p><blockquote><p>LockSupport.park() æš‚åœå½“å‰çº¿ç¨‹</p><p>LockSupport.unpark(çº¿ç¨‹å¯¹è±¡) æ¢å¤å½“å‰çº¿ç¨‹</p></blockquote><blockquote><p>å’Œwait notifyåŒºåˆ«ï¼š</p><ol><li>wait notifyéœ€è¦è·å¾—é”å¯¹è±¡ï¼Œpark unpark ä¸éœ€è¦</li><li>park unparkæ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥é˜»å¡å’Œå”¤é†’çº¿ç¨‹ï¼Œæ¯”wait notifyç²¾ç¡®</li><li>park unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</li></ol></blockquote><blockquote><p>park unpark åŸç†ï¼š</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª Parker å¯¹è±¡ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ _counter ï¼Œ _cond å’Œ _mutex </p><p>è°ƒç”¨park() å°±æ˜¯æ£€æŸ¥_counteræ˜¯å¦ä¸º0ï¼Œä¸º0åˆ™è¿›å…¥waitçŠ¶æ€ï¼›ä¸º1åˆ™ç½®ä¸º0ï¼Œä¸‹æ¬¡å†parkæ—¶åˆ™è¿›å…¥waitçŠ¶æ€</p><p>è°ƒç”¨park()å°±æ˜¯ç½®_counterä¸º1</p><ul><li><p>å½“çº¿ç¨‹å¤„äºwaitçŠ¶æ€æ—¶ï¼Œè°ƒç”¨unparkï¼Œ_counterç½®ä¸º1ï¼Œå¯ä»¥å”¤é†’çº¿ç¨‹ï¼Œçº¿ç¨‹ç»§ç»­æ‰§è¡Œéœ€è¦æ¶ˆè€—ä¸€ä¸ª_counter</p></li><li><p>å½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè°ƒç”¨unparkï¼Œ_counterç½®ä¸º1ï¼Œçº¿ç¨‹ç»§ç»­è¿è¡Œ</p></li></ul></blockquote> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test6</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            log.debug(<span class="hljs-string">&quot;park&quot;</span>);<br>            LockSupport.park(); <span class="hljs-comment">// WAIT</span><br>            log.debug(<span class="hljs-string">&quot;resume...&quot;</span>);<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>        t1.start();<br><br>        Thread.sleep(<span class="hljs-number">2000</span>);<br>        log.debug(<span class="hljs-string">&quot;unpark...&quot;</span>);<br>        LockSupport.unpark(t1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¸»çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="ä¸»çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹"></a>ä¸»çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</h4><ul><li>é»˜è®¤æƒ…å†µJavaè¿›ç¨‹éœ€è¦ç­‰æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸï¼Œè¿›ç¨‹æ‰ä¼šç»“æŸ</li><li>è€Œä¸éœ€è¦ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹ï¼ŒæŠ€æœ¯å®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¼šå¼ºåˆ¶ç»“æŸ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">if</span> (Thread.currentThread().isInterrupted())<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        log.debug(<span class="hljs-string">&quot;t1ç»“æŸ&quot;</span>);<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    t1.setDaemon(<span class="hljs-literal">true</span>); <span class="hljs-comment">// è®¾ç½®è¿›ç¨‹ä¸ºå®ˆæŠ¤è¿›ç¨‹</span><br>    t1.start();<br><br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    log.debug(<span class="hljs-string">&quot;mainç»“æŸ&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h4><p><img src="/img/bingfa_img/6%E7%A7%8D%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png"></p><ol><li>è°ƒç”¨**start()**ï¼ŒNEW â€“&gt; RUNNABLE</li><li>è·å–åˆ°å¯¹è±¡é”objå<ul><li>è°ƒç”¨**obj.wait()**ï¼ŒRUNNABLE â€“&gt; WAITING</li><li>å…¶ä»–çº¿ç¨‹è°ƒç”¨**obj.notify()&#x2F;notifyAll()&#x2F;interrupt()**ï¼Œçº¿ç¨‹ä»WAITTINGä¸­è¢«å”¤é†’åˆ°BLOCKED<ul><li>ç«äº‰é”æˆåŠŸï¼ŒWATTING â€“&gt; RUNNABLE</li><li>ç«äº‰é”å¤±è´¥ï¼ŒWAITTING â€“&gt; BLOCKED</li></ul></li></ul></li><li>å½“å‰çº¿ç¨‹è°ƒç”¨**t.join()**ï¼ˆå½“å‰çº¿ç¨‹åœ¨tçº¿ç¨‹çš„ç®¡ç¨‹ä¸Šç­‰å¾…ï¼‰ï¼Œä»RUNNABLE â€“&gt; WAITTING<ul><li>tçº¿ç¨‹è¿è¡Œç»“æŸæˆ–è°ƒç”¨å½“å‰çº¿ç¨‹çš„interrupt()ï¼Œå½“å‰çº¿ç¨‹ä»WAITTING â€“&gt; RUNNABLE</li></ul></li><li>è°ƒç”¨<strong>LockSupport.park()</strong>,RUNNABLE â€“&gt; WAITTING<ul><li>è°ƒç”¨**LockSupport.unpark(ç›®æ ‡çº¿ç¨‹)**ï¼Œç›®æ ‡çº¿ç¨‹WAITTING â€“&gt; RUNNABLE</li></ul></li><li>è·å–åˆ°å¯¹è±¡é”objå<ul><li>è°ƒç”¨**obj.wait(long n)**ï¼ŒRUNNABLE â€“&gt; TIME_WAITING</li><li>ç­‰å¾…æ—¶é—´è¶…è¿‡næ¯«ç§’ï¼Œæˆ–å…¶ä»–çº¿ç¨‹è°ƒç”¨<strong>obj.notify()&#x2F;notifyAll()&#x2F;interrupt()</strong><ul><li>ç«äº‰é”æˆåŠŸï¼ŒTIME_WAITINGâ€“&gt; RUNNABLE</li><li>ç«äº‰é”å¤±è´¥ï¼ŒTIME_WAITINGâ€“&gt; BLOCKED</li></ul></li></ul></li><li>å½“å‰çº¿ç¨‹è°ƒç”¨**t.join(long n)**ï¼ˆå½“å‰çº¿ç¨‹åœ¨tçº¿ç¨‹çš„ç®¡ç¨‹ä¸Šç­‰å¾…ï¼‰ï¼Œä»RUNNABLE â€“&gt; TIME_WAITING<ul><li>ç­‰å¾…æ—¶é—´è¶…è¿‡næ¯«ç§’ï¼Œæˆ–tçº¿ç¨‹è¿è¡Œç»“æŸæˆ–è°ƒç”¨å½“å‰çº¿ç¨‹çš„interrupt()ï¼Œå½“å‰çº¿ç¨‹ä»TIME_WAITINGâ€“&gt; RUNNABLE</li></ul></li><li>å½“å‰çº¿ç¨‹è°ƒç”¨ <strong>Thread.sleep(long n)</strong> ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING<ul><li>ç­‰å¾…æ—¶é—´è¶…è¿‡næ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä»TIME_WAITINGâ€“&gt; RUNNABLE</li></ul></li><li>è°ƒç”¨<strong>LockSupport.parkNanos(long nanos)</strong>,RUNNABLE â€“&gt; TIME_WAITING<ul><li>ç­‰å¾…æ—¶é—´è¶…è¿‡nanosçº³ç§’ï¼Œæˆ–è°ƒç”¨**LockSupport.unpark(ç›®æ ‡çº¿ç¨‹)**ï¼Œç›®æ ‡çº¿ç¨‹TIME_WAITINGâ€“&gt; RUNNABLE</li></ul></li><li>ç«äº‰é”æˆåŠŸï¼ŒBLOCKED â€“&gt; RUNNABLEï¼›å¤±è´¥ä»ç„¶BLOCKED</li><li>ä»£ç è¿è¡Œå®Œæ¯•ï¼ŒRUNNABLE â€“&gt; TERMINATED</li></ol><h2 id="å…±äº«"><a href="#å…±äº«" class="headerlink" title="å…±äº«"></a>å…±äº«</h2><h3 id="å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>å…±äº«å¸¦æ¥çš„é—®é¢˜</h3><p>ä¾‹å¦‚javaä¸­å¯¹é™æ€å˜é‡çš„è‡ªå¢ã€è‡ªå‡ä¸æ˜¯åŸå­æ“ä½œï¼Œåœ¨å­—èŠ‚ç ä¸Šè¢«åˆ†ä¸ºäº†å››æ­¥</p><p>è·å–å˜é‡å€¼ã€å‡†å¤‡å¸¸æ•°ã€ç›¸åŠ ã€å†™å›</p><p>å½“è¦<strong>å†™</strong>å›çš„æ—¶å€™è‹¥æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆ™å¯èƒ½é€ æˆæ•°æ®çš„é”™è¯¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            counter++;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            counter--;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br><br>    t1.start();<br>    t2.start();<br>    t1.join();<br>    t2.join();<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, counter);<span class="hljs-comment">//counterå› ä¸ºå…±äº«é—®é¢˜è€Œå¯èƒ½ä¸ä¸º0</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¸´ç•ŒåŒº"><a href="#ä¸´ç•ŒåŒº" class="headerlink" title="ä¸´ç•ŒåŒº"></a>ä¸´ç•ŒåŒº</h4><p>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> <br><span class="hljs-comment">// ä¸´ç•ŒåŒº</span><br>&#123; <br> counter++;<br>&#125;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> <br><span class="hljs-comment">// ä¸´ç•ŒåŒº</span><br>&#123; <br> counter--;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ç«æ€æ¡ä»¶"><a href="#ç«æ€æ¡ä»¶" class="headerlink" title="ç«æ€æ¡ä»¶"></a>ç«æ€æ¡ä»¶</h4><p>å¤šä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p><p> å³åŸºäºä¸€ç§å¯èƒ½çš„å®æ•ˆçš„è§‚å¯Ÿç»“æœæ¥åšå‡ºåˆ¤æ–­æˆ–æ‰§è¡ŒæŸä¸ªè®¡ç®—ï¼ˆå…ˆæ£€æŸ¥åæ‰§è¡Œï¼‰</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>é˜»å¡å¼è§£å†³æ–¹æ¡ˆï¼šsynchronizedã€Lock</p><p>éé˜»å¡å¼è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</p><h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4><p>å³<strong>å¯¹è±¡é”</strong>ï¼Œé‡‡ç”¨<strong>äº’æ–¥</strong>çš„æ–¹å¼ï¼Œè®©åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå…¶ä»–å¯¹è±¡åˆ™ä¸º<strong>é˜»å¡çŠ¶æ€</strong>ï¼Œ</p><p>è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é” çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                counter++;<br>            &#125;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            <span class="hljs-keyword">synchronized</span> (lock) &#123;<br>                counter--;<br>            &#125;<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br><br>    t1.start();<br>    t2.start();<br>    t1.join();<br>    t2.join();<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, counter);<span class="hljs-comment">//counterå€¼ä¸º0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>synchronizedç”¨å¯¹è±¡é”ä¿è¯äº†ä¸´ç•ŒåŒºå†…çš„<strong>åŸå­æ€§</strong></p><p><strong>é¢å‘å¯¹è±¡æ”¹è¿›</strong></p><p>æŠŠè¦ä¿æŠ¤çš„å…±äº«å˜é‡å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œç±»çš„æ“ä½œæ˜¯åŸå­æ€§çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Room</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            counter++;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            counter--;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCounter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">return</span> counter;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Room</span> <span class="hljs-variable">room</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Room</span>();<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            room.increment();<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;<br>            room.decrement();<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br><br>    t1.start();<br>    t2.start();<br>    t1.join();<br>    t2.join();<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, room.getCounter());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ–¹æ³•ä¸Šä½¿ç”¨synchronized</strong></p><p>åœ¨æˆå‘˜æ–¹æ³•ä¸Šä½¿ç”¨synchronizedç›¸å½“äºé”ä½äº†<strong>this</strong>ï¼ˆå®ä¾‹åŒ–åçš„å¯¹è±¡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        counter++;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// ç­‰ä»·äº</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> &#123;<br>    counter++;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨é™æ€æ–¹æ³•ä¸Šä½¿ç”¨synchronizedç›¸å½“äºé”ä½äº†<strong>ç±»å¯¹è±¡</strong>ï¼ˆå†…å­˜ä¸­ç‹¬ä¸€ä»½ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>     &#125;<br>&#125;<br><span class="hljs-comment">// ç­‰ä»·äº</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-keyword">synchronized</span>(Test.class) &#123;<br><br>         &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><blockquote><p>åœ¨åé¢</p></blockquote><h3 id="å˜é‡çš„çº¿ç¨‹å®‰å…¨"><a href="#å˜é‡çš„çº¿ç¨‹å®‰å…¨" class="headerlink" title="å˜é‡çš„çº¿ç¨‹å®‰å…¨"></a>å˜é‡çš„çº¿ç¨‹å®‰å…¨</h3><p>æˆå‘˜å˜é‡å’Œé™æ€å˜é‡</p><ul><li>æ²¡æœ‰å…±äº«ï¼Œçº¿ç¨‹å®‰å…¨</li><li>æœ‰è¢«å…±äº«ï¼Œåªè¯»ï¼Œçº¿ç¨‹å®‰å…¨</li><li>æœ‰è¢«å…±äº«ï¼Œè¯»å†™ï¼Œçº¿ç¨‹ä¸å®‰å…¨</li></ul><p>å±€éƒ¨å˜é‡</p><ul><li>å±€éƒ¨å˜é‡å¼•ç”¨çš„æ˜¯<strong>å¸¸é‡</strong>ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨</li><li>ä½†å±€éƒ¨å˜é‡å¼•ç”¨çš„æ˜¯<strong>å¯¹è±¡</strong>ï¼Œè‹¥é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œåˆ™çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨privateæˆ–finalå…³é”®å­—ä½¿å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨</li></ul><h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨çš„ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨çš„ç±»" class="headerlink" title="å¸¸è§çº¿ç¨‹å®‰å…¨çš„ç±»"></a>å¸¸è§çº¿ç¨‹å®‰å…¨çš„ç±»</h3><p>å¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p><ul><li>String</li><li>Integer</li><li>StringBuffer</li><li>Random</li><li>Vector</li><li>Hashtable</li><li>java.util.concurrentåŒ…å“å¾—ç±»</li></ul><h3 id="çº¿ç¨‹å®‰å…¨ä¾‹å­"><a href="#çº¿ç¨‹å®‰å…¨ä¾‹å­" class="headerlink" title="çº¿ç¨‹å®‰å…¨ä¾‹å­"></a>çº¿ç¨‹å®‰å…¨ä¾‹å­</h3><p>è½¬è´¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Account</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-number">1000</span>);<br>        <span class="hljs-type">Account</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-number">1000</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>                a.transfer(b, randomAmount());<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>                b.transfer(a, randomAmount());<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br>        t1.start();<br>        t2.start();<br>        t1.join();<br>        t2.join();<br>        <span class="hljs-comment">// æŸ¥çœ‹è½¬è´¦2000æ¬¡åçš„æ€»é‡‘é¢</span><br>        log.debug(<span class="hljs-string">&quot;total:&#123;&#125;&quot;</span>, (a.getMoney() + b.getMoney()));<br>    &#125;<br><br>    <span class="hljs-comment">// Random ä¸ºçº¿ç¨‹å®‰å…¨</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br><br>    <span class="hljs-comment">// éšæœº 1~100</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">randomAmount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> random.nextInt(<span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> money;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Account</span><span class="hljs-params">(<span class="hljs-type">int</span> money)</span> &#123;<br>        <span class="hljs-built_in">this</span>.money = money;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMoney</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> money;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMoney</span><span class="hljs-params">(<span class="hljs-type">int</span> money)</span> &#123;<br>        <span class="hljs-built_in">this</span>.money = money;<br>    &#125;<br><br>    <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>  <span class="hljs-title function_">transfer</span><span class="hljs-params">(Account target, <span class="hljs-type">int</span> amount)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.money &gt; amount) &#123;<br>            <span class="hljs-built_in">this</span>.setMoney(<span class="hljs-built_in">this</span>.getMoney() - amount);<br>            target.setMoney(target.getMoney() + amount);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸èƒ½é€šè¿‡é”thisæ¥è§£å†³ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªä¸åŒçš„å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(Account target, <span class="hljs-type">int</span> amount)</span> &#123;<br>    <span class="hljs-comment">// é€šè¿‡é”ç±»å¯¹è±¡æ¥å®ç°çº¿ç¨‹å®‰å…¨</span><br>    <span class="hljs-keyword">synchronized</span> (Account.class) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.money &gt; amount) &#123;<br>            <span class="hljs-built_in">this</span>.setMoney(<span class="hljs-built_in">this</span>.getMoney() - amount);<br>            target.setMoney(target.getMoney() + amount);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><h4 id="javaå¯¹è±¡å¤´"><a href="#javaå¯¹è±¡å¤´" class="headerlink" title="javaå¯¹è±¡å¤´"></a>javaå¯¹è±¡å¤´</h4><p>å¯¹è±¡åœ¨å†…å­˜ä¸­å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<strong>å¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¯¹é½å¡«å……</strong></p><ul><li><p>å¯¹è±¡å¤´ï¼šå¦‚hashç ,å¯¹è±¡æ‰€å±çš„å¹´ä»£ï¼Œå¯¹è±¡é”ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œåå‘é”ï¼ˆçº¿ç¨‹ï¼‰IDï¼Œåå‘æ—¶é—´ç­‰,32ä½æœºå™¨é‡ŒJavaå¯¹è±¡å¤´ä¸€èˆ¬å æœ‰2ä¸ªæœºå™¨ç </p></li><li><p>å®ä¾‹æ•°æ®ï¼šå­˜æ”¾ç±»çš„å±æ€§æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§å¯¹è±¡</p></li><li><p>å¯¹é½å¡«å……ï¼šä½¿å­—èŠ‚å¯¹é½ï¼Œéå¿…é¡»</p></li></ul><p><img src="/img/bingfa_img/java%E5%A4%B4%E5%AF%B9%E8%B1%A11.png"></p><p><img src="/img/bingfa_img/java%E5%A4%B4%E5%AF%B9%E8%B1%A12.png"></p><h4 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h4><blockquote><p> æ— é” â€“&gt; åå‘é” â€“&gt; è½»é‡çº§é” â€“&gt; é‡é‡çº§é”</p></blockquote><p>å‡çº§è¿‡ç¨‹ï¼š</p><ol><li><p>çº¿ç¨‹ä¸å¤šã€‚ç«äº‰å°‘æ—¶ï¼Œ<strong>åå‘é”</strong></p></li><li><p>è·å–é”æ—¶å‘ç°Mark Wordä¸­ä¸æ˜¯å½“å‰çº¿ç¨‹IDï¼ŒCASè‡ªæ—‹è·å–é”</p><ul><li><p>è·å–æˆåŠŸï¼Œæ”¹ä¸ºå½“å‰çº¿ç¨‹IDï¼Œæ‰§è¡Œä»£ç </p></li><li><p>è·å–å¤±è´¥ï¼Œé”å‡çº§ä¸º<strong>è½»é‡çº§é”</strong></p></li></ul></li><li><p>ä¸€ä¸ªçº¿ç¨‹è·å–äº†è½»é‡çº§é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”å¹¶è‡ªæ—‹åä»å¤±è´¥ï¼Œé”å‡çº§ä¸º<strong>é‡é‡çº§é”</strong></p></li></ol><h4 id="Monitorï¼ˆé‡é‡çº§é”ï¼‰åŸç†"><a href="#Monitorï¼ˆé‡é‡çº§é”ï¼‰åŸç†" class="headerlink" title="Monitorï¼ˆé‡é‡çº§é”ï¼‰åŸç†"></a>Monitorï¼ˆé‡é‡çº§é”ï¼‰åŸç†</h4><blockquote><p>é”çš„ç±»å‹æœ‰ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</p></blockquote><p>å¦‚æœä½¿ç”¨synchronizedç»™å¯¹è±¡ä¸Šé”ï¼ˆ<strong>é‡é‡çº§</strong>ï¼‰åï¼Œè¯¥å¯¹è±¡å¤´çš„<strong>Mark word</strong>ä¸­å°±è¢«è®¾ç½®æŒ‡å‘<strong>Monitorå¯¹è±¡</strong>çš„æŒ‡é’ˆã€‚ï¼ˆåŸæ¥Mark Wordä¸­çš„ä¿¡æ¯è¢«æ”¾åˆ°äº†Monitorå¯¹è±¡ä¸­ï¼‰</p><p><img src="/img/bingfa_img/Monitor%E5%8E%9F%E7%90%86.png"></p><ul><li>Monitoråªèƒ½æœ‰ä¸€ä¸ªOwner</li><li>åœ¨å¯¹è±¡è¢«ä¸Šé”åï¼Œå…¶ä»–çº¿ç¨‹æ‰§è¡Œsynchronized(obj)å°±ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—</li><li>å½“Owneræ‰§è¡Œå®Œä»£ç å—çš„å†…å®¹åï¼Œä¼šå”¤é†’åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œç«äº‰çº¿ç¨‹æ—¶éå…¬å¹³çš„ï¼Œç”±è°ƒåº¦å™¨å†³å®š</li><li>synchronized å¿…é¡»æ˜¯è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡çš„ monitor æ‰æœ‰ä¸Šè¿°çš„æ•ˆæœ</li><li>ä¸åŠ  synchronized çš„å¯¹è±¡ä¸ä¼šå…³è”ç›‘è§†å™¨ï¼Œä¸éµä»ä»¥ä¸Šè§„åˆ™</li></ul><h4 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h4><blockquote><p>è½»é‡çº§é”åªæ˜¯å‘Šè¯‰å…¶ä»–çº¿ç¨‹æœ‰çº¿ç¨‹åœ¨ç”¨è¿™ä¸ªèµ„æºã€‚</p><p>å¦‚æœçº¿ç¨‹åœ¨åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­å‘ç°å·²ç»è¢«ä¸Šäº†è½»é‡çº§é”ï¼Œåˆ™ä¼šä»è½»é‡çº§é”è½¬åŒ–ä¸ºé‡é‡çº§é”</p></blockquote><p>ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è¦åŠ é”ï¼Œä½†åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–</p><p>åŠ è½»é‡çº§é”å¯¹ä½¿ç”¨è€…æ˜¯é€æ˜çš„ï¼Œè¯­æ³•å’ŒåŠ é‡é‡çº§é”ä¸€æ ·</p><p>å†…éƒ¨å®ç°è¿‡ç¨‹ï¼š</p><ul><li><p>åˆ›å»ºé”è®°å½•ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•çš„ç»“æ„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„ Mark Word</p><p><img src="/img/bingfa_img/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%811.png"></p></li><li><p>è®©é”è®°å½•ä¸­ Object reference æŒ‡å‘é”å¯¹è±¡ï¼Œå¹¶å°è¯•ç”¨ cas <strong>æ›¿æ¢ Object çš„ Mark Wordï¼Œå°† Mark Word çš„å€¼å­˜ å…¥é”è®°å½•</strong></p><p><img src="/img/bingfa_img/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%812.png"></p></li><li><p>å¦‚æœ cas æ›¿æ¢æˆåŠŸï¼Œå¯¹è±¡å¤´ä¸­å­˜å‚¨äº† é”è®°å½•åœ°å€å’ŒçŠ¶æ€ 00 ï¼Œè¡¨ç¤ºç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”ï¼Œè¿™æ—¶å›¾ç¤ºå¦‚ä¸‹</p><p><img src="/img/bingfa_img/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%813.png"></p></li><li><p>å¦‚æœ cas å¤±è´¥ï¼Œæœ‰ä¸¤ç§æƒ…å†µ</p><ul><li>å¦‚æœæ˜¯å…¶å®ƒçº¿ç¨‹å·²ç»æŒæœ‰äº†è¯¥ Object çš„è½»é‡çº§é”ï¼Œè¿™æ—¶è¡¨æ˜æœ‰ç«äº‰ï¼Œè¿›å…¥é”è†¨èƒ€è¿‡ç¨‹ </li><li>å¦‚æœæ˜¯è‡ªå·±æ‰§è¡Œäº† synchronized <strong>é”é‡å…¥</strong>ï¼Œé‚£ä¹ˆå†æ·»åŠ ä¸€æ¡ Lock Record ä½œä¸ºé‡å…¥çš„è®¡æ•°</li></ul><p><img src="/img/bingfa_img/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%814.png"></p></li><li><p>å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰å¦‚æœæœ‰å–å€¼ä¸º null çš„é”è®°å½•ï¼Œè¡¨ç¤ºæœ‰é‡å…¥ï¼Œè¿™æ—¶é‡ç½®é”è®°å½•ï¼Œè¡¨ç¤ºé‡ å…¥è®¡æ•°å‡ä¸€</p><p><img src="/img/bingfa_img/%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%815.png"></p></li><li><p>å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰é”è®°å½•çš„å€¼ä¸ä¸º nullï¼Œè¿™æ—¶ä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´</p><ul><li>æˆåŠŸï¼Œåˆ™è§£é”æˆåŠŸ </li><li>å¤±è´¥ï¼Œè¯´æ˜è½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–å·²ç»å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹</li></ul></li></ul><h5 id="é”è†¨èƒ€"><a href="#é”è†¨èƒ€" class="headerlink" title="é”è†¨èƒ€"></a>é”è†¨èƒ€</h5><blockquote><p>å¦‚æœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ç«äº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚</p></blockquote><p>é”å¯¹è±¡çš„Mark wordä¼šæŒ‡å‘Monitorå¯¹è±¡  </p><p>åŸæœ¬ç»™å…¶ä¸Šé”çš„çº¿ç¨‹éœ€è¦æ‰¾åˆ°Monitorå¯¹è±¡æ¥é‡Šæ”¾é”</p><h5 id="è‡ªæ—‹ä¼˜åŒ–"><a href="#è‡ªæ—‹ä¼˜åŒ–" class="headerlink" title="è‡ªæ—‹ä¼˜åŒ–"></a>è‡ªæ—‹ä¼˜åŒ–</h5><p>ç›¸å½“äºå¯¹è±¡å·²ç»è¢«ä¸Šé”ï¼Œåæ¥çš„çº¿ç¨‹å…ˆä¸è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼ˆè¿›å…¥é˜»å¡é˜Ÿåˆ—æ˜¯é‡å‹æ“ä½œï¼Œè€—æ—¶ï¼‰ï¼Œè€Œæ˜¯é‡è¯•å‡ æ¬¡å¯¹å¯¹è±¡çš„ä¸Šé”ï¼ˆè‡ªæ—‹ï¼‰ï¼Œå¦‚æœè¿™æ—¶é”è¢«é‡Šæ”¾ï¼Œåˆ™ä¸Šé”æˆåŠŸï¼ˆè‡ªæ—‹æˆåŠŸï¼‰ã€‚å¦åˆ™åˆ™è‡ªæ—‹å¤±è´¥ï¼Œè¿›å…¥é˜»å¡é˜Ÿåˆ—</p><p>æ³¨æ„ï¼š</p><ul><li>è‡ªæ—‹ä¼šå ç”¨CPUæ—¶é—´ï¼Œå¤šæ ¸CPUè‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿</li><li>è‡ªæ—‹æ˜¯è‡ªé€‚åº”çš„ï¼ˆæˆåŠŸçš„æ¬¡æ•°å¤šåˆ™å¤šè‡ªæ—‹å‡ æ¬¡ï¼Œåä¹‹åˆ™å‡å°‘æ¬¡æ•°ï¼‰</li></ul><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h4><blockquote><p>åå‘å±äºæŸä¸ªçº¿ç¨‹</p><p>å½“çº¿ç¨‹æ•°ç›®ä¸å¤šçš„æ—¶å€™ï¼Œç”±äºåå¤è·å–é”ä¼šä½¿å¾—æˆ‘ä»¬çš„è¿è¡Œæ•ˆç‡ä¸‹é™ï¼Œäºæ˜¯å‡ºç°äº†åå‘çº§é”</p></blockquote><p>è½»é‡çº§é”çš„é—®é¢˜åœ¨äºï¼Œåœ¨æ²¡æœ‰çº¿ç¨‹ç«äº‰æ—¶ï¼Œæ¯æ¬¡é‡å…¥éƒ½éœ€è¦æ·»åŠ é”è®°å½•ã€‚</p><p>åå‘é”åˆ™åœ¨ç¬¬ä¸€æ¬¡CASæ—¶å°†<strong>çº¿ç¨‹ ID</strong> è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œ<strong>ä¹‹åå‘ç°è¿™ä¸ªçº¿ç¨‹ IDæ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œä¸ç”¨é‡æ–° CAS</strong>ã€‚ä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰</p><ul><li>åå‘é”é»˜è®¤å¼€å¯ï¼Œä¸”é»˜è®¤æœ‰å¼€å¯å»¶è¿Ÿï¼Œç¦ç”¨å»¶è¿Ÿï¼š<code>-XX:BiasedLockingStartupDelay=0</code></li><li>ç¦ç”¨åå‘é”<code>-XX:-UseBiasedLocking </code></li></ul><p>å¯ä»¥ç”¨jolæŸ¥çœ‹å¯¹è±¡å¤´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æŸ¥çœ‹javaå¤´å¯¹è±¡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Dog</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br>        log.debug(ClassLayout.parseInstance(dog).toPrintable());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/bingfa_img/jol.png"></p><p>æ³¨æ„;</p><ul><li>å¤„äºåå‘é”çš„å¯¹è±¡è§£é”åï¼Œçº¿ç¨‹ id ä»å­˜å‚¨äºå¯¹è±¡å¤´ä¸­</li><li>æ­£å¸¸çŠ¶æ€å¯¹è±¡ä¸€å¼€å§‹æ˜¯æ²¡æœ‰ hashCode çš„ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ‰ç”Ÿæˆï¼›å¦‚æœ<strong>è°ƒç”¨ hashCode ä¼šå¯¼è‡´åå‘é”è¢«æ’¤é”€</strong></li></ul><h5 id="æ‰¹é‡é‡åå‘"><a href="#æ‰¹é‡é‡åå‘" class="headerlink" title="æ‰¹é‡é‡åå‘"></a>æ‰¹é‡é‡åå‘</h5><p>é‡åå‘æ˜¯ä»¥ç±»ä¸ºå•ä½</p><p>å¦‚æœå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ²¡æœ‰ç«äº‰ï¼Œåå‘çº¿ç¨‹T1çš„å¯¹è±¡ä»æœ‰å¯èƒ½é‡æ–°åå‘åˆ°çº¿ç¨‹T2ï¼Œé‡åå‘ä¼šé‡ç½®å¯¹è±¡ çš„ Thread ID</p><p>å½“è¿™ä¸ªclassç±»å‹çš„å®ä¾‹å¯¹è±¡æ’¤é”€è¾¾åˆ°<strong>20</strong>æ¬¡åï¼Œä¼šæ‰§è¡Œæ‰¹é‡é‡åå‘ï¼Œæ‰€æœ‰è¿™ä¸ªç±»çš„å®ä¾‹éƒ½ä¼šæŒ‡å‘æ–°çš„çº¿ç¨‹</p><h5 id="æ‰¹é‡æ’¤é”€"><a href="#æ‰¹é‡æ’¤é”€" class="headerlink" title="æ‰¹é‡æ’¤é”€"></a>æ‰¹é‡æ’¤é”€</h5><p>å½“æ’¤é”€åå‘é”é˜ˆå€¼<strong>è¶…è¿‡</strong> <strong>40</strong> æ¬¡åï¼Œjvmè®¤ä¸ºåœ¨æ˜æ˜¾å¤šçº¿ç¨‹ç«äº‰å‰§çƒˆçš„åœºæ™¯ä¸‹ä½¿ç”¨åå‘é”æ˜¯ä¸åˆé€‚çš„ï¼Œæ•´ä¸ªç±»çš„<strong>æ‰€æœ‰å¯¹è±¡</strong>éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„</p><h4 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h4><p>é”æ¶ˆé™¤æ˜¯å‘ç”Ÿåœ¨ç¼–è¯‘å™¨çº§åˆ«çš„<strong>ä¸€ç§é”ä¼˜åŒ–æ–¹å¼</strong></p><p>å¦‚æœå±€éƒ¨å¯¹è±¡åªåœ¨æ–¹æ³•çš„ä½œç”¨åŸŸä¸­æœ‰æ•ˆï¼ˆæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼‰ï¼Œä¸åŒçº¿ç¨‹è°ƒç”¨æ—¶ä½¿ç”¨çš„éƒ½æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œä½¿ç”¨é”å°±åªä¼šç™½ç™½æµªè´¹èµ„æº</p><p>è¿™æ—¶ç¼–è¯‘å™¨å°†å…¶ä¼˜åŒ–ï¼Œå°†é”æ¶ˆé™¤</p><ul><li>å…³é—­é”æ¶ˆé™¤<code>java -XX:-EliminateLocks -jar benchmarks.jar</code></li></ul><h3 id="å¤šæŠŠé”"><a href="#å¤šæŠŠé”" class="headerlink" title="å¤šæŠŠé”"></a>å¤šæŠŠé”</h3><p>æ¡ˆä¾‹</p><blockquote><p>å°†é”ç»†åˆ†ï¼Œå¢åŠ å¹¶å‘åº¦</p><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œå®¹æ˜“å‘ç”Ÿæ­»é”</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test6&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test6</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><br>        <span class="hljs-type">BigRoom</span> <span class="hljs-variable">bigRoom</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigRoom</span>();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            bigRoom.study();<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            bigRoom.sleep();<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br><br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.BigRoom&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BigRoom</span> &#123;<br><br>    <span class="hljs-comment">// å¤šæŠŠé”</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">studyRoom</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">sleepRoom</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (sleepRoom) &#123;<br>            log.debug(<span class="hljs-string">&quot;sleeping...&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">2000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">study</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (studyRoom) &#123;<br>            log.debug(<span class="hljs-string">&quot;study...&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">2000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ´»è·ƒæ€§"><a href="#æ´»è·ƒæ€§" class="headerlink" title="æ´»è·ƒæ€§"></a>æ´»è·ƒæ€§</h3><h4 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h4><blockquote><p>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§<strong>é˜»å¡</strong></p><p>ä»£è¡¨æ€§é—®é¢˜ï¼šå“²å­¦å®¶è¿›é¤</p></blockquote><p><strong>æ­»é”äº§ç”Ÿçš„æ¡ä»¶</strong></p><ol><li><strong>äº’æ–¥</strong>ï¼šä¸€ä¸ªèµ„æºä¸€æ¬¡åªèƒ½ç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨</li><li><strong>ä¸å¯å‰¥å¤º</strong>ï¼šèµ„æºåªèƒ½ç”±èµ„æºæŒæœ‰è€…é‡Šæ”¾</li><li><strong>è¯·æ±‚å’Œä¿æŒ</strong>ï¼šè¿›ç¨‹ç”³è¯·å®ƒæ‰€éœ€çš„ä¸€éƒ¨åˆ†èµ„æºï¼Œå¹¶ç»§ç»­å ç”¨ä»¥è·å–çš„èµ„æº</li><li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šå¤šä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€äº›èµ„æºï¼Œä½†æ‰€éœ€çš„å¦ä¸€éƒ¨åˆ†èµ„æºè¢«å…¶ä»–çº¿ç¨‹å äº†ï¼Œå½¢æˆä¸€ä¸ªç­‰å¾…çš„ç¯</li></ol><p> <strong>é¿å…æ­»é”</strong></p><p>è‡³å°‘ç ´åæ­»é”äº§ç”Ÿçš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶</p><h4 id="å®šä½æ­»é”"><a href="#å®šä½æ­»é”" class="headerlink" title="å®šä½æ­»é”"></a>å®šä½æ­»é”</h4><p><strong>æ–¹æ³•1ï¼š</strong></p><ul><li><p>å…ˆä½¿ç”¨jpsæŸ¥çœ‹è¿›ç¨‹</p></li><li><p>å†ä½¿ç”¨jstack &lt;è¿›ç¨‹å·&gt; æŸ¥çœ‹å…·ä½“çº¿ç¨‹</p></li><li><p>å¦‚æœæœ‰æ­»é”ï¼Œæ‰“å°ä¿¡æ¯ä¸­ä¼šæœ‰<code>Found one Java-level deadlock:</code></p></li></ul><p><strong>æ–¹æ³•2ï¼š</strong></p><ul><li>æ‰“å¼€<code>jdk/bin</code>ç›®å½•ä¸‹çš„<code>jconsole.exe</code>å·¥å…·</li><li>è¿æ¥ä¸Šè¿›ç¨‹</li><li>æŸ¥çœ‹çº¿ç¨‹ï¼Œç‚¹å‡»æ£€æµ‹æ­»é”ï¼Œå°±ä¼šæŠŠæœ‰æ­»é”çš„çº¿ç¨‹å±•ç¤ºå‡ºæ¥</li></ul><h4 id="æ´»é”"><a href="#æ´»é”" class="headerlink" title="æ´»é”"></a>æ´»é”</h4><blockquote><p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œæœ€åè°ä¹Ÿæ— æ³•ç»“æŸ</p><p>å’Œæ­»é”çš„åŒºåˆ«ï¼šå‡ºç°æ­»é”ï¼Œçº¿ç¨‹éƒ½è¢«é˜»å¡ä½äº†ï¼›å‡ºç°æ´»é”ï¼šçº¿ç¨‹ä»åœ¨è¿è¡Œï¼Œä½†å§‹ç»ˆç»“æŸä¸äº†</p></blockquote><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test8</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-comment">// æœŸæœ›å‡åˆ° 0 é€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">while</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">200</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                count--;<br>                log.debug(<span class="hljs-string">&quot;count: &#123;&#125;&quot;</span>, count);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-comment">// æœŸæœ›è¶…è¿‡ 20 é€€å‡ºå¾ªç¯</span><br>            <span class="hljs-keyword">while</span> (count &lt; <span class="hljs-number">20</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">200</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                count++;<br>                log.debug(<span class="hljs-string">&quot;count: &#123;&#125;&quot;</span>, count);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é¥¥é¥¿"><a href="#é¥¥é¥¿" class="headerlink" title="é¥¥é¥¿"></a>é¥¥é¥¿</h4><blockquote><p>ç”±äºä¼˜å…ˆçº§å¤ªä½ï¼Œå§‹ç»ˆå¾—ä¸åˆ°CPUè°ƒåº¦æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ç»“æŸ</p></blockquote><h4 id="ReentrantLock-1"><a href="#ReentrantLock-1" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><blockquote><p>å¯é‡å…¥é”</p><p>å¯é‡å…¥ï¼šåŒä¸€ä¸ªçº¿ç¨‹é¦–æ¬¡è·å¾—çº¿ç¨‹åè¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œç¬¬äºŒæ¬¡ç”³è¯·é”ä¸ä¼šè¢«æŒ¡ä½</p><p>ä¸å¯é‡å…¥ï¼šç¬¬äºŒæ¬¡ç”³è¯·é”ä¼šæŠŠè‡ªå·±ä¹ŸæŒ¡åœ¨å¤–é¢</p></blockquote><p>ç›¸è¾ƒäºsynchronizedï¼Œå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¯ä¸­æ–­</li><li>å¯è®¾ç½®è¶…æ—¶æ—¶é—´</li><li>å¯è®¾ç½®ä¸ºå…¬å¹³é”</li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼ˆå¤šä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œä¸åŒæ¡ä»¶è€Œé˜»å¡çš„è¿›ä¸åŒçš„é˜»å¡é˜Ÿåˆ—ï¼‰</li></ul><p><strong>å¯æ‰“æ–­</strong></p><blockquote><p>ä½¿ç”¨æ–¹æ³•**lockInterruptibly()**æ–¹æ³•åŠ å¯æ‰“æ–­çš„é”</p><p>lock()æ–¹æ³•åŠ çš„æ˜¯ä¸å¯æ‰“æ–­çš„é”</p></blockquote><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç«äº‰é‚£ä¹ˆæ­¤æ–¹æ³•å°±ä¼šè·å¾—locké”</span><br>                <span class="hljs-comment">// å¦åˆ™å°±ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—</span><br>                lock.lockInterruptibly();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>                log.debug(<span class="hljs-string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;è·å–åˆ°é”&quot;</span>);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                lock.unlock();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>        lock.lock();<br>        t1.start();<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        t1.interrupt(); <span class="hljs-comment">// æ‰“æ–­</span><br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>å¯è®¾ç½®è¶…æ—¶æ—¶é—´</strong></p><blockquote><p>å¸¦è¶…æ—¶æ—¶é—´çš„ç”³è¯·é”ï¼Œè§£å†³æ­»é”é—®é¢˜</p><p><strong>tryLock()ã€tryLock(long timeout, TimeUnit unit)</strong></p><p>åªå°è¯•è·å–ä¸€æ¬¡é”ï¼Œåœ¨timeoutæ—¶é—´å†…éƒ½ä¼šå°è¯•è·å–é”</p></blockquote><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;å¯åŠ¨ã€‚ã€‚ã€‚&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (!lock.tryLock(<span class="hljs-number">2</span>, TimeUnit.SECONDS)) &#123;<br>                log.debug(<span class="hljs-string">&quot;è·å–é”å¤±è´¥&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;è·å–åˆ°é”&quot;</span>);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br><br>    log.debug(<span class="hljs-string">&quot;è·å–åˆ°é”&quot;</span>);<br>    lock.lock();<br><br>    t1.start();<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¯è®¾ç½®ä¸ºå…¬å¹³é”</strong></p><blockquote><p>ä¸å…¬å¹³é”ï¼šè·å–é”çš„é¡ºåºå’Œæ¥çš„é¡ºåºæ— å…³</p><p>å…¬å¹³é”ï¼šå…ˆæ¥å…ˆå¾—</p><p>å…¬å¹³é”ä¸€èˆ¬æ²¡æœ‰å¿…è¦ï¼Œä¼šé™ä½å¹¶å‘åº¦</p></blockquote><p>å…¬å¹³é”é»˜è®¤å…³é—­ã€‚å¼€å¯å…¬å¹³é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p><strong>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡</strong></p><blockquote><p>å¤šä¸ªä¸åŒçš„é˜»å¡é˜Ÿåˆ—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºé˜»å¡é˜Ÿåˆ—</span><br><span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();<br><span class="hljs-comment">// è¿›å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾…</span><br>condition.await();<br><span class="hljs-comment">// å”¤é†’è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹</span><br>condition.signal();<br><span class="hljs-comment">// å”¤é†’è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„çº¿ç¨‹</span><br>condition.signalAll();<br></code></pre></td></tr></table></figure><h2 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h2><blockquote><p>Java Memary Modelï¼ˆjavaå†…å­˜æ¨¡å‹ï¼‰</p><p>å®šä¹‰äº†ä¸»å­˜ã€å·¥ä½œå†…å­˜æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€ CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚</p></blockquote><p>JMMä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>åŸå­æ€§ï¼šæŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“</li><li>å¯è§æ€§ï¼šæŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“ï¼ˆå¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ï¼‰</li><li>æœ‰åºæ€§ï¼šæŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“ï¼ˆæŒ‡ä»¤é¡ºåºæ‰§è¡Œï¼‰</li></ul><p> å¯ä»¥é€šè¿‡<code>synchronized</code>ä¿è¯ä»£ç å—çš„åŸå­æ€§ï¼Œ<code>volatile</code>ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</p><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><blockquote><p>å¦‚æœçº¿ç¨‹é¢‘ç¹ä»ä¸»å­˜ä¸­è·å–æŸä¸ªå€¼ï¼Œå°±ä¼šå½¢æˆç¼“å­˜ï¼Œå‡å°‘å¯¹ä¸»å­˜çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</p><p>ä½†ä¼šå‡ºç°å†…å­˜ä¸­çš„å€¼æ›´æ–°äº†ï¼Œä½¿å¾—<strong>ç¼“å­˜ä¸­çš„å€¼å’Œå†…å­˜ä¸­çš„ä¸ä¸€è‡´</strong></p><p>ä»è€Œå‡ºç°å¯è§æ€§é—®é¢˜</p></blockquote><p>ç¤ºä¾‹</p><blockquote><p>tçº¿ç¨‹æ— æ³•é€€å‡ºå¾ªç¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test9</span> &#123;<br>    <br>    <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-comment">// å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ</span><br>            <span class="hljs-comment">// å‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</span><br>            <span class="hljs-keyword">while</span> (run) &#123;<br>            &#125;<br>        &#125;);<br>        t.start();<br><br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        log.debug(<span class="hljs-string">&quot;stop t&quot;</span>);<br>        run = <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹å¼ï¼š</p><ol><li><p>volatileå…³é”®å­—ï¼šè¡¨ç¤ºå˜é‡æ˜¯æ˜“å˜çš„ï¼Œæ¯æ¬¡éƒ½ä»å†…å­˜ä¸­è¯»å–ï¼ˆè½»é‡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure></li><li><p>ç»™ä»£ç å—åŠ é”ï¼ˆé‡é‡ï¼‰</p><blockquote><p> synchronizedè§„å®šï¼Œçº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œ å…ˆ<strong>æ¸…ç©ºå·¥ä½œå†…å­˜</strong>â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚</p></blockquote></li></ol><h3 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h3><blockquote><p>æŒ‡ä»¤é‡æ’ï¼šJVM ä¼šåœ¨ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼ˆæµæ°´çº¿ï¼‰ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹æœ‰å¯èƒ½ä¼šå½±å“æ­£ç¡®æ€§</p></blockquote><p>é€šè¿‡volatileå…³é”®å­—ï¼Œå¯ä»¥è¿›åˆ¶æŒ‡ä»¤é‡æ’</p><p><strong>volatileåŸç†ï¼š</strong></p><blockquote><p>è¯»å±éšœï¼šä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®</p><p>å†™å±éšœï¼šä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</p></blockquote><ul><li><p>å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤åä¼šåŠ å…¥å†™å±éšœï¼Œä¹‹å‰çš„ä»£ç éƒ½ä¼šæ‰§è¡Œå®Œå†æ‰§è¡Œå½“å‰æŒ‡ä»¤ï¼Œä¸ä¼šè¢«é‡æ’åºåˆ°å½“å‰æŒ‡ä»¤ä¹‹å ï¼ˆä¿è¯æœ¬çº¿ç¨‹å†…çš„æœ‰åºæ€§ï¼‰</p></li><li><p>å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰ä¼šåŠ å…¥è¯»å±éšœï¼ˆä¿è¯å¯è§æ€§ï¼‰</p></li></ul><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><blockquote><p> é€šè¿‡åŒæ­¥ä»£ç å—synchronizedæ¥ä¿è¯åŸå­æ€§</p></blockquote><p>synchronizedç”¨æ³•ï¼š</p><ol><li>åŠ åœ¨å®ä¾‹æ–¹æ³•ä¸Šï¼šç»™å½“å‰å®ä¾‹å¯¹è±¡åŠ é”</li><li>åŠ åœ¨é™æ€æ–¹æ³•ä¸Šï¼šç»™å½“å‰classç±»åŠ é”</li><li>åŠ åœ¨ä»£ç å—ä¸Šï¼šç»™æŒ‡å®šçš„å¯¹è±¡æˆ–ç±»åŠ é”</li></ol><p>åŸç†ï¼š</p><ul><li><p>ObjectMonitoræœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼š WaitSetã€ EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiter å¯¹è±¡åˆ— è¡¨ã€‚ </p></li><li><p>_ownerï¼Œè·å– Monitor å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥ _owner åŒºæ—¶ï¼Œ _count + 1ã€‚å¦‚æœçº¿ç¨‹è°ƒç”¨ äº† wait() æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾ Monitor å¯¹è±¡ï¼Œ _owner æ¢å¤ä¸ºç©ºï¼Œ _count - 1ã€‚åŒæ—¶ è¯¥ç­‰å¾…çº¿ç¨‹è¿›å…¥ _WaitSet ä¸­ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p></li><li><p>monitorenterï¼Œåœ¨åˆ¤æ–­æ‹¥æœ‰åŒæ­¥æ ‡è¯† ACC_SYNCHRONIZED æŠ¢å…ˆè¿›å…¥æ­¤æ–¹æ³•çš„çº¿ ç¨‹ä¼šä¼˜å…ˆæ‹¥æœ‰ Monitor çš„ owner ï¼Œæ­¤æ—¶è®¡æ•°å™¨ +1ã€‚ </p></li><li><p>monitorexitï¼Œå½“æ‰§è¡Œå®Œé€€å‡ºåï¼Œè®¡æ•°å™¨ -1ï¼Œå½’ 0 åè¢«å…¶ä»–è¿›å…¥çš„çº¿ç¨‹è·å¾—ã€‚</p></li></ul><p><img src="/img/else_img/synchronized%E5%8E%9F%E7%90%86.png"></p><h3 id="dclé—®é¢˜"><a href="#dclé—®é¢˜" class="headerlink" title="dclé—®é¢˜"></a>dclé—®é¢˜</h3><blockquote><p>double-checked locking å•ä¾‹æ¨¡å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123; &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// t2</span><br>            <span class="hljs-comment">// é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åçš„ä½¿ç”¨æ²¡æœ‰ synchronized</span><br>            <span class="hljs-keyword">synchronized</span>(Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// t1</span><br>                    INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ä¸æ˜¯åŸå­æ“ä½œ</strong>ï¼Œ</p><p>åœ¨å•çº¿ç¨‹ä¸‹æ²¡æœ‰é—®é¢˜ï¼Œä½†å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œ</p><p>åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å‘ç”Ÿäº†é‡æ’åºï¼ŒJVMå…ˆå°†å¯¹è±¡åˆ†é…ç»™äº†å˜é‡ï¼Œå†è°ƒç”¨æ„é€ æ–¹æ³•ï¼›å…¶ä»–çº¿ç¨‹åˆ¤æ–­<code>INSTANCE != null</code>ä»è€Œä½¿ç”¨äº†æ²¡æœ‰åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡</p><p><strong>è§£å†³æ–¹å¼ï¼š</strong>ç»™INSTANCEæ·»åŠ volatileå…³é”®å­—ï¼Œä½¿ä¹‹ä¸ä¼šè¢«é‡æ’åº</p><p><strong>å•ä¾‹æ¨¡å¼</strong></p><p>é¥¿æ±‰&#x2F;æ‡’æ±‰å®ç°å•ä¾‹æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŠ finalè¡¨ç¤ºä¸èƒ½è¢«ç»§æ‰¿ï¼Œé˜²æ­¢å­ç±»é‡å†™è·å–å•ä¾‹çš„æ–¹æ³•ä¸å½“å¯¼è‡´newå‡ºå¤šä¸ªå¯¹è±¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123; &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-comment">// é™æ€æˆå‘˜å¯¹è±¡å®åœ¨ç±»åŠ è½½çš„æ—¶å€™åˆ›å»ºçš„ï¼Œä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆæ‡’æ±‰å¼ï¼‰</span><br>    <span class="hljs-comment">// private static final Singleton INSTANCE = new Singleton();</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// t2</span><br>            <span class="hljs-comment">// é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åçš„ä½¿ç”¨æ²¡æœ‰ synchronized</span><br>            <span class="hljs-keyword">synchronized</span>(Singleton.class) &#123;<br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// t1</span><br>                    INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœå®ç°äº†åºåˆ—åŒ–æ¥å£</span><br>    <span class="hljs-comment">// ååºåˆ—åŒ–ä¹Ÿä¼šå¸¸è§æ–°å¯¹è±¡ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±ä¼šè¢«å½“æˆååºåˆ—åŒ–çš„ç»“æœ</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">readResovle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æšä¸¾å®ç°å•ä¾‹</p><blockquote><p>INSTANCEç›¸å½“äºé™æ€æˆå‘˜å¯¹è±¡ï¼Œå±äºæ‡’æ±‰å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    INSTANCE<br>&#125;<br></code></pre></td></tr></table></figure><p>é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123; &#125;<br>    <br>    <span class="hljs-comment">// é™æ€å†…éƒ¨ç±»æ˜¯æ‡’æ±‰å¼åŠ è½½çš„</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyHolder</span> &#123;<br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> LazyHolder.INSTANCE;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ä¹è§‚é”ï¼ˆæ— é”ï¼‰"><a href="#ä¹è§‚é”ï¼ˆæ— é”ï¼‰" class="headerlink" title="ä¹è§‚é”ï¼ˆæ— é”ï¼‰"></a>ä¹è§‚é”ï¼ˆæ— é”ï¼‰</h2><p><strong>åŸå­å˜é‡</strong></p><blockquote><p>å¦‚AtomicIntegerï¼ˆåŸå­æ•´æ•°ï¼‰</p></blockquote><p>æ¡ˆä¾‹ï¼Œå–æ¬¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountSafe</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Account1</span> &#123;<br>    <span class="hljs-keyword">private</span> AtomicInteger balance;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AccountSafe</span><span class="hljs-params">(<span class="hljs-type">int</span> balance)</span> &#123;<br>        <span class="hljs-built_in">this</span>.balance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(balance);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Integer <span class="hljs-title function_">getBalance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> balance.get();<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">withdraw</span><span class="hljs-params">(Integer amount)</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> balance.get();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> prev - amount;<br>            <span class="hljs-comment">// compareAndSetç®€ç§°CAS</span><br>            <span class="hljs-comment">// ä¼šä¸æ–­å°è¯•ï¼Œå¦‚æœprevå’Œå½“å‰å€¼ä¸ä¸€æ ·ï¼Œåˆ™è¿”å›false</span><br>            <span class="hljs-comment">// åªæœ‰å½“prevå’Œå½“å‰å€¼ä¸€æ ·æ—¶æ‰ä¼šä¿®æ”¹</span><br>            <span class="hljs-keyword">if</span> (balance.compareAndSet(prev, next)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>CASå’Œvolatileå…³ç³»</strong></p><blockquote><p>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„å¯è§æ€§ï¼Œéœ€è¦ä½¿ç”¨ volatile ä¿®é¥°ã€‚ </p><p>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å– å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p></blockquote><p>CAS å¿…é¡»å€ŸåŠ© volatile æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æœ€æ–°å€¼æ¥å®ç°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæœ</p><h3 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h3><p>æ— é”æ•ˆç‡é«˜äºæœ‰é”</p><blockquote><ul><li><p>synchronized ä¼šè®©çº¿ç¨‹åœ¨æ²¡æœ‰è·å¾—é”çš„æ—¶å€™ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥é˜»å¡</p></li><li><p>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»£ä»·æ¯”è¾ƒé«˜ï¼Œåœ¨æœ‰å¤šä¸ªæ ¸å¿ƒçš„æƒ…å†µä¸‹ï¼Œæ— é”æ²¡æœ‰åˆ‡æ¢çš„å¼€é”€</p></li><li><p>æ— é”æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä»ç„¶åœ¨è¿è¡Œï¼Œéœ€è¦é¢å¤– CPU çš„æ”¯æŒï¼Œå¦‚æœæ²¡æœ‰é¢å¤– CPU çš„æ”¯æŒï¼Œæ²¡æœ‰åˆ†åˆ°æ—¶é—´ç‰‡ï¼Œè¿˜æ˜¯ä¼šä¸Šä¸‹æ–‡åˆ‡æ¢</p></li></ul></blockquote><h3 id="CASç‰¹ç‚¹"><a href="#CASç‰¹ç‚¹" class="headerlink" title="CASç‰¹ç‚¹"></a>CASç‰¹ç‚¹</h3><ul><li><strong>é€‚ç”¨äºçº¿ç¨‹æ•°å°‘ã€å¤šæ ¸ CPU çš„åœºæ™¯ä¸‹</strong></li><li>åŸºäºä¹è§‚é”ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥æ”¹</li><li>ä½“ç°çš„æ˜¯æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘</li><li>å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li></ul><h3 id="çº¿ç¨‹å®‰å…¨å·¥å…·ç±»"><a href="#çº¿ç¨‹å®‰å…¨å·¥å…·ç±»" class="headerlink" title="çº¿ç¨‹å®‰å…¨å·¥å…·ç±»"></a>çº¿ç¨‹å®‰å…¨å·¥å…·ç±»</h3><h4 id="åŸå­æ•´æ•°"><a href="#åŸå­æ•´æ•°" class="headerlink" title="åŸå­æ•´æ•°"></a>åŸå­æ•´æ•°</h4><blockquote><p>JUCå¹¶å‘åŒ…æä¾›çš„ï¼šAtomicBooleanã€ AtomicIntegerã€ AtomicLong</p></blockquote><p><strong>åŸå­æ•´æ•°çš„apiéƒ½æ˜¯åŸºäºCAS(compareAndSet)å®Œæˆçš„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br><br>    System.out.println(i.incrementAndGet());    <span class="hljs-comment">// ++i</span><br>    System.out.println(i.getAndIncrement());    <span class="hljs-comment">// i++</span><br><br>    System.out.println(i.getAndAdd(<span class="hljs-number">5</span>));<br>    System.out.println(i.addAndGet(<span class="hljs-number">5</span>));<br>    <br>    <span class="hljs-comment">// æ¥æ”¶ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè¿™é‡Œç”¨lambdaè¡¨è¾¾å¼</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        updateAndGetå†…éƒ¨å®ç°</span><br><span class="hljs-comment">         int prev, next;</span><br><span class="hljs-comment">         do &#123;</span><br><span class="hljs-comment">            prev = get();</span><br><span class="hljs-comment">            next = updateFunction.applyAsInt(prev);</span><br><span class="hljs-comment">         &#125; while (!compareAndSet(prev, next));</span><br><span class="hljs-comment">         return next;</span><br><span class="hljs-comment">    **/</span><br>    i.updateAndGet(value -&gt; value * <span class="hljs-number">10</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŸå­å¼•ç”¨"><a href="#åŸå­å¼•ç”¨" class="headerlink" title="åŸå­å¼•ç”¨"></a>åŸå­å¼•ç”¨</h4><blockquote><p>JUCæä¾›çš„ï¼šAtomicReferenceã€ AtomicMarkableReference  ã€ AtomicStampedReference</p></blockquote><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DecimalAccountCas</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Account1</span> &#123;<br><br>    <span class="hljs-comment">// åŸå­å¼•ç”¨</span><br>    <span class="hljs-keyword">private</span> AtomicReference&lt;BigDecimal&gt; balance;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DecimalAccountCas</span><span class="hljs-params">(BigDecimal balance)</span> &#123;<br>        <span class="hljs-built_in">this</span>.balance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(balance);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getBalance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">bigDecimal</span> <span class="hljs-operator">=</span> balance.get();<br>        <span class="hljs-keyword">return</span> bigDecimal.intValue();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">withdraw</span><span class="hljs-params">(Integer amount)</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> balance.get();<br>            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> prev.subtract(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(amount));<br>            <span class="hljs-keyword">if</span> (balance.compareAndSet(prev, next)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h4><p>ABA é—®é¢˜çš„è¿‡ç¨‹æ˜¯å½“æœ‰ä¸¤ä¸ªçº¿ç¨‹ T1 å’Œ T2 ä»å†…å­˜ä¸­è·å–åˆ°å€¼Aï¼Œçº¿ç¨‹ T2 é€šè¿‡æŸäº›æ“ä½œæŠŠå†…å­˜å€¼ä¿®æ”¹ä¸ºBï¼Œç„¶ååˆç»è¿‡æŸäº›æ“ä½œå°†å€¼ä¿®æ”¹ä¸ºå›å€¼Aï¼ŒT2é€€å‡ºã€‚çº¿ç¨‹ T1 è¿›è¡Œæ“ä½œçš„æ—¶å€™ ï¼Œä½¿ç”¨é¢„æœŸå€¼åŒå†…å­˜ä¸­çš„å€¼æ¯”è¾ƒï¼Œæ­¤æ—¶å‡ä¸ºAï¼Œä¿®æ”¹æˆåŠŸé€€å‡ºã€‚ä½†æ˜¯æ­¤æ—¶çš„Aä»¥åŠä¸æ˜¯åŸå…ˆçš„Aäº†</p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>ä½¿ç”¨AtomicReference</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> AtomicReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-comment">// è·å–å€¼</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> ref.get();<br><br>    <span class="hljs-comment">// å…¶ä»–çº¿ç¨‹ä¿®æ”¹ref</span><br>    other();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br><br>    <span class="hljs-comment">// ä¸»çº¿ç¨‹ä¿®æ”¹ref</span><br>    System.out.println(ref.compareAndSet(prev, <span class="hljs-string">&quot;C&quot;</span>));<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        System.out.println(ref.compareAndSet(ref.get(), <span class="hljs-string">&quot;B&quot;</span>));<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br>    Thread.sleep(<span class="hljs-number">500</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        System.out.println(ref.compareAndSet(ref.get(), <span class="hljs-string">&quot;A&quot;</span>));<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹å¼1</strong></p><p>ä½¿ç”¨<strong>AtomicStampedReference</strong>ï¼Œç±»ä¼¼MySQlçš„æ‚²è§‚é”ï¼Œé€šè¿‡ç‰ˆæœ¬å·æ¥åˆ¤æ–­æœ‰æ²¡æœ‰è¢«æ”¹è¿‡</p><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> AtomicStampedReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicStampedReference</span>&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> ref.getReference();<br>    <span class="hljs-comment">// ç‰ˆæœ¬å·</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>    System.out.println(<span class="hljs-string">&quot;å½“å‰ç‰ˆæœ¬å·&quot;</span> + stamp);<br><br>    other();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br><br>    System.out.println(<span class="hljs-string">&quot;è¿‡äº†ä¸€æ®µæ—¶é—´åçš„ç‰ˆæœ¬å·&quot;</span> + ref.getStamp());<br><br>    System.out.println(ref.compareAndSet(prev, <span class="hljs-string">&quot;C&quot;</span>, stamp, stamp + <span class="hljs-number">1</span>));<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>        System.out.println(ref.compareAndSet(ref.getReference(), <span class="hljs-string">&quot;B&quot;</span>, stamp, stamp + <span class="hljs-number">1</span>));<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br>    Thread.sleep(<span class="hljs-number">500</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> ref.getStamp();<br>        System.out.println(ref.compareAndSet(ref.getReference(), <span class="hljs-string">&quot;A&quot;</span>, stamp, stamp + <span class="hljs-number">1</span>));<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// æ§åˆ¶å°</span><br>å½“å‰ç‰ˆæœ¬å·<span class="hljs-number">0</span><br><span class="hljs-literal">true</span><br><span class="hljs-literal">true</span><br>è¿‡äº†ä¸€æ®µæ—¶é—´åçš„ç‰ˆæœ¬å·<span class="hljs-number">2</span><br><span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹å¼2</strong></p><p>å½“åªå…³å¿ƒæ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œè€Œä¸å…³å¿ƒè¢«ä¿®æ”¹äº†å‡ æ¬¡æ—¶ï¼Œä½¿ç”¨<strong>AtomicMarkableReference</strong></p><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> AtomicMarkableReference&lt;String&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicMarkableReference</span>&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-literal">false</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> ref.getReference();<br>    <span class="hljs-comment">// æ˜¯å¦è¢«æ›´æ”¹è¿‡</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">marked</span> <span class="hljs-operator">=</span> ref.isMarked();<br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦è¢«æ›´æ”¹è¿‡&quot;</span> + marked);<br><br>    other();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br><br>    <span class="hljs-comment">// æ˜¯å¦è¢«æ›´æ”¹è¿‡</span><br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦è¢«æ›´æ”¹è¿‡&quot;</span> + ref.isMarked());<br><br>    System.out.println(ref.compareAndSet(prev, <span class="hljs-string">&quot;C&quot;</span>, marked,!marked));<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        System.out.println(ref.compareAndSet(ref.getReference(), <span class="hljs-string">&quot;B&quot;</span>, ref.isMarked(), !ref.isMarked()));<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŸå­æ•°ç»„"><a href="#åŸå­æ•°ç»„" class="headerlink" title="åŸå­æ•°ç»„"></a>åŸå­æ•°ç»„</h4><blockquote><p>JUCæä¾›çš„ï¼šAtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArray</p></blockquote><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    demo(<br>        () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>],<br>        (array) -&gt; array.length,<br>        (array, index) -&gt; array[index]++,<br>        (array) -&gt; System.out.println(Arrays.toString(array))<br>    );<br><br>    <span class="hljs-comment">// åŸå­æ•°ç»„</span><br>    demo(<br>        () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicIntegerArray</span>(<span class="hljs-number">10</span>),<br>        (array) -&gt; array.length(),<br>        (array, index) -&gt; array.getAndIncrement(index),<br>        (array) -&gt; System.out.println(array)<br>    );<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     å‚æ•°1ï¼Œæä¾›æ•°ç»„ã€å¯ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨æ•°ç»„æˆ–çº¿ç¨‹å®‰å…¨æ•°ç»„</span><br><span class="hljs-comment">     å‚æ•°2ï¼Œè·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•</span><br><span class="hljs-comment">     å‚æ•°3ï¼Œè‡ªå¢æ–¹æ³•ï¼Œå›ä¼  array, index</span><br><span class="hljs-comment">     å‚æ•°4ï¼Œæ‰“å°æ•°ç»„çš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo</span><span class="hljs-params">(</span><br><span class="hljs-params">    Supplier&lt;T&gt; arraySupplier,</span><br><span class="hljs-params">    Function&lt;T, Integer&gt; lengthFun,</span><br><span class="hljs-params">    BiConsumer&lt;T, Integer&gt; putConsumer,</span><br><span class="hljs-params">    Consumer&lt;T&gt; printConsumer )</span> &#123;<br><br>    List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-type">T</span> <span class="hljs-variable">array</span> <span class="hljs-operator">=</span> arraySupplier.get();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> lengthFun.apply(array);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>        <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹å¯¹æ•°ç»„ä½œ 10000 æ¬¡æ“ä½œ</span><br>        ts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10000</span>; j++) &#123;<br>                putConsumer.accept(array, j%length);<br>            &#125;<br>        &#125;));<br>    &#125;<br>    ts.forEach(t -&gt; t.start()); <span class="hljs-comment">// å¯åŠ¨æ‰€æœ‰çº¿ç¨‹</span><br>    ts.forEach(t -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            t.join();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;); <span class="hljs-comment">// ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span><br>    printConsumer.accept(array);<br>&#125;<br></code></pre></td></tr></table></figure> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">//</span> <span class="hljs-string">æ§åˆ¶å°</span><br>[<span class="hljs-number">8670</span>, <span class="hljs-number">8543</span>, <span class="hljs-number">8522</span>, <span class="hljs-number">8501</span>, <span class="hljs-number">8475</span>, <span class="hljs-number">8479</span>, <span class="hljs-number">8500</span>, <span class="hljs-number">8436</span>, <span class="hljs-number">8621</span>, <span class="hljs-number">8760</span>]<br>[<span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>]<br></code></pre></td></tr></table></figure><h4 id="å­—æ®µæ›´æ–°å™¨"><a href="#å­—æ®µæ›´æ–°å™¨" class="headerlink" title="å­—æ®µæ›´æ–°å™¨"></a>å­—æ®µæ›´æ–°å™¨</h4><blockquote><p>ä¿è¯å¼•ç”¨ç±»å‹å†…éƒ¨å±æ€§èµ‹å€¼çš„åŸå­æ€§</p><p>JUCæä¾›çš„ï¼šAtomicReferenceFieldUpdater &#x2F;&#x2F; åŸŸ å­—æ®µ ã€AtomicIntegerFieldUpdaterã€AtomicLongFieldUpdater</p></blockquote><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test15</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br><br>        <span class="hljs-type">AtomicReferenceFieldUpdater</span> <span class="hljs-variable">updater</span> <span class="hljs-operator">=</span> AtomicReferenceFieldUpdater.newUpdater(Student.class, String.class, <span class="hljs-string">&quot;name&quot;</span>);<br><br>        updater.compareAndSet(student, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        System.out.println(student);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">volatile</span> String name;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŸå­ç´¯åŠ å™¨"><a href="#åŸå­ç´¯åŠ å™¨" class="headerlink" title="åŸå­ç´¯åŠ å™¨"></a>åŸå­ç´¯åŠ å™¨</h4><blockquote><p>JUCæä¾›çš„ï¼šDoubleAccumulatorã€DoubleAdderã€LongAccumulatorã€LongAdder</p><p>åŸå­ç´¯åŠ å™¨çš„é€Ÿåº¦æ¯”åŸå­æ•´æ•°è¦å¿«</p><p>åœ¨æœ‰ç«äº‰æ—¶ï¼Œè®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒï¼ŒTherad-0 ç´¯åŠ  Cell[0]ï¼Œè€Œ Thread-1 ç´¯åŠ  Cell[1]â€¦ æœ€åå°†ç»“æœæ±‡æ€»ã€‚è¿™æ ·å®ƒä»¬åœ¨ç´¯åŠ æ—¶æ“ä½œçš„ä¸åŒçš„ Cell å˜é‡ï¼Œå› æ­¤å‡å°‘äº† CAS é‡è¯•å¤±è´¥ï¼Œä»è€Œæé«˜æ€§ èƒ½ã€‚</p></blockquote><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        demo(<br>                () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>),<br>                (addr) -&gt; addr.getAndIncrement()<br>        );<br>        demo(<br>                () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAdder</span>(),<br>                (addr) -&gt; addr.increment()<br>        );<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo</span><span class="hljs-params">(Supplier&lt;T&gt; adderSupplier, Consumer&lt;T&gt; action)</span> &#123;<br>    <span class="hljs-type">T</span> <span class="hljs-variable">adder</span> <span class="hljs-operator">=</span> adderSupplier.get();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.nanoTime();<br>    List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-comment">// 4 ä¸ªçº¿ç¨‹ï¼Œæ¯äººç´¯åŠ  50 ä¸‡</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>        ts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">500000</span>; j++) &#123;<br>                action.accept(adder);<br>            &#125;<br>        &#125;));<br>    &#125;<br>    ts.forEach(t -&gt; t.start());<br>    ts.forEach(t -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            t.join();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.nanoTime();<br>    System.out.println(adder + <span class="hljs-string">&quot; cost:&quot;</span> + (end - start) / <span class="hljs-number">1000_000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe"></a>Unsafe</h3><blockquote><p>Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œ<strong>æ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•</strong>ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„è·å¾—</p></blockquote><h4 id="è·å–unsafe"><a href="#è·å–unsafe" class="headerlink" title="è·å–unsafe"></a>è·å–unsafe</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>    <span class="hljs-comment">// é€šè¿‡åå°„è·å–æˆå‘˜å¯¹è±¡</span><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">theUnsafe</span> <span class="hljs-operator">=</span> Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>    theUnsafe.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">// å› ä¸ºtheUnsafeæ˜¯é™æ€çš„ï¼Œä¸ä»å±äºå“ªä¸ªç±»ï¼Œæ‰€ä»¥ä¼ null</span><br>    <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> (Unsafe) theUnsafe.get(<span class="hljs-literal">null</span>);<br><br>    System.out.println(unsafe);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="unsafeçš„casæ“ä½œ"><a href="#unsafeçš„casæ“ä½œ" class="headerlink" title="unsafeçš„casæ“ä½œ"></a>unsafeçš„casæ“ä½œ</h4><blockquote><p>æœ‰compareAndSwapIntã€compareAndSwapLongã€compareAndSwapObject</p></blockquote><p><strong>æ¡ˆä¾‹ï¼šé€šè¿‡unsafeä¿®æ”¹åŸŸ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test17</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-comment">// é€šè¿‡åå°„è·å–æˆå‘˜å¯¹è±¡</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">theUnsafe</span> <span class="hljs-operator">=</span> Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>        theUnsafe.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">// å› ä¸ºtheUnsafeæ˜¯é™æ€çš„ï¼Œä¸ä»å±äºå“ªä¸ªç±»ï¼Œæ‰€ä»¥ä¼ null</span><br>        <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> (Unsafe) theUnsafe.get(<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// è·å–åŸŸçš„åç§»åœ°å€</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">idOffset</span> <span class="hljs-operator">=</span> unsafe.objectFieldOffset(Teacher.class.getDeclaredField(<span class="hljs-string">&quot;id&quot;</span>));<br>        <span class="hljs-type">long</span> <span class="hljs-variable">nameOffset</span> <span class="hljs-operator">=</span> unsafe.objectFieldOffset(Teacher.class.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>));<br><br>        <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>();<br>        unsafe.compareAndSwapInt(teacher, idOffset, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>        unsafe.compareAndSwapObject(teacher, nameOffset, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;zs&quot;</span>);<br>        System.out.println(teacher);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> &#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">volatile</span> String name;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¼ªå…±äº«"><a href="#ä¼ªå…±äº«" class="headerlink" title="ä¼ªå…±äº«"></a>ä¼ªå…±äº«</h4><p>CPUä¼šå°†å†…å­˜ä¸­çš„æ•°æ®è¯»åˆ°ç¼“å­˜ä¸­æ¥æé«˜æ•ˆç‡ï¼Œ</p><p>ç¼“å­˜ä»¥ç¼“å­˜è¡Œä¸ºå•å…ƒï¼Œ</p><p>å¦‚æœæŸä¸ªCPUæ”¹å˜äº†æ•°æ®ï¼Œå…¶ä»– CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»å¤±æ•ˆ</p><p><code>@sun.misc.Contended </code>åŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„å‰åå„å¢åŠ  128 å­—èŠ‚å¤§å°çš„ paddingï¼Œä»è€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶<strong>å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œ</strong>ï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆ</p><h2 id="ä¸å¯å˜"><a href="#ä¸å¯å˜" class="headerlink" title="ä¸å¯å˜"></a>ä¸å¯å˜</h2><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨ä¸èƒ½å¤Ÿä¿®æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p>ä¸å¯å˜ç±»å°±æ˜¯ä¸èƒ½ä¿®æ”¹å…¶å†…éƒ¨çŠ¶æ€çš„ç±»ï¼Œå¦‚æ—¥æœŸè½¬æ¢ç±»<code>SimpleDateFormat</code>æ˜¯å¯å˜çš„ï¼Œè€Œ<code>DateTimeFormatter</code>æ˜¯ä¸å¯å˜ç±»ï¼Œ<code>String</code>ä¹Ÿæ˜¯ä¸å¯å˜ç±»</p><h3 id="final"><a href="#final" class="headerlink" title="final"></a>final</h3><p> final ä¿®é¥°ä¿è¯äº†è¯¥å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹</p><p>ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œé˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§</p><blockquote><p>è®¾ç½®finalå˜é‡åŸç†ï¼šç»™finalèµ‹å€¼çš„æ—¶å€™ï¼Œé€šè¿‡å†™å±éšœï¼Œä¿è¯åœ¨å…¶å®ƒçº¿ç¨‹è¯»åˆ° å®ƒçš„å€¼æ—¶ä¸ä¼šå‡ºç°ä¸º 0 çš„æƒ…å†µ</p><p>è·å–finalå˜é‡åŸç†ï¼šä¼šè¢«å¤åˆ¶ä¸€ä»½åˆ°å…¶ä»–ç±»çš„æ–¹æ³•æ ˆ&#x2F;å¸¸é‡æ± ä¸­ï¼Œæ²¡æœ‰å…±äº«çš„é—®é¢˜ï¼Œæ€§èƒ½æ›´é«˜</p></blockquote><h3 id="æ— çŠ¶æ€"><a href="#æ— çŠ¶æ€" class="headerlink" title="æ— çŠ¶æ€"></a>æ— çŠ¶æ€</h3><p>æ²¡æœ‰æˆå‘˜å˜é‡ç§°ä¸ºæ— çŠ¶æ€ï¼Œæ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</p><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><h3 id="è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>è‡ªå®šä¹‰çº¿ç¨‹æ± </h3><p>å¸¦ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹é˜»å¡é˜Ÿåˆ—ï¼Œè¶…æ—¶æ—¶é—´</p><p>ç­–ç•¥æ¨¡å¼ï¼šå½“ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†è¯¥æ€ä¹ˆåš</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test21&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test21</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ThreadPool</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPool</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS, <span class="hljs-number">1</span>, (queue, task) -&gt; &#123;<br>            <span class="hljs-comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</span><br>            <span class="hljs-comment">// å½“é˜Ÿåˆ—æ»¡äº†å¯ä»¥æœ‰çš„é€‰æ‹©</span><br>            <span class="hljs-comment">// 1 æ­»ç­‰</span><br>            <span class="hljs-comment">// queue.put(task);</span><br>            <span class="hljs-comment">// 2 å¸¦è¶…æ—¶æ—¶é—´ç­‰å¾…</span><br>            <span class="hljs-comment">// queue.put(task, 1500, TimeUnit.MILLISECONDS);</span><br>            <span class="hljs-comment">// 3 è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ</span><br>            <span class="hljs-comment">// å•¥éƒ½ä¸åš</span><br>            <span class="hljs-comment">// 4 è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-comment">// throw new RuntimeException(&quot;ä»»åŠ¡æ‰§è¡Œå¤±è´¥&quot; + task);</span><br>            <span class="hljs-comment">// 5 è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡</span><br>             task.run();<br>        &#125;);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i;<br>            threadPool.execute(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, j);<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.ThreadPool&quot;)</span><br><span class="hljs-comment">// çº¿ç¨‹æ± </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> &#123;<br>    <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—</span><br>    BlockingQueue&lt;Runnable&gt; taskQueue;<br><br>    <span class="hljs-comment">// çº¿ç¨‹é›†åˆ</span><br>    HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-type">int</span> coreSize;<br><br>    <span class="hljs-comment">// è·å–ä»»åŠ¡è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-type">long</span> timeout;<br><br>    <span class="hljs-comment">// è¶…æ—¶æ—¶é—´å•ä½</span><br>    TimeUnit unit;<br><br>    <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br>    <span class="hljs-keyword">private</span> RejectPolicy&lt;Runnable&gt; rejectPolicy;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> coreSize, <span class="hljs-type">long</span> timeout, TimeUnit unit, <span class="hljs-type">int</span> queueCapacity, RejectPolicy&lt;Runnable&gt; rejectPolicy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.coreSize = coreSize;<br>        <span class="hljs-built_in">this</span>.timeout = timeout;<br>        <span class="hljs-built_in">this</span>.unit = unit;<br>        <span class="hljs-built_in">this</span>.taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockingQueue</span>&lt;&gt;(queueCapacity);<br>        <span class="hljs-built_in">this</span>.rejectPolicy = rejectPolicy;<br>    &#125;<br><br>    <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable task)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (workers) &#123;<br>            <span class="hljs-keyword">if</span> (workers.size() &lt; coreSize) &#123;<br>                <span class="hljs-comment">// çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ›å»ºæ–°çš„çº¿ç¨‹</span><br>                <span class="hljs-type">Worker</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(task);<br>                workers.add(worker);<br>                log.debug(<span class="hljs-string">&quot;æ–°å¢worker&#123;&#125;&quot;</span>, worker);<br>                worker.start();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­</span><br>                <span class="hljs-comment">// taskQueue.put(task);</span><br><br>                <span class="hljs-comment">// å°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¸¦æ‹’ç»ç­–ç•¥</span><br>                taskQueue.tryPut(rejectPolicy, task);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span>&#123;<br>        <span class="hljs-keyword">private</span> Runnable task;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Worker</span><span class="hljs-params">(Runnable task)</span> &#123;<br>            <span class="hljs-built_in">this</span>.task = task;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-comment">// æŸ¥è¯¢ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ä»»åŠ¡</span><br>            <span class="hljs-keyword">while</span> (task != <span class="hljs-literal">null</span> || (task = taskQueue.take(timeout, unit)) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.debug(<span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œ..&#123;&#125;&quot;</span>, task);<br>                    task.run();<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    task = <span class="hljs-literal">null</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// å¤ªä¹…æ²¡ç”¨çš„workerä¼šè¢«åˆ æ‰</span><br>            <span class="hljs-keyword">synchronized</span> (workers) &#123;<br>                log.debug(<span class="hljs-string">&quot;ç§»é™¤workerï¼š&#123;&#125;&quot;</span>, workers);<br>                workers.remove(<span class="hljs-built_in">this</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br><span class="hljs-comment">// å‡½æ•°å¼æ¥å£</span><br><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RejectPolicy</span> &lt;T&gt;&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">reject</span><span class="hljs-params">(BlockingQueue&lt;T&gt; queue, T task)</span>;<br>&#125;<br><br><br><span class="hljs-comment">// è‡ªå®šä¹‰é˜»å¡é˜Ÿåˆ—</span><br><span class="hljs-meta">@Slf4j(topic = &quot;c.BlockingQueue&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingQueue</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">// å­˜æ”¾ä»»åŠ¡</span><br>    Deque&lt;T&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br><br>    <span class="hljs-comment">// å®¹é‡</span><br>    <span class="hljs-type">int</span> capacity;<br><br>    <span class="hljs-comment">// é”</span><br>    <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—: é˜Ÿæ»¡</span><br>    <span class="hljs-type">Condition</span> <span class="hljs-variable">fullWaitSet</span> <span class="hljs-operator">=</span> lock.newCondition();<br><br>    <span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—: é˜Ÿç©º</span><br>    <span class="hljs-type">Condition</span> <span class="hljs-variable">emptyWaitSet</span> <span class="hljs-operator">=</span> lock.newCondition();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BlockingQueue</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> &#123;<br>        <span class="hljs-built_in">this</span>.capacity = capacity;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–ä»»åŠ¡</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">take</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è‹¥é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œå¦åˆ™è·å–é˜Ÿåˆ—ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶é€šçŸ¥é˜Ÿæ»¡é˜»å¡é˜Ÿåˆ—</span><br>            <span class="hljs-keyword">while</span> (queue.isEmpty()) &#123;<br>                emptyWaitSet.await();<br>            &#125;<br>            <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> queue.removeFirst();<br>            fullWaitSet.signal();<br>            <span class="hljs-keyword">return</span> t;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–ä»»åŠ¡ï¼Œå¸¦è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">take</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è‹¥é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œå¦åˆ™è·å–é˜Ÿåˆ—ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶é€šçŸ¥é˜Ÿæ»¡é˜»å¡é˜Ÿåˆ—</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);<br>            <span class="hljs-keyword">while</span> (queue.isEmpty()) &#123;<br>                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">// è¶…å‡ºè¶…æ—¶æ—¶é—´è€Œæ²¡æœ‰ç­‰åˆ°ï¼Œè¿”å›null</span><br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>                nanos = emptyWaitSet.awaitNanos(nanos);<br>            &#125;<br>            <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> queue.removeFirst();<br>            fullWaitSet.signal();<br>            <span class="hljs-keyword">return</span> t;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ·»åŠ ä»»åŠ¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(T task)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è‹¥é˜Ÿåˆ—ä¸ºæ»¡åˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œå¦åˆ™å°†ä»»åŠ¡æ·»åŠ è¿›é˜Ÿå°¾ï¼Œå¹¶é€šçŸ¥é˜Ÿç©ºé˜»å¡é˜Ÿåˆ—</span><br>            <span class="hljs-keyword">while</span> (queue.size() &gt;= capacity) &#123;<br>                log.debug(<span class="hljs-string">&quot;ç­‰å¾…åŠ å…¥é˜Ÿåˆ—&#123;&#125;&quot;</span>, task);<br>                fullWaitSet.await();<br>            &#125;<br>            queue.offer(task);<br>            log.debug(<span class="hljs-string">&quot;åŠ å…¥é˜Ÿåˆ—&#123;&#125;&quot;</span>, task);<br>            emptyWaitSet.signal();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ·»åŠ ä»»åŠ¡ï¼Œå¸¦è¶…æ—¶æ—¶é—´</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">put</span><span class="hljs-params">(T task, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è‹¥é˜Ÿåˆ—ä¸ºæ»¡åˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œå¦åˆ™å°†ä»»åŠ¡æ·»åŠ è¿›é˜Ÿå°¾ï¼Œå¹¶é€šçŸ¥é˜Ÿç©ºé˜»å¡é˜Ÿåˆ—</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">nanos</span> <span class="hljs-operator">=</span> unit.toNanos(timeout);<br>            <span class="hljs-keyword">while</span> (queue.size() &gt;= capacity) &#123;<br>                <span class="hljs-comment">// è¶…å‡ºè¶…æ—¶æ—¶é—´è€Œæ²¡æœ‰æ·»åŠ æˆåŠŸ</span><br>                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                &#125;<br>                nanos = fullWaitSet.awaitNanos(nanos);<br>            &#125;<br>            queue.offer(task);<br>            emptyWaitSet.signal();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// å½“å‰é˜Ÿåˆ—å¤§å°</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> queue.size();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">// æ·»åŠ ä»»åŠ¡ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„æ‹’ç»ç­–ç•¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tryPut</span><span class="hljs-params">(RejectPolicy&lt;T&gt; rejectPolicy, T task)</span> &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (queue.size() &gt;= capacity) &#123;<br>                <span class="hljs-comment">// é˜Ÿåˆ—æ»¡äº†ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥</span><br>                rejectPolicy.reject(<span class="hljs-built_in">this</span>, task);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// é˜Ÿåˆ—æ²¡æ»¡</span><br>                queue.offer(task);<br>                log.debug(<span class="hljs-string">&quot;åŠ å…¥é˜Ÿåˆ—&#123;&#125;&quot;</span>, task);<br>                emptyWaitSet.signal();<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ThreadPoolExcutor"><a href="#ThreadPoolExcutor" class="headerlink" title="ThreadPoolExcutor"></a>ThreadPoolExcutor</h3><p><img src="/img/bingfa_img/ThreadPoolExecurtor.png"></p><h4 id="çº¿ç¨‹æ± çŠ¶æ€"><a href="#çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€"></a>çº¿ç¨‹æ± çŠ¶æ€</h4><p>ThreadPoolExecutor ä½¿ç”¨ int çš„é«˜ 3 ä½æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½ 29 ä½è¡¨ç¤ºçº¿ç¨‹æ•°é‡</p><table><thead><tr><th>çŠ¶æ€å</th><th>é«˜3ä½</th><th>æ¥æ”¶æ–°ä»»åŠ¡</th><th>å¤„ç†é˜»å¡é˜Ÿåˆ—ä»»åŠ¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>RUNNING</td><td>111</td><td>Y</td><td>Y</td><td></td></tr><tr><td>SHUTDOWN</td><td>000</td><td>N</td><td>Y</td><td>ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—å‰©ä½™ ä»»åŠ¡</td></tr><tr><td>STOP</td><td>001</td><td>N</td><td>N</td><td>ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ— ä»»åŠ¡</td></tr><tr><td>TIDYING</td><td>010</td><td>-</td><td>-</td><td>ä»»åŠ¡å…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º 0 å³å°†è¿›å…¥ ç»ˆç»“</td></tr><tr><td>TERMINATED</td><td>011</td><td>-</td><td>-</td><td>ç»ˆç»“çŠ¶æ€</td></tr></tbody></table><p>å°†çŠ¶æ€ä¿¡æ¯å’Œçº¿ç¨‹æ•°é‡ä¿å­˜åœ¨åŒä¸€ä¸ªæ•´æ•°ä¸­æ˜¯ä¸ºäº†å¯ä»¥ç”¨1ä¸€æ¬¡casæ“ä½œè¿›è¡Œèµ‹å€¼</p><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params">                              <span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params">                              <span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">                              TimeUnit unit,</span><br><span class="hljs-params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="hljs-params">                              ThreadFactory threadFactory,</span><br><span class="hljs-params">                              RejectedExecutionHandler handler)</span><br></code></pre></td></tr></table></figure><ul><li><p>corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® (æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°) </p><ul><li>maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›®</li></ul></li><li><p>keepAliveTime ç”Ÿå­˜æ—¶é—´ - <strong>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹</strong> </p></li><li><p>unit æ—¶é—´å•ä½ - <strong>é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹</strong> </p></li><li><p>workQueue é˜»å¡é˜Ÿåˆ— </p></li><li><p>threadFactory çº¿ç¨‹å·¥å‚ - å¯ä»¥ä¸ºçº¿ç¨‹åˆ›å»ºæ—¶èµ·ä¸ªå¥½åå­— </p></li><li><p>handler æ‹’ç»ç­–ç•¥</p></li></ul><blockquote><p>å½“çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°è¶…è¿‡äº†é˜Ÿåˆ—å¤§å°æ—¶ï¼Œä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å½“æ•‘æ€¥çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§åˆ›å»ºçš„æ•°é‡æ—¶ï¼Œä»ç„¶æœ‰æ–°ä»»åŠ¡ï¼Œæ­¤æ—¶åˆ™ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥</p><p>æ•‘æ€¥çº¿ç¨‹æœ‰ç”Ÿå­˜æ—¶é—´ï¼Œè€Œæ ¸å¿ƒçº¿ç¨‹æ²¡æœ‰</p></blockquote><h4 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h4><p><img src="/img/bingfa_img/%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5.png"></p><ul><li>AbortPolicy è®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥</li><li>CallerRunsPolicy è®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡</li><li>DiscardPolicy æ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡</li><li>DiscardOldestPolicy æ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£</li></ul><h4 id="çº¿ç¨‹å·¥å‚"><a href="#çº¿ç¨‹å·¥å‚" class="headerlink" title="çº¿ç¨‹å·¥å‚"></a>çº¿ç¨‹å·¥å‚</h4><p><strong>newFixedThreadPool å›ºå®šå¤§å°çº¿ç¨‹æ± </strong></p><p>æ ¸å¿ƒçº¿ç¨‹æ•°ç­‰äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå› æ­¤æ²¡æœ‰æ•‘æ€¥çº¿ç¨‹</p><p>é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡</p><blockquote><p>é€‚ç”¨äºä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test22&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test22</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() &#123;<br>            <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">&quot;myPool_t&quot;</span> + t.getAndIncrement());<br>            &#125;<br>        &#125;);<br><br>        pool.execute(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;1&quot;</span>);<br>        &#125;);<br><br>        pool.execute(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;2&quot;</span>);<br>        &#125;);<br><br>        pool.execute(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;3&quot;</span>);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>newCachedThreadPool ç¼“å†²çº¿ç¨‹</strong></p><p>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œå› æ­¤å…¨éƒ¨çº¿ç¨‹éƒ½ä¸ºæ•‘æ€¥çº¿ç¨‹ï¼ˆç”Ÿå­˜å‘¨æœŸ60sï¼‰</p><p>åªæœ‰å½“æœ‰çº¿ç¨‹æ¥çº¿ç¨‹æ± å–ä»»åŠ¡æ—¶ï¼Œæ‰èƒ½æ”¾ä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­</p><blockquote><p> é€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    SynchronousQueue&lt;Integer&gt; integers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;();<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;putting &#123;&#125; &quot;</span>, <span class="hljs-number">1</span>);<br>            integers.put(<span class="hljs-number">1</span>);<br>            log.debug(<span class="hljs-string">&quot;&#123;&#125; putted...&quot;</span>, <span class="hljs-number">1</span>);<br>            log.debug(<span class="hljs-string">&quot;putting...&#123;&#125; &quot;</span>, <span class="hljs-number">2</span>);<br>            integers.put(<span class="hljs-number">2</span>);<br>            log.debug(<span class="hljs-string">&quot;&#123;&#125; putted...&quot;</span>, <span class="hljs-number">2</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;,<span class="hljs-string">&quot;t1&quot;</span>).start();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;taking &#123;&#125;&quot;</span>, <span class="hljs-number">1</span>);<br>            integers.take();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;,<span class="hljs-string">&quot;t2&quot;</span>).start();<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;taking &#123;&#125;&quot;</span>, <span class="hljs-number">2</span>);<br>            integers.take();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;,<span class="hljs-string">&quot;t3&quot;</span>).start();<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>newSingleThreadExecutor å•ä¾‹çº¿ç¨‹æ± </strong></p><p>çº¿ç¨‹æ•°å›ºå®šä¸º 1ï¼Œä»»åŠ¡æ•°å¤šäº 1 æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿ</p><p>ä¸è‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„åŒºåˆ«ï¼š</p><ul><li>è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æªæ–½ï¼Œè€Œçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œ</li><li>e åº”ç”¨çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼Œåªå¯¹å¤–æš´éœ²äº† ExecutorService æ¥å£ï¼Œå›  æ­¤ä¸èƒ½è°ƒç”¨ ThreadPoolExecutor ä¸­ç‰¹æœ‰çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br>    pool.execute(() -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<br>    &#125;);<br>    pool.execute(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;ä»ç„¶ç»§ç»­æ‰§è¡Œ&quot;</span>);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>newScheduledThreadPool å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </strong></p><p>å¯ä»¥å»¶æ—¶æ‰§è¡Œä»»åŠ¡å’Œå®šæ—¶æ‰§è¡Œä»»åŠ¡(éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡)ï¼Œé€šè¿‡è®¾ç½®çº¿ç¨‹æ•°ï¼Œä½¿å¾—è‹¥ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿&#x2F;æ‰§è¡Œå‡ºé”™ï¼Œä¸ä¼šå½±å“å…¶ä»–çš„å®šæ—¶ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šæ—¶ä»»åŠ¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);<br><br>    pool.schedule(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;task1&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br><br>    pool.schedule(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;task2&quot;</span>);<br>    &#125;, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å»¶æ—¶ä»»åŠ¡</span><br><span class="hljs-comment">// å¦‚æœåªè®¾ç½®äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿æ—¶ï¼Œä¼šå»¶åä¸‹ä¸€ä¸ªä»»åŠ¡</span><br><span class="hljs-comment">// scheduleAtFixedRateæ˜¯ä»å¼€å§‹æ—¶é—´æ¥æŠ€å¸ˆ</span><br><span class="hljs-comment">// scheduleWithFixedDelayä»ä»»åŠ¡ç»“æŸæ—¶é—´å¼€å§‹ç®—æ—¶é—´</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);<br><br>    log.debug(<span class="hljs-string">&quot;start...&quot;</span>);<br>    pool.scheduleAtFixedRate(() -&gt;&#123;<br>        log.debug(<span class="hljs-string">&quot;running...&quot;</span>);<br>    &#125;, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, TimeUnit.SECONDS);<br>&#125;<br></code></pre></td></tr></table></figure><p>åº”ç”¨ï¼šæ¯å‘¨äº”18ç‚¹æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>    System.out.println(now);<br><br>    <span class="hljs-comment">// è·å–æœ¬å‘¨äº”18:0:0çš„æ—¶é—´ï¼Œå¦‚æœå½“å‰æ—¶é—´è¶…è¿‡å‘¨äº”äº†ï¼Œåˆ™è·å–ä¸‹å‘¨çš„</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> now.withHour(<span class="hljs-number">18</span>).withMinute(<span class="hljs-number">0</span>).withSecond(<span class="hljs-number">0</span>).withNano(<span class="hljs-number">0</span>).with(DayOfWeek.FRIDAY);<br>    <span class="hljs-keyword">if</span> (now.compareTo(time) &gt; <span class="hljs-number">0</span>) &#123;<br>        time = time.plusWeeks(<span class="hljs-number">1</span>);<br>    &#125;<br>    System.out.println(time);<br><br>    <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);<br>    <span class="hljs-comment">// å¼€å§‹æ—¶é—´</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">initialDelay</span> <span class="hljs-operator">=</span> Duration.between(now, time).toMillis();<br>    <span class="hljs-comment">// é—´éš”æ—¶é—´</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">period</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>;<br>    pool.scheduleAtFixedRate(() -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;running&quot;</span>);<br>    &#125;, initialDelay, period, TimeUnit.MILLISECONDS);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œä»»åŠ¡æ–¹æ³•"><a href="#æ‰§è¡Œä»»åŠ¡æ–¹æ³•" class="headerlink" title="æ‰§è¡Œä»»åŠ¡æ–¹æ³•"></a>æ‰§è¡Œä»»åŠ¡æ–¹æ³•</h4><p><strong>void  execute(Runnable command)</strong></p><p>æ‰§è¡Œä»»åŠ¡</p><p><strong>&lt;T&gt;Future&lt;T&gt; submit((Callable&lt;T&gt; task)</strong></p><p>æäº¤ä»»åŠ¡ taskï¼Œç”¨<strong>è¿”å›å€¼</strong> Future è·å¾—ä»»åŠ¡æ‰§è¡Œç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-comment">// æœ‰è¿”å›ç»“æœ</span><br>    Future&lt;String&gt; future = pool.submit(() -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;running..&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;);<br><br>    System.out.println(future.get());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>invokeAll</strong></p><p>æäº¤æ‰€æœ‰ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>    List&lt;Future&lt;String&gt;&gt; futures = pool.invokeAll(Arrays.asList(<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;,<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">500</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2&quot;</span>;<br>        &#125;,<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;3&quot;</span>;<br>        &#125;<br>    ));<br>    futures.forEach(f -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(f.get());<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;);<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>invokeAny</strong></p><p>å°†æœ€å…ˆæ‰§è¡Œå®Œæˆçš„ä»»åŠ¡çš„è¿”å›å€¼è¿”å›ï¼Œå…¶ä»–ä»»åŠ¡å–æ¶ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pool.invokeAny(Arrays.asList(<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>        &#125;,<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">500</span>);<br>            log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2&quot;</span>;<br>        &#125;,<br>        () -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>            log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;3&quot;</span>;<br>        &#125;<br>    ));<br>    log.debug(result);<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å…³é—­çº¿ç¨‹æ± æ–¹æ³•"><a href="#å…³é—­çº¿ç¨‹æ± æ–¹æ³•" class="headerlink" title="å…³é—­çº¿ç¨‹æ± æ–¹æ³•"></a>å…³é—­çº¿ç¨‹æ± æ–¹æ³•</h4><p><strong>shutdown</strong></p><p>å°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºSHUTDOWNï¼Œä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå·²æäº¤çš„ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>    Future&lt;Integer&gt; result1 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 1 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;);<br><br>    Future&lt;Integer&gt; result2 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 2 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>    &#125;);<br><br>    Future&lt;Integer&gt; result3 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 3 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>    &#125;);<br><br>    log.debug(<span class="hljs-string">&quot;å…³é—­çº¿ç¨‹æ± &quot;</span>);<br>    pool.shutdown();<br><br>&#125;<br></code></pre></td></tr></table></figure> <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">25</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.Test22</span> - å…³é—­çº¿ç¨‹æ± <br><span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">26</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test22</span> - task <span class="hljs-number">2</span> running<br><span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">26</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.Test22</span> - task <span class="hljs-number">1</span> running<br><span class="hljs-number">15</span>:<span class="hljs-number">17</span>:<span class="hljs-number">27</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test22</span> - task <span class="hljs-number">3</span> running<br></code></pre></td></tr></table></figure><p><strong>shutdownNow</strong></p><p>å°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºSTOPï¼Œä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼Œç”¨interruptæ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå°†å·²æäº¤çš„ä»»åŠ¡å…¨éƒ¨è¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>    Future&lt;Integer&gt; result1 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 1 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;);<br><br>    Future&lt;Integer&gt; result2 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 2 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>    &#125;);<br><br>    Future&lt;Integer&gt; result3 = pool.submit(() -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            log.debug(<span class="hljs-string">&quot;task 3 running&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>    &#125;);<br><br>    log.debug(<span class="hljs-string">&quot;ç«‹å³å…³é—­çº¿ç¨‹æ± &quot;</span>);<br>    List&lt;Runnable&gt; runnables = pool.shutdownNow();<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, runnables);<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-number">15</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.Test22</span> - å…³é—­çº¿ç¨‹æ± <br><span class="hljs-number">15</span>:<span class="hljs-number">24</span>:<span class="hljs-number">57</span> <span class="hljs-selector-attr">[main]</span> c<span class="hljs-selector-class">.Test22</span> - <span class="hljs-selector-attr">[java.util.concurrent.FutureTask@35851384]</span><br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.InterruptedException</span>: sleep interrupted<br></code></pre></td></tr></table></figure><h4 id="å¤„ç†å¼‚å¸¸"><a href="#å¤„ç†å¼‚å¸¸" class="headerlink" title="å¤„ç†å¼‚å¸¸"></a>å¤„ç†å¼‚å¸¸</h4><ol><li><p>try..catchæ•è·å¼‚å¸¸</p></li><li><p>ä½¿ç”¨future</p><p>æ²¡æœ‰å¼‚å¸¸çš„æ—¶å€™è¿”å›returnçš„ç»“æœï¼Œæœ‰å¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException &#123;<br>    <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);<br><br>    Future&lt;Boolean&gt; f = pool.submit(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;task1&quot;</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> / <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;);<br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, f.get());<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="tomcatçº¿ç¨‹æ± "><a href="#tomcatçº¿ç¨‹æ± " class="headerlink" title="tomcatçº¿ç¨‹æ± "></a>tomcatçº¿ç¨‹æ± </h4><p><img src="/img/bingfa_img/tomcat%E7%BA%BF%E7%A8%8B%E6%B1%A0.png"></p><p>tomcatä¸­ç”¨åˆ°çš„çº¿ç¨‹æ± </p><ul><li>LimitLatch ç”¨æ¥é™æµï¼Œå¯ä»¥æ§åˆ¶æœ€å¤§è¿æ¥ä¸ªæ•°ï¼Œç±»ä¼¼ J.U.C ä¸­çš„ Semaphore</li><li>Acceptor åªè´Ÿè´£ã€æ¥æ”¶æ–°çš„ socket è¿æ¥ã€‘</li><li>Poller åªè´Ÿè´£ç›‘å¬ socket channel æ˜¯å¦æœ‰ã€å¯è¯»çš„ I&#x2F;O äº‹ä»¶ã€‘</li><li>ä¸€æ—¦å¯è¯»ï¼Œå°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼ˆsocketProcessorï¼‰ï¼Œæäº¤ç»™ Executor çº¿ç¨‹æ± å¤„ç†</li><li>Executor çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æœ€ç»ˆè´Ÿè´£ã€å¤„ç†è¯·æ±‚ã€‘</li></ul><h3 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h3><p>Fork&#x2F;Join æ˜¯ JDK 1.7 åŠ å…¥çš„æ–°çš„çº¿ç¨‹æ± å®ç°ï¼Œå®ƒä½“ç°çš„æ˜¯ä¸€ç§<strong>åˆ†æ²»æ€æƒ³</strong>ï¼Œé€‚ç”¨äºèƒ½å¤Ÿè¿›è¡Œä»»åŠ¡æ‹†åˆ†çš„ cpu å¯†é›†å‹ è¿ç®—</p><blockquote><p>å°±æ˜¯ç”¨å¤šçº¿ç¨‹æ¥è®¡ç®—å„éƒ¨åˆ†çš„å€¼ï¼Œæœ€ååˆå¹¶</p></blockquote><p><strong>æ¡ˆä¾‹</strong></p><p>è®¡ç®—1~nçš„å’Œ</p><p>æ‹†åˆ†çš„ä¸å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç»“æœï¼Œæ€»ä½“ä¸Šåƒä¸²è¡Œæ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test23</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<span class="hljs-number">4</span>);<br>        System.out.println(pool.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>(<span class="hljs-number">5</span>)));<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.MyTask&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Integer&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> n;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyTask</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>        <span class="hljs-built_in">this</span>.n = n;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// é€€å‡ºæ¡ä»¶</span><br>        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) &#123;<br>            log.debug(<span class="hljs-string">&quot;join() &#123;&#125;&quot;</span>, n);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// æ‹†åˆ†</span><br>        <span class="hljs-type">MyTask</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>(n - <span class="hljs-number">1</span>);<br>        t1.fork();  <span class="hljs-comment">// è®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span><br>        log.debug(<span class="hljs-string">&quot;fork() &#123;&#125; + &#123;&#125;&quot;</span>, n, t1);<br><br>        <span class="hljs-comment">// åˆå¹¶ç»“æœ</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> n + t1.join();  <span class="hljs-comment">// è·å–ç»“æœ</span><br>        log.debug(<span class="hljs-string">&quot;join() &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>, n, t1, result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&#123;&quot;</span> + n + <span class="hljs-string">&quot;&#125;&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ”¹è¿›</strong></p><p>æ‹†åˆ†æˆä¸¤éƒ¨åˆ†è®¡ç®—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test23</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<span class="hljs-number">4</span>);<br>        System.out.println(pool.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask2</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)));<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Slf4j(topic = &quot;c.MyTask&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Integer&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> begin;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> end;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyTask2</span><span class="hljs-params">(<span class="hljs-type">int</span> begin, <span class="hljs-type">int</span> end)</span> &#123;<br>        <span class="hljs-built_in">this</span>.begin = begin;<br>        <span class="hljs-built_in">this</span>.end = end;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åªæœ‰ä¸€ä¸ªæ•°æ—¶</span><br>        <span class="hljs-keyword">if</span> (begin == end) &#123;<br>            <span class="hljs-keyword">return</span> begin;<br>        &#125;<br>        <span class="hljs-comment">// åªæœ‰ä¸¤ä¸ªæ•°æ—¶</span><br>        <span class="hljs-keyword">if</span> (end - begin == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span> end - begin;<br>        &#125;<br><br>        <span class="hljs-comment">// æ‹†åˆ†æˆå‰åä¸¤éƒ¨åˆ†</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> begin + (end - begin) / <span class="hljs-number">2</span>;<br>        <span class="hljs-type">MyTask2</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask2</span>(begin, mid);<br>        t1.fork();<br>        <span class="hljs-type">MyTask2</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask2</span>(mid + <span class="hljs-number">1</span>, end);<br>        t2.fork();<br><br>        <span class="hljs-keyword">return</span> t1.join() + t2.join();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="star-JUCå·¥å…·åŒ…"><a href="#star-JUCå·¥å…·åŒ…" class="headerlink" title=":star:JUCå·¥å…·åŒ…"></a>:star:JUCå·¥å…·åŒ…</h3><h4 id="AQSåŸç†"><a href="#AQSåŸç†" class="headerlink" title="AQSåŸç†"></a>AQSåŸç†</h4><p>å…¨ç§°AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æ¶</p><p>æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>ç”¨ state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆç‹¬å ã€å…±äº«ï¼‰</li><li>æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—</li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡(ä¸åŒæ¡ä»¶çš„ç­‰å¾…é˜Ÿåˆ—)</li></ul><p><strong>è‡ªå®šä¹‰ä¸€ä¸ªé”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.Test24&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test24</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MyLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLock</span>();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            lock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;locking...&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;unlocking...&quot;</span>);<br>                lock.unlock();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            lock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;locking...&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                log.debug(<span class="hljs-string">&quot;unlocking...&quot;</span>);<br>                lock.unlock();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> &#123;<br><br>    <span class="hljs-comment">// å°è¯•ä¸Šé”</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> &#123;<br>        <span class="hljs-keyword">if</span> (acquires == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">// è®¾ç½®å½“å‰é”çš„æŒæœ‰è€…</span><br>                setExclusiveOwnerThread(Thread.currentThread());<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> &#123;<br>        <span class="hljs-keyword">if</span> (acquires == <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">if</span> (getState() == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();<br>            &#125;<br>            <span class="hljs-comment">// è®¾ç½®å½“å‰æ²¡äººæŒæœ‰</span><br>            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);<br>            setState(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä¸å¯é‡å…¥</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span> &#123;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">MySync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySync</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> &#123;<br>        sync.acquire(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å¯æ‰“æ–­é”</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        sync.acquireInterruptibly(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, unit.toNanos(time));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>        sync.release(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sync.newCondition();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ReentrantLockåŸç†"><a href="#ReentrantLockåŸç†" class="headerlink" title="ReentrantLockåŸç†"></a>ReentrantLockåŸç†</h4><p><img src="/img/bingfa_img/%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81%E5%8E%9F%E7%90%861.png"></p><p><strong>éå…¬å¹³é”åŸç†</strong></p><ol><li>ReentrantLocké»˜è®¤æ˜¯éå…¬å¹³é”</li></ol><p><img src="/img/bingfa_img/%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81%E5%8E%9F%E7%90%861.png"></p><ol start="2"><li>è°ƒç”¨äº†éå…¬å¹³é”çš„ä¸Šé”æ–¹æ³•lock()</li></ol><p><img src="/img/bingfa_img/%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81%E5%8E%9F%E7%90%862.png"></p><ol start="3"><li><p>lockæ–¹æ³•</p><blockquote><p>å¦‚æœæˆåŠŸä¸Šé”ï¼Œåˆ™æŠŠé”çš„çŠ¶æ€æ”¹ä¸º1ï¼Œé”çš„æ‹¥æœ‰è€…æ”¹ä¸ºå½“å‰çº¿ç¨‹</p><p>å¦‚æœä¸Šé”å¤±è´¥ï¼Œè¿›å…¥acquire()æ–¹æ³•ï¼Œä¼šå†å°è¯•ä¸Šé”å‡ æ¬¡ï¼Œéƒ½å¤±è´¥åè¿›å…¥ç­‰å¾…é˜Ÿåˆ—(åŒå‘é“¾è¡¨)ï¼Œçº¿ç¨‹è®¾ç½®ä¸ºç­‰å¾…çŠ¶æ€</p></blockquote></li></ol><p><img src="/img/bingfa_img/%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81%E5%8E%9F%E7%90%863.png"></p><ol start="4"><li>é‡Šæ”¾é”ï¼Œè°ƒç”¨äº†unlock()æ–¹æ³•ï¼Œå°†å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸Šæœ€è¿‘çš„çº¿ç¨‹ï¼Œå’Œæ²¡æœ‰åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ç«äº‰é”(éå…¬å¹³)</li></ol><p><strong>å¯é‡å…¥åŸç†</strong></p><p>å¦‚æœç¬¬ä¸€æ¬¡ä¸Šé”ï¼Œåˆ™æŠŠè®¡æ•°ç”¨çš„cç½®ä¸º1ï¼Œä»¥åæ‹¥æœ‰é”çš„çº¿ç¨‹æ¯æ¬¡æ¥ä¸Šé”céƒ½ä¼šåŠ 1</p><p>é‡Šæ”¾é”æ—¶ï¼Œcå‡1ï¼Œå¦‚æœæ­¤æ—¶cä¸ç­‰äº0ï¼Œåˆ™ä¸ä¼šé‡Šæ”¾é”ï¼Œç›´åˆ°ç­‰äº0æ—¶æ‰ä¼šæ‰§è¡Œé‡Šæ”¾é”çš„æ“ä½œ</p><p><strong>æ‰“æ–­åŸç†</strong></p><ul><li>ä¸å¯æ‰“æ–­ï¼šçº¿ç¨‹åœ¨ç­‰å¾…çš„æ—¶å€™è¢«æ‰“æ–­äº†ï¼Œä¼šå°†æ‰“æ–­æ ‡è®°ç½®ä¸ºtrueï¼Œç„¶åç»§ç»­å»ç­‰å¾…é”ï¼Œè€Œä¸æ˜¯ç«‹åˆ»è¢«æ‰“æ–­ã€‚åªæœ‰å½“è·å–åˆ°é”åï¼Œæ‰ä¼šåˆ¤æ–­æ˜¯å¦æœ‰è¢«æ‰“æ–­ï¼Œå¦‚æœæœ‰åˆ™ä¼šæ‰§è¡Œæ‰“æ–­æ“ä½œ</li><li>å¯æ‰“æ–­ï¼šå’Œä¸å¯æ‰“æ–­ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼Œå¦‚æœåœ¨ç­‰å¾…çš„æ—¶å€™è¢«æ‰“æ–­äº†ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸ç»§ç»­åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…</li></ul><p><strong>å…¬å¹³é”åŸç†</strong></p><p>ä¸å…¬å¹³é”æ˜¯åˆ¤æ–­é”æ²¡æœ‰æ‹¥æœ‰è€…æ—¶ç›´æ¥å»ç”³è¯·é”ï¼Œå…¬å¹³é”æ˜¯å…ˆåˆ¤æ–­åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œæœ‰æ²¡æœ‰å‰é©±ï¼Œå¦‚æœæ²¡æœ‰å‰é©±ï¼Œä»£è¡¨æ²¡æœ‰æ¯”å½“å‰çº¿ç¨‹æ›´æ—©ç”³è¯·é”çš„çº¿ç¨‹ï¼Œè¿™æ—¶æ‰å»ç”³è¯·é”ã€‚</p><p><strong>æ¡ä»¶å˜é‡åŸç†</strong></p><p>æ¯ä¸ªæ¡ä»¶å˜é‡å…¶å®å°±å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®ç°ç±»æ˜¯ ConditionObject</p><ul><li>è¿›å…¥æ¡ä»¶é˜»å¡é˜Ÿåˆ—ï¼šè°ƒç”¨await()å°†ä¼šæŠŠå½“å‰çº¿ç¨‹åŠ å…¥åˆ°æ¡ä»¶å˜é‡çš„é˜»å¡é˜Ÿåˆ—ï¼Œç„¶åfullyRelease()é‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”ï¼Œè°ƒç”¨park()æŠŠè‡ªå·±é˜»å¡ä½</li><li>å”¤é†’ï¼šè°ƒç”¨signal()è·å–é˜»å¡é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹å¹¶å°è¯•å”¤é†’ï¼Œå¦‚æœæˆåŠŸåˆ™æŠŠå®ƒåŠ å…¥åˆ°ç­‰å¾…é”çš„é˜Ÿåˆ—å°¾ï¼Œå¦‚æœå¤±è´¥(å¦‚ç­‰å¾…è¶…æ—¶ï¼Œè¢«æ‰“æ–­è€Œä¸ç»§ç»­ç­‰é”)åˆ™è·å–æ¡ä»¶é˜»å¡é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹</li></ul><h4 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h4><h5 id="ReentrantReadWriteLock"><a href="#ReentrantReadWriteLock" class="headerlink" title="ReentrantReadWriteLock"></a>ReentrantReadWriteLock</h5><ul><li>è¯»-è¯»æ˜¯å¹¶å‘</li><li>è¯»-å†™ã€å†™-å†™æ˜¯äº’æ–¥çš„</li></ul><p><strong>æ¡ˆä¾‹</strong></p><p>å®šä¹‰ä¸€ä¸ªå­˜æ”¾æ•°æ®çš„å®¹å™¨ï¼Œæœ‰è¯»å†™åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.DataContainer&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataContainer</span> &#123;<br>    <span class="hljs-keyword">private</span> Object data;<br><br>    <span class="hljs-comment">// è¯»å†™é”</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();<br><br>    <span class="hljs-keyword">private</span> ReentrantReadWriteLock.<span class="hljs-type">ReadLock</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> rw.readLock();<br><br>    <span class="hljs-keyword">private</span> ReentrantReadWriteLock.<span class="hljs-type">WriteLock</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> rw.writeLock();<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">read</span><span class="hljs-params">()</span> &#123;<br>        log.debug(<span class="hljs-string">&quot;è·å–è¯»é”&quot;</span>);<br>        r.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;è¯»æ“ä½œ&quot;</span>);<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            <span class="hljs-keyword">return</span> data;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;é‡Šæ”¾è¯»é”&quot;</span>);<br>            r.unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">()</span> &#123;<br>        log.debug(<span class="hljs-string">&quot;è·å–å†™é”&quot;</span>);<br>        w.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;å†™æ“ä½œ&quot;</span>);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;é‡Šæ”¾å†™é”&quot;</span>);<br>            w.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•è¯»-å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">DataContainer</span> <span class="hljs-variable">dataContainer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataContainer</span>();<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read();<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>    Thread.sleep(<span class="hljs-number">100</span>);<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.write();<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯äº’æ–¥çš„</span><br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">29</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - è·å–è¯»é”<br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">29</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - è¯»æ“ä½œ<br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">29</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - è·å–å†™é”<br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">30</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - é‡Šæ”¾è¯»é”<br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">30</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - å†™æ“ä½œ<br><span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">30</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - é‡Šæ”¾å†™é”<br></code></pre></td></tr></table></figure><p>æµ‹è¯•è¯»-è¯»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">DataContainer</span> <span class="hljs-variable">dataContainer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataContainer</span>();<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read();<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read();<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å¹¶å‘çš„</span><br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">15</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - è·å–è¯»é”<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">15</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - è·å–è¯»é”<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">15</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - è¯»æ“ä½œ<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">15</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - è¯»æ“ä½œ<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">16</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainer</span> - é‡Šæ”¾è¯»é”<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">16</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainer</span> - é‡Šæ”¾è¯»é”<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ul><li>è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡</li><li>æœ‰å†™é”çš„æ—¶å€™å¯ä»¥ç›´æ¥è·å–è¯»é”ï¼›è€Œæœ‰è¯»é”çš„æ—¶å€™ä¸èƒ½ç›´æ¥è·å–å†™é”ï¼Œéœ€è¦å…ˆé‡Šæ”¾è¯»é”</li></ul><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p> <strong>è¯»å†™é”ç”¨çš„æ˜¯åŒä¸€ä¸ª Sycn åŒæ­¥å™¨</strong>ï¼Œå› æ­¤ç­‰å¾…é˜Ÿåˆ—ã€state ç­‰ä¹Ÿæ˜¯åŒä¸€ä¸ª</p><p> å†™é”çŠ¶æ€å äº† state çš„ä½ 16 ä½ï¼Œè€Œè¯»é” ä½¿ç”¨çš„æ˜¯ state çš„é«˜ 16 ä½</p><p><strong>ä¸Šå†™é”</strong></p><p>çº¿ç¨‹è°ƒç”¨writeLock().lock()æ–¹æ³•ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€ï¼š</p><ul><li><p>å¦‚æœæ²¡æœ‰è¢«ä¸Šé”ï¼ˆè¯»&#x2F;å†™ï¼‰ï¼Œåˆ™å¯ä»¥ä¸Šé”ï¼›</p></li><li><p>å¦‚æœé”çš„çŠ¶æ€ä¸ºè¢«ä¸Šé”ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±ä¸Šçš„é”ï¼š</p><ul><li><p>å¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºé”é‡å…¥ï¼ŒçŠ¶æ€ä½åŠ 1ï¼›</p></li><li><p>å¦‚æœä¸æ˜¯ï¼Œåˆ™åŠ é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆèŠ‚ç‚¹çŠ¶æ€ä¸ºç‹¬å ï¼Œè¡¨ç¤ºè¦åŠ çš„æ˜¯å†™é”ï¼‰</p></li></ul></li></ul><p><strong>ä¸Šè¯»é”</strong></p><p>çº¿ç¨‹è°ƒç”¨readLock().lock()æ–¹æ³•ï¼Œé¦–å…ˆåˆ¤æ–­é”çš„çŠ¶æ€ï¼š</p><ul><li><p>å¦‚æœæ²¡æœ‰è¢«ä¸Šé”ï¼ˆå†™ï¼‰ï¼Œåˆ™å¯ä»¥ä¸Šé”ï¼›</p></li><li><p>å¦‚æœé”çš„çŠ¶æ€ä¸ºè¢«ä¸Šé”ï¼Œåˆ™åˆ¤æ–­ï¼š</p><ul><li>å¦‚æœè¢«ä¸Šçš„æ˜¯å†™é”ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±ä¸Šçš„å†™é”<ul><li>å¦‚æœä¸æ˜¯ï¼Œåˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆèŠ‚ç‚¹çŠ¶æ€ä¸ºå…±äº«ï¼Œä»£è¡¨è¦åŠ çš„æ˜¯è¯»é”ï¼‰</li><li>å¦‚æœæ˜¯ï¼Œåˆ™é”é™çº§</li></ul></li><li>å¦‚æœè¢«ä¸Šçš„æ˜¯è¯»é”ï¼Œåˆ™ä¸Šé”çš„ä¸ªæ•°åŠ 1</li></ul></li></ul><p><strong>è§£å†™é”</strong></p><p>çŠ¶æ€ä½å‡1ï¼Œåˆ¤æ–­çŠ¶æ€ä½æ˜¯å¦ä¸º0ï¼Œæ˜¯0çš„è¯å°±è§£é”ï¼Œå°†é”çš„æ‹¥æœ‰è€…ç½®ä¸ºnullï¼Œå¹¶é€šçŸ¥ç­‰å¾…é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p><ul><li>å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¸ºå…±äº«ï¼Œåˆ™é€šçŸ¥åé¢ä¸€ä¸²çš„å…±äº«èŠ‚ç‚¹</li><li>å¦‚æœä¸‹ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¸ºç‹¬å ï¼Œåˆ™ä¸ç»§ç»­é€šçŸ¥</li></ul><p><strong>è§£è¯»é”</strong></p><p>ä¸Šé”æ•°å‡1ï¼Œåˆ¤æ–­ä¸Šé”æ•°æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è§£è¯»é”ï¼Œé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p><h4 id="StampedLock"><a href="#StampedLock" class="headerlink" title="StampedLock"></a>StampedLock</h4><p>ä¹è§‚çš„è¯»å†™é”ï¼ŒåŸºäºâ€æˆ³â€æ¥åˆ¤æ–­æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œå¦‚æœè¢«ä¿®æ”¹è¿‡ï¼Œåˆ™å‡çº§æˆè¯»é”</p><p>é€‚ç”¨äºè¯»å¤šï¼Œå†™å°‘çš„åœºæ™¯</p><h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>åˆ›å»ºä¸€ä¸ªä½¿ç”¨ä¹è§‚é”çš„æ•°æ®å®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j(topic = &quot;c.DataContainerStamped&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataContainerStamped</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> data;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">StampedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StampedLock</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataContainerStamped</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">read</span><span class="hljs-params">(<span class="hljs-type">int</span> readTime)</span> &#123;<br>        <span class="hljs-comment">// è·å–æˆ³ï¼Œå°è¯•åŠ ä¹è§‚é”</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.tryOptimisticRead();<br>        log.debug(<span class="hljs-string">&quot;optimistic read locking...&#123;&#125;&quot;</span>, stamp);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(readTime);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-comment">// æ ¡éªŒæˆ³é€šè¿‡</span><br>        <span class="hljs-keyword">if</span> (lock.validate(stamp)) &#123;<br>            log.debug(<span class="hljs-string">&quot;read finish...&#123;&#125;&quot;</span>, stamp);<br>            <span class="hljs-keyword">return</span> data;<br>        &#125;<br><br>        <span class="hljs-comment">// æ ¡éªŒæˆ³æœªé€šè¿‡, å‡çº§ä¸ºè¯»é”</span><br>        log.debug(<span class="hljs-string">&quot;updating to read lock...&#123;&#125;&quot;</span>, stamp);<br>        <span class="hljs-keyword">try</span> &#123;<br>            stamp = lock.readLock();<br>            log.debug(<span class="hljs-string">&quot;read lock &#123;&#125;&quot;</span>, stamp);<br>            Thread.sleep(readTime);<br>            log.debug(<span class="hljs-string">&quot;read finish...&#123;&#125;&quot;</span>, stamp);<br>            <span class="hljs-keyword">return</span> data;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;read unlock &#123;&#125;&quot;</span>, stamp);<br>            lock.unlock(stamp);<br>        &#125;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-type">int</span> newData)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">stamp</span> <span class="hljs-operator">=</span> lock.writeLock();<br>        log.debug(<span class="hljs-string">&quot;write lock &#123;&#125;&quot;</span>, stamp);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>            <span class="hljs-built_in">this</span>.data = newData;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            log.debug(<span class="hljs-string">&quot;write unlock &#123;&#125;&quot;</span>, stamp);<br>            lock.unlock(stamp);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šè¯»-è¯»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">DataContainerStamped</span> <span class="hljs-variable">dataContainer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataContainerStamped</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read(<span class="hljs-number">1000</span>);<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>    Thread.sleep(<span class="hljs-number">500</span>);<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read(<span class="hljs-number">0</span>);<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹å‡ºè¯»è¯»ä¸äº’æ–¥</span><br><span class="hljs-number">10</span>:<span class="hljs-number">15</span>:<span class="hljs-number">20</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - optimistic read locking...<span class="hljs-number">256</span><br><span class="hljs-number">10</span>:<span class="hljs-number">15</span>:<span class="hljs-number">21</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - optimistic read locking...<span class="hljs-number">256</span><br><span class="hljs-number">10</span>:<span class="hljs-number">15</span>:<span class="hljs-number">21</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - read finish...<span class="hljs-number">256</span><br><span class="hljs-number">10</span>:<span class="hljs-number">15</span>:<span class="hljs-number">21</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - read finish...<span class="hljs-number">256</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šè¯»-å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">DataContainerStamped</span> <span class="hljs-variable">dataContainer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataContainerStamped</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.read(<span class="hljs-number">1000</span>);<br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>).start();<br><br>    Thread.sleep(<span class="hljs-number">500</span>);<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        dataContainer.write(<span class="hljs-number">2</span>);<br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>).start();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å° å¯ä»¥çœ‹å‡ºéªŒè¯æˆ³å¤±è´¥ï¼Œè¢«å‡çº§æˆè¯»é”</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">54</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - optimistic read locking...<span class="hljs-number">256</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">55</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - write lock <span class="hljs-number">384</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">55</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - updating to read lock...<span class="hljs-number">256</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">57</span> <span class="hljs-selector-attr">[t2]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - write unlock <span class="hljs-number">384</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">57</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - read lock <span class="hljs-number">513</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">58</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - read finish...<span class="hljs-number">513</span><br><span class="hljs-number">10</span>:<span class="hljs-number">18</span>:<span class="hljs-number">58</span> <span class="hljs-selector-attr">[t1]</span> c<span class="hljs-selector-class">.DataContainerStamped</span> - read unlock <span class="hljs-number">513</span><br></code></pre></td></tr></table></figure><h5 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h5><ul><li>StampedLock ä¸æ”¯æŒæ¡ä»¶å˜é‡ </li><li>StampedLock ä¸æ”¯æŒå¯é‡å…¥</li></ul><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹æ•°é‡ï¼ˆä¸æ˜¯é™åˆ¶èµ„æºæ•°é‡ï¼‰</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>acquire()</td><td>è·å–ä¸€ä¸ªä¿¡å·é‡</td></tr></tbody></table><h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>æœ€å¤šåŒæ—¶æœ‰3ä¸ªçº¿ç¨‹åœ¨è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è·å–ä¿¡å·é‡</span><br>                semaphore.acquire();<br>                log.debug(<span class="hljs-string">&quot;running...&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                log.debug(<span class="hljs-string">&quot;end...&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// é‡Šæ”¾ä¿¡å·é‡</span><br>                semaphore.release();<br>            &#125;<br>        &#125;).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h5><p>å¯ä»¥ç”¨åœ¨é™åˆ¶çº¿ç¨‹æ± è¿æ¥æ•°ä¸Š</p><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><strong>åˆå§‹åŒ–</strong></p><p>å°†ä¼ å…¥çš„ä¿¡å·é‡æ•°èµ‹å€¼ç»™åŒæ­¥å™¨ï¼ˆNonfairSyncï¼‰çš„state</p><p><strong>è·å–ä¿¡å·é‡</strong></p><p>è°ƒç”¨acqire()æ–¹æ³•ï¼Œå°†ä¼šç”¨caså°è¯•å°†Stateå‡1ï¼Œå¦‚æœè¿˜æœ‰å‰©ä½™çš„ä¿¡å·é‡åˆ™è·å–æˆåŠŸï¼Œå¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—</p><p><strong>é‡Šæ”¾ä¿¡å·é‡</strong></p><p>è°ƒç”¨release()æ–¹æ³•ï¼Œå°è¯•å°†StateåŠ 1å¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p><h4 id="CountdownLatch"><a href="#CountdownLatch" class="headerlink" title="CountdownLatch"></a>CountdownLatch</h4><p>ç”¨æ¥è¿›è¡Œçº¿ç¨‹åŒæ­¥åä½œï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</p><p>å®Œæˆçš„çº¿ç¨‹å°†è®¡æ•°å€¼å‡1ï¼Œå½“è®¡æ•°å€¼å‡ä¸º0æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹æ‰èƒ½è¿è¡Œ</p><p>CountdownLatchæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œlatchä¸èƒ½å¢åŠ </p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>await()</td><td>ç­‰å¾…latché™ä¸º0</td></tr><tr><td>await(long, timeout, TimeUnit unit)</td><td>æœ‰è¶…æ—¶æ—¶é—´çš„ç­‰å¾…</td></tr><tr><td>getCount()</td><td>è·å–latchçš„å€¼</td></tr><tr><td>countDown()</td><td>latch - 1</td></tr></tbody></table><h5 id="å®ä¾‹1"><a href="#å®ä¾‹1" class="headerlink" title="å®ä¾‹1"></a>å®ä¾‹1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">3</span>);<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>        latch.countDown();<br>    &#125;).start();<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>        latch.countDown();<br>    &#125;).start();<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        log.debug(<span class="hljs-string">&quot;begin&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        log.debug(<span class="hljs-string">&quot;end&quot;</span>);<br>        latch.countDown();<br>    &#125;).start();<br><br>    latch.await();<br>    log.debug(<span class="hljs-string">&quot;main begin&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs llvm">// æ§åˆ¶å°<br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">51</span> [Thread<span class="hljs-number">-0</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">begin</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">51</span> [Thread<span class="hljs-number">-2</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">begin</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">51</span> [Thread<span class="hljs-number">-1</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">begin</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">52</span> [Thread<span class="hljs-number">-0</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">end</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">52</span> [Thread<span class="hljs-number">-2</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">end</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">52</span> [Thread<span class="hljs-number">-1</span>] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - <span class="hljs-keyword">end</span><br><span class="hljs-number">16</span>:<span class="hljs-number">20</span>:<span class="hljs-number">52</span> [main] <span class="hljs-keyword">c</span>.Test<span class="hljs-number">28</span> - main <span class="hljs-keyword">begin</span><br></code></pre></td></tr></table></figure><p>ä¸joinç›¸æ¯”ï¼ŒCountdownLatchå¯ä»¥é…åˆçº¿ç¨‹æ± ä½¿ç”¨</p><h5 id="å®ä¾‹2"><a href="#å®ä¾‹2" class="headerlink" title="å®ä¾‹2"></a>å®ä¾‹2</h5><p>æ¨¡æ‹ŸåŠ è½½è¿›åº¦æ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">10</span>);<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br>    <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br><br>    <span class="hljs-comment">// å­˜æ”¾åŠ è½½è¿›åº¦</span><br>    String[] all = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">10</span>];<br>    <span class="hljs-comment">// æ¨¡æ‹ŸåŠ è½½è¿›åº¦æ¡</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> i;<br>        pool.submit(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">100</span>; j++) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(random.nextInt(<span class="hljs-number">100</span>));<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                all[k] = j + <span class="hljs-string">&quot;%&quot;</span>;<br>                <span class="hljs-comment">// \rè¡¨ç¤ºå›è½¦ï¼Œä»å½“å‰è¡Œå¼€å§‹è¾“å…¥ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„å†…å®¹</span><br>                System.out.print(<span class="hljs-string">&quot;\r&quot;</span> + Arrays.toString(all));<br>            &#125;<br>            latch.countDown();<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        latch.await();<br>        System.out.println(<span class="hljs-string">&quot;\nåŠ è½½å®Œæˆ&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>    pool.shutdown();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-comment">// æ§åˆ¶å°</span><br>[<span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>, <span class="hljs-number">100</span><span class="hljs-meta">%</span>]<br>åŠ è½½å®Œæˆ<br></code></pre></td></tr></table></figure><h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><p>å¾ªç¯æ …æ ï¼Œä¸CountdownLatchç›¸ä¼¼ï¼Œä¸åŒåœ¨äºCountdownLatchå‡å®Œå°±æ²¡äº†ï¼Œè€ŒcyclicBarrierå¯ä»¥é‡ç”¨</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>await()</td><td>å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œcount - 1ï¼Œåªæœ‰countä¸º0æ—¶æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹æ‰ç»§ç»­è¿è¡Œ</td></tr></tbody></table><h5 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>å½“awaitçš„çº¿ç¨‹æ•°åˆ°è¾¾2æ—¶ï¼Œæ‰ä¼šç»§ç»­è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br>    <span class="hljs-type">CyclicBarrier</span> <span class="hljs-variable">barrier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CyclicBarrier</span>(<span class="hljs-number">2</span>, () -&gt; &#123;<br>        <span class="hljs-comment">// æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œåæ‰“å°</span><br>        log.debug(<span class="hljs-string">&quot;task1 task2 finish&quot;</span>);<br>    &#125;);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br>        pool.submit(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;task1 begin...&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">1000</span>);<br>                barrier.await();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;);<br><br>        pool.submit(() -&gt; &#123;<br>            log.debug(<span class="hljs-string">&quot;task1 begin...&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Thread.sleep(<span class="hljs-number">2000</span>);<br>                barrier.await();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    pool.shutdown();<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// æ§åˆ¶å°</span><br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">14</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">14</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">16</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test29</span> - task1 task2 finish<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">16</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">16</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.Test29</span> - task1 task2 finish<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span> <span class="hljs-selector-attr">[pool-1-thread-1]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">18</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test29</span> - task1 begin...<br><span class="hljs-number">15</span>:<span class="hljs-number">26</span>:<span class="hljs-number">20</span> <span class="hljs-selector-attr">[pool-1-thread-2]</span> c<span class="hljs-selector-class">.Test29</span> - task1 task2 finish<br></code></pre></td></tr></table></figure><h4 id="çº¿ç¨‹å®‰å…¨é›†åˆç±»"><a href="#çº¿ç¨‹å®‰å…¨é›†åˆç±»" class="headerlink" title="çº¿ç¨‹å®‰å…¨é›†åˆç±»"></a>çº¿ç¨‹å®‰å…¨é›†åˆç±»</h4><h5 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h5><p>ä¿è¯äº†æ¯ä¸ªæ–¹æ³•çš„åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ALPHA</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcedfghijklmnopqrstuvwxyz&quot;</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    demo(<br>        () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;String, LongAdder&gt;(),<br>        (map, words) -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (String word : words) &#123;<br>                <span class="hljs-comment">// å¦‚æœmapä¸­æ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªvalue, ç„¶åæŠŠkey valueæ”¾å…¥mapä¸­</span><br>                <span class="hljs-comment">// ä¿è¯äº†è¿™äº›æ“ä½œçš„åŸå­æ€§</span><br>                <span class="hljs-type">LongAdder</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.computeIfAbsent(word, (key) -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongAdder</span>());<br>                <span class="hljs-comment">// ç´¯åŠ </span><br>                value.increment();<br>            &#125;<br>        &#125;<br>    );<br><br>&#125;<br><br><span class="hljs-comment">// ç”Ÿæˆæ–‡ä»¶</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> ALPHA.length();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;<br>    <span class="hljs-comment">// å°†å¨å“¥å­—æ¯éƒ½åŠ 200ä¸ªåˆ°é›†åˆlistä¸­</span><br>    List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(length * count);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>        <span class="hljs-type">char</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> ALPHA.charAt(i);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; count; j++) &#123;<br>            list.add(String.valueOf(ch));<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// æ‰“ä¹±æ•°ç»„list</span><br>    Collections.shuffle(list);<br><br>    <span class="hljs-comment">// æ¯200ä¸ªå­—æ¯æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªå­—æ¯å ä¸€è¡Œ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">26</span>; i++) &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintWriter</span>(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;tmp/&quot;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;.txt&quot;</span>)))) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">collect</span> <span class="hljs-operator">=</span> list.subList(i * count, (i + <span class="hljs-number">1</span>) * count).stream()<br>                .collect(Collectors.joining(<span class="hljs-string">&quot;\n&quot;</span>));<br>            out.print(collect);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä»æ–‡ä»¶ä¸­è·å–å­—æ¯ï¼Œç»Ÿè®¡å­—æ¯å‡ºç°æ¬¡æ•°</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;V&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">demo</span><span class="hljs-params">(Supplier&lt;Map&lt;String, V&gt;&gt; supplier,</span><br><span class="hljs-params">                             BiConsumer&lt;Map&lt;String, V&gt;, List&lt;String&gt;&gt; consumer)</span> &#123;<br>    Map&lt;String, V&gt; counterMap = supplier.get();<br>    List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">26</span>; i++) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> i;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-comment">// è¯»å–æ–‡ä»¶ï¼Œæ‰§è¡Œè®¡æ•°</span><br>            List&lt;String&gt; words = readFromFile(idx);<br>            consumer.accept(counterMap, words);<br>        &#125;);<br>        ts.add(thread);<br>    &#125;<br>    ts.forEach(t -&gt; t.start());<br>    ts.forEach(t -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            t.join();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;);<br>    System.out.println(counterMap);<br>&#125;<br><br><span class="hljs-comment">// è¯»å–æ–‡ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">readFromFile</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    ArrayList&lt;String&gt; words = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;tmp/&quot;</span><br>                                                                                          + i + <span class="hljs-string">&quot;.txt&quot;</span>)))) &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> in.readLine();<br>            <span class="hljs-keyword">if</span> (word == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            words.add(word);<br>        &#125;<br>        <span class="hljs-keyword">return</span> words;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nix">// æ§åˆ¶å°<br>&#123;<span class="hljs-attr">a=200,</span> <span class="hljs-attr">b=200,</span> <span class="hljs-attr">c=200,</span> <span class="hljs-attr">d=200,</span> <span class="hljs-attr">e=200,</span> <span class="hljs-attr">f=200,</span> <span class="hljs-attr">g=200,</span> <span class="hljs-attr">h=200,</span> <span class="hljs-attr">i=200,</span> <span class="hljs-attr">j=200,</span> <span class="hljs-attr">k=200,</span> <span class="hljs-attr">l=200,</span> <span class="hljs-attr">m=200,</span> <span class="hljs-attr">n=200,</span> <span class="hljs-attr">o=200,</span> <span class="hljs-attr">p=200,</span> <span class="hljs-attr">q=200,</span> <span class="hljs-attr">r=200,</span> <span class="hljs-attr">s=200,</span> <span class="hljs-attr">t=200,</span> <span class="hljs-attr">u=200,</span> <span class="hljs-attr">v=200,</span> <span class="hljs-attr">w=200,</span> <span class="hljs-attr">x=200,</span> <span class="hljs-attr">y=200,</span> <span class="hljs-attr">z=200&#125;</span><br></code></pre></td></tr></table></figure><h6 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h6><p><strong>æ­»é“¾</strong></p><p>å“ˆå¸Œè¡¨ä¸­çš„é“¾è¡¨å‡ºç°äº†æ­»å¾ªç¯ï¼Œå‡ºç°åœ¨<strong>jdk7</strong></p><p>å½“å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ•°é‡è¾¾åˆ°å®¹é‡çš„3&#x2F;4æ—¶ï¼Œä¼šæ‰©å®¹å“ˆå¸Œè¡¨</p><p>jdk7æ˜¯é‡‡ç”¨å¤´æ’æ³•å»ºç«‹é“¾è¡¨ï¼Œå¤šçº¿ç¨‹æ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰©å®¹å®Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå»æ‰©å®¹</p><p>ä¼šå¯¼è‡´é“¾è¡¨ä¸­äº§ç”Ÿå¾ªç¯é“¾è¡¨ï¼Œä»è€Œç›´æ¥å¡æ­»</p><blockquote><p>JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸æ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½ å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºç°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰</p></blockquote><p><strong>æ„é€ å‡½æ•°</strong></p><p>å‚æ•°ï¼šåˆå§‹å®¹é‡ã€è´Ÿè½½å› å­ã€å¹¶å‘åº¦</p><blockquote><ul><li>åˆå§‹å®¹é‡è¦ &gt;&#x3D; å¹¶å‘åº¦ï¼Œå¦‚æœåˆå§‹å®¹é‡è®¾ç½®çš„å°äºå¹¶å‘åº¦ï¼Œåˆ™ä¼šè¢«æ”¹æˆ&#x3D;å¹¶å‘åº¦</li><li>å®¹é‡å¾—æ˜¯2^nï¼Œå› æ­¤ä¼ è¿‡æ¥çš„å®¹é‡ä¸ä¸€å®šå°±æ˜¯mapçš„å®é™…å®¹é‡</li><li>å®ç°äº†<strong>æ‡’æƒ°åˆå§‹åŒ–</strong>(jdk8)ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­<strong>ä»…ä»…è®¡ç®—äº† table çš„å¤§å°</strong>ï¼Œä»¥ååœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šçœŸæ­£åˆ›å»º</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity,</span><br><span class="hljs-params">                         <span class="hljs-type">float</span> loadFactor, <span class="hljs-type">int</span> concurrencyLevel)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!(loadFactor &gt; <span class="hljs-number">0.0f</span>) || initialCapacity &lt; <span class="hljs-number">0</span> || concurrencyLevel &lt;= <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();<br>    <span class="hljs-keyword">if</span> (initialCapacity &lt; concurrencyLevel)   <span class="hljs-comment">// Use at least as many bins</span><br>        initialCapacity = concurrencyLevel;   <span class="hljs-comment">// as estimated threads</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>)(<span class="hljs-number">1.0</span> + (<span class="hljs-type">long</span>)initialCapacity / loadFactor);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> (size &gt;= (<span class="hljs-type">long</span>)MAXIMUM_CAPACITY) ?<br>        MAXIMUM_CAPACITY : tableSizeFor((<span class="hljs-type">int</span>)size);<br>    <span class="hljs-built_in">this</span>.sizeCtl = cap;<span class="hljs-comment">// åªè®¡ç®—äº†å®¹é‡ï¼Œè¿˜æ²¡æœ‰åˆå§‹åŒ–map</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>getå‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(Object key)</span> &#123;<br>    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="hljs-type">int</span> n, eh; K ek;<br>    <span class="hljs-comment">// spread æ–¹æ³•èƒ½ç¡®ä¿è¿”å›ç»“æœæ˜¯æ­£æ•°</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> spread(key.hashCode());<br>    <span class="hljs-keyword">if</span> ((tab = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (e = tabAt(tab, (n - <span class="hljs-number">1</span>) &amp; h)) != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// å¦‚æœå¤´ç»“ç‚¹å·²ç»æ˜¯è¦æŸ¥æ‰¾çš„ key</span><br>        <span class="hljs-keyword">if</span> ((eh = e.hash) == h) &#123;<br>            <span class="hljs-keyword">if</span> ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))<br>                <span class="hljs-keyword">return</span> e.val;<br>        &#125;<br>        <span class="hljs-comment">// hash ä¸ºè´Ÿæ•°è¡¨ç¤ºè¯¥ bin åœ¨æ‰©å®¹ä¸­æˆ–æ˜¯ treebin, è¿™æ—¶è°ƒç”¨ find æ–¹æ³•æ¥æŸ¥æ‰¾</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (eh &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> (p = e.find(h, key)) != <span class="hljs-literal">null</span> ? p.val : <span class="hljs-literal">null</span>;<br>        <span class="hljs-comment">// å¤´ç»“ç‚¹ä¸æ˜¯è¦æ‰¾çš„èŠ‚ç‚¹ï¼Œåˆ™æ­£å¸¸éå†é“¾è¡¨/çº¢é»‘æ ‘, ç”¨ equals æ¯”è¾ƒ</span><br>        <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (e.hash == h &amp;&amp;<br>                ((ek = e.key) == key || (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek))))<br>                <span class="hljs-keyword">return</span> e.val;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>putå‡½æ•°</strong></p><p>keyå¦‚æœå·²å­˜åœ¨ï¼Œé»˜è®¤è¦†ç›–æ—§å€¼</p><p>é€šè¿‡casæ¥åˆ›å»ºèŠ‚ç‚¹ã€æ·»åŠ åˆ°å¤´ç»“ç‚¹ï¼Œä¸ä½¿ç”¨synchronizedæ¥æé«˜æ•ˆç‡</p><p>å¦‚æœå‘ç°å¤´ç»“ç‚¹å€¼ä¸º-1ï¼Œåˆ™è¯´æ˜å“ˆå¸Œè¡¨æ­£åœ¨æ‰©å®¹ï¼Œåˆ™ä¼šå…ˆå»å¸®å¿™æ‰©å®¹</p><p>åœ¨è¦æ’å…¥å€¼çš„æ—¶å€™ï¼Œä¼šé”ä½å½“å‰çš„é“¾è¡¨&#x2F;çº¢é»‘æ ‘</p><p><strong>initTableå‡½æ•°</strong></p><p>çœŸæ­£åˆ›å»ºhashè¡¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;<br>    Node&lt;K,V&gt;[] tab; <span class="hljs-type">int</span> sc;<br>    <span class="hljs-keyword">while</span> ((tab = table) == <span class="hljs-literal">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> ((sc = sizeCtl) &lt; <span class="hljs-number">0</span>)<br>            Thread.yield();<br>        <span class="hljs-comment">// å°è¯•å°† sizeCtl è®¾ç½®ä¸º -1ï¼ˆè¡¨ç¤ºåˆå§‹åŒ– tableï¼‰</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc, -<span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-comment">// è·å¾—é”, åˆ›å»º table, è¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šåœ¨ while() å¾ªç¯ä¸­ yield ç›´è‡³ table åˆ›å»º</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-literal">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> (sc &gt; <span class="hljs-number">0</span>) ? sc : DEFAULT_CAPACITY;<br>                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;?,?&gt;[n];<br>                    table = tab = nt;<br>                    sc = n - (n &gt;&gt;&gt; <span class="hljs-number">2</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                sizeCtl = sc;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> tab;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>sizeè®¡ç®—æµç¨‹</strong></p><p>size è®¡ç®—å®é™…å‘ç”Ÿåœ¨ putï¼Œremove æ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œä¹‹ä¸­ </p><ul><li>æ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå‘ baseCount ç´¯åŠ è®¡æ•°</li><li>æœ‰ç«äº‰å‘ç”Ÿï¼Œæ–°å»º counterCellsï¼Œå‘å…¶ä¸­çš„ä¸€ä¸ª cell ç´¯åŠ è®¡æ•° <ul><li>counterCells åˆå§‹æœ‰ä¸¤ä¸ª </li><li>cell å¦‚æœè®¡æ•°ç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¼šåˆ›å»ºæ–°çš„ cell æ¥ç´¯åŠ è®¡æ•°</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> sumCount();<br>    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> :<br>            (n &gt; (<span class="hljs-type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :<br>            (<span class="hljs-type">int</span>)n);<br>&#125;<br><br><span class="hljs-comment">// åˆå¹¶ç´¯åŠ å•å…ƒåˆ°baseCount</span><br><span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sumCount</span><span class="hljs-params">()</span> &#123;<br>    CounterCell[] as = counterCells; CounterCell a;<br>    <span class="hljs-comment">// å°† baseCount è®¡æ•°ä¸æ‰€æœ‰ cell è®¡æ•°ç´¯åŠ </span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> baseCount;<br>    <span class="hljs-keyword">if</span> (as != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; as.length; ++i) &#123;<br>            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-literal">null</span>)<br>                sum += a.value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>java</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OSS</title>
    <link href="/2022/11/13/%E5%85%B6%E4%BB%96/OSS/"/>
    <url>/2022/11/13/%E5%85%B6%E4%BB%96/OSS/</url>
    
    <content type="html"><![CDATA[<h2 id="OSS"><a href="#OSS" class="headerlink" title="OSS"></a>OSS</h2><blockquote><p>å¯¹è±¡å­˜å‚¨ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰æ˜¯æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„<strong>äº‘å­˜å‚¨æœåŠ¡</strong>ï¼Œå…·æœ‰ä¸å¹³å°æ— å…³RESTful APIï¼Œèƒ½ä»äº’è”ç½‘ä»»ä½•ä½ç½®è®¿é—®ã€‚OSSæä¾›æ ‡å‡†ã€ä½é¢‘ã€å½’æ¡£ç­‰ç±»å‹é€‰æ‹©ï¼Œå…¨é¢ä¼˜åŒ–å­˜å‚¨æˆæœ¬ã€‚</p></blockquote><h3 id="é˜¿é‡Œäº‘OSS"><a href="#é˜¿é‡Œäº‘OSS" class="headerlink" title="é˜¿é‡Œäº‘OSS"></a>é˜¿é‡Œäº‘OSS</h3><p><a href="https://www.aliyun.com/product/oss?spm=5176.21213303.J_6704733920.7.19c253c9R6hA1l&scm=20140722.S_product@@%E4%BA%91%E4%BA%A7%E5%93%81@@102633._.ID_product@@%E4%BA%91%E4%BA%A7%E5%93%81@@102633-RL_%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8OSS-LOC_main-OR_ser-V_2-P0_0">å¯¹è±¡å­˜å‚¨OSS-é˜¿é‡Œäº‘</a></p><p>åˆ›å»ºbucket</p><p>æ ¹æ®å®˜ç½‘æ–‡æ¡£å¯¼å…¥ä¾èµ–ã€ä½¿ç”¨åŠŸèƒ½</p><h3 id="ä¸ƒç‰›äº‘OSS"><a href="#ä¸ƒç‰›äº‘OSS" class="headerlink" title="ä¸ƒç‰›äº‘OSS"></a>ä¸ƒç‰›äº‘OSS</h3><p><a href="https://portal.qiniu.com/home">ä¸ƒç‰›äº‘ - äº§å“ä¸»é¡µ (qiniu.com)</a></p><p><a href="https://developer.qiniu.com/kodo/1239/java#install-by-maven">Java SDK_SDK ä¸‹è½½_å¯¹è±¡å­˜å‚¨ - ä¸ƒç‰›å¼€å‘è€…ä¸­å¿ƒ (qiniu.com)</a></p><p>å¤§è‡´æ­¥éª¤ï¼š</p><ol><li>æ‰¾æ ·ä¾‹ä»£ç </li><li>ä¿®æ”¹<code>accessKey</code>ã€<code>secretKey</code>å’Œ<code>bucket</code>ä¸ºè‡ªå·±çš„</li><li>ä¿®æ”¹è¦ä¸Šä¼ çš„æ–‡ä»¶æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„</li><li>æµ‹è¯•</li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hutool</title>
    <link href="/2022/11/12/%E5%85%B6%E4%BB%96/Hutool/"/>
    <url>/2022/11/12/%E5%85%B6%E4%BB%96/Hutool/</url>
    
    <content type="html"><![CDATA[<h2 id="Hutool"><a href="#Hutool" class="headerlink" title="Hutool"></a>Hutool</h2><blockquote><p>Hutoolæ˜¯ä¸€ä¸ªå°è€Œå…¨çš„Javaå·¥å…·ç±»åº“ï¼Œé€šè¿‡é™æ€æ–¹æ³•å°è£…ï¼Œé™ä½ç›¸å…³APIçš„å­¦ä¹ æˆæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œä½¿Javaæ‹¥æœ‰å‡½æ•°å¼è¯­è¨€èˆ¬çš„ä¼˜é›…</p></blockquote><p><a href="https://www.hutool.cn/docs/#/">å®˜ç½‘</a></p><h4 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡</title>
    <link href="/2022/11/12/%E5%85%B6%E4%BB%96/%E9%80%9A%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1/"/>
    <url>/2022/11/12/%E5%85%B6%E4%BB%96/%E9%80%9A%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="é€šè¿‡é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡"><a href="#é€šè¿‡é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡" class="headerlink" title="é€šè¿‡é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡"></a>é€šè¿‡é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡</h2><blockquote><p>è¿™é‡Œé€šè¿‡æµ‹è¯•APIæ¥å‘é€</p></blockquote><p><a href="https://www.aliyun.com/">é˜¿é‡Œäº‘ç½‘å€</a></p><h3 id="æŸ¥çœ‹å®˜ç½‘"><a href="#æŸ¥çœ‹å®˜ç½‘" class="headerlink" title="æŸ¥çœ‹å®˜ç½‘"></a>æŸ¥çœ‹å®˜ç½‘</h3><ul><li><p>æœç´¢çŸ­ä¿¡æœåŠ¡</p><p><img src="/img/else_img/aliyunMSM1.png"></p></li><li><p>ç»‘å®šæµ‹è¯•æ‰‹æœºå·ï¼Œç‚¹å‡»è°ƒç”¨API</p><p><img src="/img/else_img/aliyunMSM2.png"></p></li><li><p>å¯ä»¥çœ‹åˆ°æœ‰å‘é€çŸ­ä¿¡çš„ç¤ºä¾‹ä»£ç </p><p><img src="/img/else_img/aliyunMSM3.png"></p></li><li><p>åˆ›å»ºç”¨äºå‘é€çŸ­ä¿¡çš„AccessKey</p><p><img src="/img/else_img/aliyunMSM4.png"></p><p><img src="/img/else_img/aliyunMSM5.png"></p></li><li><p>åˆ›å»ºå®Œç”¨æˆ·åç»™å…¶åˆ†é…å‘é€SMSçš„æƒé™</p><p><img src="/img/else_img/aliyunMSM6.png"></p></li><li><p>ç»™ç”¨æˆ·åˆ›å»ºAccessKeyï¼ˆåˆ›å»ºå®Œè®°å¾—ä¿å­˜ï¼‰</p><p><img src="/img/else_img/aliyunMSM7.png"></p></li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><ul><li>æ ¹æ®ç¤ºä¾‹ä»£ç ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œé€šè¿‡å°†AccessKey å’Œå¯†é’¥æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œå†é€šè¿‡@Valueæ³¨è§£æ¥è¯»å–</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># åœ°åŸŸèŠ‚ç‚¹</span><br><span class="hljs-attr">aliyun.sms.regionId</span>=<span class="hljs-string">default</span><br><span class="hljs-comment"># è®¿é—®ID</span><br><span class="hljs-attr">aliyun.sms.accessKeyId</span>=<span class="hljs-string"></span><br><span class="hljs-comment"># è®¿é—®å¯†é’¥</span><br><span class="hljs-attr">aliyun.sms.secret</span>=<span class="hljs-string"></span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-comment">// InitializingBeanæ¥å£ä¸ºbeanæä¾›äº†å±æ€§åˆå§‹åŒ–åçš„å¤„ç†æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantPropertiesUtils</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.sms.regionId&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String regionId;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.sms.accessKeyId&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String accessKeyId;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.sms.secret&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String secret;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String REGION_Id;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String ACCESS_KEY_ID;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String SECRET;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        REGION_Id = regionId;<br>        ACCESS_KEY_ID = accessKeyId;<br>        SECRET = secret;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå‘é€çŸ­ä¿¡çš„service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MsmServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MsmService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String phone, String code)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(phone))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-comment">// åŸºç¡€é…ç½®</span><br>        <span class="hljs-type">DefaultProfile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> DefaultProfile.getProfile(<br>                ConstantPropertiesUtils.REGION_Id,  <span class="hljs-comment">// åœ°åŸŸèŠ‚ç‚¹</span><br>                ConstantPropertiesUtils.ACCESS_KEY_ID,  <span class="hljs-comment">// è®¿é—®ID</span><br>                ConstantPropertiesUtils.SECRET);    <span class="hljs-comment">//è®¿é—®å¯†é’¥</span><br><br>        <span class="hljs-type">IAcsClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAcsClient</span>(profile);<br><br>        <span class="hljs-type">SendSmsRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendSmsRequest</span>();<br>        request.setSignName(<span class="hljs-string">&quot;é˜¿é‡Œäº‘çŸ­ä¿¡æµ‹è¯•&quot;</span>); <span class="hljs-comment">// çŸ­ä¿¡ç­¾å</span><br>        request.setTemplateCode(<span class="hljs-string">&quot;SMS_154950909&quot;</span>);   <span class="hljs-comment">// çŸ­ä¿¡æ¨¡æ¿</span><br>        request.setPhoneNumbers(phone); <span class="hljs-comment">// å‘é€çš„æ‰‹æœºå·</span><br>        request.setTemplateParam(<span class="hljs-string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span> + code + <span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);    <span class="hljs-comment">// å‘é€çš„éªŒè¯ç </span><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å‘é€çŸ­ä¿¡</span><br>            <span class="hljs-type">SendSmsResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.getAcsResponse(request);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;OK&quot;</span>.equals(response.getCode());<br>        &#125; <span class="hljs-keyword">catch</span> (ServerException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (ClientException e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;ErrCode:&quot;</span> + e.getErrCode());<br>            System.out.println(<span class="hljs-string">&quot;ErrMsg:&quot;</span> + e.getErrMsg());<br>            System.out.println(<span class="hljs-string">&quot;RequestId:&quot;</span> + e.getRequestId());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nuxt</title>
    <link href="/2022/11/07/%E5%89%8D%E7%AB%AF/nuxt/nuxt/"/>
    <url>/2022/11/07/%E5%89%8D%E7%AB%AF/nuxt/nuxt/</url>
    
    <content type="html"><![CDATA[<h2 id="Nuxt"><a href="#Nuxt" class="headerlink" title="Nuxt"></a>Nuxt</h2><blockquote><p>æœåŠ¡ç«¯æ¸²æŸ“ï¼šæœåŠ¡ç«¯æ¸²æŸ“åˆç§°SSR (Server Side Render)æ˜¯åœ¨æœåŠ¡ç«¯å®Œæˆé¡µé¢çš„å†…å®¹ï¼Œè€Œä¸æ˜¯åœ¨å®¢æˆ·ç«¯é€šè¿‡AJAXè·å–æ•°æ®ã€‚</p><p>Nuxtï¼šNuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„è½»é‡çº§åº”ç”¨æ¡†æ¶,å¯ç”¨æ¥åˆ›å»ºæœåŠ¡ç«¯æ¸²æŸ“ (SSR) åº”ç”¨,ä¹Ÿå¯å……å½“é™æ€ç«™ç‚¹å¼•æ“ç”Ÿæˆé™æ€ç«™ç‚¹åº”ç”¨,å…·æœ‰ä¼˜é›…çš„ä»£ç ç»“æ„åˆ†å±‚å’Œçƒ­åŠ è½½ç­‰ç‰¹æ€§ã€‚</p></blockquote><p><a href="https://www.nuxtjs.org.cn/">å®˜ç½‘</a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Nuxt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Nuxt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>easyExcel</title>
    <link href="/2022/10/14/%E5%85%B6%E4%BB%96/easyExcel/"/>
    <url>/2022/10/14/%E5%85%B6%E4%BB%96/easyExcel/</url>
    
    <content type="html"><![CDATA[<h2 id="easyExcel"><a href="#easyExcel" class="headerlink" title="easyExcel"></a>easyExcel</h2><blockquote><p>EasyExcelæ˜¯ä¸€ä¸ªåŸºäºJavaçš„ã€å¿«é€Ÿã€ç®€æ´ã€è§£å†³å¤§æ–‡ä»¶å†…å­˜æº¢å‡ºçš„Excelå¤„ç†å·¥å…·ã€‚<br>ä»–èƒ½è®©ä½ åœ¨ä¸ç”¨è€ƒè™‘æ€§èƒ½ã€å†…å­˜çš„ç­‰å› ç´ çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿå®ŒæˆExcelçš„è¯»ã€å†™ç­‰åŠŸèƒ½ã€‚</p></blockquote><p><a href="https://easyexcel.opensource.alibaba.com/docs/current/">å…³äºEasyexcel | Easy Excel (alibaba.com)</a></p><h3 id="å†™å…¥"><a href="#å†™å…¥" class="headerlink" title="å†™å…¥"></a>å†™å…¥</h3><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>easyexcel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨å®ä½“ç±»çš„å±æ€§ä¸Šæ·»åŠ æ³¨è§£ï¼Œè®¾ç½®Excelè¡¨è¡¨å¤´ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserData</span> &#123;<br><br>    <span class="hljs-meta">@ExcelProperty(&quot;ç”¨æˆ·ç¼–å·&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> uid;<br><br>    <span class="hljs-meta">@ExcelProperty(&quot;ç”¨æˆ·åç§°&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å†™å…¥å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">testWrite</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// æ–‡ä»¶è·¯å¾„</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;F:\\excel\\01.xlsx&quot;</span>;<br><br>        <span class="hljs-comment">// è¦å†™å…¥çš„å†…å®¹</span><br>        ArrayList&lt;UserData&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserData</span>(i, <span class="hljs-string">&quot;name&quot;</span> + i));<br>        &#125;<br><br>        <span class="hljs-comment">// å†™å…¥excelè¡¨</span><br>        EasyExcel.write(fileName, UserData.class)<br>                .sheet(<span class="hljs-string">&quot;ç”¨æˆ·ä¿¡æ¯&quot;</span>)  <span class="hljs-comment">// excelè¡¨è¡¨å</span><br>                .doWrite(list);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/else_img/easyExcel1.png"></p></li></ul><h3 id="è¯»å‡º"><a href="#è¯»å‡º" class="headerlink" title="è¯»å‡º"></a>è¯»å‡º</h3><ul><li><p>å®ä½“ç±»ä¸Šè¦æ·»åŠ ç›¸å¯¹åº”çš„åˆ—å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExcelProperty(value = &quot;ç”¨æˆ·ç¼–å·&quot;, index = 0)</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> uid;<br><br><span class="hljs-meta">@ExcelProperty(value = &quot;ç”¨æˆ·åç§°&quot;, index = 1)</span><br><span class="hljs-keyword">private</span> String username;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™ç›‘å¬æ–¹æ³•ï¼Œå½“è¯»å–excelæ—¶ä¼šæ‰§è¡Œæ­¤ç›‘å¬æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExcelListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnalysisEventListener</span>&lt;UserData&gt; &#123;<br><br>    <span class="hljs-comment">// ä¸€è¡Œè¡Œè¯»å–excelå†…å®¹ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹è¯»å–</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(UserData userData, AnalysisContext analysisContext)</span> &#123;<br>        System.out.println(userData);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAfterAllAnalysed</span><span class="hljs-params">(AnalysisContext analysisContext)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// è¯»å–è¡¨å¤´ä¿¡æ¯</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeHeadMap</span><span class="hljs-params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> &#123;<br>        System.out.println(headMap);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è¯»å‡ºå†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestRead</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;F:\\excel\\01.xlsx&quot;</span>;<br><br>        EasyExcel.read(fileName,<br>                UserData.class,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExcelListener</span>()).sheet().doRead();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/else_img/easyExcel2.png"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vue-element-adminç®€å•ä½¿ç”¨</title>
    <link href="/2022/10/13/%E5%89%8D%E7%AB%AF/vue-element-admin/vue-element-admin%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2022/10/13/%E5%89%8D%E7%AB%AF/vue-element-admin/vue-element-admin%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="vue-element-adminç®€å•ä½¿ç”¨"><a href="#vue-element-adminç®€å•ä½¿ç”¨" class="headerlink" title="vue-element-adminç®€å•ä½¿ç”¨"></a>vue-element-adminç®€å•ä½¿ç”¨</h2><blockquote><p><a href="https://link.zhihu.com/?target=https://panjiachen.gitee.io/vue-element-admin-site/zh/">vue-element-admin</a> æ˜¯ä¸€ä¸ªåå°å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œå®ƒåŸºäº <a href="https://link.zhihu.com/?target=https://github.com/vuejs/vue">vue</a> å’Œ <a href="https://link.zhihu.com/?target=https://github.com/ElemeFE/element">element-ui</a>å®ç°ã€‚å®ƒä½¿ç”¨äº†æœ€æ–°çš„å‰ç«¯æŠ€æœ¯æ ˆï¼Œå†…ç½®äº† i18 å›½é™…åŒ–è§£å†³æ–¹æ¡ˆï¼ŒåŠ¨æ€è·¯ç”±ï¼Œæƒé™éªŒè¯ï¼Œæç‚¼äº†å…¸å‹çš„ä¸šåŠ¡æ¨¡å‹ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ç»„ä»¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ­å»ºä¼ä¸šçº§ä¸­åå°äº§å“åŸå‹ã€‚</p></blockquote><h3 id="æ§åˆ¶é¢æ¿æ·»åŠ è·¯ç”±"><a href="#æ§åˆ¶é¢æ¿æ·»åŠ è·¯ç”±" class="headerlink" title="æ§åˆ¶é¢æ¿æ·»åŠ è·¯ç”±"></a>æ§åˆ¶é¢æ¿æ·»åŠ è·¯ç”±</h3><ul><li><p>åœ¨<code>router/index.js</code>æ–‡ä»¶ä¸­æ·»åŠ è·¯ç”±ï¼Œå°±ä¼šæ˜¾ç¤ºåˆ°é¢æ¿ä¸Š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è‡ªå·±æ·»åŠ çš„è·¯ç”±</span><br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/hospSet&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/hospSet/list&#x27;</span>,<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;åŒ»é™¢è®¾ç½®ç®¡ç†&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;example&#x27;</span>&#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/list&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;åŒ»é™¢è®¾ç½®åˆ—è¡¨&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/i18n-demo/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;åŒ»é™¢è®¾ç½®åˆ—è¡¨&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;table&#x27;</span> &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/add&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;åŒ»é™¢è®¾ç½®åˆ—è¡¨æ·»åŠ &#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/i18n-demo/index&#x27;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;åŒ»é™¢è®¾ç½®åˆ—è¡¨æ·»åŠ &#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;tree&#x27;</span> &#125;<br>      &#125;<br>    ]<br>  &#125;,<br></code></pre></td></tr></table></figure></li><li><p>å°†ç»„ä»¶æ–‡ä»¶åœ°å€æ¢æˆè‡ªå·±çš„</p></li><li><p>é…ç½®ä¸ªè‡ªå·±çš„axiosæ¥å‘é€è¯·æ±‚</p></li><li><p>åœ¨<code>api</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå‘é€è¯·æ±‚çš„js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/utils/myAxios&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getHospSetList</span>(<span class="hljs-params">current, limit, searchObj</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">axios</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">`/admin/hosp/hospitalSet/findPage/<span class="hljs-subst">$&#123;current&#125;</span>/<span class="hljs-subst">$&#123;limit&#125;</span>`</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,<br>    <span class="hljs-attr">data</span>: searchObj<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>vue-element-admin</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…vue-element-admin</title>
    <link href="/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E5%AE%89%E8%A3%85vue-element-admin/"/>
    <url>/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E5%AE%89%E8%A3%85vue-element-admin/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…vue-element-admin"><a href="#å®‰è£…vue-element-admin" class="headerlink" title="å®‰è£…vue-element-admin"></a>å®‰è£…vue-element-admin</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>tee.com<span class="hljs-regexp">/panjiachen/</span>vue-element-admin.git client-action<br><br>cd client-action<br><br>git branch -a<br><br>git checkout -b i18n remotes<span class="hljs-regexp">/origin/i</span>18n<br><br>git config --global url.<span class="hljs-string">&quot;https://&quot;</span>.insteadOf git:<span class="hljs-regexp">//</span><br><br>npm install<br><br>npm run dev<br></code></pre></td></tr></table></figure><ul><li>éœ€è¦åˆ‡æ¢åˆ†æ”¯åˆ° i18nï¼Œå¦åˆ™ä¸æ”¯æŒå›½é™…åŒ–ï¼ˆä¸­æ–‡ï¼‰åŠŸèƒ½</li><li>npm install è¦å¤šè¯•å‡ æ¬¡ï¼Œå› ä¸ºä¸­é—´ä¼šè¿æ¥ gitbub ä¸‹è½½ä¸€äº›ä¾èµ–ï¼Œç½‘ç»œä¸ç¨³å®šä¼šå¯¼è‡´å¤±è´¥</li><li>npm run dev è¿è¡Œåå›è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œä½¿ç”¨çš„ç«¯å£æ˜¯ 9527</li><li>å®‰è£…å¤±è´¥å¯ä»¥è¯•è¯•<a href="https://blog.csdn.net/qq_43271844/article/details/125865607">npm install å®‰è£…tui-editoræŠ¥é”™è§£å†³_Thoroldâ€™s Deerçš„åšå®¢-CSDNåšå®¢_tui-editor vue</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>æ­å»ºç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WebPackæ‰“åŒ…å·¥å…·</title>
    <link href="/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/WebPack%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7/"/>
    <url>/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/WebPack%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<h2 id="WebPackæ‰“åŒ…å·¥å…·"><a href="#WebPackæ‰“åŒ…å·¥å…·" class="headerlink" title="WebPackæ‰“åŒ…å·¥å…·"></a>WebPackæ‰“åŒ…å·¥å…·</h2><blockquote><p>Webpack æ˜¯ä¸€ä¸ªå‰ç«¯èµ„æºåŠ è½½&#x2F;æ‰“åŒ…å·¥å…·ã€‚å®ƒå°†æ ¹æ®æ¨¡å—çš„ä¾èµ–å…³ç³»è¿›è¡Œé™æ€åˆ†æï¼Œç„¶åå°†è¿™äº›æ¨¡å—æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™ç”Ÿæˆå¯¹åº”çš„é™æ€èµ„æºã€‚</p><p>Webpack å¯ä»¥å°†å¤šç§é™æ€èµ„æº jsã€cssã€less è½¬æ¢æˆä¸€ä¸ªé™æ€æ–‡ä»¶ï¼Œå‡å°‘äº†é¡µé¢çš„è¯·æ±‚ã€‚ </p></blockquote><ul><li><p>å…¨å±€å®‰è£…</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g webpack webpack-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé…ç½®æ–‡ä»¶<code>webpack.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span> <span class="hljs-comment">//Node.jså†…ç½®æ¨¡å—</span><br><span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">resolve</span>()<br><br><span class="hljs-comment">// æ‰“åŒ…çš„æ˜¯js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./src/main.js&#x27;</span>, <span class="hljs-comment">//é…ç½®å…¥å£æ–‡ä»¶</span><br>    <span class="hljs-attr">output</span>: &#123;<br>        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./dist&#x27;</span>), <span class="hljs-comment">//è¾“å‡ºè·¯å¾„ï¼Œ__dirnameï¼šå½“å‰æ–‡ä»¶æ‰€åœ¨è·¯å¾„</span><br>        <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span><span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶</span><br>    &#125;   <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºdistæ–‡ä»¶å¤¹ï¼Œç”¨äºæ”¾ç½®æ‰“åŒ…åçš„æ–‡ä»¶</p></li><li><p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">webpack <span class="hljs-attribute">--mode</span>=development<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>æ­å»ºç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºå‰ç«¯é¡¹ç›®</title>
    <link href="/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/"/>
    <url>/2022/10/12/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="æ­å»ºå‰ç«¯é¡¹ç›®"><a href="#æ­å»ºå‰ç«¯é¡¹ç›®" class="headerlink" title="æ­å»ºå‰ç«¯é¡¹ç›®"></a>æ­å»ºå‰ç«¯é¡¹ç›®</h2><blockquote><p>npmåŒ…ç®¡ç†å·¥å…·</p></blockquote><ul><li><p>æŸ¥çœ‹npmç‰ˆæœ¬</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> -v<br></code></pre></td></tr></table></figure></li><li><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œé¡¹ç›®åˆå§‹åŒ–</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> init<br><br><span class="hljs-comment"># ä¹‹åæŒ‰ç…§æç¤ºè¾“å…¥ç›¸å…³ä¿¡æ¯</span><br><span class="hljs-comment"># æˆ–è€…åŠ ä¸ª-yå‚æ•°ï¼Œç›´æ¥åªç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹npmé•œåƒ</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set registry https:<span class="hljs-comment">//registry.npm.taobao.org</span><br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹npmé…ç½®ä¿¡æ¯</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config list<br></code></pre></td></tr></table></figure></li><li><p>ä¸‹è½½ä¾èµ–(å…¨å±€&#x2F;å½“å‰é¡¹ç›®)</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">npm install</span> <span class="hljs-title">[</span><span class="hljs-literal">--</span><span class="hljs-comment">global/</span><span class="hljs-literal">--</span><span class="hljs-comment">save</span><span class="hljs-literal">-</span><span class="hljs-comment">dev</span><span class="hljs-title">]</span> <span class="hljs-comment">ä¾èµ–å</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨package.jsonæ–‡ä»¶ä¸­æ·»åŠ <code>&quot;type&quot;: &quot;module&quot;</code>å°±å¯ä½¿ç”¨<code>import</code>æ¥å¯¼å…¥å…¶ä»–æ¨¡å—</p></li></ul><blockquote><p>npmç®¡ç†çš„é¡¹ç›®åœ¨å¤‡ä»½å’Œä¼ è¾“çš„æ—¶å€™ä¸€èˆ¬ä¸æºå¸¦node_modulesæ–‡ä»¶å¤¹</p><p>å®‰è£…ä¼šè‡ªåŠ¨åœ¨é¡¹ç›®ç›®å½•ä¸‹æ·»åŠ  package-lock.jsonæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¸®åŠ©é”å®šå®‰è£…åŒ…çš„ç‰ˆæœ¬</p><p>npm install     #æ ¹æ®package.jsonä¸­çš„é…ç½®ä¸‹è½½ä¾èµ–ï¼Œåˆå§‹åŒ–é¡¹ç›®</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>æ­å»ºç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨</title>
    <link href="/2022/10/11/spring/springboot/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8/"/>
    <url>/2022/10/11/spring/springboot/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨"><a href="#è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨"></a>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨</h2><p><strong>æ¡ˆä¾‹</strong></p><ul><li><p>è‡ªå®šä¹‰å¼‚å¸¸ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.xw.yygh.common.exception;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸ç±»</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> qy</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ApiModel(value = <span class="hljs-string">&quot;è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸ç±»&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YyghException</span> <span class="hljs-title">extends</span> <span class="hljs-title">RuntimeException</span> &#123;<br><br>    <span class="hljs-meta">@ApiModelProperty(value = <span class="hljs-string">&quot;å¼‚å¸¸çŠ¶æ€ç &quot;</span>)</span><br>    <span class="hljs-keyword">private</span> Integer code;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡çŠ¶æ€ç å’Œé”™è¯¯æ¶ˆæ¯åˆ›å»ºå¼‚å¸¸å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> YyghException(String message, Integer code) &#123;<br>        <span class="hljs-keyword">super</span>(message);<br>        <span class="hljs-keyword">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥æ”¶æšä¸¾ç±»å‹å¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resultCodeEnum</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> YyghException(ResultCodeEnum resultCodeEnum) &#123;<br>        <span class="hljs-keyword">super</span>(resultCodeEnum.getMessage());<br>        <span class="hljs-keyword">this</span>.code = resultCodeEnum.getCode();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String toString() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;YyghException&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;code=&quot;</span> + code +<br>                <span class="hljs-string">&quot;, message=&quot;</span> + <span class="hljs-keyword">this</span>.getMessage() +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†ç±»</p><p>é‡‡ç”¨AOPå®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jaba">package com.xw.yygh.common.exception;<br><br>@ControllerAdvice<br>@ResponseBody<br>public class GlobalExceptionHandler &#123;<br><br>    // å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸<br>    @ExceptionHandler(YyghException.class)<br>    public Result error(YyghException e) &#123;<br>        e.printStackTrace();<br>        return Result.fail();<br>    &#125;<br><br>    // å¤„ç†Exceptionå¼‚å¸¸<br>    @ExceptionHandler(Exception.class)<br>    public Result error(Exception e) &#123;<br>        e.printStackTrace();<br>        return Result.fail();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
      <category>springBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶</title>
    <link href="/2022/10/11/spring/springboot/SpringBoot%E8%BE%93%E5%87%BA%E6%97%A5%E5%BF%97%E5%88%B0%E6%96%87%E4%BB%B6/"/>
    <url>/2022/10/11/spring/springboot/SpringBoot%E8%BE%93%E5%87%BA%E6%97%A5%E5%BF%97%E5%88%B0%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringBootè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶"><a href="#SpringBootè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶" class="headerlink" title="SpringBootè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶"></a>SpringBootè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶</h2><p>æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰çš„è¡Œä¸ºç­‰çº§ï¼Œè¶Šå¾€ä¸‹æ—¥å¿—è¶Šè¯¦ç»†ï¼š</p><ul><li>OFF</li><li>FATA</li><li>ERROR</li><li>WARN</li><li>INFO</li><li>DEBUG</li><li>ALL</li></ul><p>é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®<code>logging.level.root=</code>æ¥è®¾ç½®æ—¥å¿—çº§åˆ«</p><p>è¦æƒ³è¾“å‡ºæ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦åœ¨resourceç›®å½•ä¸‹ç¼–å†™logback-spring.xmlæ–‡ä»¶</p><p>ä¹‹åå°±ä¼šè¾“å‡ºåˆ°æ–‡ä»¶ä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>  <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;10 seconds&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATALï¼Œå¦‚æœè®¾ç½®ä¸ºWARNï¼Œåˆ™ä½äºWARNçš„ä¿¡æ¯éƒ½ä¸ä¼šè¾“å‡º --&gt;</span><br>    <span class="hljs-comment">&lt;!-- scan:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½ï¼Œé»˜è®¤å€¼ä¸ºtrue --&gt;</span><br>    <span class="hljs-comment">&lt;!-- scanPeriod:è®¾ç½®ç›‘æµ‹é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ—¶é—´å•ä½ï¼Œé»˜è®¤å•ä½æ˜¯æ¯«ç§’ã€‚å½“scanä¸ºtrueæ—¶ï¼Œæ­¤å±æ€§ç”Ÿæ•ˆã€‚é»˜è®¤çš„æ—¶é—´é—´éš”ä¸º1åˆ†é’Ÿã€‚ --&gt;</span><br>    <span class="hljs-comment">&lt;!-- de<span class="hljs-doctag">bug:</span>å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚ --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">contextName</span>&gt;</span>logback<span class="hljs-tag">&lt;/<span class="hljs-name">contextName</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- nameçš„å€¼æ˜¯å˜é‡çš„åç§°ï¼Œvalueçš„å€¼æ—¶å˜é‡å®šä¹‰çš„å€¼ã€‚é€šè¿‡å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ã€‚å®šä¹‰å˜é‡åï¼Œå¯ä»¥ä½¿â€œ$&#123;&#125;â€æ¥ä½¿ç”¨å˜é‡ã€‚ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.path&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;F:/yygh_log&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- å½©è‰²æ—¥å¿— --&gt;</span><br>    <span class="hljs-comment">&lt;!-- é…ç½®æ ¼å¼å˜é‡ï¼šCONSOLE_LOG_PATTERN å½©è‰²æ—¥å¿—æ ¼å¼ --&gt;</span><br>    <span class="hljs-comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span><br>    <span class="hljs-comment">&lt;!-- boldMagenta:ç²—çº¢--&gt;</span><br>    <span class="hljs-comment">&lt;!-- cyan:é’è‰² --&gt;</span><br>    <span class="hljs-comment">&lt;!-- white:ç™½è‰² --&gt;</span><br>    <span class="hljs-comment">&lt;!-- magenta:æ´‹çº¢ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE_LOG_PATTERN&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%yellow(%date&#123;yyyy-MM-dd HH:mm:ss&#125;) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)&quot;</span>/&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--è¾“å‡ºåˆ°æ§åˆ¶å°--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯--&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾‹å¦‚ï¼šå¦‚æœæ­¤å¤„é…ç½®äº†INFOçº§åˆ«ï¼Œåˆ™åé¢å…¶ä»–ä½ç½®å³ä½¿é…ç½®äº†DEBUGçº§åˆ«çš„æ—¥å¿—ï¼Œä¹Ÿä¸ä¼šè¢«è¾“å‡º --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- è®¾ç½®å­—ç¬¦é›† --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º INFO æ—¥å¿— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log.path&#125;/log_info.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/log-info-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•infoçº§åˆ«çš„ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º WARN æ—¥å¿— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log.path&#125;/log_warn.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span> <span class="hljs-comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/log-warn-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•warnçº§åˆ«çš„ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>warn<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!-- æ—¶é—´æ»šåŠ¨è¾“å‡º levelä¸º ERROR æ—¥å¿— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶å --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log.path&#125;/log_error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºæ ¼å¼--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span> <span class="hljs-comment">&lt;!-- æ­¤å¤„è®¾ç½®å­—ç¬¦é›† --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/log-error-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>100MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ­¤æ—¥å¿—æ–‡ä»¶åªè®°å½•ERRORçº§åˆ«çš„ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        &lt;logger&gt;ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ã€ä»¥åŠæŒ‡å®š&lt;appender&gt;ã€‚</span><br><span class="hljs-comment">        &lt;logger&gt;ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œ</span><br><span class="hljs-comment">        ä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚</span><br><span class="hljs-comment">        name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»ã€‚</span><br><span class="hljs-comment">        level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œ</span><br><span class="hljs-comment">              å¦‚æœæœªè®¾ç½®æ­¤å±æ€§ï¼Œé‚£ä¹ˆå½“å‰loggerå°†ä¼šç»§æ‰¿ä¸Šçº§çš„çº§åˆ«ã€‚</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œsqlè¯­å¥æ˜¯debugä¸‹æ‰ä¼šæ‰“å°ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬åªé…ç½®äº†infoï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹sqlè¯­å¥çš„è¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š</span><br><span class="hljs-comment">        ç¬¬ä¸€ç§æŠŠ&lt;root level=&quot;INFO&quot;&gt;æ”¹æˆ&lt;root level=&quot;DEBUG&quot;&gt;è¿™æ ·å°±ä¼šæ‰“å°sqlï¼Œä¸è¿‡è¿™æ ·æ—¥å¿—é‚£è¾¹ä¼šå‡ºç°å¾ˆå¤šå…¶ä»–æ¶ˆæ¯</span><br><span class="hljs-comment">        ç¬¬äºŒç§å°±æ˜¯å•ç‹¬ç»™mapperä¸‹ç›®å½•é…ç½®DEBUGæ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™æ ·é…ç½®sqlè¯­å¥ä¼šæ‰“å°ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸DEBUGçº§åˆ«ï¼š</span><br><span class="hljs-comment">     --&gt;</span><br>    <span class="hljs-comment">&lt;!--å¼€å‘ç¯å¢ƒ:æ‰“å°æ§åˆ¶å°--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--å¯ä»¥è¾“å‡ºé¡¹ç›®ä¸­çš„debugæ—¥å¿—ï¼ŒåŒ…æ‹¬mybatisçš„sqlæ—¥å¿—--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.guli&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            rootèŠ‚ç‚¹æ˜¯å¿…é€‰èŠ‚ç‚¹ï¼Œç”¨æ¥æŒ‡å®šæœ€åŸºç¡€çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§</span><br><span class="hljs-comment">            level:ç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACE, DEBUG, INFO, WARN, ERROR, ALL å’Œ OFFï¼Œé»˜è®¤æ˜¯DEBUG</span><br><span class="hljs-comment">            å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªappenderå…ƒç´ ã€‚</span><br><span class="hljs-comment">        --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--ç”Ÿäº§ç¯å¢ƒ:è¾“å‡ºåˆ°æ–‡ä»¶--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pro&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;DEBUG_FILE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
      <category>springBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPé€»è¾‘åˆ é™¤</title>
    <link href="/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4/"/>
    <url>/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="MPé€»è¾‘åˆ é™¤"><a href="#MPé€»è¾‘åˆ é™¤" class="headerlink" title="MPé€»è¾‘åˆ é™¤"></a>MPé€»è¾‘åˆ é™¤</h2><blockquote><p>åˆ é™¤æ•°æ®åªæ˜¯é€»è¾‘ä¸Šåˆ é™¤ï¼Œæ•°æ®åº“ä¸­è¿˜èƒ½æŸ¥åˆ°</p></blockquote><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><p>å¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤</p></li><li><p>æœ‰å…³è”æ•°æ®ï¼Œä¸ä¾¿åˆ é™¤</p></li><li><p>è¡¨ä¸­æ·»åŠ <code>deleted</code>å­—æ®µï¼Œç±»å‹ä¸ºbooleané»˜è®¤å€¼ä¸ºfalse</p></li><li><p>ä¿®æ”¹å®ä½“ç±»ï¼Œæ·»åŠ <code>deleted</code>å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableLogic</span><br><span class="hljs-keyword">private</span> Integer deleted;<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®(ä¸‹é¢æ˜¯é»˜è®¤é…ç½®ï¼Œå¯é…å¯ä¸é…)</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># é€»è¾‘åˆ é™¤</span><br><span class="hljs-attr">mybatis-plus.global-config.db-config.logic-delete-value</span>=<span class="hljs-string">1</span><br><span class="hljs-attr">mybatis-plus.global-config.db-config.logic-not-delete-value</span>=<span class="hljs-string">0</span><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
      <category>mybatis-plus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPåˆ†é¡µæ’ä»¶</title>
    <link href="/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/"/>
    <url>/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="MPåˆ†é¡µæ’ä»¶"><a href="#MPåˆ†é¡µæ’ä»¶" class="headerlink" title="MPåˆ†é¡µæ’ä»¶"></a>MPåˆ†é¡µæ’ä»¶</h2><ul><li><p>åœ¨mpé…ç½®ç±»ä¸­æ·»åŠ åˆ†é¡µæ’ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MpConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ†é¡µæ’ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">paginationInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•selectPage</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectPage</span><span class="hljs-params">()</span> &#123;<br>    Page&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);<br>    Page&lt;User&gt; userPage = mapper.selectPage(page, <span class="hljs-literal">null</span>);<br>    <span class="hljs-comment">//è¿”å›å¯¹è±¡å¾—åˆ°åˆ†é¡µæ‰€æœ‰æ•°æ®</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">pages</span> <span class="hljs-operator">=</span> userPage.getPages(); <span class="hljs-comment">//æ€»é¡µæ•°</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> userPage.getCurrent(); <span class="hljs-comment">//å½“å‰é¡µ</span><br>    List&lt;User&gt; records = userPage.getRecords(); <span class="hljs-comment">//æŸ¥è¯¢æ•°æ®é›†åˆ</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> userPage.getTotal(); <span class="hljs-comment">//æ€»è®°å½•æ•°</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNext</span> <span class="hljs-operator">=</span> userPage.hasNext();  <span class="hljs-comment">//ä¸‹ä¸€é¡µ</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">hasPrevious</span> <span class="hljs-operator">=</span> userPage.hasPrevious(); <span class="hljs-comment">//ä¸Šä¸€é¡µ</span><br><br>    System.out.println(pages);<br>    System.out.println(current);<br>    System.out.println(records);<br>    System.out.println(total);<br>    System.out.println(hasNext);<br>    System.out.println(hasPrevious);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
      <category>mybatis-plus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPä¹è§‚é”</title>
    <link href="/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E4%B9%90%E8%A7%82%E9%94%81/"/>
    <url>/2022/10/11/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E4%B9%90%E8%A7%82%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h2 id="MPä¹è§‚é”"><a href="#MPä¹è§‚é”" class="headerlink" title="MPä¹è§‚é”"></a>MPä¹è§‚é”</h2><ul><li><p>åœ¨mpé…ç½®ç±»ä¸­æ·»åŠ ä¹è§‚é”æ’ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MpConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¹è§‚é”æ’ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> OptimisticLockerInterceptor <span class="hljs-title function_">optimisticLockerInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OptimisticLockerInterceptor</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç»™ç±»ä¸Šæ·»åŠ <code>version</code>å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Version</span><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br><span class="hljs-keyword">private</span> Integer version;<br></code></pre></td></tr></table></figure></li><li><p>æ’å…¥æ—¶è‡ªåŠ¨å¡«å……</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;createTime&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),metaObject);<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),metaObject);<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;version&quot;</span>,<span class="hljs-number">1</span>,metaObject);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;updateTime&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),metaObject);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¯æ¬¡è¦ä¿®æ”¹æ—¶å…ˆæŸ¥è¯¢å‡ºè¦ä¿®æ”¹çš„æ•°æ®ï¼Œä¿®æ”¹åå†æ”¾å›æ•°æ®åº“ï¼Œversionå€¼ä¼šè‡ªåŠ¨åŠ ä¸€</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
      <category>mybatis-plus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>10.Vuex</title>
    <link href="/2022/10/09/%E5%89%8D%E7%AB%AF/vue/10.Vuex/"/>
    <url>/2022/10/09/%E5%89%8D%E7%AB%AF/vue/10.Vuex/</url>
    
    <content type="html"><![CDATA[<h2 id="10-Vuex"><a href="#10-Vuex" class="headerlink" title="10.Vuex"></a>10.Vuex</h2><blockquote><p>vuex å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´<strong>å…±äº«æ•°æ®</strong>ï¼Œå¹¶ä¸”å…±äº«çš„æ•°æ®æ˜¯ã€å“åº”å¼ã€‘çš„ï¼Œå³æ•°æ®çš„å˜æ›´èƒ½åŠæ—¶æ¸²æŸ“åˆ°æ¨¡æ¿</p></blockquote><h3 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h3><blockquote><p>é€šè¿‡vuexå®ç°å¤šä¸ªviewé—´å…±äº«æ•°æ®</p></blockquote><p>åœ¨src&#x2F;storeç›®å½•ä¸‹ä¿®æ”¹index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vuex&#x27;</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-comment">// å…±äº«æ•°æ®</span><br>  <span class="hljs-attr">state</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>  &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>  &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;<br><br>    <span class="hljs-comment">// ä¿®æ”¹æ•°æ®</span><br>    <span class="hljs-title function_">updateName</span>(<span class="hljs-params">state, newName</span>) &#123;<br>      state.<span class="hljs-property">name</span> = newName<br>    &#125;<br><br>  &#125;,<br>  <span class="hljs-attr">actions</span>: &#123;<br>  &#125;,<br>  <span class="hljs-attr">modules</span>: &#123;<br>  &#125;<br>&#125;)<br><br></code></pre></td></tr></table></figure><p>P1View.vueæ·»åŠ æ•°æ®</p><blockquote><p>é€šè¿‡this.$store.commitè°ƒç”¨æ–¹æ³•</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;p&quot;&gt;<br>        &lt;el-input placeholder=&quot;è¯·ä¿®æ”¹ç”¨æˆ·å§“å&quot; <br>            size=&quot;mini&quot; v-model=&quot;name&quot;&gt;&lt;/el-input&gt;<br>        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;update()&quot;&gt;ä¿®æ”¹&lt;/el-button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>const options = &#123;<br>    data() &#123;<br>        return &#123;<br>            name: &#x27;&#x27;<br>        &#125;<br>    &#125;,<br><br>    methods: &#123;<br>        update() &#123;<br>            // sessionStorage.setItem(&#x27;name&#x27;, this.name)<br>            // ä¿®æ”¹å…±äº«æ•°æ®<br>            this.$store.commit(&#x27;updateName&#x27;, this.name);<br>        &#125;<br>    &#125;<br>&#125;<br>export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>ContainerView.vueè·å–æ•°æ®</p><blockquote><p>é€šè¿‡$store.state.nameæ’å…¥æ•°æ®</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;el-container&gt;<br>            &lt;el-header&gt;<br>                &lt;div class=&quot;t&quot;&gt;æ¬¢è¿æ‚¨ï¼š&#123;&#123;name&#125;&#125;&lt;/div&gt;<br>            &lt;/el-header&gt;<br>            &lt;el-container&gt;<br>                &lt;el-aside width=&quot;200px&quot;&gt;<br>                &lt;/el-aside&gt;<br>                &lt;el-main&gt;<br>                    &lt;router-view&gt;&lt;/router-view&gt;<br>                &lt;/el-main&gt;<br>            &lt;/el-container&gt;<br>        &lt;/el-container&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>const options = &#123;<br>    computed: &#123;<br>        name() &#123;<br>            return this.$store.state.name<br>        &#125;<br>    &#125;<br>&#125;<br>export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•è·å–å…±äº«å±æ€§å’Œä¿®æ”¹æ–¹æ³•"><a href="#æ–¹æ³•è·å–å…±äº«å±æ€§å’Œä¿®æ”¹æ–¹æ³•" class="headerlink" title="æ–¹æ³•è·å–å…±äº«å±æ€§å’Œä¿®æ”¹æ–¹æ³•"></a>æ–¹æ³•è·å–å…±äº«å±æ€§å’Œä¿®æ”¹æ–¹æ³•</h3><blockquote><p>è°ƒç”¨vuexä¸­çš„æ–¹æ³•éƒ½æ˜¯å…ˆå¯¼å…¥mapXxxï¼ˆVuex.Storeä¸­çš„å±æ€§åï¼‰</p><p>å†ä¼ å…¥è¦è°ƒç”¨&#x2F;ä½¿ç”¨çš„æ–¹æ³•å&#x2F;å…±äº«å±æ€§å</p></blockquote><blockquote><p>mapStateæ–¹æ³•ï¼Œç”Ÿæˆå…±äº«å±æ€§å¯¹åº”çš„è®¡ç®—å±æ€§ï¼Œ<code>...</code>è§£æ„åˆ°computedä¸­</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;el-container&gt;<br>            &lt;el-header&gt;<br>                &lt;div class=&quot;t&quot;&gt;æ¬¢è¿æ‚¨ï¼š&#123;&#123;name&#125;&#125;&#123;&#123;age&#125;&#125;&lt;/div&gt;<br>            &lt;/el-header&gt;<br>            &lt;el-container&gt;<br>                &lt;el-aside width=&quot;200px&quot;&gt;<br>                &lt;/el-aside&gt;<br>                &lt;el-main&gt;<br>                    &lt;router-view&gt;&lt;/router-view&gt;<br>                &lt;/el-main&gt;<br>            &lt;/el-container&gt;<br>        &lt;/el-container&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>import &#123;mapState&#125; from &#x27;vuex&#x27;<br><br>const options = &#123;<br>    computed: &#123;<br>        // é€šè¿‡mapStateæ–¹æ³•ï¼Œç”Ÿæˆå…±äº«å±æ€§å¯¹åº”çš„è®¡ç®—å±æ€§<br>        ...mapState([&#x27;name&#x27;, &#x27;age&#x27;])<br>    &#125;<br>&#125;<br>export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><blockquote><p>é€šè¿‡mapMutationsæ–¹æ³•ï¼Œè·å–ä¿®æ”¹æ–¹æ³•ï¼Œ<code>...</code>è§£æ„åˆ°methodsä¸­</p><p>å‚æ•°åœ¨ç»‘å®šclickæ—¶ä¼ å…¥</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;p&quot;&gt;<br>        &lt;el-input placeholder=&quot;è¯·ä¿®æ”¹ç”¨æˆ·å§“å&quot; <br>            size=&quot;mini&quot; v-model=&quot;name&quot;&gt;&lt;/el-input&gt;<br>            &lt;el-input placeholder=&quot;è¯·ä¿®æ”¹ç”¨æˆ·å¹´é¾„&quot; <br>            size=&quot;mini&quot; v-model=&quot;age&quot;&gt;&lt;/el-input&gt;<br>        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;updateName(name);updateAge(age)&quot;&gt;ä¿®æ”¹&lt;/el-button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>import &#123;mapMutations&#125; from &#x27;vuex&#x27;<br><br>const options = &#123;<br>    data() &#123;<br>        return &#123;<br>            name: &#x27;&#x27;,<br>            age: &#x27;&#x27;<br>        &#125;<br>    &#125;,<br><br>    methods: &#123;<br>        // é€šè¿‡mapMutationsæ–¹æ³•ï¼Œè·å–ä¿®æ”¹æ–¹æ³•<br>        ...mapMutations([&#x27;updateName&#x27;, &#x27;updateAge&#x27;])<br>    &#125;<br>&#125;<br>export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="ä½¿è°ƒè¯•å·¥å…·ä¸å»¶è¿Ÿå±•ç¤º"><a href="#ä½¿è°ƒè¯•å·¥å…·ä¸å»¶è¿Ÿå±•ç¤º" class="headerlink" title="ä½¿è°ƒè¯•å·¥å…·ä¸å»¶è¿Ÿå±•ç¤º"></a>ä½¿è°ƒè¯•å·¥å…·ä¸å»¶è¿Ÿå±•ç¤º</h3><blockquote><p>å¦‚æœåœ¨mutationsä¸­åŒ…å«å¼‚æ­¥æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¼€å‘å·¥å…·æ˜¾ç¤ºä¸å‡†ç¡®</p><p>å°†å¼‚æ­¥æ“ä½œæ”¾åˆ°actionsä¸­</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">mutations</span>: &#123;<br><br>   <span class="hljs-comment">// ä¿®æ”¹æ•°æ®</span><br>   <span class="hljs-title function_">updateName</span>(<span class="hljs-params">state, newName</span>) &#123;<br>     state.<span class="hljs-property">name</span> = newName<br>   &#125;,<br><br>   <span class="hljs-title function_">updateAge</span>(<span class="hljs-params">state, newAge</span>) &#123;<br>     state.<span class="hljs-property">age</span> = newAge<br>   &#125;,<br><br>   <span class="hljs-comment">// ä»æœåŠ¡å™¨è·å–ç”¨æˆ·åå¹´é¾„</span><br>   <span class="hljs-comment">// å¦‚æœåœ¨mutationsä¸­åŒ…å«å¼‚æ­¥æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¼€å‘å·¥å…·æ˜¾ç¤ºä¸å‡†ç¡®</span><br>   <span class="hljs-keyword">async</span> <span class="hljs-title function_">updateServerName</span>(<span class="hljs-params">state, user</span>) &#123;<br>     <span class="hljs-keyword">const</span> &#123;name, age&#125; = user<br>     state.<span class="hljs-property">name</span> = name<br>     state.<span class="hljs-property">age</span> = age<br>   &#125;<br><br> &#125;,<br> <span class="hljs-attr">actions</span>: &#123;<br>   <span class="hljs-keyword">async</span> <span class="hljs-title function_">updateServerName</span>(<span class="hljs-params">context</span>) &#123;<br>     <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/user&#x27;</span>)<br>     <span class="hljs-comment">// é€šè¿‡contextè°ƒç”¨mutationsä¸­çš„æ–¹æ³•</span><br>     context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;updateServerName&#x27;</span>, resp.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>)<br>   &#125;<br> &#125;,<br></code></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨æ—¶é€šè¿‡è°ƒç”¨actionsä¸­çš„æ–¹æ³•é—´æ¥è°ƒç”¨mutationsä¸­çš„æ–¹æ³•</p><blockquote><p>é€šè¿‡mapActionsè°ƒç”¨actionsä¸­çš„æ–¹æ³•</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>import &#123;mapActions&#125; from &#x27;vuex&#x27;<br>const options = &#123;<br>    methods: &#123;<br>        ...mapActions([&#x27;updateServerName&#x27;])<br>    &#125;<br>&#125;<br>export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>7.å¯¼èˆªèœå•</title>
    <link href="/2022/10/08/%E5%89%8D%E7%AB%AF/elementUI/7.%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95/"/>
    <url>/2022/10/08/%E5%89%8D%E7%AB%AF/elementUI/7.%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95/</url>
    
    <content type="html"><![CDATA[<h2 id="7-å¯¼èˆªèœå•"><a href="#7-å¯¼èˆªèœå•" class="headerlink" title="7.å¯¼èˆªèœå•"></a>7.å¯¼èˆªèœå•</h2><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>el-menu é‡Œçš„routerå±æ€§ï¼šæ˜¯å¦ä½¿ç”¨ vue-router çš„æ¨¡å¼ï¼Œå¯ç”¨è¯¥æ¨¡å¼ä¼šåœ¨æ¿€æ´»å¯¼èˆªæ—¶ä»¥ index ä½œä¸º path è¿›è¡Œè·¯ç”±è·³è½¬</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;el-container&gt;<br><br>        &lt;!-- é¡¶éƒ¨ --&gt;<br>        &lt;el-header&gt;<br>            <br>            &lt;el-button icon=&quot;el-icon-search&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p1&#x27;)&quot;&gt;&lt;/el-button&gt;<br>            &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p2&#x27;)&quot;&gt;&lt;/el-button&gt;<br>            &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-check&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p3&#x27;)&quot;&gt;&lt;/el-button&gt;<br><br>        &lt;/el-header&gt;<br><br>        &lt;el-container&gt;<br><br>            &lt;!-- ä¾§è¾¹æ  --&gt;<br>            &lt;el-aside width=&quot;200px&quot;&gt;<br><br>                &lt;!-- å¯¼èˆªæ  --&gt;<br>                &lt;el-menu<br>                    router<br>                    background-color=&quot;#545c64&quot;<br>                    text-color=&quot;#fff&quot;<br>                    active-text-color=&quot;#ffd04b&quot;&gt;<br>                    <br>                    &lt;!-- é€‰é¡¹ --&gt;<br>                    &lt;el-menu-item index=&quot;/c/p1&quot;&gt;<br>                        &lt;!-- ç”¨spanå°†å…ƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œä¸ç„¶å¯èƒ½ä¼šé”™ä½ --&gt;<br>                        &lt;span slot=&quot;title&quot;&gt;<br>                            &lt;i class=&quot;el-icon-setting&quot;&gt;&lt;/i&gt;<br>                            èœå•1<br>                        &lt;/span&gt;<br>                    &lt;/el-menu-item&gt;<br>                        &lt;el-submenu&gt;<br>                            <br>                            &lt;span slot=&quot;title&quot;&gt;<br>                                &lt;i class=&quot;el-icon-star-off&quot;&gt;&lt;/i&gt;<br>                                èœå•2<br>                            &lt;/span&gt;<br>                        &lt;el-menu-item&gt;å­é¡¹1&lt;/el-menu-item&gt;<br>                        &lt;el-menu-item&gt;å­é¡¹2&lt;/el-menu-item&gt;<br>                        &lt;el-menu-item&gt;å­é¡¹3&lt;/el-menu-item&gt;<br>                    &lt;/el-submenu&gt;<br>                    <br>                    &lt;el-menu-item index=&quot;/c/p3&quot;&gt;<br>                        &lt;span slot=&quot;title&quot;&gt;<br>                            &lt;i class=&quot;el-icon-phone&quot;&gt;&lt;/i&gt;<br>                            èœå•3<br>                        &lt;/span&gt;<br>                    &lt;/el-menu-item&gt;<br><br>                &lt;/el-menu&gt;<br><br>            &lt;/el-aside&gt;<br><br>            &lt;!-- ä¸»åˆ†åŒº --&gt;<br>            &lt;el-main&gt;<br>                &lt;router-view&gt;&lt;/router-view&gt;<br>            &lt;/el-main&gt;<br><br>        &lt;/el-container&gt;<br>        &lt;/el-container&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95.png"></p><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>åŠ¨æ€æ·»åŠ èœå•</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;el-container&gt;<br>            &lt;el-header&gt;&lt;/el-header&gt;<br>            &lt;el-container&gt;<br>                &lt;el-aside width=&quot;200px&quot;&gt;<br>                    &lt;!-- åŠ¨æ€èœå• --&gt;<br>                    &lt;el-menu router<br>                        default-active=&quot;2&quot;<br>                        class=&quot;el-menu-vertical-demo&quot;<br>                        @open=&quot;handleOpen&quot;<br>                        @close=&quot;handleClose&quot;<br>                        background-color=&quot;#545c64&quot;<br>                        text-color=&quot;#fff&quot;<br>                        active-text-color=&quot;#ffd04b&quot;<br>                        unique-opened&gt;<br>                        &lt;template v-for=&quot;m1 of top&quot;&gt;<br>                            &lt;el-submenu v-if=&quot;m1.children&quot; :key=&quot;m1.id&quot; :index=&quot;m1.path&quot;&gt;<br>                                &lt;span slot=&quot;title&quot;&gt;<br>                                    &lt;i :class=&quot;m1.icon&quot;&gt;&lt;/i&gt;<br>                                    &#123;&#123;m1.name&#125;&#125;<br>                                &lt;/span&gt;<br>                                &lt;el-menu-item v-for=&quot;m2 of m1.children&quot; :key=&quot;m2.id&quot; :index=&quot;m2.path&quot;&gt;<br>                                    &lt;span slot=&quot;title&quot;&gt;<br>                                        &lt;i :class=&quot;m2.icon&quot;&gt;&lt;/i&gt;<br>                                        &#123;&#123;m2.name&#125;&#125;<br>                                    &lt;/span&gt;<br>                                &lt;/el-menu-item&gt;<br>                            &lt;/el-submenu&gt;<br>                            &lt;el-menu-item v-else :key=&quot;m1.id&quot; :index=&quot;m1.path&quot;&gt;<br>                                &lt;span slot=&quot;title&quot;&gt;<br>                                    &lt;i :class=&quot;m1.icon&quot;&gt;&lt;/i&gt;<br>                                    &#123;&#123;m1.name&#125;&#125;<br>                                &lt;/span&gt;<br>                            &lt;/el-menu-item&gt;<br>                        &lt;/template&gt;<br>                    &lt;/el-menu&gt;<br><br>                &lt;/el-aside&gt;<br>                &lt;el-main&gt;&lt;/el-main&gt;<br>            &lt;/el-container&gt;<br>            &lt;/el-container&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br><br><br><br><br>&lt;script&gt;<br>const options = &#123;<br>    data() &#123;<br>        return &#123;    <br>            top: []<br>        &#125;<br>    &#125;, <br><br>    mounted() &#123;<br>        // é¡µé¢åŠ è½½æ—¶ï¼Œè·å–sessionStorageä¸­çš„ä¿¡æ¯<br>        const serverRouters = sessionStorage.getItem(&#x27;serverRoutes&#x27;);<br>        const array = JSON.parse(serverRouters)<br><br>        // è§£ææ•°æ®<br>        const map = new Map()<br>        for (const obj of array) &#123;<br>            map.set(obj.id, obj)<br>        &#125;<br>        // å°†å­èœå•æ”¾åˆ°çˆ¶èœå•ä¸‹<br>        const top = []; // æ ¹èœå•<br>        for (const obj of array) &#123;<br>            const parent = map.get(obj.pid)<br>            if (parent) &#123;<br>                parent.children ??= []<br>                parent.children.push(obj)<br>            &#125; else &#123;<br>                top.push(obj);<br>            &#125;<br>        &#125;<br>        this.top = top<br>    &#125;<br><br><br>&#125;<br>export default options;<br>&lt;/script&gt;<br><br><br><br><br><br><br>&lt;style scoped&gt;<br>.container &#123;<br>    height: 500px;<br>    background-color: cornsilk;<br>    background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Ctext x=&#x27;15&#x27; y=&#x27;10&#x27; font-size=&#x27;14&#x27; font-family=&#x27;system-ui, sans-serif&#x27; text-anchor=&#x27;middle&#x27; dominant-baseline=&#x27;middle&#x27;%3Eä¸»é¡µ%3C/text%3E%3C/svg%3E&quot;);<br>    padding: 20px;<br>    box-sizing: border-box;<br>&#125;<br><br>.el-container &#123;<br>    height: 100%;<br>&#125;<br><br>.el-header &#123;<br>    background-color: aquamarine;<br>&#125;<br><br>.el-aside &#123;<br>    background-color: gold;<br>&#125;<br><br>.el-main &#123;<br>    background-color: dodgerblue;<br>&#125;<br><br>a &#123;<br>    text-decoration: none;<br>    display: block;<br>    margin: 10px 10px 0 10px;<br>    padding: 3px;<br>    font-size: 13px;<br>&#125;<br><br>.router-link-active &#123;<br>    color: #fff;<br>    background-color: darkslateblue;<br>&#125;<br><br>.el-button &#123;<br>    margin-top: 15px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E5%8A%A8%E6%80%81%E8%8F%9C%E5%8D%95.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6.å¸ƒå±€å®¹å™¨</title>
    <link href="/2022/10/08/%E5%89%8D%E7%AB%AF/elementUI/6.%E5%B8%83%E5%B1%80%E5%AE%B9%E5%99%A8/"/>
    <url>/2022/10/08/%E5%89%8D%E7%AB%AF/elementUI/6.%E5%B8%83%E5%B1%80%E5%AE%B9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="6-å¸ƒå±€å®¹å™¨"><a href="#6-å¸ƒå±€å®¹å™¨" class="headerlink" title="6.å¸ƒå±€å®¹å™¨"></a>6.å¸ƒå±€å®¹å™¨</h2><p><a href="https://element.eleme.cn/#/zh-CN/component/container#container-bu-ju-rong-qi">å¸ƒå±€å®¹å™¨</a></p><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;el-container&gt;<br>  &lt;el-header&gt;Header&lt;/el-header&gt;<br>  &lt;el-container&gt;<br>    &lt;el-aside width=&quot;200px&quot;&gt;Aside&lt;/el-aside&gt;<br>    &lt;el-main&gt;Main&lt;/el-main&gt;<br>  &lt;/el-container&gt;<br>&lt;/el-container&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>9.è·¯ç”±</title>
    <link href="/2022/10/07/%E5%89%8D%E7%AB%AF/vue/9.%E8%B7%AF%E7%94%B1/"/>
    <url>/2022/10/07/%E5%89%8D%E7%AB%AF/vue/9.%E8%B7%AF%E7%94%B1/</url>
    
    <content type="html"><![CDATA[<h2 id="9-è·¯ç”±"><a href="#9-è·¯ç”±" class="headerlink" title="9.è·¯ç”±"></a>9.è·¯ç”±</h2><blockquote><p>vue å±äº<strong>å•é¡µé¢åº”ç”¨</strong>ï¼Œæ‰€è°“çš„è·¯ç”±ï¼Œå°±æ˜¯æ ¹æ®æµè§ˆå™¨è·¯å¾„ä¸åŒï¼Œç”¨ä¸åŒçš„<strong>è§†å›¾ç»„ä»¶</strong>æ›¿æ¢è¿™ä¸ªé¡µé¢å†…å®¹å±•ç¤º</p></blockquote><p>é»˜è®¤è·¯ç”±çš„é…ç½®æ˜¯routerç›®å½•ä¸‹çš„index.jsæ–‡ä»¶</p><p>å¯ä»¥æ ¹æ®è¿™ä¸ªæ–‡ä»¶æ¥å†™è·¯ç”±</p><h3 id="é™æ€å¯¼å…¥"><a href="#é™æ€å¯¼å…¥" class="headerlink" title="é™æ€å¯¼å…¥"></a>é™æ€å¯¼å…¥</h3><ul><li>è‡ªå®šä¹‰è·¯ç”±æ–‡ä»¶</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-comment">// ç»å¯¹è·¯å¾„å¯¼å…¥ï¼Œ@è¡¨ç¤ºsrc</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ContainerView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/example13/ContainerView.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">LoginView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/example13/LoginView.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">NotFoundView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/views/example13/NotFoundView.vue&#x27;</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueRouter</span>)<br><br><span class="hljs-keyword">const</span> routes = [<br>  <span class="hljs-comment">// å»ºç«‹è·¯å¾„å’Œç»„ä»¶ä¹‹é—´çš„å¯¹åº”å…³ç³»</span><br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">ContainerView</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/login&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">LoginView</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/404&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">NotFoundView</span><br>  &#125;<br>]<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>  routes<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><ul><li>åœ¨å…¥å£main.jsä¸­å¯¼å…¥ç¼–å†™çš„è·¯ç”±æ–‡ä»¶</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router/example13&#x27;</span> <span class="hljs-comment">// å¯¼å…¥è‡ªå®šä¹‰çš„è·¯ç”±</span><br></code></pre></td></tr></table></figure><ul><li><p>ä¿®æ”¹ä¸»è§†å›¾</p><blockquote><p> <code>&lt;router-view&gt;</code> èµ·åˆ°å ä½ä½œç”¨ï¼Œæ”¹å˜è·¯å¾„åï¼Œè¿™ä¸ªè·¯å¾„å¯¹åº”çš„è§†å›¾ç»„ä»¶å°±ä¼šå æ® <code>&lt;router-view&gt;</code> çš„ä½ç½®ï¼Œæ›¿æ¢æ‰å®ƒä¹‹å‰çš„å†…å®¹</p></blockquote></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;router-view&gt;&lt;/router-view&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br><br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><h3 id="åŠ¨æ€å¯¼å…¥"><a href="#åŠ¨æ€å¯¼å…¥" class="headerlink" title="åŠ¨æ€å¯¼å…¥"></a>åŠ¨æ€å¯¼å…¥</h3><blockquote><ul><li>é™æ€å¯¼å…¥æ˜¯å°†æ‰€æœ‰ç»„ä»¶çš„ js ä»£ç æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¦‚æœç»„ä»¶éå¸¸å¤šï¼Œæ‰“åŒ…åçš„ js æ–‡ä»¶ä¼šå¾ˆå¤§ï¼Œå½±å“é¡µé¢åŠ è½½é€Ÿåº¦</li><li>åŠ¨æ€å¯¼å…¥æ˜¯å°†ç»„ä»¶çš„ js ä»£ç æ”¾å…¥ç‹¬ç«‹çš„æ–‡ä»¶ï¼Œç”¨åˆ°æ—¶æ‰åŠ è½½</li></ul></blockquote><p><strong>æ¡ˆä¾‹</strong></p><p>å°†ä¸Šé¢çš„é™æ€å¯¼å…¥æ”¹ä¸ºåŠ¨æ€å¯¼å…¥</p><p>é€šè¿‡lambdaè¡¨è¾¾å¼<code>() =&gt; import(&#39;æ–‡ä»¶è·¯å¾„&#39;)</code>æ¥åŠ¨æ€å¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-comment">// ç»å¯¹è·¯å¾„å¯¼å…¥ï¼Œ@è¡¨ç¤ºsrc</span><br><span class="hljs-comment">// import ContainerView from &#x27;@/views/example13/ContainerView.vue&#x27;</span><br><span class="hljs-comment">// import LoginView from &#x27;@/views/example13/LoginView.vue&#x27;</span><br><span class="hljs-comment">// import NotFoundView from &#x27;@/views/example13/NotFoundView.vue&#x27;</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueRouter</span>)<br><br><span class="hljs-keyword">const</span> routes = [<br>  <span class="hljs-comment">// å»ºç«‹è·¯å¾„å’Œç»„ä»¶ä¹‹é—´çš„å¯¹åº”å…³ç³»</span><br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/ContainerView.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/login&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/LoginView.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/404&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/NotFoundView.vue&#x27;</span>)<br>  &#125;<br>]<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>  routes<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br><br></code></pre></td></tr></table></figure><h3 id="åµŒå¥—å¯¼å…¥"><a href="#åµŒå¥—å¯¼å…¥" class="headerlink" title="åµŒå¥—å¯¼å…¥"></a>åµŒå¥—å¯¼å…¥</h3><blockquote><p>ä¹Ÿå«å­è·¯ç”±ï¼Œç»„ä»¶å†…å†è¦åˆ‡æ¢å†…å®¹ï¼Œå°±éœ€è¦ç”¨åˆ°åµŒå¥—è·¯ç”±</p><p>é€šè¿‡childrenå±æ€§æ¥å®šä¹‰åµŒå¥—è·¯ç”±</p></blockquote><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>å®šä¹‰åµŒå¥—è·¯ç”±å’Œé‡å®šå‘</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueRouter</span>)<br><br><span class="hljs-keyword">const</span> routes = [<br>  <span class="hljs-comment">// å»ºç«‹è·¯å¾„å’Œç»„ä»¶ä¹‹é—´çš„å¯¹åº”å…³ç³»</span><br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/ContainerView.vue&#x27;</span>),<br>    <span class="hljs-comment">// é‡å®šå‘ï¼Œç›¸å½“äºé€‰æ‹©äº†é»˜è®¤çš„åµŒå¥—è·¯ç”±</span><br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/c/p1&#x27;</span>,<br><span class="hljs-comment">// åµŒå¥—è·¯ç”±</span><br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;c/p1&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/container/P1View.vue&#x27;</span>)<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;c/p2&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/container/P2View.vue&#x27;</span>)<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;c/p3&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/container/P3View.vue&#x27;</span>)<br>      &#125;,<br>      <br>    ]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/login&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/LoginView.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/404&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/example13/NotFoundView.vue&#x27;</span>)<br>  &#125;,<br>  &#123;<br><span class="hljs-comment">// ä»å®šå‘ç”¨æ³•ï¼Œè®¿é—®ä¸å­˜åœ¨çš„è·¯å¾„è·³è½¬åˆ°æŒ‡å®šçš„ç»„ä»¶ä¸Šå»</span><br>    <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;*&#x27;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/404&#x27;</span><br>  &#125;<br>]<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>  routes<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></figure><h3 id="è·¯ç”±è·³è½¬"><a href="#è·¯ç”±è·³è½¬" class="headerlink" title="è·¯ç”±è·³è½¬"></a>è·¯ç”±è·³è½¬</h3><p>è·³è½¬æ–¹å¼ï¼š</p><ul><li>æ ‡ç­¾å¼ï¼šé€šè¿‡toå±æ€§å®ç°è·³è½¬</li><li>ç¼–ç¨‹å¼ï¼šè‡ªå®šä¹‰æ–¹æ³•ï¼Œé€šè¿‡this.$router.push(url)æ–¹å¼å®ç°è·³è½¬</li></ul><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;container&quot;&gt;<br>        &lt;el-container&gt;<br>        &lt;el-header&gt;<br>            &lt;!-- ç¼–ç¨‹å¼ --&gt;<br>            &lt;el-button icon=&quot;el-icon-search&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p1&#x27;)&quot;&gt;&lt;/el-button&gt;<br>            &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p2&#x27;)&quot;&gt;&lt;/el-button&gt;<br>            &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-check&quot; circle size=&quot;mini&quot; @click=&quot;jump(&#x27;/c/p3&#x27;)&quot;&gt;&lt;/el-button&gt;<br>        &lt;/el-header&gt;<br>        &lt;el-container&gt;<br>            &lt;el-aside width=&quot;200px&quot;&gt;<br>                &lt;!-- æ ‡ç­¾å¼ --&gt;<br>                &lt;router-link to=&quot;/c/p1&quot;&gt;p1&lt;/router-link&gt;<br>                &lt;router-link to=&quot;/c/p2&quot;&gt;p2&lt;/router-link&gt;<br>                &lt;router-link to=&quot;/c/p3&quot;&gt;p3&lt;/router-link&gt;<br>            &lt;/el-aside&gt;<br>            &lt;el-main&gt;<br>                &lt;router-view&gt;&lt;/router-view&gt;<br>            &lt;/el-main&gt;<br>        &lt;/el-container&gt;<br>        &lt;/el-container&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>    const options = &#123;<br>        methods: &#123;<br>            jump(url) &#123;<br>                // æ ¹æ®è·¯å¾„è¿›è¡Œè·³è½¬<br>                this.$router.push(url);<br>            &#125;<br>        &#125;<br>    &#125;<br>    export default options;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h3><blockquote><p>ä»åç«¯åŠ¨æ€çš„è·å–è·¯ç”±ä¿¡æ¯æ·»åŠ åˆ°è·¯ç”±ä¸­</p></blockquote><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div class=&quot;login&quot;&gt;<br>        &lt;el-input v-model=&quot;username&quot; placeholder=&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot; size=&quot;mini&quot;&gt;&lt;/el-input&gt;<br>        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;login()&quot;&gt;ç™»å½•&lt;/el-button&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>    import axios from &#x27;../../utils/myaxios.js&#x27;<br>    import &#123;resetRouter&#125; from &#x27;@/router/example14&#x27;<br><br>    const options = &#123;<br>        data() &#123;<br>            return &#123;<br>                username: &#x27;admin&#x27;<br>            &#125;<br>        &#125;,<br>        methods: &#123;<br>            // å°†ç™»å½•ç”¨æˆ·å¯ä»¥è®¿é—®çš„è·¯å¾„æ·»åŠ åˆ°è·¯ç”±ä¸­<br>            async login() &#123;<br>                resetRouter();<br>                const resp = await axios.get(`/api/menu/$&#123;this.username&#125;`)<br>                for (const &#123;id, path, component&#125; of resp.data.data) &#123;<br>                    if (component !== null) &#123;<br>                        // åœ¨çˆ¶è·¯ç”±ä¸­æ·»åŠ è·¯ç”±<br>                        this.$router.addRoute(&#x27;c&#x27;, &#123;<br>                            path: path,<br>                            name: id,<br>                            component: () =&gt; import(`@/views/example14/container/$&#123;component&#125;`)<br>                        &#125;)<br>                    &#125;<br>                &#125;<br>                <br>                // æ‰“å°è·¯ç”±<br>                console.log(this.$router.getRoutes())<br>            &#125;<br>        &#125;<br><br>    &#125;<br><br>    export default options;<br>&lt;/script&gt;<br><br><br><br><br><br>&lt;style scoped&gt;<br>.login &#123;<br>    height: 100%;<br>    background-color: darkseagreen;<br>    /* background-image: url(&quot;data:image/svg+xml,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Ctext x=&#x27;15&#x27; y=&#x27;10&#x27; font-size=&#x27;14&#x27; font-family=&#x27;system-ui, sans-serif&#x27; text-anchor=&#x27;middle&#x27; dominant-baseline=&#x27;middle&#x27;%3Eç™»å½•%3C/text%3E%3C/svg%3E&quot;); */<br>&#125;<br><br>.el-input--mini &#123;<br>    width: 193px;<br>    margin: 10px 10px 0 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><strong>ä¿å­˜è·¯ç”±ä¿¡æ¯</strong></p><p>æ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œè·¯ç”±ä¿¡æ¯éƒ½ä¼šä¸¢å¤±</p><p>å°†è·¯ç”±æ•°æ®å­˜åˆ°localStorageæˆ–sessionStorageå¯ä»¥åœ¨æ¯æ¬¡åˆ·æ–°æ—¶æ¥æ¢å¤è·¯ç”±</p><p>routeræ–‡ä»¶ä¸­</p><blockquote><p>æŠ½å‡ºä¸¤ä¸ªæ–¹æ³•ï¼šé‡ç½®è·¯ç”±å’Œæ·»åŠ è·¯ç”±</p><p>è¿˜æœ‰æ¯æ¬¡è¿è¡Œæ—¶æŸ¥è¯¢ç¼“å­˜</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æŸ¥è¯¢sessionStorageä¸­æ˜¯å¦æœ‰ç¼“å­˜çš„è·¯ç”±ä¿¡æ¯</span><br><span class="hljs-keyword">const</span> serverRoutes = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;serverRoutes&#x27;</span>)<br><span class="hljs-keyword">if</span> (serverRoutes) &#123;<br>  <span class="hljs-keyword">const</span> array = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(serverRoutes)<br>  <span class="hljs-title function_">addServerRoutes</span>(array)<br>&#125;<br><br><br><span class="hljs-comment">// é‡ç½®è·¯ç”±ï¼Œæ–°å»ºä¸€ä¸ªè·¯ç”±ï¼ŒæŠŠç©ºçš„matcherèµ‹å€¼ç»™ç°åœ¨çš„è·¯ç”±</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">resetRouter</span>(<span class="hljs-params"></span>) &#123; <br>  router.<span class="hljs-property">matcher</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;routes&#125;).<span class="hljs-property">matcher</span><br>&#125;<br><br><span class="hljs-comment">// æ·»åŠ è·¯ç”±ä¿¡æ¯</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addServerRoutes</span>(<span class="hljs-params">array</span>) &#123;<br>  <span class="hljs-title function_">resetRouter</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> &#123;id, path, component&#125; <span class="hljs-keyword">of</span> array) &#123;<br>      <span class="hljs-keyword">if</span> (component !== <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-comment">// åœ¨çˆ¶è·¯ç”±ä¸­æ·»åŠ è·¯ç”±</span><br>          router.<span class="hljs-title function_">addRoute</span>(<span class="hljs-string">&#x27;c&#x27;</span>, &#123;<br>              <span class="hljs-attr">path</span>: path,<br>              <span class="hljs-attr">name</span>: id,<br>              <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">`@/views/example14/container/<span class="hljs-subst">$&#123;component&#125;</span>`</span>)<br>          &#125;)<br>      &#125;<br>  &#125;<br>                <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5.çº§è”é€‰æ‹©å™¨</title>
    <link href="/2022/10/07/%E5%89%8D%E7%AB%AF/elementUI/5.%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8/"/>
    <url>/2022/10/07/%E5%89%8D%E7%AB%AF/elementUI/5.%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="5-çº§è”é€‰æ‹©å™¨"><a href="#5-çº§è”é€‰æ‹©å™¨" class="headerlink" title="5.çº§è”é€‰æ‹©å™¨"></a>5.çº§è”é€‰æ‹©å™¨</h2><p><a href="https://element.eleme.cn/#/zh-CN/component/cascader#cascader-ji-lian-xuan-ze-qi">çº§è”é€‰æ‹©å™¨</a></p><p><strong>æ¡ˆä¾‹1</strong></p><ul><li>å°†é™æ€æ•°æ®å†™åˆ°çº§è”é€‰æ‹©å™¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-cascader :options=&quot;ops&quot;&gt;&lt;/el-cascader&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  // import axios from &#x27;../utils/myaxios&#x27;<br>  const options = &#123;<br>    data() &#123;<br>      return &#123;<br>        // é€šè¿‡childrenæ¥æ·»åŠ å­é€‰é¡¹,å¯åµŒå¥—å¤šå±‚<br>        ops: [<br>          &#123;value: 100, label: &#x27;ä¸»é¡µ&#x27;, children: [<br>            &#123;value: 101, label: &#x27;èœå•1&#x27;, children:[<br>              &#123;value: 102, label: &#x27;èœå•11&#x27;&#125;,<br>              &#123;value: 102, label: &#x27;èœå•12&#x27;&#125;,<br>            ]&#125;,<br>            &#123;value: 102, label: &#x27;èœå•2&#x27;&#125;,<br>            &#123;value: 103, label: &#x27;èœå•3&#x27;&#125;,<br>          ]&#125;<br>        ]<br>      &#125;<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8.png"></p><p><strong>æ¡ˆä¾‹2</strong></p><ul><li>å°†åç«¯æ•°æ®å†™åˆ°çº§è”é€‰æ‹©å™¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-cascader :options=&quot;ops&quot; clearable&gt;&lt;/el-cascader&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import axios from &#x27;../utils/myaxios&#x27;<br>  const options = &#123;<br>    data() &#123;<br>      return &#123;<br>        ops: []<br>      &#125;<br>    &#125;,<br><br>    // ç»„ä»¶åŠ è½½å®Œåå°†æ•°æ®å¡«å…¥<br>    async mounted() &#123;<br>      const resp = await axios.get(&#x27;/api/menu&#x27;)<br><br>      // å‰ç«¯å¤„ç†å‘æ¥çš„æ•°æ®<br>      const map = new Map()<br>      for (const &#123;id, name, pid&#125; of resp.data.data) &#123;<br>        // å°†æ•°æ®å­˜åˆ°mapä¸­<br>        map.set(id, &#123;value: id, label: name, pid: pid&#125;)<br>      &#125;<br>      const root = []<br>      for (const obj of map.values()) &#123;<br>        const parent = map.get(obj.pid) // è·å–çˆ¶æ ‡ç­¾<br>        if (parent !== undefined) &#123;<br>          parent.children ??= []<br>          parent.children.push(obj) // æ·»åŠ åˆ°çˆ¶æ ‡ç­¾é‡Œ<br>        &#125; else &#123;<br>          root.push(obj)  //æ²¡æœ‰çˆ¶æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾ä¸ºæ ¹æ ‡ç­¾<br>        &#125;<br>      &#125;<br>      this.ops = root<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A82.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4.æœç´¢</title>
    <link href="/2022/10/07/%E5%89%8D%E7%AB%AF/elementUI/4.%E6%90%9C%E7%B4%A2/"/>
    <url>/2022/10/07/%E5%89%8D%E7%AB%AF/elementUI/4.%E6%90%9C%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="4-æœç´¢"><a href="#4-æœç´¢" class="headerlink" title="4.æœç´¢"></a>4.æœç´¢</h2><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;!-- æœç´¢æ¡† --&gt;<br>    &lt;el-input placeholder=&quot;è¯·è¾“å…¥å§“å&quot; size=&quot;mini&quot; v-model=&quot;queryDto.name&quot;&gt;&lt;/el-input&gt;<br>    &lt;!-- ä¸‹æ‹‰æ¡† --&gt;<br>    &lt;el-select placeholder=&quot;è¯·é€‰æ‹©æ€§åˆ«&quot; size=&quot;mini&quot; v-model=&quot;queryDto.sex&quot; clearable&gt;<br>      &lt;el-option value=&quot;ç”·&quot;&gt;&lt;/el-option&gt;<br>      &lt;el-option value=&quot;å¥³&quot;&gt;&lt;/el-option&gt;<br>    &lt;/el-select&gt;<br>    &lt;el-select placeholder=&quot;è¯·é€‰æ‹©å¹´é¾„&quot; size=&quot;mini&quot; v-model=&quot;queryDto.age&quot; clearable&gt;<br>      &lt;el-option value=&quot;0,20&quot; label=&quot;0-20&quot;&gt;&lt;/el-option&gt;<br>      &lt;el-option value=&quot;21,30&quot; label=&quot;21-30&quot;&gt;&lt;/el-option&gt;<br>      &lt;el-option value=&quot;31,40&quot; label=&quot;31-40&quot;&gt;&lt;/el-option&gt;<br>      &lt;el-option value=&quot;41,120&quot; label=&quot;41-120&quot;&gt;&lt;/el-option&gt;<br>    &lt;/el-select&gt;<br><br>    &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;search&quot;&gt;æœç´¢&lt;/el-button&gt;<br><br>    &lt;el-table :data=&quot;students&quot;&gt;<br>      &lt;!-- idæ˜¯studentsçš„å±æ€§ --&gt;<br>      &lt;el-table-column lable=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br><br>    &lt;!-- æ€»è®°å½•æ•°ï¼Œæ¯é¡µå¤§å°ï¼Œå½“å‰é¡µ, ç»„ä»¶å¸ƒå±€ --&gt;<br>    &lt;!-- æ”¹å˜å½“å‰é¡µæ—¶è§¦å‘ï¼Œæ”¹å˜é¡µå¤§å°æ—¶è§¦å‘ --&gt;<br>    &lt;el-pagination <br>        :total=&quot;total&quot;     <br>        :page-size=&quot;queryDto.size&quot;<br>        :page-sizes=&quot;[5, 10]&quot;<br>        :current-page=&quot;queryDto.page&quot;<br>        layout=&quot;prev, pager, next, jumper, sizes, -&gt;, total&quot;<br>        @current-change=&quot;currentChange&quot;<br>        @size-change=&quot;sizeChange&quot;<br>    &gt;&lt;/el-pagination&gt;<br><br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  import axios from &#x27;../utils/myaxios&#x27;<br>  const options = &#123;<br>    data() &#123;<br>      return &#123;<br>        students: [],<br>        total: 0,<br>        // æŸ¥è¯¢æ¡ä»¶<br>        queryDto: &#123;<br>          page: 1,<br>          size: 5,<br>          name: &#x27;&#x27;,<br>          sex: &#x27;&#x27;,<br>          age: &#x27;&#x27;<br>        &#125;<br>      &#125;<br>    &#125;,<br><br>    // é’©å­å‡½æ•°, æ•°æ®æŒ‚è½½å, è§†å›¾çš„æ•°æ®è¢«Vueçš„æ›¿æ¢<br>    mounted() &#123;<br>      // å‘é€è¯·æ±‚ï¼Œè¿”å›å­¦ç”Ÿæ•°æ®<br>      this.query();<br>    &#125;,<br><br>    methods: &#123;<br>      // ä¼šè¿”å›é¡µå·<br>      currentChange(page) &#123;<br>        this.queryDto.page = page<br>        this.query();<br>      &#125;,<br><br>      // è¿”å›é¡µé¢å¤§å°<br>      sizeChange(size) &#123;<br>        this.queryDto.size = size<br>        this.query();<br>      &#125;,<br><br>      search() &#123;<br>        this.query()<br>      &#125;,<br><br>      // é€šè¿‡æ­¤æ–¹æ³•å‘é€è¯·æ±‚<br>      async query() &#123;<br>        const resp = await axios.get(&#x27;/api/students/q&#x27;, &#123;<br>          params: this.queryDto<br>        &#125;)<br>        //console.log(resp)<br>        this.students = resp.data.data.list<br>        this.total = resp.data.data.total<br>      &#125;<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>  .el-input--mini,<br>  .el-search--mini &#123;<br>    width: 193px;<br>    margin: 10px 10px 0 0;<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E6%90%9C%E7%B4%A2.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3.åˆ†é¡µç»„ä»¶</title>
    <link href="/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/3.%E5%88%86%E9%A1%B5%E7%BB%84%E4%BB%B6/"/>
    <url>/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/3.%E5%88%86%E9%A1%B5%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="3-åˆ†é¡µæ¡ç»„ä»¶"><a href="#3-åˆ†é¡µæ¡ç»„ä»¶" class="headerlink" title="3.åˆ†é¡µæ¡ç»„ä»¶"></a>3.åˆ†é¡µæ¡ç»„ä»¶</h2><p><a href="https://element.eleme.cn/#/zh-CN/component/pagination#pagination-fen-ye">åˆ†é¡µæ¡ç»„ä»¶</a></p><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-table :data=&quot;students&quot;&gt;<br>      &lt;!-- idæ˜¯studentsçš„å±æ€§ --&gt;<br>      &lt;el-table-column lable=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br><br>    &lt;!-- æ€»è®°å½•æ•°ï¼Œæ¯é¡µå¤§å°ï¼Œå½“å‰é¡µ, ç»„ä»¶å¸ƒå±€ --&gt;<br>    &lt;!-- æ”¹å˜å½“å‰é¡µæ—¶è§¦å‘ï¼Œæ”¹å˜é¡µå¤§å°æ—¶è§¦å‘ --&gt;<br>    &lt;el-pagination <br>        :total=&quot;total&quot;     <br>        :page-size=&quot;queryDto.size&quot;<br>        :page-sizes=&quot;[5, 10]&quot;<br>        :current-page=&quot;queryDto.page&quot;<br>        layout=&quot;prev, pager, next, jumper, sizes, -&gt;, total&quot;<br>        @current-change=&quot;currentChange&quot;<br>        @size-change=&quot;sizeChange&quot;<br>    &gt;&lt;/el-pagination&gt;<br><br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  import axios from &#x27;../utils/myaxios&#x27;<br>  const options = &#123;<br>    data() &#123;<br>      return &#123;<br>        students: [],<br>        total: 0,<br>        // æŸ¥è¯¢æ¡ä»¶<br>        queryDto: &#123;<br>          page: 1,<br>          size: 10,<br>        &#125;<br>      &#125;<br>    &#125;,<br><br>    // é’©å­å‡½æ•°, æ•°æ®æŒ‚è½½å, è§†å›¾çš„æ•°æ®è¢«Vueçš„æ›¿æ¢<br>    mounted() &#123;<br>      // å‘é€è¯·æ±‚ï¼Œè¿”å›å­¦ç”Ÿæ•°æ®<br>      this.query();<br>    &#125;,<br><br>    methods: &#123;<br>      // ä¼šè¿”å›é¡µå·<br>      currentChange(page) &#123;<br>        this.queryDto.page = page<br>        this.query();<br>      &#125;,<br><br>      // è¿”å›é¡µé¢å¤§å°<br>      sizeChange(size) &#123;<br>        this.queryDto.size = size<br>        this.query();<br>      &#125;,<br><br>      // é€šè¿‡æ­¤æ–¹æ³•å‘é€è¯·æ±‚<br>      async query() &#123;<br>        const resp = await axios.get(&#x27;/api/students/q&#x27;, &#123;<br>          params: this.queryDto<br>        &#125;)<br>        //console.log(resp)<br>        this.students = resp.data.data.list<br>        this.total = resp.data.data.total<br>      &#125;<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E5%88%86%E9%A1%B5%E6%9D%A1%E7%BB%84%E4%BB%B6.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2.è¡¨æ ¼ç»„ä»¶</title>
    <link href="/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/2.%E8%A1%A8%E6%A0%BC%E7%BB%84%E4%BB%B6/"/>
    <url>/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/2.%E8%A1%A8%E6%A0%BC%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="2-è¡¨æ ¼ç»„ä»¶"><a href="#2-è¡¨æ ¼ç»„ä»¶" class="headerlink" title="2.è¡¨æ ¼ç»„ä»¶"></a>2.è¡¨æ ¼ç»„ä»¶</h2><p><a href="https://element.eleme.cn/#/zh-CN/component/table#table-biao-ge">è¡¨æ ¼ç»„ä»¶</a></p><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-table :data=&quot;students&quot;&gt;<br>      &lt;!-- idã€nameç­‰æ˜¯studentsçš„å±æ€§ --&gt;<br>      &lt;el-table-column lable=&quot;ç¼–å·&quot; prop=&quot;id&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å§“å&quot; prop=&quot;name&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;æ€§åˆ«&quot; prop=&quot;sex&quot;&gt;&lt;/el-table-column&gt;<br>      &lt;el-table-column lable=&quot;å¹´é¾„&quot; prop=&quot;age&quot;&gt;&lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  import axios from &#x27;../utils/myaxios&#x27;<br>  const options = &#123;<br>    data() &#123;<br>      return &#123;<br>        students: []<br>      &#125;<br>    &#125;,<br>    // é’©å­å‡½æ•°, æ•°æ®æŒ‚è½½å, è§†å›¾çš„æ•°æ®è¢«Vueçš„æ›¿æ¢<br>    async mounted() &#123;<br>      // å‘é€è¯·æ±‚ï¼Œè¿”å›å­¦ç”Ÿæ•°æ®<br>      const resp = await axios.get(&#x27;/api/students&#x27;)<br>      this.students = resp.data.data<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/qianduan_img/el%E8%A1%A8%E6%A0%BC%E7%BB%84%E4%BB%B6.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1.elementUIå®‰è£…</title>
    <link href="/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/1.elementUI%E5%AE%89%E8%A3%85/"/>
    <url>/2022/10/06/%E5%89%8D%E7%AB%AF/elementUI/1.elementUI%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="1-elementUIå®‰è£…"><a href="#1-elementUIå®‰è£…" class="headerlink" title="1.elementUIå®‰è£…"></a>1.elementUIå®‰è£…</h2><blockquote><p>Elementï¼Œä¸€å¥—ä¸ºå¼€å‘è€…ã€è®¾è®¡å¸ˆå’Œäº§å“ç»ç†å‡†å¤‡çš„åŸºäº Vue 2.0 çš„æ¡Œé¢ç«¯ç»„ä»¶åº“</p></blockquote><p><strong>å®‰è£…</strong></p><blockquote><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">npm install element-ui -S<br></code></pre></td></tr></table></figure><p><strong>å¼•å…¥ç»„ä»¶</strong></p><blockquote><p>åœ¨main.jsæ–‡ä»¶ä¸‹</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// å¯¼å…¥elementuiç»„ä»¶</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Element</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span><br><br><span class="hljs-comment">// å…¨å±€å¯¼å…¥</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Element</span>)<br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-button&gt;æŒ‰é’®&lt;/el-button&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  const options = &#123;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>ElementUI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>8.é‡ç”¨ç»„ä»¶</title>
    <link href="/2022/10/06/%E5%89%8D%E7%AB%AF/vue/8.%E9%87%8D%E7%94%A8%E7%BB%84%E4%BB%B6/"/>
    <url>/2022/10/06/%E5%89%8D%E7%AB%AF/vue/8.%E9%87%8D%E7%94%A8%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="8-é‡ç”¨ç»„ä»¶"><a href="#8-é‡ç”¨ç»„ä»¶" class="headerlink" title="8.é‡ç”¨ç»„ä»¶"></a>8.é‡ç”¨ç»„ä»¶</h2><p><strong>æ¡ˆä¾‹</strong></p><p>å­ç»„ä»¶</p><blockquote><p>ç¼–å†™äº†ä¸€äº›cssæ ·å¼</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br><br>    &lt;div class=&quot;button&quot; :class=&quot;[type, size]&quot;&gt;<br>        &lt;!-- æ’æ§½ï¼Œä¼šå°†çˆ¶æ ‡ç­¾çš„æœ¬æ–‡å¡«å……åˆ°é‡Œé¢ --&gt;<br>        &lt;slot&gt;&lt;/slot&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    const options = &#123;<br>        // çˆ¶ç»„ä»¶ä½¿ç”¨æ—¶å¯ä»¥æ·»åŠ çš„å±æ€§<br>        props: [&quot;type&quot;, &quot;size&quot;]<br>    &#125;<br>    export default options;<br>&lt;/script&gt;<br><br>&lt;!-- ä½¿ç”¨scopedå¯ä»¥è®©CSSæ ·å¼åªå¯¹å±€éƒ¨å…ƒç´ ç”Ÿæ•ˆ --&gt;<br>&lt;style scoped&gt;<br>.button &#123;<br>    display: inline-block;<br>    text-align: center;<br>    border-radius: 30px;<br>    margin: 5px;<br>    font: bold 12px/25px Arial, sans-serif;<br>    padding: 0 2px;<br>    text-shadow: 1px 1px 1px rgba(255, 255, 255, .22);<br>    box-shadow: 1px 1px 1px rgba(0, 0, 0, .29), inset 1px 1px 1px rgba(255, 255, 255, .44);<br>    transition: all 0.15s ease;<br>&#125;<br><br>.button:hover &#123;<br>    box-shadow: 1px 1px 1px rgba(0, 0, 0, .29), inset 1px 1px 2px rgba(0, 0, 0, .5);<br>&#125;<br><br>.button:active &#123;<br>    box-shadow: inset 1px 1px 2px rgba(0, 0, 0, .8);<br>&#125;<br><br>.primary &#123;<br>    background-color: #1d6ef9;<br>    color: #b5e3f1;<br>&#125;<br><br>.danger &#123;<br>    background-color: rgb(196, 50, 50);<br>    color: white;<br>&#125;<br><br>.success &#123;<br>    background-color: #a5cd4e;<br>    ;<br>    color: #3e5706;<br>&#125;<br><br>.small &#123;<br>    width: 40px;<br>    height: 20px;<br>    font-size: 10px;<br>    line-height: 20px;<br>&#125;<br><br>.middle &#123;<br>    width: 50px;<br>    height: 25px;<br>    font-size: 14px;<br>    line-height: 25px;<br>&#125;<br><br>.large &#123;<br>    width: 60px;<br>    height: 30px;<br>    font-size: 18px;<br>    line-height: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>çˆ¶ç»„ä»¶</p><blockquote><p>è°ƒç”¨å­ç»„ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;h1&gt;çˆ¶ç»„ä»¶&lt;/h1&gt;<br>    &lt;!-- ä½¿ç”¨å­ç»„ä»¶ --&gt;<br>    &lt;my-button type=&quot;primary&quot; size=&quot;small&quot;&gt;1&lt;/my-button&gt;<br>    &lt;my-button type=&quot;danger&quot; size=&quot;middle&quot;&gt;2&lt;/my-button&gt;<br>    &lt;my-button type=&quot;success&quot; size=&quot;large&quot;&gt;3&lt;/my-button&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  // å¯¼å…¥å­ç»„ä»¶<br>  import myButton from &#x27;../components/MyButton.vue&#x27;<br>  const options = &#123;<br>    // æ·»åŠ è¦ä½¿ç”¨çš„å­ç»„ä»¶<br>    components: &#123;<br>      myButton<br>    &#125;<br>  &#125;<br>  export default options<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>  div &#123;<br>    background-color: gainsboro;<br>    widows: 100px;<br>    height: 400px;<br>  &#125;<br>  h1 &#123;<br>    font-family: åæ–‡è¡Œæ¥·;<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>axios API</title>
    <link href="/2022/10/05/%E5%89%8D%E7%AB%AF/api/axios-API/"/>
    <url>/2022/10/05/%E5%89%8D%E7%AB%AF/api/axios-API/</url>
    
    <content type="html"><![CDATA[<h2 id="axios-API"><a href="#axios-API" class="headerlink" title="axios API"></a>axios API</h2><blockquote><p>axios çš„åº•å±‚æ˜¯ç”¨äº† XMLHttpRequestï¼ˆxhrï¼‰æ–¹å¼å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ï¼Œ</p><p>xhr ç›¸å¯¹äºä¹‹å‰è®²è¿‡çš„ fetch api æ¥è¯´ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œ</p><p>ä½†ç”±äºæ˜¯æ¯”è¾ƒè€çš„ apiï¼Œä¸æ”¯æŒ Promiseï¼Œaxios å¯¹ xhr è¿›è¡Œäº†å°è£…ï¼Œä½¿ä¹‹æ”¯æŒ Promiseï¼Œå¹¶æä¾›äº†å¯¹è¯·æ±‚ã€å“åº”çš„ç»Ÿä¸€æ‹¦æˆªåŠŸèƒ½</p></blockquote><h3 id="é€šè¿‡npmå®‰è£…"><a href="#é€šè¿‡npmå®‰è£…" class="headerlink" title="é€šè¿‡npmå®‰è£…"></a>é€šè¿‡npmå®‰è£…</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>åœ¨é¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸‹<br>npm install axios -S<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œåä¼šåœ¨é¡¹ç›®çš„node-modulesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºaxiosæ–‡ä»¶å¤¹ï¼Œå’Œåœ¨package.jsonæ–‡ä»¶ä¸­å¯¼å…¥axiosä¾èµ–</p><h3 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h3><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;input type=&quot;button&quot; value=&quot;è·å–è¿œç¨‹æ•°æ®&quot; @click=&quot;sendReq()&quot;&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    // ä½¿ç”¨å‰å…ˆå¯¼å…¥<br>    import axios from &#x27;axios&#x27;<br>    // axios<br>    const option = &#123;<br>        methods: &#123;<br>            async sendReq() &#123;<br>                // é€šè¿‡axioså‘é€åŒæ­¥getè¯·æ±‚<br>                const resp = await axios.get(&quot;/api/students&quot;)<br>                console.log(resp)<br>            &#125;<br>        &#125;<br>    &#125;<br>    export default option<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h3><table><thead><tr><th>è¯·æ±‚</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>axios.get(url[, config])</strong></td><td></td></tr><tr><td>axios.delete(url[, config])</td><td></td></tr><tr><td>axios.head(url[, config])</td><td></td></tr><tr><td>axios.options(url[, config])</td><td></td></tr><tr><td><strong>axios.post(url[, data[, config]])</strong></td><td></td></tr><tr><td>axios.put(url[, data[, config]])</td><td></td></tr><tr><td>axios.patch(url[, data[, config]])</td><td></td></tr></tbody></table><p><strong>æ¡ˆä¾‹</strong></p><p>åç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xw.controller;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxiosController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/api/a1&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;get request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a2&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a2</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a3&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a3</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(&quot;Authorization&quot;)</span> String authorization)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;authorization å¤´ &quot;</span> + authorization);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a4&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a4</span><span class="hljs-params">(String name, Integer age)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + name + <span class="hljs-string">&quot; age:&quot;</span> + age);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a5&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a5</span><span class="hljs-params">(A5 a5)</span> &#123;<br>        System.out.println(a5);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a5json&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a5json</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> A5 a5)</span> &#123;<br>        System.out.println(a5);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a6set&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a6set</span><span class="hljs-params">(HttpSession session)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;========== a6 set ==========&quot;</span>);<br>        System.out.println(session.getId());<br>        session.setAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a6get&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a6get</span><span class="hljs-params">(HttpSession session)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;========== a6 get ==========&quot;</span>);<br>        System.out.println(session.getId());<br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + session.getAttribute(<span class="hljs-string">&quot;name&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>å‰ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>    &lt;div&gt;<br>        &lt;input type=&quot;button&quot; value=&quot;è·å–è¿œç¨‹æ•°æ®&quot; @click=&quot;sendReq()&quot;&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>    // ä½¿ç”¨å‰å…ˆå¯¼å…¥<br>    import axios from &#x27;axios&#x27;<br>    // axios<br>    const option = &#123;<br>        methods: &#123;<br>            async sendReq() &#123;<br>                // 1.é€šè¿‡axioså‘é€åŒæ­¥getè¯·æ±‚<br>                // const resp = await axios.get(&quot;/api/a1&quot;)<br><br>                // 2.é€šè¿‡axioså‘é€åŒæ­¥postè¯·æ±‚<br>                // const resp = await axios.post(&quot;/api/a2&quot;)<br><br>                // 3.axiosè¯·æ±‚ä¸­æ·»åŠ è¯·æ±‚å¤´ï¼ˆurlï¼Œè¯·æ±‚ä½“æ•°æ®ï¼Œé€‰é¡¹å¯¹è±¡ï¼‰<br>                // const resp = await axios.post(&quot;/api/a3&quot;, &#123;&#125;, &#123;<br>                //     headers: &#123;<br>                //         Authorization: &#x27;abc&#x27;<br>                //     &#125;<br>                // &#125;)<br><br>                // 4.1axiosè¯·æ±‚ä¸­æºå¸¦å‚æ•°ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰<br>                // const name = encodeURIComponent(&#x27;!@#%$&#x27;) //ç¼–ç åå‘é€<br>                // const age = 20<br>                // const resp = await axios.post(`/api/a4?name=$&#123;name&#125;&amp;age=$&#123;age&#125;`)<br><br>                // // 4.axiosè¯·æ±‚ä¸­æºå¸¦å‚æ•°ï¼ˆé€‰é¡¹å¯¹è±¡ï¼‰<br>                // const resp = await axios.post(&#x27;/api/a4&#x27;, &#123;&#125;, &#123;<br>                //     params: &#123;<br>                //         name: &#x27;!@#%$&#x27;,  //ä¼šè‡ªåŠ¨ç¼–ç <br>                //         age: 20<br>                //     &#125;<br>                // &#125;)<br><br>                // 4.2axiosè¯·æ±‚ä¸­æºå¸¦å‚æ•°ï¼ˆè¯·æ±‚ä½“jsonï¼‰<br>                // è¯·æ±‚ä½“ä¸­çš„æ˜¯jsonæ ¼å¼ï¼Œåç«¯æ˜¯é€šè¿‡å‚æ•°åæ¥æ”¶ï¼Œæ•…ä¸èƒ½ç›´æ¥å†™åœ¨å‚æ•°é‡Œ<br>                // const params = new URLSearchParams()    // é€šè¿‡URLSearchParamså°è£…å‚æ•°<br>                // params.append(&quot;name&quot;, &quot;å¼ ä¸‰&quot;)<br>                // params.append(&quot;age&quot;, 20)<br>                // const resp = await axios.post(&#x27;/api/a4&#x27;, params)<br><br>                // 4.3axiosè¯·æ±‚ä¸­æºå¸¦å‚æ•°ï¼ˆè¯·æ±‚ä½“multipartï¼‰<br>                // const params = new FormData()    // é€šè¿‡FormDataå°è£…å‚æ•°<br>                // params.append(&quot;name&quot;, &quot;å¼ ä¸‰&quot;)<br>                // params.append(&quot;age&quot;, 21)<br>                // const resp = await axios.post(&#x27;/api/a5&#x27;, params)<br><br>                // 4.4axiosè¯·æ±‚ä¸­æºå¸¦å‚æ•°ï¼ˆè¯·æ±‚ä½“json, åç«¯ç”¨å¯¹è±¡æ¥æ”¶ï¼‰<br>                // è‡ªåŠ¨é€šè¿‡JSON.stringifyè½¬æ¢ä¸ºjson<br>                const resp = await axios.post(&#x27;/api/a5json&#x27;, &#123;<br>                    name: &#x27;æå››&#x27;,<br>                    age: 21<br>                &#125;)<br><br>                console.log(resp)<br>            &#125;<br>        &#125;<br>    &#125;<br>    export default option<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="axiosé…ç½®"><a href="#axiosé…ç½®" class="headerlink" title="axiosé…ç½®"></a>axiosé…ç½®</h3><p>å¸¸è§configé…ç½®</p><table><thead><tr><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>baseURL</td><td>å°†è‡ªåŠ¨åŠ åœ¨ url å‰é¢</td></tr><tr><td>headers</td><td>è¯·æ±‚å¤´ï¼Œç±»å‹ä¸ºç®€å•å¯¹è±¡</td></tr><tr><td>params</td><td>è·Ÿåœ¨ URL åçš„è¯·æ±‚å‚æ•°ï¼Œç±»å‹ä¸ºç®€å•å¯¹è±¡æˆ– URLSearchParams</td></tr><tr><td>data</td><td>è¯·æ±‚ä½“ï¼Œç±»å‹æœ‰ç®€å•å¯¹è±¡ã€FormDataã€URLSearchParamsã€File ç­‰</td></tr><tr><td>withCredentials</td><td>è·¨åŸŸæ—¶æ˜¯å¦æºå¸¦ Cookie ç­‰å‡­è¯ï¼Œé»˜è®¤ä¸º false</td></tr><tr><td>responseType</td><td>å“åº”ç±»å‹ï¼Œé»˜è®¤ä¸º json</td></tr></tbody></table><p><strong>æ¡ˆä¾‹</strong></p><p>åç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-comment">//å¼€å¯è·¨åŸŸå’Œå…è®¸æºå¸¦å‡­è¯</span><br><span class="hljs-meta">@CrossOrigin(value = &quot;http://localhost:7070&quot;, allowCredentials = &quot;true&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AxiosController</span> &#123;<br>    <span class="hljs-meta">@PostMapping(&quot;/api/a6set&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a6set</span><span class="hljs-params">(HttpSession session)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;========== a6 set ==========&quot;</span>);<br>        System.out.println(session.getId());<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            æ¨¡æ‹Ÿç™»å½•ï¼Œå°†ç”¨æˆ·åå­˜å…¥session</span><br><span class="hljs-comment">        */</span><br>        session.setAttribute(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/api/a6get&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">a6get</span><span class="hljs-params">(HttpSession session)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;========== a6 get ==========&quot;</span>);<br>        System.out.println(session.getId());<br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + session.getAttribute(<span class="hljs-string">&quot;name&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;post request&quot;</span>;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p> å‰ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>    // ä½¿ç”¨å‰å…ˆå¯¼å…¥<br>    import axios from &#x27;axios&#x27;<br>    // axios<br>    const option = &#123;<br>        methods: &#123;<br>            async sendReq() &#123;                <br>                // axiosé…ç½®<br>                const _axios = axios.create(&#123;<br>                    // ä¼šè¢«æ·»åŠ åœ¨æ¯ä¸ªè¯·æ±‚urlå‰<br>                    baseURL: &#x27;http://localhost:8080&#x27;,<br>                    // è·¨åŸŸæ—¶æ˜¯å¦æºå¸¦ Cookie ç­‰å‡­è¯ï¼Œé»˜è®¤ä¸º false<br>                    withCredentials: true<br>                &#125;)<br>                await _axios.post(&#x27;/api/a6set&#x27;, &#123;&#125;)<br>                await _axios.post(&#x27;/api/a6get&#x27;, &#123;&#125;)<br>            &#125;<br>        &#125;<br>    &#125;<br>    export default option<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="å“åº”æ ¼å¼"><a href="#å“åº”æ ¼å¼" class="headerlink" title="å“åº”æ ¼å¼"></a>å“åº”æ ¼å¼</h3><table><thead><tr><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>data</td><td>å“åº”ä½“æ•°æ® :star:</td></tr><tr><td>status</td><td>çŠ¶æ€ç  :star:</td></tr><tr><td>headers</td><td>å“åº”å¤´</td></tr></tbody></table><ul><li>200 è¡¨ç¤ºå“åº”æˆåŠŸ</li><li>400 è¯·æ±‚æ•°æ®ä¸æ­£ç¡® age&#x3D;abc</li><li>401 èº«ä»½éªŒè¯æ²¡é€šè¿‡</li><li>403 æ²¡æœ‰æƒé™</li><li>404 èµ„æºä¸å­˜åœ¨</li><li>405 ä¸æ”¯æŒè¯·æ±‚æ–¹å¼ post</li><li>500 æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</li></ul><h3 id="axiosæ‹¦æˆªå™¨"><a href="#axiosæ‹¦æˆªå™¨" class="headerlink" title="axiosæ‹¦æˆªå™¨"></a>axiosæ‹¦æˆªå™¨</h3><p><strong>è¯·æ±‚æ‹¦æˆª</strong></p><p>æ¡ˆä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">const _axios = axios.create(&#123;<br>    // ä¼šè¢«æ·»åŠ åœ¨æ¯ä¸ªè¯·æ±‚urlå‰<br>    baseURL: &#x27;http://localhost:8080&#x27;,<br>    // è·¨åŸŸæ—¶æ˜¯å¦æºå¸¦ Cookie ç­‰å‡­è¯ï¼Œé»˜è®¤ä¸º false<br>    withCredentials: true<br>&#125;)<br>// è¯·æ±‚æ‹¦æˆªå™¨<br>_axios.interceptors.request.use(<br>// è¯·æ±‚æ­£å¸¸æ—¶<br>    function (config) &#123;<br>// ç»™æ¯ä¸ªè¯·æ±‚éƒ½æ·»åŠ å¤´Authorization<br>        config.headers = &#123;<br>        Authorization: &#x27;aaa.bbb.ccc&#x27;<br>    &#125;<br>    return config<br>    &#125;,<br>// è¯·æ±‚é”™è¯¯æ—¶<br>    function (error) &#123;<br>        return Promise.reject(error);<br>    &#125;<br>)<br>_axios.get(&quot;/api/students&quot;)<br></code></pre></td></tr></table></figure><p><strong>å“åº”æ‹¦æˆªå™¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">// å“åº”æ‹¦æˆªå™¨<br>_axios.interceptors.response.use(<br>    // å“åº”ç åœ¨200ä¹‹å†…<br>    function (response) &#123;<br>        console.log(&#x27;å“åº”æ­£å¸¸&#x27;)<br>        return response<br>&#125;,<br>    // å“åº”ç å¤§äº200æ—¶<br>    function (error) &#123;<br>        if (error.response.status === 400) &#123;<br>        console.log(&#x27;è¯·æ±‚å‚æ•°é”™è¯¯&#x27;)<br>        &#125; else if (error.response.status === 500) &#123;<br>        console.log(&#x27;æœåŠ¡å™¨é”™è¯¯&#x27;)<br>        &#125; else if (error.response.status === 404) &#123;<br>        console.log(&#x27;èµ„æºæœªæ‰¾åˆ°&#x27;)<br>        &#125; else &#123;<br>        console.log(&#x27;æœªçŸ¥é”™è¯¯&#x27;)<br>        &#125;<br>        return Promise.reject(error)<br>&#125;<br>)<br>_axios.get(&quot;/api/students&quot;)<br></code></pre></td></tr></table></figure><p>å¯ä»¥å°†é…ç½®å¥½çš„axiosæŠ½å‡ºæ¥æˆä¸ºä¸€ä¸ªå·¥å…·ç±»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vue">// axioså·¥å…·ç±»<br>import axios from &#x27;axios&#x27;<br><br>// é…ç½®<br>const _axios = axios.create(&#123;<br>    baseURL: &#x27;http://localhost:8080&#x27;,<br>    withCredentials: true<br>&#125;)<br><br>// è¯·æ±‚æ‹¦æˆªå™¨<br>_axios.interceptors.request.use(<br>    function (config) &#123;<br>        config.headers = &#123;<br>            Authorization: &#x27;aaa.bbb.ccc&#x27;<br>        &#125;<br>        return config<br>    &#125;,<br>    function (error) &#123;<br>        return Promise.reject(error);<br>    &#125;<br>)<br><br>// å“åº”æ‹¦æˆªå™¨<br>_axios.interceptors.response.use(<br>    // å“åº”ç åœ¨200ä¹‹å†…<br>    function (response) &#123;<br>        console.log(&#x27;å“åº”æ­£å¸¸&#x27;)<br>        return response<br>    &#125;,<br>    // å“åº”ç å¤§äº200æ—¶<br>    function (error) &#123;<br>        if (error.response.status === 400) &#123;<br>            console.log(&#x27;è¯·æ±‚å‚æ•°é”™è¯¯&#x27;)<br>        &#125; else if (error.response.status === 500) &#123;<br>            console.log(&#x27;æœåŠ¡å™¨é”™è¯¯&#x27;)<br>        &#125; else if (error.response.status === 404) &#123;<br>            console.log(&#x27;èµ„æºæœªæ‰¾åˆ°&#x27;)<br>        &#125; else &#123;<br>            console.log(&#x27;æœªçŸ¥é”™è¯¯&#x27;)<br>        &#125;<br>        return Promise.reject(error)<br>    &#125;<br>)<br><br>export default _axios<br></code></pre></td></tr></table></figure><p>ç”¨çš„æ—¶å€™å¯¼å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br>    // å¯¼å…¥è‡ªå·±é…ç½®å¥½çš„axios<br>    import _axios from &#x27;../utils/myaxios&#x27;<br>    const option = &#123;<br>        methods: &#123;<br>            async sendReq() &#123;<br>                const resp = await _axios.get(&#x27;/api/students&#x27;)<br>                console.log(resp)<br>            &#125;<br>        &#125;<br>    &#125;<br>    export default option<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>API</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fetch API</title>
    <link href="/2022/10/04/%E5%89%8D%E7%AB%AF/api/FetchAPI/"/>
    <url>/2022/10/04/%E5%89%8D%E7%AB%AF/api/FetchAPI/</url>
    
    <content type="html"><![CDATA[<h2 id="Fetch-API"><a href="#Fetch-API" class="headerlink" title="Fetch API"></a>Fetch API</h2><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API</a> æä¾›äº†ä¸€ä¸ª JavaScript æ¥å£ï¼Œç”¨äºè®¿é—®å’Œæ“çºµ HTTP ç®¡é“çš„ä¸€äº›å…·ä½“éƒ¨åˆ†ï¼Œä¾‹å¦‚è¯·æ±‚å’Œå“åº”ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªå…¨å±€ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/fetch"><code>fetch()</code></a> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æä¾›äº†ä¸€ç§ç®€å•ï¼Œåˆç†çš„æ–¹å¼æ¥è·¨ç½‘ç»œå¼‚æ­¥è·å–èµ„æºã€‚</p></blockquote><h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch()"></a>fetch()</h3><blockquote><p>ç”¨äºå‘èµ·è·å–èµ„æºçš„è¯·æ±‚ã€‚å®ƒè¿”å›ä¸€ä¸ª promiseï¼Œè¿™ä¸ª promise ä¼šåœ¨è¯·æ±‚å“åº”åè¢« resolveï¼Œå¹¶ä¼ å› Response å¯¹è±¡ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">fetch</span>(url[, init])<span class="hljs-comment">//initï¼šå¯¹è¯·æ±‚çš„è®¾ç½®</span><br></code></pre></td></tr></table></figure><h3 id="åŒæ­¥æ–¹å¼æ¥æ”¶å“åº”"><a href="#åŒæ­¥æ–¹å¼æ¥æ”¶å“åº”" class="headerlink" title="åŒæ­¥æ–¹å¼æ¥æ”¶å“åº”"></a>åŒæ­¥æ–¹å¼æ¥æ”¶å“åº”</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> ç»“æœ = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span><span class="hljs-comment">//ä¼šé˜»å¡ä¹‹åçš„ä»£ç ï¼Œç›´åˆ°æ¥æ”¶åˆ°å“åº”ç»“æœ</span><br></code></pre></td></tr></table></figure><ul><li>await å…³é”®å­—å¿…é¡»åœ¨ä¸€ä¸ªæ ‡è®°äº† async çš„ function å†…æ¥ä½¿ç”¨</li></ul><p><strong>æ¡ˆä¾‹</strong></p><blockquote><p>å‰é¢çš„éƒ¨åˆ†</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>å­¦ç”Ÿåˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;thead&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row bold&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>ç¼–å·<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>æ€§åˆ«<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tbody&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tp&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>åŒæ­¥æ¥æ”¶æ•°æ®ï¼Œå¹¶å†™åˆ°htmlè¡¨å•é‡Œ</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">findStudents</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// å‘students.jsonå‘é€requestè¯·æ±‚</span><br>        <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;students.json&#x27;</span>)<br>        <span class="hljs-comment">// è·å–å“åº”ä½“ï¼ŒæŒ‰jsonæ–¹å¼è§£æ</span><br>        <span class="hljs-keyword">const</span> array = <span class="hljs-keyword">await</span> resp.<span class="hljs-title function_">json</span>();<span class="hljs-comment">//.jsonè¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªPromise</span><br><br>        <span class="hljs-comment">// è·å–æ¨¡æ¿</span><br>        <span class="hljs-keyword">const</span> tp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;tp&quot;</span>);<br>        <span class="hljs-keyword">const</span> row = tp.<span class="hljs-property">content</span>;<br><br>        <span class="hljs-comment">// å°†æ•°æ®å¡«å…¥æ¨¡æ¿ï¼Œå¹¶å¤åˆ¶åˆ°è¦æ˜¾ç¤ºçš„æ–‡æœ¬ä¸­</span><br>        <span class="hljs-keyword">const</span> [c1, c2, c3, c4] = row.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&quot;.col&quot;</span>);<br>        <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.tbody&#x27;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> &#123;id, name, sex, age&#125; <span class="hljs-keyword">of</span> array) &#123;<br>            c1.<span class="hljs-property">textContent</span> = id;<br>            c2.<span class="hljs-property">textContent</span> = name;<br>            c3.<span class="hljs-property">textContent</span> = sex;<br>            c4.<span class="hljs-property">textContent</span> = age;<br><br>            <span class="hljs-keyword">const</span> newRow = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">importNode</span>(row, <span class="hljs-literal">true</span>);<br>            tbody.<span class="hljs-title function_">appendChild</span>(newRow);<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_">findStudents</span>();<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="å¼‚æ­¥æ–¹å¼æ¥æ”¶å“åº”"><a href="#å¼‚æ­¥æ–¹å¼æ¥æ”¶å“åº”" class="headerlink" title="å¼‚æ­¥æ–¹å¼æ¥æ”¶å“åº”"></a>å¼‚æ­¥æ–¹å¼æ¥æ”¶å“åº”</h3><blockquote><p>é€šè¿‡.thenæ¥å¼‚æ­¥æ¥æ”¶å“åº”</p></blockquote> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;students.json&#x27;</span>)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> resp.<span class="hljs-title function_">json</span>())<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">array</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// è·å–æ¨¡æ¿</span><br>    <span class="hljs-keyword">const</span> tp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;tp&quot;</span>);<br>    <span class="hljs-keyword">const</span> row = tp.<span class="hljs-property">content</span>;<br><br>    <span class="hljs-comment">// å°†æ•°æ®å¡«å…¥æ¨¡æ¿ï¼Œå¹¶å¤åˆ¶åˆ°è¦æ˜¾ç¤ºçš„æ–‡æœ¬ä¸­</span><br>    <span class="hljs-keyword">const</span> [c1, c2, c3, c4] = row.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&quot;.col&quot;</span>);<br>    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;.tbody&#x27;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> &#123;id, name, sex, age&#125; <span class="hljs-keyword">of</span> array) &#123;<br>        c1.<span class="hljs-property">textContent</span> = id;<br>        c2.<span class="hljs-property">textContent</span> = name;<br>        c3.<span class="hljs-property">textContent</span> = sex;<br>        c4.<span class="hljs-property">textContent</span> = age;<br><br>        <span class="hljs-keyword">const</span> newRow = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">importNode</span>(row, <span class="hljs-literal">true</span>);<br>        tbody.<span class="hljs-title function_">appendChild</span>(newRow);<br>    &#125;<br>&#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)) <span class="hljs-comment">//æ•è·å¼‚å¸¸</span><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h3 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h3><blockquote><p>åŒæºæ£€æŸ¥æ˜¯æµè§ˆå™¨çš„è¡Œä¸ºï¼Œè€Œä¸”åªé’ˆå¯¹ fetchã€xhrï¼ˆXMLHTTPRequestï¼‰ è¯·æ±‚</p><p>åªè¦åè®®ã€ä¸»æœºã€ç«¯å£ä¹‹ä¸€ä¸åŒï¼Œå°±ä¸åŒæº</p></blockquote><ul><li>fetch è¯·æ±‚è·¨åŸŸï¼Œä¼šæºå¸¦ä¸€ä¸ª Origin å¤´ï¼Œä»£è¡¨ã€å‘è¯·æ±‚çš„èµ„æºæºè‡ªä½•å¤„ã€‘ï¼Œç›®æ ‡é€šè¿‡å®ƒå°±èƒ½è¾¨åˆ«æ˜¯å¦å‘ç”Ÿè·¨åŸŸ</li><li>ç›®æ ‡èµ„æºé€šè¿‡è¿”å› Access-Control-Allow-Origin å¤´ï¼Œå‘Šè¯‰æµè§ˆå™¨ã€å…è®¸å“ªäº›æºä½¿ç”¨æ­¤å“åº”ã€‘</li></ul><p><strong>é€šè¿‡æ·»åŠ å“åº”å¤´è§£å†³</strong></p><ul><li><p>javaåç«¯æ·»åŠ æ³¨è§£CrossOriginæ¥æ·»åŠ  Access-Control-Allow-Originå“åº”å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/api/students&quot;)</span><br><span class="hljs-meta">@CrossOrigin(&quot;http://localhost:7070&quot;)</span><br><span class="hljs-keyword">public</span> R <span class="hljs-title function_">all</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> R.ok(studentService.findAll());<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ç±»é…ç½®å…¨å±€è·¨åŸŸ</p><blockquote><p>å®ç°WebMvcConfigurerçš„addCorsMappingsæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> &#123;<br>        registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>)<br>            <span class="hljs-comment">// è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span><br>            .allowedOriginPatterns(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>)<br>            <span class="hljs-comment">// æ˜¯å¦å…è®¸æºå¸¦cookie</span><br>            .allowCredentials(<span class="hljs-literal">true</span>)<br>            <span class="hljs-comment">// è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼</span><br>            .allowedMethods(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>)<br>            <span class="hljs-comment">// è®¾ç½®å…è®¸çš„headerå±æ€§</span><br>            .allowedHeaders(<span class="hljs-string">&quot;*&quot;</span>)<br>            <span class="hljs-comment">// è·¨åŸŸå…è®¸çš„æ—¶é—´</span><br>            .maxAge(<span class="hljs-number">3600</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>é€šè¿‡ä»£ç†è§£å†³</strong></p><blockquote><p>æµè§ˆå™¨è¦è®¿é—®è·¨åŸŸçš„èµ„æºæ—¶ï¼Œå°†è¯·æ±‚å‘åˆ°å‰ç«¯çš„ä»£ç†ä¸­ï¼Œè®©ä»£ç†å»è·å¾—èµ„æºå†è¿”å›</p></blockquote><ul><li><p>å®‰è£…</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">npm install <span class="hljs-keyword">http</span>-proxy-middleware <span class="hljs-comment">--save-dev</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨å¯åŠ¨ä»£ç ä¸­å¯¼å…¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;createProxyMiddleware&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http-proxy-middleware&#x27;</span><br><br><span class="hljs-comment">//åˆ›å»ºä»£ç†ä¸­é—´ä»¶ï¼Œè¯·æ±‚urlä¸º&#x27;/api&#x27;çš„éƒ½ä¼šè¢«ä»£ç†</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api&#x27;</span>, <span class="hljs-title function_">createProxyMiddleware</span>(&#123; <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:8080&#x27;</span>, <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span> &#125;));<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>API</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºå‰ç«¯æœåŠ¡å™¨</title>
    <link href="/2022/10/03/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2022/10/03/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="æ­å»ºå‰ç«¯æœåŠ¡å™¨"><a href="#æ­å»ºå‰ç«¯æœåŠ¡å™¨" class="headerlink" title="æ­å»ºå‰ç«¯æœåŠ¡å™¨"></a>æ­å»ºå‰ç«¯æœåŠ¡å™¨</h2><p><strong>æ¡ˆä¾‹</strong></p><ul><li><p>æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹</p></li><li><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">npm install <span class="hljs-built_in">express</span> --<span class="hljs-built_in">save</span>-dev<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>package.json</code>æ–‡ä»¶</p><blockquote><p>æ·»åŠ â€typeâ€: â€œmoduleâ€å°±å¯ä»¥ä½¿ç”¨importæ¥å¯¼å…¥æ¨¡å—</p><p>å…¶ä¸­ devDependencies æ˜¯ npm install â€“save-dev æ·»åŠ çš„</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;express&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^4.18.1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™<code>main.js</code>æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">import express from &#x27;express&#x27;<br>const app = express()<br><br>app.use(express.static(&#x27;./&#x27;))<br>app.listen(<span class="hljs-number">7070</span>)<br></code></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼š</p><ul><li><p>const app &#x3D; express()ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åº</p></li><li><p>app.listen(7070)ï¼šè®¾ç½®ç›‘å¬çš„ç«¯å£</p></li><li><p>app.use(express.static(â€˜.&#x2F;â€˜))ï¼šè®¾ç½®é™æ€æ–‡ä»¶ç›®å½•</p></li></ul></li><li><p>æ§åˆ¶å°(VSCodeå¿«æ·é”®: ctrl+shift+åå¼•å·)æ‰§è¡Œå‘½å</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">main</span>.js<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>æ­å»ºç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…nvm</title>
    <link href="/2022/10/03/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E5%AE%89%E8%A3%85nvm/"/>
    <url>/2022/10/03/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E7%8E%AF%E5%A2%83/%E5%AE%89%E8%A3%85nvm/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…nvm"><a href="#å®‰è£…nvm" class="headerlink" title="å®‰è£…nvm"></a>å®‰è£…nvm</h2><blockquote><p>nvm å³ (node version manager)ï¼Œå¥½å¤„æ˜¯æ–¹ä¾¿åˆ‡æ¢ node.js ç‰ˆæœ¬</p></blockquote><p><a href="https://github.com/coreybutler/nvm-windows/releases">githubä¸‹è½½</a> , ä¸‹è½½<code>nvm-setup.zip</code></p><p>å®‰è£…æ³¨æ„äº‹é¡¹</p><ul><li>æç¤ºé€‰æ‹© nvm å’Œ nodejs ç›®å½•æ—¶ï¼Œä¸€å®šè¦é¿å…ç›®å½•ä¸­å‡ºç°ç©ºæ ¼</li><li>é€‰ç”¨ã€ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‘cmd ç¨‹åºæ¥æ‰§è¡Œ nvm å‘½ä»¤</li></ul><h3 id="å®‰è£…nvm-1"><a href="#å®‰è£…nvm-1" class="headerlink" title="å®‰è£…nvm"></a>å®‰è£…nvm</h3><ul><li><p>é¦–æ¬¡è¿è¡Œå‰è®¾ç½®å¥½å›½å†…é•œåƒåœ°å€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">nvm node_mirror http:<span class="hljs-regexp">//</span>npm.taobao.org<span class="hljs-regexp">/mirrors/</span>node/<br>nvm npm_mirror https:<span class="hljs-regexp">//</span>npm.taobao.org<span class="hljs-regexp">/mirrors/</span>npm/<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹nodejså¯ç”¨ç‰ˆæœ¬</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">nvm list available<br></code></pre></td></tr></table></figure></li><li><p>å»ºè®®ä¸‹è½½LTS(é•¿æœŸæ”¯æŒç‰ˆ)</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvm</span> install <span class="hljs-number">16</span>.<span class="hljs-number">16</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">nvm</span> install <span class="hljs-number">14</span>.<span class="hljs-number">20</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ‡æ¢nodejsç‰ˆæœ¬</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvm</span> use <span class="hljs-number">16</span>.<span class="hljs-number">16</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="æ£€æŸ¥npm"><a href="#æ£€æŸ¥npm" class="headerlink" title="æ£€æŸ¥npm"></a>æ£€æŸ¥npm</h3><blockquote><p>npmï¼ˆnode package managerï¼‰ æ˜¯ js çš„åŒ…ç®¡ç†å™¨ï¼Œå°±ç±»ä¼¼äº java ç•Œçš„ mavenï¼Œè¦ç¡®ä¿å®ƒä½¿ç”¨çš„æ˜¯å›½å†…é•œåƒ</p></blockquote><ul><li><p>æ£€æŸ¥é•œåƒ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-built_in">get</span> registry<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®å›½å†…é•œåƒ</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set registry https:<span class="hljs-comment">//registry.npm.taobao.org/</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>æ­å»ºç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šçº§ç¼“å­˜</title>
    <link href="/2022/09/29/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/"/>
    <url>/2022/09/29/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å¤šçº§ç¼“å­˜"><a href="#å¤šçº§ç¼“å­˜" class="headerlink" title="å¤šçº§ç¼“å­˜"></a>å¤šçº§ç¼“å­˜</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><img src="/img/weifuwu_img/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98.png"></p><p>tomcatæŸ¥è¯¢çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå°½é‡é€šè¿‡ç¼“å­˜æ¥å‡å°‘tomcatçš„æŸ¥è¯¢</p><p><strong>å¤šçº§ç¼“å­˜</strong>å°±æ˜¯å……åˆ†åˆ©ç”¨è¯·æ±‚å¤„ç†çš„æ¯ä¸ªç¯èŠ‚ï¼Œåˆ†åˆ«æ·»åŠ ç¼“å­˜ï¼Œå‡è½»Tomcatå‹åŠ›ï¼Œæå‡æœåŠ¡æ€§èƒ½</p><p>å¤šçº§ç¼“å­˜çš„å…³é”®æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>ä¸€ä¸ªæ˜¯åœ¨nginxä¸­ç¼–å†™ä¸šåŠ¡ï¼Œå®ç°nginxæœ¬åœ°ç¼“å­˜ã€Redisã€Tomcatçš„æŸ¥è¯¢</p></li><li><p>å¦ä¸€ä¸ªå°±æ˜¯åœ¨Tomcatä¸­å®ç°JVMè¿›ç¨‹ç¼“å­˜</p></li></ul><h3 id="JVMè¿›ç¨‹ç¼“å­˜"><a href="#JVMè¿›ç¨‹ç¼“å­˜" class="headerlink" title="JVMè¿›ç¨‹ç¼“å­˜"></a>JVMè¿›ç¨‹ç¼“å­˜</h3><h4 id="Caffeine"><a href="#Caffeine" class="headerlink" title="Caffeine"></a>Caffeine</h4><blockquote><p><strong>Caffeine</strong>æ˜¯ä¸€ä¸ªåŸºäºJava8å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰Springå†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯Caffeine</p><p><a href="https://github.com/ben-manes/caffeine">githubåœ°å€</a></p></blockquote><h4 id="ä½¿ç”¨Caffeine"><a href="#ä½¿ç”¨Caffeine" class="headerlink" title="ä½¿ç”¨Caffeine"></a>ä½¿ç”¨Caffeine</h4><ul><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åŸºæœ¬ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//åˆ›å»ºç¼“å­˜å¯¹è±¡</span><br>    Cache&lt;String, String&gt; cache = Caffeine.newBuilder().build();<br><br>    <span class="hljs-comment">//æ·»åŠ æ•°æ®åˆ°ç¼“å­˜</span><br>    cache.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zs&quot;</span>);<br>    System.out.println(cache.getIfPresent(<span class="hljs-string">&quot;name&quot;</span>));<br><br>    <span class="hljs-comment">//ç±»ä¼¼getOrDefaultï¼Œå¯ä»¥åœ¨æŸ¥ä¸åˆ°ç¼“å­˜çš„æ—¶å€™æŸ¥æ•°æ®åº“æ¥è¿”å›å€¼</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> cache.get(<span class="hljs-string">&quot;defaultName&quot;</span>, key -&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ls&quot;</span>;<br>    &#125;);<br>    System.out.println(name);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>    Cache&lt;String, String&gt; cache = Caffeine.newBuilder()<br>        <span class="hljs-comment">//æ·»åŠ æ¸…é™¤ç¼“å­˜ç­–ç•¥</span><br>        .maximumSize(<span class="hljs-number">1</span>)     <span class="hljs-comment">//åŸºäºå®¹é‡ï¼Œè¶…è¿‡1ä¸ªç¼“å­˜å°±ä¼šæ¸…é™¤æ—§çš„</span><br>        .expireAfterWrite(Duration.ofSeconds(<span class="hljs-number">10</span>))   <span class="hljs-comment">//åŸºäºæ—¶é—´, 10såæ¸…é™¤</span><br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å®ä¾‹</p><p>æ³¨å…¥åˆ°å®¹å™¨å®ç°è‡ªåŠ¨è£…é…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CaffeineConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Cache&lt;Long, Item&gt; <span class="hljs-title function_">itemCache</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Caffeine.newBuilder()<br>                .initialCapacity(<span class="hljs-number">100</span>)<br>                .maximumSize(<span class="hljs-number">10000</span>)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Cache&lt;Long, ItemStock&gt; <span class="hljs-title function_">itemStockCache</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Caffeine.newBuilder()<br>                .initialCapacity(<span class="hljs-number">100</span>)<br>                .maximumSize(<span class="hljs-number">10000</span>)<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡Cacheå®ç°JVMè¿›ç¨‹ç¼“å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;item&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemController</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IItemService itemService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IItemStockService stockService;<br>    <br>    <span class="hljs-comment">//å•†å“ç¼“å­˜</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Cache&lt;Long, Item&gt; itemCache;<br>    <span class="hljs-comment">//åº“å­˜ç¼“å­˜</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Cache&lt;Long, ItemStock&gt; itemStockCache;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<br>        <span class="hljs-comment">//å…ˆæŸ¥ç¼“å­˜ï¼Œæ²¡æœ‰å†æŸ¥æ•°æ®åº“</span><br>        <span class="hljs-keyword">return</span> itemCache.get(id, key -&gt; &#123;<br>           <span class="hljs-keyword">return</span>  itemService.query()<br>                   .ne(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">3</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id)<br>                   .one();<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/stock/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> ItemStock <span class="hljs-title function_">findStockById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<br>        <span class="hljs-keyword">return</span> itemStockCache.get(id, key -&gt; &#123;<br>            <span class="hljs-keyword">return</span> stockService.getById(id);<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="Luaè¯­æ³•å…¥é—¨"><a href="#Luaè¯­æ³•å…¥é—¨" class="headerlink" title="Luaè¯­æ³•å…¥é—¨"></a>Luaè¯­æ³•å…¥é—¨</h3><blockquote><p>Lua æ˜¯ä¸€ç§è½»é‡å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€æ”¾ï¼Œ å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†<strong>åµŒå…¥åº”ç”¨ç¨‹åº</strong>ä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚<a href="https://www.lua.org/">å®˜ç½‘</a></p><p>Luaç»å¸¸åµŒå…¥åˆ°Cè¯­è¨€å¼€å‘çš„ç¨‹åºä¸­ï¼Œä¾‹å¦‚æ¸¸æˆå¼€å‘ã€æ¸¸æˆæ’ä»¶ç­‰ã€‚</p><p>Nginxæœ¬èº«ä¹Ÿæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå› æ­¤ä¹Ÿå…è®¸åŸºäºLuaåšæ‹“å±•ã€‚</p></blockquote><h4 id="æ‰“å°"><a href="#æ‰“å°" class="headerlink" title="æ‰“å°"></a>æ‰“å°</h4><ul><li><p>åˆ›å»ºhello.luaæ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">touch</span> hello.lua<br><span class="hljs-comment"># ç¼–è¾‘</span><br>vim hello.lua<br></code></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶å†…</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;hello lua&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œhello.lua</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">lua hello.lua<br></code></pre></td></tr></table></figure><p><img src="/img/weifuwu_img/luaHelloWorld.png"></p></li></ul><h4 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h4><p><strong>å˜é‡ç±»å‹</strong></p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nil</td><td>è¡¨ç¤ºä¸€ä¸ªæ— æ•ˆå€¼æˆ–false</td></tr><tr><td>boolean</td><td>true&#x2F;false</td></tr><tr><td>number</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>string</td><td>å­—ç¬¦ä¸²</td></tr><tr><td>function</td><td>å‡½æ•°</td></tr><tr><td>table</td><td>å¯ä»¥ä½œä¸ºæ•°ç»„æˆ–mapæ¥ä½¿ç”¨</td></tr></tbody></table><blockquote><p>é€šè¿‡å‡½æ•°type()å¯ä»¥æŸ¥çœ‹å˜é‡ç±»å‹</p></blockquote><p><img src="/img/weifuwu_img/luaType.png"></p><p><strong>å£°æ˜å˜é‡</strong></p><blockquote><p>Luaå£°æ˜å˜é‡çš„æ—¶å€™æ— éœ€æŒ‡å®šæ•°æ®ç±»å‹</p></blockquote><ul><li><p>local å…³é”®å­—å£°æ˜å±€éƒ¨å˜é‡ï¼Œæ²¡æœ‰åˆ™æ˜¯å…¨å±€å˜é‡</p><p><img src="/img/weifuwu_img/lua%E5%8F%98%E9%87%8F1.png"></p></li><li><p>stringã€numberã€boolean</p><p><img src="/img/weifuwu_img/lua%E5%8F%98%E9%87%8F2.png"></p></li><li><p>table</p><p><img src="/img/weifuwu_img/lua%E5%8F%98%E9%87%8F3.png"></p></li><li><p>è®¿é—®table</p><blockquote><p>ä¸‹æ ‡ä»1å¼€å§‹</p></blockquote><p><img src="/img/weifuwu_img/lua%E5%8F%98%E9%87%8F4.png"></p><p><img src="/img/weifuwu_img/lua%E5%8F%98%E9%87%8F5.png"></p></li></ul><h4 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h4><blockquote><p>å¾ªç¯æ•°ç»„ç”¨ipairsï¼Œå¾ªç¯mapç”¨pairs</p></blockquote><p><img src="/img/weifuwu_img/lua%E5%BE%AA%E7%8E%AF1.png"></p><p><img src="/img/weifuwu_img/lua%E5%BE%AA%E7%8E%AF2.png"></p><h4 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h4><p><img src="/img/weifuwu_img/lua%E5%87%BD%E6%95%B01.png"></p><p><img src="/img/weifuwu_img/lua%E5%87%BD%E6%95%B02.png"></p><h4 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h4><p>è¯­æ³•</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span>(å¸ƒå°”è¡¨è¾¾å¼)<br><span class="hljs-keyword">then</span><br>   <span class="hljs-comment">--[ å¸ƒå°”è¡¨è¾¾å¼ä¸º true æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span><br><span class="hljs-keyword">else</span><br>   <span class="hljs-comment">--[ å¸ƒå°”è¡¨è¾¾å¼ä¸º false æ—¶æ‰§è¡Œè¯¥è¯­å¥å— --]</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><blockquote><p>&amp;&amp; || !     å¯¹åº”    and or not</p></blockquote><p><img src="/img/weifuwu_img/lua%E6%9D%A1%E4%BB%B61.png"></p><p><img src="/img/weifuwu_img/lua%E6%9D%A1%E4%BB%B62.png"></p><h3 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h3><blockquote><p>åŸºäº Nginxçš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚<a href="https://openresty.org/cn/">å®˜ç½‘</a></p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li>å…·å¤‡Nginxçš„å®Œæ•´åŠŸèƒ½</li><li>åŸºäºLuaè¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œé›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—</li><li>å…è®¸ä½¿ç”¨Lua<strong>è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘</strong>ã€<strong>è‡ªå®šä¹‰åº“</strong></li></ul><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><ul><li><p>å®‰è£…OpenRestyä¾èµ–å¼€å‘åº“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y pcre-devel openssl-devel gcc --skip-broken<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…OpenRestyä»“åº“ï¼Œä¾¿äºæœªæ¥å®‰è£…æˆ–æ›´æ–°æˆ‘ä»¬çš„è½¯ä»¶åŒ…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…OpenResty</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">yum install -y openresty<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…opmå·¥å…·</p><blockquote><p>opmæ˜¯OpenRestyçš„ä¸€ä¸ªç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„Luaæ¨¡å—</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y openresty-opm<br></code></pre></td></tr></table></figure></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenRestyå®‰è£…çš„ç›®å½•æ˜¯ï¼š&#x2F;usr&#x2F;local&#x2F;openresty</p><p>OpenRestyå°±æ˜¯åœ¨NginxåŸºç¡€ä¸Šé›†æˆäº†ä¸€äº›Luaæ¨¡å—</p></li></ul><h4 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#æ‰“å¼€é…ç½®æ–‡ä»¶</span><br>vi /etc/profile<br><br><span class="hljs-comment"># æ·»åŠ ç¯å¢ƒå˜é‡</span><br><span class="hljs-built_in">export</span> NGINX_HOME=/usr/local/openresty/nginx<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$&#123;NGINX_HOME&#125;</span>/sbin:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment"># è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><p>è¿è¡Œæ–¹å¼ä¸nginxåŸºæœ¬ä¸€è‡´</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å¯åŠ¨nginx</span><br>nginx<br><span class="hljs-comment"># é‡æ–°åŠ è½½é…ç½®</span><br>nginx -s reload<br><span class="hljs-comment"># åœæ­¢</span><br>nginx -s stop<br></code></pre></td></tr></table></figure><blockquote><p> <code>/usr/local/openresty/nginx/conf/nginx.conf</code>ä¸ºnginxé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢æ³¨é‡Šæ¯”è¾ƒå¤šï¼Œå¯ä»¥å°†nginx.confä¸­çš„æ³¨é‡Šéƒ¨åˆ†åˆ é™¤ï¼Œä¿ç•™æœ‰æ•ˆéƒ¨åˆ†ã€‚</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#user  nobody;</span><br><span class="hljs-attribute">worker_processes</span>  <span class="hljs-number">1</span>;<br><span class="hljs-attribute">error_log</span>  logs/<span class="hljs-literal">error</span>.log;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span>  <span class="hljs-number">65</span>;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">8081</span>;<br>        <span class="hljs-attribute">server_name</span>  localhost;<br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">root</span>   html;<br>            <span class="hljs-attribute">index</span>  index.html index.htm;<br>        &#125;<br>        <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>        <span class="hljs-section">location</span> = /50x.html &#123;<br>            <span class="hljs-attribute">root</span>   html;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é€šè¿‡OpenRestyå“åº”è¯·æ±‚"><a href="#é€šè¿‡OpenRestyå“åº”è¯·æ±‚" class="headerlink" title="é€šè¿‡OpenRestyå“åº”è¯·æ±‚"></a>é€šè¿‡OpenRestyå“åº”è¯·æ±‚</h4><p><strong>æ¡ˆä¾‹</strong></p><ul><li><p>åšåå‘ä»£ç†çš„nginxçš„é…ç½®æ–‡ä»¶</p><blockquote><p>å°†è¯·æ±‚å‘é€åˆ°OpenRestyç«¯å£</p></blockquote><p><img src="/img/weifuwu_img/OpenResty%E6%A1%88%E4%BE%8B1.png"></p></li><li><p>OpenRestyé…ç½®æ–‡ä»¶</p><blockquote><p>åœ¨httpä¸‹é¢æ·»åŠ Luaä¾èµ–åº“</p><p>æ”¹å®Œé…ç½®æ–‡ä»¶nginx -s reload é‡æ–°åŠ è½½ä¸€ä¸‹é…ç½®æ–‡ä»¶</p></blockquote><p><img src="/img/weifuwu_img/OpenResty%E6%A1%88%E4%BE%8B2.png"></p></li><li><p>åœ¨OpenRestyçš„<code>/usr/local/openresty/nginx</code>ä¸‹åˆ›å»º<code>lua/item.lua</code>æ–‡ä»¶</p><p><img src="/img/weifuwu_img/OpenResty%E6%A1%88%E4%BE%8B3.png"></p></li><li><p>åœ¨<code>lua/item.lua</code>æ–‡ä»¶é‡Œé¢ç¼–å†™å“åº”çš„é€»è¾‘</p><blockquote><p>è¿™é‡Œé€šè¿‡ngx.say()è¿”å›å‡æ•°æ®</p></blockquote><p><img src="/img/weifuwu_img/OpenResty%E6%A1%88%E4%BE%8B4.png"></p></li><li><p>é¡µé¢å†æ¬¡è¯·æ±‚ï¼Œè¿”å›luaæ–‡ä»¶é‡Œçš„å“åº”</p><blockquote><p>æ²¡æœ‰ååº”çš„æŠŠnginxè¿›ç¨‹æ€æ‰å†è¯•è¯•</p></blockquote></li></ul><h4 id="è·å–è¯·æ±‚å‚æ•°"><a href="#è·å–è¯·æ±‚å‚æ•°" class="headerlink" title="è·å–è¯·æ±‚å‚æ•°"></a>è·å–è¯·æ±‚å‚æ•°</h4><p><img src="/img/weifuwu_img/Lua%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0.png"></p><p><strong>æ¡ˆä¾‹</strong></p><ul><li><p>openRestyé…ç½®æ–‡ä»¶</p><p><img src="/img/weifuwu_img/Lua%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B02.png"></p></li><li><p>item.luaæ–‡ä»¶</p><p><img src="/img/weifuwu_img/Lua%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B03.png"></p></li></ul><h3 id="OpenRestyæŸ¥è¯¢Tomcat"><a href="#OpenRestyæŸ¥è¯¢Tomcat" class="headerlink" title="OpenRestyæŸ¥è¯¢Tomcat"></a>OpenRestyæŸ¥è¯¢Tomcat</h3><p><strong>OpenRestyå‘é€httpè¯·æ±‚æ–¹å¼</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> resp = ngx.location.capture(<span class="hljs-string">&quot;/path&quot;</span>,&#123;<br>    method = ngx.HTTP_GET,   <span class="hljs-comment">-- è¯·æ±‚æ–¹å¼</span><br>    args = &#123;a=<span class="hljs-number">1</span>,b=<span class="hljs-number">2</span>&#125;,  <span class="hljs-comment">-- getæ–¹å¼ä¼ å‚æ•°</span><br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿”å›çš„å“åº”å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>resp.statusï¼šå“åº”çŠ¶æ€ç </li><li>resp.headerï¼šå“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ªtable</li><li>resp.bodyï¼šå“åº”ä½“ï¼Œå°±æ˜¯å“åº”æ•°æ®</li></ul><p>æ³¨æ„ï¼šè¿™é‡Œçš„pathæ˜¯è·¯å¾„ï¼Œå¹¶ä¸åŒ…å«IPå’Œç«¯å£ã€‚è¿™ä¸ªè¯·æ±‚ä¼šè¢«nginxå†…éƒ¨çš„serverç›‘å¬å¹¶å¤„ç†ã€‚</p><p><strong>é€šè¿‡nginxåå‘ä»£ç†å‘é€è¯·æ±‚åˆ°tomcat</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#å°†/pathè¯·æ±‚ä»£ç†åˆ°tomcatçš„ipå’Œç«¯å£</span><br><span class="hljs-section">location</span> /path &#123;<br>     <span class="hljs-comment"># è¿™é‡Œæ˜¯windowsç”µè„‘çš„ipå’ŒJavaæœåŠ¡ç«¯å£ï¼Œéœ€è¦ç¡®ä¿windowsé˜²ç«å¢™å¤„äºå…³é—­çŠ¶æ€</span><br>     <span class="hljs-attribute">proxy_pass</span> http://192.168.229.1:8081; <br> &#125;<br></code></pre></td></tr></table></figure><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><ul><li><p>åœ¨<code>/usr/local/openresty/lualib</code>ç›®å½•ä¸‹ç¼–å†™common.luaå·¥å…·ç±»</p><blockquote><p>å°†read_httpå‡½æ•°å°è£…åˆ°_Mè¿™ä¸ªtableç±»å‹çš„å˜é‡ä¸­ï¼Œå¹¶ä¸”è¿”å›ï¼Œè¿™ç±»ä¼¼äºå¯¼å‡º</p><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨<code>require(&#39;common&#39;)</code>æ¥å¯¼å…¥è¯¥å‡½æ•°åº“ï¼Œè¿™é‡Œçš„commonæ˜¯å‡½æ•°åº“çš„æ–‡ä»¶å</p></blockquote><p><img src="/img/weifuwu_img/OpenResty%E6%9F%A5%E8%AF%A2tomcat1.png"></p></li><li><p>åœ¨<code>/usr/local/openresty/nginx/conf/nginx.conf</code>é…ç½®æ–‡ä»¶ä¸­æ·»åŠ location</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /item &#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://192.168.229.1:8081;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹item.luaæ–‡ä»¶</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- å¯¼å…¥è‡ªå®šä¹‰çš„common.lua å·¥å…·æ¨¡å—</span><br><span class="hljs-keyword">local</span> common = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;common&#x27;</span>)<br><span class="hljs-comment">-- å¯¼å…¥jsonè§£ææ¨¡å—</span><br><span class="hljs-keyword">local</span> cjson = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cjson&#x27;</span>)<br><br><br><span class="hljs-comment">-- è·å–id</span><br><span class="hljs-keyword">local</span> id = ngx.var[<span class="hljs-number">1</span>];<br><br><span class="hljs-comment">-- ä»commonä¸­è·å–read_httpå‡½æ•°</span><br><span class="hljs-keyword">local</span> read_http = common.read_http<br><span class="hljs-comment">-- å‘é€è¯·æ±‚è·å–å•†å“å’Œåº“å­˜</span><br><span class="hljs-keyword">local</span> itemJson = read_http(<span class="hljs-string">&#x27;/item/&#x27;</span> .. id, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">local</span> itemStockJson = read_http(<span class="hljs-string">&#x27;/item/stock/&#x27;</span> .. id, <span class="hljs-literal">nil</span>)<br><br><span class="hljs-comment">-- è§£æjsonï¼Œå°†ä¸¤ä¸ªæŸ¥è¯¢ç»“æœåˆæˆä¸€ä¸ª</span><br><span class="hljs-keyword">local</span> item = cjson.decode(itemJson)<br><span class="hljs-keyword">local</span> stock = cjson.decode(itemStockJson)<br>item.stock = stock.stock <br>item.sold = stock.sold<br><br><span class="hljs-comment">-- å°†æŸ¥è¯¢ç»“æœé‡æ–°åºåˆ—åŒ–ä¸ºjsonå¹¶è¿”å›</span><br>ngx.say(cjson.encode(item))<br></code></pre></td></tr></table></figure></li><li><p>nginxé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">nginx -s reload<br></code></pre></td></tr></table></figure></li></ul><h4 id="åŸºäºæŸ¥è¯¢idçš„è´Ÿè½½å‡è¡¡"><a href="#åŸºäºæŸ¥è¯¢idçš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŸºäºæŸ¥è¯¢idçš„è´Ÿè½½å‡è¡¡"></a>åŸºäºæŸ¥è¯¢idçš„è´Ÿè½½å‡è¡¡</h4><blockquote><p>ç›¸åŒçš„idéƒ½ä¼šä»£ç†åˆ°åŒä¸€å°tomcatæœåŠ¡å™¨ï¼Œä¸ä¼šå‡ºç°ä¸€æ¡æ•°æ®ç¼“å­˜åœ¨å¤šå°æœåŠ¡å™¨ä¸Šçš„å†—ä½™</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> tomcat-cluster &#123;<br>    <span class="hljs-attribute">hash</span> <span class="hljs-variable">$request_uri</span>;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.229.1:8081</span>;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.229.1:8082</span>;<br>&#125;<br><br><span class="hljs-section">location</span> /item &#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://tomcat-cluster;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br>nginx -s reload<br></code></pre></td></tr></table></figure><h3 id="OpenRestyæŸ¥è¯¢Redis"><a href="#OpenRestyæŸ¥è¯¢Redis" class="headerlink" title="OpenRestyæŸ¥è¯¢Redis"></a>OpenRestyæŸ¥è¯¢Redis</h3><h4 id="Redisé¢„çƒ­"><a href="#Redisé¢„çƒ­" class="headerlink" title="Redisé¢„çƒ­"></a>Redisé¢„çƒ­</h4><blockquote><p>Redisåˆšå¯åŠ¨æ—¶æ²¡æœ‰ç¼“å­˜ï¼Œå°†çƒ­ç‚¹æ•°æ®æå‰æŸ¥è¯¢å¹¶ä¿å­˜åˆ°Redisä¸­ç§°ä¸ºé¢„çƒ­</p></blockquote><ul><li><p>docker å®‰è£…redis</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> --name redis -p 6379:6379 -d redis redis-server --appendonly <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure></li><li><p>å¼•å…¥redisä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®redisåœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™åˆå§‹åŒ–ç±»</p><blockquote><p><strong>InitializingBean</strong>æ¥å£ï¼šä¸ºbeanæä¾›äº†å±æ€§åˆå§‹åŒ–åçš„å¤„ç†æ–¹æ³•ï¼Œå®ƒåªæœ‰ä¸€ä¸ªafterPropertiesSetæ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œåœ¨beançš„å±æ€§åˆå§‹åŒ–åéƒ½ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p><p><strong>ObjectMapper</strong>ï¼šspringé»˜è®¤çš„jsonå¤„ç†å·¥å…·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.item.config;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ItemService itemService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ItemStockService itemStockService;<br><br>    <span class="hljs-comment">//jsonè§£æ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨å¯¹è±¡è¢«Springåˆ›å»ºå¹¶ä¸”æˆå‘˜å˜é‡å…¨éƒ¨æ³¨å…¥åæ‰§è¡Œ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è·å–è¦æ”¾å…¥redisä¸­çš„æ•°æ®</span><br>        List&lt;Item&gt; itemList = itemService.list();<br><br>        <span class="hljs-keyword">for</span> (Item item : itemList) &#123;<br>            <span class="hljs-comment">//è½¬ä¸ºjsonå¹¶å­˜å…¥redis</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(item);<br>            redisTemplate.opsForValue().set(<span class="hljs-string">&quot;item:id:&quot;</span> + item.getId(), json);<br>        &#125;<br><br>        <span class="hljs-comment">// 3.æŸ¥è¯¢å•†å“åº“å­˜ä¿¡æ¯</span><br>        List&lt;ItemStock&gt; stockList = itemStockService.list();<br>        <span class="hljs-comment">// 4.æ”¾å…¥ç¼“å­˜</span><br>        <span class="hljs-keyword">for</span> (ItemStock stock : stockList) &#123;<br>            <span class="hljs-comment">// 2.1.itemåºåˆ—åŒ–ä¸ºJSON</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(stock);<br>            <span class="hljs-comment">// 2.2.å­˜å…¥redis</span><br>            redisTemplate.opsForValue().set(<span class="hljs-string">&quot;item:stock:id:&quot;</span> + stock.getId(), json);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯æœåŠ¡å°±èƒ½çœ‹åˆ°redisä¸­è¢«æ·»åŠ äº†æ•°æ®</p></li></ul><h4 id="æŸ¥è¯¢Redisç¼“å­˜"><a href="#æŸ¥è¯¢Redisç¼“å­˜" class="headerlink" title="æŸ¥è¯¢Redisç¼“å­˜"></a>æŸ¥è¯¢Redisç¼“å­˜</h4><ul><li><p>åœ¨<code>/usr/local/openresty/lualib/common.lua</code>ä¸­å°è£…æŸ¥è¯¢redisçš„å‡½æ•°</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- å¯¼å…¥ä¾èµ–åº“</span><br><span class="hljs-comment">-- restyç›®å½•ä¸‹çš„redisä¾èµ–åº“</span><br><span class="hljs-keyword">local</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;resty.redis&#x27;</span>)<br><br><br><br><span class="hljs-comment">-- å‘é€httpè¯·æ±‚åˆ°tomcat</span><br><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read_http</span> <span class="hljs-params">(path, params)</span></span><br><span class="hljs-comment">-- å‘é€è¯·æ±‚ </span><br><span class="hljs-keyword">local</span> resp = ngx.location.capture(<span class="hljs-built_in">path</span>, &#123;<br>method = ngx.HTTP_GET,<br>args = params,<br>&#125;)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> resp <span class="hljs-keyword">then</span><br><span class="hljs-comment">-- è®°å½•é”™è¯¯ä¿¡æ¯</span><br>ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;httpè¯·æ±‚æŸ¥è¯¢å¤±è´¥, path: &quot;</span>, <span class="hljs-built_in">path</span> , <span class="hljs-string">&quot;, args: &quot;</span>, args)<br>ngx.<span class="hljs-built_in">exit</span>(<span class="hljs-number">404</span>)<br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- è§£æå‡ºå“åº”ä½“å¹¶è¿”å›</span><br><span class="hljs-keyword">return</span> resp.body<br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- åˆå§‹åŒ–redis</span><br><span class="hljs-keyword">local</span> red = redis:new()<br>red:set_timeouts(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>)<span class="hljs-comment">-- è¿æ¥è¶…æ—¶ï¼Œè¯·æ±‚è¶…æ—¶ï¼Œå“åº”è¶…æ—¶</span><br><span class="hljs-comment">-- é‡Šæ”¾redisè¿æ¥</span><br><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close_redis</span> <span class="hljs-params">(red)</span></span> <br><span class="hljs-keyword">local</span> pool_max_idle_time = <span class="hljs-number">10000</span><span class="hljs-comment">-- è¿æ¥çš„ç©ºé—²æ—¶é—´,ms</span><br><span class="hljs-keyword">local</span> pool_size = <span class="hljs-number">100</span><br><span class="hljs-keyword">local</span> ok, err = red:set_keepalive(pool_max_idle_time, pool_size)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span><br>ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;é‡Šæ”¾redisè¿æ¥å¤±è´¥&quot;</span>, err)<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- æŸ¥è¯¢redis</span><br><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read_redis</span><span class="hljs-params">(ip, port, key)</span></span><br><span class="hljs-comment">-- è·å–ä¸€ä¸ªè¿æ¥</span><br><span class="hljs-keyword">local</span> ok, err = red:connect(ip, port)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok <span class="hljs-keyword">then</span> <br>ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;è¿æ¥Rediså¤±è´¥&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- æŸ¥è¯¢redis</span><br><span class="hljs-keyword">local</span> resp, err = red:get(key)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> resp <span class="hljs-keyword">then</span><br>ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;æŸ¥è¯¢Rediså¤±è´¥&quot;</span>, err, <span class="hljs-string">&quot;key = &quot;</span>, key)<br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- æŸ¥è¯¢çš„æ•°æ®ä¸ºç©ºæ—¶</span><br><span class="hljs-keyword">if</span> resp == ngx.null <span class="hljs-keyword">then</span><br>resp = <span class="hljs-literal">nil</span><br>ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;æŸ¥è¯¢Redisæ•°æ®ä¸ºç©º&quot;</span>, err, <span class="hljs-string">&quot;key = &quot;</span>, key)<br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- é‡Šæ”¾è¿æ¥</span><br>close_redis(red)<br>    <span class="hljs-comment">-- è¿™é‡Œrespæ˜¯jsonæ•°æ®ï¼Œä¸ç”¨resp.body</span><br><span class="hljs-keyword">return</span> resp<br><span class="hljs-keyword">end</span><br><br><br><br><span class="hljs-comment">-- å°†æ–¹æ³•å¯¼å‡º</span><br><span class="hljs-keyword">local</span> _M = &#123;<br>read_http = read_http,<br>read_redis = read_redis<br>&#125;<br><span class="hljs-keyword">return</span> _M<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œæ”¹ä¸ºå…ˆæŸ¥rediså†æŸ¥tomcat</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- å¯¼å…¥è‡ªå®šä¹‰çš„common.lua å·¥å…·æ¨¡å—</span><br><span class="hljs-keyword">local</span> common = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;common&#x27;</span>)<br><span class="hljs-comment">-- ä»commonä¸­è·å–å‡½æ•°</span><br><span class="hljs-keyword">local</span> read_http = common.read_http<br><span class="hljs-keyword">local</span> read_redis = common.read_redis<br><span class="hljs-comment">-- å¯¼å…¥jsonè§£ææ¨¡å—</span><br><span class="hljs-keyword">local</span> cjson = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cjson&#x27;</span>)<br><br><br><span class="hljs-comment">-- å°è£…æŸ¥è¯¢æ–¹æ³•</span><br><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read_data</span><span class="hljs-params">(key, path, params)</span></span><br>    <span class="hljs-comment">-- æŸ¥è¯¢redisç¼“å­˜</span><br>    <span class="hljs-keyword">local</span> data = read_redis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>, key)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">then</span> <br>        ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;redisæŸ¥è¯¢å¤±è´¥,å°è¯•æŸ¥è¯¢http, key:&quot;</span>, key)<br>        data = read_http(<span class="hljs-built_in">path</span>, params)<br>    <span class="hljs-keyword">end</span><br><br>    <span class="hljs-keyword">return</span> data<br><span class="hljs-keyword">end</span><br><br><br><br><span class="hljs-comment">-- è·å–id</span><br><span class="hljs-keyword">local</span> id = ngx.var[<span class="hljs-number">1</span>];<br><br><span class="hljs-comment">-- å‘é€è¯·æ±‚è·å–å•†å“å’Œåº“å­˜</span><br><span class="hljs-keyword">local</span> itemJson = read_data(<span class="hljs-string">&#x27;item:id:&#x27;</span> .. id, <span class="hljs-string">&#x27;/item/&#x27;</span> .. id, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">local</span> itemStockJson = read_data(<span class="hljs-string">&#x27;item:stock:id:&#x27;</span> .. id, <span class="hljs-string">&#x27;/item/stock/&#x27;</span> .. id, <span class="hljs-literal">nil</span>)<br><br><span class="hljs-comment">-- è§£æjsonï¼Œå°†ä¸¤ä¸ªæŸ¥è¯¢ç»“æœåˆæˆä¸€ä¸ª</span><br><span class="hljs-keyword">local</span> item = cjson.decode(itemJson)<br><span class="hljs-keyword">local</span> stock = cjson.decode(itemStockJson)<br>item.stock = stock.stock <br>item.sold = stock.sold<br><br><span class="hljs-comment">-- å°†æŸ¥è¯¢ç»“æœé‡æ–°åºåˆ—åŒ–ä¸ºjsonå¹¶è¿”å›</span><br>ngx.say(cjson.encode(item))<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ§åˆ¶å±‚é€»è¾‘ï¼Œå½“æŸ¥åˆ°JVMç¼“å­˜çš„æ—¶å€™ç»™Redisä¹Ÿå­˜ä¸€ä»½æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Item <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<br>    <span class="hljs-comment">//å…ˆæŸ¥ç¼“å­˜ï¼Œæ²¡æœ‰å†æŸ¥æ•°æ®åº“</span><br>    <span class="hljs-type">Item</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> itemCache.get(id, key -&gt; &#123;<br>        <span class="hljs-keyword">return</span> itemService.query()<br>            .ne(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">3</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id)<br>            .one();<br>    &#125;);<br>    <span class="hljs-comment">//æŸ¥åˆ°JVMç¼“å­˜äº†ï¼Œè¯´æ˜redisä¸­æ²¡æœ‰æ•°æ®ï¼Œå­˜å…¥redisä¸€ä»½æ•°æ®</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;item:id:&quot;</span> + id, mapper.writeValueAsString(data));<br>    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br><span class="hljs-meta">@GetMapping(&quot;/stock/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> ItemStock <span class="hljs-title function_">findStockById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<br>    <span class="hljs-type">ItemStock</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> itemStockCache.get(id, key -&gt; &#123;<br>        <span class="hljs-keyword">return</span> stockService.getById(id);<br>    &#125;);<br>    <span class="hljs-comment">//æŸ¥åˆ°JVMç¼“å­˜äº†ï¼Œè¯´æ˜redisä¸­æ²¡æœ‰æ•°æ®ï¼Œå­˜å…¥redisä¸€ä»½æ•°æ®</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;item:stock:id:&quot;</span> + id, mapper.writeValueAsString(data));<br>    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="OpenRestyæŸ¥è¯¢æœ¬åœ°ç¼“å­˜"><a href="#OpenRestyæŸ¥è¯¢æœ¬åœ°ç¼“å­˜" class="headerlink" title="OpenRestyæŸ¥è¯¢æœ¬åœ°ç¼“å­˜"></a>OpenRestyæŸ¥è¯¢æœ¬åœ°ç¼“å­˜</h3><blockquote><p>OpenRestyä¸ºNginxæä¾›äº†<strong>shard dict</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨nginxçš„å¤šä¸ªworkerä¹‹é—´å…±äº«æ•°æ®ï¼Œå®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p></blockquote><ul><li><p>åœ¨nginx.confçš„htmlä¸‹ä¸­å¼€å¯æœ¬åœ°ç¼“å­˜</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># å¼€å¯å…±äº«å­—å…¸(æœ¬åœ°ç¼“å­˜)åç§°å«åšï¼šitem_cacheï¼Œå¤§å°150m</span><br><span class="hljs-attribute">lua_shared_dict</span> item_cache <span class="hljs-number">150m</span>; <br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>/usr/local/openresty/lua/item.lua</code>æ–‡ä»¶ï¼Œæ·»åŠ æœ¬åœ°ç¼“å­˜é€»è¾‘</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- å¯¼å…¥å…±äº«è¯å…¸ï¼Œæœ¬åœ°ç¼“å­˜</span><br><span class="hljs-keyword">local</span> item_cache = ngx.shared.item_cache<br><br><br><span class="hljs-comment">-- å°è£…æŸ¥è¯¢æ–¹æ³•</span><br><span class="hljs-keyword">local</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read_data</span><span class="hljs-params">(key, path, params)</span></span><br>    <span class="hljs-comment">-- å…ˆæŸ¥æœ¬åœ°ç¼“å­˜</span><br>    <span class="hljs-keyword">local</span> data = item_cache:get(key)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">then</span><br>        ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;æœ¬åœ°ç¼“å­˜æŸ¥è¯¢å¤±è´¥, å°è¯•æŸ¥è¯¢Redis, key: &quot;</span>, key)<br>        <span class="hljs-comment">-- æŸ¥è¯¢redisç¼“å­˜</span><br>        data = read_redis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>, key)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">then</span> <br>            ngx.<span class="hljs-built_in">log</span>(ngx.ERR, <span class="hljs-string">&quot;redisæŸ¥è¯¢å¤±è´¥,å°è¯•æŸ¥è¯¢http, key:&quot;</span>, key)<br>            <span class="hljs-comment">-- æŸ¥è¯¢tomcatç¼“å­˜</span><br>            data = read_http(<span class="hljs-built_in">path</span>, params)<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-comment">-- æ·»åŠ æœ¬åœ°ç¼“å­˜, é”®ï¼Œå€¼ï¼Œè¿‡æœŸæ—¶é—´</span><br>    item_cache:set(key, data, <span class="hljs-number">1000</span>)<br><br>    <span class="hljs-keyword">return</span> data<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="ç¼“å­˜åŒæ­¥"><a href="#ç¼“å­˜åŒæ­¥" class="headerlink" title="ç¼“å­˜åŒæ­¥"></a>ç¼“å­˜åŒæ­¥</h3><p>ç¼“å­˜æ•°æ®åŒæ­¥çš„å¸¸è§æ–¹å¼æœ‰ä¸‰ç§ï¼š</p><p><strong>è®¾ç½®æœ‰æ•ˆæœŸ</strong>ï¼šç»™ç¼“å­˜è®¾ç½®æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåè‡ªåŠ¨åˆ é™¤ã€‚å†æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°</p><ul><li>ä¼˜åŠ¿ï¼šç®€å•ã€æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®ï¼Œç¼“å­˜è¿‡æœŸä¹‹å‰å¯èƒ½ä¸ä¸€è‡´</li><li>åœºæ™¯ï¼šæ›´æ–°é¢‘ç‡è¾ƒä½ï¼Œæ—¶æ•ˆæ€§è¦æ±‚ä½çš„ä¸šåŠ¡</li></ul><p><strong>åŒæ­¥åŒå†™</strong>ï¼šåœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶ï¼Œç›´æ¥ä¿®æ”¹ç¼“å­˜</p><ul><li>ä¼˜åŠ¿ï¼šæ—¶æ•ˆæ€§å¼ºï¼Œç¼“å­˜ä¸æ•°æ®åº“å¼ºä¸€è‡´</li><li>ç¼ºç‚¹ï¼šæœ‰ä»£ç ä¾µå…¥ï¼Œè€¦åˆåº¦é«˜ï¼›</li><li>åœºæ™¯ï¼šå¯¹ä¸€è‡´æ€§ã€æ—¶æ•ˆæ€§è¦æ±‚è¾ƒé«˜çš„ç¼“å­˜æ•°æ®</li></ul><p><strong>å¼‚æ­¥é€šçŸ¥ï¼š</strong>ä¿®æ”¹æ•°æ®åº“æ—¶å‘é€äº‹ä»¶é€šçŸ¥ï¼Œç›¸å…³æœåŠ¡ç›‘å¬åˆ°é€šçŸ¥åä¿®æ”¹ç¼“å­˜æ•°æ®</p><ul><li>ä¼˜åŠ¿ï¼šä½è€¦åˆï¼Œå¯ä»¥åŒæ—¶é€šçŸ¥å¤šä¸ªç¼“å­˜æœåŠ¡</li><li>ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§ä¸€èˆ¬ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´ä¸ä¸€è‡´çŠ¶æ€</li><li>åœºæ™¯ï¼šæ—¶æ•ˆæ€§è¦æ±‚ä¸€èˆ¬ï¼Œæœ‰å¤šä¸ªæœåŠ¡éœ€è¦åŒæ­¥</li></ul><h4 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h4><blockquote><p>canalæ˜¯é˜¿é‡Œå·´å·´æ——ä¸‹çš„ä¸€æ¬¾å¼€æºé¡¹ç›®ï¼ŒåŸºäºJavaå¼€å‘ã€‚åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…&amp;æ¶ˆè´¹ã€‚GitHubçš„åœ°å€ï¼š<a href="https://github.com/alibaba/canal">https://github.com/alibaba/canal</a></p><p>Canalæ˜¯åŸºäº<strong>mysqlçš„ä¸»ä»åŒæ­¥</strong>æ¥å®ç°çš„</p><p>Canalå°±æ˜¯æŠŠè‡ªå·±ä¼ªè£…æˆMySQLçš„ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œä»è€Œç›‘å¬masterçš„binary logå˜åŒ–ã€‚å†æŠŠå¾—åˆ°çš„å˜åŒ–ä¿¡æ¯é€šçŸ¥ç»™Canalçš„å®¢æˆ·ç«¯ï¼Œè¿›è€Œå®Œæˆå¯¹å…¶å®ƒæ•°æ®åº“çš„åŒæ­¥ã€‚</p></blockquote><h4 id="Canalå®‰è£…"><a href="#Canalå®‰è£…" class="headerlink" title="Canalå®‰è£…"></a>Canalå®‰è£…</h4><ul><li><p>1.å…ˆæ‰“å¼€mysqlä¸»ä»</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ‰“å¼€mysqlå®¹å™¨æŒ‚è½½çš„æ—¥å¿—æ–‡ä»¶/tmp/mysql/conf</span><br>vi /tmp/mysql/conf/my.cnf<br><br><span class="hljs-comment"># æ·»åŠ å†…å®¹(äºŒè¿›åˆ¶æ—¥å¿—è®°å½•çš„ä½ç½®ï¼Œè®°å½•çš„æ•°æ®åº“)</span><br>log-bin=/var/lib/mysql/mysql-bin<br>binlog-do-db=heima<br></code></pre></td></tr></table></figure></li><li><p>1.1æ·»åŠ ç”¨äºæ•°æ®åŒæ­¥çš„ç”¨æˆ·</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> canal@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;canal&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">REPLICATION</span> SLAVE, <span class="hljs-keyword">REPLICATION</span> CLIENT,SUPER <span class="hljs-keyword">ON</span> *.* <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;canal&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;canal&#x27;</span>;<br>FLUSH <span class="hljs-keyword">PRIVILEGES</span>;<br></code></pre></td></tr></table></figure></li><li><p>1.2é‡å¯mysqlå®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker restart mysql<br><br><span class="hljs-comment">#æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¼€å¯</span><br>show master status;<br></code></pre></td></tr></table></figure></li><li><p>2.åˆ›å»ºç½‘ç»œè®©mysqlå’Œcanalèƒ½å¤Ÿé€šä¿¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ›å»ºç½‘ç»œ(åå­—åŠ heima)</span><br>docker network create heima<br><span class="hljs-comment"># å°†mysqlå®¹å™¨æ·»åŠ åˆ°ç½‘ç»œä¸­</span><br>docker network connect heima mysql<br></code></pre></td></tr></table></figure></li><li><p>3.<a href="https://blog.csdn.net/qq_29116427/article/details/106498040">å®‰è£…canal</a></p></li><li><p>4.åˆ›å»ºCanalå®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -p 11111:11111 --name canal \<br>-e canal.destinations=heima \<br>-e canal.instance.master.address=mysql:3306  \<br>-e canal.instance.dbUsername=canal  \<br>-e canal.instance.dbPassword=canal  \<br>-e canal.instance.connectionCharset=UTF-8 \<br>-e canal.instance.tsdb.enable=<span class="hljs-literal">true</span> \<br>-e canal.instance.gtidon=<span class="hljs-literal">false</span>  \<br>-e canal.instance.filter.regex=heima\\..* \<br>--network heima \<br>-d canal/canal-server:v1.1.5<br></code></pre></td></tr></table></figure><ul><li><code>-p 11111:11111</code>ï¼šè¿™æ˜¯canalçš„é»˜è®¤ç›‘å¬ç«¯å£</li><li><code>-e canal.instance.master.address=mysql:3306</code>ï¼šæ•°æ®åº“åœ°å€å’Œç«¯å£ï¼Œå¦‚æœä¸çŸ¥é“mysqlå®¹å™¨åœ°å€ï¼Œå¯ä»¥é€šè¿‡<code>docker inspect å®¹å™¨id</code>æ¥æŸ¥çœ‹</li><li><code>-e canal.instance.dbUsername=canal</code>ï¼šæ•°æ®åº“ç”¨æˆ·å</li><li><code>-e canal.instance.dbPassword=canal</code> ï¼šæ•°æ®åº“å¯†ç </li><li><code>-e canal.instance.filter.regex=</code>ï¼šè¦ç›‘å¬çš„è¡¨åç§°</li></ul></li></ul><h4 id="ä½¿ç”¨Canal"><a href="#ä½¿ç”¨Canal" class="headerlink" title="ä½¿ç”¨Canal"></a>ä½¿ç”¨Canal</h4><blockquote><p>å½“Canalç›‘å¬åˆ°binlogå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥Canalçš„å®¢æˆ·ç«¯</p></blockquote><p>ä½¿ç”¨GitHubä¸Šçš„ç¬¬ä¸‰æ–¹å¼€æºçš„<a href="https://github.com/NormanGyllenhaal/canal-client">canal-starter</a>å®¢æˆ·ç«¯æ¥ä½¿ç”¨Canal</p><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>top.javatool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>canal-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.1-RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">canal:</span><br>  <span class="hljs-attr">destination:</span> <span class="hljs-string">heima</span>  <span class="hljs-comment">#canalé›†ç¾¤åç§°</span><br>  <span class="hljs-attr">server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:11111</span> <span class="hljs-comment">#canalå¯¹åº”ipç«¯å£</span><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡@Idã€@Columnã€ç­‰æ³¨è§£å®ŒæˆItemä¸æ•°æ®åº“è¡¨å­—æ®µçš„æ˜ å°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.heima.item.pojo;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(&quot;tb_item&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span> &#123;<br>    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<span class="hljs-comment">//å•†å“id</span><br>    <span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//å•†å“åç§°</span><br>    <span class="hljs-keyword">private</span> String title;<span class="hljs-comment">//å•†å“æ ‡é¢˜</span><br>    <span class="hljs-keyword">private</span> Long price;<span class="hljs-comment">//ä»·æ ¼ï¼ˆåˆ†ï¼‰</span><br>    <span class="hljs-keyword">private</span> String image;<span class="hljs-comment">//å•†å“å›¾ç‰‡</span><br>    <span class="hljs-keyword">private</span> String category;<span class="hljs-comment">//åˆ†ç±»åç§°</span><br>    <span class="hljs-keyword">private</span> String brand;<span class="hljs-comment">//å“ç‰Œåç§°</span><br>    <span class="hljs-keyword">private</span> String spec;<span class="hljs-comment">//è§„æ ¼</span><br>    <span class="hljs-keyword">private</span> Integer status;<span class="hljs-comment">//å•†å“çŠ¶æ€ 1-æ­£å¸¸ï¼Œ2-ä¸‹æ¶</span><br>    <span class="hljs-keyword">private</span> Date createTime;<span class="hljs-comment">//åˆ›å»ºæ—¶é—´</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<span class="hljs-comment">//æ›´æ–°æ—¶é—´</span><br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-meta">@Transient</span><br>    <span class="hljs-keyword">private</span> Integer stock;<br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-meta">@Transient</span><br>    <span class="hljs-keyword">private</span> Integer sold;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™ç›‘å¬å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç›‘å¬mysqlå˜åŒ–ï¼Œæ›´æ–°redisç¼“å­˜å’ŒJVMç¼“å­˜</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@CanalTable(&quot;tb_item&quot;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ItemHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EntryHandler</span>&lt;Item&gt; &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisHandler redisHandler;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Cache&lt;Long, Item&gt; cache;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Item item)</span> &#123;<br>        cache.put(item.getId(), item);<br><br>        redisHandler.saveItem(item);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Item before, Item after)</span> &#123;<br>        cache.put(after.getId(), after);<br><br>        redisHandler.saveItem(after);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Item item)</span> &#123;<br>        cache.invalidate(item.getId());<br>        redisHandler.deleteItemById(item.getId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UMLå›¾</title>
    <link href="/2022/09/29/%E8%BD%AF%E8%80%83/UML%E5%9B%BE/"/>
    <url>/2022/09/29/%E8%BD%AF%E8%80%83/UML%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="UMLå›¾"><a href="#UMLå›¾" class="headerlink" title="UMLå›¾"></a>UMLå›¾</h2><ul><li><p>ç±»å›¾</p><blockquote><p>å±•ç°äº†ä¸€ç»„å¯¹è±¡ã€æ¥å£ã€åä½œå’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»</p></blockquote></li><li><p>å¯¹è±¡å›¾</p><blockquote><p>å±•ç¤ºæŸä¸€æ—¶åˆ»ä¸€ç»„å¯¹è±¡é—´çš„å…³ç³»</p></blockquote></li><li><p>ç”¨ä¾‹å›¾</p><blockquote><p>å±•ç°äº†ä¸€ç»„ç”¨ä¾‹ã€å‚ä¸è€…ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»</p><p>åŒ…å«ã€æ‰©å±•ã€æ³›åŒ–å…³ç³»</p></blockquote><p><img src="/img/post_img/%E7%94%A8%E4%BE%8B%E5%9B%BE.png"></p></li><li><p>éƒ¨ç½²å›¾</p><blockquote><p>æè¿°äº†ç³»ç»Ÿè¿è¡Œæ—¶è¿›è¡Œå¤„ç†çš„ç»“ç‚¹ä»¥åŠåœ¨ç»“ç‚¹ä¸Šæ´»åŠ¨çš„æ„ä»¶çš„é…ç½®ã€‚å¼ºè°ƒäº†<strong>ç‰©ç†è®¾å¤‡</strong>ä»¥åŠä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚</p></blockquote><p><img src="/img/post_img/%E9%83%A8%E7%BD%B2%E5%9B%BE.png"></p></li><li><p>ç»„ä»¶å›¾</p><blockquote><p>æ„ä»¶å›¾æ˜¯ç”¨æ¥è¡¨ç¤ºç³»ç»Ÿä¸­æ„ä»¶ä¸æ„ä»¶ä¹‹é—´ï¼Œç±»æˆ–æ¥å£ä¸æ„ä»¶ä¹‹é—´çš„å…³ç³»å›¾ã€‚å…¶ä¸­ï¼Œæ„ä»¶å›¾ä¹‹é—´çš„å…³ç³»è¡¨ç°ä¸ºä¾èµ–å…³ç³»ï¼Œå®šä¹‰çš„ç±»æˆ–æ¥å£ä¸ç±»ä¹‹é—´çš„å…³ç³»è¡¨ç°ä¸ºä¾èµ–å…³ç³»æˆ–å®ç°å…³ç³»</p></blockquote><p><img src="/img/post_img/%E7%BB%84%E4%BB%B6%E5%9B%BE.png"></p></li><li><p>çŠ¶æ€å›¾</p><blockquote><p>ç”±çŠ¶æ€ã€å˜è¿ã€äº‹ä»¶å’Œæ´»åŠ¨ç»„æˆçš„çŠ¶æ€æœºï¼Œç”¨æ¥æè¿°ç±»çš„å¯¹è±¡æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ä»¥åŠæ—¶é—´å‘ç”Ÿæ—¶çŠ¶æ€çš„è½¬ç§»æ¡ä»¶ã€‚</p></blockquote><p><img src="/img/post_img/%E7%8A%B6%E6%80%81%E5%9B%BE.png"></p></li><li><p>æ´»åŠ¨å›¾</p><blockquote><p>çŠ¶æ€å›¾çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œè¿™äº›çŠ¶æ€å¤§éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚æœ¬è´¨æ˜¯ä¸€ç§æµç¨‹å›¾ï¼Œå®ƒæè¿°äº†æ´»åŠ¨åˆ°æ´»åŠ¨çš„æ§åˆ¶æµã€‚</p></blockquote><p><img src="/img/post_img/%E6%B4%BB%E5%8A%A8%E5%9B%BE.png"></p></li><li><p>æ—¶åºå›¾</p><p><img src="/img/post_img/%E6%97%B6%E5%BA%8F%E5%9B%BE.png"></p></li><li><p>åä½œå›¾</p><p><img src="/img/post_img/%E5%8D%8F%E4%BD%9C%E5%9B%BE.png"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼ç¼“å­˜</title>
    <link href="/2022/09/25/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/"/>
    <url>/2022/09/25/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h2><blockquote><p>redisç‰ˆæœ¬6.2.4</p></blockquote><h3 id="RedisæŒä¹…åŒ–"><a href="#RedisæŒä¹…åŒ–" class="headerlink" title="RedisæŒä¹…åŒ–"></a>RedisæŒä¹…åŒ–</h3><blockquote><p>RDB (Redis Database Backup file) Redisæ•°æ®å¤‡ä»½æ–‡ä»¶</p><p>AOF (Append Only File) è¿½åŠ æ–‡ä»¶ </p></blockquote><p>RDBæŒä¹…åŒ–åœ¨å››ç§æƒ…å†µä¸‹ä¼šæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œsaveå‘½ä»¤ï¼šåŒæ­¥ä¿å­˜ï¼Œä¼šå¯¼è‡´å…¶ä»–å‘½ä»¤è¢«é˜»å¡</li><li>æ‰§è¡Œbgsaveå‘½ä»¤ï¼šbackground save å¼‚æ­¥ä¿å­˜ï¼Œä¸ä¼šå½±å“ä¸»è¿›ç¨‹</li><li>Redisåœæœºæ—¶ï¼šè‡ªåŠ¨æ‰§è¡Œsaveå‘½ä»¤</li><li>è§¦å‘RDBæ¡ä»¶æ—¶</li></ul><p> AOFåŸç†</p><ul><li>Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•çš„æ˜¯æ­¥éª¤</li></ul><h4 id="è®¾ç½®RDBè§¦å‘æ¡ä»¶"><a href="#è®¾ç½®RDBè§¦å‘æ¡ä»¶" class="headerlink" title="è®¾ç½®RDBè§¦å‘æ¡ä»¶"></a>è®¾ç½®RDBè§¦å‘æ¡ä»¶</h4><ul><li><p>ä¿®æ”¹redisç›®å½•ä¸‹çš„redis.confæ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span><br><span class="hljs-attribute">save</span> <span class="hljs-number">900</span> <span class="hljs-number">1</span>  <br><span class="hljs-attribute">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span>  <br><span class="hljs-attribute">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span> <br><br><span class="hljs-comment"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span><br><span class="hljs-attribute">rdbcompression</span> yes<br><br><span class="hljs-comment"># RDBæ–‡ä»¶åç§°</span><br><span class="hljs-attribute">dbfilename</span> dump.rdb  <br><br><span class="hljs-comment"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span><br><span class="hljs-attribute">dir</span> ./ <br></code></pre></td></tr></table></figure></li></ul><h4 id="è®¾ç½®AOF"><a href="#è®¾ç½®AOF" class="headerlink" title="è®¾ç½®AOF"></a>è®¾ç½®AOF</h4><ul><li><p>å¼€å¯AOF</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br>appendonly <span class="hljs-literal">no</span>--&gt;   appendonly <span class="hljs-literal">yes</span><br><br><span class="hljs-comment">#AOFæ–‡ä»¶å</span><br>appendfilename <span class="hljs-string">&quot;appendonly.aof&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®è®°å½•é¢‘ç‡</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># always: æ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span><br><span class="hljs-comment"># every sync: å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span><br><span class="hljs-comment"># no: å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span><br><br><span class="hljs-comment"># appendfsync always</span><br><span class="hljs-attribute">appendfsync</span> everysec<br><span class="hljs-comment"># appendfsync no</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šï¼Œæ•…éœ€è¦é‡å†™AOFæ–‡ä»¶æ¥å‹ç¼©ä½“ç§¯</p></blockquote><ul><li><p>è®¾ç½®é‡å†™è§¦å‘æ¡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span><br><span class="hljs-attribute">auto</span>-aof-rewrite-percentage <span class="hljs-number">100</span><br><span class="hljs-comment"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span><br><span class="hljs-attribute">auto</span>-aof-rewrite-min-size <span class="hljs-number">64</span>mb <br></code></pre></td></tr></table></figure></li></ul><h4 id="RDBå’ŒAOFæ¯”è¾ƒ"><a href="#RDBå’ŒAOFæ¯”è¾ƒ" class="headerlink" title="RDBå’ŒAOFæ¯”è¾ƒ"></a>RDBå’ŒAOFæ¯”è¾ƒ</h4><p><img src="/img/weifuwu_img/RDB%E5%92%8CAOF%E6%AF%94%E8%BE%83.png" alt="RDBå’ŒAOFæ¯”è¾ƒ"></p><h3 id="Redisä¸»ä»èŠ‚ç‚¹"><a href="#Redisä¸»ä»èŠ‚ç‚¹" class="headerlink" title="Redisä¸»ä»èŠ‚ç‚¹"></a>Redisä¸»ä»èŠ‚ç‚¹</h3><h4 id="é…ç½®ä¸»ä»èŠ‚ç‚¹"><a href="#é…ç½®ä¸»ä»èŠ‚ç‚¹" class="headerlink" title="é…ç½®ä¸»ä»èŠ‚ç‚¹"></a>é…ç½®ä¸»ä»èŠ‚ç‚¹</h4><ul><li><p>å‡†å¤‡å®ä¾‹å’Œé…ç½®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å¤åˆ¶ä¸‰ä»½redis.confé…ç½®æ–‡ä»¶åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ä¸‹</span><br><span class="hljs-built_in">cp</span> redis-4.0.0/redis.conf 7001<br><span class="hljs-built_in">cp</span> redis-4.0.0/redis.conf 7002<br><span class="hljs-built_in">cp</span> redis-4.0.0/redis.conf 7003<br></code></pre></td></tr></table></figure><p><img src="/img/weifuwu_img/redis%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="å¤åˆ¶é…ç½®æ–‡ä»¶"></p></li><li><p>ä¿®æ”¹ç«¯å£å’Œå·¥ä½œç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i -e <span class="hljs-string">&#x27;s/6379/7001/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/home\/cyx\/redis\/7001\//g&#x27;</span> 7001/redis.conf<br>sed -i -e <span class="hljs-string">&#x27;s/6379/7002/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/home\/cyx\/redis\/7002\//g&#x27;</span> 7002/redis.conf<br>sed -i -e <span class="hljs-string">&#x27;s/6379/7003/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/home\/cyx\/redis\/7003\//g&#x27;</span> 7003/redis.conf<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</p><blockquote><p>è™šæ‹Ÿæœºæœ¬èº«æœ‰å¤šä¸ªIPï¼Œä¸ºäº†é¿å…å°†æ¥æ··ä¹±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­æŒ‡å®šæ¯ä¸€ä¸ªå®ä¾‹çš„ç»‘å®šipä¿¡æ¯ï¼Œ</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i <span class="hljs-string">&#x27;1a slave-announce-ip 192.168.229.128&#x27;</span> 7001/redis.conf<br>sed -i <span class="hljs-string">&#x27;1a slave-announce-ip 192.168.229.128&#x27;</span> 7002/redis.conf<br>sed -i <span class="hljs-string">&#x27;1a slave-announce-ip 192.168.229.128&#x27;</span> 7003/redis.conf<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æœåŠ¡ç«¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ†åˆ«å¯åŠ¨ä¸‰ä¸ªæœåŠ¡ç«¯</span><br>[root@root src]<span class="hljs-comment"># ./redis-server ../../7001/redis.conf</span><br><br>[root@root src]<span class="hljs-comment"># ./redis-server ../../7002/redis.conf</span><br><br>[root@root src]<span class="hljs-comment"># ./redis-server ../../7003/redis.conf</span><br></code></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯è¿æ¥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># -pé€‰æ‹©ç«¯å£</span><br>redis-cli -p 7001<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®ä¸»ä»èŠ‚ç‚¹</p><blockquote><p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p><ul><li>åœ¨redis.confä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š<code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul></li><li><p>ä½¿ç”¨redis-cliå®¢æˆ·ç«¯è¿æ¥åˆ°redisæœåŠ¡ï¼Œæ‰§è¡Œslaveofå‘½ä»¤ï¼ˆé‡å¯åå¤±æ•ˆï¼‰</p></li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿æ¥ 7002</span><br>redis-cli -p 7002<br><span class="hljs-comment"># æ‰§è¡Œslaveof</span><br>slaveof 192.168.229.128 7001<br><br><span class="hljs-comment"># è¿æ¥ 7003</span><br>redis-cli -p 7003<br><span class="hljs-comment"># æ‰§è¡Œslaveof</span><br>slaveof 192.168.229.128 7001<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><blockquote><p>é€šè¿‡7001ç«¯å£çš„ä¸»èŠ‚ç‚¹å†™å…¥æ•°æ®ï¼Œåœ¨ä»èŠ‚ç‚¹ä¹Ÿèƒ½è¯»å¾—åˆ°</p></blockquote></li></ul><h4 id="ä¸»ä»åŒæ­¥æµç¨‹"><a href="#ä¸»ä»åŒæ­¥æµç¨‹" class="headerlink" title="ä¸»ä»åŒæ­¥æµç¨‹"></a>ä¸»ä»åŒæ­¥æµç¨‹</h4><p><img src="/img/weifuwu_img/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E6%B5%81%E7%A8%8B.png" alt="ä¸»ä»åŒæ­¥æµç¨‹.png"></p><p>æ¦‚å¿µ</p><blockquote><ul><li><strong>Replication Id</strong>ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li><strong>offset</strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„replication id å’Œoffsetï¼Œmasteræ‰å¯ä»¥åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p></blockquote><p>å®Œæ•´æµç¨‹æè¿°ï¼š</p><ul><li>slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li><li>masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li><li>masterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave</li><li>slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB</li><li>masterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave</li><li>slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥</li></ul><h3 id="Rediså“¨å…µ"><a href="#Rediså“¨å…µ" class="headerlink" title="Rediså“¨å…µ"></a>Rediså“¨å…µ</h3><blockquote><p>Redisæä¾›äº†å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶æ¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ã€‚</p></blockquote><h4 id="å“¨å…µä½œç”¨"><a href="#å“¨å…µä½œç”¨" class="headerlink" title="å“¨å…µä½œç”¨"></a>å“¨å…µä½œç”¨</h4><p><img src="/img/weifuwu_img/Redis%E5%93%A8%E5%85%B5.png" alt="Rediså“¨å…µ"></p><p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘æ§</strong>ï¼šSentinel ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li><strong>é€šçŸ¥</strong>ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯</li></ul><p>Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·</p><ul><li>æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿</li><li>å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡ä¸‹çº¿</li></ul><p>æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</p><ul><li>é¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œslaveof no one</li><li>ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œslaveof æ–°master</li><li>ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveof æ–°master</li></ul><h4 id="é…ç½®å“¨å…µèŠ‚ç‚¹"><a href="#é…ç½®å“¨å…µèŠ‚ç‚¹" class="headerlink" title="é…ç½®å“¨å…µèŠ‚ç‚¹"></a>é…ç½®å“¨å…µèŠ‚ç‚¹</h4><ul><li><p>å‡†å¤‡å®ä¾‹å’Œé…ç½®</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾sentinelçš„é…ç½®æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p><img src="/img/weifuwu_img/Redis%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png"></p></li><li><p>æ¯ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªsentinel.confæ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">port 27001<br>sentinel announce-ip 192.168.229.128<br>sentinel monitor mymaster 192.168.229.128 7001 2<br>sentinel down-after-milliseconds mymaster 5000<br>sentinel failover-timeout mymaster 60000<br><span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;/home/cyx/redis/sentinel1&quot;</span><br></code></pre></td></tr></table></figure><p>è§£è¯»ï¼š</p><ul><li><code>port 27001</code>ï¼šæ˜¯å½“å‰sentinelå®ä¾‹çš„ç«¯å£</li><li><code>sentinel monitor mymaster 192.168.150.101 7001 2</code>ï¼šæŒ‡å®šä¸»èŠ‚ç‚¹ä¿¡æ¯<ul><li><code>mymaster</code>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</li><li><code>192.168.150.101 7001</code>ï¼šä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</li><li><code>2</code>ï¼šé€‰ä¸¾masteræ—¶çš„quorumå€¼</li></ul></li></ul></li><li><p>ä¿®æ”¹æ¯ä¸ªé…ç½®æ–‡ä»¶çš„ç«¯å£<code>port XXX</code></p></li><li><p>å¯åŠ¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># ç¬¬1ä¸ª</span><br>.<span class="hljs-regexp">/redis-sentinel ../</span>..<span class="hljs-regexp">/sentinel1/</span>sentinel.conf<br><span class="hljs-comment"># ç¬¬2ä¸ª</span><br>.<span class="hljs-regexp">/redis-sentinel ../</span>..<span class="hljs-regexp">/sentinel2/</span>sentinel.conf<br><span class="hljs-comment"># ç¬¬3ä¸ª</span><br>.<span class="hljs-regexp">/redis-sentinel ../</span>..<span class="hljs-regexp">/sentinel3/</span>sentinel.conf<br></code></pre></td></tr></table></figure></li><li><p>å‡ºç°æ— æ³•æ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œè¯•è¯•æŠŠä»èŠ‚ç‚¹çš„slaveof æ”¹æˆ slaveof 127.0.0.1 ä¸»èŠ‚ç‚¹ç«¯å£</p></li></ul><h4 id="RedisTemplate"><a href="#RedisTemplate" class="headerlink" title="RedisTemplate"></a>RedisTemplate</h4><p><strong>å¯¼å…¥åæ ‡</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®Redisåœ°å€</strong></p><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶application.ymlä¸­æŒ‡å®šredisçš„sentinelç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  redis:<br>    sentinel:<br>      master: mymaster<br>      nodes:<br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27001</span><br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27002</span><br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27003</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®è¯»å†™åˆ†ç¦»</strong></p><p>åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> LettuceClientConfigurationBuilderCustomizer <span class="hljs-title function_">clientConfigurationBuilderCustomizer</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> clientConfigurationBuilder -&gt; clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªbeanä¸­é…ç½®çš„å°±æ˜¯è¯»å†™ç­–ç•¥ï¼ŒåŒ…æ‹¬å››ç§ï¼š</p><ul><li>MASTERï¼šä»ä¸»èŠ‚ç‚¹è¯»å–</li><li>MASTER_PREFERREDï¼šä¼˜å…ˆä»masterèŠ‚ç‚¹è¯»å–ï¼Œmasterä¸å¯ç”¨æ‰è¯»å–replica</li><li>REPLICAï¼šä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–</li><li>REPLICA _PREFERREDï¼šä¼˜å…ˆä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–ï¼Œæ‰€æœ‰çš„slaveéƒ½ä¸å¯ç”¨æ‰è¯»å–master</li></ul><h3 id="Redisåˆ†ç‰‡é›†ç¾¤"><a href="#Redisåˆ†ç‰‡é›†ç¾¤" class="headerlink" title="Redisåˆ†ç‰‡é›†ç¾¤"></a>Redisåˆ†ç‰‡é›†ç¾¤</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>åˆ†ç‰‡é›†ç¾¤ç‰¹ç‚¹</p><ul><li><p>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®</p></li><li><p>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</p></li><li><p>masterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</p></li><li><p>å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</p></li></ul><p>æ•£åˆ—æ’æ§½</p><p>0~16383å…±16384ä¸ªæ’æ§½ä¼šè¢«åˆ†é…åˆ°masterèŠ‚ç‚¹ä¸Šï¼Œ</p><p>æ•°æ®keyä¸æ˜¯ä¸èŠ‚ç‚¹ç»‘å®šï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šï¼Œredisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½å€¼</p><ul><li>keyä¸­åŒ…å«â€{}â€ï¼Œä¸”â€œ{}â€ä¸­è‡³å°‘åŒ…å«1ä¸ªå­—ç¬¦ï¼Œâ€œ{}â€ä¸­çš„éƒ¨åˆ†æ˜¯æœ‰æ•ˆéƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡{}æ¥å°†åŒä¸€ç±»æ•°æ®å­˜å‚¨åˆ°åŒä¸€ä¸ªRediså®ä¾‹ä¸­</li><li>keyä¸­ä¸åŒ…å«â€œ{}â€ï¼Œæ•´ä¸ªkeyéƒ½æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li></ul><h4 id="é…ç½®åˆ†ç‰‡é›†ç¾¤å®ä¾‹"><a href="#é…ç½®åˆ†ç‰‡é›†ç¾¤å®ä¾‹" class="headerlink" title="é…ç½®åˆ†ç‰‡é›†ç¾¤å®ä¾‹"></a>é…ç½®åˆ†ç‰‡é›†ç¾¤å®ä¾‹</h4><h5 id="å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>å‡†å¤‡å®ä¾‹å’Œé…ç½®</h5><ul><li><p>å‡†å¤‡å®ä¾‹å’Œé…ç½®</p><table><thead><tr><th align="center">IP</th><th align="center">PORT</th><th align="center">è§’è‰²</th></tr></thead><tbody><tr><td align="center">192.168.229.128</td><td align="center">7001</td><td align="center">master</td></tr><tr><td align="center">192.168.229.128</td><td align="center">7002</td><td align="center">master</td></tr><tr><td align="center">192.168.229.128</td><td align="center">7003</td><td align="center">master</td></tr><tr><td align="center">192.168.229.128</td><td align="center">8001</td><td align="center">slave</td></tr><tr><td align="center">192.168.229.128</td><td align="center">8002</td><td align="center">slave</td></tr><tr><td align="center">192.168.229.128</td><td align="center">8003</td><td align="center">slave</td></tr></tbody></table></li><li><p>åˆ›å»ºé…ç½®æ–‡ä»¶redis.conf</p><p><img src="/img/weifuwu_img/redis%E5%88%86%E7%89%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh">port 6379<br><span class="hljs-comment"># å¼€å¯é›†ç¾¤åŠŸèƒ½</span><br>cluster-enabled <span class="hljs-built_in">yes</span><br><span class="hljs-comment"># é›†ç¾¤çš„é…ç½®æ–‡ä»¶åç§°ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œç”±redisè‡ªå·±ç»´æŠ¤</span><br>cluster-config-file /home/cyx/redis/6379/nodes.conf<br><span class="hljs-comment"># èŠ‚ç‚¹å¿ƒè·³å¤±è´¥çš„è¶…æ—¶æ—¶é—´</span><br>cluster-node-timeout 5000<br><span class="hljs-comment"># æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="hljs-built_in">dir</span> /home/cyx/redis/6379<br><span class="hljs-comment"># ç»‘å®šåœ°å€</span><br><span class="hljs-built_in">bind</span> 0.0.0.0<br><span class="hljs-comment"># è®©redisåå°è¿è¡Œ</span><br>daemonize <span class="hljs-built_in">yes</span><br><span class="hljs-comment"># æ³¨å†Œçš„å®ä¾‹ip</span><br>replica-announce-ip 192.168.229.128<br><span class="hljs-comment"># ä¿æŠ¤æ¨¡å¼</span><br>protected-mode no<br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡</span><br>databases 1<br><span class="hljs-comment"># æ—¥å¿—</span><br>logfile /home/cyx/redis/6379/run.log<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># æ‰§è¡Œæ‹·è´</span><br><span class="hljs-attribute">echo</span> <span class="hljs-number">7001</span> <span class="hljs-number">7002</span> <span class="hljs-number">7003</span> <span class="hljs-number">8001</span> <span class="hljs-number">8002</span> <span class="hljs-number">8003</span> | xargs -t -n <span class="hljs-number">1</span> cp redis.conf<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶,å°†å…¶ä¸­çš„6379ä¿®æ”¹ä¸ºä¸æ‰€åœ¨ç›®å½•ä¸€è‡´</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åŒæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t sed -i <span class="hljs-string">&#x27;s/6379/&#123;&#125;/g&#x27;</span> &#123;&#125;/redis.conf<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨&#x2F;å…³é—­</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#åŒæ—¶å¯åŠ¨æ‰€æœ‰redis</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-server &#123;&#125;/redis.conf<br><br><span class="hljs-comment">#æŸ¥çœ‹redisè¿›ç¨‹</span><br>ps -ef | grep redis<br><br><span class="hljs-comment">#å…³é—­æ‰€æœ‰redisè¿›ç¨‹</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-cli -p &#123;&#125; shutdown<br></code></pre></td></tr></table></figure></li></ul><h5 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h5><ul><li><p>é›†ç¾¤ç®¡ç†ä»¥åŠé›†æˆåˆ°äº†redis-cliä¸­</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli --cluster create --cluster-replicas 1 192.168.229.128:7001 192.168.229.128:7002 192.168.229.128:7003 192.168.229.128:8001 192.168.229.128:8002 192.168.229.128:8003<br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¯´æ˜ï¼š</p><ul><li><code>redis-cli --cluster</code>æˆ–è€…<code>./redis-trib.rb</code>ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</li><li><code>create</code>ï¼šä»£è¡¨æ˜¯åˆ›å»ºé›†ç¾¤</li><li><code>--replicas 1</code>æˆ–è€…<code>--cluster-replicas 1</code> ï¼šæŒ‡å®šé›†ç¾¤ä¸­æ¯ä¸ªmasterçš„å‰¯æœ¬ä¸ªæ•°ä¸º1ï¼Œæ­¤æ—¶<code>èŠ‚ç‚¹æ€»æ•° Ã· (replicas + 1)</code> å¾—åˆ°çš„å°±æ˜¯masterçš„æ•°é‡ã€‚å› æ­¤èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å‰nä¸ªå°±æ˜¯masterï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯slaveèŠ‚ç‚¹ï¼Œéšæœºåˆ†é…åˆ°ä¸åŒmaster</li></ul></li><li><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -p 7001 cluster nodes<br></code></pre></td></tr></table></figure></li></ul><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><ul><li><p>æ·»åŠ æ•°æ®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ‰“å¼€å®¢æˆ·ç«¯ï¼Œ-cä»£è¡¨é›†ç¾¤æ“ä½œ</span><br>redis-cli -c -p 7001<br><span class="hljs-comment"># ä¹‹åå°±å¯ä»¥CRUDäº†ï¼Œredisæ ¹æ®keyç®—å‡ºçš„hashå€¼å­˜åˆ°å¯¹åº”æ’æ§½ä¸­</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="æ“ä½œé›†ç¾¤"><a href="#æ“ä½œé›†ç¾¤" class="headerlink" title="æ“ä½œé›†ç¾¤"></a>æ“ä½œé›†ç¾¤</h5><ul><li><p>æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli --cluster <span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure></li></ul><p><img src="/img/weifuwu_img/Redis%E9%9B%86%E7%BE%A4%E6%93%8D%E4%BD%9C.png"></p><ul><li><p>æ·»åŠ èŠ‚ç‚¹åˆ°é›†ç¾¤(add-node)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ·»åŠ çš„èŠ‚ç‚¹æ˜¯æ²¡æœ‰æ’æ§½çš„</span><br>redis-cli --cluster add-node è¦æ·»åŠ çš„èŠ‚ç‚¹ip:ç«¯å£ ä¸€ä¸ªmaserèŠ‚ç‚¹çš„ip:ç«¯å£<br></code></pre></td></tr></table></figure></li><li><p>è½¬ç§»æ’æ§½(reshard)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli --cluster reshard è¦åˆ†é…æ’æ§½çš„Rediså®ä¾‹çš„ip:ç«¯å£<br><span class="hljs-comment"># ä¹‹åä¼šè®©è¾“å…¥è¦åˆ†é…çš„æ’æ§½æ•°é‡ã€ä»å“ªä¸ªèŠ‚ç‚¹ç§»åŠ¨æ’æ§½ã€è·Ÿç€æç¤ºæ¥å°±è¡Œ</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h4><h5 id="è‡ªåŠ¨æ•…éšœè½¬ç§»"><a href="#è‡ªåŠ¨æ•…éšœè½¬ç§»" class="headerlink" title="è‡ªåŠ¨æ•…éšœè½¬ç§»"></a>è‡ªåŠ¨æ•…éšœè½¬ç§»</h5><blockquote><p>å‡ºç°å®•æœºçš„èŠ‚ç‚¹æ—¶ï¼Œè‡ªåŠ¨æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„master</p><p>å®•æœºçš„èŠ‚ç‚¹é‡æ–°ä¸Šçº¿æ—¶ï¼Œä¼šå˜æˆslaveèŠ‚ç‚¹</p></blockquote><h5 id="æ‰‹åŠ¨æ•…éšœè½¬ç§»"><a href="#æ‰‹åŠ¨æ•…éšœè½¬ç§»" class="headerlink" title="æ‰‹åŠ¨æ•…éšœè½¬ç§»"></a>æ‰‹åŠ¨æ•…éšœè½¬ç§»</h5><blockquote><p>è¿›å…¥èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œcluster failoverå‘½ä»¤ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šç§°ä¸ºmasterèŠ‚ç‚¹</p></blockquote><h4 id="RedisTemplateè®¿é—®é›†ç¾¤"><a href="#RedisTemplateè®¿é—®é›†ç¾¤" class="headerlink" title="RedisTemplateè®¿é—®é›†ç¾¤"></a>RedisTemplateè®¿é—®é›†ç¾¤</h4><p> å’Œå“¨å…µæ¨¡å¼å·®ä¸å¤š</p><ul><li>å¼•å…¥redisçš„starterä¾èµ–</li><li>é…ç½®åˆ†ç‰‡é›†ç¾¤åœ°å€ (å°±è¿™æ­¥æœ‰å·®å¼‚)</li><li>é…ç½®è¯»å†™åˆ†ç¦»</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">cluster:</span><br>      <span class="hljs-attr">nodes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:7001</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:7002</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:7003</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:8001</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:8002</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><span class="hljs-string">:8003</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="/2022/09/20/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    <url>/2022/09/20/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="æ¦‚å¿µã€ç†è®º"><a href="#æ¦‚å¿µã€ç†è®º" class="headerlink" title="æ¦‚å¿µã€ç†è®º"></a>æ¦‚å¿µã€ç†è®º</h3><h4 id="æœ¬åœ°äº‹åŠ¡çš„å››å¤§ç‰¹æ€§"><a href="#æœ¬åœ°äº‹åŠ¡çš„å››å¤§ç‰¹æ€§" class="headerlink" title="æœ¬åœ°äº‹åŠ¡çš„å››å¤§ç‰¹æ€§"></a><strong>æœ¬åœ°äº‹åŠ¡</strong>çš„å››å¤§ç‰¹æ€§</h4><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</li></ul><p><img src="/img/weifuwu_img/%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7.png" alt="æœ¬åœ°äº‹åŠ¡ç‰¹æ€§"></p><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡-1"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-1" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong></h4><blockquote><p>æŒ‡ä¸æ˜¯åœ¨å•ä¸ªæœåŠ¡æˆ–å•ä¸ªæ•°æ®åº“æ¶æ„ä¸‹ï¼Œäº§ç”Ÿçš„äº‹åŠ¡</p></blockquote><h4 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a><strong>CAPç†è®º</strong></h4><blockquote><p>åœ¨Pä¸€å®šä¼šå‡ºç°çš„æƒ…å†µä¸‹ï¼ŒAå’ŒCä¹‹é—´åªèƒ½å®ç°ä¸€ä¸ª</p></blockquote><ul><li><p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰</p><blockquote><p>ç”¨æˆ·è®¿é—®åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®å¿…é¡»ä¸€è‡´ã€‚</p></blockquote></li><li><p>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰</p><blockquote><p>ç”¨æˆ·è®¿é—®é›†ç¾¤ä¸­çš„ä»»æ„å¥åº·èŠ‚ç‚¹ï¼Œå¿…é¡»èƒ½å¾—åˆ°å“åº”</p></blockquote></li><li><p>Partition tolerance ï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</p><blockquote><p>ä¸ºç½‘ç»œæ•…éšœæˆ–å…¶å®ƒåŸå› å¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹ä¸å…¶å®ƒèŠ‚ç‚¹å¤±å»è¿æ¥ï¼Œå½¢æˆç‹¬ç«‹åˆ†åŒº</p><p>åœ¨é›†ç¾¤å‡ºç°åˆ†åŒºæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿè¦æŒç»­å¯¹å¤–æä¾›æœåŠ¡</p></blockquote></li></ul><h4 id="BASEç†è®º"><a href="#BASEç†è®º" class="headerlink" title="BASEç†è®º"></a>BASEç†è®º</h4><blockquote><p>æ˜¯å¯¹CAPçš„ä¸€ç§è§£å†³æ€è·¯</p></blockquote><ul><li><strong>Basically Available</strong> <strong>ï¼ˆåŸºæœ¬å¯ç”¨ï¼‰</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œå³ä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚</li><li><strong>Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰ï¼š</strong>åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œå…è®¸å‡ºç°ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚ä¸´æ—¶çš„ä¸ä¸€è‡´çŠ¶æ€ã€‚</li><li><strong>Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</strong>ï¼šè™½ç„¶æ— æ³•ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨è½¯çŠ¶æ€ç»“æŸåï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®ä¸€è‡´ã€‚</li></ul><h4 id="äº‹åŠ¡åè°ƒè€…"><a href="#äº‹åŠ¡åè°ƒè€…" class="headerlink" title="äº‹åŠ¡åè°ƒè€…"></a>äº‹åŠ¡åè°ƒè€…</h4><p><img src="/img/weifuwu_img/%E4%BA%8B%E5%8A%A1%E5%8D%8F%E8%B0%83%E8%80%85.png" alt="äº‹åŠ¡åè°ƒè€…"></p><h3 id="Seate"><a href="#Seate" class="headerlink" title="Seate"></a>Seate</h3><blockquote><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</p></blockquote><p><a href="http://seata.io/">å®˜ç½‘</a></p><p><img src="/img/weifuwu_img/Seata%E6%9E%B6%E6%9E%84.png" alt="Seataæ¶æ„"></p><ul><li><p><strong>TC (Transaction Coordinator) -</strong> <strong>äº‹åŠ¡åè°ƒè€…ï¼š</strong>ç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li><li><p><strong>TM (Transaction Manager) -</strong> <strong>äº‹åŠ¡ç®¡ç†å™¨ï¼š</strong>å®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</p></li><li><p><strong>RM (Resource Manager) -</strong> <strong>èµ„æºç®¡ç†å™¨ï¼š</strong>ç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</p></li></ul><h4 id="éƒ¨ç½²TC"><a href="#éƒ¨ç½²TC" class="headerlink" title="éƒ¨ç½²TC"></a>éƒ¨ç½²TC</h4><blockquote><p>**TC (Transaction Coordinator) -**äº‹åŠ¡åè°ƒè€…</p></blockquote><ol><li><p>ä¸‹è½½seata-serveråŒ…å¹¶è§£å‹<a href="http://seata.io/zh-cn/blog/download.html">http</a><a href="http://seata.io/zh-cn/blog/download.html">:&#x2F;&#x2F;seata.io&#x2F;zh-cn&#x2F;blog&#x2F;download</a><a href="http://seata.io/zh-cn/blog/download.html">.</a><a href="http://seata.io/zh-cn/blog/download.html">html</a> </p></li><li><p>ä¿®æ”¹registry.confé…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs conf">registry &#123;<br>  # tcæœåŠ¡çš„æ³¨å†Œä¸­å¿ƒç±»file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa<br>  type = &quot;nacos&quot;<br><br>  nacos &#123;<br># seata tc æœåŠ¡æ³¨å†Œåˆ° nacosçš„æœåŠ¡åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰<br>    application = &quot;seata-tc-server&quot;<br>    serverAddr = &quot;127.0.0.1:8848&quot;<br>    group = &quot;DEFAULT_GROUP&quot;<br>    namespace = &quot;&quot;<br># é›†ç¾¤å<br>    cluster = &quot;default&quot;<br>    username = &quot;nacos&quot;<br>    password = &quot;nacos&quot;<br>  &#125;<br>  <br>&#125;<br><br>config &#123;<br>  # è¯»å–tcæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œè¿™é‡Œæ˜¯ä»nacosé…ç½®ä¸­å¿ƒè¯»å–ï¼Œè¿™æ ·å¦‚æœtcæ˜¯é›†ç¾¤ï¼Œå¯ä»¥å…±äº«é…ç½®<br>  # fileã€nacos ã€apolloã€zkã€consulã€etcd3<br>  type = &quot;nacos&quot;<br><br>  nacos &#123;<br>    serverAddr = &quot;127.0.0.1:8848&quot;<br>    namespace = &quot;&quot;<br>    group = &quot;SEATA_GROUP&quot;<br>    username = &quot;nacos&quot;<br>    password = &quot;nacos&quot;<br>    dataId = &quot;seataServer.properties&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>nacosæ·»åŠ é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œdbä»£è¡¨æ•°æ®åº“</span><br><span class="hljs-attr">store.mode</span>=<span class="hljs-string">db</span><br><span class="hljs-attr">store.db.datasource</span>=<span class="hljs-string">druid</span><br><span class="hljs-attr">store.db.dbType</span>=<span class="hljs-string">mysql</span><br><span class="hljs-attr">store.db.driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">store.db.url</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true&amp;serverTimezone=UTC</span><br><span class="hljs-attr">store.db.user</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">store.db.password</span>=<span class="hljs-string">123456</span><br><span class="hljs-attr">store.db.minConn</span>=<span class="hljs-string">5</span><br><span class="hljs-attr">store.db.maxConn</span>=<span class="hljs-string">30</span><br><span class="hljs-attr">store.db.globalTable</span>=<span class="hljs-string">global_table</span><br><span class="hljs-attr">store.db.branchTable</span>=<span class="hljs-string">branch_table</span><br><span class="hljs-attr">store.db.queryLimit</span>=<span class="hljs-string">100</span><br><span class="hljs-attr">store.db.lockTable</span>=<span class="hljs-string">lock_table</span><br><span class="hljs-attr">store.db.maxWait</span>=<span class="hljs-string">5000</span><br><span class="hljs-comment"># äº‹åŠ¡ã€æ—¥å¿—ç­‰é…ç½®</span><br><span class="hljs-attr">server.recovery.committingRetryPeriod</span>=<span class="hljs-string">1000</span><br><span class="hljs-attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="hljs-string">1000</span><br><span class="hljs-attr">server.recovery.rollbackingRetryPeriod</span>=<span class="hljs-string">1000</span><br><span class="hljs-attr">server.recovery.timeoutRetryPeriod</span>=<span class="hljs-string">1000</span><br><span class="hljs-attr">server.maxCommitRetryTimeout</span>=<span class="hljs-string">-1</span><br><span class="hljs-attr">server.maxRollbackRetryTimeout</span>=<span class="hljs-string">-1</span><br><span class="hljs-attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="hljs-string">false</span><br><span class="hljs-attr">server.undo.logSaveDays</span>=<span class="hljs-string">7</span><br><span class="hljs-attr">server.undo.logDeletePeriod</span>=<span class="hljs-string">86400000</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼ è¾“æ–¹å¼</span><br><span class="hljs-attr">transport.serialization</span>=<span class="hljs-string">seata</span><br><span class="hljs-attr">transport.compressor</span>=<span class="hljs-string">none</span><br><span class="hljs-comment"># å…³é—­metricsåŠŸèƒ½ï¼Œæé«˜æ€§èƒ½</span><br><span class="hljs-attr">metrics.enabled</span>=<span class="hljs-string">false</span><br><span class="hljs-attr">metrics.registryType</span>=<span class="hljs-string">compact</span><br><span class="hljs-attr">metrics.exporterList</span>=<span class="hljs-string">prometheus</span><br><span class="hljs-attr">metrics.exporterPrometheusPort</span>=<span class="hljs-string">9898</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ•°æ®åº“seataï¼ŒtcæœåŠ¡åœ¨ç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œéœ€è¦è®°å½•äº‹åŠ¡ç›¸å…³æ•°æ®åˆ°æ•°æ®åº“ä¸­ï¼Œéœ€è¦æå‰åˆ›å»ºå¥½è¿™äº›è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">SET</span> NAMES utf8mb4;<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- åˆ†æ”¯äº‹åŠ¡è¡¨</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `branch_table`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `branch_table`  (<br>  `branch_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `xid` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `resource_group_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `resource_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `branch_type` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `status` TINYINT(<span class="hljs-number">4</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `client_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_data` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2000</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` DATETIME(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_modified` DATETIME(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`branch_id`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `idx_xid`(`xid`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> INNODB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> COMPACT;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- å…¨å±€äº‹åŠ¡è¡¨</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `global_table`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `global_table`  (<br>  `xid` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `status` TINYINT(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_service_group` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `timeout` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `begin_time` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_data` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">2000</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` DATETIME <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_modified` DATETIME <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`xid`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `idx_gmt_modified_status`(`gmt_modified`, `status`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `idx_transaction_id`(`transaction_id`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> INNODB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> COMPACT;<br><br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure></li><li><p>seataçš„binç›®å½•ä¸‹æ‰§è¡Œseata-server.batæ¥å¯åŠ¨TC</p></li></ol><h4 id="å¾®æœåŠ¡é›†æˆSeata"><a href="#å¾®æœåŠ¡é›†æˆSeata" class="headerlink" title="å¾®æœåŠ¡é›†æˆSeata"></a>å¾®æœåŠ¡é›†æˆSeata</h4><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--seata--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ç‰ˆæœ¬è¾ƒä½ï¼Œ1.3.0ï¼Œå› æ­¤æ’é™¤--&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--seata starter é‡‡ç”¨1.4.2ç‰ˆæœ¬--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;seata.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®tcåœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">registry:</span> <span class="hljs-comment"># TCæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„é…ç½®ï¼Œå¾®æœåŠ¡æ ¹æ®è¿™äº›ä¿¡æ¯å»æ³¨å†Œä¸­å¿ƒè·å–tcæœåŠ¡åœ°å€</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span> <span class="hljs-comment"># æ³¨å†Œä¸­å¿ƒç±»å‹ nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span> <span class="hljs-comment"># nacosåœ°å€</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment"># namespaceï¼Œé»˜è®¤ä¸ºç©º</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span> <span class="hljs-comment"># åˆ†ç»„ï¼Œé»˜è®¤æ˜¯DEFAULT_GROUP</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">seata-tc-server</span> <span class="hljs-comment"># seataæœåŠ¡åç§°</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">nacos</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nacos</span><br>  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">seata-demo</span> <span class="hljs-comment"># äº‹åŠ¡ç»„åç§°</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-attr">vgroup-mapping:</span> <span class="hljs-comment"># äº‹åŠ¡ç»„ä¸clusterçš„æ˜ å°„å…³ç³»</span><br>      <span class="hljs-attr">seata-demo:</span> <span class="hljs-string">default</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="Seataçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#Seataçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Seataçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>Seataçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h4><p>Seataæä¾›äº†å››ç§ä¸åŒçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>XAæ¨¡å¼ï¼š<strong>å¼ºä¸€è‡´æ€§</strong>åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ï¼Œæ— ä¸šåŠ¡ä¾µå…¥</p><blockquote><p>äº‹åŠ¡åè°ƒè€…é€šçŸ¥æ¯ä¸ªäº‹ç‰©å‚ä¸è€…æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œåªæœ‰äº‹åŠ¡éƒ½æˆåŠŸäº†æ‰æäº¤</p><p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œå¹¶ä¸”æ²¡æœ‰ä»£ç ä¾µå…¥</p><p>ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå·®</p></blockquote></li><li><p>TCCæ¨¡å¼ï¼šæœ€ç»ˆä¸€è‡´çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p><blockquote><ul><li>Tryï¼šèµ„æºçš„æ£€æµ‹å’Œ<strong>é¢„ç•™</strong>ï¼› </li><li>Confirmï¼šå®Œæˆèµ„æºæ“ä½œä¸šåŠ¡ï¼›è¦æ±‚ Try æˆåŠŸ Confirm ä¸€å®šè¦èƒ½æˆåŠŸã€‚</li><li>Cancelï¼šé¢„ç•™èµ„æºé‡Šæ”¾ï¼Œå¯ä»¥ç†è§£ä¸ºtryçš„åå‘æ“ä½œã€‚</li></ul><p>ä¼˜ç‚¹ï¼šæ— éœ€ç”Ÿæˆå¿«ç…§ï¼Œæ— éœ€ä½¿ç”¨å…¨å±€é”ï¼Œæ€§èƒ½æœ€å¼º</p><p>ç¼ºç‚¹ï¼š<strong>æœ‰ä»£ç ä¾µå…¥</strong>ï¼Œéœ€è¦äººä¸ºç¼–å†™tryã€Confirmå’ŒCancelæ¥å£ï¼Œå­˜åœ¨è½¯çŠ¶æ€</p></blockquote></li><li><p>ATæ¨¡å¼ï¼š<strong>æœ€ç»ˆä¸€è‡´</strong>çš„åˆ†é˜¶æ®µäº‹åŠ¡æ¨¡å¼ï¼Œæ— ä¸šåŠ¡ä¾µå…¥ï¼Œä¹Ÿæ˜¯Seataçš„é»˜è®¤æ¨¡å¼</p><blockquote><p>å®Œæˆäº‹åŠ¡ç›´æ¥æäº¤ï¼Œé€šè¿‡è®°å½•undo-logï¼ˆæ•°æ®å¿«ç…§ï¼‰å®ç°äº‹åŠ¡å›æ»šï¼Œè§£å†³XAæ€§èƒ½å·®çš„é—®é¢˜</p><p>ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œå¹¶ä¸”æ²¡æœ‰ä»£ç ä¾µå…¥</p><p>ç¼ºç‚¹ï¼šATåœ¨ä¸€é˜¶æ®µå’ŒäºŒé˜¶æ®µä¹‹é—´ä¸ºè½¯çŠ¶æ€</p></blockquote></li><li><p>SAGAæ¨¡å¼ï¼šé•¿äº‹åŠ¡æ¨¡å¼ï¼Œæœ‰ä¸šåŠ¡ä¾µå…¥</p></li></ul><h5 id="å®ç°XAæ¨¡å¼"><a href="#å®ç°XAæ¨¡å¼" class="headerlink" title="å®ç°XAæ¨¡å¼"></a><strong>å®ç°XAæ¨¡å¼</strong></h5><ul><li><p>é…ç½®å¼€å¯XAæ¨¡å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">data-source-proxy-mode:</span> <span class="hljs-string">XA</span><br></code></pre></td></tr></table></figure></li><li><p>ç»™å‘èµ·å…¨å±€äº‹åŠ¡çš„å…¥å£æ–¹æ³•æ·»åŠ @GlobalTransactionalæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®ä¾‹</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@GlobalTransactional</span><br><span class="hljs-keyword">public</span> Long <span class="hljs-title function_">create</span><span class="hljs-params">(Order order)</span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºè®¢å•</span><br>    orderMapper.insert(order);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æ‰£ç”¨æˆ·ä½™é¢</span><br>        accountClient.deduct(order.getUserId(), order.getMoney());<br>        <span class="hljs-comment">// æ‰£åº“å­˜</span><br>        storageClient.deduct(order.getCommodityCode(), order.getCount());<br><br>    &#125; <span class="hljs-keyword">catch</span> (FeignException e) &#123;<br>        log.error(<span class="hljs-string">&quot;ä¸‹å•å¤±è´¥ï¼ŒåŸå› :&#123;&#125;&quot;</span>, e.contentUTF8(), e);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e.contentUTF8(), e);<br>    &#125;<br>    <span class="hljs-keyword">return</span> order.getId();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯æœåŠ¡ã€‚ åªæœ‰æ‰€æœ‰äº‹åŠ¡éƒ½æˆåŠŸï¼ŒTCæ‰ä¼šé€šçŸ¥å¾®æœåŠ¡æäº¤äº‹åŠ¡</p><h4 id=""><a href="#" class="headerlink" title=""></a></h4></li></ul><h5 id="å®ç°ATæ¨¡å¼"><a href="#å®ç°ATæ¨¡å¼" class="headerlink" title="å®ç°ATæ¨¡å¼"></a>å®ç°ATæ¨¡å¼</h5><ul><li><p>åˆ›å»ºä¸¤å¼ æ•°æ®åº“è¡¨ï¼Œè®°å½•å…¨å±€é”ï¼Œå…¶ä¸­lock_tableå¯¼å…¥åˆ°TCæœåŠ¡å…³è”çš„æ•°æ®åº“ï¼Œundo_logè¡¨å¯¼å…¥åˆ°å¾®æœåŠ¡å…³è”çš„æ•°æ®åº“</p></li><li><p>é…ç½®å¼€å¯ATæ¨¡å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">data-source-proxy-mode:</span> <span class="hljs-string">AT</span><br></code></pre></td></tr></table></figure></li><li><p>ç»™å‘èµ·å…¨å±€äº‹åŠ¡çš„å…¥å£æ–¹æ³•æ·»åŠ @GlobalTransactionalæ³¨è§£</p></li><li><p>é‡å¯æœåŠ¡</p></li></ul><h5 id="å®ç°TCCæ¨¡å¼"><a href="#å®ç°TCCæ¨¡å¼" class="headerlink" title="å®ç°TCCæ¨¡å¼"></a>å®ç°TCCæ¨¡å¼</h5><p>æ¦‚å¿µï¼š</p><ul><li>ç©ºå›æ»šï¼šåœ¨æœªæ‰§è¡Œtryæ“ä½œæ—¶å…ˆæ‰§è¡Œäº†cancelæ“ä½œ</li><li>ä¸šåŠ¡æ‚¬æŒ‚ï¼šå¯¹äºå·²ç»ç©ºå›æ»šçš„ä¸šåŠ¡ï¼Œä¹‹å‰è¢«é˜»å¡çš„tryæ“ä½œæ¢å¤ï¼Œç»§ç»­æ‰§è¡Œtryï¼Œå°±æ°¸è¿œä¸å¯èƒ½confirmæˆ–cancel ï¼Œäº‹åŠ¡ä¸€ç›´å¤„äºä¸­é—´çŠ¶æ€</li></ul><p>å®ä¾‹ï¼š</p><ul><li><p>åˆ›å»ºè¡¨,ç”¨äºå­˜å‚¨å›æ»šæ—¶éœ€è¦æ¢å¤çš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">REATE <span class="hljs-keyword">TABLE</span> `account_freeze_tbl`  (<br>  `xid` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `user_id` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `freeze_money` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>  `state` <span class="hljs-type">INT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;äº‹åŠ¡çŠ¶æ€ï¼Œ0:tryï¼Œ1:confirmï¼Œ2:cancel&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`xid`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> INNODB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> COMPACT;<br></code></pre></td></tr></table></figure><ul><li>xidï¼šæ˜¯å…¨å±€äº‹åŠ¡id</li><li>freeze_moneyï¼šç”¨æ¥è®°å½•ç”¨æˆ·å†»ç»“é‡‘é¢</li><li>stateï¼šç”¨æ¥è®°å½•äº‹åŠ¡çŠ¶æ€</li></ul></li><li><p>å£°æ˜TCCæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.account.service;<br><br><span class="hljs-comment">//å£°æ˜ä¸ºTCCäº‹åŠ¡</span><br><span class="hljs-meta">@LocalTCC</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountTCCService</span> &#123;<br><br>    <span class="hljs-comment">//Try</span><br>    <span class="hljs-meta">@TwoPhaseBusinessAction(name = &quot;deduct&quot;, commitMethod = &quot;confirm&quot;, rollbackMethod = &quot;cancel&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deduct</span><span class="hljs-params">(<span class="hljs-meta">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> String userId,</span><br><span class="hljs-params">                <span class="hljs-meta">@BusinessActionContextParameter(paramName = &quot;money&quot;)</span> <span class="hljs-type">int</span> money)</span>;<br><br>    <span class="hljs-comment">//Confirm</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(BusinessActionContext ctx)</span>;<br><br>    <span class="hljs-comment">//Cancel</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(BusinessActionContext ctx)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å®ç°TCCæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.account.service.impl;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountTccServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccountTCCService</span> &#123;<br><br>    <span class="hljs-comment">//è®°å½•äº‹åŠ¡çŠ¶æ€</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountFreezeMapper accountFreezeMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountMapper accountMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deduct</span><span class="hljs-params">(String userId, <span class="hljs-type">int</span> money)</span> &#123;<br>        <span class="hljs-comment">//è·å–äº‹åŠ¡id</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">xid</span> <span class="hljs-operator">=</span> RootContext.getXID();<br>        <span class="hljs-comment">//æ˜¯å¦ä¸šåŠ¡æ‚¬æŒ‚</span><br>        <span class="hljs-keyword">if</span> (accountFreezeMapper.selectById(xid) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//è¯æ˜ä¸šåŠ¡å·²ç»æ‰§è¡Œè¿‡ä¸€æ¬¡</span><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span><br>        accountMapper.deduct(userId, money);<br>        <span class="hljs-comment">//è®°å½•äº‹åŠ¡çŠ¶æ€</span><br>        <span class="hljs-type">AccountFreeze</span> <span class="hljs-variable">freeze</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountFreeze</span>();<br>        freeze.setXid(xid);<br>        freeze.setUserId(userId);<br>        freeze.setFreezeMoney(money);<br>        freeze.setState(AccountFreeze.State.TRY);   <span class="hljs-comment">//è®¾ç½®äº‹åŠ¡çŠ¶æ€ä¸ºTry</span><br>        <span class="hljs-comment">//æäº¤äº‹åŠ¡çŠ¶æ€</span><br>        accountFreezeMapper.insert(freeze);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(BusinessActionContext ctx)</span> &#123;<br>        <span class="hljs-comment">//éƒ½æˆåŠŸåæäº¤äº‹åŠ¡</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">xid</span> <span class="hljs-operator">=</span> ctx.getXid();<br>        <span class="hljs-comment">//åˆ é™¤å†»ç»“è®°å½•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> accountFreezeMapper.deleteById(xid);<br><br>        <span class="hljs-keyword">return</span> count == <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(BusinessActionContext ctx)</span> &#123;<br>        <span class="hljs-comment">//å¤±è´¥å›æ»šäº‹åŠ¡</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">xid</span> <span class="hljs-operator">=</span> ctx.getXid();<br>        <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦ç©ºå›æ»š</span><br>        <span class="hljs-keyword">if</span>(accountFreezeMapper.selectById(xid) == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">AccountFreeze</span> <span class="hljs-variable">freeze</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountFreeze</span>();<br>            freeze.setXid(xid);<br>            freeze.setFreezeMoney(<span class="hljs-number">0</span>);<br>            freeze.setUserId(ctx.getActionContext(<span class="hljs-string">&quot;userId&quot;</span>).toString());<br>            freeze.setState(AccountFreeze.State.CANCEL);<br>            accountFreezeMapper.insert(freeze);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-type">AccountFreeze</span> <span class="hljs-variable">freeze</span> <span class="hljs-operator">=</span> accountFreezeMapper.selectById(xid);<br>        accountMapper.refund(freeze.getUserId(), freeze.getFreezeMoney()); <span class="hljs-comment">//è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºæ¢å¤ä¹‹å‰çš„æ•°æ®</span><br>        <span class="hljs-comment">//å°†äº‹åŠ¡çŠ¶æ€æ”¹ä¸ºCANCELï¼Œå¹¶æ¸…ç©ºå†»ç»“é‡‘é¢</span><br>        freeze.setFreezeMoney(<span class="hljs-number">0</span>);<br>        freeze.setState(AccountFreeze.State.CANCEL);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> accountFreezeMapper.updateById(freeze);<br><br>        <span class="hljs-keyword">return</span> count == <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼æœç´¢(2)</title>
    <link href="/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2(2)/"/>
    <url>/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2(2)/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼æœç´¢-2"><a href="#åˆ†å¸ƒå¼æœç´¢-2" class="headerlink" title="åˆ†å¸ƒå¼æœç´¢(2)"></a>åˆ†å¸ƒå¼æœç´¢(2)</h2><h3 id="æ•°æ®èšåˆ"><a href="#æ•°æ®èšåˆ" class="headerlink" title="æ•°æ®èšåˆ"></a>æ•°æ®èšåˆ</h3><blockquote><p>å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»</p><p>å‚åŠ èšåˆçš„å­—æ®µå¿…é¡»æ˜¯keywordã€æ—¥æœŸã€æ•°å€¼ã€å¸ƒå°”ç±»å‹</p></blockquote><h4 id="èšåˆç§ç±»"><a href="#èšåˆç§ç±»" class="headerlink" title="èšåˆç§ç±»"></a>èšåˆç§ç±»</h4><p>å¸¸è§èšåˆï¼š</p><ul><li><strong>æ¡¶ï¼ˆBucketï¼‰</strong>èšåˆï¼šç”¨æ¥å¯¹æ–‡æ¡£åšåˆ†ç»„<ul><li>TermAggregationï¼šæŒ‰ç…§æ–‡æ¡£å­—æ®µå€¼åˆ†ç»„ï¼Œä¾‹å¦‚æŒ‰ç…§å“ç‰Œå€¼åˆ†ç»„ã€æŒ‰ç…§å›½å®¶åˆ†ç»„</li><li>Date Histogramï¼šæŒ‰ç…§æ—¥æœŸé˜¶æ¢¯åˆ†ç»„ï¼Œä¾‹å¦‚ä¸€å‘¨ä¸ºä¸€ç»„ï¼Œæˆ–è€…ä¸€æœˆä¸ºä¸€ç»„</li></ul></li><li><strong>åº¦é‡ï¼ˆMetricï¼‰</strong>èšåˆï¼šç”¨ä»¥è®¡ç®—ä¸€äº›å€¼ï¼Œæ¯”å¦‚ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€å¹³å‡å€¼ç­‰<ul><li>Avgï¼šæ±‚å¹³å‡å€¼</li><li>Maxï¼šæ±‚æœ€å¤§å€¼</li><li>Minï¼šæ±‚æœ€å°å€¼</li><li>Statsï¼šåŒæ—¶æ±‚maxã€minã€avgã€sumç­‰</li></ul></li><li><strong>ç®¡é“ï¼ˆpipelineï¼‰</strong>èšåˆï¼šå…¶å®ƒèšåˆçš„ç»“æœä¸ºåŸºç¡€åšèšåˆ</li></ul><h4 id="DSLèšåˆè¯­æ³•"><a href="#DSLèšåˆè¯­æ³•" class="headerlink" title="DSLèšåˆè¯­æ³•"></a>DSLèšåˆè¯­æ³•</h4><p><strong>æ¡¶èšåˆ(Bucket)</strong></p><ul><li><p>TermAggregationå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json">GETÂ /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>Â Â <span class="hljs-comment">//Â è®¾ç½®sizeä¸º0ï¼Œç»“æœä¸­ä¸åŒ…å«æ–‡æ¡£ï¼ŒåªåŒ…å«èšåˆç»“æœ</span><br>Â Â <span class="hljs-attr">&quot;aggs&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â å®šä¹‰èšåˆ</span><br>Â Â Â Â <span class="hljs-attr">&quot;brandAgg&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//ç»™èšåˆèµ·ä¸ªåå­—</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;terms&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â èšåˆçš„ç±»å‹ï¼ŒæŒ‰ç…§å“ç‰Œå€¼èšåˆï¼Œæ‰€ä»¥é€‰æ‹©term</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-comment">//Â å‚ä¸èšåˆçš„å­—æ®µ</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">20</span>Â <span class="hljs-comment">//Â å¸Œæœ›è·å–çš„èšåˆç»“æœæ•°é‡</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>æ’åº</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;aggs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;brandAgg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;_count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asc&quot;</span># æŒ‰ç…§æ•°é‡å‡åºæ’åº<br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>          <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>æŒ‡å®šèšåˆèŒƒå›´ï¼Œé»˜è®¤å¯¹æ‰€æœ‰æ–‡æ¡£èšåˆ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs json"># bucket<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span># åªå¯¹æŸ¥è¯¢åˆ°çš„ç»“æœè¿›è¡Œèšåˆ<br>    <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;lte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>  <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;aggs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;brandAgg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;terms&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;_count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asc&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>          <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>åº¦é‡ï¼ˆMetricï¼‰</strong></p><blockquote><p>å¯¹èšåˆåçš„æ¡¶é‡Œçš„æ–‡æ¡£è¿›è¡Œè¿ç®—</p></blockquote><ul><li><p>Statså®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json">GETÂ /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>Â <br>Â Â <span class="hljs-attr">&quot;aggs&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;brandAgg&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <br>Â Â Â Â Â Â <span class="hljs-attr">&quot;terms&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span>Â <br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">20</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;aggs&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â æ˜¯brandsèšåˆçš„å­èšåˆï¼Œä¹Ÿå°±æ˜¯åˆ†ç»„åå¯¹æ¯ç»„åˆ†åˆ«è®¡ç®—</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;score_stats&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â èšåˆåç§°</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;stats&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â èšåˆç±»å‹ï¼Œè¿™é‡Œstatså¯ä»¥è®¡ç®—minã€maxã€avgç­‰</span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;score&quot;</span>Â <span class="hljs-comment">//Â èšåˆçš„å­—æ®µï¼Œè¿™é‡Œæ˜¯å¯¹scoreè¿›è¡Œè¿ç®—</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="RestAPIèšåˆè¯­æ³•"><a href="#RestAPIèšåˆè¯­æ³•" class="headerlink" title="RestAPIèšåˆè¯­æ³•"></a>RestAPIèšåˆè¯­æ³•</h4><ul><li><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBucket</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//1.åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//2.ç»„ç»‡DSLå‚æ•°</span><br>    <span class="hljs-comment">//2.1 query</span><br>    searchRequest.source().query(QueryBuilders.rangeQuery(<span class="hljs-string">&quot;price&quot;</span>).lte(<span class="hljs-number">200</span>));<br>    <span class="hljs-comment">//2.2 size</span><br>    searchRequest.source().size(<span class="hljs-number">0</span>);<br>    <span class="hljs-comment">//2.3 aggs</span><br>    searchRequest.source().aggregation(AggregationBuilders<br>                                       .terms(<span class="hljs-string">&quot;brandAgg&quot;</span>)  <span class="hljs-comment">//èšåˆç±»å‹å’Œèšåˆå</span><br>                                       .field(<span class="hljs-string">&quot;brand&quot;</span>)           <span class="hljs-comment">//èšåˆçš„å­—æ®µ</span><br>                                       .order(BucketOrder.count(<span class="hljs-literal">true</span>)) <span class="hljs-comment">//æ’åº</span><br>                                       .size(<span class="hljs-number">10</span>));     <span class="hljs-comment">//å¸Œæœ›è·å–çš„èšåˆç»“æœæ•°é‡</span><br><br>    <span class="hljs-comment">//3.å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);<br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    <span class="hljs-type">Aggregations</span> <span class="hljs-variable">aggregations</span> <span class="hljs-operator">=</span> response.getAggregations(); <span class="hljs-comment">//è·å¾—èšåˆé›†</span><br>    <span class="hljs-type">Terms</span> <span class="hljs-variable">brandAgg</span> <span class="hljs-operator">=</span> aggregations.get(<span class="hljs-string">&quot;brandAgg&quot;</span>);  <span class="hljs-comment">//è·å–æŒ‡å®šçš„èšåˆ</span><br>    List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Terms</span>.Bucket&gt; buckets = brandAgg.getBuckets();   <span class="hljs-comment">//è·å–æ¡¶</span><br>    <span class="hljs-keyword">for</span> (Terms.Bucket bucket : buckets) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">keyAsString</span> <span class="hljs-operator">=</span> bucket.getKeyAsString();<br>        System.out.println(keyAsString);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="è‡ªåŠ¨è¡¥å…¨"><a href="#è‡ªåŠ¨è¡¥å…¨" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨"></a>è‡ªåŠ¨è¡¥å…¨</h3><h4 id="å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨æ’ä»¶"><a href="#å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨æ’ä»¶" class="headerlink" title="å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨æ’ä»¶"></a>å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨æ’ä»¶</h4><ul><li><p>ä¸‹è½½<a href="https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v8.4.1">Release v8.4.1 Â· medcl&#x2F;elasticsearch-analysis-pinyin (github.com)</a></p></li><li><p>æŸ¥çœ‹æ’ä»¶æŒ‚è½½çš„æ•°æ®å·</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">volume</span><span class="language-bash"> inspect es-plugins</span><br></code></pre></td></tr></table></figure></li><li><p>å°†ä¸‹è½½çš„æ’ä»¶è§£å‹åˆ°ç›®å½•ä¸‹</p></li><li><p>é‡å¯</p></li><li><p>æµ‹è¯•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /_analyze<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;æ‹¼éŸ³åˆ†è¯å™¨&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pinyin&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨"><a href="#è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨" class="headerlink" title="è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨"></a>è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨</h4><p>elasticsearchä¸­åˆ†è¯å™¨ï¼ˆanalyzerï¼‰çš„ç»„æˆåŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>character filtersï¼šåœ¨tokenizerä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚åˆ é™¤å­—ç¬¦ã€æ›¿æ¢å­—ç¬¦</li><li>tokenizerï¼šå°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ‡å‰²æˆè¯æ¡ï¼ˆtermï¼‰ã€‚ä¾‹å¦‚keywordï¼Œå°±æ˜¯ä¸åˆ†è¯ï¼›è¿˜æœ‰ik_smart</li><li>tokenizer filterï¼šå°†tokenizerè¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚å¤§å°å†™è½¬æ¢ã€åŒä¹‰è¯å¤„ç†ã€æ‹¼éŸ³å¤„ç†ç­‰</li></ul><ul><li><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs json">PUTÂ /test<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;analysis&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â è‡ªå®šä¹‰åˆ†è¯å™¨</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;my_analyzer&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â Â <span class="hljs-comment">//Â åˆ†è¯å™¨åç§°</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;tokenizer&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;py&quot;</span><span class="hljs-comment">//è¿‡æ»¤å™¨å</span><br>Â Â Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â è‡ªå®šä¹‰tokenizerÂ filter</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;py&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span>Â <span class="hljs-comment">//Â è¿‡æ»¤å™¨åç§°</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;pinyin&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-comment">//Â è¿‡æ»¤å™¨ç±»å‹ï¼Œè¿™é‡Œæ˜¯pinyin</span><br>  <span class="hljs-attr">&quot;keep_full_pinyin&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;keep_joined_full_pinyin&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;keep_original&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;limit_first_letter_length&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;remove_duplicated_term&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;none_chinese_pinyin_tokenize&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>Â Â Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>Â Â <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;my_analyzer&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-comment">//åˆ›å»ºæ—¶ä½¿ç”¨çš„åˆ†è¯å™¨</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-comment">//æŸ¥è¯¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œé˜²æ­¢æœæ±‰å­—æ—¶æœåˆ°åŒéŸ³å­—</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢"><a href="#è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢"></a>è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</h4><blockquote><p>å‚ä¸è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µå¿…é¡»æ˜¯<strong>completion</strong>ç±»å‹ã€‚</p><p>å­—æ®µçš„å†…å®¹ä¸€èˆ¬æ˜¯ç”¨æ¥è¡¥å…¨çš„å¤šä¸ªè¯æ¡å½¢æˆçš„æ•°ç»„ã€‚</p></blockquote><ul><li><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">//Â åˆ›å»ºç´¢å¼•åº“</span><br>PUTÂ test<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;completion&quot;</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">// ç¤ºä¾‹æ•°æ®</span><br>POSTÂ test/_doc<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Sony&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">&quot;WH-1000XM3&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br>POSTÂ test/_doc<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;SK-II&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">&quot;PITERA&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br>POSTÂ test/_doc<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Nintendo&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">&quot;switch&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">//Â è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</span><br>GETÂ /test/_search<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;suggest&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;title_suggest&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;s&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-comment">//Â å…³é”®å­—</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;completion&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;field&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;title&quot;</span><span class="hljs-punctuation">,</span>Â <span class="hljs-comment">//Â è¡¥å…¨æŸ¥è¯¢çš„å­—æ®µ</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;skip_duplicates&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>Â <span class="hljs-comment">//Â è·³è¿‡é‡å¤çš„</span><br>Â Â Â Â Â Â Â Â <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">10</span>Â <span class="hljs-comment">//Â è·å–å‰10æ¡ç»“æœ</span><br>Â Â Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><p>RestAPIè¡¥å…¨è¯­æ³•</p><ul><li><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSuggest</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    searchRequest.source().suggest(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SuggestBuilder</span>()<br>                                   .addSuggestion(<span class="hljs-string">&quot;suggestions&quot;</span>, SuggestBuilders<br>                                                  .completionSuggestion(<span class="hljs-string">&quot;suggestion&quot;</span>)<br>                                                  .prefix(<span class="hljs-string">&quot;h&quot;</span>)<br>                                                  .skipDuplicates(<span class="hljs-literal">true</span>)<br>                                                  .size(<span class="hljs-number">10</span>))<br>                                  );<br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);<br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    <span class="hljs-type">Suggest</span> <span class="hljs-variable">suggest</span> <span class="hljs-operator">=</span> response.getSuggest();<br>    <span class="hljs-type">CompletionSuggestion</span> <span class="hljs-variable">suggestion</span> <span class="hljs-operator">=</span> suggest.getSuggestion(<span class="hljs-string">&quot;suggestions&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (CompletionSuggestion.Entry.Option option : suggestion.getOptions()) &#123;<br>        System.out.println(option.getText().string());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h3><p>æ–¹å¼ä¸€ï¼šåŒæ­¥è°ƒç”¨</p><ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç²—æš´</li><li>ç¼ºç‚¹ï¼šç›´æ¥è°ƒæ¥å£ï¼Œä¸šåŠ¡è€¦åˆåº¦é«˜</li></ul><p>æ–¹å¼äºŒï¼šå¼‚æ­¥é€šçŸ¥</p><ul><li>ä¼˜ç‚¹ï¼šä½è€¦åˆï¼Œå®ç°éš¾åº¦ä¸€èˆ¬</li><li>ç¼ºç‚¹ï¼šä¾èµ–mqçš„å¯é æ€§</li></ul><p>æ–¹å¼ä¸‰ï¼šç›‘å¬binlog</p><ul><li>ä¼˜ç‚¹ï¼šå®Œå…¨è§£é™¤æœåŠ¡é—´è€¦åˆ</li><li>ç¼ºç‚¹ï¼šå¼€å¯binlog(ç±»ä¼¼ä¸»ä»å¤åˆ¶)å¢åŠ æ•°æ®åº“è´Ÿæ‹…ã€å®ç°å¤æ‚åº¦é«˜</li></ul><h4 id="é€šè¿‡mqæ¥å®ç°æ•°æ®åŒæ­¥"><a href="#é€šè¿‡mqæ¥å®ç°æ•°æ®åŒæ­¥" class="headerlink" title="é€šè¿‡mqæ¥å®ç°æ•°æ®åŒæ­¥"></a>é€šè¿‡mqæ¥å®ç°æ•°æ®åŒæ­¥</h4><p>æ­¥éª¤ï¼š</p><ol><li>å¯¼å…¥ä¾èµ–ï¼Œå†™é…ç½®ï¼Œåœ¨æ¶ˆè´¹è€…ç«¯åˆ›å»ºäº¤æ¢æœºã€æ¶ˆæ¯é˜Ÿåˆ—</li><li>ç”Ÿäº§è€…ç«¯å¯¼å…¥ä¾èµ–ï¼Œå†™é…ç½®ï¼Œé€šè¿‡RabbitTemplateå‘é€æ¶ˆæ¯</li><li>æ¶ˆè´¹è€…ç«¯ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šè¿‡è·å–çš„æ¶ˆæ¯æ›´æ–°ç´¢å¼•è¡¨</li><li>æµ‹è¯•</li></ol><p>å®ä¾‹</p><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--amqp--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span> <br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºäº¤æ¢æœºã€é˜Ÿåˆ—å’Œkey</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel.config;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MqConfiguration</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * äº¤æ¢æœº</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> TopicExchange <span class="hljs-title function_">topicExchange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TopicExchange</span>(HOTEL_EXCHANGE, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">insertQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(HOTEL_INSERT_QUEUE, <span class="hljs-literal">true</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">deleteQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(HOTEL_DELETE_QUEUE, <span class="hljs-literal">true</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">insertQueueBinding</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(insertQueue()).to(topicExchange()).with(HOTEL_INSERT_KEY);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">deleteQueueBinding</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(deleteQueue()).to(topicExchange()).with(HOTEL_DELETE_KEY);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºç›‘å¬å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel.mq;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘å¬å™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelListener</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IHotelService service;<br><br>    <span class="hljs-meta">@RabbitListener(queues = HOTEL_INSERT_QUEUE)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerHotelInsertOrUpdate</span><span class="hljs-params">(Long id)</span> &#123;<br>        service.insertById(id);<br>    &#125;<br><br>    <span class="hljs-meta">@RabbitListener(queues = HOTEL_DELETE_QUEUE)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerHotelDelete</span><span class="hljs-params">(Long id)</span> &#123;<br>        service.deleteById(id);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><ul><li><p>å¯¼å…¥ä¾èµ–ã€å¡«å†™é…ç½®</p></li><li><p>å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel.web;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;hotel&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IHotelService hotelService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Hotel <span class="hljs-title function_">queryById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;<br>        <span class="hljs-keyword">return</span> hotelService.getById(id);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> PageResult <span class="hljs-title function_">hotelList</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam(value = &quot;page&quot;, defaultValue = &quot;1&quot;)</span> Integer page,</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;1&quot;)</span> Integer size</span><br><span class="hljs-params">    )</span>&#123;<br>        Page&lt;Hotel&gt; result = hotelService.page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, size));<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>(result.getTotal(), result.getRecords());<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveHotel</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hotel hotel)</span>&#123;<br>        hotelService.save(hotel);<br><br>        <span class="hljs-comment">//å°†ä¿®æ”¹çš„æ•°æ®idå‘åˆ°é˜Ÿåˆ—</span><br>        rabbitTemplate.convertAndSend(HOTEL_EXCHANGE, HOTEL_INSERT_KEY, hotel.getId());<br>    &#125;<br><br>    <span class="hljs-meta">@PutMapping()</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Hotel hotel)</span>&#123;<br>        <span class="hljs-keyword">if</span> (hotel.getId() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidParameterException</span>(<span class="hljs-string">&quot;idä¸èƒ½ä¸ºç©º&quot;</span>);<br>        &#125;<br>        hotelService.updateById(hotel);<br><br>        <span class="hljs-comment">//å°†ä¿®æ”¹çš„æ•°æ®idå‘åˆ°é˜Ÿåˆ—</span><br>        rabbitTemplate.convertAndSend(HOTEL_EXCHANGE, HOTEL_INSERT_KEY, hotel.getId());<br>    &#125;<br><br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        hotelService.removeById(id);<br><br>        <span class="hljs-comment">//å°†åˆ é™¤çš„æ•°æ®idå‘åˆ°é˜Ÿåˆ—</span><br>        rabbitTemplate.convertAndSend(HOTEL_EXCHANGE, HOTEL_DELETE_KEY, id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="esé›†ç¾¤"><a href="#esé›†ç¾¤" class="headerlink" title="esé›†ç¾¤"></a>esé›†ç¾¤</h3><p>æ¦‚å¿µï¼š</p><ul><li><p>é›†ç¾¤ï¼ˆclusterï¼‰ï¼šä¸€ç»„æ‹¥æœ‰å…±åŒçš„ cluster name çš„ èŠ‚ç‚¹ã€‚</p></li><li><p>èŠ‚ç‚¹ï¼ˆnode)  ï¼šé›†ç¾¤ä¸­çš„ä¸€ä¸ª Elasticearch å®ä¾‹</p></li><li><p>åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šç´¢å¼•å¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†è¿›è¡Œå­˜å‚¨ï¼Œç§°ä¸ºåˆ†ç‰‡ã€‚åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªç´¢å¼•çš„ä¸åŒåˆ†ç‰‡å¯ä»¥æ‹†åˆ†åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸­</p><p>è§£å†³é—®é¢˜ï¼šæ•°æ®é‡å¤ªå¤§ï¼Œå•ç‚¹å­˜å‚¨é‡æœ‰é™çš„é—®é¢˜ã€‚</p></li></ul><h4 id="é›†ç¾¤èŒè´£åˆ’åˆ†"><a href="#é›†ç¾¤èŒè´£åˆ’åˆ†" class="headerlink" title="é›†ç¾¤èŒè´£åˆ’åˆ†"></a>é›†ç¾¤èŒè´£åˆ’åˆ†</h4><p><img src="/img/weifuwu_img/es%E9%9B%86%E7%BE%A4%E5%88%92%E5%88%86.png"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒæ—¶å…·å¤‡ä¸Šè¿°å››ç§è§’è‰²ã€‚ä½†æ˜¯çœŸå®çš„é›†ç¾¤ä¸€å®šè¦å°†é›†ç¾¤èŒè´£åˆ†ç¦»</p><h4 id="è„‘è£‚"><a href="#è„‘è£‚" class="headerlink" title="è„‘è£‚"></a>è„‘è£‚</h4><blockquote><p>å› ä¸ºèŠ‚ç‚¹å¤±è”å¯¼è‡´å‡ºç°å¤šä¸ªä¸»èŠ‚ç‚¹</p></blockquote><p>è§£å†³è„‘è£‚çš„æ–¹æ¡ˆæ˜¯ï¼Œè¦æ±‚é€‰ç¥¨è¶…è¿‡ ( eligibleèŠ‚ç‚¹æ•°é‡ + 1 ï¼‰&#x2F; 2 æ‰èƒ½å½“é€‰ä¸ºä¸»ï¼Œå› æ­¤eligibleèŠ‚ç‚¹æ•°é‡æœ€å¥½æ˜¯å¥‡æ•°ã€‚å¯¹åº”é…ç½®é¡¹æ˜¯discovery.zen.minimum_master_nodesï¼Œåœ¨es7.0ä»¥åï¼Œå·²ç»æˆä¸ºé»˜è®¤é…ç½®ï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿè„‘è£‚é—®é¢˜</p><h4 id="é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨-x2F-æŸ¥è¯¢"><a href="#é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨-x2F-æŸ¥è¯¢" class="headerlink" title="é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨&#x2F;æŸ¥è¯¢"></a>é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨&#x2F;æŸ¥è¯¢</h4><p><strong>å­˜å‚¨</strong></p><p>elasticsearchä¼šé€šè¿‡hashç®—æ³•æ¥è®¡ç®—æ–‡æ¡£åº”è¯¥å­˜å‚¨åˆ°å“ªä¸ªåˆ†ç‰‡</p><p><code>shard = hash(_routing) % number_of_shards</code></p><ul><li>_routing: é»˜è®¤æ˜¯æ–‡æ¡£id</li><li>number_of_shardsï¼šåˆ†ç‰‡æ•°ï¼Œæ­¤ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œåˆ†ç‰‡æ•°é‡ä¸èƒ½ä¿®æ”¹</li></ul><p><strong>æŸ¥è¯¢</strong></p><p>æŸ¥è¯¢åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li><p>scatter phaseï¼šåˆ†æ•£é˜¶æ®µï¼Œcoordinating nodeä¼šæŠŠè¯·æ±‚åˆ†å‘åˆ°æ¯ä¸€ä¸ªåˆ†ç‰‡</p></li><li><p>gather phaseï¼šèšé›†é˜¶æ®µï¼Œcoordinating nodeæ±‡æ€»data nodeçš„æœç´¢ç»“æœï¼Œå¹¶å¤„ç†ä¸ºæœ€ç»ˆç»“æœé›†è¿”å›ç»™ç”¨æˆ·</p></li></ul><h4 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h4><p>é›†ç¾¤çš„masterèŠ‚ç‚¹ä¼šç›‘æ§é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœ‰èŠ‚ç‚¹å®•æœºï¼Œä¼šç«‹å³<strong>å°†å®•æœºèŠ‚ç‚¹çš„åˆ†ç‰‡æ•°æ®è¿ç§»åˆ°å…¶å®ƒèŠ‚ç‚¹</strong>ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼Œè¿™ä¸ªå«åšæ•…éšœè½¬ç§»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¥å£é™æµ</title>
    <link href="/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81/"/>
    <url>/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¥å£é™æµ"><a href="#æ¥å£é™æµ" class="headerlink" title="æ¥å£é™æµ"></a>æ¥å£é™æµ</h2><h3 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h3><blockquote><p>ç”±é˜¿é‡Œå·´å·´ä¸­é—´ä»¶å›¢é˜Ÿå¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€ç§é¢å‘åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„è½»é‡çº§é«˜å¯ç”¨<strong>æµé‡æ§åˆ¶</strong>ç»„ä»¶</p><p>æä¾›äº†æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥ä¿éšœæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§</p></blockquote><p><img src="/img/weifuwu_img/sentinel.png" alt="sentinel"></p><p>sentinelåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>sentinel-dashboard(æ§åˆ¶é¢æ¿)ï¼šæä¾›å®æ—¶ç›‘æ§ä¹‹å¤–ï¼Œè¿˜æä¾›äº†æµæ§è§„åˆ™ã€ç†”æ–­è§„åˆ™çš„åœ¨çº¿ç»´æŠ¤ç­‰åŠŸèƒ½</li><li>å®¢æˆ·ç«¯æ•´åˆï¼šæ¯ä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯éƒ½éœ€è¦æ•´åˆsentinelçš„å®¢æˆ·ç«¯å°è£…ä¸é…ç½®ï¼Œæ‰èƒ½å°†ç›‘æ§ä¿¡æ¯ä¸ŠæŠ¥ç»™dashboardå±•ç¤ºä»¥åŠå®æ—¶çš„æ›´æ”¹é™æµæˆ–ç†”æ–­è§„åˆ™ç­‰ã€‚</li></ul><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><h5 id="éƒ¨ç½²Sentinel-Dashboard"><a href="#éƒ¨ç½²Sentinel-Dashboard" class="headerlink" title="éƒ¨ç½²Sentinel Dashboard"></a>éƒ¨ç½²Sentinel Dashboard</h5><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel/releases">sentinel-dashboard</a></p><ul><li><p>è¿è¡ŒjaråŒ…</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ldif">java -jar sentinel-dashboard-1.8.3.jar<br><br><span class="hljs-comment">#åé¢å¯è·Ÿå‚æ•°</span><br><span class="hljs-literal">-</span>Dserver.port=8080 <span class="hljs-comment">#è®¾ç½®ç«¯å£ï¼Œé»˜è®¤8080</span><br><span class="hljs-literal">-</span>Dsentinel.dashboard.auth.username=sentinel<span class="hljs-comment">#è®¾ç½®ç”¨æˆ·å, é»˜è®¤sentinel</span><br><span class="hljs-literal">-</span>Dsentinel.dashboard.auth.password=123456<span class="hljs-comment">#è®¾ç½®å¯†ç , é»˜è®¤sentinel</span><br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®<code>localhost:8080</code>æ¥æ‰“å¼€æ§åˆ¶é¢æ¿</p></li></ul><h5 id="å®¢æˆ·ç«¯æ•´åˆSentinel"><a href="#å®¢æˆ·ç«¯æ•´åˆSentinel" class="headerlink" title="å®¢æˆ·ç«¯æ•´åˆSentinel"></a>å®¢æˆ·ç«¯æ•´åˆSentinel</h5><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--sentinel--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®Sentinel Dashboardçš„è®¿é—®åœ°å€</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">localhost:8080</span>   <span class="hljs-comment"># æ§åˆ¶é¢æ¿ç«¯å£</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">alibaba-sentinel-rate-limiting</span>  <span class="hljs-comment"># æœåŠ¡å</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span>  <span class="hljs-comment"># æœåŠ¡ç«¯å£</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™ä¸€ä¸ªè®¿é—®çš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.controller;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®æ­¤æ¥å£å’Œæ§åˆ¶å°</p><p><img src="/img/weifuwu_img/sentinel%E4%BE%8B%E5%AD%90.png" alt="sentinelä¾‹å­"></p><p><img src="/img/weifuwu_img/sentinel%E6%8E%A7%E5%88%B6%E5%8F%B0.png" alt="sentinelæ§åˆ¶å°"></p></li></ul><h4 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h4><h5 id="é…ç½®é™æµè§„åˆ™"><a href="#é…ç½®é™æµè§„åˆ™" class="headerlink" title="é…ç½®é™æµè§„åˆ™"></a>é…ç½®é™æµè§„åˆ™</h5><blockquote><p>å¯¹è®¿é—®æŸä¸ªæ¥å£çš„æ‰€æœ‰è¯·æ±‚è¿›è¡Œé™æµ</p></blockquote><p><img src="/img/weifuwu_img/sentinel%E6%B5%81%E6%8E%A7.png" alt="sentinelæµæ§"></p><p><img src="/img/weifuwu_img/sentinel%E6%96%B0%E5%A2%9E%E6%B5%81%E6%8E%A7%E8%A7%84%E5%88%99.png" alt="sentinelæ–°å¢æµæ§è§„åˆ™"></p><p>æµæ§æ¨¡å¼ï¼š</p><ul><li><p>ç›´æ¥ï¼šç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤æ¨¡å¼ã€‚</p></li><li><p>å…³è”ï¼šç»Ÿè®¡ä¸å½“å‰ç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµã€‚</p></li><li><p>é“¾è·¯ï¼šç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹æŒ‡å®šé“¾è·¯é™æµ</p><blockquote><p>é“¾è·¯æ¨¡å¼ä¸­ï¼Œæ˜¯å¯¹ä¸åŒæ¥æºçš„ä¸¤ä¸ªé“¾è·¯åšç›‘æ§ã€‚ä½†æ˜¯sentinelé»˜è®¤ä¼šç»™è¿›å…¥SpringMVCçš„æ‰€æœ‰è¯·æ±‚è®¾ç½®åŒä¸€ä¸ªrootèµ„æºï¼Œä¼šå¯¼è‡´é“¾è·¯æ¨¡å¼å¤±æ•ˆã€‚</p><p>æˆ‘ä»¬éœ€è¦å…³é—­è¿™ç§å¯¹SpringMVCçš„èµ„æºèšåˆ</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">web-context-unify:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># å…³é—­contextæ•´åˆ</span><br></code></pre></td></tr></table></figure></li></ul><p>æµæ§æ•ˆæœï¼š</p><ul><li>å¿«é€Ÿå¤±æ•ˆï¼šè¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æŠ›å‡ºFlowExceptionå¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</li><li>warm upï¼šé¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€ä¸ªè¾ƒå°çš„å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§å€¼ã€‚</li><li>æ’é˜Ÿç­‰å¾…ï¼šè®©æ‰€æœ‰è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œä¸¤ä¸ªè¯·æ±‚çš„é—´éš”ä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿ã€‚å¯¹æµé‡è¿›è¡Œæ•´å½¢ï¼Œå°†æ³¢åŠ¨çš„qpsæ•´å½¢æˆå¹³æ»‘çš„ç›´çº¿ã€‚</li></ul><h5 id="é…ç½®çƒ­ç‚¹å‚æ•°é™æµ"><a href="#é…ç½®çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="é…ç½®çƒ­ç‚¹å‚æ•°é™æµ"></a>é…ç½®çƒ­ç‚¹å‚æ•°é™æµ</h5><blockquote><p>ç²’åº¦æ›´ç»†ï¼Œå¯¹è®¿é—®æŸä¸ªæ¥å£çš„æŒ‡å®šå‚æ•°è¿›è¡Œé™æµ</p></blockquote><ul><li><p>çƒ­ç‚¹å‚æ•°é™æµå¯¹é»˜è®¤çš„SpringMVCæ˜¯æ— æ•ˆçš„ï¼Œæ·»åŠ @SentinelResourceæ³¨è§£å¼€å¯çƒ­ç‚¹é™æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SentinelResource(&quot;hot&quot;)</span>    <span class="hljs-comment">//è®¾ç½®èµ„æºå</span><br><span class="hljs-meta">@GetMapping(&quot;/hot&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">hot</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String id)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;çƒ­ç‚¹å‚æ•°&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ§åˆ¶é¢æ¿è®¾ç½®</p><p><img src="/img/weifuwu_img/%E7%83%AD%E7%82%B9%E8%A7%84%E5%88%991.png" alt="çƒ­ç‚¹è§„åˆ™1"></p><p><img src="/img/weifuwu_img/%E7%83%AD%E7%82%B9%E8%A7%84%E5%88%992.png" alt="çƒ­ç‚¹è§„åˆ™2"></p></li></ul><h4 id="éš”ç¦»"><a href="#éš”ç¦»" class="headerlink" title="éš”ç¦»"></a>éš”ç¦»</h4><blockquote><p>å¯¹è®¿é—®æŸä¸ªæ¥å£çš„çº¿ç¨‹è¿›è¡Œé™åˆ¶</p></blockquote><h5 id="FeignClientæ•´åˆSentinel"><a href="#FeignClientæ•´åˆSentinel" class="headerlink" title="FeignClientæ•´åˆSentinel"></a>FeignClientæ•´åˆSentinel</h5><blockquote><p>å°†Feignä¸Sentinelæ•´åˆï¼Œåœ¨Feigné‡Œé¢å®ç°çº¿ç¨‹éš”ç¦»å’ŒæœåŠ¡ç†”æ–­ã€‚</p><p>SpringCloudç‰ˆæœ¬ä¸º&lt;spring-cloud.version&gt;Hoxton.SR8&lt;&#x2F;spring-cloud.version&gt;</p><p>å¾ªç¯ä¾èµ–å¯èƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜</p></blockquote><p>Feignæ•´åˆSentinelçš„æ­¥éª¤ï¼š</p><ul><li>åœ¨application.ymlä¸­é…ç½®ï¼šfeign.sentienl.enable&#x3D;true</li><li>ç»™FeignClientç¼–å†™FallbackFactoryå¹¶æ³¨å†Œä¸ºBean</li><li>å°†FallbackFactoryé…ç½®åˆ°FeignClient</li></ul><ul><li><p>åœ¨ç”¨åˆ°feignçš„ç±»çš„é…ç½®ä¸­å¼€å¯sentinelåŠŸèƒ½</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å¼€å¯feignå¯¹sentinelçš„æ”¯æŒ</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™å¤±è´¥é™çº§é€»è¾‘</p><blockquote><p>ä¸šåŠ¡å¤±è´¥åï¼Œä¸èƒ½ç›´æ¥æŠ¥é”™ï¼Œè€Œåº”è¯¥è¿”å›ç”¨æˆ·ä¸€ä¸ªå‹å¥½æç¤ºæˆ–è€…é»˜è®¤ç»“æœï¼Œè¿™ä¸ªå°±æ˜¯å¤±è´¥é™çº§é€»è¾‘ã€‚</p><p>ç»™FeignClientç¼–å†™å¤±è´¥åçš„é™çº§é€»è¾‘</p><p>â‘ æ–¹å¼ä¸€ï¼šFallbackClassï¼Œæ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</p><p>â‘¡æ–¹å¼äºŒï¼šFallbackFactoryï¼Œå¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</p></blockquote><p>åœ¨feign-apiåŒ…ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.client.fallback;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserClientFallbackFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FallbackFactory</span>&lt;UserClient&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserClient <span class="hljs-title function_">create</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserClient</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> &#123;<br>                log.error(<span class="hljs-string">&quot;æŸ¥è¯¢ç”¨æˆ·å¼‚å¸¸&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>å°†UserClientFallbackFactoryæ³¨å†Œä¸ºä¸€ä¸ªbean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultFeignConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> UserClientFallbackFactory <span class="hljs-title function_">userClientFallbackFactory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserClientFallbackFactory</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ç”¨åˆ°feignçš„ç±»ä¸Šè®°å¾—åœ¨å¯åŠ¨ç±»ä¸Šè®¾ç½®é»˜è®¤é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;,defaultConfiguration = DefaultFeignConfiguration.class)</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨feing-apié¡¹ç›®ä¸­çš„UserClientæ¥å£ä¸­ä½¿ç”¨UserClientFallbackFactory</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.client;<br><br><span class="hljs-comment">//æ³¨æ„æ˜¯fallbackFactoryä¸æ˜¯fallback</span><br><span class="hljs-meta">@FeignClient(value = &quot;userservice&quot;, fallbackFactory = UserClientFallbackFactory.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br>    User <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯æœåŠ¡</p></li></ul><h5 id="çº¿ç¨‹éš”ç¦»"><a href="#çº¿ç¨‹éš”ç¦»" class="headerlink" title="çº¿ç¨‹éš”ç¦»"></a>çº¿ç¨‹éš”ç¦»</h5><p>çº¿ç¨‹éš”ç¦»çš„ä¸¤ç§æ‰‹æ®µ</p><ul><li><p>ä¿¡å·é‡éš”ç¦»</p></li><li><p>çº¿ç¨‹æ± éš”ç¦»</p></li></ul><p>ä¿¡å·é‡éš”ç¦»çš„ç‰¹ç‚¹</p><ul><li>åŸºäºè®¡æ•°å™¨æ¨¡å¼ï¼Œç®€å•ï¼Œå¼€é”€å°ï¼Œé€‚åˆé«˜æ‰‡å‡ºçš„åœºæ™¯</li></ul><p>çº¿ç¨‹æ± éš”ç¦»çš„ç‰¹ç‚¹</p><ul><li>åŸºäºçº¿ç¨‹æ± æ¨¡å¼ï¼Œæœ‰é¢å¤–å¼€é”€ï¼Œä½†éš”ç¦»æ§åˆ¶æ›´å¼º</li></ul><h5 id="é…ç½®éš”ç¦»è§„åˆ™"><a href="#é…ç½®éš”ç¦»è§„åˆ™" class="headerlink" title="é…ç½®éš”ç¦»è§„åˆ™"></a>é…ç½®éš”ç¦»è§„åˆ™</h5><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E9%9A%94%E7%A6%BB%E8%A7%84%E5%88%991.png" alt="é…ç½®éš”ç¦»è§„åˆ™1"></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E9%9A%94%E7%A6%BB%E8%A7%84%E5%88%992.png" alt="é…ç½®éš”ç¦»è§„åˆ™2"></p><h5 id="ç†”æ–­"><a href="#ç†”æ–­" class="headerlink" title="ç†”æ–­"></a>ç†”æ–­</h5><blockquote><p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”±<strong>æ–­è·¯å™¨</strong>ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ã€æ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼š<strong>ç†”æ–­</strong>è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ï¼›è€Œå½“æœåŠ¡æ¢å¤æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚</p></blockquote><p>ç†”æ–­ç­–ç•¥ï¼š</p><ul><li>æ…¢è°ƒç”¨ï¼šå½“å“åº”æ—¶é—´å¤§äºè®¾å®šçš„å€¼(RT)æ—¶ï¼Œä¸ºä¸€æ¬¡æ…¢è°ƒç”¨ã€‚è‹¥æ…¢è°ƒç”¨çš„æ¬¡æ•°å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡ï¼Œåˆ™ä¼šè§¦å‘ç†”æ–­</li><li>å¼‚å¸¸æ¯”ä¾‹ï¼šå•ä½æ—¶é—´é‡Œå‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºè®¾ç½®çš„æ¯”ä¾‹ï¼Œåˆ™ä¼šè§¦å‘ç†”æ–­</li><li>å¼‚å¸¸æ•°: å•ä½æ—¶é—´é‡Œå‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºè®¾ç½®çš„æ•°å€¼ï¼Œåˆ™ä¼šè§¦å‘ç†”æ–­</li></ul><p><strong>é…ç½®æ…¢è°ƒç”¨</strong></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E6%85%A2%E8%B0%83%E7%94%A81.png" alt="é…ç½®æ…¢è°ƒç”¨1"></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E6%85%A2%E8%B0%83%E7%94%A82.png" alt="é…ç½®æ…¢è°ƒç”¨2"></p><p><strong>é…ç½®å¼‚å¸¸æ¯”ä¾‹&#x2F;å¼‚å¸¸æ•°</strong></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B%E5%92%8C%E5%BC%82%E5%B8%B8%E6%95%B0.png" alt="é…ç½®å¼‚å¸¸æ¯”ä¾‹å’Œå¼‚å¸¸æ•°"></p><h4 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h4><blockquote><p>æˆæƒè§„åˆ™å¯ä»¥å¯¹è°ƒç”¨æ–¹çš„æ¥æºåšæ§åˆ¶ï¼Œæœ‰ç™½åå•å’Œé»‘åå•ä¸¤ç§æ–¹å¼ã€‚</p><p>åªå¯¹æœ‰æˆæƒçš„è¯·æ±‚æä¾›æœåŠ¡</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsentinelå¯¹ä¸€åˆ‡è¯·æ±‚çš„æ¥æºéƒ½è¢«è®¤ä¸ºæ˜¯ä¸€æ ·çš„å€¼defaultã€‚</p><ul><li><p>è‡ªå®šä¹‰è¯·æ±‚æ¥æºè§£æå™¨</p><blockquote><p>é…ç½®æˆæƒè§„åˆ™æ—¶ä¼šæ ¹æ®è§£æå™¨çš„è¿”å›å€¼æ¥åˆ¤æ–­è¯·æ±‚æ¥æº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.order.sentinel;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰æ¥æºè§£æå™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeaderOriginParser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RequestOriginParser</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">parseOrigin</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>        <span class="hljs-comment">//ä»è¯·æ±‚å¤´è·å–æ¥æºä¿¡æ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;origin&quot;</span>);<br><span class="hljs-comment">//è¯·æ±‚å¤´ä¸­æ²¡æœ‰&quot;origin&quot;ï¼Œåˆ™é»˜è®¤å€¼ä¸º&quot;blank&quot;</span><br>        <span class="hljs-keyword">if</span> (StringUtil.isEmpty(origin)) &#123;<br>            origin = <span class="hljs-string">&quot;blank&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> origin;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡é…ç½®ï¼Œç»™ç½‘å…³æ·»åŠ è¿‡æ»¤å™¨</p><blockquote><p>é€šè¿‡ç½‘å…³çš„è¯·æ±‚éƒ½ä¼šè¢«åŠ ä¸Šoriginçš„è¯·æ±‚å¤´ï¼Œå€¼ä¸ºâ€gatewayâ€</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">default-filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=origin,gateway</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æˆæƒè§„åˆ™</p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E6%8E%88%E6%9D%83%E8%A7%84%E5%88%991.png" alt="é…ç½®æˆæƒè§„åˆ™1"></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E6%8E%88%E6%9D%83%E8%A7%84%E5%88%992.png" alt="é…ç½®æˆæƒè§„åˆ™2"></p></li></ul><h4 id="è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ"><a href="#è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ"></a>è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ</h4><blockquote><p>å‘ç”Ÿé™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ï¼Œå¼‚å¸¸ç»“æœéƒ½æ˜¯flow limmitingï¼ˆé™æµï¼‰</p></blockquote><p><strong>å¼‚å¸¸ç§ç±»</strong></p><table><thead><tr><th><strong>å¼‚å¸¸</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>FlowException</td><td>é™æµå¼‚å¸¸</td></tr><tr><td>ParamFlowException</td><td>çƒ­ç‚¹å‚æ•°é™æµçš„å¼‚å¸¸</td></tr><tr><td>DegradeException</td><td>é™çº§å¼‚å¸¸</td></tr><tr><td>AuthorityException</td><td>æˆæƒè§„åˆ™å¼‚å¸¸</td></tr><tr><td>SystemBlockException</td><td>ç³»ç»Ÿè§„åˆ™å¼‚å¸¸</td></tr></tbody></table><p>é€šè¿‡è‡ªå®šä¹‰å µå¡å¼‚å¸¸å¤„ç†å™¨æ¥è‡ªå®šä¹‰è¿”å›ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.order.sentinel;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SentinelExceptionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BlockExceptionHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, BlockException e)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>;    <span class="hljs-comment">//å¼‚å¸¸ä¿¡æ¯</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-number">429</span>;   <span class="hljs-comment">//çŠ¶æ€ç </span><br><br>        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> FlowException) &#123;<br>            msg = <span class="hljs-string">&quot;è¯·æ±‚è¢«é™æµäº†&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> ParamFlowException) &#123;<br>            msg = <span class="hljs-string">&quot;è¯·æ±‚è¢«çƒ­ç‚¹å‚æ•°é™æµ&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> DegradeException) &#123;<br>            msg = <span class="hljs-string">&quot;è¯·æ±‚è¢«é™çº§äº†&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> AuthorityException) &#123;<br>            msg = <span class="hljs-string">&quot;æ²¡æœ‰æƒé™è®¿é—®&quot;</span>;<br>            status = <span class="hljs-number">401</span>;<br>        &#125;<br><br>        response.setContentType(<span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);<br>        response.setStatus(status);<br>        response.getWriter().println(<span class="hljs-string">&quot;&#123;\&quot;msg\&quot;: &quot;</span> + msg + <span class="hljs-string">&quot;, \&quot;status\&quot;: &quot;</span> + status + <span class="hljs-string">&quot;&#125;&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼æœç´¢(1)</title>
    <link href="/2022/09/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2/"/>
    <url>/2022/09/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼æœç´¢-1"><a href="#åˆ†å¸ƒå¼æœç´¢-1" class="headerlink" title="åˆ†å¸ƒå¼æœç´¢(1)"></a>åˆ†å¸ƒå¼æœç´¢(1)</h2><h3 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h3><blockquote><p>ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥å®ç°æœç´¢ã€æ—¥å¿—ç»Ÿè®¡ã€åˆ†æã€ç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½</p></blockquote><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>elastic stackï¼ˆELKï¼‰: æ˜¯ä»¥elasticsearchä¸ºæ ¸å¿ƒçš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬beatsã€Logstashã€kibanaã€elasticsearch</p><p>æ­£å‘ç´¢å¼•ï¼šæ ¹æ®idç´¢å¼•æ¥æŸ¥æ‰¾æ–‡æ¡£</p><p>å€’æ’ç´¢å¼•ï¼šæ ¹æ®æœç´¢çš„è¯æ¡æ‰¾idå†æ‰¾æ–‡æ¡£</p><h4 id="å®‰è£…es"><a href="#å®‰è£…es" class="headerlink" title="å®‰è£…es"></a>å®‰è£…es</h4><p>åˆ›å»ºä¸€ä¸ªç½‘ç»œ, è®©eså’Œkibanaå®¹å™¨äº’è”</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">docker network create es-<span class="hljs-built_in">net</span><br></code></pre></td></tr></table></figure><ul><li><p>æ‹‰å–é•œåƒ(ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œä¸‹è½½æ—¶é—´å¯èƒ½æ¯”è¾ƒé•¿)</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull elasticsearch:<span class="hljs-number">7</span>.<span class="hljs-number">12</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œ</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livescript">docker run -d <span class="hljs-string">\</span><br>--name es <span class="hljs-string">\</span><br>    -e <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> <span class="hljs-string">\</span><br>    -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> <span class="hljs-string">\</span><br>    -v es-data:/usr/share/elasticsearch/data <span class="hljs-string">\</span><br>    -v es-plugins:/usr/share/elasticsearch/plugins <span class="hljs-string">\</span><br>    --privileged <span class="hljs-string">\</span><br>    --network es-net <span class="hljs-string">\</span><br>    -p <span class="hljs-number">9200</span>:<span class="hljs-number">9200</span> <span class="hljs-string">\</span><br>    -p <span class="hljs-number">9300</span>:<span class="hljs-number">9300</span> <span class="hljs-string">\</span><br>elasticsearch:<span class="hljs-number">7.12</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul><p>å‘½ä»¤è§£é‡Šï¼š</p><ul><li><code>-e &quot;cluster.name=es-docker-cluster&quot;</code>ï¼šè®¾ç½®é›†ç¾¤åç§°</li><li><code>-e &quot;http.host=0.0.0.0&quot;</code>ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—®</li><li><code>-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</code>ï¼šå†…å­˜å¤§å°</li><li><code>-e &quot;discovery.type=single-node&quot;</code>ï¼šéé›†ç¾¤æ¨¡å¼</li><li><code>-v es-data:/usr/share/elasticsearch/data</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ•°æ®ç›®å½•</li><li><code>-v es-logs:/usr/share/elasticsearch/logs</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ—¥å¿—ç›®å½•</li><li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code>ï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ’ä»¶ç›®å½•</li><li><code>--privileged</code>ï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ</li><li><code>--network es-net</code> ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­</li><li><code>-p 9200:9200</code>ï¼šç«¯å£æ˜ å°„é…ç½®</li></ul><h4 id="å®‰è£…kibana"><a href="#å®‰è£…kibana" class="headerlink" title="å®‰è£…kibana"></a>å®‰è£…kibana</h4><blockquote><p>kibanaå¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªelasticsearchçš„å¯è§†åŒ–ç•Œé¢</p></blockquote><ul><li><p>æ‹‰å–é•œåƒ(ä¸€å®šè¦å’Œesç‰ˆæœ¬ä¸€æ ·)</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull kibana:<span class="hljs-number">7</span>.<span class="hljs-number">12</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d \<br>--name kibana \<br>-e <span class="hljs-attribute">ELASTICSEARCH_HOSTS</span>=http://es:9200 \<br><span class="hljs-attribute">--network</span>=es-net \<br>-p 5601:5601  \<br>kibana:7.12.1<br></code></pre></td></tr></table></figure></li></ul><p>å‘½ä»¤è§£é‡Š</p><ul><li><code>--network es-net</code> ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ï¼Œä¸elasticsearchåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­</li><li><code>-e ELASTICSEARCH_HOSTS=http://es:9200&quot;</code>ï¼šè®¾ç½®elasticsearchçš„åœ°å€ï¼Œå› ä¸ºkibanaå·²ç»ä¸elasticsearchåœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—®elasticsearch</li><li><code>-p 5601:5601</code>ï¼šç«¯å£æ˜ å°„é…ç½®</li></ul><h4 id="å®‰è£…ik"><a href="#å®‰è£…ik" class="headerlink" title="å®‰è£…ik"></a>å®‰è£…ik</h4><blockquote><p>eså†…ç½®çš„åˆ†è¯å™¨ä¸æ”¯æŒä¸­æ–‡ã€‚ikåˆ†è¯å™¨æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä¸­æ–‡åˆ†è¯å™¨</p></blockquote><ul><li><p>åœ¨çº¿å®‰è£…(é€Ÿåº¦æ…¢)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># è¿›å…¥å®¹å™¨å†…éƒ¨</span><br>docker exec -it elasticsearch <span class="hljs-regexp">/bin/</span>bash<br><br><span class="hljs-comment"># åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…</span><br>.<span class="hljs-regexp">/bin/</span>elasticsearch-plugin  install https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/medcl/</span>elasticsearch-analysis-ik<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v7.12.1/</span>elasticsearch-analysis-ik-<span class="hljs-number">7.12</span>.<span class="hljs-number">1</span>.zip<br><br><span class="hljs-comment">#é€€å‡º</span><br><span class="hljs-keyword">exit</span><br><span class="hljs-comment">#é‡å¯å®¹å™¨</span><br>docker restart elasticsearch<br></code></pre></td></tr></table></figure></li><li><p>ç¦»çº¿å®‰è£…</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># æŸ¥çœ‹esæ’ä»¶ç›®å½•æŒ‚è½½çš„æ•°æ®å·</span><br>docker <span class="hljs-keyword">volume</span><span class="language-bash"> inspect es-plugins</span><br><br><span class="hljs-comment"># å°†ikåˆ†è¯å™¨ä¸Šä¼ åˆ°æ•°æ®å·å†…</span><br><br><span class="hljs-comment"># é‡å¯å®¹å™¨</span><br>docker restart es<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /_analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä¸Šæµ·è‡ªæ¥æ°´æ¥è‡ªä¸Šæµ·&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>IKåˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p><code>ik_smart</code>ï¼šæœ€å°‘åˆ‡åˆ†</p></li><li><p><code>ik_max_word</code>ï¼šæœ€ç»†åˆ‡åˆ†</p></li></ul><h4 id="æ‰©å±•è¯è¯å…¸"><a href="#æ‰©å±•è¯è¯å…¸" class="headerlink" title="æ‰©å±•è¯è¯å…¸"></a>æ‰©å±•è¯è¯å…¸</h4><blockquote><p>IKåˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½</p></blockquote><ul><li><p>ik&#x2F;configç›®å½•ä¸‹çš„IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å¯ä»¥æ·»åŠ æ‰©å±•è¯å…¸</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">properties</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;ext_dict&quot;</span>&gt;</span>ext.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºext_dictï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ è¯æ±‡ï¼Œå¹¶æ”¾åˆ°ik&#x2F;configé‡Œ</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># ext_dictæ–‡ä»¶</span><br>å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ<br>ä¼ æ™ºæ’­å®¢<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯es</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker restart es</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="ESåŸºæœ¬æ“ä½œ"><a href="#ESåŸºæœ¬æ“ä½œ" class="headerlink" title="ESåŸºæœ¬æ“ä½œ"></a>ESåŸºæœ¬æ“ä½œ</h3><h4 id="ç´¢å¼•åº“æ“ä½œ"><a href="#ç´¢å¼•åº“æ“ä½œ" class="headerlink" title="ç´¢å¼•åº“æ“ä½œ"></a>ç´¢å¼•åº“æ“ä½œ</h4><blockquote><p>ç±»ä¼¼mysqlçš„è¡¨</p><p>mappingæ˜¯å¯¹ç´¢å¼•åº“ä¸­æ–‡æ¡£çš„<strong>çº¦æŸ</strong></p></blockquote><p>å¸¸è§çš„mappingå±æ€§åŒ…æ‹¬ï¼š</p><ul><li>typeï¼šå­—æ®µæ•°æ®ç±»å‹ï¼Œå¸¸è§çš„ç®€å•ç±»å‹æœ‰ï¼š<ul><li>å­—ç¬¦ä¸²ï¼štextï¼ˆå¯åˆ†è¯çš„æ–‡æœ¬ï¼‰ã€keywordï¼ˆç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€å›½å®¶ã€ipåœ°å€ï¼‰</li><li>æ•°å€¼ï¼šlongã€integerã€shortã€byteã€doubleã€floatã€</li><li>å¸ƒå°”ï¼šboolean</li><li>æ—¥æœŸï¼šdate</li><li>å¯¹è±¡ï¼šobject</li></ul></li><li>indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrue</li><li>analyzerï¼šä½¿ç”¨å“ªç§åˆ†è¯å™¨</li><li>propertiesï¼šè¯¥å­—æ®µçš„å­å­—æ®µ</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs json"># æ–°å¢ä¸€ä¸ªç´¢å¼•åº“<br>PUT /test<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;keyword&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;keyword&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br># æŸ¥è¯¢ç´¢å¼•åº“<br>GEt /test<br><br># ç»™ç´¢å¼•åº“æ–°å¢å­—æ®µ   (ç´¢å¼•åº“ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•ä¿®æ”¹mappingï¼Œåªèƒ½æ–°å¢)<br>PUT /test/_mapping<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;integer&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br># åˆ é™¤ç´¢å¼•åº“<br>DELETE /test<br></code></pre></td></tr></table></figure><h4 id="æ–‡æ¡£æ“ä½œ"><a href="#æ–‡æ¡£æ“ä½œ" class="headerlink" title="æ–‡æ¡£æ“ä½œ"></a>æ–‡æ¡£æ“ä½œ</h4><blockquote><p>ç±»ä¼¼mysqlçš„æ•°æ®</p></blockquote><p>ç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs json"># æ–°å¢æ–‡æ¡£<br>POST test/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asdasd&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123@qq.com&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;san&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zhang&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br># æŸ¥è¯¢æ–‡æ¡£<br>GET /test/_doc/<span class="hljs-number">1</span><br><br># åˆ é™¤æ–‡æ¡£<br>DELETE /test/_doc/<span class="hljs-number">1</span><br><br># ä¿®æ”¹æ–‡æ¡£(å…¨é‡ä¿®æ”¹<span class="hljs-punctuation">:</span> ç­‰äºDELETE + POSTï¼Œæ–‡æ¡£ä¸å­˜åœ¨ä¹Ÿä¼šæ–°å¢)<br>PUT test/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asdasd&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123@qq.com&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;si&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;li&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br># ä¿®æ”¹æ–‡æ¡£(å¢é‡ä¿®æ”¹<span class="hljs-punctuation">:</span> åªä¿®æ”¹éƒ¨åˆ†)<br>POST test/_update/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;doc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;456@qq.com&quot;</span>  <br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="RESTAPI"><a href="#RESTAPI" class="headerlink" title="RESTAPI"></a>RESTAPI</h3><blockquote><p>ESå®˜æ–¹æä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ“ä½œESã€‚è¿™äº›å®¢æˆ·ç«¯çš„æœ¬è´¨å°±æ˜¯ç»„è£…DSLè¯­å¥ï¼Œé€šè¿‡httpè¯·æ±‚å‘é€ç»™ESã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/client/index.html">https://www.elastic.co/guide/en/elasticsearch/client/index.html</a></p></blockquote><p>Java Rest ClientåˆåŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>Java Low Level Rest Client</li><li>Java High Level Rest Client</li></ul><p>è®¾è®¡mappingæ˜ å°„è¦è€ƒè™‘çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>å­—æ®µå</li><li>å­—æ®µæ•°æ®ç±»å‹</li><li>æ˜¯å¦å‚ä¸æœç´¢</li><li>æ˜¯å¦éœ€è¦åˆ†è¯ </li><li>å¦‚æœåˆ†è¯ï¼Œåˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h4 id="åˆ›å»ºå®¢æˆ·ç«¯"><a href="#åˆ›å»ºå®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»ºå®¢æˆ·ç«¯"></a>åˆ›å»ºå®¢æˆ·ç«¯</h4><blockquote><p>é€šè¿‡å®¢æˆ·ç«¯çš„apiæ“ä½œes</p></blockquote><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ç‰ˆæœ¬è¦å’Œesçš„ç‰ˆæœ¬ä¸€è‡´--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch.version</span>&gt;</span>7.12.1<span class="hljs-tag">&lt;/<span class="hljs-name">elasticsearch.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--RestHighLevelClientä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡newçš„æ–¹å¼åˆ›å»ºå®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelIndexTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> RestHighLevelClient client;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(client);<br>    &#125;<br><br>    <span class="hljs-comment">//åˆå§‹åŒ–</span><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span> &#123;<br>        client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(RestClient.builder(<br>                HttpHost.create(<span class="hljs-string">&quot;http://192.168.229.128:9200&quot;</span>)<br>        ));<br>    &#125;<br><br>    <span class="hljs-comment">//ç»“æŸåé”€æ¯</span><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-built_in">this</span>.client.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="åˆ›å»ºç´¢å¼•åº“"><a href="#åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="åˆ›å»ºç´¢å¼•åº“"></a>åˆ›å»ºç´¢å¼•åº“</h4><ul><li><p>å‡†å¤‡åˆ›å»ºè¯­å¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel.constants;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ESConstants</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">MAPPING_TEMPLATE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;  \&quot;mappings\&quot;: &#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;    \&quot;properties\&quot;: &#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;id\&quot;: &#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;name\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;address\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;price\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;score\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;brand\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;city\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;starName\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;business\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;location\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;geo_point\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;pic\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;      \&quot;all\&quot;:&#123;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +<br>            <span class="hljs-string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> +<br>            <span class="hljs-string">&quot;      &#125;\n&quot;</span> +<br>            <span class="hljs-string">&quot;    &#125;\n&quot;</span> +<br>            <span class="hljs-string">&quot;  &#125;\n&quot;</span> +<br>            <span class="hljs-string">&quot;&#125;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡clientå‘é€åˆ›å»ºç´¢å¼•åº“è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* åˆ›å»ºç´¢å¼•åº“</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">CreateIndexRequest</span> <span class="hljs-variable">createIndexRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateIndexRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span><br>    createIndexRequest.source(MAPPING_TEMPLATE, XContentType.JSON);<br>    <span class="hljs-comment">//è¿”é€è¯·æ±‚</span><br>    client.indices().create(createIndexRequest, RequestOptions.DEFAULT);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="åˆ é™¤ç´¢å¼•åº“"><a href="#åˆ é™¤ç´¢å¼•åº“" class="headerlink" title="åˆ é™¤ç´¢å¼•åº“"></a>åˆ é™¤ç´¢å¼•åº“</h4><ul><li><p>é€šè¿‡clientå‘é€åˆ é™¤å¼•åº“è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* åˆ é™¤ç´¢å¼•åº“</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">DeleteIndexRequest</span> <span class="hljs-variable">deleteIndexRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeleteIndexRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>    client.indices().delete(deleteIndexRequest, RequestOptions.DEFAULT);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="æŸ¥è¯¢ç´¢å¼•åº“"><a href="#æŸ¥è¯¢ç´¢å¼•åº“" class="headerlink" title="æŸ¥è¯¢ç´¢å¼•åº“"></a>æŸ¥è¯¢ç´¢å¼•åº“</h4><ul><li><p>é€šè¿‡clientå‘é€æŸ¥è¯¢å¼•åº“è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢ç´¢å¼•åº“</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">GetIndexRequest</span> <span class="hljs-variable">getIndexRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetIndexRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> client.indices().exists(getIndexRequest, RequestOptions.DEFAULT);<br>    System.out.println(exists ? <span class="hljs-string">&quot;ç´¢å¼•åº“å­˜åœ¨&quot;</span> : <span class="hljs-string">&quot;ç´¢å¼•åº“ä¸å­˜åœ¨&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="æ–°å¢æ–‡æ¡£"><a href="#æ–°å¢æ–‡æ¡£" class="headerlink" title="æ–°å¢æ–‡æ¡£"></a>æ–°å¢æ–‡æ¡£</h4><ul><li><p>é€šè¿‡clientå‘é€æ–°å¢æ–‡æ¡£è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.hotel;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelDocumentTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> RestHighLevelClient client;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IHotelService iHotelService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢æ–‡æ¡£</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">//ä»æ•°æ®åº“ä¸­è·å–hotelå¯¹è±¡</span><br>        <span class="hljs-type">Hotel</span> <span class="hljs-variable">hotel</span> <span class="hljs-operator">=</span> iHotelService.getById(<span class="hljs-number">61083L</span>);<br>        <span class="hljs-comment">//æ•°æ®åº“ä¸­çš„å¯¹è±¡å±æ€§å’Œç´¢å¼•åº“ä¸­ä¸ä¸€è‡´ï¼Œè¦è½¬æ¢ä¸€ä¸‹</span><br>        <span class="hljs-type">HotelDoc</span> <span class="hljs-variable">hotelDoc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HotelDoc</span>(hotel);<br><br>        <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚</span><br>        <span class="hljs-type">IndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>).id(hotelDoc.getId().toString());<br>        <span class="hljs-comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span><br>        request.source(JSON.toJSONString(hotelDoc), XContentType.JSON);<br>        <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>        client.index(request, RequestOptions.DEFAULT);<br>    &#125;<br><br><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span> &#123;<br>        client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(RestClient.builder(<br>                HttpHost.create(<span class="hljs-string">&quot;http://192.168.229.128:9200&quot;</span>)<br>        ));<br>    &#125;<br><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-built_in">this</span>.client.close();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h4 id="æŸ¥è¯¢æ–‡æ¡£"><a href="#æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£"></a>æŸ¥è¯¢æ–‡æ¡£</h4><ul><li><p>é€šè¿‡clientå‘é€æŸ¥è¯¢æ–‡æ¡£è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢æ–‡æ¡£</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">GetDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºè¯·æ±‚</span><br>    <span class="hljs-type">GetRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>, <span class="hljs-string">&quot;61083&quot;</span>);<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚,è·å¾—å“åº”ç»“æœ</span><br>    <span class="hljs-type">GetResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.get(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//å°†å“åº”ç»“æ„è½¬ä¸ºå¯¹è±¡</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> response.getSourceAsString();<br>    <span class="hljs-type">HotelDoc</span> <span class="hljs-variable">hotelDoc</span> <span class="hljs-operator">=</span> JSON.parseObject(json, HotelDoc.class);<br>    System.out.println(hotelDoc);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="ä¿®æ”¹æ–‡æ¡£"><a href="#ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="ä¿®æ”¹æ–‡æ¡£"></a>ä¿®æ”¹æ–‡æ¡£</h4><ul><li><p>é€šè¿‡clientå‘é€ä¿®æ”¹æ–‡æ¡£è¯·æ±‚ï¼Œå…¨é‡ä¿®æ”¹å’Œæ–°å¢æ“ä½œä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ›´æ–°æ–‡æ¡£(å±€éƒ¨ä¿®æ”¹)</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">UpdateDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºè¯·æ±‚</span><br>    <span class="hljs-type">UpdateRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>, <span class="hljs-string">&quot;61083&quot;</span>);<br>    <span class="hljs-comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span><br>    request.doc(<br>        <span class="hljs-string">&quot;price&quot;</span>, <span class="hljs-string">&quot;999&quot;</span><br>    );<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>    client.update(request, RequestOptions.DEFAULT);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="åˆ é™¤æ–‡æ¡£"><a href="#åˆ é™¤æ–‡æ¡£" class="headerlink" title="åˆ é™¤æ–‡æ¡£"></a>åˆ é™¤æ–‡æ¡£</h4><ul><li><p>é€šè¿‡clientå‘é€åˆ é™¤æ–‡æ¡£è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* åˆ é™¤æ–‡æ¡£</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºè¯·æ±‚</span><br>    <span class="hljs-type">DeleteRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeleteRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>, <span class="hljs-string">&quot;61083&quot;</span>);<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>    client.delete(request, RequestOptions.DEFAULT);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="æ‰¹é‡æ–°å¢æ–‡æ¡£"><a href="#æ‰¹é‡æ–°å¢æ–‡æ¡£" class="headerlink" title="æ‰¹é‡æ–°å¢æ–‡æ¡£"></a>æ‰¹é‡æ–°å¢æ–‡æ¡£</h4><ul><li><p>é€šè¿‡clientå‘é€æ‰¹é‡æ–°å¢æ–‡æ¡£è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ‰¹é‡æ–°å¢æ–‡æ¡£</span><br><span class="hljs-comment">* <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bulkCreateDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºè¯·æ±‚</span><br>    <span class="hljs-type">BulkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BulkRequest</span>();<br><br>    <span class="hljs-comment">//æŸ¥è¯¢æ•°æ®åº“ä¸­æ‰€æœ‰hotelä¿¡æ¯</span><br>    List&lt;Hotel&gt; hotels = iHotelService.list();<br>    <span class="hljs-comment">//å°†hotelè½¬æ¢ä¸ºhotelDocï¼Œå†å°è£…åˆ°è¯·æ±‚ä¸­</span><br>    <span class="hljs-keyword">for</span> (Hotel hotel : hotels) &#123;<br>        <span class="hljs-type">HotelDoc</span> <span class="hljs-variable">hotelDoc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HotelDoc</span>(hotel);<br>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>)<br>                    .id(hotel.getId().toString())<br>                    .source(JSON.toJSONString(hotelDoc),XContentType.JSON)<br>                   );<br>    &#125;<br>    <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>    client.bulk(request, RequestOptions.DEFAULT);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨kibanaä¸­ç”¨<code>GET /hotel/_search</code>å¯æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£</p></li></ul><h3 id="DSLæŸ¥è¯¢è¯­æ³•"><a href="#DSLæŸ¥è¯¢è¯­æ³•" class="headerlink" title="DSLæŸ¥è¯¢è¯­æ³•"></a>DSLæŸ¥è¯¢è¯­æ³•</h3><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Domain Specific Language</a></p></blockquote><p>å¸¸è§æŸ¥è¯¢ç±»å‹ï¼š</p><ul><li>æŸ¥è¯¢æ‰€æœ‰</li><li>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢: å¯¹æœç´¢æ¡ä»¶åˆ†è¯å¾—åˆ°è¯æ¡ï¼Œç„¶åé€šè¿‡è¯æ¡æ¥æŸ¥è¯¢ç›¸å…³å­—æ®µ</li><li>ç²¾å‡†æŸ¥è¯¢ï¼š<strong>ä¸ä¼š</strong>å¯¹æœç´¢æ¡ä»¶åˆ†è¯</li><li>åœ°ç†æŸ¥è¯¢ï¼šç»™å®šåæ ‡æ¥æŸ¥è¯¢</li><li>å¤åˆæŸ¥è¯¢ï¼šå°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘</li></ul><p>é€šç”¨æŸ¥è¯¢è¯­æ³•</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">GETÂ /indexName/_search<br><span class="hljs-punctuation">&#123;</span><br>Â Â <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â <span class="hljs-attr">&quot;æŸ¥è¯¢ç±»å‹&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">&#123;</span><br>Â Â Â Â Â Â <span class="hljs-attr">&quot;æŸ¥è¯¢æ¡ä»¶&quot;</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">&quot;æ¡ä»¶å€¼&quot;</span><br>Â Â Â Â <span class="hljs-punctuation">&#125;</span><br>Â Â <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢æ‰€æœ‰"><a href="#æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h4><blockquote><p>match_all</p></blockquote><ul><li><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"># æŸ¥è¯¢hotelç´¢å¼•åº“ä¸­æ‰€æœ‰ä¿¡æ¯<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>  <br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"><a href="#å…¨æ–‡æ£€ç´¢æŸ¥è¯¢" class="headerlink" title="å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"></a>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</h4><blockquote><p>match: å•å­—æ®µæŸ¥è¯¢</p><p>multi_match: å¤šå­—æ®µæŸ¥è¯¢</p></blockquote><ul><li><p>matchå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"># å¯¹å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œç„¶åæŸ¥è¯¢<span class="hljs-string">&quot;all&quot;</span>å­—æ®µ<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤–æ»© å¦‚å®¶&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>multi_matchå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"># å¯¹å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œç„¶åæŸ¥è¯¢<span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;name&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;business&quot;</span>ä¸‰ä¸ªå­—æ®µ<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;multi_match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤–æ»© å¦‚å®¶&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;brand&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;name&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;business&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="ç²¾å‡†æŸ¥è¯¢"><a href="#ç²¾å‡†æŸ¥è¯¢" class="headerlink" title="ç²¾å‡†æŸ¥è¯¢"></a>ç²¾å‡†æŸ¥è¯¢</h4><blockquote><p>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</p><p>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</p></blockquote><ul><li><p>termå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"># æŸ¥è¯¢<span class="hljs-string">&quot;city&quot;</span>å­—æ®µä¸º<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>çš„ä¿¡æ¯<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸Šæµ·&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>rangeå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"># æŸ¥è¯¢<span class="hljs-string">&quot;price&quot;</span>å­—æ®µå€¼ä¸º<span class="hljs-punctuation">[</span><span class="hljs-number">200</span><span class="hljs-punctuation">,</span> <span class="hljs-number">300</span><span class="hljs-punctuation">]</span>ä¹‹é—´çš„ä¿¡æ¯<br># gte<span class="hljs-punctuation">:</span> greater then equals <span class="hljs-punctuation">,</span> lte<span class="hljs-punctuation">:</span> less then equals<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;gte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lte&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="åœ°ç†æŸ¥è¯¢"><a href="#åœ°ç†æŸ¥è¯¢" class="headerlink" title="åœ°ç†æŸ¥è¯¢"></a>åœ°ç†æŸ¥è¯¢</h4><blockquote><p>geo_distanceï¼šæŒ‡å®šåæ ‡å’ŒåŠå¾„æ¥æŸ¥è¯¢èŒƒå›´å†…çš„æ•°æ®</p><p>geo_bounding_boxï¼šæŒ‡å®šä¸¤ä¸ªåæ ‡ï¼ŒæŸ¥è¯¢å½¢æˆçš„çŸ©å½¢å†…çš„æ•°æ®</p></blockquote><ul><li><p>geo_distanceå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"># ä»¥<span class="hljs-string">&quot;31.21,121.5&quot;</span> ä¸ºç‚¹åšåŠå¾„ä¸º<span class="hljs-number">15</span>kmçš„åœ†<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;geo_distance&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;distance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;15km&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;31.21,121.5&quot;</span> <br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>geo_bounding_boxå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;geo_bounding_box&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;top_left&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;lat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">31.1</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;lon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">121.5</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;bottom_right&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;lat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30.9</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;lon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">121.7</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="å¤åˆæŸ¥è¯¢"><a href="#å¤åˆæŸ¥è¯¢" class="headerlink" title="å¤åˆæŸ¥è¯¢"></a>å¤åˆæŸ¥è¯¢</h4><blockquote><p>function scoreï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’å</p><p>bool queryï¼šå¸ƒå°”æŸ¥è¯¢ï¼Œåˆ©ç”¨é€»è¾‘å…³ç³»ç»„åˆå¤šä¸ªå…¶å®ƒçš„æŸ¥è¯¢ï¼Œå®ç°å¤æ‚æœç´¢</p></blockquote><p><strong>function score</strong></p><p>elasticsearchä¼šæ ¹æ®è¯æ¡å’Œæ–‡æ¡£çš„ç›¸å…³åº¦åšæ‰“åˆ†ï¼Œç®—æ³•ç”±ä¸¤ç§ï¼š</p><ul><li><p>TF-IDFç®—æ³•</p><p><img src="/img/weifuwu_img/TF-IDF%E7%AE%97%E6%B3%95.png" alt="TF-IDFç®—æ³•"></p></li><li><p>BM25ç®—æ³•ï¼Œelasticsearch5.1ç‰ˆæœ¬åé‡‡ç”¨çš„ç®—æ³•</p><p><img src="/img/weifuwu_img/BM25.png" alt="BM25"></p></li><li><p>function scoreå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs json"># å¤åˆæŸ¥è¯¢<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;function_score&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-comment">//åŸå§‹æŸ¥è¯¢æ¡ä»¶</span><br>        <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤–æ»©&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;functions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-comment">//è¿‡æ»¤æŸ¥åˆ°çš„ä¿¡æ¯</span><br>            <span class="hljs-attr">&quot;term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;brand&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚å®¶&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;weight&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;boost_mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sum&quot;</span><span class="hljs-comment">//sumæ¨¡å¼ä¸º_score = åŸå§‹åˆ†æ•° + weight</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><p><strong>bool query</strong></p><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªå­å¥å°±æ˜¯ä¸€ä¸ª<strong>å­æŸ¥è¯¢</strong>ã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š</p><ul><li>mustï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œä¸â€</li><li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œæˆ–â€</li><li>must_notï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong>ï¼Œç±»ä¼¼â€œéâ€</li><li>filterï¼šå¿…é¡»åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong></li></ul><ul><li><p>bool queryå®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs json"># åå­—ä¸­åŒ…å«<span class="hljs-string">&quot;å¦‚å®¶&quot;</span><span class="hljs-punctuation">,</span> ä»·æ ¼<span class="hljs-number">400</span>ä»¥ä¸Šï¼ŒèŒƒå›´<span class="hljs-number">10</span>kmä¹‹å†…<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;bool&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;must&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚å®¶&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;must_not&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;range&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;gt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;geo_distance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;distance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10km&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;lat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">31.21</span><span class="hljs-punctuation">,</span><br>              <span class="hljs-attr">&quot;lon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">121.5</span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="æœç´¢ç»“æœå¤„ç†"><a href="#æœç´¢ç»“æœå¤„ç†" class="headerlink" title="æœç´¢ç»“æœå¤„ç†"></a>æœç´¢ç»“æœå¤„ç†</h3><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><blockquote><p>sort</p></blockquote><ul><li><p>å®ä¾‹1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"># æŒ‰åˆ†æ•°é™åºï¼Œä»·æ ¼å‡åºæ’åº<br>GET /hotel/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>  , <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;asc&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å®ä¾‹2</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"># æŒ‰è·ç¦»å‡åºæ’åºï¼Œå•ä½<span class="hljs-string">&quot;km&quot;</span><br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;_geo_distance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;lat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">31</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;lon&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">121</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;order&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asc&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;unit&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;km&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h4><blockquote><p>fromã€size</p></blockquote><p>æ·±åº¦åˆ†é¡µé—®é¢˜ï¼š</p><blockquote><p>elasticsearchå†…éƒ¨åˆ†é¡µæ—¶ï¼Œè¦æŸ¥990 ~ 1000çš„è¿™10æ¡ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢ 0~1000æ¡ï¼Œç„¶åæˆªå–å…¶ä¸­çš„990 ~ 1000çš„è¿™10æ¡ã€‚å½“esé›†ç¾¤æ—¶ï¼Œè‹¥è¦æŸ¥å‰1000çš„æ–‡æ¡£ï¼Œå°±å¾—å…ˆæŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹çš„å‰1000ï¼Œå†å°†è¿™äº›æ–‡æ¡£é‡æ–°æ’ååé€‰å‡ºå‰1000ï¼Œå¯¹äºèŠ‚ç‚¹æœ‰å¾ˆå¤§å‹åŠ›ã€‚</p><p>å› æ­¤elasticsearchä¼šç¦æ­¢from+ size è¶…è¿‡10000çš„è¯·æ±‚ã€‚</p></blockquote><ul><li><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"># ä»<span class="hljs-number">0</span>å·å¼€å§‹æŸ¥è¯¢<span class="hljs-number">20</span>æ¡æ•°æ®<br>GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;from&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span># èµ·å§‹å€¼ï¼Œé»˜è®¤<span class="hljs-number">0</span><br>  <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span># å¸Œæœ›è·å–çš„æ–‡æ¡£æ€»æ•°<br>  <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;asc&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br>  <br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="é«˜äº®"><a href="#é«˜äº®" class="headerlink" title="é«˜äº®"></a>é«˜äº®</h4><blockquote><p>highlight</p></blockquote><ul><li><p>å®ä¾‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /hotel/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚å®¶&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <br>  <span class="hljs-attr">&quot;highlight&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;require_field_match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;false&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>é«˜äº®æ˜¯å¯¹å…³é”®å­—é«˜äº®ï¼Œå› æ­¤<strong>æœç´¢æ¡ä»¶å¿…é¡»å¸¦æœ‰å…³é”®å­—</strong>ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´è¿™æ ·çš„æŸ¥è¯¢ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>é«˜äº®çš„å­—æ®µï¼Œå¿…é¡»ä¸æœç´¢æŒ‡å®šçš„å­—æ®µä¸€è‡´</strong>ï¼Œå¦åˆ™æ— æ³•é«˜äº®</li><li>å¦‚æœè¦å¯¹éæœç´¢å­—æ®µé«˜äº®ï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€ä¸ªå±æ€§ï¼šrequired_field_match&#x3D;false</li></ul></li></ul><h3 id="RestAPIæŸ¥è¯¢"><a href="#RestAPIæŸ¥è¯¢" class="headerlink" title="RestAPIæŸ¥è¯¢"></a>RestAPIæŸ¥è¯¢</h3><blockquote><p>ä¸ä¸€æ ·çš„åœ°æ–¹å°±QueryBuildersçš„æŸ¥è¯¢æ¡ä»¶</p></blockquote><h4 id="æŸ¥è¯¢æ‰€æœ‰-1"><a href="#æŸ¥è¯¢æ‰€æœ‰-1" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h4><ul><li>matchAllQueryå®ä¾‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŸ¥è¯¢æ‰€æœ‰</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMatchAll</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.matchAllQuery());<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* è§£æç»“æœ</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handResponse</span><span class="hljs-params">(SearchResponse response)</span> &#123;<br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    <span class="hljs-type">SearchHits</span> <span class="hljs-variable">searchHits</span> <span class="hljs-operator">=</span> response.getHits();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> searchHits.getTotalHits().value; <span class="hljs-comment">//è·å–ç»“æœæ€»æ•°</span><br>    SearchHit[] hits = searchHits.getHits();    <span class="hljs-comment">//è·å–ç»“æœé›†</span><br>    System.out.println(<span class="hljs-string">&quot;ç»“æœæ•°: &quot;</span> + value);<br>    <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> hit.getSourceAsString();<br>        <span class="hljs-type">HotelDoc</span> <span class="hljs-variable">hotelDoc</span> <span class="hljs-operator">=</span> JSON.parseObject(json, HotelDoc.class);<br>        System.out.println(hotelDoc);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/weifuwu_img/%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%BB%93%E6%9E%9C.png" alt="æŸ¥è¯¢æ‰€æœ‰ç»“æœ"></p><p>è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><code>searchHits</code>ï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ<ul><li><code>SearchHits#getTotalHits().value</code>ï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯</li><li><code>SearchHits#getHits()</code>ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„<ul><li><code>SearchHit#getSourceAsString()</code>ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ®</li></ul></li></ul></li></ul><h4 id="å…¨æ–‡æ£€ç´¢æŸ¥è¯¢-1"><a href="#å…¨æ–‡æ£€ç´¢æŸ¥è¯¢-1" class="headerlink" title="å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"></a>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</h4><ul><li><p>matchQueryå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.matchQuery(<span class="hljs-string">&quot;all&quot;</span>, <span class="hljs-string">&quot;å¦‚å®¶&quot;</span>));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>multiMatchQueryå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMultiMatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.multiMatchQuery(<span class="hljs-string">&quot;å¦‚å®¶&quot;</span>, <br>                                                         <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;business&quot;</span>));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="ç²¾å‡†æŸ¥è¯¢-1"><a href="#ç²¾å‡†æŸ¥è¯¢-1" class="headerlink" title="ç²¾å‡†æŸ¥è¯¢"></a>ç²¾å‡†æŸ¥è¯¢</h4><ul><li><p>termQueryå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTerm</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.termQuery(<span class="hljs-string">&quot;city&quot;</span>, <span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>rangeQueryå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTerm</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.rangeQuery(<span class="hljs-string">&quot;price&quot;</span>)<br>                           .gte(<span class="hljs-number">100</span>)<br>                           .lte(<span class="hljs-number">150</span>));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="å¤åˆæŸ¥è¯¢-1"><a href="#å¤åˆæŸ¥è¯¢-1" class="headerlink" title="å¤åˆæŸ¥è¯¢"></a>å¤åˆæŸ¥è¯¢</h4><ul><li><p>boolQueryå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBool</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.boolQuery()<br>                           .must(QueryBuilders.termQuery(<span class="hljs-string">&quot;city&quot;</span>, <span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>))<br>                           .filter(QueryBuilders.rangeQuery(<span class="hljs-string">&quot;price&quot;</span>).lte(<span class="hljs-number">200</span>)));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="æ’åº-1"><a href="#æ’åº-1" class="headerlink" title="æ’åº"></a>æ’åº</h4><ul><li><p>sortå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSort</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().sort(<span class="hljs-string">&quot;price&quot;</span>, SortOrder.DESC);<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="åˆ†é¡µ-1"><a href="#åˆ†é¡µ-1" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h4><ul><li><p>fromã€sizeå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPage</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>, size = <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().from((page - <span class="hljs-number">1</span>) * size).size(size);<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="é«˜äº®-1"><a href="#é«˜äº®-1" class="headerlink" title="é«˜äº®"></a>é«˜äº®</h4><ul><li><p>highlighterå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHighlight</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">//åˆ›å»ºrequestè¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(<span class="hljs-string">&quot;hotel&quot;</span>);<br>    <span class="hljs-comment">//ç»„ç»‡DSLå‚æ•°</span><br>    request.source().query(QueryBuilders.matchQuery(<span class="hljs-string">&quot;all&quot;</span>, <span class="hljs-string">&quot;å¦‚å®¶&quot;</span>))<br>        .highlighter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>().field(<span class="hljs-string">&quot;name&quot;</span>).requireFieldMatch(<span class="hljs-literal">false</span>));<br>    <span class="hljs-comment">//å‘é€æŸ¥è¯¢è¯·æ±‚ï¼Œè·å–ç»“æœ</span><br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);<br><br>    <span class="hljs-comment">//è§£æç»“æœ</span><br>    handleResponse(response);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç»“æœå¤„ç†æ—¶å¾—è·å–Highlighté‡Œçš„å€¼</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—</title>
    <link href="/2022/09/11/%E5%BE%AE%E6%9C%8D%E5%8A%A1/MQ/"/>
    <url>/2022/09/11/%E5%BE%AE%E6%9C%8D%E5%8A%A1/MQ/</url>
    
    <content type="html"><![CDATA[<h2 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h2><blockquote><p>Message Queue</p></blockquote><h3 id="å¾®æœåŠ¡é—´é€šè®¯æ–¹å¼"><a href="#å¾®æœåŠ¡é—´é€šè®¯æ–¹å¼" class="headerlink" title="å¾®æœåŠ¡é—´é€šè®¯æ–¹å¼"></a>å¾®æœåŠ¡é—´é€šè®¯æ–¹å¼</h3><blockquote><p>å¾®æœåŠ¡é—´é€šè®¯æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼</p></blockquote><table><thead><tr><th></th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>åŒæ­¥è°ƒç”¨</td><td>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</td><td>- è€¦åˆåº¦é«˜<br/>- æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™<br/>- æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—<br/>- æœ‰çº§è”å¤±è´¥é—®é¢˜</td></tr><tr><td>å¼‚æ­¥è°ƒç”¨</td><td>- ååé‡æå‡ï¼šæ— éœ€ç­‰å¾…è®¢é˜…è€…å¤„ç†å®Œæˆï¼Œå“åº”æ›´å¿«é€Ÿ<br/>- æ•…éšœéš”ç¦»ï¼šæœåŠ¡æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨çº§è”å¤±è´¥é—®é¢˜<br/>- è°ƒç”¨é—´æ²¡æœ‰é˜»å¡ï¼Œä¸ä¼šé€ æˆæ— æ•ˆçš„èµ„æºå ç”¨<br/>- è€¦åˆåº¦æä½ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥çµæ´»æ’æ‹”ï¼Œå¯æ›¿æ¢<br/>- æµé‡å‰Šå³°ï¼šä¸ç®¡å‘å¸ƒäº‹ä»¶çš„æµé‡æ³¢åŠ¨å¤šå¤§ï¼Œéƒ½ç”±Brokeræ¥æ”¶ï¼Œè®¢é˜…è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦å»å¤„ç†äº‹ä»¶</td><td>- æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½ç®¡ç†<br/>- éœ€è¦ä¾èµ–äºBrokerçš„å¯é ã€å®‰å…¨ã€æ€§èƒ½</td></tr></tbody></table><h3 id="å¸¸è§çš„MQå®ç°"><a href="#å¸¸è§çš„MQå®ç°" class="headerlink" title="å¸¸è§çš„MQå®ç°"></a>å¸¸è§çš„MQå®ç°</h3><table><thead><tr><th></th><th><strong>RabbitMQ</strong></th><th><strong>ActiveMQ</strong></th><th><strong>RocketMQ</strong></th><th><strong>Kafka</strong></th></tr></thead><tbody><tr><td>å…¬å¸&#x2F;ç¤¾åŒº</td><td>Rabbit</td><td>Apache</td><td>é˜¿é‡Œ</td><td>Apache</td></tr><tr><td>å¼€å‘è¯­è¨€</td><td>Erlang</td><td>Java</td><td>Java</td><td>Scala&amp;Java</td></tr><tr><td>åè®®æ”¯æŒ</td><td>AMQPï¼ŒXMPPï¼ŒSMTPï¼ŒSTOMP</td><td>OpenWire,STOMPï¼ŒREST,XMPP,AMQP</td><td>è‡ªå®šä¹‰åè®®</td><td>è‡ªå®šä¹‰åè®®</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>é«˜</td></tr><tr><td>å•æœºååé‡</td><td>ä¸€èˆ¬</td><td>å·®</td><td>é«˜</td><td>éå¸¸é«˜</td></tr><tr><td>æ¶ˆæ¯å»¶è¿Ÿ</td><td>å¾®ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’ä»¥å†…</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>ä¸€èˆ¬</td></tr></tbody></table><h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><h4 id="é€šè¿‡Dockerå®‰è£…"><a href="#é€šè¿‡Dockerå®‰è£…" class="headerlink" title="é€šè¿‡Dockerå®‰è£…"></a>é€šè¿‡Dockerå®‰è£…</h4><ul><li>é€‰æ‹©å¸¦æœ‰mangementçš„ç‰ˆæœ¬(å¸¦æœ‰ç®¡ç†ç•Œé¢)å®‰è£…</li></ul><p><a href="https://hub.docker.com/_/rabbitmq">rabbitmq - Official Image | Docker Hub</a></p><ul><li><p>æ‰§è¡Œå‘½ä»¤å¯åŠ¨å®¹å™¨</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript">docker run <span class="hljs-string">\</span><br> -e RABBITMQ_DEFAULT_USER=root <span class="hljs-string">\</span><br> -e RABBITMQ_DEFAULT_PASS=<span class="hljs-number">123456</span> <span class="hljs-string">\</span><br> --name mq <span class="hljs-string">\</span><br> --hostname mq1 <span class="hljs-string">\</span><br> -p <span class="hljs-number">15672</span>:<span class="hljs-number">15672</span> <span class="hljs-string">\</span><br> -p <span class="hljs-number">5672</span>:<span class="hljs-number">5672</span> <span class="hljs-string">\</span><br> -d <span class="hljs-string">\</span><br> rabbitmq:<span class="hljs-number">3</span>-management<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡15672ç«¯å£æ‰“å¼€ç®¡ç†ç•Œé¢</p></li></ul><h4 id="mqåŸºæœ¬ç»“æ„"><a href="#mqåŸºæœ¬ç»“æ„" class="headerlink" title="mqåŸºæœ¬ç»“æ„"></a>mqåŸºæœ¬ç»“æ„</h4><p><img src="/img/weifuwu_img/mq%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.png" alt="mqåŸºæœ¬ç»“æ„"></p><p>RabbitMQä¸­çš„ä¸€äº›è§’è‰²ï¼š</p><ul><li>publisherï¼šç”Ÿäº§è€…</li><li>consumerï¼šæ¶ˆè´¹è€…</li><li>exchangeä¸ªï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±</li><li>queueï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</li><li>virtualHostï¼šè™šæ‹Ÿä¸»æœºï¼Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„exchangeã€queueã€æ¶ˆæ¯çš„éš”ç¦»</li></ul><h4 id="å°æ¡ˆä¾‹"><a href="#å°æ¡ˆä¾‹" class="headerlink" title="å°æ¡ˆä¾‹"></a>å°æ¡ˆä¾‹</h4><p>é€šè¿‡rabbitmqæ¥å®ç°æ¶ˆæ¯çš„è¿”é€å’Œæ¥æ”¶</p><p><img src="/img/weifuwu_img/%E7%AE%80%E5%8D%95%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B.png" alt="ç®€å•æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹"></p><ul><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PublisherTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSendMessage</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// 1.å»ºç«‹è¿æ¥</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        <span class="hljs-comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span><br>        factory.setHost(<span class="hljs-string">&quot;192.168.229.128&quot;</span>);<br>        factory.setPort(<span class="hljs-number">5672</span>);<br>        factory.setVirtualHost(<span class="hljs-string">&quot;/&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-comment">// 1.2.å»ºç«‹è¿æ¥</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br><br>        <span class="hljs-comment">// 2.åˆ›å»ºé€šé“Channel</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br><br>        <span class="hljs-comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;<br>        channel.queueDeclare(queueName, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 4.å‘é€æ¶ˆæ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello, rabbitmq!&quot;</span>;<br>        channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>, queueName, <span class="hljs-literal">null</span>, message.getBytes());<br>        System.out.println(<span class="hljs-string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼šã€&quot;</span> + message + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br><br>        <span class="hljs-comment">// 5.å…³é—­é€šé“å’Œè¿æ¥</span><br>        channel.close();<br>        connection.close();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// 1.å»ºç«‹è¿æ¥</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        <span class="hljs-comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span><br>        factory.setHost(<span class="hljs-string">&quot;192.168.229.128&quot;</span>);<br>        factory.setPort(<span class="hljs-number">5672</span>);<br>        factory.setVirtualHost(<span class="hljs-string">&quot;/&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-comment">// 1.2.å»ºç«‹è¿æ¥</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> factory.newConnection();<br><br>        <span class="hljs-comment">// 2.åˆ›å»ºé€šé“Channel</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br><br>        <span class="hljs-comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;<br>        channel.queueDeclare(queueName, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 4.è®¢é˜…æ¶ˆæ¯</span><br>        channel.basicConsume(queueName, <span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConsumer</span>(channel)&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope,</span><br><span class="hljs-params">                                       AMQP.BasicProperties properties, <span class="hljs-type">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                <span class="hljs-comment">// 5.å¤„ç†æ¶ˆæ¯</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(body);<br>                System.out.println(<span class="hljs-string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + message + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>            &#125;<br>        &#125;);<br>        System.out.println(<span class="hljs-string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚ã€‚ã€‚ã€‚&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h3 id="SpringAMQP"><a href="#SpringAMQP" class="headerlink" title="SpringAMQP"></a>SpringAMQP</h3><blockquote><p>Advanced Message Queuing Protocol(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)</p><p>SpringAMQP: åŸºäºAMQPå®šä¹‰çš„ä¸€å¥—APIè§„èŒƒ</p></blockquote><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li></ul><h4 id="SimpleQueue-ç®€å•é˜Ÿåˆ—æ¨¡å‹"><a href="#SimpleQueue-ç®€å•é˜Ÿåˆ—æ¨¡å‹" class="headerlink" title="SimpleQueue(ç®€å•é˜Ÿåˆ—æ¨¡å‹)"></a>SimpleQueue(ç®€å•é˜Ÿåˆ—æ¨¡å‹)</h4><blockquote><p>ä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…</p></blockquote><p>é€šè¿‡SpringAMQPæ¥å®ç°æ¶ˆæ¯çš„è¿”é€å’Œæ¥æ”¶</p><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure></li><li><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableRabbit</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAMQPTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSimpleQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;#æ¶ˆæ¯é˜Ÿåˆ—å<br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;testMessage&quot;</span>;#å‘é€çš„æ¶ˆæ¯<br>        rabbitTemplate.convertAndSend(queueName, message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆè´¹è€…(åŒæ ·è¦å¯¼å…¥ä¾èµ–ã€ç¼–å†™é…ç½®)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ³¨å…¥ä¸€ä¸ªlistenerï¼Œè‡ªåŠ¨ç›‘å¬é˜Ÿåˆ—</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRabbitListener</span> &#123;<br>    <span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span>#ç›‘å¬çš„é˜Ÿåˆ—å<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerSimpleQueueMessage</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(msg);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//å¯åŠ¨é¡¹ç›®å³å¯ç›‘å¬é˜Ÿåˆ—ï¼Œæœ‰æ¶ˆæ¯è‡ªåŠ¨è·å–</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="WorkQueue-ä»»åŠ¡é˜Ÿåˆ—æ¨¡å‹"><a href="#WorkQueue-ä»»åŠ¡é˜Ÿåˆ—æ¨¡å‹" class="headerlink" title="WorkQueue(ä»»åŠ¡é˜Ÿåˆ—æ¨¡å‹)"></a>WorkQueue(ä»»åŠ¡é˜Ÿåˆ—æ¨¡å‹)</h4><blockquote><p>è®©<strong>å¤šä¸ªæ¶ˆè´¹è€…</strong>ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p></blockquote><p><img src="/img/weifuwu_img/workQueue.png" alt="workQueue"></p><ul><li><p>è¿”é€å¤šæ¡æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWorkQueue</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å‘é€50æ¡æ¶ˆæ¯</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; ++i) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;simple.queue&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;testMessage&quot;</span> + i;<br>        rabbitTemplate.convertAndSend(queueName, message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å¤šä¸ªæ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerWorkQueueMessage1</span><span class="hljs-params">(String msg)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span> + LocalTime.now());<br>    Thread.sleep(<span class="hljs-number">20</span>);<span class="hljs-comment">//å¤„ç†å¿«</span><br>&#125;<br><br><span class="hljs-meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerWorkQueueMessage2</span><span class="hljs-params">(String msg)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    System.err.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span> + LocalTime.now());<br>    Thread.sleep(<span class="hljs-number">200</span>);<span class="hljs-comment">//å¤„ç†æ…¢</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœä¸é…ç½®çš„è¯ä¼šï¼Œæ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.229</span><span class="hljs-number">.128</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">listener:</span><br>      <span class="hljs-attr">simple:</span><br>        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span>  <span class="hljs-comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="å‘å¸ƒ-x2F-è®¢é˜…æ¨¡å‹"><a href="#å‘å¸ƒ-x2F-è®¢é˜…æ¨¡å‹" class="headerlink" title="å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹"></a>å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹</h4><p><img src="/img/weifuwu_img/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B.png" alt="å‘å¸ƒè®¢é˜…æ¨¡å‹"></p><p>Exchangeï¼šäº¤æ¢æœºã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚<strong>äº¤æ¢æœºåªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ã€‚Exchangeæœ‰ä»¥ä¸‹<strong>3</strong>ç§ç±»å‹ï¼š</p><ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul><p><strong>Fanoutäº¤æ¢æœº</strong></p><blockquote><p>æ¶ˆæ¯ä¼šé€šè¿‡äº¤æ¢æœº<strong>å¹¿æ’­</strong>åˆ°æ‰€æœ‰ç»‘å®šé˜Ÿåˆ—</p></blockquote><ul><li>å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutConfig</span> &#123;<br>    <span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FanoutExchange <span class="hljs-title function_">fanoutExchange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FanoutExchange</span>(<span class="hljs-string">&quot;test.fanout&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—1</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queue1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">&quot;fanout.queue1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—2</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">queue2</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">&quot;fanout.queue2&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—1</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue1</span><span class="hljs-params">(Queue queue1, FanoutExchange fanoutExchange)</span> &#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue1).to(fanoutExchange);<br>    &#125;<br><br>    <span class="hljs-comment">//ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—2</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue2</span><span class="hljs-params">(Queue queue2, FanoutExchange fanoutExchange)</span> &#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue2).to(fanoutExchange);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li><p>å£°æ˜ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFanoutExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å‘é€åˆ°äº¤æ¢æœº</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;test.fanout&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;testMessage&quot;</span>;<br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å£°æ˜æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRabbitListener</span> &#123;<br>    <span class="hljs-meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerWorkQueueMessage1</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerWorkQueueMessage2</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.err.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>Directäº¤æ¢æœº</strong></p><blockquote><p>é€šè¿‡key<strong>å®šå‘</strong>å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯</p></blockquote><ul><li><p>é€šè¿‡æ³¨è§£åœ¨listenerä¸Šå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRabbitListener</span> &#123;<br>    <span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">            value = @Queue(name = &quot;direct.queue1&quot;), //ç»‘å®šé˜Ÿåˆ—</span><br><span class="hljs-meta">            exchange = @Exchange(name = &quot;test.direct&quot;, type = ExchangeTypes.DIRECT),    //ç»‘å®šäº¤æ¢æœº</span><br><span class="hljs-meta">            key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;   //ç»‘å®škey,åªæœ‰é˜Ÿåˆ—æœ‰å’Œæ¶ˆæ¯ç›¸åŒçš„keyæ—¶ï¼Œæ‰ä¼šæ”¶åˆ°æ¶ˆæ¯</span><br><span class="hljs-meta">    ))</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerDirectQueue1</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">            value = @Queue(name = &quot;direct.queue2&quot;), //ç»‘å®šé˜Ÿåˆ—</span><br><span class="hljs-meta">            exchange = @Exchange(name = &quot;test.direct&quot;, type = ExchangeTypes.DIRECT),    //ç»‘å®šäº¤æ¢æœº</span><br><span class="hljs-meta">            key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;   //ç»‘å®škey,åªæœ‰é˜Ÿåˆ—æœ‰å’Œæ¶ˆæ¯ç›¸åŒçš„keyæ—¶ï¼Œæ‰ä¼šæ”¶åˆ°æ¶ˆæ¯</span><br><span class="hljs-meta">    ))</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerDirectQueue2</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDirectExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å‘é€åˆ°äº¤æ¢æœº</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;test.direct&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;testMessage&quot;</span>;<br>    <span class="hljs-comment">//åªæœ‰æœ‰&quot;yellow&quot;çš„é˜Ÿåˆ—ä¼šæ”¶åˆ°æ¶ˆæ¯</span><br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;yellow&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>Topic</strong></p><blockquote><p>é€šè¿‡<strong>é€šé…ç¬¦</strong>#(ä¸€ä¸ªæˆ–å¤šä¸ª)å’Œ.(ä¸€ä¸ª)æ¥åŒ¹é…é˜Ÿåˆ—</p></blockquote><ul><li><p>é€šè¿‡æ³¨è§£åœ¨listenerä¸Šå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¯é¢˜äº¤æ¢æœº</span><br><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;topic.queue1&quot;), //ç»‘å®šé˜Ÿåˆ—</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;test.topic&quot;, type = ExchangeTypes.TOPIC),    //ç»‘å®šäº¤æ¢æœº</span><br><span class="hljs-meta">    key = &quot;china.#&quot;   //ç»‘å®šé€šé…ç¬¦,åªæœ‰æ»¡è¶³æ ¼å¼çš„æ¶ˆæ¯ï¼Œæ‰ä¼šæ¥æ”¶</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerTopicQueue1</span><span class="hljs-params">(String msg)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@RabbitListener(bindings = @QueueBinding(</span><br><span class="hljs-meta">    value = @Queue(name = &quot;topic.queue2&quot;), //ç»‘å®šé˜Ÿåˆ—</span><br><span class="hljs-meta">    exchange = @Exchange(name = &quot;test.topic&quot;, type = ExchangeTypes.TOPIC),    //ç»‘å®šäº¤æ¢æœº</span><br><span class="hljs-meta">    key = &quot;#.news&quot;   //ç»‘å®šé€šé…ç¬¦,åªæœ‰æ»¡è¶³æ ¼å¼çš„æ¶ˆæ¯ï¼Œæ‰ä¼šæ¥æ”¶</span><br><span class="hljs-meta">))</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerTopicQueue2</span><span class="hljs-params">(String msg)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="hljs-string">&quot;ã€‘&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å‘é€æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTopicExchange</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å‘é€åˆ°äº¤æ¢æœº</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">exchangeName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;test.topic&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;testMessage&quot;</span>;<br>    rabbitTemplate.convertAndSend(exchangeName, <span class="hljs-string">&quot;china.weather&quot;</span>, message);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="é…ç½®æ¶ˆæ¯è½¬æ¢å™¨"><a href="#é…ç½®æ¶ˆæ¯è½¬æ¢å™¨" class="headerlink" title="é…ç½®æ¶ˆæ¯è½¬æ¢å™¨"></a>é…ç½®æ¶ˆæ¯è½¬æ¢å™¨</h4><ul><li><p>å¯¼å…¥jacksonè½¬æ¢å™¨ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--jacksonæ¶ˆæ¯è½¬æ¢å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>å£°æ˜è½¬æ¢å™¨æ¥æ›¿æ¢åŸæœ‰çš„è½¬æ¢å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> MessageConverter <span class="hljs-title function_">messageConverter</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonMessageConverter</span>();<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/2022/09/09/%E5%BE%AE%E6%9C%8D%E5%8A%A1/Docker/"/>
    <url>/2022/09/09/%E5%BE%AE%E6%9C%8D%E5%8A%A1/Docker/</url>
    
    <content type="html"><![CDATA[<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="Dockerä½œç”¨"><a href="#Dockerä½œç”¨" class="headerlink" title="Dockerä½œç”¨"></a>Dockerä½œç”¨</h3><p>å¤§å‹é¡¹ç›®ç»„ä»¶è¾ƒå¤šï¼Œè¿è¡Œç¯å¢ƒä¹Ÿè¾ƒä¸ºå¤æ‚ï¼Œéƒ¨ç½²æ—¶æ‰€éœ€è¦çš„å‡½æ•°åº“ã€ä¾èµ–é¡¹å„ä¸ç›¸åŒï¼Œç”šè‡³ä¼šæœ‰å†²çªã€‚ç»™éƒ¨ç½²å¸¦æ¥äº†æå¤§çš„å›°éš¾</p><p>Dockerä¸ºäº†è§£å†³ä¾èµ–çš„å…¼å®¹é—®é¢˜çš„ï¼Œé‡‡ç”¨äº†ä¸¤ä¸ªæ‰‹æ®µï¼š</p><ul><li><p>å°†åº”ç”¨çš„Libsï¼ˆå‡½æ•°åº“ï¼‰ã€Depsï¼ˆä¾èµ–ï¼‰ã€é…ç½®ä¸åº”ç”¨ä¸€èµ·æ‰“åŒ…</p></li><li><p>å°†æ¯ä¸ªåº”ç”¨æ”¾åˆ°ä¸€ä¸ªéš”ç¦»<strong>å®¹å™¨</strong>å»è¿è¡Œï¼Œé¿å…äº’ç›¸å¹²æ‰°</p></li></ul><h3 id="Dockeræ¶æ„"><a href="#Dockeræ¶æ„" class="headerlink" title="Dockeræ¶æ„"></a>Dockeræ¶æ„</h3><p>æ¦‚å¿µï¼š</p><ul><li><p><strong>é•œåƒï¼ˆImageï¼‰</strong>ï¼šDockerå°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€éœ€çš„ä¾èµ–ã€å‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ç­‰æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç§°ä¸ºé•œåƒã€‚</p></li><li><p><strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼šé•œåƒä¸­çš„åº”ç”¨ç¨‹åºè¿è¡Œåå½¢æˆçš„è¿›ç¨‹å°±æ˜¯<strong>å®¹å™¨</strong>ï¼Œåªæ˜¯Dockerä¼šç»™å®¹å™¨è¿›ç¨‹åšéš”ç¦»ï¼Œå¯¹å¤–ä¸å¯è§ã€‚</p></li><li><p><strong>DockerHub</strong>ï¼šDockerHubæ˜¯ä¸€ä¸ªå®˜æ–¹çš„Dockeré•œåƒçš„æ‰˜ç®¡å¹³å°ã€‚è¿™æ ·çš„å¹³å°ç§°ä¸ºDocker Registryã€‚</p></li></ul><p>Dockeræ˜¯ä¸€ä¸ªCSæ¶æ„çš„ç¨‹åºï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>æœåŠ¡ç«¯</strong>(server)ï¼šDockerå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£å¤„ç†DockeræŒ‡ä»¤ï¼Œç®¡ç†é•œåƒã€å®¹å™¨ç­‰</li><li><strong>å®¢æˆ·ç«¯</strong>(client)ï¼šé€šè¿‡å‘½ä»¤æˆ–RestAPIå‘DockeræœåŠ¡ç«¯å‘é€æŒ‡ä»¤ã€‚å¯ä»¥åœ¨æœ¬åœ°æˆ–è¿œç¨‹å‘æœåŠ¡ç«¯å‘é€æŒ‡ä»¤ã€‚</li></ul><h3 id="å®‰è£…Docketï¼ˆCentOS8ï¼‰"><a href="#å®‰è£…Docketï¼ˆCentOS8ï¼‰" class="headerlink" title="å®‰è£…Docketï¼ˆCentOS8ï¼‰"></a>å®‰è£…Docketï¼ˆCentOS8ï¼‰</h3><p><a href="https://developer.aliyun.com/article/753261">CentOS8 å®‰è£… Docker-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)</a></p><ol><li><p>å¸è½½è€ç‰ˆæœ¬Docket</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum remove docker \<br>                  docker-client \<br>                  docker-client-latest \<br>                  docker-common \<br>                  docker-latest \<br>                  docker-latest-logrotate \<br>                  docker-logrotate \<br>                  docker-engine<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…docketåŸºç¡€åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum install -y yum-utils \<br>  device-mapper-persistent-data \<br>  lvm2<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®å›½å†…ä»“åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum-config-manager \<br>    --add-repo \<br>    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…Docketç¤¾åŒºç‰ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum install --allowerasing docker-ce<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨docket</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs linux">Dockeråº”ç”¨éœ€è¦ç”¨åˆ°å„ç§ç«¯å£ï¼Œé€ä¸€å»ä¿®æ”¹é˜²ç«å¢™è®¾ç½®ã€‚éå¸¸éº»çƒ¦<br>å¯åŠ¨dockerå‰ï¼Œå»ºè®®å…³é—­é˜²ç«å¢™<br># å…³é—­<br>systemctl stop firewalld<br># ç¦æ­¢å¼€æœºå¯åŠ¨é˜²ç«å¢™<br>systemctl disable firewalld<br><br>sudo systemctl start docker  # å¯åŠ¨docker<br>docker run hello-world  #æµ‹è¯•<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®å›½å†…é•œåƒæº</p><p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">å®¹å™¨é•œåƒæœåŠ¡ (aliyun.com)</a></p></li></ol><h3 id="Dockerå‘½ä»¤"><a href="#Dockerå‘½ä»¤" class="headerlink" title="Dockerå‘½ä»¤"></a>Dockerå‘½ä»¤</h3><h4 id="é•œåƒç›¸å…³"><a href="#é•œåƒç›¸å…³" class="headerlink" title="é•œåƒç›¸å…³"></a>é•œåƒç›¸å…³</h4><ul><li><p>æ‹‰å–é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker pull é•œåƒå:ç‰ˆæœ¬<br># æ²¡åŠ ç‰ˆæœ¬é»˜è®¤latest(æœ€è¿‘çš„)<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker images<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡â€“helpæ¥æŸ¥çœ‹æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker save --help<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤é•œåƒ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> rmi é•œåƒå:ç‰ˆæœ¬<br></code></pre></td></tr></table></figure></li><li><p>ä¿å­˜&#x2F;å¯¼å…¥é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs linux"># ä¿å­˜é•œåƒåˆ°tar<br>docker save -o nginx.tar nginx:latest<br># å¯¼å…¥é•œåƒ<br>docker load -i nginx.tar<br></code></pre></td></tr></table></figure></li></ul><h4 id="å®¹å™¨ç›¸å…³"><a href="#å®¹å™¨ç›¸å…³" class="headerlink" title="å®¹å™¨ç›¸å…³"></a>å®¹å™¨ç›¸å…³</h4><ul><li><p>åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run --name ç»™å®¹å™¨èµ·å -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -d nginx<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œ&#x2F;åœæ­¢å®¹å™¨</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">docker <span class="hljs-literal">start</span>/<span class="hljs-literal">stop</span> å®¹å™¨å<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker <span class="hljs-built_in">ps</span><br><br>docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span> <span class="hljs-comment">#æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span><br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> logs å®¹å™¨å<br></code></pre></td></tr></table></figure></li><li><p>è¿›å…¥&#x2F;é€€å‡ºå®¹å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it å®¹å™¨å bash<br><br><span class="hljs-keyword">exit</span> <span class="hljs-comment"># é€€å‡ºå®¹å™¨</span><br></code></pre></td></tr></table></figure><ul><li>docker exec ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤</li><li>-it : ç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€è¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’</li><li>bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbashæ˜¯ä¸€ä¸ªlinuxç»ˆç«¯äº¤äº’å‘½ä»¤</li></ul></li><li><p>åˆ é™¤å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">rm</span> å®¹å™¨å<br></code></pre></td></tr></table></figure></li></ul><h4 id="Dockerfileè‡ªå®šä¹‰é•œåƒ"><a href="#Dockerfileè‡ªå®šä¹‰é•œåƒ" class="headerlink" title="Dockerfileè‡ªå®šä¹‰é•œåƒ"></a>Dockerfileè‡ªå®šä¹‰é•œåƒ</h4><p>é•œåƒç»„æˆç»“æ„</p><p><img src="/img/weifuwu_img/%E9%95%9C%E5%83%8F%E7%BB%84%E6%88%90%E7%BB%93%E6%9E%84.png"></p><p>DockerfileæŒ‡ä»¤æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸ªçš„**æŒ‡ä»¤(Instruction)**ï¼Œç”¨æŒ‡ä»¤æ¥è¯´æ˜è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œæ¥æ„å»ºé•œåƒã€‚æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå½¢æˆä¸€å±‚Layer</p><p>å®˜ç½‘æ–‡æ¡£ <a href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p><p> Dockerfileç¤ºä¾‹</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># æŒ‡å®šåŸºç¡€é•œåƒ</span><br><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">16.04</span><br><span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•</span><br><span class="hljs-keyword">ENV</span> JAVA_DIR=/usr/local<br><br><span class="hljs-comment"># æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./jdk8.tar.gz <span class="hljs-variable">$JAVA_DIR</span>/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /tmp/app.jar</span><br><br><span class="hljs-comment"># å®‰è£…JDK</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JAVA_DIR</span> \</span><br><span class="language-bash"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span><br><span class="language-bash"> &amp;&amp; <span class="hljs-built_in">mv</span> ./jdk1.8.0_144 ./java8</span><br><br><span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="hljs-keyword">ENV</span> JAVA_HOME=$JAVA_DIR/java8<br><span class="hljs-keyword">ENV</span> PATH=$PATH:$JAVA_HOME/bin<br><br><span class="hljs-comment"># æš´éœ²ç«¯å£</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8090</span><br><span class="hljs-comment"># å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> java -jar /tmp/app.jar</span><br></code></pre></td></tr></table></figure><p>æ„å»ºé•œåƒå‘½ä»¤</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">docker build -t é•œåƒåç§°:ç‰ˆæœ¬ .<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®å·"><a href="#æ•°æ®å·" class="headerlink" title="æ•°æ®å·"></a>æ•°æ®å·</h3><blockquote><p><strong>æ•°æ®å·ï¼ˆvolumeï¼‰</strong>æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼ŒæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æŸä¸ªç›®å½•</p><p>åˆ›å»ºçš„æ•°æ®å·ä¼šä¿å­˜åœ¨&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;ç›®å½•ä¸‹</p><p>é€šè¿‡å®¹å™¨å’Œæ•°æ®å·çš„æŒ‚è½½(ç»‘å®š)ï¼Œå°±èƒ½åœ¨å¤–éƒ¨æ“ä½œå®¹å™¨å†…çš„ç›®å½•äº†</p></blockquote><h4 id="æ•°æ®å·åŸºæœ¬å‘½ä»¤"><a href="#æ•°æ®å·åŸºæœ¬å‘½ä»¤" class="headerlink" title="æ•°æ®å·åŸºæœ¬å‘½ä»¤"></a>æ•°æ®å·åŸºæœ¬å‘½ä»¤</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stata">[root@root ~]# docker volume --<span class="hljs-keyword">help</span><br><br>Usage:  docker volume COMMAND<br><br>Manage volumes<br><br>Commands:<br>  create      åˆ›å»ºæ•°æ®å·<br>  <span class="hljs-keyword">inspect</span>     æŸ¥çœ‹ä¸€ä¸ªæ•°æ®å·è¯¦ç»†ä¿¡æ¯<br>  <span class="hljs-keyword">ls</span>          æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·<br>  prune       åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·<br>  <span class="hljs-keyword">rm</span>          - åˆ é™¤æŒ‡å®šæ•°æ®å·<br><br></code></pre></td></tr></table></figure><h4 id="æŒ‚è½½æ•°æ®å·"><a href="#æŒ‚è½½æ•°æ®å·" class="headerlink" title="æŒ‚è½½æ•°æ®å·"></a>æŒ‚è½½æ•°æ®å·</h4><p>ä¾‹å­ï¼š</p><ol><li><p>åˆ›å»ºåˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„HTMLç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run --name mynginx -v html:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -d nginx<br></code></pre></td></tr></table></figure><p><code>-v html:/usr/share/nginx/html</code>: åˆ›å»ºhtmlæ•°æ®å·å¹¶æŠŠå®¹å™¨ä¸­çš„&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlæŒ‚è½½ä¸Š</p></li><li><p>æŸ¥çœ‹htmlæ•°æ®å·ä½ç½®</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker volume inspect html<br><span class="hljs-comment"># è¿›å…¥è¯¥ç›®å½•</span><br>cd <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>volumes<span class="hljs-regexp">/html/</span>_data<br><span class="hljs-comment"># ä¿®æ”¹æ–‡ä»¶</span><br>vi index.html<br></code></pre></td></tr></table></figure></li></ol><h4 id="æŒ‚è½½è‡ªå®šä¹‰çš„æœ¬åœ°ç›®å½•"><a href="#æŒ‚è½½è‡ªå®šä¹‰çš„æœ¬åœ°ç›®å½•" class="headerlink" title="æŒ‚è½½è‡ªå®šä¹‰çš„æœ¬åœ°ç›®å½•"></a>æŒ‚è½½è‡ªå®šä¹‰çš„æœ¬åœ°ç›®å½•</h4><blockquote><p>å®¹å™¨ä¸ä»…ä»…å¯ä»¥æŒ‚è½½æ•°æ®å·ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‚è½½åˆ°å®¿ä¸»æœºç›®å½•ä¸Š</p><ul><li>å¸¦æ•°æ®å·æ¨¡å¼ï¼šå®¿ä¸»æœºç›®å½• â€“&gt; æ•°æ®å· â€”&gt; å®¹å™¨å†…ç›®å½•</li><li>ç›´æ¥æŒ‚è½½æ¨¡å¼ï¼šå®¿ä¸»æœºç›®å½• â€”&gt; å®¹å™¨å†…ç›®å½•</li></ul></blockquote><p>ä¾‹å­: ç»™mysqlæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run \<br>--name mysql \<br>-e MYSQL_ROOT_PASSWORD=<span class="hljs-number">123456</span> \<span class="hljs-comment">#æ•°æ®åº“å¯†ç </span><br>-p <span class="hljs-number">3307</span>:<span class="hljs-number">3306</span> \<span class="hljs-comment">#å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span><br>-v <span class="hljs-regexp">/tmp/my</span>sql<span class="hljs-regexp">/conf/</span>hmy.cnf:<span class="hljs-regexp">/etc/my</span>sql<span class="hljs-regexp">/conf.d/</span>hmy.cnf \<span class="hljs-comment">#å®¿ä¸»æœºæ–‡ä»¶:å®¹å™¨å†…æ–‡ä»¶</span><br>-v <span class="hljs-regexp">/tmp/my</span>sql<span class="hljs-regexp">/data:/</span>var<span class="hljs-regexp">/lib/my</span>sql \<span class="hljs-comment">#å®¿ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•</span><br>-d mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>æ•°æ®å·æŒ‚è½½ä¸ç›®å½•ç›´æ¥æŒ‚è½½çš„</p><ul><li>æ•°æ®å·æŒ‚è½½è€¦åˆåº¦ä½ï¼Œç”±dockeræ¥ç®¡ç†ç›®å½•ï¼Œä½†æ˜¯ç›®å½•è¾ƒæ·±ï¼Œä¸å¥½æ‰¾</li><li>ç›®å½•æŒ‚è½½è€¦åˆåº¦é«˜ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç®¡ç†ç›®å½•ï¼Œä¸è¿‡ç›®å½•å®¹æ˜“å¯»æ‰¾æŸ¥çœ‹</li></ul><h3 id="DockerComposeå®¹å™¨ç¼–æ’"><a href="#DockerComposeå®¹å™¨ç¼–æ’" class="headerlink" title="DockerComposeå®¹å™¨ç¼–æ’"></a>DockerComposeå®¹å™¨ç¼–æ’</h3><blockquote><p>Docker Composeå¯ä»¥åŸºäºComposeæ–‡ä»¶å¸®æˆ‘ä»¬ä¸€é”®éƒ¨ç½²å’Œå¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ä¸€ä¸ªä¸ªåˆ›å»ºå’Œè¿è¡Œå®¹å™¨</p></blockquote><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo curl -L <span class="hljs-string">&quot;https://github.com/docker/compose/releases/download/1.29.0/docker-compose-$(uname -s)-$(uname -m)&quot;</span> -o <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br> <br><span class="hljs-comment">#ä¿®æ”¹æ–‡ä»¶æƒé™</span><br>sudo chmod +x <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br></code></pre></td></tr></table></figure><p>Baseè‡ªåŠ¨è¡¥å…¨å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># è¡¥å…¨å‘½ä»¤</span><br>curl -L https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/docker/</span>compose<span class="hljs-regexp">/1.29.1/</span>contrib<span class="hljs-regexp">/completion/</span>bash<span class="hljs-regexp">/docker-compose &gt; /</span>etc<span class="hljs-regexp">/bash_completion.d/</span>docker-compose<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs linux"># ä»¥éƒ¨ç½²wordpressä¸ºä¾‹<br><br># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾composeæ–‡ä»¶<br>mkdir /home/wordpress<br>cd wordpress<br><br># å°†dockerhubä¸­wordpressçš„composeæ–‡ä»¶å¤åˆ¶è¿›æ¥<br>vim docker-compose.yml<br><br># åˆ›å»ºå¯åŠ¨ï¼ˆåå°ï¼‰<br>docker compose up -d<br><br># æŸ¥çœ‹å¯åŠ¨çš„å®¹å™¨<br>docker compose ps<br><br># åœæ­¢å®¹å™¨<br>docker compose stop<br><br># å¯åŠ¨<br>docker compose start<br><br># åˆ é™¤å®¹å™¨ï¼ˆæ•°æ®å·ä¸ä¼šä¸€èµ·è¢«åˆ ï¼‰<br>docker compose down<br><br># æŸ¥çœ‹æ—¥å¿—<br>docker compose logs -f<br><br></code></pre></td></tr></table></figure><h3 id="Dockerç½‘ç»œå‘½ä»¤"><a href="#Dockerç½‘ç»œå‘½ä»¤" class="headerlink" title="Dockerç½‘ç»œå‘½ä»¤"></a>Dockerç½‘ç»œå‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs linux"># bridgeç½‘ç»œ<br># ä¸æŒ‡å®šç½‘ç»œæ—¶ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨é»˜è®¤å°†è¿æ¥åˆ°bridgeç½‘ç»œä¸Š<br># å®¹å™¨ä¹‹é—´åªèƒ½é€šè¿‡ipé€šè®¯ï¼Œipä¼šéšå¯åŠ¨é¡ºåºè€Œå˜åŒ–ï¼Œå› æ­¤ä¸æ¨è<br><br># æŸ¥çœ‹å®¹å™¨ip<br>docker inspect \<br>--format=&#x27;&#123;&#123;range.NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; å®¹å™¨åå­—<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs linux"># ç”¨æˆ·è‡ªå®šä¹‰ç½‘ç»œ<br># å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡å®¹å™¨åè¿›è¡Œè®¿é—®<br># dockerä¼šé€šè¿‡åµŒå…¥å¼DNSæœåŠ¡å™¨å°†å®¹å™¨åè§£ææˆIP<br><br># åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ<br>docker network create ç½‘ç»œå<br><br># å°†å·²æœ‰å®¹å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œ<br>docker network connect ç½‘ç»œå å®¹å™¨å<br><br># æ–­å¼€å®¹å™¨å’Œç½‘ç»œçš„è¿æ¥<br>docker network disconnect ç½‘ç»œå å®¹å™¨å<br><br># åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šç½‘ç»œï¼ˆmysqlä¸ºä¾‹ï¼‰<br>docker run -it --rm --network ç½‘ç»œå å®¹å™¨å mysql:5.7 mysql -hå®¹å™¨å -uç”¨æˆ·å -på¯†ç <br></code></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>ç›¸å½“äºå¯åŠ¨åº”ç”¨çš„ä¸€ç³»åˆ—æ“ä½œçš„é›†åˆ,æ‰“åŒ…æˆä¸€ä¸ªé•œåƒ</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>u342-jre<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./ruoyi-admin.jar .</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> make .</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;ruoyi-admin.jar&quot;</span>]</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure><ul><li>FROMï¼šåŸºç¡€é•œåƒ</li><li>WORKDIRï¼šç›¸å½“äºcdï¼Œè¿›å…¥å·¥ä½œç›®å½•</li><li>COPYï¼šå°†å®¿ä¸»æœºçš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­</li><li>RUNï¼šæ‰“åŒ…æ—¶æ‰§è¡Œçš„å‘½ä»¤</li><li>CMDï¼šè¿è¡Œé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤</li><li>EXPOSEï¼šç›‘å¬çš„ç«¯å£</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs linux"># æ„å»ºé•œåƒ<br>docker build dockerfileæ‰€åœ¨è·¯å¾„<br><br># æŒ‡å®šé•œåƒåç§°ã€ç‰ˆæœ¬å·<br>docker tag é•œåƒid åç§°:ç‰ˆæœ¬<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Cloud</title>
    <link href="/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/"/>
    <url>/2022/09/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1/SpringCloud/</url>
    
    <content type="html"><![CDATA[<h2 id="Spring-Cloud"><a href="#Spring-Cloud" class="headerlink" title="Spring Cloud"></a>Spring Cloud</h2><h4 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h4><blockquote><p>RestTemplateæ˜¯ä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨HTTPæ¥å£ï¼Œæ”¯æŒGETã€POSTã€PUTã€DELETEç­‰æ–¹æ³•ã€‚</p></blockquote><h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>1.æ³¨å†ŒRestTemplateå®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>2.é€šè¿‡restTemplateå‘é€httpæ¥è¿œç¨‹è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br><span class="hljs-keyword">public</span> Order <span class="hljs-title function_">queryOrderById</span><span class="hljs-params">(Long orderId)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.findById(orderId);<br>    <span class="hljs-comment">// ç”¨restTemplateå‘é€getè¯·æ±‚æŸ¥è¯¢userä¿¡æ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> restTemplate.getForObject(url, User.class);<br>    order.setUser(user);<br>    <span class="hljs-comment">// è¿”å›</span><br>    <span class="hljs-keyword">return</span> order;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Eurekaæ³¨å†Œä¸­å¿ƒ"><a href="#Eurekaæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Eurekaæ³¨å†Œä¸­å¿ƒ"></a>Eurekaæ³¨å†Œä¸­å¿ƒ</h4><blockquote><p>æ³¨å†Œä¸­å¿ƒï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¾€å¾€ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå‘æ³¨å†Œä¸­å¿ƒå»æ³¨å†Œè‡ªå·±çš„åœ°å€åŠç«¯å£ä¿¡æ¯ï¼Œæ³¨å†Œä¸­å¿ƒç»´æŠ¤ç€æœåŠ¡åç§°ä¸æœåŠ¡å®ä¾‹çš„å¯¹åº”å…³ç³»ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šå®šæ—¶ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨ï¼ŒåŒæ—¶æ±‡æŠ¥è‡ªå·±çš„è¿è¡Œæƒ…å†µï¼Œè¿™æ ·å½“æœ‰çš„æœåŠ¡éœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶ï¼Œå°±å¯ä»¥ä»è‡ªå·±è·å–åˆ°çš„æœåŠ¡åˆ—è¡¨ä¸­è·å–å®ä¾‹åœ°å€è¿›è¡Œè°ƒç”¨</p></blockquote><h5 id="Eurekaæ¶æ„ä¸­çš„ä¸‰ä¸ªè§’è‰²"><a href="#Eurekaæ¶æ„ä¸­çš„ä¸‰ä¸ªè§’è‰²" class="headerlink" title="Eurekaæ¶æ„ä¸­çš„ä¸‰ä¸ªè§’è‰²"></a>Eurekaæ¶æ„ä¸­çš„ä¸‰ä¸ªè§’è‰²</h5><ul><li>æœåŠ¡æ³¨å†Œä¸­å¿ƒ</li></ul><p>Eurekaçš„æœåŠ¡ç«¯åº”ç”¨ï¼Œæä¾›æœåŠ¡æ³¨å†Œå’Œå‘ç°åŠŸèƒ½</p><ul><li>æœåŠ¡æä¾›è€…</li></ul><p>æä¾›æœåŠ¡çš„åº”ç”¨ï¼Œå¯ä»¥æ˜¯SpringBootåº”ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒä»»æ„æŠ€æœ¯å®ç°ï¼Œåªè¦å¯¹å¤–æä¾›çš„æ˜¯Resté£æ ¼æœåŠ¡å³å¯ã€‚</p><ul><li>æœåŠ¡æ¶ˆè´¹è€…</li></ul><p>æ¶ˆè´¹åº”ç”¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨ï¼Œä»è€Œå¾—çŸ¥æ¯ä¸ªæœåŠ¡æ–¹çš„ä¿¡æ¯ï¼ŒçŸ¥é“å»å“ªé‡Œè°ƒç”¨æœåŠ¡æ–¹ã€‚</p><h5 id="æ­å»ºEureka"><a href="#æ­å»ºEureka" class="headerlink" title="æ­å»ºEureka"></a>æ­å»ºEureka</h5><h6 id="åˆ›å»ºæœåŠ¡ç«¯"><a href="#åˆ›å»ºæœåŠ¡ç«¯" class="headerlink" title="åˆ›å»ºæœåŠ¡ç«¯"></a>åˆ›å»ºæœåŠ¡ç«¯</h6><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ @EnableEurekaServeræ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaServer</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EurekaApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EurekaApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-server</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment">#æŒ‡å®šä¸»æœºåœ°å€</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æŒ‡å®šæ˜¯å¦è¦ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ï¼ˆæ³¨å†Œä¸­å¿ƒä¸éœ€è¦å¼€å¯ï¼‰</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æŒ‡å®šæ˜¯å¦è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ˆæ³¨å†Œä¸­å¿ƒä¸éœ€è¦å¼€å¯ï¼‰</span><br>  <span class="hljs-attr">server:</span><br>    <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­ä¿æŠ¤æ¨¡å¼</span><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡<code>localhost:8081</code>è®¿é—®æ³¨å†Œä¸­å¿ƒç•Œé¢</p></li></ol><h6 id="åˆ›å»ºå®¢æˆ·ç«¯"><a href="#åˆ›å»ºå®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»ºå®¢æˆ·ç«¯"></a>åˆ›å»ºå®¢æˆ·ç«¯</h6><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨å¯åŠ¨ç±»ä¸ŠåŠ @EnableEurekaClientæ³¨è§£</p></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8082</span> <span class="hljs-comment">#è¿è¡Œç«¯å£å·</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">eureka-client</span> <span class="hljs-comment">#æœåŠ¡åç§°</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æ³¨å†Œåˆ°Eurekaçš„æ³¨å†Œä¸­å¿ƒ</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#è·å–æ³¨å†Œå®ä¾‹åˆ—è¡¨</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8081/eureka/</span> <span class="hljs-comment">#é…ç½®æ³¨å†Œä¸­å¿ƒåœ°å€</span><br></code></pre></td></tr></table></figure></li></ol><h6 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h6><ol><li><p>åœ¨æ³¨å†ŒRestTemplateä¸ŠåŠ ä¸Š@LoadTemplateæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@LoadBalanced</span><br><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è¯·æ±‚çš„urlä¸­ç”¨æœåŠ¡åç§°æ›¿æ¢ip</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br><span class="hljs-keyword">public</span> Order <span class="hljs-title function_">queryOrderById</span><span class="hljs-params">(Long orderId)</span> &#123;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢è®¢å•</span><br>    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.findById(orderId);<br>    <span class="hljs-comment">//ç”¨restTemplateå‘é€httpè¯·æ±‚æŸ¥è¯¢userä¿¡æ¯</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://userservice/user/&quot;</span> + order.getUserId();<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> restTemplate.getForObject(url, User.class);<br>    order.setUser(user);<br>    <span class="hljs-comment">// 4.è¿”å›</span><br>    <span class="hljs-keyword">return</span> order;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span> <span class="hljs-comment">#eurekaå®¢æˆ·ç«¯é…ç½®</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°eurekaæœåŠ¡ç«¯ä¸Šå»</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æ˜¯å¦è·å–eurekaæœåŠ¡ç«¯ä¸Šæ³¨å†Œçš„æœåŠ¡åˆ—è¡¨</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:8001/eureka/</span> <span class="hljs-comment"># æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å¯ç”¨eurekaå®¢æˆ·ç«¯</span><br>    <span class="hljs-attr">registry-fetch-interval-seconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment">#å®šä¹‰å»eurekaæœåŠ¡ç«¯è·å–æœåŠ¡åˆ—è¡¨çš„æ—¶é—´é—´éš”</span><br>  <span class="hljs-attr">instance:</span> <span class="hljs-comment">#eurekaå®¢æˆ·ç«¯å®ä¾‹é…ç½®</span><br>    <span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment">#å®šä¹‰æœåŠ¡å¤šä¹…å»æ³¨å†Œä¸­å¿ƒç»­çº¦</span><br>    <span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">90</span> <span class="hljs-comment">#å®šä¹‰æœåŠ¡å¤šä¹…ä¸å»ç»­çº¦è®¤ä¸ºæœåŠ¡å¤±æ•ˆ</span><br>    <span class="hljs-attr">metadata-map:</span><br>      <span class="hljs-attr">zone:</span> <span class="hljs-string">jiangsu</span> <span class="hljs-comment">#æ‰€åœ¨åŒºåŸŸ</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment">#æœåŠ¡ä¸»æœºåç§°</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ipæ¥ä½œä¸ºä¸»æœºå</span><br>  <span class="hljs-attr">server:</span> <span class="hljs-comment">#eurekaæœåŠ¡ç«¯é…ç½®</span><br>    <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­eurekaæœåŠ¡ç«¯çš„ä¿æŠ¤æœºåˆ¶</span><br></code></pre></td></tr></table></figure><h4 id="Ribbonè´Ÿè½½å‡è¡¡"><a href="#Ribbonè´Ÿè½½å‡è¡¡" class="headerlink" title="Ribbonè´Ÿè½½å‡è¡¡"></a>Ribbonè´Ÿè½½å‡è¡¡</h4><blockquote><p>è´Ÿè½½å‡è¡¡å¯ä»¥å¢åŠ ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ‰©å±•æ€§</p><p>åœ¨æ³¨å…¥RestTemplateæ—¶åŠ ä¸Š@LoadBalancedæ³¨è§£å¼€å¯è´Ÿè½½å‡è¡¡</p></blockquote><p><img src="/img/weifuwu_img/image-20210713224517686.png" alt="image-20210713224517686"></p><p><img src="/img/weifuwu_img/image-20210713224724673.png" alt="image-20210713224724673"></p><p>æµç¨‹</p><ul><li>LoadBalanceInterceptoræ‹¦æˆªå™¨è·å–è¯·æ±‚ï¼ŒRibbonLoadBalancerClientä»urlä¸­è·å–æœåŠ¡åç§°</li><li>DynamicServerListLoadBalanceræ ¹æ®æœåŠ¡åç§°æ‹‰å–eurekaæœåŠ¡åˆ—è¡¨</li><li>IRuleæ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰å–ä¸€ä¸ª</li><li>RibbonLoadBalancerClientå°†urlä¸­çš„æœåŠ¡åç§°æ›¿æ¢ä¸ºipç«¯å£ï¼Œå†å‘èµ·è¯·æ±‚</li></ul><h5 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h5><blockquote><p>ä¸€èˆ¬ä½¿ç”¨é»˜è®¤ç­–ç•¥(ZoneAvoidanceRule)</p></blockquote><p>æ–¹å¼ä¸€(å…¨å±€)</p><ul><li>å¯¼å…¥åæ ‡</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>æ³¨å†ŒIRule</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> IRule <span class="hljs-title function_">randomRule</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomRule</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒ(å±€éƒ¨)</p><ul><li>åœ¨application.ymlä¸­æ·»åŠ é…ç½®</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">userservice:</span>  <span class="hljs-comment">#æŒ‡å®šæœåŠ¡åç§°</span><br>  <span class="hljs-attr">ribbon:</span><br>    <span class="hljs-attr">NFLoadBalancerRuleClassName:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span> <span class="hljs-comment"># è´Ÿè½½å‡è¡¡è§„åˆ™</span><br></code></pre></td></tr></table></figure><h5 id="å¼€å¯é¥¥é¥¿åŠ è½½"><a href="#å¼€å¯é¥¥é¥¿åŠ è½½" class="headerlink" title="å¼€å¯é¥¥é¥¿åŠ è½½"></a>å¼€å¯é¥¥é¥¿åŠ è½½</h5><blockquote><p> Ribboné»˜è®¤æ˜¯é‡‡ç”¨æ‡’åŠ è½½ï¼Œå³ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ä¼šå»åˆ›å»ºLoadBalanceClientï¼Œè¯·æ±‚æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><p>è€Œé¥¥é¥¿åŠ è½½åˆ™ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆ›å»ºï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®çš„è€—æ—¶</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">eager-load:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">clients:</span> <span class="hljs-string">userservice</span><span class="hljs-comment">#åŠ è½½çš„å®¢æˆ·ç«¯</span><br></code></pre></td></tr></table></figure><h5 id="å¸¸ç”¨é…ç½®-1"><a href="#å¸¸ç”¨é…ç½®-1" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h5><blockquote><p>æ­¤ä¸ºå…¨å±€é…ç½®ï¼Œå±€éƒ¨é…ç½®è¦<code>æœåŠ¡å:ribbon</code>ä¸‹é…ç½®</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ribbon:</span><br>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">1000</span> <span class="hljs-comment">#æœåŠ¡è¯·æ±‚è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">3000</span> <span class="hljs-comment">#æœåŠ¡è¯·æ±‚å¤„ç†è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br>  <span class="hljs-attr">OkToRetryOnAllOperations:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¯¹è¶…æ—¶è¯·æ±‚å¯ç”¨é‡è¯•æœºåˆ¶</span><br>  <span class="hljs-attr">MaxAutoRetriesNextServer:</span> <span class="hljs-number">1</span> <span class="hljs-comment">#åˆ‡æ¢é‡è¯•å®ä¾‹çš„æœ€å¤§ä¸ªæ•°</span><br>  <span class="hljs-attr">MaxAutoRetries:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># åˆ‡æ¢å®ä¾‹åé‡è¯•æœ€å¤§æ¬¡æ•°</span><br>  <span class="hljs-attr">NFLoadBalancerRuleClassName:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span> <span class="hljs-comment">#ä¿®æ”¹è´Ÿè½½å‡è¡¡ç®—æ³•</span><br></code></pre></td></tr></table></figure><h4 id="Nacosæ³¨å†Œä¸­å¿ƒ"><a href="#Nacosæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Nacosæ³¨å†Œä¸­å¿ƒ"></a>Nacosæ³¨å†Œä¸­å¿ƒ</h4><h5 id="windowså®‰è£…"><a href="#windowså®‰è£…" class="headerlink" title="windowså®‰è£…"></a>windowså®‰è£…</h5><ul><li><p>ä¸‹è½½   <a href="https://github.com/alibaba/nacos">github</a></p></li><li><p>è§£å‹</p></li><li><p>binç›®å½•ä¸‹è¿è¡Œstartup.cmd</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span> -m standalone<br></code></pre></td></tr></table></figure></li><li><p>é»˜è®¤è´¦å·å¯†ç nacos</p></li><li><p>è®¿é—®<code>http://localhost:8848/nacos</code></p></li></ul><h5 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h5><ul><li><p>çˆ¶å·¥ç¨‹å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--alibabaä¾èµ–ç®¡ç†--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.6.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é¡¹ç›®ä¸­å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--nacosæœåŠ¡å‘ç°--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span> <br>    <span class="hljs-attr">application:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">userservice</span><br>    <span class="hljs-attr">cloud:</span><br>        <span class="hljs-attr">nacos:</span><br>          <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="é…ç½®é›†ç¾¤"><a href="#é…ç½®é›†ç¾¤" class="headerlink" title="é…ç½®é›†ç¾¤"></a>é…ç½®é›†ç¾¤</h5><p><img src="/img/weifuwu_img/image-20210713232522531.png" alt="image-20210713232522531"></p><ul><li><p>ä¿®æ”¹é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">cluster-name:</span> <span class="hljs-string">HZ</span> <span class="hljs-comment"># é›†ç¾¤åç§°</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"><a href="#åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"></a>åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡</h5><blockquote><p>Nacosä¸­æä¾›äº†ä¸€ä¸ª<code>NacosRule</code>çš„å®ç°ï¼Œå¯ä»¥ä¼˜å…ˆä»åŒé›†ç¾¤ä¸­æŒ‘é€‰å®ä¾‹</p></blockquote><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">userservice:</span><span class="hljs-comment">#æœåŠ¡åç§°</span><br>  <span class="hljs-attr">ribbon:</span><br>    <span class="hljs-attr">NFLoadBalancerRuleClassName:</span> <span class="hljs-string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="hljs-comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span><br></code></pre></td></tr></table></figure></li></ul><h5 id="æƒé‡ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"><a href="#æƒé‡ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡" class="headerlink" title="æƒé‡ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"></a>æƒé‡ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡</h5><blockquote><p>æƒé‡è¶Šé«˜ï¼Œä¼˜å…ˆçº§è¶Šé«˜</p></blockquote><p><img src="/img/weifuwu_img/%E6%9D%83%E9%87%8D.png" alt="æƒé‡"></p><ul><li>é€šè¿‡ç¼–è¾‘æ¥è®¾ç½®æƒé‡</li></ul><h5 id="ç»™å¾®æœåŠ¡é…ç½®namespace"><a href="#ç»™å¾®æœåŠ¡é…ç½®namespace" class="headerlink" title="ç»™å¾®æœåŠ¡é…ç½®namespace"></a>ç»™å¾®æœåŠ¡é…ç½®namespace</h5><blockquote><p>åªæœ‰åŒä¸€ä¸ªå‘½åç©ºé—´çš„æœåŠ¡æ‰èƒ½è®¿é—®</p><p>é€šè¿‡namespaceæ¥å®ç°ç¯å¢ƒéš”ç¦»åŠŸèƒ½</p></blockquote><ul><li>é€šè¿‡æ§åˆ¶å°æ¥åˆ›å»ºå‘½åç©ºé—´</li></ul><p><img src="/img/weifuwu_img/%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4.png" alt="å‘½åç©ºé—´"></p><ul><li><p>é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ‰€åœ¨çš„å‘½åç©ºé—´</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">cluster-name:</span> <span class="hljs-string">HZ</span> <span class="hljs-comment"># é›†ç¾¤åç§°</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">c36cee20-482c-4675-a115-5e84b8f53882</span> <span class="hljs-comment">#å‘½åç©ºé—´</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="è®¾ç½®å®ä¾‹ç±»å‹"><a href="#è®¾ç½®å®ä¾‹ç±»å‹" class="headerlink" title="è®¾ç½®å®ä¾‹ç±»å‹"></a>è®¾ç½®å®ä¾‹ç±»å‹</h5><blockquote><p>å®ä¾‹åˆ†ä¸ºä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹</p><p>ä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œé»˜è®¤çš„ç±»å‹</p><p>éä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºï¼Œä¸ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œä¹Ÿå¯ä»¥å«æ°¸ä¹…å®ä¾‹</p></blockquote><p>è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">ephemeral:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span><br></code></pre></td></tr></table></figure><h4 id="Nacoså’ŒEurekaæ¯”è¾ƒ"><a href="#Nacoså’ŒEurekaæ¯”è¾ƒ" class="headerlink" title="Nacoså’ŒEurekaæ¯”è¾ƒ"></a>Nacoså’ŒEurekaæ¯”è¾ƒ</h4><ul><li>Nacosä¸eurekaçš„å…±åŒç‚¹<ul><li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li>Nacosä¸Eurekaçš„åŒºåˆ«<ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>Nacosä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹ä¸ä¼šè¢«å‰”é™¤</li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼(é«˜å¯ç”¨)ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼(å¼ºä¸€è‡´)ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</li></ul></li></ul><h4 id="Nacosé…ç½®ç®¡ç†"><a href="#Nacosé…ç½®ç®¡ç†" class="headerlink" title="Nacosé…ç½®ç®¡ç†"></a>Nacosé…ç½®ç®¡ç†</h4><h5 id="åœ¨nacosä¸­æ·»åŠ é…ç½®"><a href="#åœ¨nacosä¸­æ·»åŠ é…ç½®" class="headerlink" title="åœ¨nacosä¸­æ·»åŠ é…ç½®"></a>åœ¨nacosä¸­æ·»åŠ é…ç½®</h5><blockquote><p>é¡¹ç›®çš„æ ¸å¿ƒé…ç½®ï¼Œéœ€è¦çƒ­æ›´æ–°çš„é…ç½®æ‰æœ‰æ”¾åˆ°nacosç®¡ç†çš„å¿…è¦</p></blockquote><p><img src="/img/weifuwu_img/%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE.png" alt="ç»Ÿä¸€é…ç½®"></p><p><img src="/img/weifuwu_img/%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF.png" alt="é…ç½®ä¿¡æ¯"></p><h5 id="ä»nacosä¸­æ‹‰å–é…ç½®"><a href="#ä»nacosä¸­æ‹‰å–é…ç½®" class="headerlink" title="ä»nacosä¸­æ‹‰å–é…ç½®"></a>ä»nacosä¸­æ‹‰å–é…ç½®</h5><ul><li><p>å¯¼å…¥é…ç½®ç®¡ç†åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ bootstrap.ymlé…ç½®æ–‡ä»¶</p><blockquote><p>bootstrap.ymlä¼šåœ¨application.ymlä¹‹å‰è¢«è¯»å–ï¼Œåœ¨bootstrapä¸­é…ç½®æœåŠ¡åç§°ã€ç¯å¢ƒã€nacosåœ°å€ç­‰ä¿¡æ¯æ¥è¯»å–é…ç½®</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">userservice</span> <span class="hljs-comment"># æœåŠ¡åç§°</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment">#å¼€å‘ç¯å¢ƒï¼Œè¿™é‡Œæ˜¯dev</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <span class="hljs-comment">#Nacosåœ°å€</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <span class="hljs-comment">#Nacosåœ°å€</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <span class="hljs-comment">#è¿™é‡Œæˆ‘ä»¬è·å–çš„yamlæ ¼å¼çš„é…ç½®</span><br></code></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šå®šä½åˆ°userservice-dev.yamlé…ç½®ä¸­</p><p>è®°å¾—æŠŠapplication.ymlä¸­ç›¸åŒçš„é…ç½®æ³¨é‡Šæ‰</p></li><li><p>å¯ä»¥é€šè¿‡@Valueæ³¨è§£æ¥è¯»å–nacosä¸­çš„é…ç½®ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;pattern.dataformat&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String dataformat;<br></code></pre></td></tr></table></figure></li></ul><h5 id="é…ç½®çƒ­æ›´æ–°"><a href="#é…ç½®çƒ­æ›´æ–°" class="headerlink" title="é…ç½®çƒ­æ›´æ–°"></a>é…ç½®çƒ­æ›´æ–°</h5><blockquote><p>nacosä¸­çš„é…ç½®æ”¹å˜åç«‹é©¬æ›´æ–°è€Œä¸éœ€è¦é‡å¯æœåŠ¡</p></blockquote><p>æ–¹å¼ä¸€(é…ç½®å°‘æ—¶)</p><ul><li><p>åœ¨ç±»ä¸ŠåŠ @RefreshScopeæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;pattern.dataformat&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String dataformat;<br><br>    <span class="hljs-meta">@GetMapping(&quot;now&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">now</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dataformat));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>æ–¹å¼äºŒï¼ˆé…ç½®å¤šæ—¶ï¼Œæ¨èï¼‰</p><p>é€šè¿‡@ConfigurationPropertiesæ¥è·å–é…ç½®</p><ul><li><p>åˆ›å»ºé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PatternProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> String dataformat;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ³¨å…¥é…ç½®ç±»æ¥è·å–é…ç½®ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> PatternProperties patternProperties;<br><br><span class="hljs-meta">@GetMapping(&quot;now&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">now</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDataformat()));<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h5 id="é…ç½®å…±äº«"><a href="#é…ç½®å…±äº«" class="headerlink" title="é…ç½®å…±äº«"></a>é…ç½®å…±äº«</h5><blockquote><p> nacosé…ç½®çš„æ–‡ä»¶åæ ¼å¼ä¸º<code>æœåŠ¡å-ç¯å¢ƒ.yaml</code>ï¼Œå¦‚<code>userservice-dev.yaml</code></p><p>å½“æ–‡ä»¶åä¸º<code>æœåŠ¡å.yaml</code>æ—¶ï¼Œå³ä¸ºå…±äº«é…ç½®ï¼Œæ¯ä¸ªç¯å¢ƒçš„éƒ½èƒ½è¯»åˆ°</p></blockquote><p><img src="/img/weifuwu_img/%E5%85%B1%E4%BA%AB%E9%85%8D%E7%BD%AE.png" alt="å…±äº«é…ç½®"></p><p>æœ‰ç›¸åŒé…ç½®æ—¶ï¼Œé…ç½®çš„ä¼˜å…ˆçº§ä¸º: ç¯å¢ƒé…ç½®&gt;å…±äº«é…ç½®&gt;æœ¬åœ°é…ç½®</p><h4 id="Nacosæ­å»ºé›†ç¾¤"><a href="#Nacosæ­å»ºé›†ç¾¤" class="headerlink" title="Nacosæ­å»ºé›†ç¾¤"></a>Nacosæ­å»ºé›†ç¾¤</h4><p>é€šè¿‡nginxåå‘ä»£ç†å¤šä¸ªnacoså®ç°è´Ÿè½½å‡è¡¡</p><p><img src="/img/weifuwu_img/Nacos%E9%9B%86%E7%BE%A4.png" alt="Nacosé›†ç¾¤"></p><p><strong>æ­¥éª¤:</strong></p><ul><li>æ­å»ºæ•°æ®åº“</li><li>é…ç½®nacos</li><li>é…ç½®nginxåå‘ä»£ç†</li></ul><h5 id="é…ç½®nacos"><a href="#é…ç½®nacos" class="headerlink" title="é…ç½®nacos"></a>é…ç½®nacos</h5><ul><li><p>è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶cluster.conf.exampleï¼Œé‡å‘½åä¸ºcluster.conf</p></li><li><p>æ·»åŠ nacosé›†ç¾¤çš„ipå’Œç«¯å£</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:8845</span><br><span class="hljs-number">127.0.0.1:8846</span><br><span class="hljs-number">127.0.0.1:8847</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶application.propertiesï¼Œæ·»åŠ æ•°æ®åº“ä¿¡æ¯</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.datasource.platform</span>=<span class="hljs-string">mysql</span><br><br><span class="hljs-attr">db.num</span>=<span class="hljs-string">1</span><br><br><span class="hljs-attr">db.url.0</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><br><span class="hljs-attr">db.user.0</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">db.password.0</span>=<span class="hljs-string">123</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨application.propertiesä¸­ä¿®æ”¹æ¯ä¸ªnacosçš„ç«¯å£</p></li><li><p>åˆ†åˆ«å¯åŠ¨nacos</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="é…ç½®nginxåå‘ä»£ç†"><a href="#é…ç½®nginxåå‘ä»£ç†" class="headerlink" title="é…ç½®nginxåå‘ä»£ç†"></a>é…ç½®nginxåå‘ä»£ç†</h5><ul><li><p>ä¸‹è½½è§£å‹nginxåˆ°éä¸­æ–‡ç›®å½•ä¸‹</p></li><li><p>ä¿®æ”¹conf&#x2F;nginx.confæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs conf">upstream nacos-cluster &#123;<br>    server 127.0.0.1:8845;#nacosçš„ipå’Œç«¯å£<br>server 127.0.0.1:8846;<br>server 127.0.0.1:8847;<br>&#125;<br><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br><br>    location /nacos &#123;<br>        proxy_pass http://nacos-cluster;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä»£ç ä¸­nacosçš„åœ°å€è¦æ”¹ä¸ºnginxçš„</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:80</span> <span class="hljs-comment"># Nacosåœ°å€</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="ä½¿ç”¨Feignæ›¿ä»£RestTemplate"><a href="#ä½¿ç”¨Feignæ›¿ä»£RestTemplate" class="headerlink" title="ä½¿ç”¨Feignæ›¿ä»£RestTemplate"></a>ä½¿ç”¨Feignæ›¿ä»£RestTemplate</h4><p>RestTemplateå­˜åœ¨çš„é—®é¢˜: éœ€è¦è‡ªå·±æ‹¼æ¥è¯·æ±‚è·¯å¾„ï¼Œå¦‚æœå‚æ•°ä¸€å¤šä¸å¥½ç®¡ç†</p><p>Feignæ˜¯å£°æ˜å¼çš„æœåŠ¡è°ƒç”¨å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒï¼Œå°±å¯ä»¥å®ç°å¯¹æŸä¸ªæœåŠ¡æ¥å£çš„è°ƒç”¨ï¼Œç®€åŒ–äº†ç›´æ¥ä½¿ç”¨RestTemplateæ¥è°ƒç”¨æœåŠ¡æ¥å£çš„å¼€å‘é‡</p><h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableFeignClientsæ³¨è§£å¼€å¯Feignçš„åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™Feignçš„å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(&quot;userservice&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br>    User <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¹‹åå¯ä»¥æ³¨å…¥Feignçš„å®¢æˆ·ç«¯æ¥å‘é€http</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderMapper orderMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserClient userClient;<br><br>    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">queryOrderById</span><span class="hljs-params">(Long orderId)</span> &#123;<br>        <span class="hljs-comment">// æŸ¥è¯¢è®¢å•</span><br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.findById(orderId);<br><br>        <span class="hljs-comment">//ç”¨feignå‘é€httpè¯·æ±‚æŸ¥è¯¢userä¿¡æ¯</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userClient.findById(order.getUserId());<br>        order.setUser(user);<br>        <br>        <span class="hljs-comment">// è¿”å›</span><br>        <span class="hljs-keyword">return</span> order;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="è‡ªå®šä¹‰é…ç½®"><a href="#è‡ªå®šä¹‰é…ç½®" class="headerlink" title="è‡ªå®šä¹‰é…ç½®"></a>è‡ªå®šä¹‰é…ç½®</h5><table><thead><tr><th>ç±»å‹</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>feign.Logger.Level</strong></td><td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td><td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td></tr><tr><td>feign.codec.Decoder</td><td>å“åº”ç»“æœçš„è§£æå™¨</td><td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td></tr><tr><td>feign.codec.Encoder</td><td>è¯·æ±‚å‚æ•°ç¼–ç </td><td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td></tr><tr><td>feign. Contract</td><td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td><td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td></tr><tr><td>feign. Retryer</td><td>å¤±è´¥é‡è¯•æœºåˆ¶</td><td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td></tr></tbody></table><p>é…ç½®æ–¹å¼ï¼š</p><ol><li><p>é…ç½®æ–‡ä»¶æ–¹å¼</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">userservice:</span>  <span class="hljs-comment"># é’ˆå¯¹æŸä¸ªæœåŠ¡, ä¸åŠ é’ˆå¯¹æ‰€æœ‰æœåŠ¡</span><br>        <span class="hljs-attr">loggerLevel:</span> <span class="hljs-string">FULL</span> <span class="hljs-comment"># æ—¥å¿—ç­‰çº§</span><br></code></pre></td></tr></table></figure></li><li><p>ä»£ç æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultFeignConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Logger.Level <span class="hljs-title function_">feignLevel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Logger.Level.BASIC;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ³¨å…¥Beançš„æ–¹å¼æ¥è‡ªå®šä¹‰é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¦‚æœè¦æ‰€æœ‰æœåŠ¡ç”Ÿæ•ˆ,åˆ™åŠ åœ¨@EnableFeignClientä¸Š</span><br><span class="hljs-meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration.class)</span><br><br><span class="hljs-comment">//å¦‚æœåªè¦æŸä¸ªæœåŠ¡ç”Ÿæ•ˆï¼Œåˆ™åŠ åœ¨æŒ‡å®šçš„feignClientä¸Š</span><br><span class="hljs-meta">@FeignClient(value = &quot;userservice&quot;, configuration = DefaultFeignConfiguration.class)</span><br><br></code></pre></td></tr></table></figure></li></ol><h5 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h5><blockquote><p>é™çº§æŒ‡ç³»ç»Ÿå°†æŸäº›ä¸šåŠ¡æˆ–è€…æ¥å£çš„åŠŸèƒ½é™ä½ï¼Œå¯ä»¥æ˜¯åªæä¾›éƒ¨åˆ†åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥æ˜¯å®Œå…¨åœæ‰æ‰€æœ‰åŠŸèƒ½ã€‚<strong>é™çº§çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸¢è½¦ä¿å¸…ï¼Œä¼˜å…ˆä¿è¯æ ¸å¿ƒä¸šåŠ¡</strong></p></blockquote><h5 id="ä¼˜åŒ–æ€§èƒ½"><a href="#ä¼˜åŒ–æ€§èƒ½" class="headerlink" title="ä¼˜åŒ–æ€§èƒ½"></a>ä¼˜åŒ–æ€§èƒ½</h5><p>å¯ä»¥é€šè¿‡ä¸€ä¸‹ä¸¤ç‚¹ä¼˜åŒ–æ€§èƒ½ï¼š</p><ol><li>æ—¥å¿—çº§åˆ«å°½é‡ç”¨basicåŠä»¥ä¸‹</li><li>ä½¿ç”¨HttpClientæˆ–OKHttpä»£æ›¿URLConnection</li></ol><p><strong>æ›¿æ¢è¿æ¥æ± </strong></p><blockquote><p> Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><p>â€¢URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p><p>â€¢Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p><p>â€¢OKHttpï¼šæ”¯æŒè¿æ¥æ± </p><p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚</p></blockquote><ul><li><p>å¯¼å…¥ä¾èµ–åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--httpClientçš„ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®ä½¿ç”¨çš„è¿æ¥æ± </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">userservice:</span>  <span class="hljs-comment"># é’ˆå¯¹æŸä¸ªæœåŠ¡</span><br>        <span class="hljs-attr">loggerLevel:</span> <span class="hljs-string">BASIC</span> <span class="hljs-comment"># æ—¥å¿—ç­‰çº§</span><br>      <span class="hljs-attr">httpclient:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span><br>        <span class="hljs-attr">max-connections:</span> <span class="hljs-number">200</span> <span class="hljs-comment"># æœ€å¤§çš„è¿æ¥æ•°</span><br>        <span class="hljs-attr">max-connections-per-route:</span> <span class="hljs-number">50</span> <span class="hljs-comment"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="æŠ½å–Feignå®¢æˆ·ç«¯"><a href="#æŠ½å–Feignå®¢æˆ·ç«¯" class="headerlink" title="æŠ½å–Feignå®¢æˆ·ç«¯"></a>æŠ½å–Feignå®¢æˆ·ç«¯</h5><blockquote><p>å°†Feignçš„ClientæŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠæ¥å£æœ‰å…³çš„POJOã€é»˜è®¤çš„Feigné…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨</p><p>é™ä½ä»£ç å†—ä½™</p></blockquote><p><img src="/img/weifuwu_img/feign%E6%8A%BD%E5%8F%96.png" alt="feignæŠ½å–"></p><ul><li><p>åˆ›å»ºæ–°æ¨¡å—feign-api</p></li><li><p>å°†FeignClientåŠfeigné…ç½®ç±»ã€å®ä½“ç±»ç§»åˆ°feign-apiä¸­</p><p><img src="/img/weifuwu_img/feignApi.png" alt="feignApi"></p></li><li><p>åœ¨éœ€è¦feignçš„ç±»ä¸­å¯¼å…¥feign-apiæ¨¡å—</p><p><img src="/img/weifuwu_img/%E5%AF%BC%E5%85%A5feignApi.png" alt="å¯¼å…¥feignApi"></p></li><li><p>åœ¨@EnableFeignClientsæ³¨è§£ä¸­è¯´æ˜feignæ‰€åœ¨çš„åŒ…æˆ–ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span><br><br><span class="hljs-comment">//æˆ–è€…</span><br><br><span class="hljs-meta">@EnableFeignClients(basePackages = &quot;cn.itcast.feign.clients&quot;)</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="å¸¸ç”¨é…ç½®-2"><a href="#å¸¸ç”¨é…ç½®-2" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">hystrix:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#åœ¨Feignä¸­å¼€å¯Hystrix</span><br>  <span class="hljs-attr">compression:</span><br>    <span class="hljs-attr">request:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¯¹è¯·æ±‚è¿›è¡ŒGZIPå‹ç¼©</span><br>      <span class="hljs-attr">mime-types:</span> <span class="hljs-string">text/xml,application/xml,application/json</span> <span class="hljs-comment">#æŒ‡å®šå‹ç¼©çš„è¯·æ±‚æ•°æ®ç±»å‹</span><br>      <span class="hljs-attr">min-request-size:</span> <span class="hljs-number">2048</span> <span class="hljs-comment">#è¶…è¿‡è¯¥å¤§å°çš„è¯·æ±‚ä¼šè¢«å‹ç¼©</span><br>    <span class="hljs-attr">response:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¯¹å“åº”è¿›è¡ŒGZIPå‹ç¼©</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span> <span class="hljs-comment">#ä¿®æ”¹æ—¥å¿—çº§åˆ«</span><br>    <span class="hljs-attr">com.macro.cloud.service.UserService:</span> <span class="hljs-string">debug</span><br></code></pre></td></tr></table></figure><h4 id="Gatewayç½‘å…³"><a href="#Gatewayç½‘å…³" class="headerlink" title="Gatewayç½‘å…³"></a>Gatewayç½‘å…³</h4><blockquote><p>SpringCloudGatewayæ˜¯åŸºäºSpring5ä¸­æä¾›çš„WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½</p></blockquote><p>ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>: </li><li><strong>æƒé™æ§åˆ¶</strong>:ç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</li><li><strong>é™æµ</strong>: å½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§</li><li><strong>Predicateï¼ˆæ–­è¨€ï¼‰</strong>ï¼šæŒ‡çš„æ˜¯Java 8 çš„ Function Predicateã€‚ è¾“å…¥ç±»å‹æ˜¯Springæ¡†æ¶ä¸­çš„ServerWebExchangeã€‚ è¿™ä½¿å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ã€‚å¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…ï¼Œåˆ™è¿›è¡Œè·¯ç”±ï¼›</li><li><strong>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰</strong>ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</li></ul><h5 id="åˆ›å»ºGatewayæœåŠ¡"><a href="#åˆ›å»ºGatewayæœåŠ¡" class="headerlink" title="åˆ›å»ºGatewayæœåŠ¡"></a>åˆ›å»ºGatewayæœåŠ¡</h5><ul><li><p>åˆ›å»ºgatewayæ¨¡å—</p><p><img src="/img/weifuwu_img/gateway%E6%A8%A1%E5%9D%97.png" alt="gatewayæ¨¡å—"></p></li><li><p>å¯¼å…¥ä¾èµ–åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--gatewayç½‘å…³--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™è·¯ç”±é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">10010</span> <span class="hljs-comment">#ç½‘å…³åœ°å€</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway</span> <span class="hljs-comment">#æœåŠ¡å</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span> <span class="hljs-comment">#nacosåœ°å€</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span> <span class="hljs-comment">#è·¯ç”±é…ç½®</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://userservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€ï¼ŒæœåŠ¡æ³¨å†Œçš„åå­—(lb: loadBalance)</span><br>          <span class="hljs-attr">predicates:</span>  <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">order-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://orderservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€(lb: loadBalance)</span><br>          <span class="hljs-attr">predicates:</span> <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span><br><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡ç½‘å…³åœ°å€è®¿é—®æœåŠ¡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">10010</span><span class="hljs-regexp">/user/</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="æ–­è¨€å·¥å‚"><a href="#æ–­è¨€å·¥å‚" class="headerlink" title="æ–­è¨€å·¥å‚"></a>æ–­è¨€å·¥å‚</h5><p><a href="https://docs.gitcode.net/spring/guide/spring-cloud/spring-cloud-gateway.html#_5-%E8%B7%AF%E7%BA%BF%E8%B0%93%E8%AF%8D%E5%B7%A5%E5%8E%82">Spring Cloud ç½‘å…³ | ä¸­æ–‡æ–‡æ¡£ (gitcode.net)</a></p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>-  After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver],  2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie&#x3D;chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header&#x3D;X-Request-Id, \d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>-  Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method&#x3D;GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query&#x3D;name, Jackæˆ–è€…-  Query&#x3D;name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td><td></td></tr></tbody></table><p>é€šè¿‡<code>predicates:</code>ååŠ æ–­è¨€æ¥è®¾ç½®è®¿é—®æ¡ä»¶</p><h5 id="è¿‡æ»¤å™¨å·¥å‚"><a href="#è¿‡æ»¤å™¨å·¥å‚" class="headerlink" title="è¿‡æ»¤å™¨å·¥å‚"></a>è¿‡æ»¤å™¨å·¥å‚</h5><blockquote><p>å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç† Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚</p></blockquote><p><a href="https://docs.gitcode.net/spring/guide/spring-cloud/spring-cloud-gateway.html#_6-gatewayfilter%E5%B7%A5%E5%8E%82">Spring Cloud ç½‘å…³ | ä¸­æ–‡æ–‡æ¡£ (gitcode.net)</a></p><ul><li><p><strong>æ·»åŠ è¿‡æ»¤å™¨(é’ˆå¯¹æŸä¸ªæœåŠ¡)</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">gateway:</span><br>  <span class="hljs-attr">routes:</span> <span class="hljs-comment">#è·¯ç”±é…ç½®</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://userservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€(lb: loadBalance)</span><br>      <span class="hljs-attr">predicates:</span>  <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>      <span class="hljs-attr">filters:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=Truth,</span> <span class="hljs-string">aaa</span> <span class="hljs-comment"># æ·»åŠ è¯·æ±‚å¤´</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">order-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://orderservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€(lb: loadBalance)</span><br>      <span class="hljs-attr">predicates:</span> <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ é»˜è®¤è¿‡æ»¤å™¨(å¯¹æ‰€æœ‰æœåŠ¡éƒ½æœ‰æ•ˆ)</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span> <span class="hljs-comment">#è·¯ç”±é…ç½®</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://userservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€(lb: loadBalance)</span><br>          <span class="hljs-attr">predicates:</span>  <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=Truth,</span> <span class="hljs-string">Itcast</span> <span class="hljs-string">is</span> <span class="hljs-string">freaking</span> <span class="hljs-string">awesome!</span> <span class="hljs-comment"># æ·»åŠ è¯·æ±‚å¤´</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">order-service</span>  <span class="hljs-comment">#è·¯ç”±id</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://orderservice</span> <span class="hljs-comment">#è·¯ç”±ç›®æ ‡åœ°å€(lb: loadBalance)</span><br>          <span class="hljs-attr">predicates:</span> <span class="hljs-comment">#æ–­è¨€ï¼Œæ ¹æ®è¿™äº›è·¯å¾„æ¥åŒ¹é…</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span><br>      <span class="hljs-attr">default-filters:</span> <span class="hljs-comment"># é»˜è®¤è¿‡æ»¤é¡¹</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=Truth,</span> <span class="hljs-string">aaa</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h5><blockquote><p>è¿‡æ»¤å™¨å·¥å‚æä¾›çš„è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥é€šè¿‡å…¨å±€è¿‡æ»¤å™¨æ¥<strong>è‡ªå®šä¹‰</strong>è¿‡æ»¤é€»è¾‘</p></blockquote><p><strong>å®šä¹‰æ–¹å¼</strong></p><ul><li><p>å®ç°GlobalFilteræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Order(-1)</span>      <span class="hljs-comment">//è¿‡æ»¤å™¨ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorizeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exchange ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> chain è¿‡æ»¤é“¾</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;<br>        <span class="hljs-comment">//è·å–è¯·æ±‚å‚æ•°æ˜ å°„</span><br>        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();<br>        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();<br>        <span class="hljs-comment">//è·å–å…¶ä¸­çš„authorizeå‚æ•°</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> queryParams.getFirst(<span class="hljs-string">&quot;authorize&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;admin&quot;</span>.equals(auth)) &#123;<br>            <span class="hljs-comment">//æ”¾è¡Œ</span><br>            <span class="hljs-keyword">return</span> chain.filter(exchange);<br>        &#125;<br>        <span class="hljs-comment">//æ‹¦æˆª</span><br>        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);  <span class="hljs-comment">//è®¾ç½®401çŠ¶æ€ç </span><br>        <span class="hljs-keyword">return</span> exchange.getResponse().setComplete();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p><strong>è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</strong>ï¼š</p><ul><li>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§<strong>å£°æ˜é¡ºåº</strong>ä»1é€’å¢</li><li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li></ul><h5 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h5><blockquote><p><strong>æµè§ˆå™¨</strong>ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸ<strong>ajax</strong>è¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p></blockquote><p><strong>è§£å†³è·¨åŸŸé—®é¢˜</strong></p><p>åœ¨gatewayæœåŠ¡çš„application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">spring:<br>  cloud:<br>    gateway:<br>      # ã€‚ã€‚ã€‚<br>      globalcors: # å…¨å±€çš„è·¨åŸŸå¤„ç†<br>        add-to-simple-url-handler-mapping: true # è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜<br>        corsConfigurations:<br>          &#x27;<span class="hljs-string">[/**]</span>&#x27;:<br>            allowedOrigins: # å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ <br>              - <span class="hljs-string">&quot;http://localhost:8090&quot;</span><br>            allowedMethods: # å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼<br>              - <span class="hljs-string">&quot;<span class="hljs-keyword">GET</span>&quot;</span><br>              - <span class="hljs-string">&quot;<span class="hljs-keyword">POST</span>&quot;</span><br>              - <span class="hljs-string">&quot;<span class="hljs-keyword">DELETE</span>&quot;</span><br>              - <span class="hljs-string">&quot;<span class="hljs-keyword">PUT</span>&quot;</span><br>              - <span class="hljs-string">&quot;<span class="hljs-keyword">OPTIONS</span>&quot;</span><br>            allowedHeaders: <span class="hljs-string">&quot;*&quot;</span> # å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯<br>            allowCredentials: true # æ˜¯å¦å…è®¸æºå¸¦cookie<br>            maxAge: <span class="hljs-number">360000</span> # è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼æ€»ç»“</title>
    <link href="/2022/09/02/%E8%BD%AF%E8%80%83/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/09/02/%E8%BD%AF%E8%80%83/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¾è®¡æ¨¡å¼æ€»ç»“"><a href="#è®¾è®¡æ¨¡å¼æ€»ç»“" class="headerlink" title="è®¾è®¡æ¨¡å¼æ€»ç»“"></a>è®¾è®¡æ¨¡å¼æ€»ç»“</h2><blockquote><p>è½¯ä»¶å¼€å‘çš„ æ€»ä½“æŒ‡å¯¼æ€è·¯æˆ–å‚ç…§æ ·æ¿</p><p>ä»æœ¬è´¨ä¸Šéƒ½æ˜¯ç®€åŒ–å’Œåˆ†è§£ç±»æˆ–å¯¹è±¡</p></blockquote><p><img src="/img/post_img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%88%86%E7%B1%BB.png"></p><h4 id="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼-5"><a href="#åˆ›å»ºå‹è®¾è®¡æ¨¡å¼-5" class="headerlink" title="åˆ›å»ºå‹è®¾è®¡æ¨¡å¼(5)"></a>åˆ›å»ºå‹è®¾è®¡æ¨¡å¼(5)</h4><h5 id="1-å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰"><a href="#1-å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰" class="headerlink" title="1.å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰"></a>1.å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰</h5><blockquote><p>ç¡®ä¿æŸä¸€ä¸ªç±»<strong>åªæœ‰ä¸€ä¸ª</strong>å®ä¾‹ï¼Œè€Œä¸”è‡ªå·±å®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å½“ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹è€Œä¸”å®¢æˆ·å¯ä»¥ä»ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„è®¿é—®ç‚¹è®¿é—®å®ƒæ—¶ã€‚</li><li>å½“è¿™ä¸ªå”¯ä¸€å®ä¾‹åº”è¯¥æ˜¯é€šè¿‡å­ç±»åŒ–å¯æ‰©å±•çš„ï¼Œå¹¶ä¸”å®¢æˆ·æ— é¡»æ›´æ”¹ä»£ç å°±èƒ½ä½¿ç”¨ä¸€ä¸ªæ‰©å±•çš„å®ä¾‹æ—¶ã€‚</li></ul><p>ä»£ç ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">singleton</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br><br>    <span class="hljs-comment">// é™åˆ¶äº§ç”Ÿå¤šä¸ªå¯¹è±¡ï¼Œå¦‚æœè¯¥ç±»æ˜¯æŠ½è±¡ç±»ï¼Œè¯¥æ–¹æ³•å¯ä»¥çœç•¥</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–å®ä¾‹å¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> singleton;<br>    &#125;<br><br>    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•ï¼Œå°½é‡æ˜¯staticæ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomgting</span><span class="hljs-params">()</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-åŸå‹æ¨¡å¼-Prototype"><a href="#2-åŸå‹æ¨¡å¼-Prototype" class="headerlink" title="2.åŸå‹æ¨¡å¼(Prototype)"></a>2.åŸå‹æ¨¡å¼(Prototype)</h5><blockquote><p>å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¯¹å…¶è¿›è¡Œå¤åˆ¶è€Œå…‹éš†å‡ºå¤šä¸ªå’ŒåŸå‹ç±»ä¼¼çš„æ–°å®ä¾‹,è€Œä¸æ˜¯é€šè¿‡new</p></blockquote><p><img src="/img/post_img/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>èµ„æºä¼˜åŒ–åœºæ™¯ï¼šç±»åˆå§‹åŒ–éœ€è¦æ¶ˆåŒ–éå¸¸å¤šçš„èµ„æºï¼Œè¿™ä¸ªèµ„æºåŒ…æ‹¬æ•°æ®ã€ç¡¬ä»¶èµ„æºç­‰</li><li>é€šè¿‡newäº§ç”Ÿä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è®¿é—®æƒé™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼</li><li>ä¸€ä¸ªå¯¹è±¡å¤šä¸ªä¿®æ”¹è€…çš„åœºæ™¯ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½éƒ½éœ€è¦ä¿®æ”¹å…¶å€¼æ—¶ï¼Œå¯ä»¥ç”¨åŸå‹æ¨¡å¼æ‹·è´å¤šä¸ªå¯¹è±¡ä¾›è°ƒç”¨è€…ä½¿ç”¨</li></ul><h5 id="3-å·¥å‚æ–¹æ³•æ¨¡å¼-Factory-Method"><a href="#3-å·¥å‚æ–¹æ³•æ¨¡å¼-Factory-Method" class="headerlink" title="3.å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method)"></a>3.å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method)</h5><blockquote><p>å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»</p><p>å¤šä¸ªå·¥å‚å®ç°äº†å·¥å‚æ¥å£ï¼Œæ¯ä¸ªå·¥å‚ç”Ÿäº§çš„ç±»ä¸åŒ</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å½“ä¸€ä¸ªç±»å¸Œæœ›ç”±å®ƒçš„å­ç±»æ¥æŒ‡å®šå®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡çš„æ—¶å€™</li></ul><h5 id="4-æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstractFactoryï¼‰"><a href="#4-æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstractFactoryï¼‰" class="headerlink" title="4.æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstractFactoryï¼‰"></a>4.æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstractFactoryï¼‰</h5><blockquote><p>æä¾›ä¸€ä¸ªåˆ›å»º<strong>ä¸€ç³»åˆ—</strong>ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œ<strong>æ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»</strong>ã€‚</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å½“è¦å¼ºè°ƒä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡çš„è®¾è®¡ä»¥ä¾¿è¿›è¡Œè”åˆä½¿ç”¨æ—¶</li><li>ä¸€ä¸ªç³»ç»Ÿè¦ç”±å¤šä¸ªäº§å“ç³»åˆ—ä¸­çš„ä¸€ä¸ªæ¥é…ç½®æ—¶</li></ul><h5 id="5-ç”Ÿæˆå™¨æ¨¡å¼-x2F-å»ºé€ è€…æ¨¡å¼-Builder"><a href="#5-ç”Ÿæˆå™¨æ¨¡å¼-x2F-å»ºé€ è€…æ¨¡å¼-Builder" class="headerlink" title="5.ç”Ÿæˆå™¨æ¨¡å¼&#x2F;å»ºé€ è€…æ¨¡å¼(Builder)"></a>5.ç”Ÿæˆå™¨æ¨¡å¼&#x2F;å»ºé€ è€…æ¨¡å¼(Builder)</h5><blockquote><p>å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡åˆ†è§£æˆå¤šä¸ªç›¸å¯¹ç®€å•çš„éƒ¨åˆ†ï¼Œç„¶åæ ¹æ®ä¸åŒéœ€è¦åˆ†åˆ«åˆ›å»ºå®ƒä»¬ï¼Œæœ€åæ„å»ºæˆè¯¥<strong>å¤æ‚å¯¹è±¡</strong></p></blockquote><p><img src="/img/post_img/%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡<strong>æœ‰ä¸åŒçš„è¡¨ç¤º</strong>æ—¶</li><li>å¤šä¸ªéƒ¨ä»¶æˆ–é›¶ä»¶ï¼Œéƒ½å¯ä»¥è£…é…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œä½†æ˜¯äº§ç”Ÿçš„è¿è¡Œç»“æœåˆä¸ç›¸åŒæ—¶</li></ul><p>â€‹    </p><h4 id="ç»“æ„å‹è®¾è®¡æ¨¡å¼-7"><a href="#ç»“æ„å‹è®¾è®¡æ¨¡å¼-7" class="headerlink" title="ç»“æ„å‹è®¾è®¡æ¨¡å¼(7)"></a>ç»“æ„å‹è®¾è®¡æ¨¡å¼(7)</h4><h5 id="1-ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰"><a href="#1-ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰" class="headerlink" title="1.ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰"></a>1.ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰</h5><blockquote><p>ä¸ºæŸå¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®</p><p>é™åˆ¶ã€å¢å¼ºæˆ–ä¿®æ”¹è¯¥å¯¹è±¡çš„ä¸€äº›ç‰¹æ€§</p></blockquote><p><img src="/img/post_img/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å°†ä¸€ä¸ªå¯¹è±¡åŠ ä»¥åŒ…è£…ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</li><li>åœ¨éœ€è¦æ¯”è¾ƒé€šç”¨å’Œå¤æ‚çš„å¯¹è±¡æŒ‡é’ˆä»£æ›¿ç®€å•çš„æŒ‡é’ˆæ—¶</li><li>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</li></ul><h5 id="2-é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰"><a href="#2-é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰" class="headerlink" title="2.é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰"></a>2.é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰</h5><blockquote><p>å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚Adapteræ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ</p></blockquote><p><img src="/img/post_img/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å°†ä¸€ä¸ªå¯¹è±¡åŠ ä»¥åŒ…è£…ä»¥ç»™å®¢æˆ·æä¾›å…¶å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£</li><li>æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå…¶æ¥å£ä¸ç¬¦åˆè¦æ±‚</li><li>ä½¿æ‰€æœ‰æ¥å£ä¸å…¼å®¹ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ</li></ul><h5 id="3-æ¡¥æ¥æ¨¡å¼-Bridge"><a href="#3-æ¡¥æ¥æ¨¡å¼-Bridge" class="headerlink" title="3.æ¡¥æ¥æ¨¡å¼(Bridge)"></a>3.æ¡¥æ¥æ¨¡å¼(Bridge)</h5><blockquote><p>å°†æŠ½è±¡éƒ¨åˆ†ä¸å…¶å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ç±»çš„æŠ½è±¡å’Œå…¶å®ç°ä¹‹é—´ä¸å¸Œæœ›æœ‰ä¸€ä¸ªå›ºå®šçš„ç»‘å®šå…³ç³»</li><li>æ¥å£æˆ–æŠ½è±¡ç±»ä¸ç¨³å®š</li></ul><h5 id="4-è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰"><a href="#4-è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰" class="headerlink" title="4.è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰"></a>4.è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰</h5><blockquote><p>åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡<strong>æ·»åŠ </strong>ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½è€Œè¨€ï¼ŒDecoratoræ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´åŠ çµæ´»</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å°†ä¸€ä¸ªå¯¹è±¡åŠ ä»¥åŒ…è£…ä»¥æä¾›ä¸€äº›é¢å¤–çš„è¡Œä¸º</li><li>åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£</li></ul><h5 id="5-å¤–è§‚-x2F-é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰"><a href="#5-å¤–è§‚-x2F-é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰" class="headerlink" title="5.å¤–è§‚&#x2F;é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰"></a>5.å¤–è§‚&#x2F;é—¨é¢æ¨¡å¼ï¼ˆFacadeï¼‰</h5><blockquote><p>ä¸ºç³»ç»Ÿä¸­å¤šä¸ªå­ç³»ç»Ÿæä¾›ä¸€è‡´çš„å¯¹å¤–è°ƒç”¨ï¼Œ å¯¹å®¢æˆ·ç«¯éšè—å­ç³»ç»Ÿç»†èŠ‚ï¼Œ é™ä½å…¶ä¸å­ç³»ç»Ÿçš„è€¦åˆ</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å°†<strong>ä¸€ç³»åˆ—å¯¹è±¡</strong>åŠ ä»¥åŒ…è£…ä»¥<strong>ç®€åŒ–å…¶æ¥å£</strong></li><li>éœ€è¦ä¸ºä¸€ä¸ªå¤æ‚å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•æ¥å£</li></ul><h5 id="6-äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰"><a href="#6-äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰" class="headerlink" title="6.äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰"></a>6.äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰</h5><blockquote><p>è¿ç”¨å…±äº¨æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡</p><p>æ˜¯æ± æŠ€æœ¯çš„é‡è¦å®ç°æ–¹å¼</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸ä¼¼å¯¹è±¡ </li><li>å®Œå…¨ç”±äºä½¿ç”¨å¤§é‡çš„å¯¹è±¡ï¼Œé€ æˆå¾ˆå¤§çš„å­˜å‚¨å¼€é”€</li><li>éœ€è¦<strong>ç¼“å†²æ± </strong>çš„åœºæ™¯</li><li>è¿›è¡Œå¯¹è±¡å…±äº«,ä»¥å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œè¾¾åˆ°è¾ƒå°‘çš„å†…å­˜å ç”¨å¹¶æå‡æ€§èƒ½</li></ul><h5 id="7-ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰"><a href="#7-ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰" class="headerlink" title="7.ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰"></a>7.ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰</h5><blockquote><p>å°†å¯¹è±¡ç»„åˆæˆæ ‘å‹ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„</li><li>å°†å¤šä¸ªå¯¹è±¡ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œæ“ä½œï¼Œå¸¸ç”¨äºè¡¨ç¤ºæ ‘å½¢ç»“æ„ä¸­ï¼Œ<strong>ä¾‹å¦‚äºŒå‰æ ‘</strong></li></ul><h4 id="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼-11"><a href="#è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼-11" class="headerlink" title="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼(11)"></a>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼(11)</h4><h5 id="1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate-Methodï¼‰"><a href="#1-æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate-Methodï¼‰" class="headerlink" title="1.æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰"></a>1.æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰</h5><blockquote><p>å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤æ”¾åˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤</p></blockquote><p><img src="/img/post_img/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°</li><li>å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ï¼Œä»¥é¿å…ä»£ç é‡å¤</li></ul><h5 id="2-ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰"><a href="#2-ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰" class="headerlink" title="2.ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰"></a>2.ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰</h5><blockquote><p>å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢</p><p>æä¾›ä¸åŒçš„ç®—æ³•ç­–ç•¥</p></blockquote><p><img src="/img/post_img/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>éœ€è¦ä½¿ç”¨ä¸€ä¸ªç®—æ³•åœ°ä¸åŒå˜ä½“</li><li>è®¸å¤šç›¸å…³çš„ç±»ä»…ä»…æ˜¯è¡Œä¸ºæœ‰å¼‚</li><li>ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸º,å¹¶ä¸”è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªæ¡ä»¶è¯­å¥çš„å½¢å¼å‡ºç°ï¼Œå°†ç›¸å…³çš„æ¡ä»¶åˆ†æ”¯ç§»å…¥å®ƒä»¬å„è‡ªçš„Strategyç±»ä¸­ï¼Œä»¥ä»£æ›¿è¿™äº›æ¡ä»¶è¯­å¥</li></ul><h5 id="3-å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰"><a href="#3-å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰" class="headerlink" title="3.å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰"></a>3.å‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰</h5><blockquote><p>å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿å¾—å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–;å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œ</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>æŠ½è±¡å‡ºæ‰§è¡Œçš„åŠ¨ä½œä»¥å‚æ•°åŒ–æŸå¯¹è±¡</li><li>å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ä»è€Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–</li><li>åœ¨ä¸åŒçš„æ—¶åˆ»æŒ‡å®šã€æ’åˆ—å’Œæ‰§è¡Œè¯·æ±‚</li></ul><h5 id="4-èŒè´£é“¾æ¨¡å¼ï¼ˆChain-of-Responsibilityï¼‰"><a href="#4-èŒè´£é“¾æ¨¡å¼ï¼ˆChain-of-Responsibilityï¼‰" class="headerlink" title="4.èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰"></a>4.èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰</h5><blockquote><p>æŠŠè¯·æ±‚ä»é“¾ä¸­çš„ä¸€ä¸ªå¯¹è±¡ä¼ åˆ°ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œç›´åˆ°è¯·æ±‚è¢«å“åº”ä¸ºæ­¢</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šç”±å“ªä¸ªå¯¹è±¡å¤„ç†</li><li>æƒ³åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹å‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚</li><li>ä¸€ä¸ªå®¢æˆ·éœ€è¦ä½¿ç”¨ä¸€ç»„ç›¸å…³å¯¹è±¡</li></ul><h5 id="5-çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰"><a href="#5-çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰" class="headerlink" title="5.çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰"></a>5.çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰</h5><blockquote><p>å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚å¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†å®ƒçš„ç±»</p></blockquote><p><img src="/img/post_img/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå†³å®šäºå…¶çŠ¶æ€ä¸”å¿…é¡»åœ¨è¿è¡Œæ—¶åˆ»æ ¹æ®çŠ¶æ€æ”¹å˜è¡Œä¸º</li><li>ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸º</li></ul><h5 id="6-è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰"><a href="#6-è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰" class="headerlink" title="6.è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰"></a>6.è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰</h5><blockquote><p>å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°</p></blockquote><p><img src="/img/post_img/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å½“ä¸€ä¸ªå¯¹è±¡å¿…é¡»é€šçŸ¥å…¶å®ƒå¯¹è±¡ï¼Œè€Œå®ƒåˆä¸èƒ½å‡å®šå…¶å®ƒå¯¹è±¡æ˜¯è°æ—¶</li><li>å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶æ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°</li><li>åœ¨å‘å¸ƒ-è®¢é˜…(Publish-Subscribeï¼‰æ¶ˆæ¯æ¨¡å‹ä¸­ï¼Œè®¢é˜…è€…è®¢é˜…ä¸€ä¸ªä¸»é¢˜åï¼Œå½“è¯¥ä¸»é¢˜æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥</li></ul><h5 id="7-ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰"><a href="#7-ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰" class="headerlink" title="7.ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰"></a>7.ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediatorï¼‰</h5><blockquote><p>ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’, ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’</p></blockquote><p><img src="/img/post_img/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F.png"></p><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ä¸€ç»„å¯¹è±¡ä»¥å®šä¹‰è‰¯å¥½ä½†æ˜¯å¤æ‚çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œäº§ç”Ÿçš„ç›¸äº’ä¾èµ–å…³ç³»ç»“æ„æ··ä¹±ä¸”éš¾ä»¥ç†è§£</li><li>å‡å°‘å¤šä¸ªå¯¹è±¡æˆ–ç±»ä¹‹é—´çš„é€šä¿¡å¤æ‚æ€§</li></ul><h5 id="8-è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰"><a href="#8-è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰" class="headerlink" title="8.è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰"></a>8.è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰</h5><blockquote><p>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œä¸”ä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— é¡»æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º</li></ul><h5 id="9-è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰"><a href="#9-è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰" class="headerlink" title="9.è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰"></a>9.è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰</h5><blockquote><p>åˆ†ç¦»å¯¹è±¡æ•°æ®ç»“æ„ä¸è¡Œä¸ºçš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ç§åˆ†ç¦»ï¼Œå¯è¾¾åˆ°ä¸ºä¸€ä¸ªè¢«è®¿é—®è€…åŠ¨æ€æ·»åŠ æ–°çš„æ“ä½œè€Œæ— éœ€åšå…¶å®ƒçš„ä¿®æ”¹çš„æ•ˆæœ</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>å®šä¹‰å¯¹è±¡ç»“æ„çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œ</li><li>éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œ</li></ul><h5 id="10-å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰"><a href="#10-å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰" class="headerlink" title="10.å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰"></a><strong>10.å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰</strong></h5><blockquote><p>åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹æ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·ä»¥åå°±å¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„ï¼ˆéƒ¨åˆ†ï¼‰çŠ¶æ€ï¼Œè¿™æ ·ä»¥åéœ€è¦æ—¶å®ƒæ‰èƒ½æ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€</li></ul><h5 id="11-è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰"><a href="#11-è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰" class="headerlink" title="11.è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰"></a>11.è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreterï¼‰</h5><blockquote><p>ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­</p></blockquote><p><strong>é€‚ç”¨æ€§</strong></p><ul><li>æœ‰ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”å¯å°†å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘</li><li>å¦‚å››åˆ™è¿ç®—ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰</li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€‰æ‹©é¢˜è€ƒç‚¹</title>
    <link href="/2022/08/29/%E8%BD%AF%E8%80%83/%E9%80%89%E6%8B%A9%E9%A2%98%E8%80%83%E7%82%B9/"/>
    <url>/2022/08/29/%E8%BD%AF%E8%80%83/%E9%80%89%E6%8B%A9%E9%A2%98%E8%80%83%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="é€‰æ‹©é¢˜è€ƒç‚¹"><a href="#é€‰æ‹©é¢˜è€ƒç‚¹" class="headerlink" title="é€‰æ‹©é¢˜è€ƒç‚¹"></a>é€‰æ‹©é¢˜è€ƒç‚¹</h2><h4 id="å¸¸è§å¯†é’¥åŠ å¯†ç®—æ³•"><a href="#å¸¸è§å¯†é’¥åŠ å¯†ç®—æ³•" class="headerlink" title="å¸¸è§å¯†é’¥åŠ å¯†ç®—æ³•"></a>å¸¸è§å¯†é’¥åŠ å¯†ç®—æ³•</h4><h5 id="å¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#å¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="å¯¹ç§°åŠ å¯†ç®—æ³•:"></a>å¯¹ç§°åŠ å¯†ç®—æ³•:</h5><blockquote><p>åŠ è§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼Œåˆç§°ä¸ºç§äººç§˜é’¥åŠ å¯†&#x2F;å…±äº«ç§˜é’¥åŠ å¯†</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li>åŠ å¯†å¼ºåº¦ä¸é«˜ä½†æ•ˆç‡é«˜</li><li>åœ¨ä¸ºå¤§é‡æ˜æ–‡åŠ å¯†æ—¶ä¸€èˆ¬ä½¿ç”¨å¯¹ç§°åŠ å¯†</li></ul><p>å¸¸è§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</p><ul><li><strong>DES</strong>ï¼ˆData Encryption Standardï¼Œæ•°æ®åŠ å¯†æ ‡å‡†ï¼‰</li><li><strong>3DES</strong>ï¼ˆ Triple DESï¼Œä¸‰é‡æ•°æ®åŠ å¯†ç®—æ³• ï¼‰</li><li><strong>RC5</strong>ï¼ˆåˆ†ç»„å¯†ç ç®—æ³•ï¼‰</li><li><strong>RC4</strong> (æµåŠ å¯†ç®—æ³•)</li><li><strong>IDEA</strong>ï¼ˆInternational Data Encryption Algorithmï¼Œå›½é™…æ•°æ®åŠ å¯†ç®—æ³•ï¼‰</li><li><strong>AES</strong>ï¼ˆAdvanced Encryption Standardï¼Œé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œ<strong>åˆ†ç»„åŠ å¯†ç®—æ³•</strong>ï¼‰</li></ul><h5 id="éå¯¹ç§°åŠ å¯†ç®—æ³•"><a href="#éå¯¹ç§°åŠ å¯†ç®—æ³•" class="headerlink" title="éå¯¹ç§°åŠ å¯†ç®—æ³•:"></a>éå¯¹ç§°åŠ å¯†ç®—æ³•:</h5><blockquote><p>å…¬é’¥åŠ å¯†ï¼Œç›¸åº”çš„ç§é’¥è§£å¯†ï¼Œä¹Ÿç§°å…¬å¼€å¯†é’¥åŠ å¯†</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li>åŠ å¯†é€Ÿåº¦æ…¢ä½†å¼ºåº¦é«˜</li></ul><p>å¸¸è§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š</p><ul><li><strong>RSA</strong>ï¼ˆå…¬å¼€å¯†é’¥å¯†ç ä½“åˆ¶ï¼‰</li><li><strong>DSA</strong> (Digital Signature Algorithmï¼Œä¸€ç§æ›´é«˜çº§çš„éªŒè¯æ–¹å¼)</li><li><strong>ECC</strong>ï¼ˆElliptic Curves Cryptographyï¼Œæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼‰</li></ul><h4 id="æ¶ˆæ¯æ‘˜è¦ç®—æ³•"><a href="#æ¶ˆæ¯æ‘˜è¦ç®—æ³•" class="headerlink" title="æ¶ˆæ¯æ‘˜è¦ç®—æ³•"></a>æ¶ˆæ¯æ‘˜è¦ç®—æ³•</h4><blockquote><p>å¯¹åŠ å¯†å†…å®¹ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼Œæ³¨æ„æ‘˜è¦ä¸æ˜¯åŠ å¯†ï¼Œæ— æ³•è§£å¯†ï¼Œä»…èƒ½ç”¨æ¥æ ‡è¯†åŸå†…å®¹ã€‚</p></blockquote><p>å¸¸è§æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼š</p><ul><li>MD5&#x2F;SHA</li></ul><h4 id="åŠ å¯†æŠ€æœ¯çš„åº”ç”¨"><a href="#åŠ å¯†æŠ€æœ¯çš„åº”ç”¨" class="headerlink" title="åŠ å¯†æŠ€æœ¯çš„åº”ç”¨"></a>åŠ å¯†æŠ€æœ¯çš„åº”ç”¨</h4><ul><li><strong>æ•°å­—ä¿¡å°</strong>ï¼šç”¨æ¥æ”¶æ–¹å…¬é’¥åŠ å¯†ä½¿ç”¨çš„å¯¹ç§°å¯†é’¥ã€‚</li><li><strong>æ•°å­—ç­¾å</strong>ï¼šç”¨å‘é€æ–¹<strong>ç§é’¥</strong>ç­¾åï¼Œ<strong>ä¿è¯å‘é€æ–¹èº«ä»½çœŸå®æ€§</strong>ï¼Œå‘é€è€…ä¸å¯æŠµèµ–ï¼Œä¸ä¿¡æ¯æ‘˜è¦ç»“åˆï¼Œå¯é˜²ç¯¡æ”¹ã€‚å¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡Œè®¤è¯ã€‚</li><li><strong>ä¿¡æ¯æ‘˜è¦</strong>ï¼šå•å‘æ•£åˆ—å€¼å‡½æ•°ï¼Œé˜²ç¯¡æ”¹ï¼Œä¿è¯æ¶ˆæ¯å®Œæ•´æ€§</li><li><strong>æ•°å­—è¯ä¹¦</strong>ï¼šç¡®ä¿æ¶ˆæ¯ä¸å¯å¦è®¤ã€‚å†…å®¹åŒ…æ‹¬ï¼šCAç­¾å(éªŒè¯ç½‘ç«™çœŸä¼ª)ã€ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åç§°ï¼‰ã€ç”¨æˆ·å…¬é’¥ç­‰</li></ul><h4 id="ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨"><a href="#ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨" class="headerlink" title="ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨"></a>ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨</h4><h5 id="ç¼–è¯‘å™¨"><a href="#ç¼–è¯‘å™¨" class="headerlink" title="ç¼–è¯‘å™¨"></a>ç¼–è¯‘å™¨</h5><blockquote><p>å°†â€é«˜çº§è¯­è¨€â€ç¿»è¯‘ä¸ºä½çº§è¯­è¨€</p><p>å°†æºç¨‹åºæ•´ä¸ªç¼–è¯‘æˆå¯æ‰§è¡Œçš„ç›®æ ‡ä»£ç ï¼Œæ‰§è¡Œæ—¶ä¸éœ€è¦ç¼–è¯‘å™¨</p><p>ç¿»è¯‘ä¸æ‰§è¡Œæ˜¯åˆ†å¼€çš„</p></blockquote><p><strong>è¿‡ç¨‹</strong></p><p><img src="/img/post_img/%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F%E8%BF%87%E7%A8%8B.png"></p><p><strong>è¯¦ç»†è¿‡ç¨‹</strong></p><p><img src="/img/post_img/%E8%AF%A6%E7%BB%86%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F%E8%BF%87%E7%A8%8B.png"></p><h5 id="è§£é‡Šå™¨"><a href="#è§£é‡Šå™¨" class="headerlink" title="è§£é‡Šå™¨"></a>è§£é‡Šå™¨</h5><blockquote><p>æŠŠé«˜çº§ç¼–ç¨‹è¯­è¨€é€è¡Œè½¬è¯‘</p><p>æ‰§è¡Œè¿‡ç¨‹è¾ƒæ…¢</p></blockquote><p><strong>è¿‡ç¨‹</strong></p><p><img src="/img/post_img/%E8%A7%A3%E9%87%8A%E7%A8%8B%E5%BA%8F%E8%BF%87%E7%A8%8B.png"></p><h4 id="å†…èšæ–¹å¼"><a href="#å†…èšæ–¹å¼" class="headerlink" title="å†…èšæ–¹å¼"></a>å†…èšæ–¹å¼</h4><blockquote><p>ä¸€ä¸ªæ¨¡å—å„ä¸ªå…ƒç´ å½¼æ­¤ç»“åˆçš„ç´§å¯†ç¨‹åº¦</p><p>ç”±é«˜åˆ°ä½</p></blockquote><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŠŸèƒ½å†…èš</td><td>ä¸€ä¸ªæ¨¡å—å†…æ‰€æœ‰å¤„ç†å…ƒç´ å®Œæˆä¸€ä¸ªï¼Œè€Œä¸”ä»…å®Œæˆä¸€ä¸ªåŠŸèƒ½</td></tr><tr><td>é¡ºåºå†…èš</td><td>ä¸€ä¸ªæ¨¡å—å†…å¤„ç†å…ƒç´ å’ŒåŒä¸€ä¸ªåŠŸèƒ½å¯†åˆ‡ç›¸å…³ï¼Œè€Œä¸”è¿™äº›å¤„ç†å…ƒç´ å¿…é¡»é¡ºåºæ‰§è¡Œ(é€šå¸¸å‰ä¸€ä¸ªå¤„ç†å…ƒç´ çš„è¾“å‡ºæ—¶åä¸€ä¸ªå¤„ç†å…ƒç´ çš„è¾“å…¥)</td></tr><tr><td>é€šä¿¡å†…èš</td><td>æ¨¡å—å†…çš„æ‰€æœ‰å¤„ç†å…ƒç´ éƒ½åœ¨åŒä¸€ä¸ªæ•°æ®ç»“æ„ä¸Šæ“ä½œï¼Œæˆ–è€…å„å¤„ç†ä½¿ç”¨ç›¸åŒçš„è¾“å…¥æ•°æ®æˆ–è€…äº§ç”Ÿç›¸åŒçš„è¾“å‡ºæ•°æ®</td></tr><tr><td>è¿‡ç¨‹å†…èš</td><td>ä¸€ä¸ªæ¨¡å—å†…çš„å¤„ç†å…ƒç´ æ˜¯ç›¸å…³çš„ï¼Œè€Œä¸”å¿…é¡»ä»¥ç‰¹å®šçš„æ¬¡åºæ‰§è¡Œè¿‡ç¨‹ã€‚å†…èšä¸é¡ºåºå†…èšçš„åŒºåˆ«æ˜¯ï¼š  é¡ºåºå†…èšä¸­æ˜¯æ•°æ®æµä»ä¸€ä¸ªå¤„ç†å•å…ƒæµåˆ°å¦ä¸€ä¸ªå¤„ç†å•å…ƒï¼Œè€Œè¿‡ç¨‹å†…èšæ˜¯æ§åˆ¶æµä»ä¸€ä¸ªåŠ¨ä½œæµå‘å¦ä¸€ä¸ªåŠ¨ä½œ</td></tr><tr><td>æ—¶é—´å†…èš</td><td>ä¸€ä¸ªæ¨¡å—åŒ…å«çš„ä»»åŠ¡å¿…é¡»åœ¨åŒä¸€æ®µæ—¶é—´å†…æ‰§è¡Œ</td></tr><tr><td>é€»è¾‘å†…èš</td><td>æ¨¡å—å†…æ‰§è¡Œè‹¥å¹²ä¸ªé€»è¾‘ä¸Šç›¸ä¼¼çš„åŠŸèƒ½ï¼Œé€šè¿‡å‚æ•°ç¡®å®šè¯¥æ¨¡å—å®Œæˆå“ªä¸€ä¸ªåŠŸèƒ½</td></tr><tr><td>å¶ç„¶å†…èš</td><td>ä¸€ä¸ªæ¨¡å—ç”±å®Œæˆè‹¥å¹²æ¯«æ— å…³ç³»çš„åŠŸèƒ½å¤„ç†å…ƒç´ å¶ç„¶ç»„åˆåœ¨ä¸€èµ·ï¼Œå„å¤„ç†å…ƒç´ ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»</td></tr></tbody></table><h4 id="è€¦åˆæ–¹å¼"><a href="#è€¦åˆæ–¹å¼" class="headerlink" title="è€¦åˆæ–¹å¼"></a>è€¦åˆæ–¹å¼</h4><blockquote><p>ç”±é«˜åˆ°ä½</p></blockquote><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å†…å®¹è€¦åˆ</td><td>ä¸€ä¸ªæ¨¡å—<strong>ç›´æ¥è®¿é—®å¦ä¸€æ¨¡å—</strong>çš„å†…å®¹</td></tr><tr><td>å…¬å…±è€¦åˆ</td><td>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€ä¸ª<strong>å…¨å±€æ•°æ®ç»“æ„</strong></td></tr><tr><td>å¤–éƒ¨è€¦åˆ</td><td>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€<strong>å…¨å±€ç®€å•å˜é‡</strong></td></tr><tr><td>æ§åˆ¶è€¦åˆ</td><td>æ¨¡å—ä¹‹é—´ä¼ é€’çš„ä¸æ˜¯æ•°æ®ä¿¡æ¯ï¼Œè€Œæ˜¯<strong>æ§åˆ¶ä¿¡æ¯</strong>ä¾‹å¦‚æ ‡å¿—ã€å¼€å…³é‡ç­‰ï¼Œä¸€ä¸ªæ¨¡å—æ§åˆ¶äº†å¦ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½</td></tr><tr><td>æ ‡è®°è€¦åˆ</td><td>é€šè¿‡å‚æ•°è¡¨ä¼ é€’<strong>è®°å½•ä¿¡æ¯(æ•°æ®ç»“æ„)</strong></td></tr><tr><td>æ•°æ®è€¦åˆ</td><td>è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´åªä¼ é€’<strong>ç®€å•çš„æ•°æ®é¡¹å‚æ•°</strong></td></tr><tr><td>éç›´æ¥è€¦åˆ</td><td>ä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å®Œå…¨æ˜¯é€šè¿‡ä¸»æ¨¡å—çš„æ§åˆ¶å’Œè°ƒç”¨æ¥å®ç°çš„</td></tr></tbody></table><h4 id="è½¯ä»¶è´¨é‡æ¨¡å‹"><a href="#è½¯ä»¶è´¨é‡æ¨¡å‹" class="headerlink" title="è½¯ä»¶è´¨é‡æ¨¡å‹"></a>è½¯ä»¶è´¨é‡æ¨¡å‹</h4><table><thead><tr><th>è´¨é‡ç‰¹æ€§</th><th>è´¨é‡å­ç‰¹æ€§</th></tr></thead><tbody><tr><td>åŠŸèƒ½æ€§</td><td>é€‚åˆæ€§<br/>å‡†ç¡®æ€§<br/>äº’ç”¨æ€§<br/>ä¾ä»æ€§<br/>å®‰å…¨æ€§</td></tr><tr><td>å¯é æ€§</td><td>æˆç†Ÿæ€§<br/>å®¹é”™æ€§<br/>æ˜“æ¢å¤æ€§</td></tr><tr><td>æ˜“ä½¿ç”¨æ€§</td><td>æ˜“ç†è§£æ€§<br/>æ˜“å­¦æ€§<br/>æ˜“æ“ä½œæ€§</td></tr><tr><td>æ•ˆç‡</td><td>æ—¶é—´ç‰¹æ€§<br/>èµ„æºç‰¹æ€§</td></tr><tr><td>å¯ç»´æŠ¤æ€§</td><td>æ˜“åˆ†ææ€§<br/>æ˜“æ”¹å˜æ€§<br/>ç¨³å®šæ€§<br/>æ˜“æµ‹è¯•æ€§</td></tr><tr><td>å¯ç§»æ¤æ€§</td><td>é€‚åº”æ€§<br/>æ˜“å®‰è£…æ€§<br/>ä¸€è‡´æ€§<br/>æ˜“æ›¿æ¢æ€§</td></tr></tbody></table><h4 id="ç»“æ„åŒ–åˆ†æç»„æˆ"><a href="#ç»“æ„åŒ–åˆ†æç»„æˆ" class="headerlink" title="ç»“æ„åŒ–åˆ†æç»„æˆ"></a>ç»“æ„åŒ–åˆ†æç»„æˆ</h4><p>è‡ªé¡¶å‘ä¸‹ï¼š</p><ul><li>æ•°æ®æµå›¾</li><li>æ•°æ®å­—å…¸: æ•°æ®åº“ä¸­æ•°æ®çš„æå†™å™è¿°</li><li>åŠ å·¥é€»è¾‘</li></ul><h4 id="CPUæ„æˆ"><a href="#CPUæ„æˆ" class="headerlink" title="CPUæ„æˆ"></a>CPUæ„æˆ</h4><blockquote><p>CPUä¸»è¦ç”±è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å¯„å­˜å™¨å’Œå†…éƒ¨æ€»çº¿ç­‰éƒ¨ä»¶ç»„æˆ</p></blockquote><p><img src="/img/post_img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E6%A1%86%E5%9B%BE.png" alt="è®¡ç®—æœºç»„æˆæ¡†å›¾"></p><p>è¿ç®—å™¨ï¼š</p><ol><li><p>ç®—æœ¯é€»è¾‘å•å…ƒ(Arithmetic Logic Unitï¼ŒALU)ï¼šè´Ÿè´£æ•°æ®å¤„ç†ï¼Œå®ç°å¯¹æ•°æ®çš„ç®—æœ¯è¿ç®—å’Œé€»è¾‘è¿ç®—ç­‰</p></li><li><p>ç´¯åŠ å¯„å­˜å™¨(Accumulator, AC)ï¼šå½“ALUæ‰§è¡Œç®—æœ¯æˆ–æ˜¯é€»è¾‘è¿ç®—çš„æ—¶å€™ï¼Œä¸ºALUæä¾›ä¸€ä¸ªå·¥ä½œåŒºï¼Œ<strong>æä¾›æ•°æ®å¹¶æš‚æ—¶å­˜å‚¨è®¡ç®—ç»“æœ</strong>ï¼Œæ˜¯ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨</p></li><li><p>æ•°æ®ç¼“å†²å¯„å­˜å™¨(Data Register,DR)ï¼šä½œä¸ºCPUå’Œå†…å­˜ï¼Œå¤–å›´è®¾å¤‡ä¹‹é—´æ•°æ®çš„ä¸­è½¬ç«™ã€‚æ˜¯CPUå’Œå†…å­˜ï¼Œå¤–å›´è®¾å¤‡ä¹‹é—´åœ¨æ“ä½œé€Ÿåº¦ä¸Šçš„ç¼“å†²</p></li><li><p>çŠ¶æ€æ¡ä»¶å¯„å­˜å™¨(Program Status Word, PSW)ï¼šä¿å­˜ç”±ç®—æœ¯æŒ‡ä»¤å’Œé€»è¾‘æŒ‡ä»¤è¿è¡Œæˆ–æµ‹è¯•çš„ç»“æœå»ºç«‹çš„å„ç§æ¡ä»¶ç å†…å®¹ï¼Œå¦‚è¿ç®—ç»“æœè¿›ä½æ ‡å¿—</p></li></ol><p>æ§åˆ¶å™¨ï¼š</p><ol><li>ç¨‹åºè®¡æ•°å™¨(Program Counter, PC)ï¼šå…·æœ‰å¯„å­˜ä¿¡æ¯å’Œè®°æ•°ä¸¤ç§åŠŸèƒ½ï¼Œ<strong>å­˜æ”¾çš„æ˜¯æŒ‡ä»¤çš„åœ°å€</strong>ï¼Œè¿˜æœ‰è®¡æ•°çš„åŠŸèƒ½ï¼Œåˆç§°ä¸ºæŒ‡ä»¤è®¡æ•°å™¨ã€‚</li><li>æŒ‡ä»¤å¯„å­˜å™¨(Instruction Registerï¼ŒIR)ï¼šå½“CPUæ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ—¶ï¼Œ<strong>å…ˆæŠŠå®ƒä»å†…å­˜å‚¨å™¨å–åˆ°æŒ‡ä»¤ç¼“å­˜å™¨ä¸­</strong>ï¼Œå†é€å…¥åˆ°æŒ‡ä»¤å¯„å­˜å™¨ä¸­ï¼Œç„¶åç»è¿‡æŒ‡ä»¤è¯‘ç å™¨çš„è¯‘ç ï¼Œä»è€Œäº§ç”Ÿå„ç§å¾®æ“ä½œã€‚</li><li>åœ°å€å¯„å­˜å™¨(Address Registerï¼ŒAR): å­˜æ”¾çš„æ˜¯cpuè®¿é—®å†…å­˜å•å…ƒçš„åœ°å€</li><li>æŒ‡ä»¤è¯‘ç å™¨ï¼ˆInstruction Decoder, IDï¼‰:æŒ‡ä»¤è¯‘ç å™¨å¯¹æŒ‡ä»¤çš„æ“ä½œç å’Œåœ°å€ç è¿›è¡Œ<strong>è§£æ</strong>ï¼Œè½¬æ¢æˆç›¸åº”çš„æ“ä½œä¿¡å·</li></ol><h4 id="ä¿æŠ¤è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçš„æ³•å¾‹"><a href="#ä¿æŠ¤è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçš„æ³•å¾‹" class="headerlink" title="ä¿æŠ¤è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçš„æ³•å¾‹"></a>ä¿æŠ¤è®¡ç®—æœºè½¯ä»¶è‘—ä½œæƒçš„æ³•å¾‹</h4><p>ã€Šä¸­åäººæ°‘å…±å’Œå›½è‘—ä½œæƒæ³•ã€‹å’Œã€Šè®¡ç®—æœºè½¯ä»¶ä¿æŠ¤æ¡ä¾‹ã€‹</p><h4 id="ä¸­æ–­å‘é‡"><a href="#ä¸­æ–­å‘é‡" class="headerlink" title="ä¸­æ–­å‘é‡"></a>ä¸­æ–­å‘é‡</h4><blockquote><p>è®°å½•æ¯ä¸ªä¸åŒä¸­æ–­å‘ç”Ÿåè¦è·³è½¬çš„ä¸­æ–­æœåŠ¡ç¨‹åºçš„å…¶å®åœ°å€</p></blockquote><p>ä¸­æ–­å‘é‡æä¾›ä¸­æ–­æœåŠ¡ç¨‹åºå…¥å£åœ°å€</p><h4 id="æ€»çº¿"><a href="#æ€»çº¿" class="headerlink" title="æ€»çº¿"></a>æ€»çº¿</h4><blockquote><p>è®¡ç®—æœºè®¾å¤‡å’Œè®¾å¤‡ä¹‹é—´ä¼ è¾“ä¿¡æ¯çš„å…¬å…±æ•°æ®é€šé“</p></blockquote><p>æ€»çº¿åˆ†ä¸ºæ•°æ®æ€»çº¿ï¼ˆData Busï¼ŒDBï¼‰ã€åœ°å€æ€»çº¿ï¼ˆAddress Busï¼ŒABï¼‰å’Œæ§åˆ¶æ€»çº¿ï¼ˆControl Busï¼ŒCBï¼‰</p><ul><li>æ•°æ®æ€»çº¿ï¼šç”¨æ¥ä¼ é€æ•°æ®ä¿¡æ¯ï¼Œæ˜¯åŒå‘çš„</li><li>åœ°å€æ€»çº¿ï¼šä¼ é€CPUå‘å‡ºçš„åœ°å€ä¿¡æ¯ï¼Œæ˜¯å•å‘çš„ï¼Œåœ°å€æ€»çº¿çš„å®½åº¦å†³å®šäº†CPUçš„æœ€å¤§å¯»å€èƒ½åŠ›</li><li>æ§åˆ¶æ€»çº¿ï¼šä¼ é€æ§åˆ¶ä¿¡å·ã€æ—¶åºä¿¡å·å’ŒçŠ¶æ€ä¿¡æ¯ç­‰ï¼Œæ¯ä¸€æ¡çº¿çš„ä¿¡æ¯ä¼ é€æ–¹å‘æ˜¯å•æ–¹å‘ï¼Œä½†ä½œä¸ºä¸€ä¸ªæ•´ä½“åˆ™æ˜¯åŒå‘çš„</li></ul><p>å¸¸è§æ€»çº¿ï¼š</p><ul><li>PCIæ€»çº¿ã€‚PCIæ€»çº¿æ˜¯ç›®å‰å¾®å‹æœºä¸Šå¹¿æ³›é‡‡ç”¨çš„<strong>å†…æ€»çº¿</strong>ï¼Œé‡‡ç”¨<strong>å¹¶è¡Œä¼ è¾“</strong>æ–¹å¼ã€‚</li><li>PCI Expressæ€»çº¿ã€‚PCI Expressç®€ç§°ä¸ºPCI-Eï¼Œé‡‡ç”¨ç‚¹å¯¹ç‚¹<strong>ä¸²è¡Œ</strong>è¿æ¥ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½æœ‰è‡ªå·±çš„ä¸“ç”¨è¿æ¥ï¼Œä¸éœ€è¦å‘æ•´ä¸ªæ€»çº¿è¯·æ±‚å¸¦å®½ï¼Œè€Œä¸”å¯ä»¥æŠŠæ•°æ®ä¼ è¾“ç‡æé«˜åˆ°ä¸€ä¸ªå¾ˆé«˜çš„é¢‘ç‡ã€‚ç›¸å¯¹äºä¼ ç»ŸPCIæ€»çº¿åœ¨å•ä¸€æ—¶é—´å‘¨æœŸå†…åªèƒ½å®ç°å•å‘ä¼ è¾“ï¼ŒPCI Expressçš„åŠåŒå·¥è¿æ¥èƒ½æä¾›æ›´é«˜çš„ä¼ è¾“é€Ÿç‡å’Œè´¨é‡ã€‚</li><li>SCSIæ€»çº¿ã€‚å°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ï¼ˆSCSIï¼‰æ˜¯ä¸€æ¡<strong>å¹¶è¡Œå¤–æ€»çº¿</strong>ï¼Œå¹¿æ³›ç”¨äºè¿æ¥è½¯ç¡¬ç£ç›˜ã€å…‰ç›˜ã€æ‰«æä»ªç­‰ã€‚</li><li>SATAã€‚SATAæ˜¯Serial ATAçš„ç¼©å†™ï¼Œå³ä¸²è¡ŒATAï¼Œå®ƒä¸»è¦ç”¨ä½œä¸»æ¿å’Œå¤§é‡å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ç¡¬ç›˜åŠå…‰ç›˜é©±åŠ¨å™¨ï¼‰ä¹‹é—´çš„æ•°æ®ä¼ è¾“ä¹‹ç”¨ã€‚</li><li>USBã€‚é€šç”¨ä¸²è¡Œæ€»çº¿</li></ul><h4 id="ç»Ÿä¸€è¿‡ç¨‹-UP"><a href="#ç»Ÿä¸€è¿‡ç¨‹-UP" class="headerlink" title="ç»Ÿä¸€è¿‡ç¨‹(UP)"></a>ç»Ÿä¸€è¿‡ç¨‹(UP)</h4><p>é˜¶æ®µé‡Œç¨‹ç¢‘ï¼š</p><ol><li>åˆå¯é˜¶æ®µï¼šç”Ÿå‘½å‘¨æœŸç›®æ ‡</li><li>ç²¾åŒ–é˜¶æ®µï¼šç”Ÿå‘½å‘¨æœŸæ¶æ„</li><li>æ„å»ºé˜¶æ®µï¼šåˆå§‹è¿ä½œåŠŸèƒ½</li><li>ç§»äº¤é˜¶æ®µï¼šäº§å“å‘å¸ƒ</li><li>äº§ç”Ÿé˜¶æ®µ</li></ol><h4 id="ç½‘å…³åè®®"><a href="#ç½‘å…³åè®®" class="headerlink" title="ç½‘å…³åè®®"></a>ç½‘å…³åè®®</h4><p><strong>å†…éƒ¨ç½‘å…³åè®®</strong>(IGP, åœ¨ä¸€ä¸ªåŸŸä¸­é€‰æ‹©è·¯ç”±)ï¼š</p><ul><li>RIP(è·¯ç”±ä¿¡æ¯åè®®)ï¼šç›¸é‚»è·¯ç”±å™¨äº¤æ¢è·¯ç”±è¡¨</li><li>OSPF(æœ€çŸ­è·¯å¾„ä¼˜å…ˆ):  è·¯ç”±å™¨ä¹‹é—´é€šå‘Šç½‘ç»œæ¥å£çš„çŠ¶æ€æ¥å»ºç«‹é“¾è·¯çŠ¶æ€æ•°æ®åº“</li></ul><p><strong>å¤–éƒ¨ç½‘å…³åè®®</strong>(EGP, ä¸¤ä¸ªç›¸é‚»çš„ä½äºå„è‡ªåŸŸè¾¹ç•Œä¸Šçš„è·¯ç”±å™¨æä¾›ä¸€ç§äº¤æ¢æ¶ˆæ¯å’Œä¿¡æ¯çš„æ–¹æ³•):</p><ul><li>BGP</li></ul><h4 id="ç¯è·¯å¤æ‚åº¦"><a href="#ç¯è·¯å¤æ‚åº¦" class="headerlink" title="ç¯è·¯å¤æ‚åº¦"></a>ç¯è·¯å¤æ‚åº¦</h4><p>è®¡ç®—æ–¹å¼ï¼š</p><ol><li>æµå›¾Gçš„ç¯å½¢å¤æ‚åº¦V(G)&#x3D;m-n+2ï¼Œå…¶ä¸­ï¼Œmæ˜¯æµå›¾ä¸­è¾¹çš„æ¡æ•°ï¼Œnæ˜¯ç»“ç‚¹æ•°ã€‚</li><li>æµå›¾Gçš„ç¯å½¢å¤æ‚åº¦V(G)&#x3D;P+1ï¼Œå…¶ä¸­ï¼ŒPæ˜¯æµå›¾ä¸­åˆ¤å®šç»“ç‚¹çš„æ•°ç›®ã€‚</li></ol><h4 id="æµ®ç‚¹æ•°åŠ æ³•"><a href="#æµ®ç‚¹æ•°åŠ æ³•" class="headerlink" title="æµ®ç‚¹æ•°åŠ æ³•"></a>æµ®ç‚¹æ•°åŠ æ³•</h4><p>å°é˜¶å¯¹å¤§é˜¶ï¼Œå°¾æ•°å‘å³ç§»</p><h4 id="CMMIæˆç†Ÿåº¦æ¨¡å‹"><a href="#CMMIæˆç†Ÿåº¦æ¨¡å‹" class="headerlink" title="CMMIæˆç†Ÿåº¦æ¨¡å‹"></a>CMMIæˆç†Ÿåº¦æ¨¡å‹</h4><blockquote><p>æ–¹ä¾¿è®°å¿†æ–¹æ³•ï¼šæè¿°ï¼ˆè¯´æ˜ï¼‰æ˜¯åç§°äº§ç”Ÿçš„ç»“æœã€‚</p></blockquote><table><thead><tr><th>ç­‰çº§ç¼–å·</th><th>ç­‰çº§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>0</td><td>æœªæ‰§è¡Œã€æœªå®Œæˆ</td><td>è¿‡ç¨‹åŸŸæœªè¢«æ‰§è¡Œæˆ–æœªå¾—åˆ°CL1æ‰€å®šä¹‰çš„ç›®æ ‡</td></tr><tr><td>1</td><td>å·²æ‰§è¡Œ</td><td>å…±æ€§ç›®æ ‡æ˜¯å°†å¯æ ‡è¯†çš„è¾“å…¥å·¥ä½œäº§å“è½¬æˆè¾“å‡ºäº§å“ï¼Œæ»¡è¶³è¿‡ç¨‹åŸŸçš„ç‰¹å®šç›®æ ‡ã€‚</td></tr><tr><td>2</td><td>å·²ç®¡ç†</td><td>å·²ç®¡ç†çš„è¿‡ç¨‹åˆ¶åº¦åŒ–ï¼Œæ‰€æœ‰å·¥ä½œä»»åŠ¡å’Œäº§å“éƒ½è¢«ç›‘æ§</td></tr><tr><td>3</td><td>å·²å®šä¹‰</td><td>å·²å®šä¹‰çš„è¿‡ç¨‹åˆ¶åº¦åŒ–ï¼Œæ”¶é›†è¿‡ç¨‹èµ„äº§å’Œåº¦é‡ï¼Œå¹¶ç”¨æ¥å°†æ¥å¯¹è¿‡ç¨‹è¿›è¡Œæ”¹è¿›</td></tr><tr><td>4</td><td>å®šé‡ç®¡ç†</td><td>åœ¨è¿‡ç¨‹åŸŸä¸­å¼•å…¥åº¦é‡ï¼Œå¹¶åˆ©ç”¨åº¦é‡è¿›è¡Œç®¡ç†</td></tr><tr><td>5</td><td>ä¼˜åŒ–çš„</td><td>ä½¿ç”¨é‡åŒ–ï¼ˆç»Ÿè®¡å­¦ï¼‰æ‰‹æ®µæ”¹å˜å’Œä¼˜åŒ–è¿‡ç¨‹åŸŸï¼Œä»¥æ»¡è¶³å®¢æˆ·çš„æ”¹å˜å’ŒæŒç»­,æ”¹è¿›è®¡åˆ’ä¸­çš„è¿‡ç¨‹åŸŸçš„åŠŸæ•ˆ</td></tr></tbody></table><h4 id="æµ·æ˜ç "><a href="#æµ·æ˜ç " class="headerlink" title="æµ·æ˜ç "></a>æµ·æ˜ç </h4><ul><li><p>æ ¸å¿ƒå…¬å¼ï¼š<strong>2r â‰¥k+r+1</strong> (kä¸ºä¿¡æ¯çš„ä¸ªæ•°ï¼Œrä¸ºæ ¡éªŒä½çš„ä¸ªæ•°)</p></li><li><p>æ ¡éªŒç Pi å¿…é¡»æ˜¯åœ¨2çš„næ¬¡æ–¹ä½ç½®</p></li><li><p>ç¡®å®šæ ¡æ­£ä½çš„æ•°å€¼ï¼šé¦–å…ˆå¿…é¡»<strong>çŸ¥é“å“ªäº›ä¿¡æ¯ä½éœ€è¦æ ¡æ­£ä½æ¥æ ¡æ­£</strong>ï¼Œæ ¡æ­£çš„åŸåˆ™ï¼šæƒ³è¦æ ¡æ­£ç¬¬å‡ ï¼ˆiï¼‰ä½ï¼Œåˆ™åº”è¯¥æ»¡è¶³å¯¹åº”çš„é‚£å‡ ä¸ªæ ¡æ­£ä½ç›¸åŠ ç­‰äºiã€‚ä¾‹å¦‚3&#x3D;1+2ï¼›7&#x3D;1-+2+4ã€‚ç„¶åæ ¡æ­£ä½çš„å€¼ä¸ºå¯¹åº”ä¿¡æ¯ä½çš„<strong>å¼‚æˆ–</strong></p></li></ul><h4 id="æ•°æ®ä»“åº“"><a href="#æ•°æ®ä»“åº“" class="headerlink" title="æ•°æ®ä»“åº“"></a>æ•°æ®ä»“åº“</h4><ul><li>æ•°æ®æå–ï¼ˆData Extractionï¼‰æŒ‡æ ¹æ®ä¸€å®šçš„ç›®çš„ï¼Œ<strong>ä»åŸå§‹æ–‡çŒ®ä¸­æ‘˜å½•æ‰€éœ€è¦çš„ä¿¡æ¯</strong>ï¼Œä»¥ä½œè¿›ä¸€æ­¥å­˜å‚¨ã€æ¢ç®—å’Œåˆ†æçš„è¿‡ç¨‹</li><li>OLAP(Online Analytical Processing) æ˜¯<strong>åœ¨çº¿åˆ†æå¤„ç†</strong>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯OLAPæ˜¯<strong>ç”¨äºæ•°æ®åˆ†æ</strong>çš„ï¼›å› æ­¤ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤ŸåŒæ—¶åˆ†ææ¥è‡ªå¤šä¸ªæ•°æ®åº“ç³»ç»Ÿçš„ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è¯´å®ƒæ˜¯ä¸€ç§è®¡ç®—æ–¹æ³•ï¼Œå¯ä»¥è®©ç”¨æˆ·è½»æ¾æå–æ‰€éœ€çš„æ•°æ®å¹¶æŸ¥è¯¢æ•°æ®ï¼Œä»¥ä¾¿ä»ä¸åŒçš„è§’åº¦è¿›è¡Œåˆ†æ</li><li>OLTP (On-Line Transaction Processing)ç§°ä¸ºé¢å‘äº¤æ˜“çš„å¤„ç†è¿‡ç¨‹ï¼Œå…¶åŸºæœ¬ç‰¹å¾æ˜¯å‰å°æ¥æ”¶çš„ç”¨æˆ·æ•°æ®å¯ä»¥ç«‹å³ä¼ é€åˆ°è®¡ç®—ä¸­å¿ƒè¿›è¡Œå¤„ç†ï¼Œå¹¶åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ç»™å‡ºå¤„ç†ç»“æœï¼Œæ˜¯å¯¹ç”¨æˆ·æ“ä½œå¿«é€Ÿå“åº”çš„æ–¹å¼ä¹‹ä¸€ã€‚</li><li>ETL(Extract, transform, load)æ˜¯å°†ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®ç»è¿‡æŠ½å–ã€æ¸…æ´—è½¬æ¢ä¹‹ååŠ è½½åˆ°æ•°æ®ä»“åº“çš„è¿‡ç¨‹ï¼Œç›®çš„æ˜¯å°†ä¼ä¸šä¸­çš„åˆ†æ•£ã€é›¶ä¹±ã€æ ‡å‡†ä¸ç»Ÿä¸€çš„æ•°æ®æ•´åˆåˆ°ä¸€èµ·ï¼Œä¸ºä¼ä¸šçš„å†³ç­–æä¾›åˆ†æä¾æ®</li></ul><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><table><thead><tr><th>ç«¯å£å</th><th>ç«¯å£å·</th></tr></thead><tbody><tr><td>ç®€å•é‚®ä»¶ä¼ è¾“åè®®(SMPT)</td><td>25</td></tr><tr><td>é‚®å±€åè®®(POP3)</td><td>110</td></tr><tr><td>è¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)</td><td>80</td></tr><tr><td>åŠ å¯†çš„è¶…æ–‡æœ¬ä¼ è¾“(HTTPS)</td><td>443</td></tr><tr><td>æ–‡ä»¶ä¼ è¾“æœåŠ¡(FTP)</td><td>20æ•°æ®ç«¯å£ï¼Œ21å‘½ä»¤æ§åˆ¶ç«¯å£</td></tr><tr><td>åŸŸåæœåŠ¡(DNS)</td><td>53</td></tr><tr><td>è¿œç¨‹ç™»å½•(Telnet)</td><td>23</td></tr></tbody></table><h4 id="ç½‘ç»œæ”»å‡»"><a href="#ç½‘ç»œæ”»å‡»" class="headerlink" title="ç½‘ç»œæ”»å‡»"></a>ç½‘ç»œæ”»å‡»</h4><blockquote><p> åˆ†ä¸ºä¸»åŠ¨æ”»å‡»å’Œè¢«åŠ¨æ”»å‡»ä¸¤ç§</p></blockquote><p>ä¸»åŠ¨æ”»å‡»åŒ…æ‹¬ï¼š</p><blockquote><p>ä¸»åŠ¨æ”»å‡»æ˜¯æ”»å‡»è€…ä¸»åŠ¨åšä¸€äº›ä¸åˆ©äºä½ çš„ç³»ç»Ÿçš„äº‹æƒ…</p></blockquote><ul><li>æ‹’ç»æœåŠ¡æ”»å‡»(DOS)</li><li>åˆ†å¸ƒå¼Dos(DDOS)</li><li>ä¿¡æ¯ç¯¡æ”¹</li><li>èµ„æºä½¿ç”¨</li><li>æ¬ºéª—ã€ä¼ªè£…ã€é‡æ”¾ç­‰</li></ul><p>è¢«åŠ¨æ”»å‡»åŒ…æ‹¬ï¼š</p><blockquote><p>è¢«åŠ¨æ”»å‡»ä¸»è¦æ˜¯æœé›†ä¿¡æ¯è€Œä¸æ˜¯è¿›è¡Œè®¿é—®</p></blockquote><ul><li>å—…æ¢</li><li>ä¿¡æ¯æœé›†ç­‰</li></ul><h4 id="å…¥ä¾µæ£€æµ‹"><a href="#å…¥ä¾µæ£€æµ‹" class="headerlink" title="å…¥ä¾µæ£€æµ‹"></a>å…¥ä¾µæ£€æµ‹</h4><ul><li>ä¸“å®¶ç³»ç»Ÿ</li><li>æ¨¡å‹æ£€æµ‹</li><li>ç®€å•åŒ¹é…</li></ul><h4 id="å¸¸ç”¨ä¸­é—´ä»£ç "><a href="#å¸¸ç”¨ä¸­é—´ä»£ç " class="headerlink" title="å¸¸ç”¨ä¸­é—´ä»£ç "></a>å¸¸ç”¨ä¸­é—´ä»£ç </h4><ul><li>åç¼€å¼</li><li>ä¸‰åœ°å€ç </li><li>æ ‘</li><li>å››å…ƒå¼</li></ul><h4 id="è½¯ä»¶ç»´æŠ¤ç±»å‹"><a href="#è½¯ä»¶ç»´æŠ¤ç±»å‹" class="headerlink" title="è½¯ä»¶ç»´æŠ¤ç±»å‹"></a>è½¯ä»¶ç»´æŠ¤ç±»å‹</h4><ul><li>æ”¹æ­£æ€§ï¼šæ”¹æ­£åœ¨ç³»ç»Ÿå¼€å‘é˜¶æ®µå·²å‘ç”Ÿè€Œç³»ç»Ÿæµ‹è¯•é˜¶æ®µå°šæœªå‘ç°çš„é”™è¯¯</li><li>é€‚åº”æ€§ï¼šä½¿åº”ç”¨è½¯ä»¶é€‚åº”ä¿¡æ¯æŠ€æœ¯å˜åŒ–å’Œç®¡ç†éœ€æ±‚å˜åŒ–è€Œè¿›è¡Œçš„ä¿®æ”¹</li><li>å®Œå–„æ€§ï¼šå¢åŠ ä¸€äº›åœ¨ç³»ç»Ÿåˆ†æå’Œè®¾è®¡é˜¶æ®µä¸­æ²¡æœ‰è§„å®šçš„åŠŸèƒ½ä¸æ€§èƒ½ç‰¹å¾</li><li>é¢„é˜²æ€§ï¼šæ”¹è¿›åº”ç”¨è½¯ä»¶çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§</li></ul><p>â€‹</p><h4 id="DNSåŸŸåæŸ¥è¯¢æ¬¡åº"><a href="#DNSåŸŸåæŸ¥è¯¢æ¬¡åº" class="headerlink" title="DNSåŸŸåæŸ¥è¯¢æ¬¡åº"></a>DNSåŸŸåæŸ¥è¯¢æ¬¡åº</h4><p>æœ¬æœºhosts â€“&gt; æœ¬åœ°DNSç¼“å­˜ â€“&gt; æœ¬åœ°DNSæœåŠ¡å™¨ â€“&gt; æ ¹åŸŸåæœåŠ¡å™¨</p><h4 id="æ•æ·æ–¹æ³•"><a href="#æ•æ·æ–¹æ³•" class="headerlink" title="æ•æ·æ–¹æ³•"></a>æ•æ·æ–¹æ³•</h4><ul><li>æé™ç¼–ç¨‹XPï¼šæ¿€å‘å¼€å‘äººå‘˜åˆ›é€ æ€§ã€ä½¿å¾—ç®¡ç†è´Ÿæ‹…æœ€å°çš„ä¸€ç»„æŠ€æœ¯</li><li>è‡ªé€‚åº”è½¯ä»¶å¼€å‘ï¼šæ ¸å¿ƒæ˜¯ä¸‰ä¸ªéçº¿æ€§çš„ã€é‡é€çš„å¼€å‘é˜¶æ®µ:çŒœæµ‹,åˆä½œä¸å­¦ä¹ </li><li>æ°´æ™¶æ–¹æ³•ï¼šæ°´æ™¶æ–¹æ³•ä½“ç³»è€ƒè™‘åˆ°äººä»¬ä¸€èˆ¬å¾ˆéš¾ä¸¥æ ¼éµå¾ªä¸€ä¸ªçºªå¾‹çº¦æŸå¾ˆå¼ºçš„è¿‡ç¨‹,<strong>è®¤ä¸ºæ¯ä¸€ç§ä¸åŒçš„é¡¹ç›®éƒ½éœ€è¦ä¸€å¥—ä¸åŒçš„ç­–ç•¥ã€çº¦å®šå’Œæ–¹æ³•è®º</strong>ã€‚</li><li>å¹¶åˆ—äº‰çƒæ³•ï¼šç”¨<strong>è¿­ä»£</strong>çš„æ–¹æ³•,å…¶ä¸­æŠŠæ¯<strong>30å¤©ä¸€æ¬¡çš„è¿­ä»£ç§°ä¸ºä¸€ä¸ªâ€œå†²åˆºâ€</strong>,å¹¶æŒ‰éœ€æ±‚çš„ä¼˜å…ˆçº§æ¥å®ç°äº§å“ã€‚å¤šä¸ªè‡ªç»„ç»‡å’Œè‡ªæ²»å°ç»„å¹¶è¡Œåœ°é€’å¢å®ç°äº§å“ã€‚åè°ƒæ˜¯é€šè¿‡ç®€çŸ­çš„æ—¥å¸¸ä¼šè®®æ¥è¿›è¡Œçš„ã€‚</li></ul><h4 id="æˆæœ¬ä¼°ç®—"><a href="#æˆæœ¬ä¼°ç®—" class="headerlink" title="æˆæœ¬ä¼°ç®—"></a>æˆæœ¬ä¼°ç®—</h4><ul><li><strong>ä¸“å®¶ä¼°ç®—</strong>ï¼šæ ¹æ®ä¸“å®¶çš„è¡Œä¸šç»éªŒå’Œå†å²æ•°æ®å¯¹è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„æˆæœ¬è¿›è¡Œä¼°ç®—ã€‚</li><li><strong>Wolverton</strong>ï¼šä¹Ÿå«locæ–¹æ³•ï¼Œé€šè¿‡æ‰§è¡Œçš„æºä»£ç å‡½æ•°æ¥è¿›è¡Œæˆæœ¬ä¼°ç®—ï¼Œä¼°ç®—å‡†ç¡®æ€§ä½ï¼Œç°åœ¨å·²ç»ä¸ç”¨äº†ã€‚</li><li><strong>COCOMO</strong>ï¼šæ„é€ æ€§æˆæœ¬æ¨¡å‹ï¼Œæ˜¯ä¸€ç§å‚æ•°åŒ–çš„æˆæœ¬ä¼°ç®—æ–¹æ³•ã€‚ä¾‹å¦‚é€šè¿‡è½¯ä»¶çš„éš¾åº¦ã€è§„æ¨¡ç­‰ä½œä¸ºå‚æ•°è¿›è¡Œæˆæœ¬ä¼°ç®—ã€‚</li><li><strong>COCOMOâ…¡</strong>ï¼šCOCOMOâ…¡æ˜¯å¯¹COCOMOä½œå‡ºçš„æ”¹è¿›ç‰ˆï¼ŒæŠŠæœ€æ–°è½¯ä»¶å¼€å‘æ–¹æ³•è€ƒè™‘åœ¨å†…ã€‚COCOMOâ…¡ç”±ä¸‰ä¸ªä¸åŒçš„è®¡ç®—æ¨¡å‹ç»„æˆï¼š<br>1ï¼‰åº”ç”¨ç»„åˆæ¨¡å‹ï¼šé€‚ç”¨äºä½¿ç”¨ç°ä»£GUIå·¥å…·å¼€å‘çš„é¡¹ç›®ã€‚<br>2ï¼‰æ—©æœŸå¼€å‘æ¨¡å‹ï¼šé€‚ç”¨äºåœ¨è½¯ä»¶æ¶æ„ç¡®å®šä¹‹å‰å¯¹è½¯ä»¶è¿›è¡Œç²—ç•¥çš„æˆæœ¬å’Œäº‹ä»¶ä¼°ç®—ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–°çš„æˆæœ¬å’Œè¿›åº¦ä¼°ç®—æ–¹æ³•ã€‚åŸºäºåŠŸèƒ½ç‚¹æˆ–è€…ä»£ç è¡Œã€‚<br>3ï¼‰ç»“æ„åŒ–åæœŸæ¨¡å‹ï¼šæ˜¯COCOMOâ…¡ä¸­æœ€è¯¦ç»†çš„æ¨¡å‹ã€‚å®ƒä½¿ç”¨åœ¨æ•´ä½“è½¯ä»¶æ¶æ„å·²ç¡®å®šä¹‹åã€‚åŒ…å«æœ€æ–°çš„æˆæœ¬ä¼°ç®—ã€ä»£ç è¡Œè®¡ç®—æ–¹æ³•ã€‚</li></ul><h4 id="ç³»ç»Ÿæ€§èƒ½è¯„æµ‹"><a href="#ç³»ç»Ÿæ€§èƒ½è¯„æµ‹" class="headerlink" title="ç³»ç»Ÿæ€§èƒ½è¯„æµ‹"></a>ç³»ç»Ÿæ€§èƒ½è¯„æµ‹</h4><ul><li><strong>å¯é æ€§</strong>ï¼šä¸€ä¸ªç³»ç»Ÿå¯¹äºç»™å®šæ—¶é—´é—´éš”å†…ã€åœ¨ç»™å®šæ¡ä»¶ä¸‹å¤±æ•ˆè¿ä½œçš„æ¦‚ç‡ã€‚å¯ç”¨MTTF &#x2F; ï¼ˆ1 + MTTFï¼‰æ¥åº¦é‡ï¼ŒMTTFä¸ºå¹³å‡æ— æ•…éšœæ—¶é—´ã€‚</li><li><strong>å¯ç”¨æ€§</strong>ï¼šåœ¨ç»™å®šçš„æ—¶é—´ç‚¹ä¸Šï¼Œä¸€ä¸ªç³»ç»Ÿèƒ½å¤ŸæŒ‰ç…§è§„æ ¼è¯´æ˜æ­£ç¡®è¿ä½œçš„æ¦‚ç‡ã€‚å¯ç”¨MTBF &#x2F;ï¼ˆ1 + MTBFï¼‰æ¥åº¦é‡ï¼ŒMTBFä¸ºå¹³å‡å¤±æ•ˆé—´éš”æ—¶é—´ã€‚</li><li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šåœ¨ç»™å®šçš„ä½¿ç”¨æ¡ä»¶ä¸‹ï¼Œåœ¨è§„å®šçš„æ—¶é—´é—´éš”å†…ï¼Œä½¿ç”¨è§„å®šçš„è¿‡ç¨‹å’Œèµ„æºå®Œæˆç»´æŠ¤æ´»åŠ¨çš„æ¦‚ç‡ã€‚å¯ç”¨ 1 &#x2F; ï¼ˆ1 + MTTRï¼‰æ¥åº¦é‡ï¼Œå…¶ä¸­MTTRä¸ºå¹³å‡ä¿®å¤æ—¶é—´ã€‚</li></ul><h4 id="Cacheä¸ä¸»å­˜çš„ä¸‰ç§åœ°å€æ˜ å°„æ–¹å¼"><a href="#Cacheä¸ä¸»å­˜çš„ä¸‰ç§åœ°å€æ˜ å°„æ–¹å¼" class="headerlink" title="Cacheä¸ä¸»å­˜çš„ä¸‰ç§åœ°å€æ˜ å°„æ–¹å¼"></a>Cacheä¸ä¸»å­˜çš„ä¸‰ç§åœ°å€æ˜ å°„æ–¹å¼</h4><ol><li><p>å…¨ç›¸è”æ˜ å°„</p><blockquote><p>Cache ä¸­çš„<strong>ä»»æ„</strong>ä¸€è¡Œå¯ä»¥å­˜æ”¾ä¸»å­˜ä¸­çš„<strong>ä»»æ„</strong>ä¸€å—</p></blockquote></li><li><p>ç›´æ¥æ˜ å°„</p><blockquote><p>ä¸»å­˜ä¸­æ¯ä¸ªåŒºçš„ç¬¬ i å—ä¼šæ˜ å°„åˆ°Cacheä¸­çš„ç¬¬ i è¡Œï¼Œä¸»å­˜ä¸­çš„æŸå—åªèƒ½æ˜ å°„åˆ°<strong>ç‰¹å®š</strong>çš„Cacheä¸€è¡Œä¸­</p></blockquote></li><li><p>ç»„ç›¸è”æ˜ å°„</p><blockquote><p>æ˜¯å…¨ç›¸è”æ˜ å°„ä¸ç›´æ¥æ˜ å°„ä¹‹é—´çš„æŠ˜ä¸­æ–¹å¼ï¼Œä¸»å­˜ä¸­çš„æŸå—å¯ä»¥æ˜ å°„åˆ°Cacheä¸€ç»„è¡Œä¸­çš„å…¶ä¸­ä¸€ä¸ªä¸Š</p></blockquote></li></ol><h4 id="IOè½¯ä»¶å±‚æ¬¡"><a href="#IOè½¯ä»¶å±‚æ¬¡" class="headerlink" title="IOè½¯ä»¶å±‚æ¬¡"></a>IOè½¯ä»¶å±‚æ¬¡</h4><p><img src="/img/post_img/IO%E8%BD%AF%E4%BB%B6%E5%B1%82%E6%AC%A1.png"></p><h4 id="è½¯ä»¶æµ‹è¯•é˜¶æ®µå’Œæµ‹è¯•ç­–ç•¥"><a href="#è½¯ä»¶æµ‹è¯•é˜¶æ®µå’Œæµ‹è¯•ç­–ç•¥" class="headerlink" title="è½¯ä»¶æµ‹è¯•é˜¶æ®µå’Œæµ‹è¯•ç­–ç•¥"></a>è½¯ä»¶æµ‹è¯•é˜¶æ®µå’Œæµ‹è¯•ç­–ç•¥</h4><p>æµ‹è¯•é˜¶æ®µ</p><ol><li>å•å…ƒæµ‹è¯•</li><li>é›†æˆæµ‹è¯•</li><li>ç³»ç»Ÿæµ‹è¯•</li></ol><p>æµ‹è¯•ç­–ç•¥</p><ul><li>è‡ªåº•å‘ä¸Šï¼šä»æœ€åº•å±‚çš„æ„å»ºå¼€å§‹æµ‹è¯•</li><li>è‡ªé¡¶å‘ä¸‹ï¼šä»æœ€é¡¶å±‚çš„æ„å»ºå¼€å§‹æµ‹è¯•</li><li>ä¸‰æ˜æ²»ï¼šç»“åˆè‡ªåº•å‘ä¸Šå’Œè‡ªé¡¶å‘ä¸‹</li><li>ä¸€æ¬¡æ€§ï¼šå¯¹æ‰€æœ‰æ„å»ºä¸€æ¬¡æ€§æµ‹è¯•ï¼Œç„¶åé›†æˆ</li></ul><h4 id="èŒƒå¼"><a href="#èŒƒå¼" class="headerlink" title="èŒƒå¼"></a>èŒƒå¼</h4><blockquote><p>å®Œå…¨ä¾èµ–ï¼šç”¨<strong>å€™é€‰ç </strong>ä¸­å…¨éƒ¨çš„å€¼æ‰èƒ½å†³å®š <strong>éä¸»å±æ€§</strong></p></blockquote><p>â€‹ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šæ‰€æœ‰çš„å±æ€§ä¸å¯å†åˆ†ï¼›</p><p>â€‹    ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šéé”®å±æ€§<strong>å®Œå…¨ä¾èµ–</strong>äºä¸»é”®ï¼›</p><p>â€‹    ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šéä¸»æ€§å±æ€§æ²¡æœ‰ä¼ é€’ä¾èµ–ï¼›</p><p>â€‹    BCNFï¼šä»»ä½•ä¸€ä¸ªå‡½æ•°ä¾èµ–ä¸­å†³å®šå› ç´ éƒ½æ˜¯å€™é€‰ç ï¼›</p><h4 id="é€’å½’å¤æ‚åº¦è®¡ç®—å…¬å¼"><a href="#é€’å½’å¤æ‚åº¦è®¡ç®—å…¬å¼" class="headerlink" title="é€’å½’å¤æ‚åº¦è®¡ç®—å…¬å¼"></a>é€’å½’å¤æ‚åº¦è®¡ç®—å…¬å¼</h4><p>T(N) &#x3D; a * T(N&#x2F;b) + O(N^d)</p><ol><li>å½“logb(a) &gt; d, O(N^logb(a))</li><li>å½“logb(a) &lt; d, O(N^d)</li><li>å½“logb(a) &#x3D; d, O(N^d * logN)</li></ol><h4 id="è®¡ç®—æœºç—…æ¯’"><a href="#è®¡ç®—æœºç—…æ¯’" class="headerlink" title="è®¡ç®—æœºç—…æ¯’"></a>è®¡ç®—æœºç—…æ¯’</h4><ul><li>æœ¨é©¬ç—…æ¯’ï¼šå†°æ²³</li><li>è •è™«ç—…æ¯’ï¼šæ¬¢ä¹æ—¶å…‰ã€ç†ŠçŒ«çƒ§é¦™ã€çº¢è‰²ä»£ç ã€çˆ±è™«ç—…æ¯’ã€éœ‡ç½‘</li><li>å®ç—…æ¯’ï¼šæ„ŸæŸ“çš„ä¸»è¦ç›®æ ‡æ˜¯æ–‡æœ¬æ–‡æ¡£ã€ç”µå­è¡¨æ ¼ç­‰</li></ul><h4 id="DHCPå®¢æˆ·ç«¯å¯ä»DHCPæœåŠ¡å™¨è·å¾—"><a href="#DHCPå®¢æˆ·ç«¯å¯ä»DHCPæœåŠ¡å™¨è·å¾—" class="headerlink" title="DHCPå®¢æˆ·ç«¯å¯ä»DHCPæœåŠ¡å™¨è·å¾—"></a>DHCPå®¢æˆ·ç«¯å¯ä»DHCPæœåŠ¡å™¨è·å¾—</h4><ul><li>æœ¬æœºIPåœ°å€ã€</li><li>DNSæœåŠ¡å™¨åœ°å€ã€</li><li>DHCPæœåŠ¡å™¨åœ°å€ã€</li><li>é»˜è®¤ç½‘å…³åœ°å€ï¼Œ</li><li>ä½†æ²¡æœ‰WebæœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨åœ°å€</li></ul><h4 id="å¤šæ€åˆ†ç±»"><a href="#å¤šæ€åˆ†ç±»" class="headerlink" title="å¤šæ€åˆ†ç±»"></a>å¤šæ€åˆ†ç±»</h4><ul><li><p><strong>å‚æ•°å¤šæ€</strong>ï¼šé‡‡ç”¨å‚æ•°åŒ–æ¨¡æ¿ï¼Œé€šè¿‡ç»™å‡ºä¸åŒçš„ç±»å‹å‚æ•°ï¼Œä½¿å¾—ä¸€ä¸ªç»“æ„æœ‰å¤šç§ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼šæ³›å‹</p></li><li><p><strong>åŒ…å«å¤šæ€</strong>ï¼šåŒæ ·çš„æ“ä½œå¯ç”¨äºä¸€ä¸ªç±»å‹åŠå…¶å­ç±»å‹ ï¼ˆé‡å†™ï¼‰</p></li><li><p><strong>è¿‡è½½å¤šæ€</strong>ï¼šåŒä¸€ä¸ªåï¼ˆæ“ä½œç¬¦ï¹‘å‡½æ•°åï¼‰åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­æœ‰ä¸åŒçš„ç±»å‹ ï¼ˆé‡è½½ï¼‰</p></li><li><p><strong>å¼ºåˆ¶å¤šæ€</strong>ï¼š<em>æŠŠæ“ä½œå¯¹è±¡çš„</em>ç±»å‹å¼ºè¡ŒåŠ ä»¥å˜æ¢ï¼Œä»¥ç¬¦åˆå‡½æ•°æˆ–æ“ä½œç¬¦çš„è¦æ±‚</p></li></ul><h4 id="Flynnåˆ†ç±»æ³•"><a href="#Flynnåˆ†ç±»æ³•" class="headerlink" title="Flynnåˆ†ç±»æ³•"></a>Flynnåˆ†ç±»æ³•</h4><ul><li>å•æŒ‡ä»¤æµå•æ•°æ®æµæœºå™¨ï¼ˆSISDï¼‰ä¼ ç»Ÿä¸²è¡Œæœºå™¨</li><li>å•æŒ‡ä»¤æµå¤šæ•°æ®æµæœºå™¨ï¼ˆSIMDï¼‰ä¸€æ¡æŒ‡ä»¤æµ</li><li>å¤šæŒ‡ä»¤æµå•æ•°æ®æµæœºå™¨ï¼ˆMISDï¼‰åªæœ‰ç†è®ºæ„ä¹‰è€Œæ— å®ä¾‹</li><li>å¤šæŒ‡ä»¤æµå¤šæ•°æ®æµæœºå™¨ï¼ˆSISDï¼‰åŒæ—¶å¤šä¸ªæŒ‡ä»¤æµ</li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è½¯ä»¶è¿‡ç¨‹æ¨¡å‹</title>
    <link href="/2022/08/25/%E8%BD%AF%E8%80%83/%E8%BD%AF%E4%BB%B6%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/"/>
    <url>/2022/08/25/%E8%BD%AF%E8%80%83/%E8%BD%AF%E4%BB%B6%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="è½¯ä»¶è¿‡ç¨‹æ¨¡å‹"><a href="#è½¯ä»¶è¿‡ç¨‹æ¨¡å‹" class="headerlink" title="è½¯ä»¶è¿‡ç¨‹æ¨¡å‹"></a>è½¯ä»¶è¿‡ç¨‹æ¨¡å‹</h2><h4 id="ç€‘å¸ƒæ¨¡å‹"><a href="#ç€‘å¸ƒæ¨¡å‹" class="headerlink" title="ç€‘å¸ƒæ¨¡å‹"></a>ç€‘å¸ƒæ¨¡å‹</h4><p><img src="/img/post_img/%E7%80%91%E5%B8%83%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p>åˆç§°ä¸ºç»å…¸ç”Ÿå‘½å‘¨æœŸæ¨¡å‹ï¼Œ<strong>ä»¥æ–‡æ¡£ä½œä¸ºé©±åŠ¨</strong>ã€é€‚åˆäºè½¯ä»¶éœ€æ±‚å¾ˆæ˜ç¡®çš„è½¯ä»¶é¡¹ç›®æˆ–äºŒæ¬¡å¼€å‘çš„æ¨¡å‹ã€‚</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>å®¹æ˜“ç†è§£ï¼Œç®¡ç†æˆæœ¬ä½ã€‚</li></ul><p>ç¼ºç‚¹:</p><ul><li>å¿…é¡»èƒ½å¤Ÿå®Œæ•´ã€æ­£ç¡®å’Œæ¸…æ™°åœ°è¡¨è¾¾éœ€è¦</li><li>å˜æ›´éœ€æ±‚å›°éš¾</li><li>å¾ˆéš¾è¯„ä¼°çœŸæ­£çš„è¿›åº¦</li><li>å¯¹äºé¡¹ç›®é£é™©çš„æ§åˆ¶èƒ½åŠ›è¾ƒå¼±ï¼Œä»è€Œå¯¼è‡´é¡¹ç›®å¸¸å¸¸å»¶æœŸå®Œæˆï¼Œå¼€å‘è´¹ç”¨è¶…å‡ºé¢„ç®—</li><li>ä»»åŠ¡ä¹‹é—´å­˜åœ¨ä¾èµ–æ€§ï¼Œå¼€å‘å›¢é˜Ÿçš„ä¸€äº›æˆå‘˜è¦ç­‰å¾…å¦ä¸€äº›æˆå‘˜å·¥ä½œå®Œæˆã€‚</li></ul><h5 id="Væ¨¡å‹"><a href="#Væ¨¡å‹" class="headerlink" title="Væ¨¡å‹"></a>Væ¨¡å‹</h5><p><img src="/img/post_img/V%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p>ç€‘å¸ƒæ¨¡å‹çš„ä¸€ä¸ªå˜ä½“ï¼Œå¼ºè°ƒåœ¨å„ä¸ªé˜¶æ®µè¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ï¼Œä»¥æå‡è½¯ä»¶è´¨é‡ã€‚</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>ç›¸è¾ƒäºç€‘å¸ƒæ¨¡å‹æå‡äº†è½¯ä»¶è´¨é‡</li></ul><p>ç¼ºç‚¹:</p><ul><li>æ›´è€—è´¹äººåŠ›å’Œæ—¶é—´</li></ul><h4 id="å¢é‡æ¨¡å‹"><a href="#å¢é‡æ¨¡å‹" class="headerlink" title="å¢é‡æ¨¡å‹"></a>å¢é‡æ¨¡å‹</h4><p><img src="/img/post_img/%E5%A2%9E%E9%87%8F%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p>å…ˆå¼€å‘å‡ºä¸€ä¸ªåˆå§‹çš„å®ç°ï¼Œå¬å–ç”¨æˆ·çš„ä½¿ç”¨æ„è§ï¼Œé€šè¿‡ä¸æ–­ä¿®æ”¹ç›´åˆ°äº§ç”Ÿä¸€ä¸ªå……åˆ†çš„ç‰ˆæœ¬</p><p>é€‚åˆå°å‹é¡¹ç›®æˆ–éœ€è¦å¿«é€Ÿä¸Šçº¿çš„é¡¹ç›®</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>å¯ä»¥æ›´ç»æµã€æ›´å®¹æ˜“ã€æ›´å¿«é€Ÿçš„å˜æ›´</li><li>äº¤ä»˜å’Œéƒ¨ç½²æ›´å¿«</li><li>ç”¨æˆ·å¯ä»¥æ›´æ—©çš„ä½¿ç”¨è½¯ä»¶å¹¶åˆ›é€ ä»·å€¼</li></ul><p>ç¼ºç‚¹:</p><ul><li>å¦‚æœæ²¡æœ‰å¯¹ç”¨æˆ·çš„å˜æ›´éœ€æ±‚è¿›è¡Œè§„åˆ’ï¼Œè‡´ç¼ºä¹æ•´ä½“è§„åˆ’ï¼Œå¯¼è‡´åŠŸèƒ½å †ç Œ</li><li>è¶Šå¾€åå˜æ›´è¶Šå›°éš¾ï¼Œæˆæœ¬é€æ¸ä¸Šå‡</li></ul><h4 id="æ¼”åŒ–æ¨¡å‹"><a href="#æ¼”åŒ–æ¨¡å‹" class="headerlink" title="æ¼”åŒ–æ¨¡å‹"></a>æ¼”åŒ–æ¨¡å‹</h4><h5 id="åŸå‹æ¨¡å‹"><a href="#åŸå‹æ¨¡å‹" class="headerlink" title="åŸå‹æ¨¡å‹"></a>åŸå‹æ¨¡å‹</h5><p><img src="/img/post_img/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p>ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„æœ€åˆç‰ˆæœ¬ï¼Œç”¨äºéªŒè¯æ¦‚å¿µã€é€‚ç”¨è®¾è®¡é€‰å‹ã€å‘ç°æ›´å¤šçš„é—®é¢˜å’Œå¯èƒ½çš„è§£å†³æ–¹æ³•ã€‚</p><p>åŸå‹æ˜¯ä¸ºå®šä¹‰éœ€æ±‚æœåŠ¡çš„ï¼Œåœ¨éœ€æ±‚æ˜ç¡®åï¼ŒåŸå‹éœ€è¦ä¸¢å¼ƒï¼ˆè‡³å°‘éƒ¨åˆ†ä¸¢å¼ƒï¼‰ã€‚</p><p>é€‚ç”¨äºéœ€æ±‚ä¸æ˜ç¡®æ—¶</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>æœ‰åŠ©äºå¯å‘å’ŒéªŒè¯ç³»ç»Ÿéœ€æ±‚</li></ul><p>ç¼ºç‚¹:</p><ul><li>å¼€å‘å¿«æ²¡æœ‰æ–‡æ¡£ï¼Œä¸åˆ©äºç»´æŠ¤</li><li>å®¹æ˜“å¿½ç•¥æ€§èƒ½ã€å®‰å…¨ã€å¯é æ€§ç­‰è¦ç´ </li></ul><h5 id="èºæ—‹æ¨¡å‹"><a href="#èºæ—‹æ¨¡å‹" class="headerlink" title="èºæ—‹æ¨¡å‹"></a>èºæ—‹æ¨¡å‹</h5><p><img src="/img/post_img/%E8%9E%BA%E6%97%8B%E6%A8%A1%E5%9E%8B.png"></p><p>å°†è¿‡ç¨‹ï¼ˆé¡¹ç›®é˜¶æ®µï¼‰ç”¨èºæ—‹çº¿è¡¨ç¤ºï¼Œæ¯ä¸ªèºæ—‹çº¿æ„æˆä¸€ä¸ªå›è·¯ï¼Œæ¯ä¸ªå›è·¯ç”±ä¸åŒçš„é£é™©é©±åŠ¨ï¼Œæ ¹æ®è¿™äº›é£é™©ï¼Œåœ¨æ¯ä¸ªé˜¶æ®µè§„åˆ’å¯é€‰çš„ç­–ç•¥æ–¹æ¡ˆã€‚</p><blockquote><p>æ˜¯ä¸€ç§<strong>é£é™©é©±åŠ¨</strong>å‹çš„è¿‡ç¨‹æ¨¡å‹</p><p>ç»“åˆäº†åŸå‹çš„è¿­ä»£æ€§è´¨å’Œç€‘å¸ƒæ¨¡å‹çš„ç³»ç»Ÿæ€§å’Œå¯æ§æ€§ç‰¹ç‚¹ã€‚</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>å®ç°é£é™©ç®¡ç†ï¼Œé™ä½å˜æ›´é£é™©</li><li>æ”¯æŒç”¨æˆ·éœ€æ±‚çš„åŠ¨æ€å˜åŒ–</li></ul><p>ç¼ºç‚¹:</p><ul><li>éœ€è¦å¼€å‘äººå‘˜å…·æœ‰ç›¸å½“ä¸°å¯Œçš„é£é™©è¯„ä¼°ç»éªŒå’Œä¸“é—¨çŸ¥è¯†</li><li>è¿‡å¤šçš„è¿­ä»£æ¬¡æ•°ä¼šå¢åŠ å¼€å‘æˆæœ¬ï¼Œå»¶è¿Ÿæäº¤æ—¶é—´</li></ul><h4 id="å–·æ³‰æ¨¡å‹"><a href="#å–·æ³‰æ¨¡å‹" class="headerlink" title="å–·æ³‰æ¨¡å‹"></a>å–·æ³‰æ¨¡å‹</h4><p><img src="/img/post_img/%E5%96%B7%E6%B3%89%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p><strong>ä»¥ç”¨æˆ·éœ€æ±‚ä¸ºåŠ¨åŠ›ï¼Œä»¥å¯¹è±¡ä½œä¸ºé©±åŠ¨</strong>çš„æ¨¡å‹ï¼Œé€‚åˆäº<strong>é¢å‘å¯¹è±¡</strong>çš„å¼€å‘æ–¹æ³•</p><p>è¯¥æ¨¡å‹è®¤ä¸ºè½¯ä»¶å¼€å‘è¿‡ç¨‹è‡ªä¸‹è€Œä¸Šå‘¨æœŸçš„å„é˜¶æ®µæ˜¯ç›¸äº’è¿­ä»£å’Œæ— é—´éš™çš„</p></blockquote><p>ä¼˜ç‚¹:</p><ul><li>åŠŸèƒ½éœ€æ±‚ã€åŠŸèƒ½æ¨¡å—é—´çš„å…³ç³»ã€æ•°æ®æµç­‰æè¿°æ¸…æ¥š</li></ul><p>ç¼ºç‚¹:</p><ul><li>å¼€å‘é˜¶æ®µæ˜¯é‡å çš„ï¼Œå¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å¤§é‡çš„å¼€å‘äººå‘˜ï¼Œä¸åˆ©äºé¡¹ç›®çš„ç®¡ç†ã€‚</li><li>éœ€è¦ä¸¥æ ¼çš„ç®¡ç†æ–‡æ¡£ï¼Œä½¿å¾—å®¡æ ¸çš„éš¾åº¦åŠ å¤§ã€‚</li></ul><h4 id="åŸºäºæ„ä»¶çš„å¼€å‘æ¨¡å‹"><a href="#åŸºäºæ„ä»¶çš„å¼€å‘æ¨¡å‹" class="headerlink" title="åŸºäºæ„ä»¶çš„å¼€å‘æ¨¡å‹"></a>åŸºäºæ„ä»¶çš„å¼€å‘æ¨¡å‹</h4><p><img src="/img/post_img/%E5%9F%BA%E4%BA%8E%E6%9E%84%E4%BB%B6%E7%9A%84%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B.png"></p><blockquote><p>åˆ©ç”¨é¢„å…ˆåŒ…è£…çš„æ„ä»¶æ¥æ„é€ åº”ç”¨ç³»ç»Ÿ</p><p><strong>å¿«é€Ÿå¼€å‘</strong></p><p>æœ¬è´¨ä¸Šæ˜¯æ¼”åŒ–æ¨¡å‹ï¼Œéœ€è¦ä»¥è¿­ä»£æ–¹å¼æ„å»ºè½¯ä»¶</p></blockquote><h4 id="å½¢å¼åŒ–æ–¹æ³•æ¨¡å‹"><a href="#å½¢å¼åŒ–æ–¹æ³•æ¨¡å‹" class="headerlink" title="å½¢å¼åŒ–æ–¹æ³•æ¨¡å‹"></a>å½¢å¼åŒ–æ–¹æ³•æ¨¡å‹</h4><blockquote><p>å»ºç«‹åœ¨<strong>ä¸¥æ ¼æ•°å­¦åŸºç¡€ä¸Š</strong>çš„ä¸€ç§è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œå…¶ä¸»è¦æ´»åŠ¨æ˜¯ç”Ÿæˆè®¡ç®—æœºè½¯ä»¶å½¢å¼åŒ–çš„æ•°å­¦è§„æ ¼è¯´æ˜ã€‚</p></blockquote><h4 id="æ•æ·æ–¹æ³•"><a href="#æ•æ·æ–¹æ³•" class="headerlink" title="æ•æ·æ–¹æ³•"></a>æ•æ·æ–¹æ³•</h4><h5 id="æé™ç¼–ç¨‹-XP"><a href="#æé™ç¼–ç¨‹-XP" class="headerlink" title="æé™ç¼–ç¨‹(XP)"></a>æé™ç¼–ç¨‹(XP)</h5><blockquote><p>æé™æ˜¯æŒ‡å°†æˆ‘ä»¬è®¤åŒçš„æœ‰æ•ˆè½¯ä»¶å¼€å‘åŸç†å’Œå®è·µåº”ç”¨åˆ°æé™ï¼Œ<strong>é¢‘ç¹åœ°å»å®è·µ</strong></p><p>å°½å¯èƒ½æ—©åœ°ã€æŒç»­åœ°å¯¹æœ‰ä»·å€¼çš„è½¯ä»¶çš„äº¤ä»˜æ¥ä½¿å®¢æˆ·æ»¡æ„</p><p>ä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨å‘å¼€å‘¨æœŸåæœŸæ”¹å˜éœ€æ±‚</p><p>æç«¯ç¼–ç¨‹å±äºè½»é‡çº§çš„æ–¹æ³•ï¼Œè®¤ä¸ºæ–‡æ¡£ã€æ¶æ„ä¸å¦‚ç›´æ¥ç¼–ç¨‹æ¥çš„ç›´æ¥</p></blockquote><h5 id="æ°´æ™¶æ³•"><a href="#æ°´æ™¶æ³•" class="headerlink" title="æ°´æ™¶æ³•"></a>æ°´æ™¶æ³•</h5><blockquote><p>è®¤ä¸ºæ¯ä¸€ä¸ªä¸åŒçš„é¡¹ç›®éƒ½éœ€è¦ä¸€å¥—ä¸åŒçš„ç­–ç•¥</p></blockquote><h5 id="å¹¶åˆ—äº‰æ±‚æ³•"><a href="#å¹¶åˆ—äº‰æ±‚æ³•" class="headerlink" title="å¹¶åˆ—äº‰æ±‚æ³•"></a>å¹¶åˆ—äº‰æ±‚æ³•</h5><h5 id="è‡ªé€‚åº”è½¯ä»¶å¼€å‘"><a href="#è‡ªé€‚åº”è½¯ä»¶å¼€å‘" class="headerlink" title="è‡ªé€‚åº”è½¯ä»¶å¼€å‘"></a>è‡ªé€‚åº”è½¯ä»¶å¼€å‘</h5>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¥å£ç®¡ç†</title>
    <link href="/2022/08/21/%E5%85%B6%E4%BB%96/%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/"/>
    <url>/2022/08/21/%E5%85%B6%E4%BB%96/%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¥å£ç®¡ç†"><a href="#æ¥å£ç®¡ç†" class="headerlink" title="æ¥å£ç®¡ç†"></a>æ¥å£ç®¡ç†</h2><h4 id="YApi"><a href="#YApi" class="headerlink" title="YApi"></a>YApi</h4><blockquote><p>ä¸€æ¬¾apiç®¡ç†å¹³å°</p></blockquote><p><a href="https://github.com/YMFE/yapi">æºç åœ°å€</a></p><p>å®‰è£…æ¯”è¾ƒéº»çƒ¦ï¼Œå’ŒapifoxåŠŸèƒ½å·®ä¸å¤š</p><h4 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h4><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Swagger-UI APIæ–‡æ¡£ç”Ÿäº§å·¥å…·--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Swagger2Config</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>            .apiInfo(apiInfo())<br>            .select()<br>            <span class="hljs-comment">//ä¸ºå½“å‰åŒ…ä¸‹controllerç”ŸæˆAPIæ–‡æ¡£</span><br>            .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.xw.mallLearning.controller&quot;</span>))<br>            <span class="hljs-comment">//ä¸ºæœ‰@Apiæ³¨è§£çš„Controllerç”ŸæˆAPIæ–‡æ¡£</span><br>            <span class="hljs-comment">//                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br>            <span class="hljs-comment">//ä¸ºæœ‰@ApiOperationæ³¨è§£çš„æ–¹æ³•ç”ŸæˆAPIæ–‡æ¡£</span><br>            <span class="hljs-comment">//                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))</span><br>            .paths(PathSelectors.any())<br>            .build();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>            .title(<span class="hljs-string">&quot;SwaggerUI&quot;</span>)<br>            .description(<span class="hljs-string">&quot;mall-learning&quot;</span>)<br>            .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>            .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å½“swaggerç‰ˆæœ¬å¤§äº2.6.xä¸”springBootç‰ˆæœ¬ä¹Ÿè¾ƒé«˜(æˆ‘æµ‹è¯•æ—¶æ˜¯2.7.8)æ—¶ï¼Œéœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ ä»¥ä¸‹Beanå’Œé…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BeanPostProcessor <span class="hljs-title function_">springfoxHandlerProviderBeanPostProcessor</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPostProcessor</span>() &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>            <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> WebMvcRequestHandlerProvider) &#123;<br>                customizeSpringfoxHandlerMappings(getHandlerMappings(bean));<br>            &#125;<br>            <span class="hljs-keyword">return</span> bean;<br>        &#125;<br><br>        <span class="hljs-keyword">private</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestMappingInfoHandlerMapping</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">customizeSpringfoxHandlerMappings</span><span class="hljs-params">(List&lt;T&gt; mappings)</span> &#123;<br>            List&lt;T&gt; copy = mappings.stream()<br>                .filter(mapping -&gt; mapping.getPatternParser() == <span class="hljs-literal">null</span>)<br>                .collect(Collectors.toList());<br>            mappings.clear();<br>            mappings.addAll(copy);<br>        &#125;<br><br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>        <span class="hljs-keyword">private</span> List&lt;RequestMappingInfoHandlerMapping&gt; <span class="hljs-title function_">getHandlerMappings</span><span class="hljs-params">(Object bean)</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> ReflectionUtils.findField(bean.getClass(), <span class="hljs-string">&quot;handlerMappings&quot;</span>);<br>                field.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">return</span> (List&lt;RequestMappingInfoHandlerMapping&gt;) field.get(bean);<br>            &#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException | IllegalAccessException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(e);<br>            &#125;<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">pathmatch:</span><br>      <span class="hljs-attr">matching-strategy:</span> <span class="hljs-string">ant_path_matcher</span><br></code></pre></td></tr></table></figure></li></ol><p><strong>å¸¸ç”¨æ³¨è§£</strong></p><p>ä½¿æ–‡æ¡£è¯´æ˜æ›´åŠ æ˜“è¯»</p><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@Api</td><td>ç”¨åœ¨è¯·æ±‚ç±»ä¸Š(å¦‚Controller)ï¼Œè¡¨ç¤ºå¯¹ç±»çš„è¯´æ˜</td></tr><tr><td>@ApiModel</td><td>ç”¨åœ¨å®ä½“ç±»ä¸Šï¼Œè¡¨ç¤ºè¿”å›å“åº”æ•°æ®çš„ä¿¡æ¯</td></tr><tr><td>@ApiModelProperty</td><td>ç”¨åœ¨å®ä½“ç±»å±æ€§ä¸Š</td></tr><tr><td>@ApiOperation</td><td>ç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¯´æ˜æ–¹æ³•çš„ç”¨é€”</td></tr><tr><td>@ApiImplicitParams</td><td>ç”¨åœ¨è¯·æ±‚çš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºä¸€ç»„å‚æ•°çš„è¯´æ˜</td></tr><tr><td>@ApiImplicitParam</td><td>ç”¨åœ¨@ApiImplicitParamsä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªå‚æ•°çš„å„ä¸ªæ–¹é¢</td></tr></tbody></table><h4 id="knife4j"><a href="#knife4j" class="headerlink" title="knife4j"></a>knife4j</h4><blockquote><p>ç”¨æ¥ç”Ÿæˆå„ç§æ ¼å¼çš„æ¥å£æ–‡æ¡£</p></blockquote><p>knife4jæ˜¯é›†æˆswaggerç”Ÿæˆapiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆ</p><p><strong>ä½¿ç”¨æ­¥éª¤</strong></p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>å¯¼å…¥é…ç½®ç±»</p><p>åœ¨mvcé…ç½®ç±»ä¸ŠåŠ å…¥ä¸¤ä¸ªæ³¨è§£å¹¶æ„å»ºcreateRestApiæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-meta">@EnableKnife4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfigSupport</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebMvcConfigurationSupport</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                .select()<br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.xw.reggie.controller&quot;</span>))<br>                .paths(PathSelectors.any())<br>                .build();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;ç‘å‰å¤–å–&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .description(<span class="hljs-string">&quot;ç‘å‰å¤–ç æ¥å£æ–‡æ¡£&quot;</span>)<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨mvcé…ç½®ç±»çš„addResourceHandlersæ–¹æ³•ä¸­è®¾ç½®é™æ€èµ„æºæ˜ å°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">registry.addResourceHandler(<span class="hljs-string">&quot;doc.html&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>);<br>registry.addResourceHandler(<span class="hljs-string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœæœ‰ç™»å½•çŠ¶æ€æ£€æµ‹çš„è¯è¦è®¾ç½®æ”¾è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ”¾è¡Œçš„è·¯å¾„</span><br><span class="hljs-string">&quot;/doc.html&quot;</span>,<br><span class="hljs-string">&quot;/webjars/**&quot;</span>,<br><span class="hljs-string">&quot;/swagger-resources&quot;</span>,<br><span class="hljs-string">&quot;/v2/api-docs&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®<code>http://localhost:8080/doc.html</code>å¯ä»¥æŸ¥çœ‹æ¥å£å’Œå¯¼å‡ºç¦»çº¿æ–‡æ¡£</p></li></ol><p><img src="/img/post_img/6452456.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å…¶ä»–</category>
      
      <category>æ¥å£ç®¡ç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
      <tag>åç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx</title>
    <link href="/2022/08/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/"/>
    <url>/2022/08/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/</url>
    
    <content type="html"><![CDATA[<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§WebæœåŠ¡å™¨&#x2F;åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå ç”¨å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼º</p><h4 id="ä¸‹è½½å’Œå®‰è£…"><a href="#ä¸‹è½½å’Œå®‰è£…" class="headerlink" title="ä¸‹è½½å’Œå®‰è£…"></a>ä¸‹è½½å’Œå®‰è£…</h4><h5 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h5><ol><li><p><a href="http://nginx.org/en/download.html">å®˜ç½‘ä¸‹è½½</a></p><p><a href="http://nginx.org/download/">è€ç‰ˆæœ¬ä¸‹è½½</a></p></li><li><p>å®‰è£…ä¾èµ–åŒ…</p><blockquote><p><strong>GCCç¼–è¯‘å™¨</strong>ï¼šNginxæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå› æ­¤æƒ³è¦è¿è¡ŒNginxå°±éœ€è¦å®‰è£…ä¸€ä¸ªç¼–è¯‘å·¥å…·ã€‚GCCå°±æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨é›†åˆï¼Œç”¨äºå¤„ç†å„ç§å„æ ·çš„è¯­è¨€ï¼Œå…¶ä¸­å°±åŒ…å«äº†Cè¯­è¨€ã€‚</p><p><strong>PCRE</strong>ï¼šNginxåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ°PCREåº“ï¼ˆperl Compatible Regular Expressoin å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“)ï¼Œå› ä¸ºåœ¨Nginxçš„Rewriteæ¨¡å—å’Œhttpæ ¸å¿ƒæ¨¡å—éƒ½ä¼šä½¿ç”¨åˆ°PCREæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚</p><p><strong>zlib</strong>ï¼šåœ¨Nginxçš„å„ä¸ªæ¨¡å—ä¸­éœ€è¦ä½¿ç”¨gzipå‹ç¼©</p><p><strong>OpenSSL</strong>ï¼šæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶åº“åŒ…ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œå¹¶ä¸”é¿å…è¢«çªƒå¬ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs linux"># -yè¡¨ç¤ºéœ€è¦ç”¨æˆ·ç¡®è®¤çš„åœ°æ–¹é»˜è®¤yes<br>yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel<br></code></pre></td></tr></table></figure></li><li><p>è§£å‹nginxå®‰è£…åŒ…</p><blockquote><p>æœ€å¥½æ”¾åˆ°ä¸€ä¸ªç‰¹å®šçš„ç›®å½•ä¸‹ç®¡ç†ï¼Œä»¥ååˆ é™¤è¿˜éœ€è¦</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">tar -zxvf nginx-1.16.1.tar.gz<br></code></pre></td></tr></table></figure></li><li><p>è¿›å…¥ç›®å½•æ‰§è¡Œå‘½ä»¤æ¥å®‰è£…nginx</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gauss">æ£€æŸ¥ç¯å¢ƒï¼Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®å®‰è£…åˆ°å“ª<br>./configure --prefix=å®‰è£…è·¯å¾„<br>ç¼–è¯‘å®‰è£…<br><span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure></li></ol><h5 id="yumå®‰è£…"><a href="#yumå®‰è£…" class="headerlink" title="yumå®‰è£…"></a>yumå®‰è£…</h5><blockquote><p>ç›¸æ¯”æºç å®‰è£…ï¼Œä¼šæ·»åŠ æœ‰å¾ˆå¤šé¢å¤–çš„é…ç½®ä¿¡æ¯</p></blockquote><ol><li><p>é€šè¿‡yumè¿›è¡Œå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y nginx<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å®‰è£…çš„ç›®å½•</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">whereis nginx</span><br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># é»˜è®¤å®‰è£…åˆ°äº†<span class="hljs-regexp">/usr/</span>sbinï¼Œé…ç½®æ–‡ä»¶åœ¨<span class="hljs-regexp">/etc/</span>ngin/nginx.conf<br>cd <span class="hljs-regexp">/usr/</span>sbin<br># å¯åŠ¨<br>./nginx<br></code></pre></td></tr></table></figure></li></ol><h4 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h4><h5 id="æºç æ–¹å¼"><a href="#æºç æ–¹å¼" class="headerlink" title="æºç æ–¹å¼"></a>æºç æ–¹å¼</h5><ol><li><p>åœæ­¢nginx</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">./nginx -s stop<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤nginxæ–‡ä»¶å¤¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf nginx/<br></code></pre></td></tr></table></figure></li><li><p>åˆ°ä¹‹å‰è§£å‹å‡ºæ¥çš„æºç ç›®å½•ä¸‹</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make clean</span><br></code></pre></td></tr></table></figure></li></ol><h5 id="yumæ–¹å¼"><a href="#yumæ–¹å¼" class="headerlink" title="yumæ–¹å¼"></a>yumæ–¹å¼</h5><ol><li><p>åœæ­¢nginx</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">./nginx -s stop<br>service nginx stop<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤nginxè‡ªåŠ¨å¯åŠ¨</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">chkconfig</span> nginx <span class="hljs-literal">off</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤nginxæœ¬åœ°æ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm -rf <span class="hljs-regexp">/usr/</span>sbin/nginx<br>rm -rf <span class="hljs-regexp">/etc/</span>nginx<br>rm -rf <span class="hljs-regexp">/etc/i</span>nit.d/nginx<br></code></pre></td></tr></table></figure></li><li><p>yumæ¸…ç†</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">yum <span class="hljs-built_in">remove</span> nginx<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><ul><li>conf&#x2F;nginx.confnginxé…ç½®æ–‡ä»¶</li><li>conf&#x2F;mime.types  HTTPåè®®ä¸­Content-Typeçš„å€¼å’Œæ–‡ä»¶åç¼€åå¯¹åº”å…³ç³»</li><li>html                        å­˜æ”¾é™æ€æ–‡ä»¶</li><li>logs                         å­˜æ”¾æ—¥å¿—</li><li>sbin                         äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºå¯åŠ¨ã€åœæ­¢nginx</li></ul><h4 id="å¯åŠ¨-x2F-å…³é—­æ–¹å¼"><a href="#å¯åŠ¨-x2F-å…³é—­æ–¹å¼" class="headerlink" title="å¯åŠ¨&#x2F;å…³é—­æ–¹å¼"></a>å¯åŠ¨&#x2F;å…³é—­æ–¹å¼</h4><h5 id="ä¿¡å·æ§åˆ¶æ–¹å¼"><a href="#ä¿¡å·æ§åˆ¶æ–¹å¼" class="headerlink" title="ä¿¡å·æ§åˆ¶æ–¹å¼"></a>ä¿¡å·æ§åˆ¶æ–¹å¼</h5><table><thead><tr><th>ä¿¡å·</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>TERM&#x2F;INT</td><td>ç«‹å³å…³é—­æ•´ä¸ªæœåŠ¡</td></tr><tr><td>QUIT</td><td>â€œä¼˜é›…â€åœ°å…³é—­æ•´ä¸ªæœåŠ¡</td></tr><tr><td>HUP</td><td>é‡è¯»é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨æœåŠ¡å¯¹æ–°é…ç½®é¡¹ç”Ÿæ•ˆ</td></tr><tr><td>USR1</td><td>é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥å¿—åˆ‡å‰²</td></tr><tr><td>USR2</td><td>å¹³æ»‘å‡çº§åˆ°æœ€æ–°ç‰ˆçš„nginx</td></tr><tr><td>WINCH</td><td>æ‰€æœ‰å­è¿›ç¨‹ä¸åœ¨æ¥æ”¶å¤„ç†æ–°è¿æ¥ï¼Œç›¸å½“äºç»™workè¿›ç¨‹å‘é€QUITæŒ‡ä»¤</td></tr></tbody></table><p> é€šè¿‡<code>kill -signal PID</code>æ¥ä½¿ç”¨</p><h5 id="å‘½ä»¤æ–¹å¼"><a href="#å‘½ä»¤æ–¹å¼" class="headerlink" title="å‘½ä»¤æ–¹å¼"></a>å‘½ä»¤æ–¹å¼</h5><p><code>./nginx -h</code> æŸ¥çœ‹æ‰€æœ‰å‚æ•°</p><p><code>-t</code>ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯</p><p><code>-s</code>ï¼šsignalä¿¡å·ï¼Œåé¢å¯ä»¥è·Ÿstop[å¿«é€Ÿå…³é—­]ã€quit[ä¼˜é›…å…³é—­]ã€reopen[é‡æ–°åŠ è½½æ—¥å¿—æ–‡ä»¶]ã€reload[é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶]</p><p><code>-c</code>ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶</p><h4 id="å¹³æ»‘å‡çº§"><a href="#å¹³æ»‘å‡çº§" class="headerlink" title="å¹³æ»‘å‡çº§"></a>å¹³æ»‘å‡çº§</h4><p>ä¸éœ€è¦åœæ­¢nginxæœåŠ¡å™¨å°±å¯ä»¥å‡çº§ç‰ˆæœ¬</p><ol><li><p>å‡†å¤‡ä¸¤ä¸ªç‰ˆæœ¬çš„Nginxåˆ†åˆ«æ˜¯ 1.14.2å’Œ1.16.1ï¼Œ1.14.2çš„ç¼–è¯‘å®‰è£…ï¼Œ1.16.1çš„åªéœ€è¦ç¼–è¯‘</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-meta"># 1.14.2</span><br>./configure<br><span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install<br><span class="hljs-meta"># 1.16.1</span><br>./configure<br><span class="hljs-built_in">make</span><br></code></pre></td></tr></table></figure></li><li><p>é¦–å…ˆå¤‡ä»½è€ç‰ˆæœ¬çš„nginxä¸‹çš„<code>sbin/nginx</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br>mv nginx nginxold<br></code></pre></td></tr></table></figure></li><li><p>æ‹·è´æ–°ç‰ˆæœ¬çš„nginxçš„<code>/objs/nginx</code>åˆ°è€ç‰ˆæœ¬nginxçš„<code>sbin/</code>ç›®å½•ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd ~<span class="hljs-regexp">/nginx/</span>core<span class="hljs-regexp">/nginx-1.16.1/</span>objs<br>cp nginx <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ<code>make upgrade</code>è¿›è¡Œå‡çº§</p></li><li><p><code>./nginx -v</code>æŸ¥çœ‹ç‰ˆæœ¬</p></li></ol><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs linux">nginxç›®å½•ä¸‹<br><br>1.æŸ¥çœ‹nginxç‰ˆæœ¬<br>./sbin/nginx -v<br><br>2.æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™<br>./sbin/nginx -t<br><br>3.å¯åŠ¨nginxæœåŠ¡<br>./sbin/nginx<br><br>4.åœæ­¢nginxæœåŠ¡<br>./sbin/nginx -s stop<br><br>5.ä¿®æ”¹è¿‡é…ç½®æ–‡ä»¶åï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶<br>./sbin/nginx -s reload<br></code></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>åˆ†ä¸ºä¸‰å¤§å—ï¼šå…¨å±€å—ã€eventså—ã€httpå—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs conf">worker_processes  1;<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    sendfile        on;<br>    keepalive_timeout  65;<br><br>    server &#123;<br>        listen       80;<br>        # æ”¯æŒæ­£åˆ™ï¼Œä»¥~å¼€å¤´ï¼Œå¦‚:~^www\.\w+\.com;<br>        server_name  localhost;<br>        location / &#123;<br>            root   html;<br>            index  index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å…¨å±€å—"><a href="#å…¨å±€å—" class="headerlink" title="å…¨å±€å—"></a>å…¨å±€å—</h5><h6 id="useræŒ‡ä»¤"><a href="#useræŒ‡ä»¤" class="headerlink" title="useræŒ‡ä»¤"></a>useræŒ‡ä»¤</h6><p>æŒ‡å®šå¯åŠ¨è¿è¡Œå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·åŠç”¨æˆ·ç»„ï¼Œè¿™æ ·å¯¹äºç³»ç»Ÿçš„æƒé™è®¿é—®æ§åˆ¶çš„æ›´åŠ ç²¾ç»†ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p><ol><li><p>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">user</span> <span class="hljs-title">www</span>;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªlinuxç”¨æˆ·</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">useradd www</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»º<code>/home/www/html/index.html</code> æ–‡ä»¶ï¼Œåœ¨wwwç”¨æˆ·ç›®å½•ä¸‹ç”¨æˆ·æœ‰è®¿é—®æƒé™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>;</span><br><span class="language-css">        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">        <span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>For online documentation and support please refer to<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Commercial support is available at<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Thank you for using nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>I am WWW<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®ï¼Œæµ‹è¯•è®¿é—®</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">location</span> / &#123;<br>root   /home/www/html;<br><span class="hljs-keyword">index</span>  <span class="hljs-keyword">index</span>.html <span class="hljs-keyword">index</span>.htm;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h6 id="work-processæŒ‡ä»¤"><a href="#work-processæŒ‡ä»¤" class="headerlink" title="work processæŒ‡ä»¤"></a>work processæŒ‡ä»¤</h6><ol><li><code>master_process on|off</code>ï¼šç”¨æ¥æŒ‡å®šæ˜¯å¦å¼€å¯<strong>å·¥ä½œè¿›ç¨‹</strong>ï¼Œé»˜è®¤on</li><li><code>worker_processes num/auto</code>ï¼šé…ç½®Nginxç”Ÿæˆå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œå»ºè®®å°†è¯¥å€¼å’ŒæœåŠ¡å™¨CPUçš„å†…æ ¸æ•°ä¿å­˜ä¸€è‡´</li></ol><blockquote><p>è¿™ä¸¤ä¸ªé…ç½®å®Œè¦åœæ­¢nginxå†å¯åŠ¨æ‰ä¼šç”Ÿæ•ˆ</p></blockquote><h6 id="å…¶ä»–æŒ‡ä»¤"><a href="#å…¶ä»–æŒ‡ä»¤" class="headerlink" title="å…¶ä»–æŒ‡ä»¤"></a>å…¶ä»–æŒ‡ä»¤</h6><table><thead><tr><th>æŒ‡ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>daemon on|off</td><td>è®¾å®šNginxæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼Œé»˜è®¤on</td></tr><tr><td>pid file</td><td>é…ç½®Nginxå½“å‰masterè¿›ç¨‹çš„è¿›ç¨‹å·IDå­˜å‚¨çš„æ–‡ä»¶è·¯å¾„</td></tr><tr><td>error_log  file [æ—¥å¿—çº§åˆ«]</td><td>é…ç½®Nginxçš„é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—çº§åˆ«è¶Šä½æ˜¾ç¤ºçš„ä¿¡æ¯è¶Šå¤š</td></tr><tr><td>include file</td><td>å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶</td></tr></tbody></table><h5 id="eventså—"><a href="#eventså—" class="headerlink" title="eventså—"></a>eventså—</h5><p>ä¸»è¦ç”¨æ¥è®¾ç½®nginxå’Œç”¨æˆ·çš„ç½‘ç»œè¿æ¥</p><table><thead><tr><th>æŒ‡ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>accept_mutex on|off</td><td>è®¾ç½®Nginxç½‘ç»œè¿æ¥åºåˆ—åŒ–ã€‚offæ—¶ä¸ºå½“æ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œä¼šå”¤é†’å¤šä¸ªworkeræ¥ç«äº‰; onæ—¶åˆ™å°†ä¼šå¯¹å¤šä¸ªNginxè¿›ç¨‹æ¥æ”¶è¿æ¥è¿›è¡Œåºåˆ—å·ï¼Œä¸€ä¸ªä¸ªæ¥å”¤é†’æ¥æ”¶</td></tr><tr><td>multi_accept on|off</td><td>è®¾ç½®ä¸€ä¸ªå·¥ä½œè¿›ç¨‹æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</td></tr><tr><td>worker_connections number</td><td>é…ç½®å•ä¸ªworkerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•°ï¼Œé»˜è®¤512</td></tr><tr><td>use  method</td><td>è®¾ç½®NginxæœåŠ¡å™¨é€‰æ‹©å“ªç§äº‹ä»¶é©±åŠ¨æ¥å¤„ç†ç½‘ç»œæ¶ˆæ¯ï¼Œselect&#x2F;poll&#x2F;epoll&#x2F;kqueue</td></tr></tbody></table><p>ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs conf">events &#123;<br>    accept_mutex on;<br>    multi_accept on;<br>    use epoll;<br>    worker_connections  1024;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="httpå—"><a href="#httpå—" class="headerlink" title="httpå—"></a>httpå—</h5><h6 id="æŒ‡å®šMIME-Type"><a href="#æŒ‡å®šMIME-Type" class="headerlink" title="æŒ‡å®šMIME-Type"></a>æŒ‡å®šMIME-Type</h6><p>é€šè¿‡<code>default_type mime-type;</code>æ¥æŒ‡å®šè¿”å›æ•°æ®çš„ç±»å‹ï¼Œå¯ä»¥é…ç½®åœ¨httpã€serverã€locationä¸­</p><p>ä¾‹å­</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/get_text</span> &#123;<br><span class="hljs-comment">#è¿™é‡Œä¹Ÿå¯ä»¥è®¾ç½®æˆtext/plain</span><br>    default_type text/html;<br>    return <span class="hljs-number">200</span> <span class="hljs-string">&quot;This is nginx&#x27;s text&quot;</span>;<br>&#125;<br><span class="hljs-keyword">location</span> <span class="hljs-title">/get_json</span>&#123;<br>    default_type application/json;<br>    return <span class="hljs-number">200</span> &#x27;&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;TOM&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>&#125;&#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"><a href="#è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—" class="headerlink" title="è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—"></a>è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—</h6><table><thead><tr><th>æŒ‡ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>access_log path [format]</td><td>è®¾è®¡ç”¨æˆ·è®¿é—®è¯·æ±‚æ—¥å¿—çš„ä½ç½®ï¼Œåé¢å¯ä»¥è·Ÿæ—¥å¿—è¾“å‡ºæ ¼å¼</td></tr><tr><td>log_format name</td><td>æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºæ ¼å¼</td></tr><tr><td>sendfile on|off</td><td>æ˜¯å¦ä½¿ç”¨sendfile()ä¼ è¾“æ–‡ä»¶ï¼Œè¯¥å±æ€§å¯ä»¥å¤§å¤§æé«˜Nginxå¤„ç†é™æ€èµ„æºçš„æ€§èƒ½</td></tr><tr><td>keepalive_timeout time</td><td>è®¾ç½®é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´</td></tr><tr><td>keepalive_requests number</td><td>è®¾ç½®ä¸€ä¸ªkeep-aliveè¿æ¥ä½¿ç”¨çš„æ¬¡æ•°</td></tr></tbody></table><h6 id="serverå—å’Œlocationå—"><a href="#serverå—å’Œlocationå—" class="headerlink" title="serverå—å’Œlocationå—"></a>serverå—å’Œlocationå—</h6><p>serverå—</p><table><thead><tr><th>æŒ‡ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>listen address[:port]</td><td>é…ç½®ç›‘å¬ç«¯å£</td></tr><tr><td>server_name  name</td><td>è®¾ç½®è™šæ‹Ÿä¸»æœºæœåŠ¡åç§°ã€‚å¯ç”¨æ­£åˆ™ï¼Œå¦‚æœåŒæ—¶åŒ¹é…å¤šä¸ªï¼Œåˆ™é€‰æœ€ç²¾ç¡®çš„</td></tr></tbody></table><p>locationå—</p><ol><li><p>location [  &#x3D;  |~  |<del>*   |^</del>   |@ ] uri{â€¦}</p><p>è®¾ç½®è¯·æ±‚çš„URIï¼Œ&#x3D;ç²¾ç¡®åŒ¹é…ï¼Œ<del>æ­£åˆ™ï¼Œ</del>*æ­£åˆ™ä¸åŒºåˆ†å¤§å°å†™ï¼Œ^~ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰(å’Œä¸åŠ ç¬¦å·åŠŸèƒ½ä¸€è‡´ï¼Œä½†å¦‚æœæ¨¡å¼åŒ¹é…ï¼Œå°±åœæ­¢æœç´¢å…¶ä»–æ¨¡å¼)</p></li><li><p>root &#x2F; alias path</p><p>rootçš„å¤„ç†ç»“æœæ˜¯: rootè·¯å¾„+locationè·¯å¾„<br>aliasçš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„<br>aliasæ˜¯ä¸€ä¸ªç›®å½•åˆ«åçš„å®šä¹‰ï¼Œrootåˆ™æ˜¯æœ€ä¸Šå±‚ç›®å½•çš„å«ä¹‰ã€‚<br>å¦‚æœlocationè·¯å¾„æ˜¯ä»¥&#x2F;ç»“å°¾,åˆ™aliasä¹Ÿå¿…é¡»æ˜¯ä»¥&#x2F;ç»“å°¾ï¼Œrootæ²¡æœ‰è¦æ±‚</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle"># æµè§ˆå™¨<span class="hljs-string">&#x27;/images/1.png&#x27;</span> åŒ¹é…åˆ° <span class="hljs-string">&#x27;/usr/local/nginx/html/images/1.png&#x27;</span><br>location /images &#123;<br>root <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html;<br>&#125;<br><br># æµè§ˆå™¨<span class="hljs-string">&#x27;/images/1.png&#x27;</span> åŒ¹é…åˆ° <span class="hljs-string">&#x27;/usr/local/nginx/html/1.png&#x27;</span><br>location /images &#123;<br>alias <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>html;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>index path</p><p>è®¾ç½®ç½‘ç«™çš„é»˜è®¤é¦–é¡µ</p></li><li><p>error_page code â€¦ [&#x3D;[response]] uri</p><p>è®¾ç½®ç½‘ç«™çš„é”™è¯¯é¡µé¢</p><p>åé¢å¯ä»¥è·Ÿå…·ä½“åœ°å€ã€é‡å®šå‘åœ°å€</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">server</span> &#123;<br>error_page <span class="hljs-number">404</span> http<span class="hljs-operator">:</span><span class="hljs-comment">//www.baidu.com;</span><br>&#125;<br><br><span class="hljs-keyword">server</span>&#123;<br>error_page <span class="hljs-number">404</span> <span class="hljs-operator">/</span><span class="hljs-number">50</span>x.html;<br>error_page <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span> <span class="hljs-operator">/</span><span class="hljs-number">50</span>x.html;<br>location <span class="hljs-operator">=/</span><span class="hljs-number">50</span>x.<span class="hljs-keyword">html</span>&#123;<br>root html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç”¨æ¥ä¿®æ”¹çŠ¶æ€ç </p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># è¿”å›çš„çŠ¶æ€ç ä¸º200</span><br>server&#123;<br>error_page <span class="hljs-number">404</span> =<span class="hljs-number">200</span> /<span class="hljs-number">50</span>x.html;<br><span class="hljs-keyword">location</span> <span class="hljs-title">=/50x</span>.html&#123;<br>root html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•"><a href="#é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•" class="headerlink" title="é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•"></a>é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³•</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œç±»ä¼¼</span><br><span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># å¿…é¡»åœ¨sendfileæ‰“å¼€çš„çŠ¶æ€ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥æå‡ç½‘ç»œåŒ…çš„ä¼ è¾“æ•ˆç‡ï¼Œç¼“å­˜æ»¡äº†æ‰å‘é€</span><br><span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># è¯¥æŒ‡ä»¤å¿…é¡»åœ¨keep-aliveè¿æ¥å¼€å¯çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆï¼Œæ¥æé«˜ç½‘ç»œåŒ…ä¼ è¾“çš„&#x27;å®æ—¶æ€§&#x27;</span><br><span class="hljs-attribute">tcp_nodeplay</span> <span class="hljs-literal">on</span>;<br></code></pre></td></tr></table></figure> <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># å¼€å¯å‹ç¼©åŠŸèƒ½</span><br><span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># é…ç½®éœ€è¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹ï¼Œå¦‚application/javascript text/html</span><br><span class="hljs-attribute">gzip_types</span> MIMEç±»å‹;<br><br><span class="hljs-comment"># è®¾ç½®Gzipå‹ç¼©ç¨‹åº¦ï¼Œ1æœ€ä½</span><br><span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">1</span>-<span class="hljs-number">9</span>;<br><span class="hljs-comment"># æ˜¯å¦æºå¸¦â€œVary:Accept-Encodingâ€å¤´åŸŸçš„å“åº”å¤´éƒ¨ï¼Œç”¨æ¥å‘Šè¯‰æ¥æ”¶æ–¹ä½¿ç”¨äº†å‹ç¼©å¤„ç†</span><br><span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>|<span class="hljs-literal">off</span>;<br><span class="hljs-comment"># é€šè¿‡æ­£åˆ™åŒ¹é…User-Agentå¤´é‡Œçš„ä¿¡æ¯æ¥ï¼Œé€‰æ‹©æ€§åœ°å…³é—­GzipåŠŸèƒ½</span><br><span class="hljs-attribute">gzip_disable</span> regex;<br><span class="hljs-comment"># è®¾ç½®å½“æ–‡ä»¶å¤§å°å¤§äºlengthæ—¶æ‰å‹ç¼©</span><br><span class="hljs-attribute">gzip_min_length</span> length;<br></code></pre></td></tr></table></figure><h5 id="æ·»åŠ æ¨¡å—æ­¥éª¤"><a href="#æ·»åŠ æ¨¡å—æ­¥éª¤" class="headerlink" title="æ·»åŠ æ¨¡å—æ­¥éª¤"></a>æ·»åŠ æ¨¡å—æ­¥éª¤</h5><p>ä»¥æ·»åŠ <code>http_gzip_static_module</code>ä¸ºä¾‹</p><ol><li><p>æŸ¥è¯¢å½“å‰Nginxçš„é…ç½®å‚æ•°</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nginx -V</span><br></code></pre></td></tr></table></figure></li><li><p>å°†nginxå®‰è£…ç›®å½•ä¸‹sbinç›®å½•ä¸­çš„nginxäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ›´åï¼ˆä¿å­˜æ—§çš„ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> nginx nginxold<br></code></pre></td></tr></table></figure></li><li><p>è¿›å…¥Nginxçš„å®‰è£…ç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/root/</span>nginx<span class="hljs-regexp">/core/</span>nginx-<span class="hljs-number">1.16</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œmake cleanæ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make clean</span><br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨configureæ¥é…ç½®å‚æ•°</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./configure</span> <span class="hljs-params">--with-http_gzip_static_module</span> åé¢æŠŠç¬¬ä¸€æ­¥æŸ¥åˆ°çš„é…ç½®å‚æ•°åŠ ä¸Š<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨makeå‘½ä»¤è¿›è¡Œç¼–è¯‘</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make</span><br></code></pre></td></tr></table></figure></li><li><p>å°†objsç›®å½•ä¸‹çš„nginxäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°nginxå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•ä¸­</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mv objs<span class="hljs-regexp">/nginx /u</span>sr<span class="hljs-regexp">/local/</span>nginx/sbin<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œæ›´æ–°å‘½ä»¤</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">make upgrade</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># å¼€å¯gzip_static</span><br><span class="hljs-attribute">gzip_static</span> <span class="hljs-literal">on</span>;<br><span class="hljs-comment"># reloadé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä¹‹åå¦‚æœå­˜åœ¨gzå‹ç¼©å¥½çš„æ–‡ä»¶ï¼Œå°±ä¼šç›´æ¥è¿”å›å‹ç¼©å¥½çš„</span><br><span class="hljs-comment"># gzipå‹ç¼©æ–‡ä»¶æŒ‡ä»¤ï¼šgzip æ–‡ä»¶è·¯å¾„</span><br></code></pre></td></tr></table></figure></li></ol><h5 id="ç¼“å­˜ç›¸å…³æŒ‡ä»¤"><a href="#ç¼“å­˜ç›¸å…³æŒ‡ä»¤" class="headerlink" title="ç¼“å­˜ç›¸å…³æŒ‡ä»¤"></a>ç¼“å­˜ç›¸å…³æŒ‡ä»¤</h5><ol><li>æŒ‡å®šç¼“å­˜æ—¶é—´ï¼Œå¡«offä¸ç¼“å­˜</li></ol>   <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">expires <span class="hljs-selector-attr">[modified]</span> <span class="hljs-selector-tag">time</span><br></code></pre></td></tr></table></figure><ol start="2"><li><p>æ·»åŠ å“åº”å¤´</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">add_header <span class="hljs-keyword">name</span> value<br></code></pre></td></tr></table></figure><p>Cache-Controlä½œä¸ºå“åº”å¤´ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹å€¼</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>must-revalidate</td><td>å¯ç¼“å­˜ä½†å¿…é¡»å†å‘æºæœåŠ¡å™¨è¿›è¡Œç¡®è®¤</td></tr><tr><td>no-cache</td><td>ç¼“å­˜å‰å¿…é¡»ç¡®è®¤å…¶æœ‰æ•ˆæ€§</td></tr><tr><td>no-store</td><td>ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹</td></tr><tr><td>no-transform</td><td>ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹</td></tr><tr><td>public</td><td>å¯å‘ä»»æ„æ–¹æä¾›å“åº”çš„ç¼“å­˜</td></tr><tr><td>private</td><td>ä»…å‘ç‰¹å®šç”¨æˆ·è¿”å›å“åº”</td></tr><tr><td>proxy-revalidate</td><td>è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤</td></tr><tr><td>max-age&#x3D;&lt;ç§’&gt;</td><td>å“åº”æœ€å¤§Ageå€¼</td></tr><tr><td>s-maxage&#x3D;&lt;ç§’&gt;</td><td>å…¬å…±ç¼“å­˜æœåŠ¡å™¨å“åº”çš„æœ€å¤§Ageå€¼</td></tr></tbody></table></li></ol><h4 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h4><p>åŒæº:  åè®®ã€åŸŸå(IP)ã€ç«¯å£ç›¸åŒå³ä¸ºåŒæº</p><p>å¦‚æœä»æœåŠ¡å™¨Açš„é¡µé¢å‘é€å¼‚æ­¥è¯·æ±‚åˆ°æœåŠ¡å™¨Bè·å–æ•°æ®ï¼Œå¦‚æœæœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨Bä¸æ»¡è¶³åŒæºç­–ç•¥ï¼Œåˆ™å°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚</p><p><strong>è§£å†³æ–¹å¼</strong></p><p>æ·»åŠ Access-Control-Allow-Originæ¥è®¾ç½®å…è®¸è·¨åŸŸè®¿é—®çš„æºåœ°å€ä¿¡æ¯</p><p>æ·»åŠ Access-Control-Allow-Methodsæ¥è®¾ç½®å…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹å¼</p><p>ä¾‹å¦‚</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">location</span> <span class="hljs-title">/getUser</span>&#123;<br><span class="hljs-comment"># *è¡¨æ‰€æœ‰åœ°å€éƒ½å¯ä»¥</span><br>    add_header Access-Control-Allow-Origin *;<br>    add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE;<br>    default_type application/json;<br>    return <span class="hljs-number">200</span> &#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;TOM&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>&#125;&#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é˜²ç›—é“¾"><a href="#é˜²ç›—é“¾" class="headerlink" title="é˜²ç›—é“¾"></a>é˜²ç›—é“¾</h4><p>ç›—é“¾ï¼šå°†åˆ«äººç½‘é¡µçš„å†…å®¹æ”¾åˆ°è‡ªå·±çš„é¡µé¢ä¸Š</p><p><strong>é˜²ç›—é“¾åŸç†</strong></p><p>é€šè¿‡åˆ¤æ–­HTTPçš„å¤´ä¿¡æ¯Refereræ¥åˆ¤æ–­è·å–èµ„æºçš„è¯·æ±‚æ¥æºï¼Œåªå¯¹å…è®¸çš„æ¥æºå¼€æ”¾é“¾æ¥</p><p><strong>é˜²ç›—é“¾æ­¥éª¤</strong></p><p>ä¾‹å­</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /images &#123;<br>           <span class="hljs-attribute">valid_referers</span> <span class="hljs-literal">none</span> <span class="hljs-literal">blocked</span> www.baidu.com <span class="hljs-number">192.168.200.222</span> <span class="hljs-regexp">*.example.com</span> <span class="hljs-regexp">example.*</span>  www.example.org  ~\.google\.;<br>           <span class="hljs-attribute">if</span> (<span class="hljs-variable">$invalid_referer</span>)&#123;<br>                <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>           &#125;<br>           <span class="hljs-attribute">root</span> /usr/local/nginx/html;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="RewriteåŠŸèƒ½é…ç½®"><a href="#RewriteåŠŸèƒ½é…ç½®" class="headerlink" title="RewriteåŠŸèƒ½é…ç½®"></a>RewriteåŠŸèƒ½é…ç½®</h4><p>ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°URLçš„é‡å†™</p><p>å¯ä»¥ç”¨æ¥åšåŸŸåè·³è½¬ã€åŸŸåé•œåƒã€ç»™æ¯ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹åŸŸåã€åˆå¹¶ç›®å½•</p><h5 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><ol><li><p>set</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-variable">$variable</span> value<br><br>ä¾‹<br><span class="hljs-built_in"> server </span>&#123;<br>        listen 8081;<br>        server_name localhost;<br>        location <span class="hljs-built_in">/server </span>&#123;<br>                <span class="hljs-built_in">set</span> <span class="hljs-variable">$name</span> Tom;<br>                <span class="hljs-built_in">set</span> <span class="hljs-variable">$age</span> 18;<br>                default_type text/plain;<br>                return 200 <span class="hljs-variable">$name</span>=<span class="hljs-variable">$age</span>;<br>        &#125;<br>    &#125;<br>nginxæœ‰é¢„è®¾çš„å…¨å±€å˜é‡<br>ä¾‹ï¼šç”¨å…¨å±€å˜é‡è®°å½•æ—¥å¿—<br>log_format main <span class="hljs-string">&#x27;$remote_addr - $request - $status - $request_uri - $http_user_agent&#x27;</span>;<br><br>   <span class="hljs-built_in"> server </span>&#123;<br>        listen 8081;<br>        server_name localhost;<br>        location <span class="hljs-built_in">/server </span>&#123;<br>                access_log logs/access.log main;<br>                <span class="hljs-built_in">set</span> <span class="hljs-variable">$name</span> Tom;<br>                <span class="hljs-built_in">set</span> <span class="hljs-variable">$age</span> 18;<br>                default_type text/plain;<br>                return 200 <span class="hljs-variable">$name</span>=<span class="hljs-variable">$age</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li><li><p>if</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-keyword">if</span>  (condition)<span class="hljs-meta">&#123;...&#125;</span><br><br><span class="hljs-number">1</span>. å¦‚æœå˜é‡åå¯¹åº”çš„å€¼ä¸ºç©ºæˆ–è€…æ˜¯<span class="hljs-number">0</span>ï¼Œ<span class="hljs-keyword">if</span>éƒ½åˆ¤æ–­ä¸º<span class="hljs-literal">false</span>,å…¶ä»–æ¡ä»¶ä¸º<span class="hljs-literal">true</span>ã€‚<br><span class="hljs-number">2</span>. ä½¿ç”¨<span class="hljs-string">&quot;=&quot;</span>å’Œ<span class="hljs-string">&quot;!=&quot;</span>æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ä¸º<span class="hljs-literal">true</span>ï¼Œä¸æ»¡è¶³ä¸º<span class="hljs-literal">false</span><br>ä¾‹<br><span class="hljs-keyword">if</span> ($request_method = <span class="hljs-type">POST</span>)&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">405</span>;<br>&#125;<br><span class="hljs-number">3</span>. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹å˜é‡è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å›<span class="hljs-literal">true</span>ï¼Œå¦åˆ™è¿”å›<span class="hljs-literal">false</span>ã€‚å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ä½¿ç”¨<span class="hljs-string">&quot;~&quot;</span>,<span class="hljs-string">&quot;~*&quot;</span>,<span class="hljs-string">&quot;!~&quot;</span>,<span class="hljs-string">&quot;!~\*&quot;</span>æ¥è¿æ¥ã€‚<br><span class="hljs-number">4</span>. åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨<span class="hljs-string">&quot;-f&quot;</span>å’Œ<span class="hljs-string">&quot;!-f&quot;</span>, åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨<span class="hljs-string">&quot;-d&quot;</span>å’Œ<span class="hljs-string">&quot;!-d&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>break</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">è¯¥æŒ‡ä»¤ç”¨äºä¸­æ–­å½“å‰ç›¸åŒä½œç”¨åŸŸä¸­çš„å…¶ä»–Nginxé…ç½®<br>ä¼šå»æ‰¾ä¸è®¿é—®è·¯å¾„å¯¹åº”ç›®å½•ä¸‹çš„<span class="hljs-keyword">index</span>.htmlæ–‡ä»¶<br></code></pre></td></tr></table></figure></li><li><p>return</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">return</span> code [text];<br><span class="hljs-keyword">return</span> code URL;<br><span class="hljs-keyword">return</span> URL;<br></code></pre></td></tr></table></figure></li><li><p>rewrite</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ldif">rewrite regex replacement<br><span class="hljs-attribute">replacement</span>:åŒ¹é…æˆåŠŸåï¼Œç”¨äºæ›¿æ¢URIä¸­è¢«æˆªå–å†…å®¹çš„å­—ç¬¦ä¸²<br><span class="hljs-attribute">flag</span>:ç”¨æ¥è®¾ç½®rewriteå¯¹URIçš„å¤„ç†è¡Œä¸ºï¼Œå¯é€‰å€¼æœ‰å¦‚ä¸‹ï¼š<br><span class="hljs-literal">-</span> last:æ›¿æ¢å®Œåé‡æ–°åŒ¹é…<br><span class="hljs-literal">-</span> break: æ›¿æ¢å®Œåå»æ‰¾ä¸è®¿é—®è·¯å¾„å¯¹åº”ç›®å½•ä¸‹çš„index.htmlæ–‡ä»¶<br><span class="hljs-literal">-</span> redirectï¼šæ°¸ä¹…é‡å®šå‘<br><span class="hljs-literal">-</span> permanentï¼šä¸´æ—¶é‡å®šå‘<br></code></pre></td></tr></table></figure></li><li><p>rewrite_log</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rewrite_log</span> <span class="hljs-literal">on</span>\|<span class="hljs-literal">off</span><br>é…ç½®æ˜¯å¦å¼€å¯URLé‡å†™æ—¥å¿—çš„è¾“å‡ºåŠŸèƒ½<br>rewrite_logçš„æ—¥å¿—è¾“å‡ºçº§åˆ«ä¸º<span class="hljs-literal">notice</span><br>æ‰€ä»¥éœ€è¦è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ä¸º<span class="hljs-literal">notice</span>æ‰èƒ½çœ‹åˆ°æ—¥å¿—<br>error_log logs/<span class="hljs-literal">error</span>.log <span class="hljs-literal">notice</span>;<br></code></pre></td></tr></table></figure></li></ol><h4 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h4><ol><li><p>proxy_pass</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk">proxy_pass URL<br>è®¾ç½®è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸»æœºåç§°ã€IPåœ°å€åŠ ç«¯å£å·å½¢å¼<br><br>ä¾‹<br>server&#123;<br>listen <span class="hljs-number">80</span>;<br>server_name localhost;<br>location /server&#123;<br><span class="hljs-comment">#proxy_pass http://192.168.200.146;</span><br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>/;<br>&#125;<br>&#125;<br>urlåé¢åŠ <span class="hljs-regexp">/åˆ™æœ€ç»ˆæ‰¾çš„æ˜¯url/i</span>ndex.htmlï¼Œä¸åŠ åˆ™ä¸ºurl<span class="hljs-regexp">/server/i</span>ndex.html<br></code></pre></td></tr></table></figure></li><li><p>proxy_set_header</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">proxy_set_header</span> field value<br>æ›´æ”¹NginxæœåŠ¡å™¨æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯<br><br>ä¾‹<br>server &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8080</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-attribute">default_type</span> text/plain;<br><span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-variable">$http_username</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8081</span>;<br><span class="hljs-attribute">server_name</span> localhost;<br><span class="hljs-section">location</span> /server &#123;<br><span class="hljs-attribute">proxy_pass</span> http://47.96.80.163:8080;<br><span class="hljs-attribute">proxy_set_header</span> username Cat;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>proxy_redirect</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">proxy_redirect redirect replacement;<br>redirect:ç›®æ ‡,Locationçš„å€¼<br>replacement:è¦æ›¿æ¢çš„å€¼<br>é‡ç½®å¤´ä¿¡æ¯ä¸­çš„<span class="hljs-string">&quot;Location&quot;</span>å’Œ<span class="hljs-string">&quot;Refresh&quot;</span>çš„å€¼<br><br>ä¾‹<br>æœåŠ¡ç«¯[<span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>]<br>server &#123;<br>    listen  <span class="hljs-number">8081</span>;<br>    server_name localhost;<br>    <span class="hljs-keyword">if</span> (!-f <span class="hljs-variable">$request_filename</span>)&#123;<br>    return <span class="hljs-number">302</span> http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>;<br>    &#125;<br>&#125;<br>ä»£ç†æœåŠ¡ç«¯[<span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>]<br>server &#123;<br>listen  <span class="hljs-number">8081</span>;<br>server_name localhost;<br>location / &#123;<br>proxy_pass http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span>:<span class="hljs-number">8081</span>/;<br>proxy_redirect http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.146</span> http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">200.133</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å…·ä½“æ¡ˆä¾‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ¡ˆä¾‹ï¼šå°†ä¸åŒè¯·æ±‚ä»£ç†åˆ°ä¸åŒæœåŠ¡å™¨<br><br>ä»£ç†æœåŠ¡å™¨<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">8082</span>;<br>        server_name     localhost;<br>        <span class="hljs-keyword">location</span> /server1 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.146</span>:<span class="hljs-number">9001</span>/;<br>        &#125;<br>        <span class="hljs-keyword">location</span> /server2 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.146</span>:<span class="hljs-number">9002</span>/;<br>        &#125;<br>        <span class="hljs-keyword">location</span> /server3 &#123;<br>                proxy_pass http://<span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.146</span>:<span class="hljs-number">9003</span>/;<br>        &#125;<br>&#125;<br><br>æœåŠ¡ç«¯<br>server1<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9001</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;&#x27;</span><br>&#125;<br>server2<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9002</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;&#x27;</span><br>&#125;<br>server3<br><span class="hljs-keyword">server</span> &#123;<br>        <span class="hljs-keyword">listen</span>          <span class="hljs-number">9003</span>;<br>        server_name     localhost;<br>        default_type <span class="hljs-type">text</span>/html;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç¬¬ä¸ƒå±‚è´Ÿè½½å‡è¡¡"><a href="#ç¬¬ä¸ƒå±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="ç¬¬ä¸ƒå±‚è´Ÿè½½å‡è¡¡"></a>ç¬¬ä¸ƒå±‚è´Ÿè½½å‡è¡¡</h4><h5 id="è´Ÿè½½å‡è¡¡ä½œç”¨"><a href="#è´Ÿè½½å‡è¡¡ä½œç”¨" class="headerlink" title="è´Ÿè½½å‡è¡¡ä½œç”¨"></a>è´Ÿè½½å‡è¡¡ä½œç”¨</h5><ol><li>è§£å†³æœåŠ¡å™¨çš„é«˜å¹¶å‘å‹åŠ›ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¤„ç†æ€§èƒ½ã€‚</li><li>æä¾›æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨ã€‚</li><li>é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œå¢å¼ºç½‘ç«™çš„å¯æ‰©å±•æ€§ã€‚</li><li>åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</li></ol><h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>è¢«ä»£ç†æœåŠ¡å™¨ï¼š47.96.80.163:9001ã€47.96.80.163:9002ã€47.96.80.163:9003</p><p>è´Ÿè½½å‡è¡¡å™¨ï¼š47.96.80.163:8081</p><p>é»˜è®¤æ–¹å¼ä¸ºè½®è¯¢</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">9001</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;9001&lt;/h1&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">9002</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;9002&lt;/h1&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">9003</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-attribute">default_type</span> text/html;<br>    <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">200</span> <span class="hljs-string">&#x27;&lt;h1&gt;9003&lt;/h1&gt;&#x27;</span>;<br>&#125;<br>&#125;<br><span class="hljs-section">upstream</span> backend &#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9001</span>;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9002</span>;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9003</span>;<br>&#125;<br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">8081</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;<br>    <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://backend;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è´Ÿè½½å‡è¡¡çŠ¶æ€"><a href="#è´Ÿè½½å‡è¡¡çŠ¶æ€" class="headerlink" title="è´Ÿè½½å‡è¡¡çŠ¶æ€"></a>è´Ÿè½½å‡è¡¡çŠ¶æ€</h5><table><thead><tr><th>çŠ¶æ€</th><th>æ¦‚è¿°</th></tr></thead><tbody><tr><td>down</td><td>å½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡</td></tr><tr><td>backup</td><td>é¢„ç•™çš„å¤‡ä»½æœåŠ¡å™¨ï¼Œå…¶ä»–ä¸»æœåŠ¡å™¨æŒ‚äº†æ‰ä¼šè¢«ç”¨åˆ°</td></tr><tr><td>max_fails</td><td>å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°</td></tr><tr><td>fail_timeout</td><td>ç»è¿‡max_failsæ¬¡å¤±è´¥å, æœåŠ¡æš‚åœçš„æ—¶é—´</td></tr><tr><td>max_conns</td><td>é™åˆ¶æœ€å¤§çš„æ¥æ”¶è¿æ¥æ•°</td></tr></tbody></table><p><strong>è®¾ç½®æ–¹å¼ç¤ºä¾‹</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">upstream</span> backend &#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9001</span> down;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9002</span> backup;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">47.96.80.163:9003</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">15</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h5><table><thead><tr><th>ç®—æ³•åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è½®è¯¢</td><td>é»˜è®¤æ–¹å¼</td></tr><tr><td>weight</td><td>æƒé‡æ–¹å¼</td></tr><tr><td>ip_hash</td><td>ä¾æ®ipåˆ†é…æ–¹å¼</td></tr><tr><td>least_conn</td><td>ä¾æ®æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>url_hash</td><td>ä¾æ®URLåˆ†é…æ–¹å¼</td></tr><tr><td>fair</td><td>ä¾æ®å“åº”æ—¶é—´æ–¹å¼</td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs roboconf"><span class="hljs-comment"># 1.é…ç½®æƒé‡ï¼Œæƒé‡è¶Šå¤§è¢«åˆ†é…çš„æ¦‚ç‡è¶Šå¤§ï¼Œé»˜è®¤ä¸º1</span><br>upstream backend &#123;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9001 weight=2;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9002;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9003;<br>&#125;<br><br><span class="hljs-comment"># 2.é…ç½®ip_hashï¼ŒåŒä¸€ä¸ªipåªä¼šè¢«åˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Š</span><br>upstream backend &#123;<br><span class="hljs-attribute">ip_hash;</span><br><span class="hljs-attribute">    server 47.96.80.163</span>:9001;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9002;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9003;<br>&#125;<br><br><span class="hljs-comment"># 3.é…ç½®least_connï¼Œä¼šæŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„æœåŠ¡å™¨ä¸Š</span><br><span class="hljs-comment"># é€‚åˆè¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µ</span><br>upstream backend &#123;<br><span class="hljs-attribute">least_conn;</span><br><span class="hljs-attribute">    server 47.96.80.163</span>:9001;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9002;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9003;<br>&#125;<br><br><span class="hljs-comment"># 4.é…ç½®url_hashï¼Œæ ¹æ®è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚</span><br>upstream backend &#123;<br><span class="hljs-attribute">hash $request_uri;</span><br><span class="hljs-attribute">    server 47.96.80.163</span>:9001;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9002;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9003;<br>&#125;<br><br><span class="hljs-comment"># 5.é…ç½®fairï¼Œæ™ºèƒ½çš„è¿›è¡Œè´Ÿè½½å‡è¡¡</span><br><span class="hljs-comment"># éœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—</span><br>(1)ä¸‹è½½ https://github.com/gnosek/nginx-upstream-fairï¼Œè§£å‹åˆ°linuxï¼Œé‡å‘½åä¸ºfair<br>(2)sbin/nginx -V æŸ¥çœ‹ä¹‹å‰çš„å‚æ•°ä¿¡æ¯ï¼Œå¹¶å¤‡ä»½åŸnginxæ–‡ä»¶<br>(3)åˆ°nginxæºæ–‡ä»¶ç›®å½•ï¼Œ./configure --add-module=fairæ‰€åœ¨è·¯å¾„ + ä¹‹å‰çš„å‚æ•°ä¿¡æ¯<br>(4)ä¿®æ”¹src/http/ngx_http_upstream.hæ–‡ä»¶ï¼Œæ‰¾åˆ°ngx_http_upstream_srv_conf_sï¼Œ<br>æ·»åŠ in_port_t   default_port<br>(5)make<br>(6)å°†objsä¸‹çš„nginxå¤åˆ¶åˆ°nginxæ–‡ä»¶å¤¹ä¸‹çš„sbinç›®å½•<br>(7)make upgrade<br>(8)æµ‹è¯•<br>upstream backend &#123;<br><span class="hljs-attribute">fair;</span><br><span class="hljs-attribute">    server 47.96.80.163</span>:9001;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9002;<br>    <span class="hljs-attribute">server 47.96.80.163</span>:9003;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¬¬å››å±‚è´Ÿè½½å‡è¡¡"><a href="#ç¬¬å››å±‚è´Ÿè½½å‡è¡¡" class="headerlink" title="ç¬¬å››å±‚è´Ÿè½½å‡è¡¡"></a>ç¬¬å››å±‚è´Ÿè½½å‡è¡¡</h4><p>éœ€è¦å®‰è£…streamæ¨¡å—ï¼Œåœ¨é…ç½®å‚æ•°çš„æ—¶å€™åŠ ä¸Š<code>--with-stream</code></p><p><strong>ç¤ºä¾‹</strong></p><p>streamå’Œhttpå—æ˜¯å¹³çº§çš„</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">stream</span> &#123;<br>        <span class="hljs-section">upstream</span> redisbackend &#123;<br>                <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:6379</span>;<br>                <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:6378</span>;<br>        &#125;<br>        <span class="hljs-section">upstream</span> tomcatbackend &#123;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">192.168.200.146:8080</span>;<br>        &#125;<br>        <span class="hljs-section">server</span> &#123;<br>                <span class="hljs-attribute">listen</span>  <span class="hljs-number">81</span>;<br>                <span class="hljs-attribute">proxy_pass</span> redisbackend;<br>        &#125;<br>        <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span><span class="hljs-number">82</span>;<br>        <span class="hljs-attribute">proxy_pass</span> tomcatbackend;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é›†æˆç¼“å­˜"><a href="#é›†æˆç¼“å­˜" class="headerlink" title="é›†æˆç¼“å­˜"></a>é›†æˆç¼“å­˜</h4><p><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html">Module ngx_http_proxy_module (nginx.org)</a></p><h5 id="ç›¸å…³æŒ‡ä»¤"><a href="#ç›¸å…³æŒ‡ä»¤" class="headerlink" title="ç›¸å…³æŒ‡ä»¤"></a>ç›¸å…³æŒ‡ä»¤</h5><p>ä¾‹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># proxy_cache_pathï¼šç¼“å­˜å­˜æ”¾è·¯å¾„ï¼›</span><br><span class="hljs-comment"># levelsï¼šç¼“å­˜æ–‡ä»¶å±‚çº§ï¼Œå¦‚2:1è¡¨ç¤ºè¯·æ±‚urlç»è¿‡MD5åŠ å¯†åå–æœ€åä¸¤ä¸ªå­—ç¬¦å’Œå€’æ•°ç¬¬ä¸‰ä¸ªå­—ç¬¦æ¥ç»„æˆå­˜æ”¾æ–‡ä»¶å¤¹ï¼Œå¦‚/ab/cï¼›</span><br><span class="hljs-comment"># keys_zoneï¼šä¸ºç¼“å­˜åŒºè®¾ç½®åç§°å’Œå¤§å°ï¼›</span><br><span class="hljs-comment"># inactiveï¼šç¼“å­˜å­˜æ´»æ—¶é—´ï¼Œè¶…è¿‡å­˜æ´»æ—¶é—´æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤ï¼›max_sizeï¼šè®¾ç½®æœ€å¤§ç¼“å­˜ç©ºé—´</span><br><span class="hljs-comment"># proxy_cacheï¼šå¼€å¯ç¼“å­˜</span><br><span class="hljs-comment"># proxy_cache_keyï¼šæ ¹æ®keyå€¼MD5å“ˆå¸Œå­˜ç¼“å­˜ï¼Œé»˜è®¤$scheme$proxy_host$request_uri</span><br><span class="hljs-comment"># proxy_cache_validï¼šå¯¹ä¸åŒè¿”å›çŠ¶æ€ç çš„URLè®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ï¼Œå¦‚404 1dã€any 30s</span><br>proxy_cache_path /home/nginx/proxy_cache <span class="hljs-attribute">levels</span>=2:1 <span class="hljs-attribute">keys_zone</span>=cache:200m<br><span class="hljs-attribute">inactive</span>=1d <span class="hljs-attribute">max_size</span>=20g;<span class="hljs-built_in"></span><br><span class="hljs-built_in">server </span>&#123;<br>proxy_cache ç¼“å­˜åŒºåç§°;<br>proxy_cache_key webç¼“å­˜çš„keyå€¼;<br>proxy_cache_vaild code time;<br>add_header nginx-cache <span class="hljs-string">&quot;<span class="hljs-variable">$upstream_cache_status</span>&quot;</span>;# æ·»åŠ å¤´ä¿¡æ¯æ¥æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜<br>proxy_cache_min_uses number;# è®¿é—®numberæ¬¡åæ‰ä¼šç¼“å­˜<br><span class="hljs-built_in">..</span>.<br>&#125;<br>    <br></code></pre></td></tr></table></figure><h5 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h5><p><strong>æ–¹å¼1</strong>ï¼šåˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½•ï¼ˆåˆ é™¤æ‰€æœ‰ç¼“å­˜ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf ç›®å½•<br></code></pre></td></tr></table></figure><p><strong>æ–¹å¼2</strong>ï¼šngx_cache_purgeï¼ˆåˆ é™¤æŒ‡å®šç¼“å­˜å—çš„ç¼“å­˜ï¼‰</p><p><a href="https://github.com/FRiCKLE/ngx_cache_purge/tags">githubåœ°å€</a></p><p>å®‰è£…ngx_cache_purgeç¬¬ä¸‰æ–¹æ¨¡å—</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># é…ç½®</span><br><span class="hljs-comment"># ä¹‹åæµè§ˆå™¨è®¿é—®å¯¹åº”è·¯å¾„å°±èƒ½åˆ é™¤ç¼“å­˜</span><br>server&#123;<br><span class="hljs-keyword">location</span> <span class="hljs-title">~/purge</span>(/.*) &#123;<br>proxy_cache_purge ç¼“å­˜å—åç§° ç¼“å­˜çš„key;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è®¾ç½®ä¸ç¼“å­˜çš„èµ„æº"><a href="#è®¾ç½®ä¸ç¼“å­˜çš„èµ„æº" class="headerlink" title="è®¾ç½®ä¸ç¼“å­˜çš„èµ„æº"></a>è®¾ç½®ä¸ç¼“å­˜çš„èµ„æº</h5><p>ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">server&#123;<br>listen8080;<br>server_name localhost;<br>location / &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_uri</span> ~ /.*\.js$)&#123;<br>           <span class="hljs-built_in">set</span> <span class="hljs-variable">$nocache</span> 1;<br>        &#125;<br>proxy_no_cache <span class="hljs-variable">$nocache</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br>        proxy_cache_bypass <span class="hljs-variable">$nocache</span> <span class="hljs-variable">$cookie_nocache</span> <span class="hljs-variable">$arg_nocache</span> <span class="hljs-variable">$arg_comment</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å®‰å…¨æ§åˆ¶"><a href="#å®‰å…¨æ§åˆ¶" class="headerlink" title="å®‰å…¨æ§åˆ¶"></a>å®‰å…¨æ§åˆ¶</h4><p>Nginxä½¿ç”¨SSL(Secure Sockets Layer)ï¼Œéœ€è¦å®‰è£…<code>--with-http_ssl_module</code>æ¨¡å—</p><h5 id="ç›¸å…³æŒ‡ä»¤-1"><a href="#ç›¸å…³æŒ‡ä»¤-1" class="headerlink" title="ç›¸å…³æŒ‡ä»¤"></a>ç›¸å…³æŒ‡ä»¤</h5><p><a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html">Module ngx_http_ssl_module (nginx.org)</a></p><h4 id="æ­å»ºé›†ç¾¤"><a href="#æ­å»ºé›†ç¾¤" class="headerlink" title="æ­å»ºé›†ç¾¤"></a>æ­å»ºé›†ç¾¤</h4><p>ä½¿ç”¨<strong>Keepalived</strong>æ¥è§£å†³ï¼ŒKeepalived è½¯ä»¶ç”± C ç¼–å†™çš„ï¼Œæœ€åˆæ˜¯ä¸“ä¸º LVS è´Ÿè½½å‡è¡¡è½¯ä»¶è®¾è®¡çš„ï¼ŒKeepalived è½¯ä»¶ä¸»è¦æ˜¯é€šè¿‡ VRRP åè®®å®ç°é«˜å¯ç”¨åŠŸèƒ½ã€‚</p><p><strong>VRRPï¼ˆVirtual Route Redundancy Protocolï¼‰</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼ŒVRRPå¯ä»¥æŠŠä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„è´£ä»»åŠ¨æ€åˆ†é…åˆ°å±€åŸŸç½‘ä¸Šçš„ VRRP è·¯ç”±å™¨ä¸­çš„ä¸€å°ã€‚å…¶ä¸­çš„è™šæ‹Ÿè·¯ç”±å³Virtualè·¯ç”±æ˜¯ç”±VRRPè·¯ç”±ç¾¤ç»„åˆ›å»ºçš„ä¸€ä¸ªä¸çœŸå®å­˜åœ¨çš„è·¯ç”±ï¼Œè¿™ä¸ªè™šæ‹Ÿè·¯ç”±ä¹Ÿæ˜¯æœ‰å¯¹åº”çš„IPåœ°å€ã€‚è€Œä¸”VRRPè·¯ç”±<span class="hljs-number">1</span>å’ŒVRRPè·¯ç”±<span class="hljs-number">2</span>ä¹‹é—´ä¼šæœ‰ç«äº‰é€‰æ‹©ï¼Œé€šè¿‡é€‰æ‹©ä¼šäº§ç”Ÿä¸€ä¸ª<span class="hljs-literal">Master</span>è·¯ç”±å’Œä¸€ä¸ªBackupè·¯ç”±ã€‚<br><span class="hljs-literal">Master</span>è·¯ç”±å’ŒBackupè·¯ç”±ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ï¼Œ<span class="hljs-literal">Master</span>ä¼šå®šæ—¶å‘ŠçŸ¥Backupè‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼ŒBackupæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªé€šçŸ¥å†…å®¹ï¼ŒBackupå°±ä¼šæ›¿ä»£<span class="hljs-literal">Master</span>æˆä¸ºæ–°çš„<span class="hljs-literal">Master</span>ã€‚<span class="hljs-literal">Master</span>è·¯ç”±æœ‰ä¸€ä¸ªç‰¹æƒå°±æ˜¯è™šæ‹Ÿè·¯ç”±å’Œåç«¯æœåŠ¡å™¨éƒ½æ˜¯é€šè¿‡<span class="hljs-literal">Master</span>è¿›è¡Œæ•°æ®ä¼ é€’äº¤äº’çš„ï¼Œè€Œå¤‡ä»½èŠ‚ç‚¹åˆ™ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›è¯·æ±‚å’Œæ•°æ®ï¼Œä¸åšå¤„ç†ï¼Œåªæ˜¯å»ç›‘å¬<span class="hljs-literal">Master</span>çš„çŠ¶æ€<br></code></pre></td></tr></table></figure><h5 id="å®‰è£…keepalived"><a href="#å®‰è£…keepalived" class="headerlink" title="å®‰è£…keepalived"></a>å®‰è£…keepalived</h5><ol><li><p>å®˜ç½‘ä¸‹è½½<a href="https://keepalived.org/%EF%BC%8C%E4%B8%8A%E4%BC%A0%E5%88%B0linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A">https://keepalived.org/ï¼Œä¸Šä¼ åˆ°linuxæœåŠ¡å™¨ä¸Š</a></p></li><li><p>åˆ›å»ºkeepalivedç›®å½•ï¼Œå°†å‹ç¼©åŒ…è§£å‹åˆ°ç›®å½•</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">tar</span> <span class="hljs-operator">-</span><span class="hljs-variable">zxf</span> å‹ç¼©åŒ…å <span class="hljs-operator">-</span><span class="hljs-built_in">C</span> <span class="hljs-variable">keepalived</span><span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘ã€å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> keepalived/keepalived-2.0.20<br><br><span class="hljs-comment"># sysconfï¼šé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="hljs-comment"># prefixï¼škeepalivedè¦å®‰è£…çš„ç›®å½•</span><br>./configure --sysconf=/etc --prefix=/usr/local<br><br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure></li></ol><h5 id="é…ç½®keepalived"><a href="#é…ç½®keepalived" class="headerlink" title="é…ç½®keepalived"></a>é…ç½®keepalived</h5><p>é…ç½®æ–‡ä»¶åœ¨<code>/å®‰è£…ç›®å½•/keepalived/keepalived.conf</code></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">global</span>å…¨å±€éƒ¨åˆ†ï¼š<br>global_defs &#123;<br>   <span class="hljs-meta">#é€šçŸ¥é‚®ä»¶ï¼Œå½“keepalivedå‘é€åˆ‡æ¢æ—¶éœ€è¦å‘emailç»™å…·ä½“çš„é‚®ç®±åœ°å€</span><br>   notification_email &#123;<br>     tom<span class="hljs-symbol">@itcast</span>.cn<br>     jerry<span class="hljs-symbol">@itcast</span>.cn<br>   &#125;<br>   <span class="hljs-meta">#è®¾ç½®å‘ä»¶äººçš„é‚®ç®±ä¿¡æ¯</span><br>   notification_email_from zhaomin<span class="hljs-symbol">@itcast</span>.cn<br>   <span class="hljs-meta">#æŒ‡å®šsmptæœåŠ¡åœ°å€</span><br>   smtp_server <span class="hljs-number">192.168</span><span class="hljs-number">.200</span><span class="hljs-number">.1</span><br>   <span class="hljs-meta">#æŒ‡å®šsmptæœåŠ¡è¿æ¥è¶…æ—¶æ—¶é—´</span><br>   smtp_connect_timeout <span class="hljs-number">30</span><br>   <span class="hljs-meta">#è¿è¡ŒkeepalivedæœåŠ¡å™¨çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¯ä»¥ç”¨ä½œå‘é€é‚®ä»¶çš„ä¸»é¢˜ä¿¡æ¯</span><br>   router_id LVS_DEVEL<br>   <br>   <span class="hljs-meta">#é»˜è®¤æ˜¯ä¸è·³è¿‡æ£€æŸ¥ã€‚æ£€æŸ¥æ”¶åˆ°çš„VRRPé€šå‘Šä¸­çš„æ‰€æœ‰åœ°å€å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè®¾ç½®æ­¤å‘½ä»¤çš„æ„æ€æ˜¯ï¼Œå¦‚æœé€šå‘Šä¸æ¥æ”¶çš„ä¸Šä¸€ä¸ªé€šå‘Šæ¥è‡ªç›¸åŒçš„masterè·¯ç”±å™¨ï¼Œåˆ™ä¸æ‰§è¡Œæ£€æŸ¥(è·³è¿‡æ£€æŸ¥)</span><br>   vrrp_skip_check_adv_addr<br>   <span class="hljs-meta">#ä¸¥æ ¼éµå®ˆVRRPåè®®ã€‚</span><br>   vrrp_strict<br>   <span class="hljs-meta">#åœ¨ä¸€ä¸ªæ¥å£å‘é€çš„ä¸¤ä¸ªå…è´¹ARPä¹‹é—´çš„å»¶è¿Ÿã€‚å¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’çº§ã€‚é»˜è®¤æ˜¯0</span><br>   vrrp_garp_interval <span class="hljs-number">0</span><br>   <span class="hljs-meta">#åœ¨ä¸€ä¸ªç½‘å¡ä¸Šæ¯ç»„naæ¶ˆæ¯ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º0</span><br>   vrrp_gna_interval <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pf">VRRPéƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†å¯ä»¥åŒ…å«ä»¥ä¸‹å››ä¸ªå­æ¨¡å—<br><span class="hljs-number">1</span>. vrrp_script<br><span class="hljs-number">2</span>. vrrp_sync_group<br><span class="hljs-number">3</span>. garp_group<br><span class="hljs-number">4</span>. vrrp_instance<br>æˆ‘ä»¬ä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬å››ä¸ªï¼Œ<br><span class="hljs-comment">#è®¾ç½®keepalivedå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒVI_1ä¸ºVRRPå®ä¾‹åç§°</span><br>vrrp_instance VI_1 &#123;<br>    <span class="hljs-keyword">state</span> MASTER  <span class="hljs-comment">#æœ‰ä¸¤ä¸ªå€¼å¯é€‰MASTERä¸» BACKUPå¤‡</span><br>    interface ens33<span class="hljs-comment">#vrrpå®ä¾‹ç»‘å®šçš„æ¥å£ï¼Œç”¨äºå‘é€VRRPåŒ…[å½“å‰æœåŠ¡å™¨ä½¿ç”¨çš„ç½‘å¡åç§°]</span><br>    virtual_router_id <span class="hljs-number">51</span><span class="hljs-comment">#æŒ‡å®šVRRPå®ä¾‹IDï¼ŒèŒƒå›´æ˜¯0-255</span><br>    priority <span class="hljs-number">100</span><span class="hljs-comment">#æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å°†æˆä¸ºMASTER</span><br>    advert_int <span class="hljs-number">1</span><span class="hljs-comment">#æŒ‡å®šå‘é€VRRPé€šå‘Šçš„é—´éš”ï¼Œå•ä½æ˜¯ç§’</span><br>    authentication &#123;<span class="hljs-comment">#vrrpä¹‹é—´é€šä¿¡çš„è®¤è¯ä¿¡æ¯</span><br>        auth_type PASS<span class="hljs-comment">#æŒ‡å®šè®¤è¯æ–¹å¼ã€‚PASSç®€å•å¯†ç è®¤è¯(æ¨è)</span><br>        auth_pass <span class="hljs-number">1111</span><span class="hljs-comment">#æŒ‡å®šè®¤è¯ä½¿ç”¨çš„å¯†ç ï¼Œæœ€å¤š8ä½</span><br>    &#125;<br>    virtual_ipaddress &#123; <span class="hljs-comment">#è™šæ‹ŸIPåœ°å€è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œä¾›ç”¨æˆ·è®¿é—®ä½¿ç”¨ï¼Œå¯è®¾ç½®å¤šä¸ªï¼Œä¸€è¡Œä¸€ä¸ª</span><br>        <span class="hljs-number">192.168</span>.<span class="hljs-number">200.222</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å¯åŠ¨keepalived"><a href="#å¯åŠ¨keepalived" class="headerlink" title="å¯åŠ¨keepalived"></a>å¯åŠ¨keepalived</h5><ol><li><p>å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /å®‰è£…ç›®å½•/local/sbin<br>./keepalived<br></code></pre></td></tr></table></figure></li><li><p><code>ip a</code>æŸ¥çœ‹ipï¼Œè™šæ‹ŸIP(VIP)ä¼šåœ¨MASTERèŠ‚ç‚¹ä¸Šï¼Œå½“MASTERèŠ‚ç‚¹ä¸Šçš„<strong>keepalived</strong>å‡ºé—®é¢˜ä»¥åï¼Œå› ä¸ºBACKUPæ— æ³•æ”¶åˆ°MASTERå‘å‡ºçš„VRRPçŠ¶æ€é€šè¿‡ä¿¡æ¯ï¼Œå°±ä¼šç›´æ¥å‡ä¸ºMASTERã€‚VIPä¹Ÿä¼šâ€æ¼‚ç§»â€åˆ°æ–°çš„MASTERã€‚</p></li><li><p>å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬æ¥æ£€æµ‹å½“nginxè¿›ç¨‹æŒ‚äº†çš„æ—¶å€™å…³é—­keepalivedï¼Œä»è€Œè‡ªåŠ¨åˆ‡æ¢masteråˆ°å¦ä¸€å°nginxä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç¼–å†™è„šæœ¬ck_nginx.shï¼Œè¯¥è„šæœ¬çš„æ„æ€æ˜¯æ£€æŸ¥nginxè¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œï¼Œ</span><br><span class="hljs-comment"># å¦‚æœæ£€æµ‹ä¸åˆ°nginxè¿›ç¨‹ï¼Œåˆ™å…³é—­keepalived</span><br><br><span class="hljs-comment">#!/bin/bash</span><br>num=`ps -C nginx --no-header | <span class="hljs-built_in">wc</span> -l`<br><span class="hljs-keyword">if</span> [ `ps -C nginx --no-header | <span class="hljs-built_in">wc</span> -l` -eq 0 ]; <span class="hljs-keyword">then</span><br>killall keepalived<br><span class="hljs-keyword">fi</span><br><br><br><span class="hljs-comment"># ç»™è„šæœ¬è®¾ç½®æƒé™</span><br><span class="hljs-built_in">chmod</span> 755 ck_nginx.sh<br><br><br><span class="hljs-comment"># åœ¨keepalivedé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„é…ç½®åƒ</span><br>vrrp_script è„šæœ¬åç§°<br>&#123;<br>    script <span class="hljs-string">&quot;è„šæœ¬ä½ç½®&quot;</span><br>    interval 3 <span class="hljs-comment">#æ‰§è¡Œæ—¶é—´é—´éš”</span><br>    weight -20 <span class="hljs-comment">#åŠ¨æ€è°ƒæ•´vrrp_instanceçš„ä¼˜å…ˆçº§</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="åˆ¶ä½œä¸‹è½½ç«™ç‚¹"><a href="#åˆ¶ä½œä¸‹è½½ç«™ç‚¹" class="headerlink" title="åˆ¶ä½œä¸‹è½½ç«™ç‚¹"></a>åˆ¶ä½œä¸‹è½½ç«™ç‚¹</h4><ol><li><p>å°†è¦è¢«ä¸‹è½½çš„èµ„æºæ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹</p></li><li><p>ä¿®æ”¹nginxé…ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /download&#123;<br><span class="hljs-comment"># è¢«ä¸‹è½½èµ„æºè·¯å¾„</span><br>    <span class="hljs-attribute">root</span> /usr/local;<br>    <span class="hljs-comment"># å¼€å¯åŠŸèƒ½</span><br>    <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-comment"># æ˜¯å¦å±•ç¤ºæ–‡ä»¶å¤§å°</span><br>    <span class="hljs-attribute">autoindex_exact_size</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-comment"># ç›®å½•åˆ—è¡¨çš„æ ¼å¼ï¼Œå¯ä»¥æ˜¯html/xml/json/jsonpï¼Œé»˜è®¤html</span><br>    <span class="hljs-attribute">autoindex_format</span> html;<br>    <span class="hljs-comment"># æ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºæ—¶é—´</span><br>    <span class="hljs-attribute">autoindex_localtime</span> <span class="hljs-literal">on</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h4><p>Luaæ˜¯ç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚åº”ç”¨åœ¨æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚</p><p><a href="https://www.lua.org/">å®˜ç½‘</a></p><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><ol><li><p>ä¸‹è½½å‹ç¼©åŒ…åˆ°æœåŠ¡å™¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>www.lua.org<span class="hljs-regexp">/ftp/</span>lua-<span class="hljs-number">5.4</span>.<span class="hljs-number">4</span>.tar.gz<br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥ç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make linux <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">make <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç‰ˆæœ¬</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">lua -v</span><br></code></pre></td></tr></table></figure></li></ol><h5 id="äº¤äº’æ–¹å¼"><a href="#äº¤äº’æ–¹å¼" class="headerlink" title="äº¤äº’æ–¹å¼"></a>äº¤äº’æ–¹å¼</h5><p><strong>1.äº¤äº’å¼</strong></p><p>é€šè¿‡å‘½ä»¤<code>lua</code>è¿›å…¥æ§åˆ¶å°</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># lua</span><br>&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World&quot;</span>)<br></code></pre></td></tr></table></figure><p><strong>2.è„šæœ¬å¼</strong></p><p>åˆ›å»ºhello.luaæ–‡ä»¶ï¼Œç¼–å†™è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vim hello.lua</span><br><br><span class="hljs-comment"># ç¼–å†™è„šæœ¬</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello World&quot;</span>)<br><br><span class="hljs-comment"># æ‰§è¡Œ</span><br><span class="hljs-built_in">chmod</span> 755 hello.lua<br>lua hello.lua<br><br><span class="hljs-comment"># ä¹Ÿå¯ä»¥åœ¨æ–‡ä»¶å¼€å¤´æŒ‡å®šè§£é‡Šå™¨ï¼Œæ‰§è¡Œçš„æ—¶å€™ç›´æ¥ç”¨æ–‡ä»¶åå°±è¡Œäº†</span><br><span class="hljs-comment">#!/usr/local/bin/lua</span><br></code></pre></td></tr></table></figure><h5 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h5><h6 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h6><p><strong>å•è¡Œæ³¨é‡Š</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">-- æ³¨é‡Š</span><br></code></pre></td></tr></table></figure><p><strong>å¤šè¡Œæ³¨é‡Š</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">--[[</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">--]]</span><br></code></pre></td></tr></table></figure><blockquote><p>å¤šè¡Œæ³¨é‡Šåªéœ€è¦åœ¨å‰é¢å¤šåŠ ä¸€ä¸ª-å°±å¯ä»¥å–æ¶ˆ</p></blockquote><h6 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h6><p><strong>é€»è¾‘è¿ç®—ç¬¦</strong></p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">and</span> --&gt;</span> ä¸<br><span class="hljs-function"><span class="hljs-title">or</span> --&gt;</span> æˆ–<br><span class="hljs-function"><span class="hljs-title">not</span> --&gt;</span> é<br></code></pre></td></tr></table></figure><p>å…¶ä»–è¿ç®—ç¬¦</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">..</span> è¿æ¥å­—ç¬¦ä¸²<br><span class="hljs-comment"># è¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦</span><br></code></pre></td></tr></table></figure><h6 id="å®šä¹‰å˜é‡"><a href="#å®šä¹‰å˜é‡" class="headerlink" title="å®šä¹‰å˜é‡"></a>å®šä¹‰å˜é‡</h6><p>é»˜è®¤ä¸ºå…¨å±€å˜é‡ï¼Œå®šä¹‰å±€éƒ¨å˜é‡è¦åœ¨å‰é¢åŠ <code>local</code></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><span class="hljs-comment">;</span><br>local b <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h6 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h6><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">nil</span><span class="hljs-params">(ç©ºï¼Œæ— æ•ˆå€¼)</span></span><br><span class="hljs-function"><span class="hljs-title">boolean</span><span class="hljs-params">(å¸ƒå°”ï¼Œtrue/false)</span></span><br><span class="hljs-function"><span class="hljs-title">number</span><span class="hljs-params">(æ•°å€¼)</span></span>ï¼šåªæœ‰falseå’Œnilä¸ºå‡<br><span class="hljs-function"><span class="hljs-title">string</span><span class="hljs-params">(å­—ç¬¦ä¸²)</span></span><br><span class="hljs-function"><span class="hljs-title">function</span><span class="hljs-params">(å‡½æ•°)</span></span><br>tableï¼ˆè¡¨ï¼‰<br><span class="hljs-function"><span class="hljs-title">thread</span><span class="hljs-params">(çº¿ç¨‹)</span></span><br>userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰<br></code></pre></td></tr></table></figure><p><strong>è¡¨</strong></p><p>å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ•°ç»„ã€å­—å…¸æˆ–æ··åˆä½¿ç”¨ï¼Œä¸‹æ ‡ä»1å¼€å§‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªè¡¨</span><br><span class="hljs-attribute">arr</span> = &#123;&#125;<br><span class="hljs-attribute">arr</span> = &#123;<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>&#125;<br><span class="hljs-attribute">arr</span> = &#123;X = <span class="hljs-number">10</span>, Y = <span class="hljs-number">20</span>, Z = <span class="hljs-number">30</span>&#125;<br><span class="hljs-attribute">arr</span> = &#123;<span class="hljs-string">&quot;a&quot;</span>, X = <span class="hljs-number">10</span>, <span class="hljs-string">&quot;b&quot;</span>&#125;<br><br><span class="hljs-comment"># è·å–è¡¨é‡Œçš„å€¼</span><br><span class="hljs-attribute">arr</span> = &#123;<span class="hljs-string">&quot;a&quot;</span>, X = <span class="hljs-number">10</span>, <span class="hljs-string">&quot;b&quot;</span>&#125;<br><span class="hljs-attribute">arr</span>[<span class="hljs-number">0</span>]-- nil<br><span class="hljs-attribute">arr</span>[<span class="hljs-number">1</span>] -- <span class="hljs-string">&quot;a&quot;</span><br><span class="hljs-attribute">arr</span>[<span class="hljs-number">2</span>]-- <span class="hljs-string">&quot;b&quot;</span><br><span class="hljs-attribute">arr</span>[<span class="hljs-string">&quot;X&quot;</span>]-- <span class="hljs-number">10</span><br><span class="hljs-attribute">arr</span>.X-- <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h6 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h6><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs lua"># å®šä¹‰å‡½æ•°<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span><span class="hljs-params">(params)</span></span><br><span class="hljs-comment">-- æ–¹æ³•çš„å†…å®¹</span><br><span class="hljs-keyword">end</span><br><br># æ–¹æ³•å®šä¹‰çš„å‚æ•°å¹¶ééƒ½è¦ä¼ å…¥ï¼Œä¼ å…¥çš„ä¼šæŒ‰é¡ºåºèµ‹å€¼ï¼Œæ²¡èµ‹å€¼çš„å‚æ•°ä¸º<span class="hljs-literal">nil</span>ï¼›å¦‚æœä¼ å…¥çš„å‚æ•°æ•°é‡å¤§äºæ–¹æ³•éœ€è¦çš„å‚æ•°æ•°é‡ï¼Œåˆ™ä¼šä¸¢å¼ƒå¤šå‡ºæ¥çš„å‚æ•°<br><br># å¯å˜é•¿å‚æ•°<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span><span class="hljs-params">(...)</span></span><br>a, b, c = ...;<br><span class="hljs-built_in">print</span>(a, b, c);<br><span class="hljs-keyword">end</span><br><br># æ–¹æ³•è¿”å›å€¼æ•°é‡ä¹Ÿæ˜¯å¯å˜çš„<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>;<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h6 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h6><p>if</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> æ¡ä»¶ <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- ä»£ç </span><br><span class="hljs-keyword">elseif</span> æ¡ä»¶ <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- ä»£ç </span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-comment">-- ä»£ç </span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h6 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h6><p>while</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">while</span> æ¡ä»¶ <span class="hljs-keyword">do</span><br><span class="hljs-comment">-- ä»£ç </span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>repeat</p><p>ç›´åˆ°æ»¡è¶³æ¡ä»¶æ‰é€€å‡ºå¾ªç¯</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">repeat</span><br><span class="hljs-comment">-- ä»£ç </span><br><span class="hljs-keyword">until</span> æ¡ä»¶<br></code></pre></td></tr></table></figure><p>for</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment">-- å¾ªç¯ä»startå¼€å§‹åˆ°endç»“æŸï¼›stepä¸ºæ­¥é•¿ï¼Œé»˜è®¤ä¸º1</span><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">param</span>=<span class="hljs-built_in">start</span>,<span class="hljs-keyword">end</span>,step <span class="hljs-built_in">do</span><br> å¾ªç¯ä½“<br><span class="hljs-function"><span class="hljs-keyword">end</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">-- éå†è¡¨</span><br><span class="hljs-comment">-- ipairsä¸ºè¿­ä»£å™¨ï¼Œxä¸ºè¡¨</span><br><span class="hljs-comment">-- ipairsä¸èƒ½éå†å‡ºé”®å€¼å¯¹ï¼Œè¦éå†é”®å€¼å¯¹è¦ç”¨pairs</span><br><span class="hljs-keyword">for</span> i,v <span class="hljs-keyword">in</span> ipairs(x) <span class="hljs-built_in">do</span><br>å¾ªç¯ä½“<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h5 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h5><p>OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚OpenRestyå†…éƒ¨å·²ç»é›†æˆäº†Nginxå’ŒLuaã€‚</p><h6 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h6><ol><li><p>ä¸‹è½½ã€è§£å‹å‹ç¼©åŒ…<a href="https://openresty.org/en/download.html">OpenResty - Download</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>openresty.org<span class="hljs-regexp">/download/</span>openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span>.tar.gz<br>tar -zxvf openresty-<span class="hljs-number">1.15</span>.<span class="hljs-number">8.2</span>.tar.gz<br></code></pre></td></tr></table></figure></li><li><p>è¿›å…¥openrestyç›®å½•ï¼Œç¼–è¯‘å®‰è£…</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss">./configure<br><span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure></li><li><p>é»˜è®¤å®‰è£…ä½ç½®<code>/usr/local/openresty/nginx/</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/openresty/</span>nginx/<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># ä¿®æ”¹é…ç½®</span><br>location /lua&#123;<br>    default_type <span class="hljs-string">&#x27;text/html&#x27;</span>;<br>    content_by_lua <span class="hljs-string">&#x27;ngx.say(&quot;&lt;h1&gt;HELLO,OpenRestry&lt;/h1&gt;&quot;)&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment"># æµ‹è¯•</span><br>.<span class="hljs-regexp">/sbin/</span>nginx -t<br><span class="hljs-comment"># å¯åŠ¨</span><br>.<span class="hljs-regexp">/sbin/</span>nginx<br><br><span class="hljs-comment"># æµè§ˆå™¨è®¿é—®</span><br></code></pre></td></tr></table></figure></li></ol><h6 id="ä½¿ç”¨ngx-luaæŒ‡ä»¤"><a href="#ä½¿ç”¨ngx-luaæŒ‡ä»¤" class="headerlink" title="ä½¿ç”¨ngx_luaæŒ‡ä»¤"></a>ä½¿ç”¨ngx_luaæŒ‡ä»¤</h6><p><strong>init_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚<br></code></pre></td></tr></table></figure><p><strong>init_worker_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚<br></code></pre></td></tr></table></figure><p><strong>set_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚<br></code></pre></td></tr></table></figure><p><strong>rewrite_by_lua</strong></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨<span class="hljs-built_in">URL</span>é‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–<span class="hljs-built_in">URL</span>é‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure><p><strong>access_by_lua</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘<span class="hljs-built_in">IP</span>è®¿é—®ã€‚<br></code></pre></td></tr></table></figure><p><strong>content_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚<br></code></pre></td></tr></table></figure><p><strong>header_filter_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><p><strong>body_filter_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚<br></code></pre></td></tr></table></figure><p><strong>log_by_lua</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">è¯¥æŒ‡ä»¤ç”¨äºåœ¨<span class="hljs-built_in">log</span>è¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰<span class="hljs-built_in">log</span>å¤„ç†ã€‚<br></code></pre></td></tr></table></figure><p><strong>balancer_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³•<br></code></pre></td></tr></table></figure><p><strong>ssl_certificate_by_lua</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚<br></code></pre></td></tr></table></figure><p>ä¾‹</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs 1c">location /getByGender &#123;<br>default_type &#x27;text/html&#x27;;<br>set_by_lua $name <span class="hljs-string">&quot;</span><br>local uri_args = ngx.req.get_uri_args()<br>gender = uri_args[&#x27;gender&#x27;]<br>name = uri_args[&#x27;name&#x27;]<br>if gender==&#x27;1&#x27; then<br>return name..&#x27;å…ˆç”Ÿ&#x27;<br>elseif gender==&#x27;0&#x27; then<br>return name..&#x27;å¥³å£«&#x27;<br>else<br>return name<br>end<br><span class="hljs-string">&quot;;</span><br>header_filter_by_lua <span class="hljs-string">&quot;</span><br>ngx.header.aaa=&#x27;bbb&#x27;<br><span class="hljs-string">&quot;;</span><br>return <span class="hljs-number">200</span> $name;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="ngx-luaæ“ä½œRedis"><a href="#ngx-luaæ“ä½œRedis" class="headerlink" title="ngx_luaæ“ä½œRedis"></a>ngx_luaæ“ä½œRedis</h6> <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">lua</span>-resty-redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰redis = require <span class="hljs-string">&quot;resty.redis&quot;</span><br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰<span class="hljs-keyword">new</span><br>è¯­æ³•: redis,err = <span class="hljs-keyword">redi</span><span class="hljs-variable">s:new</span>(),åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰connect<br>è¯­æ³•:ok,err=<span class="hljs-keyword">redi</span><span class="hljs-variable">s:connect</span>(host,port[,options_table]),è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚<br>ok:è¿æ¥æˆåŠŸè¿”å› <span class="hljs-number">1</span>ï¼Œè¿æ¥å¤±è´¥è¿”å›nil<br>err:è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰set_timeout<br>è¯­æ³•: <span class="hljs-keyword">redi</span><span class="hljs-variable">s:set_timeout</span>(time) ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚<br>ï¼ˆ<span class="hljs-number">5</span>ï¼‰<span class="hljs-keyword">close</span><br>è¯­æ³•: ok,err = <span class="hljs-keyword">redi</span><span class="hljs-variable">s:close</span>(),å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›<span class="hljs-number">1</span>ï¼Œå¤±è´¥è¿”å›nilå’Œé”™è¯¯ä¿¡æ¯<br>ï¼ˆ<span class="hljs-number">6</span>ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³•<br>åœ¨<span class="hljs-keyword">lua</span>-resty-redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚<br><br></code></pre></td></tr></table></figure><h6 id="ngx-luaæ“ä½œmysql"><a href="#ngx-luaæ“ä½œmysql" class="headerlink" title="ngx_luaæ“ä½œmysql"></a>ngx_luaæ“ä½œmysql</h6><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ï¼ˆ<span class="hljs-number">1</span>ï¼‰å¼•å…¥&quot;resty.mysql&quot;æ¨¡å—<br><span class="hljs-keyword">local</span> mysql = require &quot;resty.mysql&quot;<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰<span class="hljs-built_in">new</span><br>åˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸ºnilï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯<br>è¯­æ³•: db,err = mysql:<span class="hljs-built_in">new</span>()<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰<span class="hljs-keyword">connect</span><br>å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨<br>è¯­æ³•:ok,err=db:<span class="hljs-keyword">connect</span>(<span class="hljs-keyword">options</span>),<span class="hljs-keyword">options</span>æ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯<br>    host:æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€<br>    port:æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º<span class="hljs-number">3306</span><br>    <span class="hljs-keyword">user</span>:ç™»å½•çš„ç”¨æˆ·å<br>    <span class="hljs-keyword">password</span>:ç™»å½•å¯†ç <br>    <span class="hljs-keyword">database</span>:ä½¿ç”¨çš„æ•°æ®åº“å<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰set_timeout<br>è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´(ms)ï¼ŒåŒ…æ‹¬<span class="hljs-keyword">connect</span>æ–¹æ³•<br>è¯­æ³•:db:set_timeout(<span class="hljs-type">time</span>)<br>ï¼ˆ<span class="hljs-number">5</span>ï¼‰<span class="hljs-keyword">close</span><br>å…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›<span class="hljs-number">1</span>ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›nilå’Œé”™è¯¯æè¿°ã€‚<br>è¯­æ³•:db:<span class="hljs-keyword">close</span>()<br>ï¼ˆ<span class="hljs-number">6</span>ï¼‰send_query<br>å¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›nilå’Œé”™è¯¯æè¿°<br>è¯­æ³•:bytes,err=db:send_query(<span class="hljs-keyword">sql</span>)<br>ï¼ˆ<span class="hljs-number">7</span>ï¼‰read_result<br>ä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨,è¯­æ³•:<br>res, err, errcode, <span class="hljs-built_in">sqlstate</span> = db:read_result() <br>res, err, errcode, <span class="hljs-built_in">sqlstate</span> = db:read_result(<span class="hljs-keyword">rows</span>) :<span class="hljs-keyword">rows</span>æŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º<span class="hljs-number">4</span><br>å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-<span class="hljs-keyword">value</span>å¯¹ï¼Œå¦‚<br><br>    &#123;<br>      &#123;id=<span class="hljs-number">1</span>,username=&quot;TOM&quot;,birthday=&quot;1988-11-11&quot;,salary=<span class="hljs-number">10000.0</span>&#125;,<br>      &#123;id=<span class="hljs-number">2</span>,username=&quot;JERRY&quot;,birthday=&quot;1989-11-11&quot;,salary=<span class="hljs-number">20000.0</span>&#125;<br>    &#125;<br>å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ®<br>    &#123;<br>    insert_id = <span class="hljs-number">0</span>,<br>    server_status=<span class="hljs-number">2</span>,<br>    warning_count=<span class="hljs-number">1</span>,<br>    affected_rows=<span class="hljs-number">2</span>,<br>    message=nil<br>    &#125;<br>è¿”å›å€¼:<br>res:æ“ä½œçš„ç»“æœé›†<br>err:é”™è¯¯ä¿¡æ¯<br>errcode:MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚<span class="hljs-number">1064</span><br><span class="hljs-built_in">sqlstate</span>:è¿”å›ç”±<span class="hljs-number">5</span>ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†<span class="hljs-keyword">SQL</span>é”™è¯¯ç ï¼Œæ¯”å¦‚<span class="hljs-number">42000</span><br><br></code></pre></td></tr></table></figure><h4 id="å…·ä½“åº”ç”¨"><a href="#å…·ä½“åº”ç”¨" class="headerlink" title="å…·ä½“åº”ç”¨"></a>å…·ä½“åº”ç”¨</h4><ul><li><p>éƒ¨ç½²é™æ€èµ„æº</p><p>å°†é™æ€èµ„æºæ”¾åˆ°htmlæ–‡ä»¶å¤¹ä¸‹</p></li><li><p>åå‘ä»£ç†</p><blockquote><p>æ­£å‘ä»£ç†:ä»£ç†çš„æ˜¯å®¢æœç«¯,å¯¹å®¢æœç«¯è´Ÿè´£,å¸®åŠ©å®¢æœç«¯è®¿é—®æœåŠ¡å™¨</p><p>åå‘ä»£ç†:ä»£ç†çš„æ˜¯æœåŠ¡ç«¯,å¯¹æœåŠ¡ç«¯è´Ÿè´£,å¸®åŠ©æœåŠ¡å™¨æä¾›æœåŠ¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs linux">#åœ¨é…ç½®æ–‡ä»¶ä¸­çš„httpä¸­é…ç½®åå‘ä»£ç†,è®°å¾—å¼€æ”¾ç«¯å£<br>server &#123;<br>        listen       80;#ç›‘å¬çš„ç«¯å£ï¼Œå½“è®¿é—®è¿™ä¸ªç«¯å£æ—¶è½¬å‘åˆ°æŒ‡å®šæœåŠ¡å™¨<br>        server_name  localhost;<br>        location / &#123;<br>proxy_pass:http://192.168.229.130:8080;#è½¬å‘çš„æœåŠ¡å™¨<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è´Ÿè½½å‡è¡¡</p><blockquote><p>åŸºäºåå‘ä»£ç†ï¼Œæ ¹æ®ç®—æ³•å°†ç”¨æˆ·è¯·æ±‚åˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨ä¸Š</p></blockquote><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>weight</td><td>æƒé‡æ–¹å¼ï¼Œå€¼è¶Šå¤§åˆ†é…å‡ ç‡è¶Šé«˜</td></tr><tr><td>ip_hash</td><td>æ ¹æ®å®¢æˆ·ç«¯ip</td></tr><tr><td>least_conn</td><td>æ ¹æ®æœ€å°‘è¿æ¥æ–¹å¼</td></tr><tr><td>url_hash</td><td>æ ¹æ®urlåˆ†é…æ–¹å¼</td></tr><tr><td>fair</td><td>æ ¹æ®å“åº”æ—¶é—´æ–¹å¼</td></tr><tr><td>è½®è¯¢</td><td>é»˜è®¤</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs linux">#é…ç½®è´Ÿè½½å‡è¡¡<br>upstream targetserver&#123;#upstreamæŒ‡ä»¤æ¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨<br>server 192.168.229.130:8080;<br>server 192.168.229.131:8080;<br>server 192.168.229.131:8081;<br>&#125;<br><br>server &#123;<br>        listen       80;#ç›‘å¬çš„ç«¯å£ï¼Œå½“è®¿é—®è¿™ä¸ªç«¯å£æ—¶è½¬å‘åˆ°æŒ‡å®šæœåŠ¡å™¨<br>        server_name  localhost;<br>        location / &#123;<br>proxy_pass:http://targetserver;#è½¬å‘çš„æœåŠ¡å™¨<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>è®°å¾—<code>./sbin/nginx -s reload</code>é‡æ–°åŠ è½½</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>nginx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLä¸»ä»é…ç½®</title>
    <link href="/2022/08/19/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/08/19/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/MySQL%E4%B8%BB%E4%BB%8E%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="MySQLä¸»ä»é…ç½®"><a href="#MySQLä¸»ä»é…ç½®" class="headerlink" title="MySQLä¸»ä»é…ç½®"></a>MySQLä¸»ä»é…ç½®</h2><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><ul><li>ä¸»ä»æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œä½æ•°ä¸€è‡´ï¼›</li><li>Master å’Œ Slave æ•°æ®åº“çš„ç‰ˆæœ¬è¦ä¸€è‡´ï¼›</li><li>Master å’Œ Slave æ•°æ®åº“ä¸­çš„æ•°æ®è¦ä¸€è‡´ï¼›</li><li>Master å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œ Master å’Œ Slave çš„ server_id åœ¨å±€åŸŸç½‘å†…å¿…é¡»å”¯ä¸€ï¼›</li></ul><h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><p>â€‹<strong>ä¸»åº“é…ç½®</strong></p><ol><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;my.cnf(windowsä¸‹åœ¨my.iniæ–‡ä»¶ä¸­)</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">log-bin</span>=master-bin<span class="hljs-comment">#å¼€å¯äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="hljs-attr">server-id</span>=<span class="hljs-number">100</span><span class="hljs-comment">#æœåŠ¡å™¨å”¯ä¸€ID</span><br></code></pre></td></tr></table></figure></li><li><p>é‡å¯mysqlæœåŠ¡</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart mysqld</span><br></code></pre></td></tr></table></figure></li><li><p>ç™»å½•mysqlåˆ›å»ºä¸€ä¸ªç”¨æˆ·å¹¶èµ‹äºˆREPLICATION SLAVEæƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE USER &#x27;username&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;password&#x27;;<br>GRANT REPLICATION SLAVE ON *.* TO &#x27;username&#x27;@&#x27;%&#x27;;<br>ALTER USER &#x27;username&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;password&#x27;;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ä¸»åº“çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show master status;<br></code></pre></td></tr></table></figure></li></ol><p>â€‹<strong>ä»åº“é…ç½®</strong></p><ol><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">server-id</span>=<span class="hljs-number">101</span><span class="hljs-comment">#æœåŠ¡å™¨å”¯ä¸€ID</span><br></code></pre></td></tr></table></figure></li><li><p>é‡å¯mysqlæœåŠ¡</p></li><li><p>è®¾ç½®ä¸»èŠ‚ç‚¹å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CHANGE MASTER TO<br>MASTER_HOST=&#x27;192.168.229.168&#x27;,<br>MASTER_USER=&#x27;zs&#x27;,<br>MASTER_PASSWORD=&#x27;123456&#x27;,<br>MASTER_LOG_FILE=&#x27;master-bin.000001&#x27;,#æŸ¥çœ‹ä¸»åº“çŠ¶æ€æ—¶Fileåˆ—çš„å‚æ•°<br>MASTER_LOG_POS=3578;#æŸ¥çœ‹ä¸»åº“çŠ¶æ€æ—¶Positionåˆ—çš„å‚æ•°<br></code></pre></td></tr></table></figure></li><li><p>å¼€å¯ä¸»ä»æœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">start slave;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show slave status \G<br></code></pre></td></tr></table></figure></li></ol><h4 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h4><ol><li>Slave_SQL_Running: NO</li></ol><p>è§£å†³æ–¹å¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; stop slave ;<br>mysql&gt; set GLOBAL SQL_SLAVE_SKIP_COUNTER=1;<br>mysql&gt; start slave ;<br><br>æˆ–è€…ä¸»èŠ‚ç‚¹å‚æ•°é…ç½®é”™è¯¯ï¼Œé‡æ–°é…ç½®ä¸€é<br></code></pre></td></tr></table></figure><ol start="2"><li>Slave_IO_Running: NO&#x2F;Collecting</li></ol><p>è§£å†³æ–¹å¼:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ¯æ¬¡æ•°æ®åº“é‡å¯åéƒ½ä¼šå¯¼è‡´master statuså‘ç”Ÿå˜åŒ–,é‡æ–°é…ç½®ä»åº“çš„ä¸»èŠ‚ç‚¹å‚æ•°<br><br>æˆ–è€…å¤åˆ¶è™šæ‹Ÿæœºæ—¶æ•°æ®åº“çš„uuidç›¸åŒï¼Œåˆ é™¤<span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/</span>auto.cnfæ–‡ä»¶åé‡å¯æ•°æ®åº“<br>systemctl restart mysqld<br><br>æˆ–è€…é˜²ç«å¢™æ²¡å…³<br></code></pre></td></tr></table></figure><h4 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h4><p>ä¸»åº“è´Ÿè´£å¢åˆ æ”¹ï¼Œä»åº“è´Ÿè´£æŸ¥</p><p><strong>Sharding-JDBC</strong></p><p>è½»é‡çº§javaæ¡†æ¶ï¼Œå¢å¼ºJDBCåŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­å®ç°æ•°æ®åº“è¯»å†™åˆ†ç¦»</p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-comment"># å®šä¹‰æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">names:</span><br>        <span class="hljs-string">master,slave</span><br>      <span class="hljs-comment"># ä¸»æ•°æ®æº</span><br>      <span class="hljs-attr">master:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.229.168:3306/rw?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-comment"># ä»æ•°æ®æº</span><br>      <span class="hljs-attr">slave:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.229.130:3306/rw?characterEncoding=utf-8</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">masterslave:</span><br>      <span class="hljs-comment"># è¯»å†™åˆ†ç¦»é…ç½®ï¼ˆè½®è¯¢ï¼‰</span><br>      <span class="hljs-attr">load-balance-algorithm-type:</span> <span class="hljs-string">round_robin</span><br>      <span class="hljs-comment"># æœ€ç»ˆçš„æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">dataSource</span><br>      <span class="hljs-comment"># ä¸»åº“æ•°æ®æºåç§°</span><br>      <span class="hljs-attr">master-data-source-name:</span> <span class="hljs-string">master</span><br>      <span class="hljs-comment"># ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš”</span><br>      <span class="hljs-attr">slave-data-source-names:</span> <span class="hljs-string">slave</span><br>    <span class="hljs-attr">props:</span><br>      <span class="hljs-attr">sql:</span><br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¼€å¯SQLæ˜¾ç¤ºï¼Œé»˜è®¤false</span><br>  <span class="hljs-attr">main:</span><br>  <span class="hljs-comment">#Shardingå’ŒDruidçš„ç±»æœ‰é‡åçš„ï¼Œéœ€è¦åŠ ä¸Šè¿™ä¸ªé…ç½®</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCache</title>
    <link href="/2022/08/19/spring/SpringCache/"/>
    <url>/2022/08/19/spring/SpringCache/</url>
    
    <content type="html"><![CDATA[<h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><p>é€šè¿‡æ³¨è§£æ¥å®ç°ç¼“å­˜ï¼Œåº•å±‚å¯ä»¥åˆ‡æ¢ä¸åŒçš„cacheå®ç°ï¼Œé€šè¿‡CacheManageræ¥å£æ¥ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜æŠ€æœ¯</p><p>å¯¹ä¸åŒçš„ç¼“å­˜æŠ€æœ¯éœ€è¦å®ç°ä¸åŒçš„CacheManager</p><table><thead><tr><th>CacheManager</th><th>æè¿°</th></tr></thead><tbody><tr><td>EhCacheCacheManager</td><td>ä½¿ç”¨EhCacheç¼“å­˜æŠ€æœ¯</td></tr><tr><td>GuavaCacheManager</td><td>ä½¿ç”¨Guavaç¼“å­˜æŠ€æœ¯</td></tr><tr><td>RedisCacheManager</td><td>ä½¿ç”¨Redisç¼“å­˜æŠ€æœ¯</td></tr></tbody></table><h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@EnableCaching</td><td>å¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</td></tr><tr><td>@Cacheable</td><td>ä¼˜å…ˆä»ç¼“å­˜ä¸­å–æ•°æ®ï¼Œæ²¡æœ‰å»æ•°æ®åº“å–</td></tr><tr><td>@CachePut</td><td>å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°å†…å­˜ä¸­</td></tr><tr><td>@CacheEvict</td><td>å°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤</td></tr></tbody></table><h4 id="å®ä¾‹1"><a href="#å®ä¾‹1" class="headerlink" title="å®ä¾‹1"></a>å®ä¾‹1</h4><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ä¸ä½¿ç”¨é»˜è®¤ç¼“å­˜æŠ€æœ¯ï¼Œä½¿ç”¨åˆ°å…¶ä»–ç¼“å­˜æŠ€æœ¯æ—¶è¦å¯¼å…¥è¿™ä¸ªåæ ‡ --&gt;</span><br><span class="hljs-comment">&lt;!-- åŠç›¸åº”ç¼“å­˜æŠ€æœ¯çš„åæ ‡ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®ç›¸åº”æŠ€æœ¯</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span> <br>    <span class="hljs-attr">redis:</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>        <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">cache:</span><br>        <span class="hljs-attr">redis:</span><br>          <span class="hljs-attr">time-to-live:</span> <span class="hljs-number">1800000</span> <span class="hljs-comment">#ç¼“å­˜è¿‡æœŸæ—¶é—´</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ç±»åŠ @EnableCachingæ³¨è§£</p><p>åœ¨è¦ç¼“å­˜çš„æ–¹æ³•ä¸ŠåŠ æ³¨è§£, è¿”å›å€¼ä¼šè¢«å­˜åˆ°redisä¸­, <strong>è¿”å›å€¼å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-meta">@Cacheable(value = &quot;setmealCache&quot;, key = &quot;#setmeal.categoryId + &#x27;_&#x27; + #setmeal.status&quot;)</span><br>    <span class="hljs-keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(Setmeal setmeal)</span> &#123;...&#125;<br></code></pre></td></tr></table></figure><h4 id="å®ä¾‹2"><a href="#å®ä¾‹2" class="headerlink" title="å®ä¾‹2"></a>å®ä¾‹2</h4><blockquote><p>åœ¨å¾®æœåŠ¡ä¸­ä½¿ç”¨spring cache</p><p>ä¾‹å­æ¥è‡ªå°šåŒ»é€š</p></blockquote><ul><li><p>åœ¨commonç»„ä»¶ä¸­æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- redis --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨commonç»„ä»¶ä¸­æ·»åŠ redisé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xw.config;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è‡ªå®šä¹‰keyè§„åˆ™</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> KeyGenerator <span class="hljs-title function_">keyGenerator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyGenerator</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">generate</span><span class="hljs-params">(Object target, Method method, Object... params)</span> &#123;<br>                <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>                sb.append(target.getClass().getName());<br>                sb.append(method.getName());<br>                <span class="hljs-keyword">for</span> (Object obj : params) &#123;<br>                    sb.append(obj.toString());<br>                &#125;<br>                <span class="hljs-keyword">return</span> sb.toString();<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®RedisTemplateè§„åˆ™</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> redisConnectionFactory</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br>        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        redisTemplate.setConnectionFactory(redisConnectionFactory);<br>        <span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br><br>     <span class="hljs-comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span><br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        <span class="hljs-comment">// æŒ‡å®šè¦åºåˆ—åŒ–çš„åŸŸï¼Œfield,getå’Œset,ä»¥åŠä¿®é¥°ç¬¦èŒƒå›´ï¼ŒANYæ˜¯éƒ½æœ‰åŒ…æ‹¬privateå’Œpublic</span><br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        <span class="hljs-comment">// æŒ‡å®šåºåˆ—åŒ–è¾“å…¥çš„ç±»å‹ï¼Œç±»å¿…é¡»æ˜¯éfinalä¿®é¥°çš„ï¼Œfinalä¿®é¥°çš„ç±»ï¼Œæ¯”å¦‚String,Integerç­‰ä¼šè·‘å‡ºå¼‚å¸¸</span><br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br><br>        <span class="hljs-comment">//åºåˆ—å·key value</span><br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);<br><br>        redisTemplate.afterPropertiesSet();<br>        <span class="hljs-keyword">return</span> redisTemplate;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®CacheManagerç¼“å­˜è§„åˆ™</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> factory</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        RedisSerializer&lt;String&gt; redisSerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        <span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br><br>        <span class="hljs-comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span><br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br><br>        <span class="hljs-comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span><br>        <span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RedisCacheConfiguration.defaultCacheConfig()<br>                .entryTtl(Duration.ofSeconds(<span class="hljs-number">600</span>))<br>                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))<br>                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))<br>                .disableCachingNullValues();<br><br>        <span class="hljs-type">RedisCacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> RedisCacheManager.builder(factory)<br>                .cacheDefaults(config)<br>                .build();<br>        <span class="hljs-keyword">return</span> cacheManager;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li><p>åœ¨ä½¿ç”¨åˆ°ç¼“å­˜çš„æ¨¡å—ä¸­æ·»åŠ é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">spring.redis.host=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>spring.redis.port=<span class="hljs-number">6379</span><br>spring.redis.database= <span class="hljs-number">0</span><br>spring.redis.timeout=<span class="hljs-number">1800000</span><br><br>spring.redis.lettuce.pool.max-active=<span class="hljs-number">20</span><br>spring.redis.lettuce.pool.max-wait=-<span class="hljs-number">1</span><br>#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)<br>spring.redis.lettuce.pool.max-idle=<span class="hljs-number">5</span><br>spring.redis.lettuce.pool.min-idle=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨éœ€è¦ç¼“å­˜çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ ¹æ®idæŸ¥è¯¢å­æ•°æ®åˆ—è¡¨</span><br>    <span class="hljs-meta">@Cacheable(value = &quot;dict&quot;,keyGenerator = &quot;keyGenerator&quot;)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Dict&gt; <span class="hljs-title function_">findChildData</span><span class="hljs-params">(Long id)</span> &#123;<br>        LambdaQueryWrapper&lt;Dict&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        wrapper.eq(Dict::getParentId, id);<br>        List&lt;Dict&gt; dictList = baseMapper.selectList(wrapper);<br>        <span class="hljs-keyword">for</span> (Dict dict : dictList) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasChildren</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.isChildren(dict.getId());<br>            dict.setHasChildren(hasChildren);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dictList;<br>    &#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis</title>
    <link href="/2022/08/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/"/>
    <url>/2022/08/16/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/</url>
    
    <content type="html"><![CDATA[<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>Redisæ˜¯ä¸€æ¬¾åŸºäºå†…å­˜çš„key-valueç»“æ„æ•°æ®åº“</p><p>é»˜è®¤ç«¯å£å·6379</p><ul><li>é”®å€¼ï¼ˆkey-valueï¼‰å‹ï¼Œvalueæ”¯æŒå¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸°å¯Œ</li><li>å•çº¿ç¨‹ï¼Œæ¯ä¸ªå‘½ä»¤å…·å¤‡åŸå­æ€§</li><li>ä½å»¶è¿Ÿï¼Œé€Ÿåº¦å¿«ï¼ˆåŸºäºå†…å­˜ã€IOå¤šè·¯å¤ç”¨ã€è‰¯å¥½çš„ç¼–ç ï¼‰ã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»é›†ç¾¤ã€åˆ†ç‰‡é›†ç¾¤</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯</li></ul><h3 id="ä½¿ç”¨åœºæ‰€"><a href="#ä½¿ç”¨åœºæ‰€" class="headerlink" title="ä½¿ç”¨åœºæ‰€"></a>ä½¿ç”¨åœºæ‰€</h3><ol><li>å­˜æ”¾éªŒè¯ç ã€ç”¨æˆ·ç™»å½•ä¿¡æ¯</li><li>å¯¹ä¸å¸¸å˜åŒ–çš„æ•°æ®è¿›è¡Œç¼“å­˜</li></ol><h3 id="å®‰è£…åŠè¿è¡Œ"><a href="#å®‰è£…åŠè¿è¡Œ" class="headerlink" title="å®‰è£…åŠè¿è¡Œ"></a>å®‰è£…åŠè¿è¡Œ</h3><ol><li><p>å®˜ç½‘ä¸‹è½½å‹ç¼©åŒ…  <a href="https://redis.io/">Rediså®˜ç½‘</a></p></li><li><p>ä¸‹è½½redisæ‰€éœ€ä¾èµ–</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y gcc tcl<br></code></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ å‹ç¼©åŒ…ï¼Œè§£å‹ã€ç¼–è¯‘ã€å®‰è£…ï¼Œé»˜è®¤å®‰è£…åœ¨<code>/usr/local/bin</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf redis-<span class="hljs-number">6</span>.<span class="hljs-number">2</span>.<span class="hljs-number">6</span>.tar.gz<br><span class="hljs-attribute">cd</span> redis-<span class="hljs-number">6</span>.<span class="hljs-number">2</span>.<span class="hljs-number">6</span><br><span class="hljs-attribute">make</span> &amp;&amp; make install<br></code></pre></td></tr></table></figure></li></ol><h4 id="linuxä¸‹è¿è¡Œredis"><a href="#linuxä¸‹è¿è¡Œredis" class="headerlink" title="linuxä¸‹è¿è¡Œredis"></a>linuxä¸‹è¿è¡Œredis</h4><ol><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span><br><span class="hljs-attr">bind</span> <span class="hljs-string">0.0.0.0</span><br><span class="hljs-comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span><br><span class="hljs-attr">daemonize</span> <span class="hljs-string">yes </span><br><span class="hljs-comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span><br><span class="hljs-attr">requirepass</span> <span class="hljs-string">123456</span><br></code></pre></td></tr></table></figure></li><li><p>å…¶ä»–å¸¸ç”¨é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># ç›‘å¬çš„ç«¯å£</span><br><span class="hljs-attr">port</span> <span class="hljs-string">6379</span><br><span class="hljs-comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—ã€æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span><br><span class="hljs-attr">dir</span> <span class="hljs-string">.</span><br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span><br><span class="hljs-attr">databases</span> <span class="hljs-string">1</span><br><span class="hljs-comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span><br><span class="hljs-attr">maxmemory</span> <span class="hljs-string">512mb</span><br><span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span><br><span class="hljs-attr">logfile</span> <span class="hljs-string">&quot;redis.log&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>è¿è¡ŒæœåŠ¡å™¨ç«¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs linux"># æœåŠ¡å™¨ç«¯ï¼šè¿è¡Œredisçš„srcç›®å½•ä¸‹çš„redis-serveræ–‡ä»¶<br>redis-server redis.conf<br></code></pre></td></tr></table></figure></li><li><p>è¿œç¨‹è¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs linux">è¦è¿œç¨‹è¿æ¥çš„è¯è¦æŠŠé…ç½®æ–‡ä»¶çš„bind 127.0.0.1æ³¨é‡Šèµ·æ¥<br>windowså‘½ä»¤è¡Œ: ./redis-cli.exe -h è¿œç¨‹ipåœ°å€ -p 6379ssss<br>å‡ºç°  Error: åœ¨é©±åŠ¨å™¨ %1 ä¸Šæ’å…¥è½¯ç›˜ã€‚æ—¶è¦æŠŠlinuxä¸Šçš„redisçš„protected-modeè®¾ç½®æˆno<br></code></pre></td></tr></table></figure></li></ol><h4 id="è¿è¡Œrediså®¢æˆ·ç«¯"><a href="#è¿è¡Œrediså®¢æˆ·ç«¯" class="headerlink" title="è¿è¡Œrediså®¢æˆ·ç«¯"></a>è¿è¡Œrediså®¢æˆ·ç«¯</h4><ol><li><p>å‘½ä»¤è¡Œå®¢æˆ·ç«¯</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ldif">redis-cli [options] [commonds]<br><span class="hljs-comment"># å¸¸è§options</span><br><span class="hljs-literal">-</span>h 127.0.0.1ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„IPåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1<br><span class="hljs-literal">-</span>p 6379ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6379<br><span class="hljs-literal">-</span>a 123456ï¼šæŒ‡å®šredisçš„è®¿é—®å¯†ç  <br><br><span class="hljs-comment"># æµ‹è¯•</span><br>ping<span class="hljs-comment"># å¦‚æœè¿æ¥æˆåŠŸè¿”å›PONG</span><br></code></pre></td></tr></table></figure></li><li><p>å›¾å½¢åŒ–å®¢æˆ·ç«¯  </p><p><a href="https://github.com/lework/RedisDesktopManager-Windows/releases">ä¸‹è½½åœ°å€</a></p></li></ol><h4 id="windowsä¸‹è¿è¡Œredis"><a href="#windowsä¸‹è¿è¡Œredis" class="headerlink" title="windowsä¸‹è¿è¡Œredis"></a>windowsä¸‹è¿è¡Œredis</h4><p>è¿è¡Œredis-server.exeæ–‡ä»¶å³å¯</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">é‡åˆ°å¯åŠ¨æŠ¥é”™æ—¶<br>redis-cli.exe<br>shutdown<br><span class="hljs-keyword">exit</span><br>redis-server.exe redis.windows.conf<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><h4 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h4><ul><li>å­—ç¬¦ä¸²string</li><li>å“ˆå¸Œ hash (é€‚åˆå­˜å¯¹è±¡)</li><li>åˆ—è¡¨ list</li><li>é›†åˆ set</li><li>æœ‰åºé›†åˆ sorted set</li></ul><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><h4 id="é€šç”¨å‘½ä»¤"><a href="#é€šç”¨å‘½ä»¤" class="headerlink" title="é€šç”¨å‘½ä»¤"></a>é€šç”¨å‘½ä»¤</h4><p>å‘½ä»¤è¡Œ<code>help @generic</code>æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>keys pattern</td><td>æŸ¥æ‰¾ç¬¦åˆæ¨¡å¼patternçš„key <br/>æ¨¡ç³ŠæŸ¥è¯¢ä¼šå½±å“æ•ˆç‡ï¼Œä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨</td></tr><tr><td>exists key</td><td>æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨</td></tr><tr><td>type key</td><td>è¿”å›keyæ‰€å­˜å‚¨çš„å€¼å¾—ç±»å‹</td></tr><tr><td>ttl key</td><td>æŸ¥çœ‹keyçš„å‰©ä½™æœ‰æ•ˆæ—¶é—´<br/>-2å·²å¤±æ•ˆï¼Œ-1æ°¸ä¹…æœ‰æ•ˆ</td></tr><tr><td>expire key seconds</td><td>è®¾ç½®keyçš„æœ‰æ•ˆå‰©ä½™æ—¶é—´</td></tr><tr><td>del key</td><td>åˆ é™¤key</td></tr></tbody></table><h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>set key value</td><td>è®¾ç½®å€¼</td></tr><tr><td>get key</td><td>è·å–å€¼</td></tr><tr><td>mset k1 v1 k2 v2 â€¦</td><td>multiï¼Œæ‰¹é‡è®¾ç½®å€¼</td></tr><tr><td>mget v1 v2 â€¦</td><td>æ‰¹é‡è·å–å€¼</td></tr><tr><td>incr key</td><td>è®©æ•´å‹çš„keyè‡ªå¢1</td></tr><tr><td>incrby key step</td><td>è®©æ•´å‹çš„keyè‡ªå¢è‡ªå®šä¹‰æ­¥é•¿</td></tr><tr><td>setex key seconds value</td><td>è®¾ç½®å€¼å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´(ç§’)</td></tr><tr><td>setnx key value</td><td>å½“keyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®å€¼</td></tr></tbody></table><h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>hset key field value</td><td>(å¯ä»¥æ‰¹é‡)è®¾ç½®keyä¸­å­—æ®µfieldçš„å€¼</td></tr><tr><td>hget key field</td><td>(å¯ä»¥æ‰¹é‡)è·å–keyä¸­å­—æ®µfieldçš„å€¼</td></tr><tr><td>hdel key field</td><td>åˆ é™¤keyä¸­å­—æ®µfield</td></tr><tr><td>hkeys key</td><td>è·å–keyä¸­æ‰€æœ‰å­—æ®µ</td></tr><tr><td>hvals key</td><td>è·å–keyä¸­æ‰€æœ‰å€¼</td></tr><tr><td>hgetall key</td><td>è·å–keyä¸­æ‰€æœ‰å­—æ®µå’Œå€¼</td></tr><tr><td>hincrby key field step</td><td>è‡ªå¢</td></tr><tr><td>hsetnx key field value</td><td>fieldä¸å­˜åœ¨æ—¶æ‰æ·»åŠ </td></tr></tbody></table><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>ç±»ä¼¼javaçš„LinkedList</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lpush key value1 [value2â€¦]</td><td>æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼åˆ°åˆ—è¡¨å·¦è¾¹</td></tr><tr><td>lrange key start stop</td><td>è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>rpop key</td><td>ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€å³è¾¹ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>llen key</td><td>è·å–åˆ—è¡¨é•¿åº¦</td></tr><tr><td>brpop key1 [key2..] timeout</td><td>åœ¨timeoutæ—¶é—´é‡Œç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€å³ä¸€ä¸ªå…ƒç´ </td></tr></tbody></table><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>sadd key member1 [member2â€¦]</td><td>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td>smembers key</td><td>è¿”å›æ‰€æœ‰å…ƒç´ </td></tr><tr><td>scard key</td><td>è·å–å…ƒç´ æ•°</td></tr><tr><td>sinter key1 [key2â€¦]</td><td>è¿”å›äº¤é›†</td></tr><tr><td>sunion key1 [key2â€¦]</td><td>è¿”å›å¹¶é›†</td></tr><tr><td>sdiff key1 [key2â€¦]</td><td>è¿”å›å·®é›†</td></tr><tr><td>srem key member1 [member2â€¦]</td><td>ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td>sismember key member</td><td>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</td></tr></tbody></table><h4 id="Sorted-Set"><a href="#Sorted-Set" class="headerlink" title="Sorted Set"></a>Sorted Set</h4><p>ç±»ä¼¼javaçš„TreeSet</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>zadd key score1 member1 [score2 member2â€¦]</td><td>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œæˆ–æ›´æ–°å·²æœ‰å…ƒç´ çš„åˆ†æ•°</td></tr><tr><td>zrange key start stop [withscores]</td><td>è·å–æŒ‡å®šåŒºé—´å…ƒç´ </td></tr><tr><td>zincrby key increment member</td><td>å¯¹æŒ‡å®šå…ƒç´ çš„åˆ†æ•°åŠ ä¸Šå¢é‡increment</td></tr><tr><td>zrem key member1 [member2â€¦]</td><td>ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td>zcount key min max</td><td>ç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td>zcard key</td><td>è·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zranke key member</td><td>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</td></tr></tbody></table><h4 id="keyçš„å±‚çº§å…³ç³»"><a href="#keyçš„å±‚çº§å…³ç³»" class="headerlink" title="keyçš„å±‚çº§å…³ç³»"></a>keyçš„å±‚çº§å…³ç³»</h4><p>æ¨èkeyçš„å‘½åæ–¹å¼ä¸º<code>é¡¹ç›®å:ä¸šåŠ¡å:ç±»å‹:id</code></p><p>RDMå›¾å½¢ç•Œé¢å·¥å…·ä¼šè‡ªåŠ¨æ ¹æ®<code>:</code> æ¥åˆ†åŒ…</p><h3 id="javaæ“ä½œredis"><a href="#javaæ“ä½œredis" class="headerlink" title="javaæ“ä½œredis"></a>javaæ“ä½œredis</h3><h4 id="jedis"><a href="#jedis" class="headerlink" title="jedis"></a>jedis</h4><p>jedisçš„æ–¹æ³•åå’Œredisçš„å‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼Œæ–¹ä¾¿å­¦ä¹ ï¼Œä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨</p><p><a href="https://github.com/redis/jedis">jedisä»“åº“</a></p><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisTest</span> &#123;<br>    <span class="hljs-keyword">private</span> Jedis jedis;<br><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å»ºç«‹è¿æ¥</span><br>        jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;47.96.80.163&quot;</span>, <span class="hljs-number">6378</span>);<br>        <span class="hljs-comment">// è®¾ç½®å¯†ç </span><br>        jedis.auth(<span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-comment">// é€‰æ‹©åº“ï¼Œé»˜è®¤0</span><br>        jedis.select(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        jedis.set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zs&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> jedis.get(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(name);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å…³é—­è¿æ¥</span><br>        <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>)<br>            jedis.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>â€‹<a href="https://blog.csdn.net/ming_yeye/article/details/117789182">é‡åˆ°ç¨‹åºåŒ…redis.clients.jedisä¸å­˜åœ¨æ—¶</a></p><h5 id="jedisè¿æ¥æ± "><a href="#jedisè¿æ¥æ± " class="headerlink" title="jedisè¿æ¥æ± "></a>jedisè¿æ¥æ± </h5><p>å› ä¸ºjedisæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨jedisè¿æ¥æ± æ¥ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªjedisï¼Œä»è€Œé¿å…å› ä¸ºå¤šçº¿ç¨‹å¯¼è‡´çš„é—®é¢˜</p><ol><li><p>ç¼–å†™è¿æ¥æ± å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisConnectionFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JedisPool jedisPool;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-comment">// é…ç½®è¿æ¥æ± </span><br>        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">poolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>        poolConfig.setMaxTotal(<span class="hljs-number">8</span>);      <span class="hljs-comment">// æœ€å¤§æ•°é‡</span><br>        poolConfig.setMaxIdle(<span class="hljs-number">8</span>);       <span class="hljs-comment">// æœ€å¤§ä¿å­˜å¾…å‘½çš„æ•°é‡</span><br>        poolConfig.setMinIdle(<span class="hljs-number">0</span>);       <span class="hljs-comment">// æœ€å°ä¿å­˜å¾…å‘½çš„æ•°é‡</span><br>        poolConfig.setMaxWait(Duration.ofSeconds(<span class="hljs-number">200</span>));     <span class="hljs-comment">// æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…å‡ºæ—¶é—´å°±ä¼šé”€æ¯</span><br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥æ± å¯¹è±¡ï¼Œå‚æ•°ï¼šè¿æ¥æ± é…ç½®ã€æœåŠ¡ç«¯ipã€æœåŠ¡ç«¯ç«¯å£ã€è¶…æ—¶æ—¶é—´ã€å¯†ç </span><br>        jedisPool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(poolConfig, <span class="hljs-string">&quot;47.96.80.163&quot;</span>, <span class="hljs-number">6378</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> jedisPool.getResource();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•é€šè¿‡çº¿ç¨‹æ± è·å–jedis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@BeforeEach</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// å»ºç«‹è¿æ¥</span><br>    jedis = JedisConnectionFactory.getJedis();<br>    <span class="hljs-comment">// è®¾ç½®å¯†ç </span><br>    jedis.auth(<span class="hljs-string">&quot;123456&quot;</span>);<br>    <span class="hljs-comment">// é€‰æ‹©åº“ï¼Œé»˜è®¤0</span><br>    jedis.select(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="Spring-Data-Redis"><a href="#Spring-Data-Redis" class="headerlink" title="Spring Data Redis"></a>Spring Data Redis</h4><p>SpringDataRedisä¸­æä¾›äº†RedisTemplateå·¥å…·ç±»ï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹Redisçš„æ“ä½œã€‚</p><p>é€šè¿‡opsForXXX()æ–¹æ³•è·å–æ“ä½œæŸä¸ªæ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œå†è¿›è¡Œæ“ä½œ</p><p><a href="https://spring.io/projects/spring-data-redis">å®˜æ–¹æ–‡æ¡£</a></p><ol><li><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- spring-data-redisä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- è¿æ¥æ± ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">47.96</span><span class="hljs-number">.80</span><span class="hljs-number">.163</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6378</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-comment"># é»˜è®¤ä½¿ç”¨lettuceè¿æ¥æ± ï¼Œè¦ä½¿ç”¨jedisè¿æ¥æ± éœ€è¦å¯¼å…¥jedisä¾èµ–</span><br>    <span class="hljs-attr">lettuce:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">1000ms</span><br></code></pre></td></tr></table></figure></li><li><p>æ³¨å…¥RedisTemplateæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDataRedisDemoApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-string">&quot;bbb&quot;</span>);<br>        System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;aaa&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="è‡ªå®šä¹‰åºåˆ—åŒ–å™¨"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–å™¨" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–å™¨"></a>è‡ªå®šä¹‰åºåˆ—åŒ–å™¨</h5><p>é»˜è®¤ä½¿ç”¨jdkçš„åºåˆ—åŒ–å™¨ï¼Œå¯è¯»æ€§å·®ï¼Œå†…å­˜å ç”¨è¾ƒå¤§</p><ol><li><p>ç¼–å†™é…ç½®ç±»</p><p>ä½¿ç”¨åˆ°äº†jsonåºåˆ—åŒ–å™¨ï¼Œå¯èƒ½è¦è‡ªå·±å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--jackson--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºRedisTemplateå¯¹è±¡</span><br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        <span class="hljs-comment">// è®¾ç½®è¿æ¥å·¥å‚</span><br>        template.setConnectionFactory(connectionFactory);<br>        <span class="hljs-comment">// åˆ›å»ºJSONåºåˆ—åŒ–å·¥å…·</span><br>        <span class="hljs-type">GenericJackson2JsonRedisSerializer</span> <span class="hljs-variable">jsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericJackson2JsonRedisSerializer</span>();<br>        <span class="hljs-comment">// åˆ›å»ºkeyåºåˆ—åŒ–å·¥å…·</span><br>        template.setKeySerializer(RedisSerializer.string());<br>        template.setHashKeySerializer(RedisSerializer.string());<br>        <span class="hljs-comment">// åˆ›å»ºvalueåºåˆ—åŒ–å·¥å…·</span><br>        template.setValueSerializer(jsonRedisSerializer);<br>        template.setHashValueSerializer(jsonRedisSerializer);<br><br>        <span class="hljs-keyword">return</span> template;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUser</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-number">20</span>);<br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;user:1&quot;</span>, user);<br>    System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user:1&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>redisä¸­å­˜çš„æ ¼å¼ä¸º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;@class&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;com.xw.springdataredisdemo.pojo.User&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¼šé¢å¤–å­˜åºåˆ—åŒ–çš„ç±»ä¿¡æ¯ï¼Œå æ®é¢å¤–å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨<strong>StringRedisTemplate</strong>è§£å†³è¿™ä¸ªé—®é¢˜</p></li></ol><h5 id="StringRedisTemplate"><a href="#StringRedisTemplate" class="headerlink" title="StringRedisTemplate"></a>StringRedisTemplate</h5><ol><li><p>æ³¨å…¥StringRedisTemplateï¼Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringDataRedisDemoApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;<br><span class="hljs-comment">// JSONåºåˆ—åŒ–å·¥å…·</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> JsonProcessingException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-number">20</span>);<br>        <span class="hljs-comment">// æ‰‹åŠ¨åºåˆ—åŒ–ä¸ºjson</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(user);<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;user:1&quot;</span>, json);<br>        <span class="hljs-comment">// æ‰‹åŠ¨ååºåˆ—åŒ–</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonUser</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user:1&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> mapper.readValue(jsonUser, User.class);<br>        System.out.println(u);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>redisä¸­å­˜çš„æ ¼å¼ä¸º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><h4 id="ç¼“å­˜æ›´æ–°"><a href="#ç¼“å­˜æ›´æ–°" class="headerlink" title="ç¼“å­˜æ›´æ–°"></a>ç¼“å­˜æ›´æ–°</h4><h5 id="æ›´æ–°ç­–ç•¥"><a href="#æ›´æ–°ç­–ç•¥" class="headerlink" title="æ›´æ–°ç­–ç•¥"></a>æ›´æ–°ç­–ç•¥</h5><ol><li><p><strong>å†…å­˜æ·˜æ±°ï¼š</strong>redisè‡ªåŠ¨è¿›è¡Œï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼)</p></li><li><p><strong>è¶…æ—¶å‰”é™¤ï¼š</strong>å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œredisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜</p></li><li><p><strong>ä¸»åŠ¨æ›´æ–°ï¼š</strong>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜</p></li></ol><h5 id="æœ€ä½³å®è·µæ–¹æ¡ˆ"><a href="#æœ€ä½³å®è·µæ–¹æ¡ˆ" class="headerlink" title="æœ€ä½³å®è·µæ–¹æ¡ˆ"></a>æœ€ä½³å®è·µæ–¹æ¡ˆ</h5><ol><li>ä½ä¸€è‡´æ€§éœ€æ±‚ï¼šä½¿ç”¨redisçš„å†…å­˜æ·˜æ±°æœºåˆ¶</li><li>é«˜ä¸€è‡´æ€§éœ€æ±‚ï¼šä¸»åŠ¨æ›´æ–°ï¼Œå¹¶ä»¥è¶…æ—¶å‰”é™¤ä½œä¸ºå…œåº•æ–¹æ¡ˆ<ul><li>è¯»æ“ä½œ<ul><li>ç¼“å­˜æœªå‘½ä¸­åˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾å®šè¶…æ—¶æ—¶é—´</li></ul></li><li>å†™æ“ä½œ<ul><li>å…ˆå†™æ•°æ®åº“å†åˆ ç¼“å­˜</li></ul></li></ul></li></ol><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p><h5 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h5><ul><li><strong>ç¼“å­˜ç©ºå¯¹è±¡</strong><ul><li>åŸç†ï¼šå³ä½¿è®¿é—®çš„å¯¹è±¡ä¸å­˜åœ¨ï¼Œä¹Ÿåœ¨ç¼“å­˜ä¸­å­˜ä¸€ä»½ç©ºå¯¹è±¡</li><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li></ul></li><li><strong>å¸ƒéš†è¿‡æ»¤</strong><ul><li>åŸç†ï¼šåœ¨ç¼“å­˜å‰å¤šåŠ ä¸€å±‚ï¼Œé€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œ</li><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul></li></ul><h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><p>åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p><h5 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h5><ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ul><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p>ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ul><li><p><strong>äº’æ–¥é”</strong></p><ul><li>åŸç†ï¼šç¬¬ä¸€ä¸ªæŸ¥è¯¢æœªå‘½ä¸­çš„çº¿ç¨‹å»(ä¸Šé”)æŸ¥è¯¢æ•°æ®åº“ã€é‡å»ºç¼“å­˜æ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹å†æ­¤æœŸé—´ç­‰å¾…ï¼Œç›´åˆ°ç¼“å­˜æ›´æ–°</li><li>ä¼˜ç‚¹ï¼šæ²¡æœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œä¿è¯ä¸€è‡´æ€§ï¼Œå®ç°ç®€å•</li><li>ç¼ºç‚¹ï¼šå½±å“æ€§èƒ½ï¼Œå¯èƒ½æœ‰æ­»é”é£é™©</li></ul></li><li><p><strong>é€»è¾‘è¿‡æœŸ</strong></p><ul><li>åŸç†ï¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´çš„keyï¼Œå½“è¿‡æœŸæ—¶ä¸åˆ é™¤ç¼“å­˜ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®ï¼Œåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹è¿”å›çš„æ˜¯æ—§æ•°æ®</li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½</li><li>ç¼ºç‚¹ï¼šä¸èƒ½ä¿è¯ä¸€è‡´æ€§ï¼Œæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå®ç°å¤æ‚</li></ul></li></ul><h5 id="äº’æ–¥é”å®ä¾‹"><a href="#äº’æ–¥é”å®ä¾‹" class="headerlink" title="äº’æ–¥é”å®ä¾‹"></a>äº’æ–¥é”å®ä¾‹</h5><ol><li><p>å®šä¹‰è·å–é”ã€é‡Šæ”¾é”çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key)</span> &#123;<br>    <span class="hljs-comment">// setIfAbsentåªæœ‰ä¸å­˜åœ¨æ—¶æ‰æ”¾å…¥å€¼ï¼Œä»¥æ­¤æ¥å®ç°äº’æ–¥é”</span><br>    <span class="hljs-comment">// å°è¯•è·å–é”</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>    <span class="hljs-comment">// é€šè¿‡BooleanUtilï¼Œé˜²æ­¢æ‹†ç®±æ—¶ç©ºæŒ‡é’ˆ</span><br>    <span class="hljs-keyword">return</span> BooleanUtil.isTrue(flag);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unLock</span><span class="hljs-params">(String key)</span> &#123;<br>    stringRedisTemplate.delete(key);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Shop <span class="hljs-title function_">queryWithPassMutex</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// ä»redisä¸­æŸ¥è¯¢ç¼“å­˜</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">shopJson</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(CACHE_SHOP_KEY + id);<br>    <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;<br>        <span class="hljs-keyword">return</span> JSONUtil.toBean(shopJson, Shop.class);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;&quot;</span>.equals(shopJson)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-comment">// é˜²æ­¢ç¼“å­˜å‡»ç©¿</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lock:shop:&quot;</span> + id;<br>    <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>        <span class="hljs-keyword">if</span> (!isLock) &#123;<br>            Thread.sleep(<span class="hljs-number">50</span>);<br>            <span class="hljs-keyword">return</span> queryWithPassThrough(id);<br>        &#125;<br>        <span class="hljs-comment">// æ²¡æœ‰ç¼“å­˜ï¼Œä»æ•°æ®åº“ä¸­å–æ•°æ®</span><br>        shop = <span class="hljs-built_in">this</span>.getById(id);<br>        <span class="hljs-keyword">if</span> (shop == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// å°†ç©ºå¯¹è±¡ä¿å­˜åˆ°redisï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€</span><br>            stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, <span class="hljs-string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(shop), CACHE_SHOP_TTL, TimeUnit.MINUTES);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        unLock(lockKey);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> shop;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h5 id="é€»è¾‘è¿‡æœŸå®ä¾‹"><a href="#é€»è¾‘è¿‡æœŸå®ä¾‹" class="headerlink" title="é€»è¾‘è¿‡æœŸå®ä¾‹"></a>é€»è¾‘è¿‡æœŸå®ä¾‹</h5><ol><li><p>å®šä¹‰è·å–é”ã€é‡Šæ”¾é”çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key)</span> &#123;<br>    <span class="hljs-comment">// setIfAbsentåªæœ‰ä¸å­˜åœ¨æ—¶æ‰æ”¾å…¥å€¼ï¼Œä»¥æ­¤æ¥å®ç°äº’æ–¥é”</span><br>    <span class="hljs-comment">// å°è¯•è·å–é”</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>    <span class="hljs-comment">// é€šè¿‡BooleanUtilï¼Œé˜²æ­¢æ‹†ç®±æ—¶ç©ºæŒ‡é’ˆ</span><br>    <span class="hljs-keyword">return</span> BooleanUtil.isTrue(flag);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unLock</span><span class="hljs-params">(String key)</span> &#123;<br>    stringRedisTemplate.delete(key);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å®šä¹‰é‡å»ºç¼“å­˜çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveShop2Redis</span><span class="hljs-params">(Long id, Long expireSeconds)</span> &#123;<br>    <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getById(id);<br>    <span class="hljs-comment">// å°è£…é€»è¾‘è¿‡æœŸæ—¶é—´</span><br>    <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisData</span>();<br>    redisData.setData(shop);<br>    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));<br>    <span class="hljs-comment">// å†™å…¥Redis</span><br>    stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(redisData));<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br><span class="hljs-comment">// å›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">CACHE_REBUILD_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><br><span class="hljs-keyword">public</span> Shop <span class="hljs-title function_">queryWithPassLogicalExpire</span> <span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// ä»redisä¸­æŸ¥è¯¢ç¼“å­˜</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">shopJson</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(CACHE_SHOP_KEY + id);<br>    <span class="hljs-keyword">if</span> (StrUtil.isBlank(shopJson)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> JSONUtil.toBean(shopJson, RedisData.class);<br>    <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> redisData.getExpireTime();<br>    <span class="hljs-keyword">if</span> (expireTime.isAfter(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span><br>        <span class="hljs-keyword">return</span> shop;<br>    &#125;<br>    <span class="hljs-comment">// å·²è¿‡æœŸï¼Œé‡å»ºç¼“å­˜</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_SHOP_KEY + id;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>    <span class="hljs-keyword">if</span> (isLock) &#123;<br>        <span class="hljs-comment">// å¼€å¯æ–°çº¿ç¨‹</span><br>        CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// é‡å»ºç¼“å­˜</span><br>                <span class="hljs-built_in">this</span>.saveShop2Redis(id, <span class="hljs-number">30L</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// é‡Šæ”¾é”</span><br>                unLock(lockKey);<br>            &#125;<br>        &#125;);<br>    &#125;<br>    <span class="hljs-comment">// è¿”å›æ—§æ•°æ®</span><br>    <span class="hljs-keyword">return</span> shop;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="å°è£…å·¥å…·ç±»"><a href="#å°è£…å·¥å…·ç±»" class="headerlink" title="å°è£…å·¥å…·ç±»"></a>å°è£…å·¥å…·ç±»</h4><p>å…·æœ‰çš„åŠŸèƒ½ï¼š</p><ol><li>å­˜<ul><li>å°†ä»»æ„å¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­˜åˆ°stringç±»å‹çš„keyçš„ç¼“å­˜ä¸­ï¼Œå¹¶è®¾ç½®TTLè¿‡æœŸæ—¶é—´</li><li>å°†ä»»æ„å¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­˜åˆ°stringç±»å‹çš„keyçš„ç¼“å­˜ä¸­ï¼Œå¹¶è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul></li><li>å–<ul><li>æ ¹æ®keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šå¯¹è±¡ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹æ³•è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</li><li>æ ¹æ®keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šå¯¹è±¡ï¼Œåˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheClient</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-comment">// å›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">CACHE_REBUILD_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheClient</span><span class="hljs-params">(StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonValue</span> <span class="hljs-operator">=</span> JSONUtil.toJsonStr(value);<br>        stringRedisTemplate.opsForValue().set(key, jsonValue, time, unit);<br>    &#125;<br><br>    <span class="hljs-comment">// é€»è¾‘è¿‡æœŸï¼Œç”¨äºé˜²æ­¢ç¼“å­˜ç©¿é€</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWithLogicExpire</span><span class="hljs-params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span><br>        <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisData</span>();<br>        redisData.setData(value);<br>        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));<br>        <span class="hljs-comment">// å†™å…¥Redis</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonValue</span> <span class="hljs-operator">=</span> JSONUtil.toJsonStr(redisData);<br>        stringRedisTemplate.opsForValue().set(key, jsonValue, time, unit);<br>    &#125;<br><br>    <span class="hljs-comment">// å­˜ç©ºå¯¹è±¡ï¼Œç”¨äºé˜²æ­¢ç¼“å­˜ç©¿é€</span><br>    <span class="hljs-keyword">public</span> &lt;R, ID&gt; R <span class="hljs-title function_">queryWithPassThrough</span><span class="hljs-params">(String keyPrefix, ID id, Class&lt;R&gt; type,  Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPrefix + id;<br>        <span class="hljs-comment">// ä»redisä¸­æŸ¥è¯¢ç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>        <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(json)) &#123;<br>            <span class="hljs-keyword">return</span> JSONUtil.toBean(json, type);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;&quot;</span>.equals(json)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// æ²¡æœ‰ç¼“å­˜ï¼Œé€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“</span><br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> dbFallback.apply(id);<br>        <span class="hljs-keyword">if</span> (r == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// å°†ç©ºå¯¹è±¡ä¿å­˜åˆ°redisï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€</span><br>            stringRedisTemplate.opsForValue().set(key, <span class="hljs-string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-built_in">this</span>.set(key, r, time, unit);<br><br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-comment">// å¯¹é€»è¾‘è¿‡æœŸæ•°æ®çš„æŸ¥è¯¢</span><br>    <span class="hljs-keyword">public</span> &lt;R, ID&gt; R <span class="hljs-title function_">queryWithPassLogicalExpire</span> <span class="hljs-params">(String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPrefix + id;<br>        <span class="hljs-comment">// ä»redisä¸­æŸ¥è¯¢ç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>        <span class="hljs-keyword">if</span> (StrUtil.isBlank(json)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> JSONUtil.toBean(json, RedisData.class);<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);<br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> redisData.getExpireTime();<br>        <span class="hljs-keyword">if</span> (expireTime.isAfter(LocalDateTime.now())) &#123;<br>            <span class="hljs-comment">// æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span><br>            <span class="hljs-keyword">return</span> r;<br>        &#125;<br>        <span class="hljs-comment">// å·²è¿‡æœŸï¼Œé‡å»ºç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_SHOP_KEY + id;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>        <span class="hljs-keyword">if</span> (isLock) &#123;<br>            <span class="hljs-comment">// å¼€å¯æ–°çº¿ç¨‹</span><br>            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// é‡å»ºç¼“å­˜: æŸ¥è¯¢æ•°æ®åº“ã€å†™å…¥ç¼“å­˜</span><br>                    <span class="hljs-type">R</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> dbFallback.apply(id);<br>                    <span class="hljs-built_in">this</span>.setWithLogicExpire(key, r1, time, unit);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// é‡Šæ”¾é”</span><br>                    unLock(lockKey);<br>                &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-comment">// è¿”å›æ—§æ•°æ®</span><br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-comment">// setIfAbsentåªæœ‰ä¸å­˜åœ¨æ—¶æ‰æ”¾å…¥å€¼ï¼Œä»¥æ­¤æ¥å®ç°äº’æ–¥é”</span><br>        <span class="hljs-comment">// å°è¯•è·å–é”</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>        <span class="hljs-comment">// é€šè¿‡BooleanUtilï¼Œé˜²æ­¢æ‹†ç®±æ—¶ç©ºæŒ‡é’ˆ</span><br>        <span class="hljs-keyword">return</span> BooleanUtil.isTrue(flag);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unLock</span><span class="hljs-params">(String key)</span> &#123;<br>        stringRedisTemplate.delete(key);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ä¼˜æƒ åˆ¸ç§’æ€"><a href="#ä¼˜æƒ åˆ¸ç§’æ€" class="headerlink" title="ä¼˜æƒ åˆ¸ç§’æ€"></a>ä¼˜æƒ åˆ¸ç§’æ€</h4><h5 id="å…¨å±€idç”Ÿæˆå™¨"><a href="#å…¨å±€idç”Ÿæˆå™¨" class="headerlink" title="å…¨å±€idç”Ÿæˆå™¨"></a>å…¨å±€idç”Ÿæˆå™¨</h5><blockquote><p> æ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·</p></blockquote><p>id(Longå‹ï¼Œ64ä½)çš„ç»“æ„å¯ä»¥è®¾è®¡æˆï¼š</p><p><code>ç¬¦å·ä½(1ä½ï¼Œä¸º0) ï¼šæ—¶é—´æˆ³(31ä½ï¼Œä»¥ç§’ä¸ºå•ä½) ï¼šåºåˆ—å·ï¼ˆ32ä½ï¼‰</code></p><p>ä½œç”¨ï¼š</p><ul><li>å¢åŠ idçš„å¤æ‚æ€§ï¼Œé˜²æ­¢è¢«çŒœå‡ºè§„å¾‹</li><li>å”¯ä¸€æ€§ï¼Œå®‰å…¨æ€§</li></ul><p><strong>Redisè‡ªå¢å®ç°å…¨å±€idç”Ÿæˆå™¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisIdWorker</span> &#123;<br><br>    <span class="hljs-comment">// å¼€å§‹æ—¶é—´æˆ³</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">BEGIN_TIMESTAMP</span> <span class="hljs-operator">=</span> <span class="hljs-number">1640995200L</span>;<br><br>    <span class="hljs-comment">// åºåˆ—å·ä½æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">32</span>;<br><br>    <span class="hljs-comment">// redis</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisIdWorker</span><span class="hljs-params">(StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">(String keyPrefix)</span> &#123;<br>        <span class="hljs-comment">// ç”Ÿæˆæ—¶é—´æˆ³</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">nowSecond</span> <span class="hljs-operator">=</span> now.toEpochSecond(ZoneOffset.UTC);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">timeStamp</span> <span class="hljs-operator">=</span> nowSecond - BEGIN_TIMESTAMP;<br>        <span class="hljs-comment">// ç”Ÿæˆåºåˆ—å·</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;yyyy:MM:dd&quot;</span>));  <span class="hljs-comment">// è·å–å½“å¤©æ—¥æœŸ</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="hljs-string">&quot;icr:&quot;</span> + keyPrefix + <span class="hljs-string">&quot;:&quot;</span> + date);<span class="hljs-comment">// ä»¥å¤©ä¸ºå•ä½ç”Ÿæˆåºåˆ—å·</span><br>        <span class="hljs-comment">// è¿”å›id</span><br>        <span class="hljs-keyword">return</span> timeStamp &lt;&lt; COUNT_BITS | count;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´çš„ç§’æ•°</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2022</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">second</span> <span class="hljs-operator">=</span> time.toEpochSecond(ZoneOffset.UTC);<br>        System.out.println(second);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HmDianPingApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RedisIdWorker redisIdWorker;<br><br>    <span class="hljs-comment">// å›ºå®šå¤§å°çº¿ç¨‹æ± </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">es</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">500</span>);<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedisIdWorker</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">300</span>);<br><br>        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> () -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>                System.out.println(id);<br>            &#125;<br>            latch.countDown();<br>        &#125;;<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">300</span>; i++) &#123;<br>            es.submit(task);<br>        &#125;<br>        latch.await();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br><br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œæ—¶é—´ = &quot;</span> + (end - begin));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="è¶…å–é—®é¢˜"><a href="#è¶…å–é—®é¢˜" class="headerlink" title="è¶…å–é—®é¢˜"></a>è¶…å–é—®é¢˜</h5><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŠ é”</p><p>é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ</p><ul><li><strong>æ‚²è§‚é”</strong>ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€å®šä¼šå‘ç”Ÿï¼Œå› æ­¤åœ¨æ“ä½œæ•°æ®ä¹‹å‰å…ˆè·å–é”ï¼Œç¡®ä¿çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ</li><li><strong>ä¹è§‚é”</strong>ï¼šè®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œåªåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­æ•°æ®æ˜¯å¦è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</li></ul><p><strong>å®ä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> ISeckillVoucherService seckillVoucherService;<br><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedisIdWorker redisIdWorker;<br><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissonClient redissonClient;<br><br><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢æ•°æ®</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> seckillVoucherService.getById(voucherId);<br>    <span class="hljs-comment">// åˆ¤æ–­å¼€å§‹ç»“æŸæ—¶é—´</span><br>    <span class="hljs-keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å°šæœªå¼€å§‹!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å·²ç»ç»“æŸ!&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// åˆ¤æ–­åº“å­˜</span><br>    <span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// è·å–é”å¯¹è±¡</span><br>    <span class="hljs-comment">// SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span><br>    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;lock:order:&quot;</span> + userId);<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock();<br>    <span class="hljs-keyword">if</span> (!isLock) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">IVoucherOrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (IVoucherOrderService) AopContext.currentProxy();<br>        <span class="hljs-keyword">return</span> proxy.createVoucherOrder(userId, voucherId);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        lock.unlock();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">createVoucherOrder</span><span class="hljs-params">(Long userId, Long voucherId)</span> &#123;<br>    <span class="hljs-comment">// ä¸€äººä¸€å•</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId)<br>        .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).count();<br>    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// æ‰£å‡åº“å­˜</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>        .setSql(<span class="hljs-string">&quot;stock = stock - 1&quot;</span>)<br>        .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId)<br>        .gt(<span class="hljs-string">&quot;stock&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// é˜²æ­¢è¶…å–</span><br>        .update();<br>    <span class="hljs-keyword">if</span> (!success)<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span>);<br>    <span class="hljs-comment">// åˆ›å»ºè®¢å•</span><br>    <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>    voucherOrder.setId(orderId);<br>    voucherOrder.setUserId(userId);<br>    voucherOrder.setVoucherId(voucherId);<br>    <span class="hljs-built_in">this</span>.save(voucherOrder);<br>    <span class="hljs-comment">// è¿”å›è®¢å•id</span><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h5><p>æ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”</p><blockquote><p>åœ¨é›†ç¾¤éƒ¨ç½²çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨synchronizedä½œä¸ºé”ï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé”çš„æ—¶å€™ä¸æ˜¯é”çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¯¼è‡´synchronizedå¤±æ•ˆ</p></blockquote><p><strong>åˆ†å¸ƒå¼é”åº”æ»¡è¶³çš„æ¡ä»¶</strong>ï¼š</p><ol><li><p>å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</p></li><li><p>äº’æ–¥ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</p></li><li><p>é«˜å¯ç”¨ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</p></li><li><p>é«˜æ€§èƒ½ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</p></li></ol><p><strong>åŸºäºRediså®ç°åˆ†å¸ƒå¼é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILock</span> &#123;<br>      <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeoutSec)</span>;<br><br>      <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ç‰ˆé”ï¼Œåœ¨ä¸šåŠ¡æ—¶é—´è¶…è¿‡é”è¿‡æœŸæ—¶é—´æ—¶ï¼Œå­˜åœ¨é”è¢«å…¶ä»–jvmçš„çº¿ç¨‹è¯¯åˆ çš„é£é™©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleRedisLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILock</span> &#123;<br><br>    <span class="hljs-comment">// é”å‰ç¼€</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lock:&quot;</span>;<br><br>    <span class="hljs-comment">// é”åç§°</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleRedisLock</span><span class="hljs-params">(String name, StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeoutSec)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> KEY_PREFIX + name;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> Thread.currentThread().getId();    <span class="hljs-comment">// ä»¥å½“å‰çº¿ç¨‹çš„idä½œä¸ºå€¼</span><br>        <span class="hljs-comment">// è·å–é”</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, value + <span class="hljs-string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);<br>        <span class="hljs-comment">// é€šè¿‡equlasé˜²æ­¢æ‹†ç®±æ—¶å¯èƒ½çš„ç©ºæŒ‡é’ˆ</span><br>        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>        stringRedisTemplate.delete(KEY_PREFIX + name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒç‰ˆé”ï¼Œè§£å†³é”è¯¯åˆ çš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleRedisLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILock</span> &#123;<br><br>        <span class="hljs-comment">// é”å‰ç¼€</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lock:&quot;</span>;<br>    <span class="hljs-comment">// ç”¨äºæ ‡è¯†ä¸åŒçº¿ç¨‹çš„é”</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ID_PREFIX</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString(<span class="hljs-literal">true</span>) + <span class="hljs-string">&quot;-&quot;</span>;<br><br>    <span class="hljs-comment">// é”åç§°</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleRedisLock</span><span class="hljs-params">(String name, StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeoutSec)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> KEY_PREFIX + name;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ID_PREFIX + Thread.currentThread().getId();    <span class="hljs-comment">// ä»¥å½“å‰çº¿ç¨‹çš„idä½œä¸ºå€¼</span><br>        <span class="hljs-comment">// è·å–é”</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, value, timeoutSec, TimeUnit.SECONDS);<br>        <span class="hljs-comment">// é€šè¿‡equlasé˜²æ­¢æ‹†ç®±æ—¶å¯èƒ½çš„ç©ºæŒ‡é’ˆ</span><br>        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åˆ¤æ–­çº¿ç¨‹æ ‡è¯†</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> KEY_PREFIX + name;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ID_PREFIX + Thread.currentThread().getId();    <span class="hljs-comment">// ä»¥å½“å‰çº¿ç¨‹çš„idä½œä¸ºå€¼</span><br>        <span class="hljs-keyword">if</span> (stringRedisTemplate.opsForValue().get(key).equals(value)) &#123;<br>            stringRedisTemplate.delete(KEY_PREFIX + name);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="åŸå­æ€§é—®é¢˜"><a href="#åŸå­æ€§é—®é¢˜" class="headerlink" title="åŸå­æ€§é—®é¢˜"></a>åŸå­æ€§é—®é¢˜</h5><p>æ‰§è¡Œå®Œä¸šåŠ¡ï¼Œè¦é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­é”æ ‡è¯†æ˜¯å¦ä¸€è‡´ï¼Œç„¶åå†é‡Šæ”¾é”</p><p>æ­¤æ—¶è‹¥è·å–é”æ ‡è¯†åå‡ºç°é˜»å¡ï¼Œåœ¨é˜»å¡æœŸé—´é”è¿‡æœŸå¹¶è¢«å…¶ä»–jvmçš„çº¿ç¨‹è·å–</p><p>å½“é˜»å¡ç»“æŸå°±æœ‰å¯èƒ½å°†é”è¯¯åˆ é™¤</p><blockquote><p>è·å–é”æ ‡è¯†å’Œé‡Šæ”¾é”ä¸æ˜¯åŸå­æ€§çš„</p></blockquote><p><strong>è§£å†³æ–¹å¼</strong></p><p>é€šè¿‡Luaè„šæœ¬å®ç°åŸå­æ€§æ“ä½œå¤šæ¡å‘½ä»¤</p><p><strong>å®¢æˆ·ç«¯è°ƒç”¨è„šæœ¬</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- ç¤ºä¾‹</span><br><span class="hljs-comment">-- 1 è¡¨ç¤ºæœ‰ä¸€ä¸ªkeyï¼Œåé¢è·Ÿå‚æ•°ï¼Œkyä¼šä¿å­˜åˆ°KEYS[]ï¼Œvalueä¼šä¿å­˜åˆ°ARGV[]ä¸­</span><br><span class="hljs-comment">-- æ³¨æ„luaæ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹</span><br>EVAL <span class="hljs-string">&quot;return redis.call(&#x27;set&#x27;,&#x27;KEYS[1],ARGV[1]&#x27;)&quot;</span> <span class="hljs-number">1</span> name Rose<br></code></pre></td></tr></table></figure><p><strong>javaè°ƒç”¨luaè„šæœ¬</strong></p><p>åˆ›å»ºluaè„šæœ¬</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> (redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>]) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- é‡Šæ”¾é”</span><br>    <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">&#x27;del&#x27;</span>, KEYS[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>åŠ è½½luaè„šæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è§£é”è„šæœ¬</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;<br><span class="hljs-keyword">static</span> &#123;<br>    UNLOCK_SCRIPT = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();<br>    <span class="hljs-comment">// è„šæœ¬æ‰€åœ¨ä½ç½®</span><br>    UNLOCK_SCRIPT.setLocation(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;script/unlock.lua&quot;</span>));<br>    <span class="hljs-comment">// è®¾ç½®è„šæœ¬è¿”å›å€¼ç±»å‹</span><br>    UNLOCK_SCRIPT.setResultType(Long.class);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è„šæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> KEY_PREFIX + name;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> ID_PREFIX + Thread.currentThread().getId();    <span class="hljs-comment">// ä»¥å½“å‰çº¿ç¨‹çš„idä½œä¸ºå€¼</span><br>    stringRedisTemplate.execute(<br>        UNLOCK_SCRIPT,<br>        Collections.singletonList(key),<br>        value<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h5><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº†å„ç§<strong>åˆ†å¸ƒå¼é”</strong>çš„å®ç°ã€‚</p><p><strong>ä½¿ç”¨</strong></p><ol><li><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.13.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é…ç½®Redissonå®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        config.useSingleServer().setAddress(<span class="hljs-string">&quot;redis://127.0.0.1:6379&quot;</span>);<br>        <span class="hljs-keyword">return</span> Redisson.create(config);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissionClient redissonClient;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedisson</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>    <span class="hljs-comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span><br>    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;anyLock&quot;</span>);<br>    <span class="hljs-comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,TimeUnit.SECONDS);<br>    <span class="hljs-comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span>(isLock)&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          <br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">//é‡Šæ”¾é”</span><br>            lock.unlock();<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p><strong>Redissionåˆ†å¸ƒå¼é”åŸç†</strong></p><ul><li><p><strong>å¯é‡å…¥</strong>ï¼šåˆ©ç”¨hashç»“æ„è®°å½•çº¿ç¨‹idå’Œé‡å…¥æ¬¡æ•°</p></li><li><p><strong>å¯é‡è¯•</strong>ï¼šåˆ©ç”¨ä¿¡å·é‡å’ŒPubSubåŠŸèƒ½å®ç°ç­‰å¾…ã€å”¤é†’ï¼Œè·å–é”å¤±è´¥çš„é‡è¯•æœºåˆ¶</p></li><li><p><strong>è¶…æ—¶ç»­çº¦</strong>ï¼šåˆ©ç”¨watchDogï¼Œæ¯éš”ä¸€æ®µæ—¶é—´(releaseTime &#x2F; 3)ï¼Œé‡ç½®è¶…æ—¶æ—¶é—´</p></li><li><p><strong>ä¸»ä»ä¸€è‡´æ€§</strong>ï¼šå¤šä¸ªç‹¬ç«‹çš„RedisèŠ‚ç‚¹ï¼Œå¿…é¡»åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½è·å–é‡å…¥é”ï¼Œè”¡æ “è·å–é”æˆåŠŸ</p></li></ul><h4 id="ä¼˜åŒ–ç§’æ€"><a href="#ä¼˜åŒ–ç§’æ€" class="headerlink" title="ä¼˜åŒ–ç§’æ€"></a>ä¼˜åŒ–ç§’æ€</h4><p><strong>æ€è·¯</strong>ï¼š</p><p><strong>å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­</strong>ï¼Œæ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯</p><p><strong>å®ä¾‹</strong>ï¼š</p><ol><li><p>åœ¨æ–°å¢ç§’æ€åˆ¸çš„æ—¶å€™ï¼Œå°†åº“å­˜ä¿¡æ¯ä¿å­˜åˆ°redisä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addSeckillVoucher</span><span class="hljs-params">(Voucher voucher)</span> &#123;<br>    <span class="hljs-comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span><br>    save(voucher);<br>    <span class="hljs-comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">seckillVoucher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillVoucher</span>();<br>    seckillVoucher.setVoucherId(voucher.getId());<br>    seckillVoucher.setStock(voucher.getStock());<br>    seckillVoucher.setBeginTime(voucher.getBeginTime());<br>    seckillVoucher.setEndTime(voucher.getEndTime());<br>    seckillVoucherService.save(seckillVoucher);<br>    <span class="hljs-comment">// ä¿å­˜ä¼˜æƒ åˆ¸åº“å­˜åˆ°redisä¸­</span><br>    stringRedisTemplate.opsForValue().set(RedisConstants.SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å°†åˆ¤æ–­åº“å­˜å’Œä¸€äººä¸€å•çš„åˆ¤æ–­é€»è¾‘å†™åˆ°luaè„šæœ¬ä¸­ï¼Œå®ç°å¿«é€Ÿåˆ¤æ–­æ˜¯å¦èƒ½è´­ä¹°</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> voucherId = ARGV[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">local</span> userId = ARGV[<span class="hljs-number">2</span>]<br><br><span class="hljs-keyword">local</span> stockKey = <span class="hljs-string">&#x27;seckill:stock:&#x27;</span> .. voucherId<br><span class="hljs-keyword">local</span> orderKey = <span class="hljs-string">&#x27;seckill:order:&#x27;</span> .. voucherId<br><br><span class="hljs-comment">-- åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²ä¸‹è¿‡å•(ä¸€äººä¸€å•)</span><br><span class="hljs-keyword">if</span> (redis.call(<span class="hljs-string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="hljs-number">1</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- ä»¥ä¸‹è¿‡å•ï¼Œè¿”å›2</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- æ‰£é™¤åº“å­˜ï¼Œä¸‹å•</span><br>redis.call(<span class="hljs-string">&#x27;incrby&#x27;</span>, stockKey, <span class="hljs-number">-1</span>)<br>redis.call(<span class="hljs-string">&#x27;sadd&#x27;</span>, orderKey, userId)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DefaultRedisScript&lt;Long&gt; SECKILL_SCRIPT;<br><span class="hljs-keyword">static</span> &#123;<br>    SECKILL_SCRIPT = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();<br>    SECKILL_SCRIPT.setLocation(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;script/seckill.lua&quot;</span>));<br>    SECKILL_SCRIPT.setResultType(Long.class);<br>&#125;<br><br>IVoucherOrderService proxy;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// æ‰§è¡Œluaè„šæœ¬åˆ¤æ–­</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stringRedisTemplate.execute(<br>        SECKILL_SCRIPT,<br>        Collections.emptyList(),    <span class="hljs-comment">// keys</span><br>        voucherId.toString(), userId.toString() <span class="hljs-comment">//values</span><br>    );<br>    <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> result.intValue();<br>    <span class="hljs-keyword">if</span> (r != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(r == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="hljs-string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ï¼ˆä¹‹åé€šè¿‡luaè„šæœ¬å®Œæˆï¼‰</span><br>    <span class="hljs-comment">// è·å–ä»£ç†å¯¹è±¡</span><br>    proxy = (IVoucherOrderService) AopContext.currentProxy();<br>    orderTasks.add(voucherOrder);<br><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¸‹å•æ—¶å°†åˆ›å»º&#x2F;ä¿å­˜è®¢å•ä»»åŠ¡æ”¾åˆ°(<strong>jdkçš„</strong>)é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¼‚æ­¥æ‰§è¡Œä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—å’Œæ‰§è¡Œä¸‹å•çš„çº¿ç¨‹</span><br><span class="hljs-keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">SECKILL_ORDER_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br><br><span class="hljs-comment">// ç±»åˆå§‹åŒ–å®Œåä¼šè°ƒç”¨æ­¤æ–¹æ³•</span><br><span class="hljs-meta">@PostConstruct</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// å¼€å¯å¤„ç†é˜»å¡é˜Ÿåˆ—çš„çº¿ç¨‹</span><br>    SECKILL_ORDER_EXECUTOR.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrderHandler</span>());<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherOrderHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è·å–é˜»å¡é˜Ÿåˆ—é‡Œçš„è®¢å•ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™ä¼šé˜»å¡ä½</span><br>                <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> orderTasks.take();<br>                <span class="hljs-comment">// åˆ›å»ºè®¢å•</span><br>                handleVoucherOrder(voucherOrder);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                log.error(<span class="hljs-string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createVoucherOrder</span><span class="hljs-params">(VoucherOrder voucherOrder)</span> &#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> voucherOrder.getUserId();<br>    <span class="hljs-comment">// ä¸€äººä¸€å•</span><br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId)<br>        .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();<br>    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>        log.error(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// æ‰£å‡åº“å­˜</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>        .setSql(<span class="hljs-string">&quot;stock = stock - 1&quot;</span>)<br>        .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId())<br>        .gt(<span class="hljs-string">&quot;stock&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// é˜²æ­¢è¶…å–</span><br>        .update();<br>    <span class="hljs-keyword">if</span> (!success)<br>        log.error(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span>);<br>    <span class="hljs-comment">// ä¿å­˜è®¢å•</span><br>    <span class="hljs-built_in">this</span>.save(voucherOrder);<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="Redisæ¶ˆæ¯é˜Ÿåˆ—"><a href="#Redisæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="Redisæ¶ˆæ¯é˜Ÿåˆ—"></a>Redisæ¶ˆæ¯é˜Ÿåˆ—</h4><h5 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><p>æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ä¸»è¦åŒ…æ‹¬çš„ä¸‰ä¸ªè§’è‰²ï¼š</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯ä»£ç†</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯å¹¶å¤„ç†</li></ul><p>Redisæä¾›äº†ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><ul><li><strong>list</strong>ï¼šåŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</li><li><strong>PubSub</strong>ï¼šåŸºäºç‚¹å¯¹ç‚¹æ¶ˆæ¯æ¨¡å‹ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰</li><li><strong>Stream</strong>ï¼šæ¯”è¾ƒå®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹</li></ul><h5 id="åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"></a>åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h5><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LPUSH&#x2F;RPUSH keys values</td><td>å¾€åŒç«¯é˜Ÿåˆ—å­˜æ•°æ®</td></tr><tr><td>LPOP&#x2F;RPOP</td><td>ä»åŒç«¯é˜Ÿåˆ—å–æ•°æ®å¹¶åˆ é™¤</td></tr><tr><td>BLPOP&#x2F;BRPOP</td><td>å–æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®çš„æ—¶å€™ä¼šç­‰å¾…</td></tr></tbody></table><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…</li></ul><h5 id="åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h5><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SUBSCRIBE channels</td><td>è®¢é˜…é¢‘é“</td></tr><tr><td>PUBLISH channel msg</td><td>å‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯</td></tr><tr><td>PSUBSCRIBE pattern</td><td>è®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“<br/>?ï¼šåŒ¹é…ä¸€ä¸ªå­—ç¬¦<br/>*ï¼šåŒ¹é…0åˆ°å¤šä¸ªå­—ç¬¦<br/>[ab]ï¼šåŒ¹é…æ‹¬å·é‡Œçš„å­—ç¬¦</td></tr></tbody></table><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºä¼šæ•°æ®ä¸¢å¤±</li></ul><h5 id="åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h5><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>XADD</td><td>å‘é€æ¶ˆæ¯</td></tr><tr><td>XREAD</td><td>è¯»å–æ¶ˆæ¯ï¼Œä¸ä¼šåˆ é™¤</td></tr></tbody></table><p><img src="/img/redis_img/xadd.png"></p><p><img src="/img/redis_img/xread.png"></p><p>ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><p>åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</p><ol><li><p>åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs redis">XGROUP create stream.orders g1 0 mkstream <br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹åˆ¤æ–­æ˜¯å¦æœ‰æŠ¢è´­èµ„æ ¼çš„luaè„šæœ¬ï¼Œå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> voucherId = ARGV[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">local</span> userId = ARGV[<span class="hljs-number">2</span>]<br><span class="hljs-keyword">local</span> orderId = ARGV[<span class="hljs-number">3</span>]<br><br><span class="hljs-keyword">local</span> stockKey = <span class="hljs-string">&#x27;seckill:stock:&#x27;</span> .. voucherId<br><span class="hljs-keyword">local</span> orderKey = <span class="hljs-string">&#x27;seckill:order:&#x27;</span> .. voucherId<br><br><span class="hljs-comment">-- åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦å·²ä¸‹è¿‡å•(ä¸€äººä¸€å•)</span><br><span class="hljs-keyword">if</span> (redis.call(<span class="hljs-string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="hljs-number">1</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- ä»¥ä¸‹è¿‡å•ï¼Œè¿”å›2</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-comment">-- æ‰£é™¤åº“å­˜ï¼Œä¸‹å•</span><br>redis.call(<span class="hljs-string">&#x27;incrby&#x27;</span>, stockKey, <span class="hljs-number">-1</span>)<br>redis.call(<span class="hljs-string">&#x27;sadd&#x27;</span>, orderKey, userId)<br><span class="hljs-comment">-- å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­</span><br>redis.call(<span class="hljs-string">&#x27;xadd&#x27;</span>, <span class="hljs-string">&#x27;stream.orders&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;userId&#x27;</span>, userId, <span class="hljs-string">&#x27;voucherId&#x27;</span>, voucherId, <span class="hljs-string">&#x27;id&#x27;</span>, orderId)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™å¤„ç†æ¶ˆæ¯é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherOrderHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;stream.orders&quot;</span>;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è·å–æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„è®¢å•ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™ä¼šé˜»å¡ä½</span><br>                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(<br>                    Consumer.from(<span class="hljs-string">&quot;g1&quot;</span>, <span class="hljs-string">&quot;c1&quot;</span>),<br>                    StreamReadOptions.empty().count(<span class="hljs-number">1</span>).block(Duration.ofSeconds(<span class="hljs-number">2</span>)),<br>                    StreamOffset.create(queueName, ReadOffset.lastConsumed())<br>                );<br>                <span class="hljs-keyword">if</span> (list == <span class="hljs-literal">null</span> || list.isEmpty()) &#123;<br>                    <span class="hljs-comment">// æ²¡æœ‰è¯»åˆ°æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span><br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="hljs-number">0</span>);<br>                Map&lt;Object, Object&gt; values = record.getValue();<br>                <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>(), <span class="hljs-literal">true</span>);<br>                <span class="hljs-comment">// åˆ›å»ºè®¢å•</span><br>                handleVoucherOrder(voucherOrder);<br>                <span class="hljs-comment">// ackç¡®è®¤</span><br>                stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="hljs-string">&quot;g1&quot;</span>, record.getId());<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);<br>                handlePendingList();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePendingList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è·å–æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„è®¢å•ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™ä¼šé˜»å¡ä½</span><br>                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(<br>                    Consumer.from(<span class="hljs-string">&quot;g1&quot;</span>, <span class="hljs-string">&quot;c1&quot;</span>),<br>                    StreamReadOptions.empty().count(<span class="hljs-number">1</span>),<br>                    StreamOffset.create(queueName, ReadOffset.from(<span class="hljs-string">&quot;0&quot;</span>))<br>                );<br>                <span class="hljs-keyword">if</span> (list == <span class="hljs-literal">null</span> || list.isEmpty()) &#123;<br>                    <span class="hljs-comment">// æ²¡æœ‰è¯»åˆ°æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="hljs-number">0</span>);<br>                Map&lt;Object, Object&gt; values = record.getValue();<br>                <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> BeanUtil.fillBeanWithMap(values, <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>(), <span class="hljs-literal">true</span>);<br>                <span class="hljs-comment">// åˆ›å»ºè®¢å•</span><br>                handleVoucherOrder(voucherOrder);<br>                <span class="hljs-comment">// ackç¡®è®¤</span><br>                stringRedisTemplate.opsForStream().acknowledge(queueName, <span class="hljs-string">&quot;g1&quot;</span>, record.getId());<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="ç‚¹èµ"><a href="#ç‚¹èµ" class="headerlink" title="ç‚¹èµ"></a>ç‚¹èµ</h4><blockquote><p>é€šè¿‡rediså­˜å“ªäº›ç”¨æˆ·ç‚¹èµäº†å“ªäº›æ–‡ç« ï¼Œå®ç°ä¸€ç¯‡æ–‡ç« ä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡</p></blockquote><p>ç‚¹èµæ—¶è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">likeBlog</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²ç»ç‚¹èµï¼Œå¦‚æœå·²ç‚¹èµåˆ™å–æ¶ˆç‚¹èµ</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;blog:liked:&quot;</span> + id;<br>    <span class="hljs-type">Double</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());<br>    <span class="hljs-keyword">if</span> (score == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// å¢åŠ ç‚¹èµæ•°</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked + 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>        <span class="hljs-comment">// ä¿å­˜ç‚¹èµä¿¡æ¯åˆ°Redisçš„SortedSetä¸­ï¼Œç”¨äºä¹‹åå¯ä»¥è·å–ç‚¹èµçš„é¡ºåº</span><br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å‡å°‘ç‚¹èµæ•°</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked - 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>        <span class="hljs-comment">// ä¿å­˜å–æ¶ˆç‚¹èµä¿¡æ¯åˆ°Redis</span><br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            stringRedisTemplate.opsForZSet().remove(key, userId.toString());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡idæŸ¥è¯¢æ–‡ç« æ—¶è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogById</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">Blog</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> getById(id);<br>    <span class="hljs-keyword">if</span> (blog == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åšå®¢ä¸å­˜åœ¨&quot;</span>);<br>    &#125;<br>    queryBlogUser(blog);<br>    <span class="hljs-comment">// æŸ¥è¯¢æ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</span><br>    isBlogLiked(blog);<br><br>    <span class="hljs-keyword">return</span> Result.ok(blog);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">isBlogLiked</span><span class="hljs-params">(Blog blog)</span> &#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;blog:liked:&quot;</span> + blog.getId();<br>    <span class="hljs-type">Double</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());<br>    blog.setIsLike(score != <span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢çƒ­é—¨æ–‡ç« æ—¶è°ƒç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryHotBlog</span><span class="hljs-params">(Integer current)</span> &#123;<br>    <span class="hljs-comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span><br>    Page&lt;Blog&gt; page = query()<br>        .orderByDesc(<span class="hljs-string">&quot;liked&quot;</span>)<br>        .page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));<br>    <span class="hljs-comment">// è·å–å½“å‰é¡µæ•°æ®</span><br>    List&lt;Blog&gt; records = page.getRecords();<br>    <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·</span><br>    records.forEach(blog -&gt; &#123;<br>        <span class="hljs-built_in">this</span>.queryBlogUser(blog);<br>        <span class="hljs-built_in">this</span>.isBlogLiked(blog);<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> Result.ok(records);<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç‚¹èµé¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogLikes</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢redisæ–‡ç« å‰5ä¸ªå…ˆç‚¹èµçš„ç”¨æˆ·id</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> RedisConstants.BLOG_LIKED_KEY + id;<br>    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">if</span> (top5 == <span class="hljs-literal">null</span> || top5.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>    &#125;<br>    List&lt;Long&gt; ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());<br>    <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>    List&lt;User&gt; users = userService.query().in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id, &quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list();<br>    List&lt;UserDTO&gt; userDTOS = users.stream().map(user -&gt;<br>                                                BeanUtil.copyProperties(user, UserDTO.class)<br>                                               ).collect(Collectors.toList());<br><br>    <span class="hljs-keyword">return</span> Result.ok(userDTOS);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å…³æ³¨"><a href="#å…³æ³¨" class="headerlink" title="å…³æ³¨"></a>å…³æ³¨</h4><p>é€šè¿‡seté›†åˆçš„æŸ¥çœ‹äº¤é›†åŠŸèƒ½å®ç°æŸ¥æ‰¾å…±åŒå…³æ³¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å…³æ³¨æ—¶å°†å…³æ³¨çš„ç”¨æˆ·å­˜åˆ°redisä¸­</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">follow</span><span class="hljs-params">(Long followUserId, Boolean isFollow)</span> &#123;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// æ ¹æ®isFollowåˆ¤æ–­å…³æ³¨è¿˜æ˜¯å–å…³</span><br>    <span class="hljs-keyword">if</span> (isFollow) &#123;<br>        <span class="hljs-type">Follow</span> <span class="hljs-variable">follow</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Follow</span>();<br>        follow.setFollowUserId(followUserId);<br>        follow.setUserId(userId);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> save(follow);<br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            <span class="hljs-comment">// æŠŠå…³æ³¨ç›®æ ‡å­˜åˆ°redis</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + userId;<br>            stringRedisTemplate.opsForSet().add(key, followUserId.toString());<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        LambdaQueryWrapper&lt;Follow&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>        wrapper.eq(Follow::getFollowUserId, followUserId)<br>            .eq(Follow::getUserId, userId);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> remove(wrapper);<br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            <span class="hljs-comment">// æŠŠå…³æ³¨ç›®æ ‡ä»redisç§»é™¤</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + userId;<br>            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">commonFollow</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥æ‰¾å½“å‰ç”¨æˆ·å’Œç›®æ ‡ç”¨æˆ·çš„å…±åŒå…³æ³¨</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span>;<br>    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(Arrays.asList(key + userId, key + id));<br>    <span class="hljs-keyword">if</span> (intersect == <span class="hljs-literal">null</span> || intersect.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>    &#125;<br>    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());<br>    <span class="hljs-comment">// è½¬æ¢æˆUserDTO</span><br>    List&lt;UserDTO&gt; users = userService.listByIds(ids)<br>        .stream().map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))<br>        .collect(Collectors.toList());<br>    <span class="hljs-keyword">return</span> Result.ok(users);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h4><blockquote><p>æ¨é€ä¹Ÿå«åšFeedæµï¼Œç›´è¯‘ä¸ºæŠ•å–‚ã€‚ä¸ºç”¨æˆ·æŒç»­çš„æä¾›â€œæ²‰æµ¸å¼â€çš„ä½“éªŒï¼Œé€šè¿‡æ— é™ä¸‹æ‹‰åˆ·æ–°è·å–æ–°çš„ä¿¡æ¯ã€‚</p></blockquote><p>Feedæµæœ‰å¸¸è§ä¸¤ç§æ¨¡å¼ï¼š</p><p><strong>Timeline</strong>ï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p><ul><li>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</li><li>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</li></ul><p><strong>æ™ºèƒ½æ’åº</strong>ï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p><ul><li>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</li><li>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨</li></ul><p>Timelineæ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£ã€‚è¢«å…³æ³¨äººå‘é€æ¶ˆæ¯åä¼šä¿å­˜åˆ°è‡ªå·±çš„é‚®ç®±ï¼Œç”¨æˆ·è‡ªå·±å»æ‹‰å–å…³æ³¨çš„äººçš„æ”¶ä»¶ç®±é‡Œçš„æ¶ˆæ¯<ul><li>ä¼˜ç‚¹ï¼šèŠ‚çº¦ç©ºé—´</li><li>ç¼ºç‚¹ï¼šæ¯”è¾ƒå»¶è¿Ÿï¼Œè¦æ‹‰çš„æ¶ˆæ¯å¤šæ—¶å¯¹æœåŠ¡å™¨æœ‰è¾ƒå¤§å‹åŠ›</li></ul></li><li><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚è¢«å…³æ³¨äººå‘é€æ¶ˆæ¯åä¼šä¸»åŠ¨å†™åˆ°å…³æ³¨äººçš„é‚®ç®±ä¸­<ul><li>ä¼˜ç‚¹ï¼šå®æ•ˆå¿«</li><li>ç¼ºç‚¹ï¼šå†…å­˜å ç”¨å¤§</li></ul></li><li><strong>æ¨æ‹‰ç»“åˆ</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆã€‚å¯¹ç²‰ä¸å°‘çš„è¢«å…³æ³¨äººä½¿ç”¨æ¨æ¨¡å¼ï¼›å¯¹äºç²‰ä¸å¤šçš„è¢«å…³æ³¨äººï¼Œå¯¹æ´»è·ƒç²‰ä¸ä½¿ç”¨æ¨æ¨¡å¼ï¼Œå¯¹å…¶ä»–ç²‰ä¸ä½¿ç”¨æ‹‰æ¨¡å¼</li></ul><p><strong>å®ä¾‹</strong></p><blockquote><p>æ¨æ¨¡å¼ï¼Œç”¨sortedSetä½œä¸ºæ”¶ä»¶ç®±</p></blockquote><p>æ¨ç»™ç²‰ä¸æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">saveBlog</span><span class="hljs-params">(Blog blog)</span> &#123;<br>    <span class="hljs-comment">// è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> UserHolder.getUser();<br>    blog.setUserId(user.getId());<br>    <span class="hljs-comment">// ä¿å­˜æ¢åº—åšæ–‡</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> save(blog);<br>    <span class="hljs-comment">// æ¨é€ç»™ç²‰ä¸</span><br>    <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>        List&lt;Follow&gt; followUserIds = followService.query().eq(<span class="hljs-string">&quot;follow_user_id&quot;</span>, user.getId()).list();<br>        <span class="hljs-keyword">for</span> (Follow follow : followUserIds) &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> follow.getUserId();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;feed:&quot;</span> + userId;<br>            stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> Result.ok(blog.getId());<br>&#125;<br></code></pre></td></tr></table></figure><p>ç²‰ä¸æŸ¥çœ‹æ¶ˆæ¯</p><blockquote><p>é€šè¿‡æ»šåŠ¨åˆ†é¡µå®ç°</p></blockquote><p><strong>æ»šåŠ¨åˆ†é¡µ</strong>ï¼šä»ä¸Šä¸€æ¬¡æŸ¥åˆ°çš„æ¶ˆæ¯å¼€å§‹åˆ†é¡µï¼Œé¿å…æœ‰æ–°æ¶ˆæ¯æ’å…¥å¯¼è‡´åˆæ‹¿åˆ°ä¸Šæ¬¡å·²ç»æ‹¿åˆ°çš„æ¶ˆæ¯</p><p><img src="/img/redis_img/gundongfenye.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogOfFollow</span><span class="hljs-params">(Long max, Integer offset)</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key max min LIMIT offset count</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;feed:&quot;</span> + userId;<br>    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate.opsForZSet().reverseRangeByScoreWithScores(<br>        key, <span class="hljs-number">0</span>, max, offset, <span class="hljs-number">2</span><br>    );<br>    <span class="hljs-keyword">if</span> (typedTuples == <span class="hljs-literal">null</span> || typedTuples.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok();<br>    &#125;<br>    <span class="hljs-comment">// è·å–æ•°æ®(blogId, æœ€å°æ—¶é—´æˆ³ï¼Œåç§»é‡(æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸­scoreä¸ºæœ€å°æ—¶é—´æˆ³çš„æ¶ˆæ¯ä¸ªæ•°))</span><br>    List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(typedTuples.size());<br>    <span class="hljs-type">long</span> <span class="hljs-variable">minTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// åç§»é‡offset</span><br>    <span class="hljs-keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; typedTuple : typedTuples) &#123;<br>        ids.add(Long.valueOf(typedTuple.getValue()));<br>        <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> typedTuple.getScore().longValue();<br>        os = time == minTime ? ++os : <span class="hljs-number">1</span>;<br>        minTime = time;<br>    &#125;<br>    <span class="hljs-comment">// æŸ¥è¯¢blog</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>    List&lt;Blog&gt; blogs = query().in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list();<br>    <span class="hljs-keyword">for</span> (Blog blog : blogs) &#123;<br>        queryBlogUser(blog);    <span class="hljs-comment">// æŸ¥è¯¢åšå®¢ä½œè€…</span><br>        isBlogLiked(blog);  <span class="hljs-comment">// æŸ¥è¯¢æ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</span><br>    &#125;<br>    <span class="hljs-comment">// å°è£…è¿”å›</span><br>    <span class="hljs-type">ScrollResult</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScrollResult</span>();<br>    r.setList(blogs);<br>    r.setOffset(os);<br>    r.setMinTime(minTime);<br><br>    <span class="hljs-keyword">return</span> Result.ok(r);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é™„è¿‘"><a href="#é™„è¿‘" class="headerlink" title="é™„è¿‘"></a>é™„è¿‘</h4><p><strong>GEOæ•°æ®ç±»å‹</strong>ï¼šGEOå°±æ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ã€‚Redisåœ¨3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ï¼Œåº•å±‚åŸºäºSortedSet</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>GEOADD</td><td>æ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</td></tr><tr><td>GEODIST</td><td>è®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</td></tr><tr><td>GEOHASH</td><td>å°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</td></tr><tr><td>GEOPOS</td><td>è¿”å›æŒ‡å®šmemberçš„åæ ‡</td></tr><tr><td>GEORADIUS</td><td>æŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚<strong>6.ä»¥åå·²åºŸå¼ƒ</strong></td></tr><tr><td>GEOSEARCH</td><td>åœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</td></tr><tr><td>GEOSEARCHSTORE</td><td>ä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p>æŒ‰åˆ†ç±»å¯¼å…¥åº—é“ºidå’Œåæ ‡åˆ°redis</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">loadShopData</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// æŸ¥è¯¢åº—é“ºä¿¡æ¯</span><br>    List&lt;Shop&gt; list = shopService.list();<br>    <span class="hljs-comment">// æŒ‰typeIdåˆ†ç»„</span><br>    Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));<br>    <span class="hljs-comment">// å­˜åˆ°redis</span><br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : map.entrySet()) &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">typeId</span> <span class="hljs-operator">=</span> entry.getKey();<br>        List&lt;Shop&gt; value = entry.getValue();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;shop:geo:&quot;</span> + typeId;<br>        ArrayList&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Shop shop : value) &#123;<br>            <span class="hljs-comment">// stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());</span><br>            locations.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;(shop.getId().toString(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(shop.getX(), shop.getY())));<br>        &#125;<br>        stringRedisTemplate.opsForGeo().add(key, locations);    <span class="hljs-comment">// ä¸€æ¬¡å­˜å¤šä¸ª</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢é™„è¿‘åº—é“ºåŠè·ç¦»ï¼Œ<strong>æ³¨æ„</strong>ï¼šredisç‰ˆæœ¬è¦åœ¨6.2ä»¥ä¸Šï¼Œå¦åˆ™ä½¿ç”¨ä¸äº†GEOSEARCHæŒ‡ä»¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryShopByType</span><span class="hljs-params">(Integer typeId, Integer current, Double x, Double y)</span> &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</span><br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">null</span> || y == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// æ ¹æ®ç±»å‹åˆ†é¡µæŸ¥è¯¢</span><br>        Page&lt;Shop&gt; page = query()<br>            .eq(<span class="hljs-string">&quot;type_id&quot;</span>, typeId)<br>            .page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));<br>        <span class="hljs-comment">// è¿”å›æ•°æ®</span><br>        <span class="hljs-keyword">return</span> Result.ok(page.getRecords());<br>    &#125;<br>    <span class="hljs-comment">// è®¡ç®—åˆ†é¡µå‚æ•°</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">from</span> <span class="hljs-operator">=</span> (current - <span class="hljs-number">1</span>) * SystemConstants.DEFAULT_PAGE_SIZE;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> current * SystemConstants.DEFAULT_PAGE_SIZE;<br>    <span class="hljs-comment">// æŸ¥è¯¢redis</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;shop:geo:&quot;</span> + typeId;<br>    GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo().search(<br>        key,    <span class="hljs-comment">// åº—é“ºç±»å‹</span><br>        GeoReference.fromCoordinate(x, y),  <span class="hljs-comment">// å½“å‰ä½ç½®</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Distance</span>(<span class="hljs-number">5000</span>),  <span class="hljs-comment">// åŠå¾„</span><br>        RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)  <span class="hljs-comment">// å¸¦ä¸Šè·ç¦»ã€æŸ¥è¯¢èŒƒå›´</span><br>    );<br>    <span class="hljs-keyword">if</span> (results == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>    &#125;<br>    <span class="hljs-comment">// æœé›†åº—é“ºidå’Œè·ç¦»</span><br>    List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; list = results.getContent();<br>    <span class="hljs-keyword">if</span> (list.size() &lt;= from) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList()); <br>    &#125;<br>    List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(list.size());<br>    Map&lt;String, Distance&gt; distanceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(list.size());<br>    list.stream().skip(from).forEach(result -&gt; &#123;<br>        <span class="hljs-comment">// åº—é“ºidå’Œè·ç¦»</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">shopIdStr</span> <span class="hljs-operator">=</span> result.getContent().getName();<br>        ids.add(Long.valueOf(shopIdStr));<br>        <span class="hljs-type">Distance</span> <span class="hljs-variable">distance</span> <span class="hljs-operator">=</span> result.getDistance();<br>        distanceMap.put(shopIdStr, distance);<br>    &#125;);<br>    <span class="hljs-comment">// æ ¹æ®åº—é“ºidæŸ¥è¯¢shop</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>    List&lt;Shop&gt; shops = query().in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id, &quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list();<br>    <span class="hljs-keyword">for</span> (Shop shop : shops) &#123;<br>        shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());<br>    &#125;<br>    <span class="hljs-keyword">return</span> Result.ok(shops);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h4><p>é€šè¿‡äºŒè¿›åˆ¶ä½ä¸Šçš„0å’Œ1è¡¨ç¤ºå½“å¤©æ˜¯å¦æœ‰ç­¾åˆ°</p><p>ä½¿ç”¨Redisçš„BitMapæ•°æ®ç»“æ„å®ç°ï¼ŒBitMapåŸºäºStringå®ç°</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>SETBIT</td><td>å‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</td></tr><tr><td>GETBIT</td><td>è·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</td></tr><tr><td>BITCOUNT</td><td>ç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</td></tr><tr><td>BITFIELD</td><td>æ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</td></tr><tr><td>BITFIELD_RO</td><td>è·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</td></tr><tr><td>BITOP</td><td>å°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</td></tr><tr><td>BITPOS</td><td>æŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</td></tr></tbody></table><p><strong>å®ä¾‹</strong></p><p>ç­¾åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sign</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// è·å–æ—¥æœŸåŠå½“å¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dayOfMonth</span> <span class="hljs-operator">=</span> now.getDayOfMonth();<br>    <span class="hljs-comment">// å†™å…¥redis</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">keySuffix</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;:yyyyMM&quot;</span>));<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;sign:&quot;</span> + userId + keySuffix;<br>    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);    <span class="hljs-comment">// trueè¡¨ç¤ºå†™å…¥1</span><br><br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»Ÿè®¡è¿ç»­ç­¾åˆ°æ¬¡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">signCount</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// è·å–æ—¥æœŸåŠå½“å¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">dayOfMonth</span> <span class="hljs-operator">=</span> now.getDayOfMonth();<br>    <span class="hljs-comment">// è·å–ç­¾åˆ°è®°å½•</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">keySuffix</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;:yyyyMM&quot;</span>));<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;sign:&quot;</span> + userId + keySuffix;<br>    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(<br>        key,<br>        BitFieldSubCommands.create().get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="hljs-number">0</span>)<br>    );<br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">// ç»Ÿè®¡åˆ°ä»Šå¤©ä¸ºæ­¢çš„ç­¾åˆ°æ•°</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> result.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-literal">null</span> || num == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ((num &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">1</span>) &#123;<br>        count++;<br>        num = num &gt;&gt; <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> Result.ok(count);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="UV"><a href="#UV" class="headerlink" title="UV"></a>UV</h4><p>Unique Visitor(ç‹¬ç«‹è®¿å®¢é‡)ï¼šä¸€å¤©åŒä¸€ä¸ªäººè®¿é—®ç½‘ç«™è®°å½•ä¸€æ¬¡</p><p>Page Viewï¼ˆç‚¹å‡»é‡ï¼‰ï¼šè®¿é—®ä¸€ä¸ªé¡µé¢å°±è®°å½•ä¸€æ¬¡</p><p>Hyperloglog(HLL)ï¼šæ¦‚ç‡ç®—æ³•ï¼Œç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œå¯¹é›†åˆå¤§å°çš„æµ‹é‡æœ‰ä¸€å®šçš„è¯¯å·®</p><p>Redisä¸­HLLæ˜¯åŸºäºstringç»“æ„å®ç°çš„ï¼Œå†…å­˜å ç”¨å¾ˆå°</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PFADD key eleâ€¦</td><td>æ·»åŠ å…ƒç´ </td></tr><tr><td>PFCOUNT key</td><td>è·å–å¤§å°</td></tr></tbody></table><p>javaä¸­ä½¿ç”¨stringRedisTemplate.opsForHyperLogLog()æ¥æ“ä½œ</p><h3 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h3><h4 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h4><h5 id="RDBæŒä¹…åŒ–"><a href="#RDBæŒä¹…åŒ–" class="headerlink" title="RDBæŒä¹…åŒ–"></a>RDBæŒä¹…åŒ–</h5><p>RDBå…¨ç§°Redis Database Backup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œå¤‡ä»½æ—¶æ˜¯æ›¿æ¢æ•´ä¸ªrdbæ–‡ä»¶</p><ul><li><p><strong>ä»€ä¹ˆæ—¶å€™ä¼šRDBæŒä¹…åŒ–</strong>ï¼š</p><ol><li><p>æ‰§è¡Œsaveå‘½ä»¤ï¼Œä¼šä½¿ç”¨ä¸»è¿›ç¨‹æŒä¹…åŒ–ï¼Œåœ¨æ­¤æœŸé—´å…¶ä»–å‘½ä»¤éƒ½ä¼šé˜»å¡</p></li><li><p>æ‰§è¡Œbgsaveï¼ˆå¼‚æ­¥æŒä¹…åŒ–ï¼‰å‘½ä»¤</p></li><li><p>åœæœºæ—¶è‡ªåŠ¨save</p></li><li><p>è§¦å‘RDBæ¡ä»¶ï¼Œæ‰§è¡Œbgsave(é…ç½®æ–‡ä»¶ä¸­è®¾ç½®)</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span><br><span class="hljs-attr">save</span> <span class="hljs-string">900 1  </span><br><span class="hljs-attr">save</span> <span class="hljs-string">300 10  </span><br><span class="hljs-attr">save</span> <span class="hljs-string">60 10000 </span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>ç›¸å…³é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span><br><span class="hljs-attr">rdbcompression</span> <span class="hljs-string">yes</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># RDBæ–‡ä»¶åç§°</span><br><span class="hljs-attr">dbfilename</span> <span class="hljs-string">dump.rdb  </span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span><br><span class="hljs-attr">dir</span> <span class="hljs-string">./ </span><br></code></pre></td></tr></table></figure></li></ul><h5 id="AOFæŒä¹…åŒ–"><a href="#AOFæŒä¹…åŒ–" class="headerlink" title="AOFæŒä¹…åŒ–"></a>AOFæŒä¹…åŒ–</h5><p>AOFå…¨ç§°ä¸ºAppend Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ï¼Œè®°å½•æ‰€æœ‰å†™å‘½ä»¤åˆ°aofä¸­</p><ul><li><p>å¼€å¯aof</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># ç¦ç”¨rdb</span><br><span class="hljs-attr">save</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no</span><br><span class="hljs-attr">appendonly</span> <span class="hljs-string">yes</span><br><span class="hljs-comment"># AOFæ–‡ä»¶çš„åç§°</span><br><span class="hljs-attr">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>æŒä¹…åŒ–é¢‘ç‡</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">always </span><br><span class="hljs-comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">everysec </span><br><span class="hljs-comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">no</span><br></code></pre></td></tr></table></figure></li><li><p>é‡å†™å‘½ä»¤ï¼ŒAOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœï¼Œä»¥å‹ç¼©æ–‡ä»¶å¤§å°ã€‚</p><p><code>BGREWRITEAOF</code></p></li><li><p>é‡å†™é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span><br><span class="hljs-attr">auto-aof-rewrite-percentage</span> <span class="hljs-string">100</span><br><span class="hljs-comment"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span><br><span class="hljs-attr">auto-aof-rewrite-min-size</span> <span class="hljs-string">64mb </span><br></code></pre></td></tr></table></figure></li></ul><h3 id="åˆ†å¸ƒå¼é”-1"><a href="#åˆ†å¸ƒå¼é”-1" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><p>â€‹åœ¨å•ä½“é¡¹ç›®ä¸‹ä¿è¯åŸå­æ€§å¯ä»¥ä½¿ç”¨synchronizedï¼Œåœ¨åˆ†å¸ƒå¼ä¸‹å°±æ— æ³•ä½¿ç”¨ã€‚</p><p>â€‹å¯ä»¥ä½¿ç”¨mysqlã€redisç­‰æ¥å®ç°å¤šçº¿ç¨‹ä¸‹çš„é”ã€‚åŸºæœ¬åŸç†æ˜¯æ ¹æ®idçš„å”¯ä¸€æ€§æ¥æ§åˆ¶ä¸åŒæœºå™¨ä¸­çš„è¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®</p><p><strong>å®ç°æ–¹å¼1</strong></p><blockquote><p><code>setnx</code>å‘½ä»¤ï¼šå½“ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®å€¼</p><p><code>expire</code>å‘½ä»¤ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´</p></blockquote><p>è·å–é”æ—¶ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">setnx <span class="hljs-keyword">lock</span> è¡¨ç¤ºå½“å‰è¿›ç¨‹çš„å”¯ä¸€å€¼<br>expire <span class="hljs-keyword">lock</span> <span class="hljs-number">5</span><span class="hljs-meta"># æ·»åŠ è¶…æ—¶æ—¶é—´</span><br></code></pre></td></tr></table></figure><p>é‡Šæ”¾é”æ—¶ï¼š</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">del <span class="hljs-keyword">lock</span><br></code></pre></td></tr></table></figure><p><strong>ç¼ºé™·</strong>ï¼š</p><p>å½“ä¸€ä¸ªjvmçš„çº¿ç¨‹è·å–é”åã€è®¾ç½®è¶…æ—¶æ—¶é—´å‰æŒ‚äº†ï¼Œå°±ä¼šå¯¼è‡´æ­»é”</p><p><strong>å®ç°æ–¹å¼2</strong></p><blockquote><p>ä½¿ç”¨<code>set key value ex timeout nx OK</code>æ¥è®©setå’Œexpireå‘½ä»¤æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ</p><p>æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨luaè„šæœ¬å®ç°</p></blockquote><p>è·å–é”æ—¶ï¼š</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-keyword">set</span> <span class="hljs-keyword">lock</span> è¡¨ç¤ºå½“å‰è¿›ç¨‹çš„å”¯ä¸€å€¼ EX <span class="hljs-number">4</span> NX ...<br></code></pre></td></tr></table></figure><p>é‡Šæ”¾é”æ—¶ï¼š</p><p>å¦‚æœé‡Šæ”¾é”å‰åˆ¤æ–­é”æ˜¯è‡ªå·±çš„é”ï¼Œä½†åˆ¤æ–­å®Œé”è¶…æ—¶äº†ï¼Œæ­¤æ—¶å°±æœ‰å¯èƒ½ä¼šé‡Šæ”¾æ‰åˆ«äººçš„é”ï¼Œéœ€è¦é€šè¿‡luaè„šæœ¬ä½¿åˆ¤æ–­é”å’Œé‡Šæ”¾é”æ˜¯åŸå­æ“ä½œ</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- ç¤ºä¾‹</span><br><span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">local</span> requestId = KEYS[<span class="hljs-number">2</span>]<br><span class="hljs-keyword">local</span> value = redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, key)<br><span class="hljs-keyword">if</span> value == requestId <span class="hljs-keyword">then</span><span class="hljs-comment">-- åˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±çš„é”</span><br>    redis.call(<span class="hljs-string">&#x27;del&#x27;</span>, key);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><p>ç¼ºé™·ï¼š</p><p>è‡ªå·±å®ç°å¤ªéº»çƒ¦äº†</p><p><strong>å®ç°æ–¹å¼3</strong></p><blockquote><p>é€šè¿‡Redissonå®ç°ï¼ŒRedissonå¸®å¿™å®ç°äº†åˆ†å¸ƒå¼é”</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissonClient redissonClient;<br><br><span class="hljs-type">RLock</span> <span class="hljs-variable">rLock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockName);<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLocked</span> <span class="hljs-operator">=</span> rLock.tryLock(expireTime, TimeUnit.MILLISECONDS);<br>    <span class="hljs-keyword">if</span> (isLocked) &#123;<br>        <span class="hljs-comment">// TODO</span><br>                &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            rLock.unlock();<br>    &#125;<br>...<br></code></pre></td></tr></table></figure><h3 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h3><p>windowsä¸‹æ¡ˆä¾‹ï¼šé…ç½®ä¸¤å°redisï¼Œä¸€ä¸»ä¸€ä»</p><ol><li><p>åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹<code>6379</code>ã€<code>6380</code>ï¼Œå°†é…ç½®æ–‡ä»¶<code>redis.windows.conf</code>å„å¤åˆ¶åˆ°æ–‡ä»¶å¤¹ä¸­ä¸€ä»½</p></li><li><p>å„åˆ›å»º<code>data</code>æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•°æ®æ–‡ä»¶</p></li><li><p><code>6379</code>ï¼ˆä¸»æœåŠ¡å™¨ï¼‰ä¸­è¦æ”¹çš„é…ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs conf"># ç«¯å£<br>port 6379<br><br># æ•°æ®ä¿å­˜çš„æ–‡ä»¶å¤¹<br>dir E:\redis\6379\data<br><br># å¯†ç <br>requirepass 123456<br></code></pre></td></tr></table></figure></li><li><p><code>6380</code>ï¼ˆä»æœåŠ¡å™¨ï¼‰ä¸­è¦æ”¹çš„é…ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs conf"># ç«¯å£<br>port 6380<br><br># æ•°æ®ä¿å­˜çš„æ–‡ä»¶å¤¹<br>dir E:\redis\6380\data<br><br># ä¸»æœåŠ¡å™¨å¯†ç <br>masterauth 123456<br><br># ä»å±äºå“ªå°æœåŠ¡å™¨<br>replicaof 127.0.0.1 6379<br></code></pre></td></tr></table></figure></li><li><p><code>redis-server.exe é…ç½®æ–‡ä»¶è·¯å¾„</code>å¯åŠ¨ä¸¤å°redis</p></li><li><p>springbootä¸­é…ç½®ç±»</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * redisåºåˆ—åŒ–å™¨é…ç½®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisConnectionFactory <span class="hljs-title function_">redisConnectionFactory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">LettuceClientConfiguration</span> <span class="hljs-variable">clientConfiguration</span> <span class="hljs-operator">=</span> LettuceClientConfiguration.builder()<br>                .readFrom(ReadFrom.REPLICA)     <span class="hljs-comment">// è¯»æ“ä½œéƒ½æ‰¾ä»èŠ‚ç‚¹</span><br>                .build();<br><br>        <span class="hljs-type">RedisStaticMasterReplicaConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisStaticMasterReplicaConfiguration</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6379</span>);<br>        configuration.addNode(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6380</span>);<br>        configuration.setPassword(<span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LettuceConnectionFactory</span>(configuration, clientConfiguration);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºRedisTemplateå¯¹è±¡</span><br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        <span class="hljs-comment">// è®¾ç½®è¿æ¥å·¥å‚</span><br>        template.setConnectionFactory(connectionFactory);<br>        <span class="hljs-comment">// åˆ›å»ºJSONåºåˆ—åŒ–å·¥å…·</span><br>        <span class="hljs-type">GenericJackson2JsonRedisSerializer</span> <span class="hljs-variable">jsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericJackson2JsonRedisSerializer</span>();<br>        <span class="hljs-comment">// åˆ›å»ºkeyåºåˆ—åŒ–å·¥å…·</span><br>        template.setKeySerializer(RedisSerializer.string());<br>        template.setHashKeySerializer(RedisSerializer.string());<br>        <span class="hljs-comment">// åˆ›å»ºvalueåºåˆ—åŒ–å·¥å…·</span><br>        template.setValueSerializer(jsonRedisSerializer);<br>        template.setHashValueSerializer(jsonRedisSerializer);<br><br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxéƒ¨ç½²javaé¡¹ç›®</title>
    <link href="/2022/08/14/linux/linux%E9%83%A8%E7%BD%B2java%E9%A1%B9%E7%9B%AE/"/>
    <url>/2022/08/14/linux/linux%E9%83%A8%E7%BD%B2java%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="linuxéƒ¨ç½²javaé¡¹ç›®"><a href="#linuxéƒ¨ç½²javaé¡¹ç›®" class="headerlink" title="linuxéƒ¨ç½²javaé¡¹ç›®"></a>linuxéƒ¨ç½²javaé¡¹ç›®</h2><h4 id="æ‰‹å·¥éƒ¨ç½²"><a href="#æ‰‹å·¥éƒ¨ç½²" class="headerlink" title="æ‰‹å·¥éƒ¨ç½²"></a>æ‰‹å·¥éƒ¨ç½²</h4><p>é¡¹ç›®åœ¨åå°è¿è¡Œ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">nohup Command <span class="hljs-selector-attr">[Arg...]</span><span class="hljs-selector-attr">[&amp;]</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜:</p><p>â€‹<strong>nohup</strong>: no hang upä¸æŒ‚èµ·ï¼Œé€€å‡ºç»ˆç«¯ä¹Ÿä¸ä¼šå½±å“ç¨‹åºè¿è¡Œ</p><p>â€‹<strong>Command</strong>: è¦æ‰§è¡Œçš„æŒ‡ä»¤</p><p>â€‹<strong>Arg</strong>: å‚æ•°</p><p>â€‹<strong>&amp;</strong>: è®©å‘½ä»¤åœ¨åå°è¿è¡Œ</p><p>ä¾‹å­:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">è¿è¡ŒjaråŒ…å¹¶æŠŠæ§åˆ¶å°çš„ä¿¡æ¯è¾“å‡ºåˆ°<span class="hljs-keyword">log</span>.<span class="hljs-keyword">log</span>æ–‡ä»¶ä¸­<br>nohup java -jar reggieTakeOut<span class="hljs-number">-1.0</span>-<span class="hljs-keyword">SNAPSHOT</span>.jar &amp;&gt; <span class="hljs-keyword">log</span>.<span class="hljs-keyword">log</span> &amp;<br></code></pre></td></tr></table></figure><p>å…³é—­é¡¹ç›®</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">æŸ¥æ‰¾è¿›ç¨‹<br>ps -ef | <span class="hljs-keyword">grep</span> java<br>æ€è¿›ç¨‹<br><span class="hljs-keyword">kill</span> -<span class="hljs-number">9</span> è¿›ç¨‹å·<br></code></pre></td></tr></table></figure><h4 id="é€šè¿‡Shellè„šæœ¬éƒ¨ç½²"><a href="#é€šè¿‡Shellè„šæœ¬éƒ¨ç½²" class="headerlink" title="é€šè¿‡Shellè„šæœ¬éƒ¨ç½²"></a>é€šè¿‡Shellè„šæœ¬éƒ¨ç½²</h4><ol><li><p>ä¸æ˜¯rootç®¡ç†å‘˜çš„è¯å¯èƒ½è¦æˆäºˆæƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> å…«è¿›åˆ¶è¡¨ç¤ºçš„æƒé™ æ–‡ä»¶å<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ.shè„šæœ¬æ–‡ä»¶</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç±»å›¾å’Œç”¨ä¾‹å›¾è€ƒç‚¹</title>
    <link href="/2022/08/13/%E8%BD%AF%E8%80%83/%E7%B1%BB%E5%9B%BE%E5%92%8C%E7%94%A8%E4%BE%8B%E5%9B%BE%E8%80%83%E7%82%B9/"/>
    <url>/2022/08/13/%E8%BD%AF%E8%80%83/%E7%B1%BB%E5%9B%BE%E5%92%8C%E7%94%A8%E4%BE%8B%E5%9B%BE%E8%80%83%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="ç±»å›¾å’Œç”¨ä¾‹å›¾è€ƒç‚¹"><a href="#ç±»å›¾å’Œç”¨ä¾‹å›¾è€ƒç‚¹" class="headerlink" title="ç±»å›¾å’Œç”¨ä¾‹å›¾è€ƒç‚¹"></a>ç±»å›¾å’Œç”¨ä¾‹å›¾è€ƒç‚¹</h2><h4 id="1-ç±»é—´å…³ç³»"><a href="#1-ç±»é—´å…³ç³»" class="headerlink" title="1.ç±»é—´å…³ç³»"></a>1.ç±»é—´å…³ç³»</h4><p><strong>ä¾èµ–</strong><img src="/img/post_img/1.png"></p><p>ä¹Ÿå°±æ˜¯ä½¿ç”¨ï¼Œåªè¦åœ¨ç±»ä¸­ç”¨åˆ°äº†å¯¹æ–¹ï¼Œå°±å«åšä¾èµ–ã€‚ç±»çš„æˆå‘˜å±æ€§ã€æ–¹æ³•çš„è¿”å›ç±»å‹ã€æ–¹æ³•æ¥æ”¶çš„å‚æ•°ç±»å‹ã€åœ¨æ–¹æ³•ä¸­ç”¨åˆ°ï¼Œéƒ½æ˜¯ä¾èµ–ã€‚<br>ç±»Açš„æ–¹æ³•ä¸­ä»…ä»…ä½¿ç”¨äº†ç±»Bçš„å¯¹è±¡ï¼Œé‚£ä¹ˆç±»Aä¾èµ–äºç±»Bã€‚</p><p><strong>å…³è”</strong><img src="/img/post_img/2.png"></p><p>ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»<br>å…³è”å…·æœ‰å¤šé‡æ€§ï¼šä¸€å¯¹ä¸€å…³ç³»ã€ä¸€å¯¹å¤šå…³ç³»ã€å¤šå¯¹å¤šå…³ç³»</p><p><strong>èšåˆ</strong><img src="/img/post_img/3.png"><br>ç±»Aä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ç±»B</p><p><strong>ç»„åˆ</strong><img src="/img/post_img/4.png"><br>ä¹Ÿå°±æ˜¯ç±»Aä¸­æœ‰ç±»Bçš„å¯¹è±¡ï¼Œä¸”é€šè¿‡new B()çš„æ–¹å¼åˆ›å»º</p><p><strong>æ³›åŒ–ï¼ˆç»§æ‰¿ï¼‰</strong><img src="/img/post_img/5.png"></p><p>ä¹Ÿå°±æ˜¯ç»§æ‰¿</p><p><strong>å®ç°</strong><img src="/img/post_img/6.png"></p><p>å¦‚æ¥å£çš„å®ç°</p><h4 id="2-ç”¨ä¾‹é—´å…³ç³»"><a href="#2-ç”¨ä¾‹é—´å…³ç³»" class="headerlink" title="2.ç”¨ä¾‹é—´å…³ç³»"></a>2.ç”¨ä¾‹é—´å…³ç³»</h4><p><strong>åŒ…å«å…³ç³»(include) :</strong></p><p>åŸºç”¨ä¾‹ä¸­ä½¿ç”¨äº†è¢«åŒ…å«ç”¨ä¾‹ï¼Œæ²¡æœ‰è¢«åŒ…å«ç”¨ä¾‹çš„åŸºç”¨ä¾‹æ˜¯ä¸å®Œæ•´çš„ï¼›</p><p>ä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼Œåœ¨çº¿ä¸Šæ ‡æ³¨<code>&lt;&lt;include&gt;&gt;</code>ï¼Œç®­å¤´ä»åŸºç”¨ä¾‹æŒ‡å‘è¢«åŒ…å«ç”¨ä¾‹;</p><p><img src="/img/post_img/20161103115539825.png"></p><p><strong>æ‰©å±•å…³ç³»(extend)ï¼š</strong></p><p>å¯¹åŸºç”¨ä¾‹è¡Œä¸ºçš„æ‰©å±•ï¼Œå³ä½¿æ²¡æœ‰æ‰©å±•ç”¨ä¾‹ï¼ŒåŸºç”¨ä¾‹ä¹Ÿæ˜¯å®Œæ•´çš„ï¼›</p><p>ä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼Œåœ¨çº¿ä¸Šæ ‡æ³¨<code>&lt;&lt;extend&gt;&gt;</code>ï¼Œç®­å¤´ä»æ‰©å±•ç”¨ä¾‹æŒ‡å‘åŸºç”¨ä¾‹;</p><p><img src="/img/post_img/20161103115623076.png"></p><p><strong>æ³›åŒ–(generlize):</strong></p><p>ä¸€ä¸ªçˆ¶ç”¨ä¾‹å¯ä»¥è¢«ç‰¹åŒ–å½¢æˆå¤šä¸ªå­ç”¨ä¾‹ï¼Œç±»ä¼¼äºå®ç°æ¥å£ï¼›</p><p>ä½¿ç”¨å®ç°ç©ºå¿ƒç®­å¤´è¡¨ç¤ºï¼Œç®­å¤´ä»å­ç”¨ä¾‹æŒ‡å‘åŸºç”¨ä¾‹ï¼›</p><p><img src="/img/post_img/20161103115643014.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxè½¯ä»¶å®‰è£…</title>
    <link href="/2022/08/13/linux/linux%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <url>/2022/08/13/linux/linux%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h2 id="linuxè½¯ä»¶å®‰è£…"><a href="#linuxè½¯ä»¶å®‰è£…" class="headerlink" title="linuxè½¯ä»¶å®‰è£…"></a>linuxè½¯ä»¶å®‰è£…</h2><h4 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h4><p>â€‹<strong>æŸ¥çœ‹çŠ¶æ€</strong></p><p>â€‹systemctl status firewalld.service</p><p>â€‹<strong>æ‰“å¼€é˜²ç«å¢™</strong></p><p>â€‹systemctl start firewalld.service</p><p>â€‹<strong>å…³é—­é˜²ç«å¢™</strong></p><p>â€‹systemctl stop firewalld.service</p><p>â€‹<strong>å¼€å¯é˜²ç«å¢™</strong></p><p>â€‹systemctl enable firewalld.service</p><p>â€‹<strong>ç¦ç”¨é˜²ç«å¢™</strong></p><p>â€‹systemctl disable firewalld.service</p><p>â€‹<strong>é‡å¯é˜²ç«å¢™</strong></p><p>â€‹systemctl restart firewalld</p><p>â€‹<strong>å¼€æ”¾å•ä¸ªç«¯å£</strong></p><p>â€‹firewall-cmd â€“zone&#x3D;public â€“add-port&#x3D;ç«¯å£å·&#x2F;tcp â€“permanent</p><p>â€‹é‡å¯é˜²ç«å¢™åç”Ÿæ•ˆ</p><p>â€‹<strong>å…³é—­å•ä¸ªç«¯å£</strong></p><p>â€‹firewall-cmd â€“zone&#x3D;public â€“remove-port&#x3D;ç«¯å£å·&#x2F;tcp â€“permanent</p><p>â€‹é‡å¯é˜²ç«å¢™åç”Ÿ</p><h4 id="ç½‘å¡"><a href="#ç½‘å¡" class="headerlink" title="ç½‘å¡"></a>ç½‘å¡</h4><ol><li><p>è¿›å…¥ç½‘å¡é…ç½®ç›®å½•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/etc/</span>sysconfig<span class="hljs-regexp">/network-scripts/</span><br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘ç½‘å¡é…ç½®æ–‡ä»¶</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vim ifcfg-ens33<br><br>ä¿®æ”¹ç½‘å¡IP<br><span class="hljs-attribute">TYPE</span>=Ethernet#è®¾ç½®ç½‘å¡ç±»å‹ï¼Œâ€œEthernetâ€è¡¨ç¤ºä»¥å¤ªç½‘<br><span class="hljs-attribute">DEVICE</span>=ens33#è®¾ç½®ç½‘å¡çš„åç§°<br><span class="hljs-attribute">ONBOOT</span>=<span class="hljs-literal">yes</span>#è®¾ç½®ç½‘å¡æ˜¯å¦åœ¨ Linux æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶æ¿€æ´»<br><span class="hljs-attribute">BOOTPROTO</span>=static#è®¾ç½®ç½‘å¡çš„é…ç½®æ–¹å¼ï¼Œâ€œstaticâ€è¡¨ç¤ºä½¿ç”¨é™æ€IPåœ°å€ï¼Œâ€œdhcpâ€æ—¶è¡¨ç¤ºåŠ¨æ€è·å–åœ°å€<br><span class="hljs-attribute">IPADDR</span>=192.168.80.3#è®¾ç½®ç½‘å¡çš„<span class="hljs-built_in"> IP </span>åœ°å€<br><span class="hljs-attribute">NETMASK</span>=255.255.255.0#è®¾ç½®ç½‘å¡çš„å­ç½‘æ©ç <br><span class="hljs-attribute">GATEWAY</span>=192.168.80.2#è®¾ç½®ç½‘å¡çš„é»˜è®¤ç½‘å…³åœ°å€<br><span class="hljs-attribute">DNS1</span>=192.168.80.2#è®¾ç½®DNSæœåŠ¡å™¨çš„<span class="hljs-built_in"> IP </span>åœ°å€<br><br>é‡è½½ç½‘å¡<br>nmcli<span class="hljs-built_in"> connection </span>reload<br></code></pre></td></tr></table></figure></li></ol><h4 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h4><ol><li><p>ä¸‹è½½jdk    <a href="https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html">å®˜ç½‘ä¸‹è½½</a></p></li><li><p>ä¸Šä¼ jdkçš„äºŒè¿›åˆ¶å‘å¸ƒåŒ…(tar.gz)</p></li><li><p>è§£å‹å®‰è£…åŒ… </p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">tar</span> <span class="hljs-operator">-</span><span class="hljs-variable">zxvf</span> å‹ç¼©åŒ…å <span class="hljs-operator">-</span><span class="hljs-built_in">C</span> è§£å‹åˆ°çš„è·¯å¾„<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®ç¯å¢ƒå˜é‡ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/profile<br><br>æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾<br><span class="hljs-built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_333-amd64<br><span class="hljs-built_in">export</span> <br>CLASSPATH=<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib <br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><br>ä½¿ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ<br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹jdkæ˜¯å¦å®‰è£…æˆåŠŸ </p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">java -<span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure></li></ol><h4 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h4><ol><li><p>ä¸‹è½½tomcat     <a href="https://mirrors.huaweicloud.com/apache/tomcat/tomcat-8/v8.5.81/bin/">é•œåƒ</a></p></li><li><p>è§£å‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf apache-tomcat-<span class="hljs-number">8</span>.<span class="hljs-number">5</span>.<span class="hljs-number">81</span>.tar.gz <br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œbinç›®å½•ä¸‹çš„startup.shæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./startup.sh<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">æŸ¥çœ‹è¿›ç¨‹<br><span class="hljs-keyword">ps</span> -ef | <span class="hljs-keyword">grep</span> tomcat<br></code></pre></td></tr></table></figure></li></ol><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p>â€‹ç¢°åˆ°é”™è¯¯ï¼šä¸ºä»“åº“ â€˜appstreamâ€™ ä¸‹è½½å…ƒæ•°æ®å¤±è´¥ : Cannot prepare internal mirrorlist: No URLs in mirrorlistæ—¶è§£å†³åŠæ³•: <a href="https://blog.csdn.net/wykqh/article/details/123004620">CentOS Linux 8 - AppStream é”™è¯¯</a></p><ol><li><p>å®‰è£…<a href="https://dev.mysql.com/downloads/repo/yum/">MySQL Yumå­˜å‚¨åº“</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">rpm</span> -ivh mysql80-community-release-el8-<span class="hljs-number">4</span>.noarch.rpm<br></code></pre></td></tr></table></figure></li><li><p>ç¦ç”¨é»˜è®¤ MySQL æ¨¡å—</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">yum module <span class="hljs-built_in">disable</span> mysql<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£… MySQL</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">yum install mysql-community-<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ MySQL æœåŠ¡</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nsis">æŸ¥çœ‹mysqlæœåŠ¡çŠ¶æ€<br><span class="hljs-params">system</span>ctl status mysqld<br>å¯åŠ¨ MySQL æœåŠ¡<br><span class="hljs-params">system</span>ctl start mysqld<br>å¼€æœºè‡ªåŠ¨å¯åŠ¨mysqlæœåŠ¡<br><span class="hljs-params">system</span>ctl enable mysqld<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">æŸ¥çœ‹mysqlè¿›ç¨‹<br><span class="hljs-keyword">ps</span> -ef | <span class="hljs-keyword">grep</span> mysql<br>æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡<br>netstat -tunpl<br></code></pre></td></tr></table></figure></li><li><p>ç™»å½•mysql</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æŸ¥çœ‹ä¸´æ—¶å¯†ç <br>cat /var/<span class="hljs-keyword">log</span>/mysqld.<span class="hljs-keyword">log</span> | grep <span class="hljs-keyword">password</span><br>é€šè¿‡ä¸´æ—¶å¯†ç ç™»å½•<br>å…ˆè®¾ç½®ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å¯†ç <br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;MyNewPwd1!&#x27;</span>;<br>ä¿®æ”¹å¯†ç æœ€ä½ä½æ•°å’Œå®‰å…¨ç­‰çº§(MySQL <span class="hljs-number">8.0</span>ä»¥ä¸Š)<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> validate_password.length=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> validate_password.<span class="hljs-keyword">policy</span>=<span class="hljs-number">0</span>;<br>ç„¶åå¯ä»¥å†è®¾ç½®ä¸€ä¸ªç®€å•çš„å¯†ç <br></code></pre></td></tr></table></figure></li><li><p>å¼€å¯è¿œç¨‹è¿æ¥</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">use mysql; <br><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> host = <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> =<span class="hljs-string">&#x27;root&#x27;</span>;<br><br>(mysql8<span class="hljs-number">.0</span>ä»¥ä¸Š, è¿œç¨‹è¿æ¥æ—¶å‡ºç°<span class="hljs-number">2058</span>é”™è¯¯)<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;è¿œç¨‹ç™»å½•å¯†ç &#x27;</span>;<br><br>åˆ·æ–°é…ç½®<br>flush <span class="hljs-keyword">privileges</span>;<br></code></pre></td></tr></table></figure></li></ol><h4 id="lrzsz"><a href="#lrzsz" class="headerlink" title="lrzsz"></a>lrzsz</h4><p>lrzszæ˜¯ä¸€æ¬¾åœ¨linuxé‡Œå¯ä»£æ›¿ftpä¸Šä¼ å’Œä¸‹è½½çš„ç¨‹åº</p><ol><li><p>æœç´¢lrzszå®‰è£…åŒ…</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yum list lrzsz</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨çº¿å®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> lrzsz.x86_64<br></code></pre></td></tr></table></figure></li><li><p>æ‰“å¼€æ–‡ä»¶ä¸Šä¼ ç•Œé¢</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">rz</span><br></code></pre></td></tr></table></figure></li></ol><h4 id="git"><a href="#git" class="headerlink" title="git"></a>git</h4><ol><li><p>æœç´¢gitå®‰è£…åŒ…</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">yum list git</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨çº¿å®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> git<br></code></pre></td></tr></table></figure></li></ol><h4 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h4><ol><li><p><a href="https://archive.apache.org/dist/maven/maven-3/">å®˜ç½‘ä¸‹è½½</a></p></li><li><p>è§£å‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">tar</span> -zxvf å‹ç¼©åŒ…å<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>profile<br>export MAVEN_HOME=<span class="hljs-regexp">/home/</span>cyx<span class="hljs-regexp">/maven/</span>apache-maven-<span class="hljs-number">3.6</span>.<span class="hljs-number">3</span><br>export PATH=<span class="hljs-variable">$JAVA_HOME</span><span class="hljs-regexp">/bin:$MAVEN_HOME/</span>bin:<span class="hljs-variable">$PATH</span><br><br>ä½¿é…ç½®æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆ<br>source <span class="hljs-regexp">/etc/</span>profile<br>æŸ¥çœ‹mavenç‰ˆæœ¬<br>mvn -version<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹mavené…ç½®æ–‡ä»¶</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">vim /conf/settings.<span class="hljs-keyword">xml</span><br><span class="hljs-title">è®¾ç½®æœ¬åœ°ä»“åº“</span><br><span class="hljs-title">&lt;localRepository</span>&gt;ä»“åº“è·¯å¾„<span class="hljs-tag">&lt;/localRepository&gt;</span><br></code></pre></td></tr></table></figure></li></ol><h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><ol><li><p><a href="https://download.redis.io/releases/">å®˜ç½‘ä¸‹è½½</a></p></li><li><p>ä¸Šä¼ è§£å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">-tar -zxvf å‹ç¼©åŒ…å<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…ä¾èµ–ç¯å¢ƒgcc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum install gcc-c++<br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs linux">åˆ°redisç›®å½•ä¸‹<br>make<br>åˆ°redis/srcç›®å½•ä¸‹<br>make install<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ç»‘å®šåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®</span><br><span class="hljs-built_in">bind</span> 0.0.0.0<br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1</span><br>databases 1<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨Redisï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-server redis.conf<br></code></pre></td></tr></table></figure><p>åœæ­¢redisæœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli shutdown<br></code></pre></td></tr></table></figure></li></ol><h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><ol><li><p>å®‰è£…python-pip</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs linux">yum -y install epel-release<br>dnf install -y python3<br>dnf install python3-paramiko<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…docker-compose</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">pip3 install docker-compose<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs linux">docker-compose --version<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®æµå›¾è€ƒç‚¹</title>
    <link href="/2022/08/12/%E8%BD%AF%E8%80%83/%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE%E8%80%83%E7%82%B9/"/>
    <url>/2022/08/12/%E8%BD%AF%E8%80%83/%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE%E8%80%83%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®æµå›¾è€ƒç‚¹"><a href="#æ•°æ®æµå›¾è€ƒç‚¹" class="headerlink" title="æ•°æ®æµå›¾è€ƒç‚¹"></a>æ•°æ®æµå›¾è€ƒç‚¹</h2><h4 id="1-é»‘æ´ï¼Œç™½æ´ï¼Œç°æ´"><a href="#1-é»‘æ´ï¼Œç™½æ´ï¼Œç°æ´" class="headerlink" title="1.é»‘æ´ï¼Œç™½æ´ï¼Œç°æ´"></a>1.é»‘æ´ï¼Œç™½æ´ï¼Œç°æ´</h4><p><strong>æ•°æ®å¹³è¡¡åŸåˆ™</strong>: </p><p>åŠ å·¥çš„è¾“å…¥æ•°æ®æµå’Œè¾“å‡ºæ•°æ®æµè¦å¹³è¡¡ï¼Œå³ä¿è¯åŠ å·¥çš„è¾“å‡ºæ•°æ®æµéƒ½æœ‰å…¶å¯¹åº”çš„è¾“å…¥æ•°æ®æµä¸è¾“å‡ºæ•°æ®æµã€‚çˆ¶å›¾å’Œå­å›¾ä¹‹é—´çš„æ•°æ®æµå¿…é¡»ä¿æŒä¸€è‡´ï¼Œå¦‚æœä¸Šå±‚æ•°æ®æµåº•éƒ¨æŸåŠ å·¥çš„ä¸€ä¸ªè¾“å…¥ï¼ˆè¾“å‡ºï¼‰æ•°æ®æµå¯¹åº”äºä¸‹å±‚æ•°æ®æµå›¾ä¸­è‹¥å¹²ä¸ªè¾“å…¥ï¼ˆè¾“å‡ºï¼‰æ•°æ®æµï¼Œè€Œä¸”ä¸‹å±‚æ•°æ®æµä¸­è¿™äº›æ•°æ®æµçš„æˆåˆ†ä¹‹å’Œæ­£å¥½ç­‰äºä¸Šå±‚æ•°æ®æµåº•éƒ¨çš„è¿™ä¸ªæ•°æ®æµï¼Œé‚£ä¹ˆï¼Œå®ƒä»ç®—æ˜¯å¹³è¡¡çš„ã€‚</p><p><strong>åˆ†è§£æ—¶ä¸‰ç§å¸¸è§é”™è¯¯</strong>:</p><p>é»‘æ´: åªæœ‰è¾“å…¥æ•°æ®æµ,æ²¡æœ‰è¾“å‡ºæ•°æ®æµçš„æ•°æ®åŠ å·¥</p><p>å¥‡è¿¹: åªæœ‰è¾“å‡ºæ•°æ®æµ,æ²¡æœ‰è¾“å…¥æ•°æ®æµçš„æ•°æ®åŠ å·¥</p><p>ç°æ´: è¾“å…¥æ•°æ®æµæ— æ³•é€šè¿‡åŠ å·¥äº§ç”Ÿè¾“å‡ºæµ</p><h4 id="2-æ‰¾ç¼ºå¤±çš„æ•°æ®æµ"><a href="#2-æ‰¾ç¼ºå¤±çš„æ•°æ®æµ" class="headerlink" title="2.æ‰¾ç¼ºå¤±çš„æ•°æ®æµ"></a>2.æ‰¾ç¼ºå¤±çš„æ•°æ®æµ</h4><p>ä¸‰æ­¥ï¼š</p><ol><li>ä»çˆ¶å›¾ä¸­æ‰¾å­å›¾æ˜¯å¦æœ‰ç¼ºå¤±çš„æ•°æ®æµ</li><li>æ‰¾æ˜¯å¦æœ‰åŠ å·¥ç¼ºå°‘è¾“å…¥æˆ–è¾“å‡º</li><li>ä»é¢˜çš„è¯´æ˜ä¸­æ‰¾åŠ å·¥çš„æ•°æ®æµ</li></ol><p>æ•°æ®æµè‡³å°‘æœ‰ä¸€å¤´ä¸ºåŠ å·¥</p><h4 id="3-ç»“æ„åŒ–è¯­è¨€æè¿°åŠ å·¥é€»è¾‘"><a href="#3-ç»“æ„åŒ–è¯­è¨€æè¿°åŠ å·¥é€»è¾‘" class="headerlink" title="3.ç»“æ„åŒ–è¯­è¨€æè¿°åŠ å·¥é€»è¾‘"></a>3.ç»“æ„åŒ–è¯­è¨€æè¿°åŠ å·¥é€»è¾‘</h4><ul><li><p>é€‰æ‹©è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs é€‰æ‹©è¯­å¥">IF æ¡ä»¶ THEN<br>    åˆ†æ”¯å†…å®¹<br>ELSE IF æ¡ä»¶ THEN<br>    åˆ†æ”¯å†…å®¹<br>ELSE<br>    åˆ†æ”¯å†…å®¹<br>ENDIF<br></code></pre></td></tr></table></figure></li><li><p>å¾ªç¯è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs å¾ªç¯è¯­å¥">WHILE æ¡ä»¶<br>DO<br>&#123;<br>    IF æ¡ä»¶ THEN<br>        å†…å®¹<br>    ENDIF<br>&#125;<br>ENDDO<br></code></pre></td></tr></table></figure></li></ul><h4 id="4-çˆ¶å›¾å’Œå­å›¾å¦‚ä½•ä¿æŒæ•°æ®æµå›¾å¹³è¡¡"><a href="#4-çˆ¶å›¾å’Œå­å›¾å¦‚ä½•ä¿æŒæ•°æ®æµå›¾å¹³è¡¡" class="headerlink" title="4.çˆ¶å›¾å’Œå­å›¾å¦‚ä½•ä¿æŒæ•°æ®æµå›¾å¹³è¡¡"></a>4.çˆ¶å›¾å’Œå­å›¾å¦‚ä½•ä¿æŒæ•°æ®æµå›¾å¹³è¡¡</h4><p>çˆ¶å›¾ä¸­æŸåŠ å·¥çš„è¾“å…¥è¾“å‡ºæ•°æ®æµå¿…é¡»ä¸å…¶å­å›¾çš„è¾“å…¥è¾“å‡ºæ•°æ®æµåœ¨æ•°é‡å’Œåå­—ä¸Šç›¸åŒï¼Œæˆ–è€…çˆ¶å›¾ä¸­çš„ä¸€ä¸ªè¾“å…¥ï¼ˆæˆ–è¾“å‡ºï¼‰æ•°æ®æµåº”å¯¹åº”äºå­å›¾ä¸­å‡ ä¸ªè¾“å…¥ï¼ˆæˆ–è¾“å‡ºï¼‰æ•°æ®æµå¹¶é›†ï¼Œè€Œå­å›¾ä¸­ç»„æˆè¿™äº›æ•°æ®æµçš„æ•°æ®é¡¹æ­£å¥½æ˜¯çˆ¶å›¾ä¸­çš„è¿™ä¸€ä¸ªæ•°æ®æµ</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>è½¯è€ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2022/08/12/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2022/08/12/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="linuxå¸¸ç”¨å‘½ä»¤"><a href="#linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="linuxå¸¸ç”¨å‘½ä»¤"></a>linuxå¸¸ç”¨å‘½ä»¤</h2><h4 id="ç›®å½•æ“ä½œ"><a href="#ç›®å½•æ“ä½œ" class="headerlink" title="ç›®å½•æ“ä½œ"></a>ç›®å½•æ“ä½œ</h4><table><thead><tr><th align="left"></th><th>å‘½ä»¤</th><th>å¯¹åº”å•è¯</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td align="left">1</td><td>ls [-aæ‰€æœ‰-lè¯¦ç»†]</td><td>list</td><td>æŸ¥çœ‹å½“å‰ç›®å½•å†…å®¹</td></tr><tr><td align="left">2</td><td>pwd</td><td>print work directory</td><td>æŸ¥çœ‹å½“å‰æ‰€åœ¨ç›®å½•</td></tr><tr><td align="left">3</td><td>cd ç›®å½•å</td><td>change directory</td><td>åˆ‡æ¢ç›®å½•</td></tr><tr><td align="left">4</td><td>mkdir  ç›®å½•å</td><td>make directory</td><td>åˆ›å»ºç›®å½•</td></tr><tr><td align="left">5</td><td>rmdir [-påµŒå¥—åˆ é™¤] ç›®å½•å</td><td>remove directory</td><td>åˆ é™¤ç©ºç›®å½•</td></tr><tr><td align="left">6</td><td>rm [-ræ‰€æœ‰-fæ— éœ€ç¡®è®¤]ç›®å½•å</td><td>remove</td><td>å¯ä»¥åˆ é™¤éç©ºç›®å½•</td></tr><tr><td align="left">7</td><td>cp [-ræ‹·è´ç›®å½•] æºç›®å½• ç›®æ ‡ç›®å½•</td><td>copy</td><td>æ‹·è´ç›®å½•</td></tr><tr><td align="left">8</td><td>mv æºç›®å½• ç›®æ ‡ç›®å½•&#x2F;[æ–°ç›®å½•å]&#x2F;</td><td>move</td><td>ç§»åŠ¨ç›®å½•</td></tr></tbody></table><h4 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h4><table><thead><tr><th></th><th>å‘½ä»¤</th><th>å¯¹åº”å•è¯</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>1</td><td>touch æ–‡ä»¶å</td><td>touch</td><td>è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºç›®å½•</td></tr><tr><td>2</td><td>rm æ–‡ä»¶å</td><td>remove</td><td>åˆ é™¤æ–‡ä»¶</td></tr><tr><td>3</td><td>cat [-næ˜¾ç¤ºè¡Œæ•°] æ–‡ä»¶å</td><td></td><td>æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰å†…å®¹</td></tr><tr><td>4</td><td>more æ–‡ä»¶å</td><td></td><td>åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹(å›è½¦ä¸‹ä¸€è¡Œ,ç©ºæ ¼ä¸‹ä¸€å±,bä¸Šä¸€å±,qé€€å‡º)</td></tr><tr><td>5</td><td>tail [-fåŠ¨æ€æ˜¾ç¤º] æ–‡ä»¶å</td><td></td><td>è¯»å–æ–‡ä»¶æœ«å°¾å†…å®¹</td></tr><tr><td>6</td><td>cp æºæ–‡ä»¶ ç›®æ ‡ç›®å½•</td><td>copy</td><td>æ‹·è´æ–‡ä»¶</td></tr><tr><td>7</td><td>mv æºæ–‡ä»¶ ç›®æ ‡ç›®å½•&#x2F;[æ–°æ–‡ä»¶å]</td><td>move</td><td>ç§»åŠ¨æ–‡ä»¶</td></tr></tbody></table><h4 id="å‹ç¼©æ‰“åŒ…-x2F-è§£å‹"><a href="#å‹ç¼©æ‰“åŒ…-x2F-è§£å‹" class="headerlink" title="å‹ç¼©æ‰“åŒ…&#x2F;è§£å‹"></a>å‹ç¼©æ‰“åŒ…&#x2F;è§£å‹</h4><p>tar [-zcxvf] å‹ç¼©åŒ…å æ‰“åŒ…çš„æ–‡ä»¶</p><table><thead><tr><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-c</td><td>å°†å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œæ‰“åŒ…ã€‚</td></tr><tr><td>-z</td><td>é€šè¿‡gzipæ¥å‹ç¼©&#x2F;è§£å‹</td></tr><tr><td>-f åŒ…å</td><td>æŒ‡å®šåŒ…çš„æ–‡ä»¶åã€‚åŒ…çš„æ‰©å±•åæ˜¯ç”¨æ¥ç»™ç®¡ç†å‘˜è¯†åˆ«æ ¼å¼çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦æ­£ç¡®æŒ‡å®šæ‰©å±•åï¼›</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºæ‰“åŒ…æ–‡ä»¶è¿‡ç¨‹ï¼›</td></tr><tr><td>-x</td><td>è§£å‹ç¼©</td></tr></tbody></table><h4 id="æ–‡æœ¬ç¼–è¾‘"><a href="#æ–‡æœ¬ç¼–è¾‘" class="headerlink" title="æ–‡æœ¬ç¼–è¾‘"></a>æ–‡æœ¬ç¼–è¾‘</h4><p>vi&#x2F;vim æ–‡ä»¶å</p><h4 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h4><table><thead><tr><th>è¯­æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>find ç›®å½•å -name æ–‡ä»¶å</td><td>é€šè¿‡æ–‡ä»¶åæ¥æ¨¡ç³ŠæŸ¥æ‰¾æ–‡ä»¶</td></tr><tr><td>grep å•è¯ æ–‡ä»¶å</td><td>ä»æ–‡ä»¶ä¸­æŸ¥æ‰¾æ–‡æœ¬å†…å®¹</td></tr></tbody></table><h4 id="é€‰é¡¹å¯¹åº”çš„å•è¯"><a href="#é€‰é¡¹å¯¹åº”çš„å•è¯" class="headerlink" title="é€‰é¡¹å¯¹åº”çš„å•è¯"></a>é€‰é¡¹å¯¹åº”çš„å•è¯</h4><p>-a<br>all : å…¨éƒ¨ï¼Œæ‰€æœ‰ (ls , lsattr , uname)<br>archive : å­˜æ¡£ (cp , rsync)<br>append : é™„åŠ  (tar -A , 7z)</p><p>-c<br>commands : æ‰§è¡Œå‘½ä»¤ï¼Œå¸¦å‚æ•° (bash , ksh , python)<br>create : åˆ›å»º (tar)</p><p>-f<br>force : å¼ºåˆ¶ï¼Œä¸ç»ç¡®è®¤(cp , rm ,mv)<br>file : æ–‡ä»¶ï¼Œå¸¦å‚æ•° (tar)</p><p>-h<br>â€“help : å¸®åŠ©<br>human readable : äººæ€§åŒ–æ˜¾ç¤º(ls , du , df)<br>headers : å¤´éƒ¨</p><p>-i<br>interactive : äº¤äº’æ¨¡å¼ï¼Œæç¤º(rm , mv)<br>include : åŒ…å«</p><p>-k<br>keep : ä¿ç•™</p><p>-l<br>long listing format : é•¿æ ¼å¼(ls)<br>list : åˆ—è¡¨<br>load : è¯»å– (gcc , emacs)</p><p>-m<br>message : æ¶ˆæ¯ (cvs)<br>manual : æ‰‹å†Œ (whereis)<br>create home : åˆ›å»º home ç›®å½• (usermod , useradd)</p><p>-n<br>number : è¡Œå·ã€ç¼–å· (cat , head , tail , pstree , lspci)<br>no : (useradd , make)</p><p>-p<br>parents éœ€è¦æ—¶åˆ›å»ºä¸Šå±‚ç›®å½•ï¼Œå¦‚ç›®å½•æ—©å·²å­˜åœ¨åˆ™ä¸å½“ä½œé”™è¯¯</p><p>-q<br>quiet : é™é»˜</p><p>-r<br>reverse : åè½¬<br>recursive : é€’å½’ (cp , rm , chmod -R)</p><p>-u<br>user : ç”¨æˆ·åã€UIDï¼Œå¸¦å‚æ•°</p><p>-v<br>verbose : å†—é•¿<br>version : ç‰ˆæœ¬</p><p>-x<br>exclude : æ’é™¤ (tar , zip)</p><p>-y<br>yes</p><p>-z<br>zip : å¯ç”¨å‹ç¼© (bzip , tar , zcat , zip , cvs)</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2022/08/10/git/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2022/08/10/git/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="gitå¸¸ç”¨å‘½ä»¤"><a href="#gitå¸¸ç”¨å‘½ä»¤" class="headerlink" title="gitå¸¸ç”¨å‘½ä»¤"></a>gitå¸¸ç”¨å‘½ä»¤</h2><h4 id="æœ¬åœ°ä»“åº“æ“ä½œ"><a href="#æœ¬åœ°ä»“åº“æ“ä½œ" class="headerlink" title="æœ¬åœ°ä»“åº“æ“ä½œ"></a>æœ¬åœ°ä»“åº“æ“ä½œ</h4><p>è®¾ç½®ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.name</span> <span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.email</span> <span class="hljs-string">&quot;é‚®ç®±&quot;</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹é…ç½®ä¿¡æ¯</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">git <span class="hljs-built_in">config</span> <span class="hljs-comment">--list</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºgitæœ¬åœ°ä»“åº“</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">git <span class="hljs-keyword">init</span><br></code></pre></td></tr></table></figure><p>è·å–gitè¿œç¨‹ä»“åº“</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">ä»“åº“åœ°å€</span><br></code></pre></td></tr></table></figure><p>å°†æ–‡ä»¶å­˜å…¥æš‚å­˜åŒº</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-built_in">add</span> *æˆ–è€…æ–‡ä»¶å<br></code></pre></td></tr></table></figure><p>å°†æ–‡ä»¶å–æ¶ˆæš‚å­˜ &#x2F; åˆ‡æ¢ç‰ˆæœ¬</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">reset</span> *æˆ–è€…æ–‡ä»¶å<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git status</span> <br></code></pre></td></tr></table></figure><p>æäº¤åˆ°ç‰ˆæœ¬åº“</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> commit -m <span class="hljs-string">&quot;å¤‡æ³¨&quot;</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å¿—</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">git <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><h4 id="è¿œç¨‹ä»“åº“æ“ä½œ"><a href="#è¿œç¨‹ä»“åº“æ“ä½œ" class="headerlink" title="è¿œç¨‹ä»“åº“æ“ä½œ"></a>è¿œç¨‹ä»“åº“æ“ä½œ</h4><p>æŸ¥çœ‹è¿œç¨‹ä»“åº“</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git remote -v</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ è¿œç¨‹ä»“åº“</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git remote <span class="hljs-keyword">add </span><span class="hljs-keyword">origin </span>ä»“åº“åœ°å€<br></code></pre></td></tr></table></figure><p>æ‹‰å–è¿œç¨‹ä»“åº“</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git pull <span class="hljs-built_in">origin</span> è¿œç¨‹åˆ†æ”¯å<br></code></pre></td></tr></table></figure><p>æ¨é€åˆ°è¿œç¨‹ä»“åº“</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> è¿œç¨‹åˆ†æ”¯å<br></code></pre></td></tr></table></figure><h4 id="åˆ†æ”¯æ“ä½œ"><a href="#åˆ†æ”¯æ“ä½œ" class="headerlink" title="åˆ†æ”¯æ“ä½œ"></a>åˆ†æ”¯æ“ä½œ</h4><p>æŸ¥çœ‹åˆ†æ”¯</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git branch</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºåˆ†æ”¯</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">branch </span>åˆ†æ”¯å<br></code></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ†æ”¯</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> checkout åˆ†æ”¯å<br></code></pre></td></tr></table></figure><p>æ¨é€åˆ°è¿œç¨‹ä»“åº“</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> åˆ†æ”¯å<br></code></pre></td></tr></table></figure><p>åˆå¹¶åˆ†æ”¯</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cos">git <span class="hljs-keyword">merge</span> åˆ†æ”¯å<br></code></pre></td></tr></table></figure><h4 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h4><p>åˆ—å‡ºå·²æœ‰çš„æ ‡ç­¾</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ ‡ç­¾</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">æ ‡ç­¾å</span><br></code></pre></td></tr></table></figure><p>å°†æ ‡ç­¾æ¨é€è‡³è¿œç¨‹ä»“åº“</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> æ ‡ç­¾å<br></code></pre></td></tr></table></figure><p>å–å‡ºåˆ›å»ºè¿™ä¸ªæ ‡ç­¾æ—¶çš„ä»£ç </p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">git</span> checkout -<span class="hljs-keyword">b</span> æ–°çš„åˆ†æ”¯å æ ‡ç­¾å<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨SpringBootä¸­ä½¿ç”¨è¿‡æ»¤å™¨</title>
    <link href="/2022/08/09/spring/springboot/%E5%9C%A8SpringBoot%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
    <url>/2022/08/09/spring/springboot/%E5%9C%A8SpringBoot%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="åœ¨SpringBootä¸­ä½¿ç”¨è¿‡æ»¤å™¨"><a href="#åœ¨SpringBootä¸­ä½¿ç”¨è¿‡æ»¤å™¨" class="headerlink" title="åœ¨SpringBootä¸­ä½¿ç”¨è¿‡æ»¤å™¨"></a>åœ¨SpringBootä¸­ä½¿ç”¨è¿‡æ»¤å™¨</h2><h4 id="1-å®ç°Filteræ¥å£"><a href="#1-å®ç°Filteræ¥å£" class="headerlink" title="1.å®ç°Filteræ¥å£"></a>1.å®ç°<code>Filter</code>æ¥å£</h4><p>å¯ä»¥é‡å†™Filterä¸­çš„ä¸‰ä¸ªæ–¹æ³•</p><table><thead><tr><th>name</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>init(FilterConfig)</td><td>åˆ›å»ºfilteræ—¶ä¼šè°ƒç”¨ä¸€æ¬¡</td></tr><tr><td>doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</td><td>æ‹¦æˆªå®¢æˆ·ç«¯è¯·æ±‚æ—¶è°ƒç”¨</td></tr><tr><td>destroy()</td><td>é”€æ¯filteræ—¶ä¼šè°ƒç”¨ä¸€æ¬¡</td></tr></tbody></table><h4 id="2-æ³¨å†Œæ‹¦æˆªå™¨"><a href="#2-æ³¨å†Œæ‹¦æˆªå™¨" class="headerlink" title="2.æ³¨å†Œæ‹¦æˆªå™¨"></a>2.æ³¨å†Œæ‹¦æˆªå™¨</h4><p>æ–¹å¼1: æ³¨è§£æ³¨å†Œ</p><p>é€šè¿‡<code>@WebFilter(filterName, urlPatterns)</code>æ³¨è§£æ¥è¯´æ˜è¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>filterName</td><td>è¿‡æ»¤å™¨åå­—</td></tr><tr><td>urlPatterns</td><td>æ‹¦æˆªçš„è·¯å¾„</td></tr></tbody></table><p>ç„¶ååœ¨ä¸»å¯åŠ¨ç±»ä¸Šä½¿ç”¨<code>@ServletComponentScan</code>æ³¨è§£å¼€å¯æ‰«æ</p><p>åŠ ä¸Šè¿™ä¸ªæ³¨è§£å¯ä»¥æ‰«æ<code>@Servlet</code>ã€<code>@Filter</code>ã€<code>@Listener</code></p><p>æ–¹å¼2: é…ç½®ç±»æ–¹å¼æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Filter1 filter;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title function_">filter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//é€šè¿‡FilterRegistrationBeanæ³¨å…¥Bean</span><br>        <span class="hljs-type">FilterRegistrationBean</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterRegistrationBean</span>();<br>        <span class="hljs-comment">//è®¾ç½®è¿‡æ»¤å™¨</span><br>        registration.setFilter(filter);<br>        <span class="hljs-comment">//è®¾ç½®è¿‡æ»¤å™¨åå’Œæ‹¦æˆªè·¯å¾„</span><br>        registration.setName(<span class="hljs-string">&quot;filter&quot;</span>);<br>        registration.addUrlPatterns(<span class="hljs-string">&quot;/*&quot;</span>);<br>        <span class="hljs-comment">//è®¾ç½®ä¼˜å…ˆçº§åˆ«</span><br>        registration.setOrder(<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> registration;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginCheckFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-comment">//è·¯å¾„åŒ¹é…å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AntPathMatcher</span> <span class="hljs-variable">PATH_MATCHER</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AntPathMatcher</span>();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (HttpServletRequest) servletRequest;<br>        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> (HttpServletResponse) servletResponse;<br><br>        <span class="hljs-comment">//è·å–è¯·æ±‚çš„uri</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br><br>        <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦å¤„ç†</span><br>        String[] urls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<br>                <span class="hljs-comment">//ä¸éœ€è¦å¤„ç†çš„è·¯å¾„</span><br>                <span class="hljs-string">&quot;/employee/login&quot;</span>,<br>                <span class="hljs-string">&quot;/employee/logout&quot;</span>,<br>                <span class="hljs-string">&quot;/backend/**&quot;</span>,<br>                <span class="hljs-string">&quot;/front/**&quot;</span>,<br>                <span class="hljs-string">&quot;/common/**&quot;</span><br>        &#125;;<br>        <span class="hljs-keyword">if</span> (check(urls, requestURI)) &#123;<br>            <span class="hljs-comment">//ä¸ç”¨å¤„ç†, æ”¾è¡Œ</span><br>            filterChain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//ç½‘é¡µç«¯éªŒè¯æœ‰æ²¡æœ‰ç™»å½•</span><br>            <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (Long) request.getSession().getAttribute(<span class="hljs-string">&quot;employee&quot;</span>);<br>            BaseContext.setCurrentId(id);<br>            <span class="hljs-comment">//å·²ç™»å½•, æ”¾è¡Œ</span><br>            filterChain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//æœªç™»å½•, æ‹¦æˆª</span><br>            response.getWriter().write(JSON.toJSONString(R.error(<span class="hljs-string">&quot;NOTLOGIN&quot;</span>)));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŒ¹é…è¯·æ±‚è·¯å¾„æ˜¯å¦ä¸éœ€è¦å¤„ç†</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> urls</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestURI</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(String[] urls, String requestURI)</span> &#123;<br>        <span class="hljs-keyword">for</span> (String url : urls) &#123;<br>            <span class="hljs-keyword">if</span> (PATH_MATCHER.match(url, requestURI)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
      <category>springBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MPå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</title>
    <link href="/2022/08/08/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85/"/>
    <url>/2022/08/08/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mybatis-plus/MP%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85/</url>
    
    <content type="html"><![CDATA[<h2 id="MPå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"><a href="#MPå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……" class="headerlink" title="MPå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……"></a>MPå…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……</h2><ol><li>åœ¨éœ€è¦è‡ªåŠ¨å¡«å……çš„å­—æ®µä¸Šæ·»åŠ <code>@TableField(fill)</code>æ³¨è§£</li></ol><p>å‚æ•°:</p><p>fill</p><table><thead><tr><th>å¯å¡«å…¥çš„å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>FieldFill.INSERT</td><td>æ’å…¥è¡¨æ—¶å¡«å……</td></tr><tr><td>FieldFill.UPDATE</td><td>æ›´æ–°æ—¶å¡«å……</td></tr><tr><td>FieldFill.INSERT_UPDATE</td><td>æ›´æ–°å’Œæ’å…¥è¡¨æ—¶å¡«å……</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><span class="hljs-comment">//æ’å…¥è¡¨æ—¶æ—¶å¡«å……</span><br><span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><span class="hljs-comment">//æ›´æ–°å’Œæ’å…¥è¡¨æ—¶å¡«å……</span><br><span class="hljs-keyword">private</span> LocalDateTime updateTime;<br><br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><span class="hljs-comment">//æ’å…¥è¡¨æ—¶æ—¶å¡«å……</span><br><span class="hljs-keyword">private</span> Long createUser;<br><br><br><span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><span class="hljs-comment">//æ›´æ–°å’Œæ’å…¥è¡¨æ—¶å¡«å……</span><br><span class="hljs-keyword">private</span> Long updateUser;<br></code></pre></td></tr></table></figure><ol start="2"><li>å®ç°<code>MetaObjectHandler</code>æ¥å£ï¼Œ é‡å†™<code>insertFill()</code>å’Œ<code>updateFill()</code>æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-comment">//æ’å…¥æ—¶å¡«å……çš„å­—æ®µååŠå¡«å……çš„å€¼</span><br>        metaObject.setValue(<span class="hljs-string">&quot;createTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;createUser&quot;</span>, BaseContext.getCurrentId());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-comment">//æ›´æ–°æ—¶å¡«å……çš„å­—æ®µååŠå¡«å……çš„å€¼</span><br>        metaObject.setValue(<span class="hljs-string">&quot;updateTime&quot;</span>, LocalDateTime.now());<br>        metaObject.setValue(<span class="hljs-string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>æ•°æ®åº“</category>
      
      <category>mysql</category>
      
      <category>mybatis-plus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>7.v-ifå’Œv-showåŒºåˆ«</title>
    <link href="/2022/08/05/%E5%89%8D%E7%AB%AF/vue/7.v-if%E5%92%8Cv-show%E5%8C%BA%E5%88%AB/"/>
    <url>/2022/08/05/%E5%89%8D%E7%AB%AF/vue/7.v-if%E5%92%8Cv-show%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h2 id="7-v-ifå’Œv-showåŒºåˆ«"><a href="#7-v-ifå’Œv-showåŒºåˆ«" class="headerlink" title="7.v-ifå’Œv-showåŒºåˆ«"></a>7.v-ifå’Œv-showåŒºåˆ«</h2><p><code>v-if</code>åªæœ‰æ¡ä»¶ä¸ºçœŸæ—¶æ‰æ¸²æŸ“åˆ°domä¸Š,æ¡ä»¶ä¸ºå‡æ—¶ä»DOMä¸­é”€æ¯</p><p><code>v-for</code>æ˜¯ä¸€æ¬¡æ€§å…¨éƒ½è®°è½½åˆ°DOMä¸­,é€šè¿‡<code>display</code>æ¥æ§åˆ¶æ˜¯å¦å±•ç¤ºå…ƒç´ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&#x27;ok&#x27;</span>&gt;</span>aaa<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">&#x27;!ok&#x27;</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ok&#x3D;trueæ—¶</p><p><img src="/img/post_img/SLK%25HS%5DU1$G4N8Z3NDIE3H7.png"></p><p>ok&#x3D;falseæ—¶</p><p><img src="/img/post_img/20220805164227.png"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6.Vueç»‘å®šæ ·å¼</title>
    <link href="/2022/08/03/%E5%89%8D%E7%AB%AF/vue/6.Vue%E7%BB%91%E5%AE%9A%E6%A0%B7%E5%BC%8F/"/>
    <url>/2022/08/03/%E5%89%8D%E7%AB%AF/vue/6.Vue%E7%BB%91%E5%AE%9A%E6%A0%B7%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="6-Vueç»‘å®šæ ·å¼"><a href="#6-Vueç»‘å®šæ ·å¼" class="headerlink" title="6.Vueç»‘å®šæ ·å¼"></a>6.Vueç»‘å®šæ ·å¼</h2><h3 id="ç»‘å®šclass"><a href="#ç»‘å®šclass" class="headerlink" title="ç»‘å®šclass"></a>ç»‘å®šclass</h3><p>é€šè¿‡<code>v-bind:class</code>æ¥ç»‘å®šclass</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.active</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">color</span>: red;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span> <span class="hljs-attr">v-bind:class</span>=<span class="hljs-string">&#x27;&#123;active: isActive&#125;&#x27;</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">isActive</span>: <span class="hljs-literal">true</span><span class="hljs-comment">//å½“isActiveä¸ºtrueæ—¶activeç”Ÿæ•ˆ</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç»‘å®šcss"><a href="#ç»‘å®šcss" class="headerlink" title="ç»‘å®šcss"></a>ç»‘å®šcss</h3><p>é€šè¿‡<code>v-bind:style</code>æ¥ç»‘å®šcss</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span> <span class="hljs-attr">v-bind:style</span>=<span class="hljs-string">&#x27;styleObject&#x27;</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">styleObject</span>: &#123;<span class="hljs-comment">//é€šè¿‡å£°æ˜æ•°æ®å¯¹è±¡æ¥ç»‘å®šcss</span></span><br><span class="language-javascript">                <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&#x27;20px&#x27;</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>:  </p><ol><li>åŸæ¥çš„<code>class</code>&#x2F;<code>style</code>ä¸ä¼šè¢«è¦†ç›–æ‰</li><li>å¯ä»¥ç”¨<code>[&#123;...&#125;. &#123;...&#125;, ...]</code>æ¥ç»‘å®šå¤šä¸ª</li><li>ä¹Ÿå¯ä»¥å£°æ˜æ•°æ®å¯¹è±¡æ¥ç»‘å®šå¤šä¸ª</li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5.Vueè®¡ç®—å±æ€§å’Œç›‘å¬å™¨</title>
    <link href="/2022/08/02/%E5%89%8D%E7%AB%AF/vue/5.Vue%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/"/>
    <url>/2022/08/02/%E5%89%8D%E7%AB%AF/vue/5.Vue%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="5-Vueè®¡ç®—å±æ€§å’Œç›‘å¬å™¨"><a href="#5-Vueè®¡ç®—å±æ€§å’Œç›‘å¬å™¨" class="headerlink" title="5.Vueè®¡ç®—å±æ€§å’Œç›‘å¬å™¨"></a>5.Vueè®¡ç®—å±æ€§å’Œç›‘å¬å™¨</h2><h4 id="è®¡ç®—å±æ€§"><a href="#è®¡ç®—å±æ€§" class="headerlink" title="è®¡ç®—å±æ€§"></a>è®¡ç®—å±æ€§</h4><p>ç”¨<code>computed</code>æ¥å®šä¹‰è®¡ç®—å±æ€§</p><p>ä½œç”¨: è°ƒç”¨è®¡ç®—å±æ€§æ—¶ä¼šæ˜¾ç¤ºreturnçš„å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;print&#125;&#125;<span class="hljs-comment">&lt;!-- Hello World --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello&#x27;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">print</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">&quot; World&quot;</span>;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨è®¡ç®—å±æ€§ä¸­å®šä¹‰getå’Œsetï¼Œå½“ç»™è®¡ç®—å±æ€§èµ‹å€¼æ—¶ä¼šè°ƒç”¨setï¼Œä½¿ç”¨è®¡ç®—å±æ€§åˆ™ä¼šè°ƒç”¨get</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;print&#125;&#125;<span class="hljs-comment">&lt;!-- Hi World --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello&#x27;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">print</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">&quot; World&quot;</span>;</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">newMsg</span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = newMsg;</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">print</span> = <span class="hljs-string">&quot;Hi&quot;</span>;<span class="hljs-comment">//è°ƒç”¨äº†set</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>: ä¸åŒäº<code>methods</code>, è®¡ç®—å±æ€§æ˜¯æœ‰ç¼“å­˜çš„ï¼Œåªæœ‰å€¼æ”¹å˜æ—¶æ‰ä¼šé‡æ–°è®¡ç®—</p><h4 id="ä¾¦å¬å™¨"><a href="#ä¾¦å¬å™¨" class="headerlink" title="ä¾¦å¬å™¨"></a>ä¾¦å¬å™¨</h4><p>ç”¨<code>watch</code>æ¥å®šä¹‰ä¾¦å¬å™¨</p><p>ä½œç”¨: å½“å€¼å‘ç”Ÿæ”¹å˜æ—¶ä¼šè°ƒç”¨ä¾¦å¬å™¨çš„æ–¹æ³•</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello&#x27;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(oldVal + <span class="hljs-string">&quot;--&gt;&quot;</span> + newVal);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-string">&quot;Hi&quot;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4.Vueé’©å­å‡½æ•°</title>
    <link href="/2022/07/30/%E5%89%8D%E7%AB%AF/vue/4.Vue%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0/"/>
    <url>/2022/07/30/%E5%89%8D%E7%AB%AF/vue/4.Vue%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="4-Vueé’©å­å‡½æ•°"><a href="#4-Vueé’©å­å‡½æ•°" class="headerlink" title="4.Vueé’©å­å‡½æ•°"></a>4.Vueé’©å­å‡½æ•°</h2><p>Vueå¯¹è±¡åˆå§‹åŒ–è¿‡ç¨‹è°ƒç”¨çš„å‡½æ•°ç§°ä¸º<strong>é’©å­å‡½æ•°</strong>;</p><p>ä¸åº”è¯¥ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥å®šä¹‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•;</p><p>é’©å­å‡½æ•°è°ƒç”¨çš„æ—¶æœº:</p><ol><li><p>new Vue()</p></li><li><p><font color='green'>beforeCreate     (æ•°æ®ä¾¦å¬å’Œäº‹ä»¶&#x2F;ä¾¦å¬å™¨çš„é…ç½®ä¹‹å‰)</font></p></li><li><p><font color='green'>created               (æ•°æ®ä¾¦å¬å’Œäº‹ä»¶&#x2F;ä¾¦å¬å™¨çš„é…ç½®ä¹‹å)</font></p></li><li><p><font color='blue'>beforeMount     (æ•°æ®æŒ‚è½½å‰)</font></p></li><li><p><font color='blue'>mounted            (æ•°æ®æŒ‚è½½å, è§†å›¾çš„æ•°æ®è¢«Vueçš„æ›¿æ¢)</font></p></li><li><p><font color='purple'>beforeUpdate   (æ•°æ®æ”¹å˜,åŠ è½½åˆ°è§†å›¾å‰)</font></p></li><li><p><font color='purple'>updated             (åŠ è½½åˆ°è§†å›¾å)</font></p></li><li><p><font color='red'>beforeDestroy  (è°ƒç”¨vm.$destroy()å,Vueå¯¹è±¡é”€æ¯å‰)</font></p></li><li><p><font color='red'>destroy               (Vueå¯¹è±¡é”€æ¯å)</font></p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>        &#123;&#123; message &#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;a&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">beforeCreate</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeCreate&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">created</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;created&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-attr">beforeMount</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeMount&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">mounted</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;mounted&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-attr">beforeUpdate</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeUpdate&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">updated</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;updated&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-attr">activated</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;activated&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">deactivated</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;deactivated&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-attr">beforeDestroy</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeDestroy&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">destroyed</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;destroyed&#x27;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-attr">errorCaptured</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;errorCaptured&#x27;</span>);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-string">&#x27;b&#x27;</span>;</span><br><span class="language-javascript">    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-string">&#x27;vm.$destroy()&#x27;</span>, <span class="hljs-number">2000</span>);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒ<a href="https://cn.vuejs.org/v2/api/#%E9%80%89%E9%A1%B9-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90">API â€” Vue.js (vuejs.org)</a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3.Vueæ•°æ®å’Œæ–¹æ³•</title>
    <link href="/2022/07/30/%E5%89%8D%E7%AB%AF/vue/3.Vue%E6%95%B0%E6%8D%AE%E5%92%8C%E6%96%B9%E6%B3%95/"/>
    <url>/2022/07/30/%E5%89%8D%E7%AB%AF/vue/3.Vue%E6%95%B0%E6%8D%AE%E5%92%8C%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="3-Vueæ•°æ®å’Œæ–¹æ³•"><a href="#3-Vueæ•°æ®å’Œæ–¹æ³•" class="headerlink" title="3.Vueæ•°æ®å’Œæ–¹æ³•"></a>3.Vueæ•°æ®å’Œæ–¹æ³•</h2><h4 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h4><h5 id="å“åº”å¼"><a href="#å“åº”å¼" class="headerlink" title="å“åº”å¼"></a>å“åº”å¼</h5><p><strong>å“åº”å¼</strong>: dataä¸­çš„propertyæ”¹å˜æ—¶ï¼Œè§†å›¾ä¹Ÿä¼šæ›´æ–°ä¸ºæ–°çš„å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;// 1 ---&gt; 2<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> data = &#123;<span class="hljs-attr">message</span>: <span class="hljs-number">1</span>&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: data</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-number">2</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Object.freeze()</code>å¯ä»¥ä½¿propertyå˜ä¸º<strong>éå“åº”å¼</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;// ä»ç„¶ä¸º1<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> data = &#123;<span class="hljs-attr">message</span>: <span class="hljs-number">1</span>&#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(data);</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: data</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-number">2</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>v-once</code>æ¥ä¸€æ¬¡æ€§æ’å€¼,ä¹‹åå°±ä¸ä¼šæ›´æ–°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span> <span class="hljs-attr">v-once</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;// ä»ç„¶ä¸º1<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> data = &#123;<span class="hljs-attr">message</span>: <span class="hljs-number">1</span>&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: data</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-number">2</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="å±•ç¤ºåŸå§‹html"><a href="#å±•ç¤ºåŸå§‹html" class="headerlink" title="å±•ç¤ºåŸå§‹html"></a>å±•ç¤ºåŸå§‹html</h5><p>ç”¨æ’å€¼è¡¨è¾¾å¼çš„è¯ä¼šæŒ‰å­—ç¬¦ä¸²è¾“å‡ºï¼Œä½¿ç”¨<code>v-html</code>å¯ä»¥å±•ç¤ºåŸå§‹html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&#x27;message&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;&lt;font color=&quot;red&quot;&gt;a&lt;/font&gt;&#x27;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="åœ¨æ’å€¼è¡¨è¾¾å¼é‡Œä½¿ç”¨js"><a href="#åœ¨æ’å€¼è¡¨è¾¾å¼é‡Œä½¿ç”¨js" class="headerlink" title="åœ¨æ’å€¼è¡¨è¾¾å¼é‡Œä½¿ç”¨js"></a>åœ¨æ’å€¼è¡¨è¾¾å¼é‡Œä½¿ç”¨js</h5><p><code>&#123;&#123;&#125;&#125;</code>é‡Œé¢è¿˜å¯ä»¥ä½¿ç”¨å•ä¸ªjsçš„è¡¨è¾¾å¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;message + 10&#125;&#125;//11<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="ç¼©å†™"><a href="#ç¼©å†™" class="headerlink" title="ç¼©å†™"></a>ç¼©å†™</h5><p><code>v-bind:...</code> å¯ä»¥ç¼©å†™ä¸º<code>:...</code></p><p><code>v-on:...</code>å¯ä»¥ç¼©å†™ä¸º<code>@...</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&#x27;class1&#x27;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&#x27;click1&#x27;</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;aaa&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">class1</span>: <span class="hljs-string">&#x27;class1&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            click1 : <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;è¢«ç‚¹å‡»äº†&quot;</span>);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>å‰ç¼€å¸¦<code>$</code>çš„ä¸ºVueæä¾›çš„æ–¹æ³•</p><p>å¦‚:</p><p>$watch(prop, function), å½“propå€¼æ”¹å˜æ—¶è°ƒç”¨function</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span><br>        &#123;&#123;message&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    vm.$watch(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;oldVal:&#x27;</span> + oldVal + <span class="hljs-string">&#x27;, newVal:&#x27;</span> + newVal);</span><br><span class="language-javascript">    &#125;) </span><br><span class="language-javascript"></span><br><span class="language-javascript">    vm.<span class="hljs-property">message</span> = <span class="hljs-number">2</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒ<a href="https://cn.vuejs.org/v2/api/#%E5%AE%9E%E4%BE%8B-property">API â€” Vue.js (vuejs.org)</a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2.Vueå…¥é—¨</title>
    <link href="/2022/07/29/%E5%89%8D%E7%AB%AF/vue/2.Vue%E5%85%A5%E9%97%A8/"/>
    <url>/2022/07/29/%E5%89%8D%E7%AB%AF/vue/2.Vue%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="2-Vueå…¥é—¨"><a href="#2-Vueå…¥é—¨" class="headerlink" title="2.Vueå…¥é—¨"></a>2.Vueå…¥é—¨</h2><h4 id="å£°æ˜å¼æ¸²æŸ“"><a href="#å£°æ˜å¼æ¸²æŸ“" class="headerlink" title="å£°æ˜å¼æ¸²æŸ“"></a>å£°æ˜å¼æ¸²æŸ“</h4><p><code>&#123;&#123;...&#125;&#125;</code>  :  æ–‡æœ¬æ’å…¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&#x27;app&#x27;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello Vue&#x27;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ•°æ®å’Œ DOM å·²ç»è¢«å»ºç«‹äº†å…³è”ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯<strong>å“åº”å¼çš„</strong>ã€‚</p><h4 id="æŒ‡ä»¤"><a href="#æŒ‡ä»¤" class="headerlink" title="æŒ‡ä»¤"></a>æŒ‡ä»¤</h4><p>æŒ‡ä»¤å¸¦æœ‰å‰ç¼€ <code>v-</code>ï¼Œä»¥è¡¨ç¤ºå®ƒä»¬æ˜¯ Vue æä¾›çš„ç‰¹æ®Š Attribute</p><h5 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="ç»‘å®š"></a>ç»‘å®š</h5><p>v-bind:title : å°†å…ƒç´ çš„ <code>title</code> å’Œ Vue å®ä¾‹çš„ <code>message</code> ç»‘å®šèµ·æ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app2&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-bind:title</span>=<span class="hljs-string">&#x27;message&#x27;</span>&gt;</span>åŠ¨æ€ç»‘å®šçš„ä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript"><span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app2&#x27;</span>,</span><br><span class="language-javascript"><span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript"><span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;é¡µé¢åŠ è½½ä¸&#x27;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>()</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h5><p>v-if : æ¡ä»¶æ§åˆ¶,å½“Vue å®ä¾‹çš„seenä¸ºtrueæ—¶æ˜¾ç¤ºå…ƒç´ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app3&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;seen&quot;</span>&gt;</span>aaaaaaa<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app3&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">seen</span>: <span class="hljs-literal">true</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h5><p>v-for : éå†Vueä¸­ç»‘å®šçš„æ•°ç»„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app4&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;todo in todos&quot;</span>&gt;</span><br>                &#123;&#123; todo.text &#125;&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app4&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">todos</span>: [</span><br><span class="language-javascript">                &#123; <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;a&#x27;</span> &#125;,</span><br><span class="language-javascript">                &#123; <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;b&#x27;</span> &#125;,</span><br><span class="language-javascript">                &#123; <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;c&#x27;</span> &#125;</span><br><span class="language-javascript">            ]</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="äº‹ä»¶ç›‘å¬"><a href="#äº‹ä»¶ç›‘å¬" class="headerlink" title="äº‹ä»¶ç›‘å¬"></a>äº‹ä»¶ç›‘å¬</h5><p>v-onæ·»åŠ äº‹ä»¶ç›‘å¬å™¨</p><p>v-on:click : æ·»åŠ å•å‡»äº‹ä»¶ç›‘å¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app5&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">&quot;reverseMessage&quot;</span>&gt;</span>åè½¬æ¶ˆæ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app5&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello Vue&#x27;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">reverseMessage</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>v-model : å°†è¾“å…¥æ¡†å’ŒVueä¸­å®ä¾‹ç»‘å®šèµ·æ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app6&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app6&#x27;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Hello&#x27;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1.Vueä¸‹è½½</title>
    <link href="/2022/07/29/%E5%89%8D%E7%AB%AF/vue/1.Vue%E4%B8%8B%E8%BD%BD/"/>
    <url>/2022/07/29/%E5%89%8D%E7%AB%AF/vue/1.Vue%E4%B8%8B%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<h2 id="1-Vueä¸‹è½½"><a href="#1-Vueä¸‹è½½" class="headerlink" title="1.Vueä¸‹è½½"></a>1.Vueä¸‹è½½</h2><h3 id="é€šè¿‡js"><a href="#é€šè¿‡js" class="headerlink" title="é€šè¿‡js"></a>é€šè¿‡js</h3><p>vueæ•™ç¨‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cn.vuejs.org<span class="hljs-regexp">/v2/gui</span>de/<br></code></pre></td></tr></table></figure><p>vueä¸‹è½½é“¾æ¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cn.vuejs.org<span class="hljs-regexp">/js/</span>vue.js<br></code></pre></td></tr></table></figure><p>å¯¼å…¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="é€šè¿‡npm"><a href="#é€šè¿‡npm" class="headerlink" title="é€šè¿‡npm"></a>é€šè¿‡npm</h3><ul><li><p>npmå®‰è£…vueè„šæ‰‹æ¶</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> install -g @vue/cli<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé¡¹ç›®</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">vue ui</span><br></code></pre></td></tr></table></figure></li><li><p>ä¹‹åä¼šè¿›å…¥uiç•Œé¢è¿›è¡Œåˆ›å»ºé¡¹ç›®</p><p><img src="/img/post_img/npm%E5%88%9B%E5%BB%BAVue%E9%A1%B9%E7%9B%AE1.png"></p><p><img src="/img/post_img/npm%E5%88%9B%E5%BB%BAVue%E9%A1%B9%E7%9B%AE2.png"></p><p><img src="/img/post_img/npm%E5%88%9B%E5%BB%BAVue%E9%A1%B9%E7%9B%AE3.png"></p></li><li><p>ä¹‹åå°±ä¼šè‡ªå·±åˆ›å»ºäº†ï¼Œå¦‚æœæŠ¥é”™è¯•è¯•ç®¡ç†å‘˜æ‰“å¼€cmdæ¥åˆ›å»º</p></li><li><p><a href="https://devtools.vuejs.org/guide/installation.html">å®‰è£…</a>å¼€å‘è€…å·¥å…·</p></li></ul><p><strong>è¿è¡Œé¡¹ç›®</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-built_in">run</span> serve<br></code></pre></td></tr></table></figure><p><strong>ä¿®æ”¹ç«¯å£å’Œæ·»åŠ ä»£ç†</strong></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://webpack.js.org/configuration/dev-server/#devserverport">DevServer | webpack</a></p><ul><li><p>åœ¨vue.config.jsä¸­ä¿®æ”¹é…ç½®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/cli-service&#x27;</span>)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-comment">// é…ç½®ç«¯å£</span><br>    <span class="hljs-attr">port</span>: <span class="hljs-number">7070</span>,<br>    <span class="hljs-comment">// æ·»åŠ ä»£ç†</span><br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:8080&#x27;</span>,<br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beançš„ä¾èµ–å±æ€§é…ç½®ç®¡ç†</title>
    <link href="/2022/07/26/spring/bean%E7%9A%84%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/"/>
    <url>/2022/07/26/spring/bean%E7%9A%84%E4%BE%9D%E8%B5%96%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="beançš„ä¾èµ–å±æ€§é…ç½®ç®¡ç†"><a href="#beançš„ä¾èµ–å±æ€§é…ç½®ç®¡ç†" class="headerlink" title="beançš„ä¾èµ–å±æ€§é…ç½®ç®¡ç†"></a>beançš„ä¾èµ–å±æ€§é…ç½®ç®¡ç†</h2><p>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">zoo:</span><br>  <span class="hljs-attr">cat:</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;zs&quot;</span><br>  <span class="hljs-attr">dog:</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-number">2</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;ls&quot;</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªç±»ï¼Œé€šè¿‡<strong>ConfigurationPropertiesæ³¨è§£</strong>æ¥è¯»å–å’Œå°è£…é…ç½®ä¸­çš„å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;zoo&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZooProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> Cat cat;<br>    <span class="hljs-keyword">private</span> Dog dog;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨éœ€è¦ä½¿ç”¨é…ç½®çš„åœ°æ–¹ä½¿ç”¨<strong>EnableConfigurationPropertiesæ³¨è§£</strong>æ¥æ³¨å…¥é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableConfigurationProperties(ZooProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSpringboot23BeanPropApplication</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ZooProperties zooProperties;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨éœ€è¦ä½¿ç”¨å±æ€§ç±»çš„ä½ç½®é€šè¿‡æ³¨è§£<strong>EnableConfigurationPropertiesæ³¨è§£</strong>åŠ è½½beanï¼Œè€Œä¸è¦ç›´æ¥åœ¨å±æ€§é…ç½®ç±»ä¸Šå®šä¹‰beanï¼Œ<strong>å‡å°‘èµ„æºåŠ è½½çš„æ•°é‡</strong>ï¼Œå› éœ€åŠ è½½è€Œä¸è¦é¥±å’Œå¼åŠ è½½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beançš„åŠ è½½æ§åˆ¶</title>
    <link href="/2022/07/24/spring/Bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%8E%A7%E5%88%B6/"/>
    <url>/2022/07/24/spring/Bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%8E%A7%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="beançš„åŠ è½½æ§åˆ¶"><a href="#beançš„åŠ è½½æ§åˆ¶" class="headerlink" title="beançš„åŠ è½½æ§åˆ¶"></a>beançš„åŠ è½½æ§åˆ¶</h2><p><strong>springboot</strong>æä¾›äº†å‡ ä¸ªæ³¨è§£ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶æ‰åŠ è½½ç›¸åº”çš„bean</p><h4 id="ConditionalOnClass-x2F-ConditionalOnMissingClass"><a href="#ConditionalOnClass-x2F-ConditionalOnMissingClass" class="headerlink" title="@ConditionalOnClass &#x2F; @ConditionalOnMissingClass"></a>@ConditionalOnClass &#x2F; @ConditionalOnMissingClass</h4><p>å½“è™šæ‹Ÿæœºä¸­æœ‰æŒ‡å®šç±»æ—¶åŠ è½½bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnClass(name = &quot;com.xw.bean.Dog&quot;)</span><br><span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">cat</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“è™šæ‹Ÿæœºä¸­æœ‰æ²¡æœ‰æŒ‡å®šç±»æ—¶åŠ è½½bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingClass(&quot;com.xw.bean.Dog&quot;)</span><br><span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">cat</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ConditionalOnBean-x2F-ConditionalOnMissingBean"><a href="#ConditionalOnBean-x2F-ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnBean &#x2F; @ConditionalOnMissingBean"></a>@ConditionalOnBean &#x2F; @ConditionalOnMissingBean</h4><p>å½“åŠ è½½äº†æŒ‡å®šåç§°çš„beanæ—¶åŠ è½½bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnBean(name = &quot;dog&quot;)</span><br><span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">cat</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æ²¡æœ‰åŠ è½½äº†æŒ‡å®šåç§°çš„beanæ—¶åŠ è½½bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;dog&quot;)</span><br><span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">cat</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç³»åˆ—çš„æ¡ä»¶æ§åˆ¶æ³¨è§£</p><p><img src="/img/post_img/image-20220724133812086.png"></p><h2 id="Beané»˜è®¤æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹"><a href="#Beané»˜è®¤æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹" class="headerlink" title="Beané»˜è®¤æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹"></a>Beané»˜è®¤æ˜¯å•ä¾‹è¿˜æ˜¯å¤šä¾‹</h2><p>åœ¨Springæ¡†æ¶ä¸­ï¼ŒBeané»˜è®¤æ˜¯å•ä¾‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“åº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªåœ°æ–¹éƒ½éœ€è¦è°ƒç”¨æŸä¸ªBeanæ—¶ï¼ŒSpringå®¹å™¨åªä¼šåˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶å…±äº«ä½¿ç”¨è¿™ä¸ªå®ä¾‹ã€‚</p><p>å¦‚æœéœ€è¦å°†Beanè®¾ç½®æˆå¤šä¾‹ï¼Œå¯ä»¥é€šè¿‡åœ¨Beanç±»ä¸Šæ·»åŠ <code>@Scope(&quot;prototype&quot;)</code>æ³¨è§£æ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Scope(&quot;prototype&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoBean</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“å®¹å™¨éœ€è¦åˆ›å»ºè¿™ä¸ªBeanæ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2022/07/23/git/Hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2022/07/23/git/Hexo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h4 id="å¯åŠ¨æœåŠ¡å™¨"><a href="#å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨æœåŠ¡å™¨"></a>å¯åŠ¨æœåŠ¡å™¨</h4><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">hexo <span class="hljs-keyword">server</span> æˆ– hexo s<br></code></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th></th></tr></thead><tbody><tr><td>-p</td><td>post,è‡ªå®šä¹‰ç«¯å£</td></tr><tr><td>-l</td><td>log,å¯åŠ¨æ—¥å¿—</td></tr></tbody></table><p>é»˜è®¤è®¿é—®ç½‘å€<code>http://localhost:4000/</code></p><h4 id="ç”Ÿæˆé™æ€æ–‡ä»¶"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶"></a>ç”Ÿæˆé™æ€æ–‡ä»¶</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">hexo <span class="hljs-keyword">generate</span> æˆ– hexo g<br></code></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th></th></tr></thead><tbody><tr><td>-d</td><td>deploy, ç”Ÿæˆåç«‹å³éƒ¨ç½²åˆ°æœåŠ¡å™¨</td></tr><tr><td>-f</td><td>force,å¼ºåˆ¶é‡æ–°ç”Ÿæˆå…¨éƒ¨æ–‡ä»¶,ä¸åŠ åˆ™åªç”Ÿæˆæ”¹åŠ¨çš„æ–‡ä»¶</td></tr></tbody></table><h4 id="éƒ¨ç½²ç½‘ç«™"><a href="#éƒ¨ç½²ç½‘ç«™" class="headerlink" title="éƒ¨ç½²ç½‘ç«™"></a>éƒ¨ç½²ç½‘ç«™</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">hexo <span class="hljs-keyword">deploy</span> æˆ– hexo d<br></code></pre></td></tr></table></figure><h4 id="æ¸…é™¤ç¼“å­˜"><a href="#æ¸…é™¤ç¼“å­˜" class="headerlink" title="æ¸…é™¤ç¼“å­˜"></a>æ¸…é™¤ç¼“å­˜</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br></code></pre></td></tr></table></figure><p>æ¸…é™¤ç¼“å­˜æ–‡ä»¶ (<code>db.json</code>) å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ (<code>public</code>)ã€‚</p><h4 id="Hexoç‰ˆæœ¬"><a href="#Hexoç‰ˆæœ¬" class="headerlink" title="Hexoç‰ˆæœ¬"></a>Hexoç‰ˆæœ¬</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">hexo <span class="hljs-built_in">version</span> æˆ– hexo -v<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beançš„åŠ è½½æ–¹å¼(2)</title>
    <link href="/2022/07/23/spring/bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F(2)/"/>
    <url>/2022/07/23/spring/bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F(2)/</url>
    
    <content type="html"><![CDATA[<h2 id="beançš„åŠ è½½æ–¹å¼-2"><a href="#beançš„åŠ è½½æ–¹å¼-2" class="headerlink" title="beançš„åŠ è½½æ–¹å¼(2)"></a>beançš„åŠ è½½æ–¹å¼(2)</h2><h4 id="5-å®¹å™¨åˆå§‹åŒ–å®Œæˆåæ‰‹åŠ¨åŠ è½½bean"><a href="#5-å®¹å™¨åˆå§‹åŒ–å®Œæˆåæ‰‹åŠ¨åŠ è½½bean" class="headerlink" title="5.å®¹å™¨åˆå§‹åŒ–å®Œæˆåæ‰‹åŠ¨åŠ è½½bean"></a>5.å®¹å™¨åˆå§‹åŒ–å®Œæˆåæ‰‹åŠ¨åŠ è½½bean</h4><p>é€šè¿‡AnnotationConfigApplicationContextçš„<strong>register</strong>æ–¹æ³•ï¼Œå¯ä»¥åœ¨å®¹å™¨åˆå§‹åŒ–å®Œæˆåæ‰‹åŠ¨åŠ è½½bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App5</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig5.class);<br>        <span class="hljs-comment">//ä¸Šä¸‹æ–‡å®¹å™¨å¯¹è±¡å·²ç»åˆå§‹åŒ–å®Œæ¯•åï¼Œæ‰‹å·¥åŠ è½½bean</span><br>        ctx.register(Cat.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨<strong>registerBean</strong>æ–¹æ³•æŒ‡å®šbeançš„åç§°å’Œå‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App5</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig5.class);<br><br>        <span class="hljs-comment">//å®¹å™¨ä¸­æœ‰åŒåç§°çš„beanæ—¶ä¼šè¦†ç›–ä¹‹å‰çš„</span><br>        app.registerBean(<span class="hljs-string">&quot;tom&quot;</span>, Cat.class, <span class="hljs-number">0</span>);<br>        app.registerBean(<span class="hljs-string">&quot;tom&quot;</span>, Cat.class, <span class="hljs-number">1</span>);<br>        app.registerBean(<span class="hljs-string">&quot;tom&quot;</span>, Cat.class, <span class="hljs-number">2</span>);<br><br>        System.out.println(app.getBean(<span class="hljs-string">&quot;tom&quot;</span>));<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            ç»“æœ</span><br><span class="hljs-comment">            Cat&#123;id=&#x27;2&#x27;&#125;</span><br><span class="hljs-comment">        */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="6-åœ¨å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŠ è½½bean"><a href="#6-åœ¨å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŠ è½½bean" class="headerlink" title="6.åœ¨å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŠ è½½bean"></a>6.åœ¨å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­åŠ è½½bean</h4><h5 id="1-ImportSelectoræ¥å£"><a href="#1-ImportSelectoræ¥å£" class="headerlink" title="(1)ImportSelectoræ¥å£"></a>(1)ImportSelectoræ¥å£</h5><p>å®ç°<strong>ImportSelector</strong>æ¥å£,selectImportsæ–¹æ³•çš„è¿”å›å€¼ä¼šè¢«æ³¨å…¥åˆ°å®¹å™¨ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportSelector</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> importingClassMetadata.hasAnnotation(<span class="hljs-string">&quot;org.springframework.context.annotation.ComponentScan&quot;</span>);<br>        <span class="hljs-keyword">if</span> (flag) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;com.xw.bean.Dog&quot;</span>&#125;;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">0</span>];<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¼å…¥Selectoré…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(&quot;com.xw.bean&quot;)</span><br><span class="hljs-meta">@Import(MySelector.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig6</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App6</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig6.class);<br><br>        String[] names = app.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            ç»“æœ</span><br><span class="hljs-comment">            com.xw.bean.Dog</span><br><span class="hljs-comment">        */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-ImportBeanDefinitionRegistraræ¥å£"><a href="#2-ImportBeanDefinitionRegistraræ¥å£" class="headerlink" title="(2)ImportBeanDefinitionRegistraræ¥å£"></a>(2)ImportBeanDefinitionRegistraræ¥å£</h5><p>beançš„åŠ è½½ä¸æ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„å¯¹è±¡ï¼Œspringä¸­å®šä¹‰äº†ä¸€ä¸ªå«åš<strong>BeanDefinition</strong>çš„ä¸œè¥¿ï¼Œå®ƒæ‰æ˜¯æ§åˆ¶beanåˆå§‹åŒ–åŠ è½½çš„æ ¸å¿ƒ</p><p><strong>ImportBeanDefinitionRegistrar</strong>ç›¸æ¯”äºImportSelectorï¼Œå¯¹æ³¨å…¥çš„beanæœ‰æ›´å¤§çš„æ“ä½œç©ºé—´</p><p>å®ç°ImportBeanDefinitionRegistraræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRegister</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportBeanDefinitionRegistrar</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;<br>        <span class="hljs-comment">//è·å–beançš„beanDefinition</span><br>        <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(Dog.class).getBeanDefinition();<br>        <span class="hljs-comment">//æ³¨å…¥åˆ°å®¹å™¨ä¸­</span><br>        registry.registerBeanDefinition(<span class="hljs-string">&quot;dog&quot;</span>, beanDefinition);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¼å…¥Registraré…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(&quot;com.xw.bean&quot;)</span><br><span class="hljs-meta">@Import(MyRegister.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig6</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App6</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig6.class);<br><br>        String[] names = app.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            ç»“æœ</span><br><span class="hljs-comment">            dog</span><br><span class="hljs-comment">        */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="7-å¯¹å®¹å™¨ä¸­beançš„æœ€ç»ˆè£å®š"><a href="#7-å¯¹å®¹å™¨ä¸­beançš„æœ€ç»ˆè£å®š" class="headerlink" title="7.å¯¹å®¹å™¨ä¸­beançš„æœ€ç»ˆè£å®š"></a>7.å¯¹å®¹å™¨ä¸­beançš„æœ€ç»ˆè£å®š</h4><p>postProcessorä¸ºæœ€åæ‰§è¡Œçš„å¯¹å®¹å™¨ä¸­beançš„æ³¨å†Œ</p><p>å®ç°<strong>BeanDefinitionRegistryPostProcessor</strong>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-comment">//è·å–beançš„beanDefinition</span><br>        <span class="hljs-type">AbstractBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(Cat.class).getBeanDefinition();<br>        <span class="hljs-comment">//å°†ä¹‹å‰çš„dogåˆ æ‰æ¢æˆcat</span><br>        registry.removeBeanDefinition(<span class="hljs-string">&quot;dog&quot;</span>);<br>        registry.registerBeanDefinition(<span class="hljs-string">&quot;cat&quot;</span>, beanDefinition);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¼å…¥PostProcessoré…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(&quot;com.xw.bean&quot;)</span><br><span class="hljs-meta">@Import(&#123;MyRegister.class, MyPostProcessor.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig6</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–bean</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bean">public class App6 &#123;<br>    public static void main(String[] args) &#123;<br>        AnnotationConfigApplicationContext app = new AnnotationConfigApplicationContext(SpringConfig6.class);<br><br>        String[] names = app.getBeanDefinitionNames();<br>        for (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>        /*<br>            ç»“æœ<br>            cat<br>        */<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h2><blockquote><p><strong>BeanFactory</strong>çš„ä½œç”¨æ˜¯å®Œæˆäº†Beançš„åˆå§‹åŒ–ã€è‡ªåŠ¨è£…é…ã€å­˜å‚¨å•ä¾‹Beanç­‰åŠŸèƒ½</p><p><strong>FactoryBean</strong>æœ¬èº«æ˜¯ä¸€ä¸ªBeanï¼Œçš„ä½œç”¨æ˜¯ä¼šå°†è‡ªèº«å’ŒgetObject()æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºBeanæ³¨å…¥åˆ°å®¹å™¨ä¸­</p></blockquote><p>è¯»åŸæ–‡<a href="https://juejin.cn/post/6844903954615107597">FactoryBeanâ€”â€”Springçš„æ‰©å±•ç‚¹ä¹‹ä¸€ - æ˜é‡‘ (juejin.cn)</a>åšçš„ç¬”è®°</p><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><ol><li>å®ç°FactoryBeanæ¥å£ï¼Œå°†è‡ªå®šä¹‰çš„FactoryBeanæ³¨å…¥å®¹å™¨</li><li>ä»å®¹å™¨ä¸­è·å–</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// serviceç±»ï¼Œå°†é€šè¿‡FactoryBeanæ³¨å…¥å®¹å™¨</span><br><br><span class="hljs-keyword">package</span> com.xw.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;userService construct&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰çš„FactoryBean</span><br><br><span class="hljs-keyword">package</span> com.xw.component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;UserService&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;<br>        <span class="hljs-keyword">return</span> UserService.class;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é…ç½®ç±»ï¼Œç”¨äºæ‰«æç»„ä»¶</span><br><br><span class="hljs-keyword">package</span> com.xw.config;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.xw.component&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®¹å™¨ï¼Œè·å–Bean</span><br><br><span class="hljs-keyword">package</span> com.xw;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);<br>        System.out.println(<span class="hljs-string">&quot;å®¹å™¨åˆå§‹åŒ–å®Œæˆ&quot;</span>);<br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> applicationContext.getBean(UserService.class);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">customFactoryBean</span> <span class="hljs-operator">=</span> applicationContext.getBean(<span class="hljs-string">&quot;customFactoryBean&quot;</span>);<br>        <br>        <span class="hljs-comment">// é€šè¿‡Classç±»å’ŒBeanNameè·å–çš„Beanç«Ÿç„¶æ˜¯åŒä¸€ä¸ªBean</span><br>        System.out.println(userService);<br>        System.out.println(customFactoryBean);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    å®¹å™¨åˆå§‹åŒ–å®Œæˆ</span><br><span class="hljs-comment">    userService construct</span><br><span class="hljs-comment">    com.xw.service.UserService@59d016c9</span><br><span class="hljs-comment">    com.xw.service.UserService@59d016c9</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li><p>è‡ªå®šä¹‰çš„FactoryBeanä¼šå‘å®¹å™¨ä¸­æ³¨å…¥ä¸¤ä¸ªBeanï¼Œä¸€ä¸ªæ˜¯è‡ªèº«ï¼Œä¸€ä¸ªæ˜¯getObject()æ–¹æ³•çš„è¿”å›å€¼ï¼›</p></li><li><p>è¦æƒ³è·å–è‡ªå®šä¹‰çš„FactoryBeanæœ¬èº«ï¼Œéœ€è¦åœ¨BeanNameå‰é¢åŠ ä¸Š<code>&amp;</code>ç¬¦å·ï¼Œ<code>applicationContext.getBean(&quot;&amp;customFactoryBean&quot;)</code></p></li></ol><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><ol><li><p>refresh()</p><p>åˆ›å»ºå®¹å™¨çš„<code>finishBeanFactoryInitialization</code>æ­¥éª¤ï¼Œä¼šè°ƒç”¨åˆ°<code>beanFactory.preInstantiateSingletons()</code>æ¥å®ä¾‹åŒ–å•ä¾‹Bean</p><p><img src="/img/spring_img/%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E8%BF%87%E7%A8%8BfinishBeanFactoryInitialization.png"></p></li><li><p>preInstantiateSingletons()</p><p>å¦‚æœæ˜¯FactoryBeançš„å®ä¾‹ï¼Œå°±é€šè¿‡<code>getBean()</code>æ¥è·å–æˆ–åˆ›å»ºBeanï¼Œä¸”åœ¨BeanNameå‰åŠ äº†ä¸ª<code>&amp;</code></p><p>ä¹‹åä¼šåˆ¤æ–­<code>isEagerInit</code>æ¥åˆ›å»º<code>getObject()</code>é‡Œçš„Bean</p><p><img src="/img/spring_img/preInstantiateSingletons.png"></p></li><li><p>getObjectForBeanInstance()</p><p>åœ¨<code>getBean()</code>ä¸­ä¼šè°ƒç”¨<code>doGetBean()</code>ï¼Œç„¶åè°ƒç”¨<code>getObjectForBeanInstance()</code></p><p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šåˆ¤æ–­Beanæ˜¯å¦æ˜¯<code>FactoryBean</code>çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯åˆ™åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰æ‰ä¼šè°ƒç”¨<code>getObjectFromFactoryBean()</code></p><p><img src="/img/spring_img/getObjectForBeanInstance.png"></p></li><li><p>getObjectFromFactoryBean()</p><p>é€šè¿‡<code>doGetObjectFromFactoryBean()</code>æ¥è°ƒç”¨FactoryBeançš„<code>getObject()</code>æ–¹æ³•ï¼Œå¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸ºå•ä¾‹æ¥å†³å®šè¦ä¸è¦æ”¾åˆ°ç¼“å­˜ä¸­</p><p><img src="/img/spring_img/getObjectFromFactoryBean.png"></p></li><li><p>doGetObjectFromFactoryBean()</p><p>æœ€ç»ˆåœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨äº†<code>getObject()</code></p><p><img src="/img/spring_img/doGetObjectFromFactoryBean.png"></p></li><li><p>æ€»ç»“</p><p>é€šè¿‡åˆ¤æ–­<code>FactoryBean</code>ã€<code>getObject()é‡Œè¿”å›çš„å¯¹è±¡</code>æ˜¯å¦è¢«åˆ›å»ºè¿‡ï¼Œåªæœ‰éƒ½æ²¡æœ‰åˆ›å»ºè¿‡æ‰ä¼šæœ€ç»ˆåˆ›å»ºBeanï¼Œä¿è¯å•ä¾‹æ€§</p></li></ol><h3 id="åœ¨Mybatisé‡Œçš„ä½¿ç”¨åœºæ™¯"><a href="#åœ¨Mybatisé‡Œçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="åœ¨Mybatisé‡Œçš„ä½¿ç”¨åœºæ™¯"></a>åœ¨Mybatisé‡Œçš„ä½¿ç”¨åœºæ™¯</h3><p><strong>Springä¸­ä½¿ç”¨Mybatis</strong></p><ol><li>mybatisä¸­ï¼Œé€šè¿‡<code>sqlSessionFactoryBean</code>æ¥åˆ›å»º<code>sqlSessionFactory</code></li><li><code>MapperScannerRegistrar</code>ä¼šå°†Mapperæ–‡ä»¶æ‰«æå‡ºæ¥ç”Ÿæˆ<code>BeanDefinition</code>ï¼Œç„¶åä¼šç”Ÿæˆä¸€ä¸ª<code>MapperFactoryBean</code>ï¼Œé€šè¿‡<code>MapperFactoryBean</code>æœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ªMapperæ–‡ä»¶å¯¹åº”çš„ä»£ç†å¯¹è±¡</li></ol><p>SpringBootæ•´åˆMybatis</p><ol><li>åœ¨SpringBootä¸­Mybatisçš„è‡ªåŠ¨è£…é…ç”±<code>MybatisAutoConfiguration</code>è¿™ä¸ªç±»å®Œæˆï¼Œé‡Œé¢è°ƒç”¨äº†<code>SqlSessionFactoryBean</code>çš„getObject()æ–¹æ³•æ¥æ³¨å…¥äº†<code>sqlSessionFactory</code></li></ol>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>beançš„åŠ è½½æ–¹å¼(1)</title>
    <link href="/2022/07/22/spring/bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F(1)/"/>
    <url>/2022/07/22/spring/bean%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F(1)/</url>
    
    <content type="html"><![CDATA[<h2 id="beançš„åŠ è½½æ–¹å¼-1"><a href="#beançš„åŠ è½½æ–¹å¼-1" class="headerlink" title="beançš„åŠ è½½æ–¹å¼(1)"></a>beançš„åŠ è½½æ–¹å¼(1)</h2><h4 id="1-lt-bean-gt-æ ‡ç­¾"><a href="#1-lt-bean-gt-æ ‡ç­¾" class="headerlink" title="1.&lt;bean/&gt;æ ‡ç­¾"></a>1.<code>&lt;bean/&gt;</code>æ ‡ç­¾</h4><p>é€šè¿‡xmlé…ç½®æ¥æ³¨å…¥bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--xmlæ–¹å¼å£°æ˜è‡ªå·±å¼€å‘çš„bean--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cat&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.bean.Cat&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xw.bean.Dog&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!--xmlæ–¹å¼å£°æ˜ç¬¬ä¸‰æ–¹å¼€å‘çš„bean--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è·å–bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;spring-config.xml&quot;</span>);<br>        String[] names = app.getBeanDefinitionNames(); <span class="hljs-comment">// è·å–å®¹å™¨ä¸­æ‰€æœ‰beançš„åç§°</span><br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">cat<br>com<span class="hljs-selector-class">.xw</span><span class="hljs-selector-class">.bean</span>.Dog#<span class="hljs-number">0</span><br>dataSource<br>com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.pool</span>.DruidDataSource#<span class="hljs-number">0</span><br>com<span class="hljs-selector-class">.alibaba</span><span class="hljs-selector-class">.druid</span><span class="hljs-selector-class">.pool</span>.DruidDataSource#<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="2-æ³¨è§£å®šä¹‰bean"><a href="#2-æ³¨è§£å®šä¹‰bean" class="headerlink" title="2.æ³¨è§£å®šä¹‰bean"></a>2.æ³¨è§£å®šä¹‰bean</h4><p>å¯ä»¥ä½¿ç”¨çš„æ³¨è§£æœ‰@Componentä»¥åŠä¸‰ä¸ªè¡ç”Ÿæ³¨è§£@Serviceã€@Controllerã€@Repositoryã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component(&quot;jerry&quot;)</span><span class="hljs-comment">//å¯ä»¥ç»™beanèµ·ä¸ªåå­—</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mouse</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ è½½ç¬¬ä¸‰æ–¹beanæ—¶å¯é€šè¿‡@beanæ¥æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DbConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DruidDataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br>        <span class="hljs-keyword">return</span> ds;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åè®°å¾—å¼€å¯æ³¨è§£æ‰«æ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-string"><span class="hljs-tag">       http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">       http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">    &quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--æŒ‡å®šæ‰«æåŠ è½½beançš„ä½ç½®--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.xw.bean,com.xw.config&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="3-ComponentScanæ‰«æbean"><a href="#3-ComponentScanæ‰«æbean" class="headerlink" title="3.@ComponentScanæ‰«æbean"></a>3.@ComponentScanæ‰«æbean</h4><p>ä½¿ç”¨<strong>FactoryBeanæ¥å£</strong></p><p>é€ å‡ºæ¥çš„beanå¹¶ä¸æ˜¯DogFactoryBeanï¼Œè€Œæ˜¯Dog</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DogFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;Dog&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Dog <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Dog</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br>        <span class="hljs-comment">//å¯ä»¥å¯¹å¯¹è±¡è¿›è¡Œä¸€ç³»åˆ—æ“ä½œåå†æ³¨å…¥</span><br>        <span class="hljs-keyword">return</span> d;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;<br>        <span class="hljs-keyword">return</span> Dog.class;<br>    &#125;<br>    <span class="hljs-comment">//æ˜¯å¦å•ä¾‹</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªç±»å¹¶ä½¿ç”¨**@ComponentScan**æ›¿ä»£åŸå§‹xmlé…ç½®ä¸­çš„åŒ…æ‰«æè¿™ä¸ªåŠ¨ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan(&#123;&quot;com.xw.bean&quot;,&quot;com.xw.config&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig3</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DogFactoryBean <span class="hljs-title function_">dog</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//é€šè¿‡FactoryBeanæ¥æ³¨å…¥ï¼Œå¯ä»¥åœ¨å¯¹è±¡åˆå§‹åŒ–å‰åšä¸€äº›äº‹æƒ…</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DogFactoryBean</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡<strong>AnnotationConfigApplicationContext</strong>è·å–bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App3</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig3.class);<br>        String[] names = app.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>å¯ç”¨**@ImportResource**å°†xmlé…ç½®æ–‡ä»¶ä¸­çš„beanå’Œé…ç½®ç±»ä¸­çš„beanèåˆåœ¨ä¸€èµ·ï¼Œåœ¨é…ç½®ç±»ä¸Šç›´æ¥å†™ä¸Šè¦è¢«èåˆçš„xmlé…ç½®æ–‡ä»¶åå³å¯ï¼Œç®—çš„ä¸Šä¸€ç§å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ImportResource(&quot;applicationContext1.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig3</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>@Configuration</strong>æ³¨è§£çš„proxyBeanMethodså±æ€§ï¼Œæ­¤å±æ€§é»˜è®¤å€¼ä¸ºtrueï¼Œè‹¥è®¾ä¸ºfalseï¼Œåˆ™è¡¨ç¤ºæ³¨å…¥åˆ°å®¹å™¨ä¸­çš„å¯¹è±¡ä¸å†æ˜¯å”¯ä¸€çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig3</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">cat</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4-ImportæŒ‡å®šbean"><a href="#4-ImportæŒ‡å®šbean" class="headerlink" title="4.@ImportæŒ‡å®šbean"></a>4.@ImportæŒ‡å®šbean</h4><p>é€šè¿‡@Importå¯æŒ‡å®šè¦æ³¨å…¥çš„beanï¼Œä¸éœ€è¦åœ¨beanä¸ŠåŠ æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(Dog.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig4</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App4</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig4.class);<br>        String[] names = app.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String name : names) &#123;<br>            System.out.println(name);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">springConfig4<br>com<span class="hljs-selector-class">.xw</span><span class="hljs-selector-class">.bean</span>.Dog<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦ä¹ ç¬”è®°</category>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
